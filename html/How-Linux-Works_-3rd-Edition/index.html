<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>How Linux Works, 3rd Edition</title></head><body><div class="calibre" id="calibre_link-0"><p class="calibre_"><span class="calibre1"><span class="bold">CONTENTS IN DETAIL</span></span></p><div class="calibre_1">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_3"><a href="#calibre_link-1"><span class="bold"><span class="calibre_4">REVIEWS FOR HOW LINUX WORKS</span></span></a></li><li value="2" class="calibre_3"><a href="#calibre_link-2"><span class="bold"><span class="calibre_4">TITLE PAGE</span></span></a></li><li value="3" class="calibre_3"><a href="#calibre_link-3"><span class="bold"><span class="calibre_4">COPYRIGHT</span></span></a></li><li value="4" class="calibre_3"><a href="#calibre_link-4"><span class="bold"><span class="calibre_4">ABOUT THE AUTHOR</span></span></a></li><li value="5" class="calibre_3"><a href="#calibre_link-5"><span class="bold"><span class="calibre_4">ACKNOWLEDGMENTS</span></span></a></li><li value="6" class="calibre_3"><a href="#calibre_link-6"><span class="bold"><span class="calibre_4">PREFACE</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-7"><span class="calibre_4">Who Should Read This Book?</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-8"><span class="calibre_4">Prerequisites</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-9"><span class="calibre_4">How to Read This Book</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-10"><span class="calibre_4">A Hands-on Approach</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-11"><span class="calibre_4">How This Book Is Organized</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-12"><span class="calibre_4">What’s New in the Third Edition?</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-13"><span class="calibre_4">A Note on Terminology</span></a></li></ol></li><li value="7" class="calibre_3"><a href="#calibre_link-14"><span class="bold"><span class="calibre_4">CHAPTER 1: THE BIG PICTURE</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-15"><span class="calibre_4"> 1.1 Levels and Layers of Abstraction in a Linux System</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-16"><span class="calibre_4"> 1.2 Hardware: Understanding Main Memory</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-17"><span class="calibre_4"> 1.3 The Kernel</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-18"><span class="calibre_4">1.3.1 Process Management</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-19"><span class="calibre_4">1.3.2 Memory Management</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-20"><span class="calibre_4">1.3.3 Device Drivers and Management</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-21"><span class="calibre_4">1.3.4 System Calls and Support</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-22"><span class="calibre_4"> 1.4 User Space</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-23"><span class="calibre_4"> 1.5 Users</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-24"><span class="calibre_4"> 1.6 Looking Forward</span></a></li></ol></li><li value="8" class="calibre_3"><a href="#calibre_link-25"><span class="bold"><span class="calibre_4">CHAPTER 2: BASIC COMMANDS AND DIRECTORY HIERARCHY</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-26"><span class="calibre_4"> 2.1 The Bourne Shell: /bin/sh</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-27"><span class="calibre_4"> 2.2 Using the Shell</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-28"><span class="calibre_4">2.2.1 The Shell Window</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-29"><span class="calibre_4">2.2.2 cat</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-30"><span class="calibre_4">2.2.3 Standard Input and Standard Output</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-31"><span class="calibre_4"> 2.3 Basic Commands</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-32"><span class="calibre_4">2.3.1 ls</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-33"><span class="calibre_4">2.3.2 cp</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-34"><span class="calibre_4">2.3.3 mv</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-35"><span class="calibre_4">2.3.4 touch</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-36"><span class="calibre_4">2.3.5 rm</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-37"><span class="calibre_4">2.3.6 echo</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-38"><span class="calibre_4"> 2.4 Navigating Directories</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-39"><span class="calibre_4">2.4.1 cd</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-40"><span class="calibre_4">2.4.2 mkdir</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-41"><span class="calibre_4">2.4.3 rmdir</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-42"><span class="calibre_4">2.4.4 Shell Globbing (“Wildcards”)</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-43"><span class="calibre_4"> 2.5 Intermediate Commands</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-44"><span class="calibre_4">2.5.1 grep</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-45"><span class="calibre_4">2.5.2 less</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-46"><span class="calibre_4">2.5.3 pwd</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-47"><span class="calibre_4">2.5.4 diff</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-48"><span class="calibre_4">2.5.5 file</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-49"><span class="calibre_4">2.5.6 find and locate</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-50"><span class="calibre_4">2.5.7 head and tail</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-51"><span class="calibre_4">2.5.8 sort</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-52"><span class="calibre_4"> 2.6 Changing Your Password and Shell</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-53"><span class="calibre_4"> 2.7 Dot Files</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-54"><span class="calibre_4"> 2.8 Environment and Shell Variables</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-55"><span class="calibre_4"> 2.9 The Command Path</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-56"><span class="calibre_4"> 2.10 Special Characters</span></a></li><li value="11" class="calibre_7"><a href="#calibre_link-57"><span class="calibre_4"> 2.11 Command-Line Editing</span></a></li><li value="12" class="calibre_7"><a href="#calibre_link-58"><span class="calibre_4"> 2.12 Text Editors</span></a></li><li value="13" class="calibre_7"><a href="#calibre_link-59"><span class="calibre_4"> 2.13 Getting Online Help</span></a></li><li value="14" class="calibre_7"><a href="#calibre_link-60"><span class="calibre_4"> 2.14 Shell Input and Output</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-61"><span class="calibre_4">2.14.1 Standard Error</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-62"><span class="calibre_4">2.14.2 Standard Input Redirection</span></a></li></ol></li><li value="15" class="calibre_8"><a href="#calibre_link-63"><span class="calibre_4"> 2.15 Understanding Error Messages</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-64"><span class="calibre_4">2.15.1 Anatomy of a Unix Error Message</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-65"><span class="calibre_4">2.15.2 Common Errors</span></a></li></ol></li><li value="16" class="calibre_8"><a href="#calibre_link-66"><span class="calibre_4"> 2.16 Listing and Manipulating Processes</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-67"><span class="calibre_4">2.16.1 ps Command Options</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-68"><span class="calibre_4">2.16.2 Process Termination</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-69"><span class="calibre_4">2.16.3 Job Control</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-70"><span class="calibre_4">2.16.4 Background Processes</span></a></li></ol></li><li value="17" class="calibre_8"><a href="#calibre_link-71"><span class="calibre_4"> 2.17 File Modes and Permissions</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-72"><span class="calibre_4">2.17.1 Modifying Permissions</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-73"><span class="calibre_4">2.17.2 Working with Symbolic Links</span></a></li></ol></li><li value="18" class="calibre_8"><a href="#calibre_link-74"><span class="calibre_4"> 2.18 Archiving and Compressing Files</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-75"><span class="calibre_4">2.18.1 gzip</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-76"><span class="calibre_4">2.18.2 tar</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-77"><span class="calibre_4">2.18.3 Compressed Archives (.tar.gz)</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-78"><span class="calibre_4">2.18.4 zcat</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-79"><span class="calibre_4">2.18.5 Other Compression Utilities</span></a></li></ol></li><li value="19" class="calibre_8"><a href="#calibre_link-80"><span class="calibre_4"> 2.19 Linux Directory Hierarchy Essentials</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-81"><span class="calibre_4">2.19.1 Other Root Subdirectories</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-82"><span class="calibre_4">2.19.2 The /usr Directory</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-83"><span class="calibre_4">2.19.3 Kernel Location</span></a></li></ol></li><li value="20" class="calibre_8"><a href="#calibre_link-84"><span class="calibre_4"> 2.20 Running Commands as the Superuser</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-85"><span class="calibre_4">2.20.1 sudo</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-86"><span class="calibre_4">2.20.2 /etc/sudoers</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-87"><span class="calibre_4">2.20.3 sudo Logs</span></a></li></ol></li><li value="21" class="calibre_8"><a href="#calibre_link-88"><span class="calibre_4"> 2.21 Looking Forward</span></a></li></ol></li><li value="9" class="calibre_3"><a href="#calibre_link-89"><span class="bold"><span class="calibre_4">CHAPTER 3: DEVICES</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-90"><span class="calibre_4"> 3.1 Device Files</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-91"><span class="calibre_4"> 3.2 The sysfs Device Path</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-92"><span class="calibre_4"> 3.3 dd and Devices</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-93"><span class="calibre_4"> 3.4 Device Name Summary</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-94"><span class="calibre_4">3.4.1 Hard Disks: /dev/sd*</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-95"><span class="calibre_4">3.4.2 Virtual Disks: /dev/xvd*, /dev/vd*</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-96"><span class="calibre_4">3.4.3 Non-Volatile Memory Devices: /dev/nvme*</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-97"><span class="calibre_4">3.4.4 Device Mapper: /dev/dm-*, /dev/mapper/*</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-98"><span class="calibre_4">3.4.5 CD and DVD Drives: /dev/sr*</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-99"><span class="calibre_4">3.4.6 PATA Hard Disks: /dev/hd*</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-100"><span class="calibre_4">3.4.7 Terminals: /dev/tty*, /dev/pts/*, and /dev/tty</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-101"><span class="calibre_4">3.4.8 Serial Ports: /dev/ttyS*, /dev/ttyUSB*, /dev/ttyACM*</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-102"><span class="calibre_4">3.4.9 Parallel Ports: /dev/lp0 and /dev/lp1</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-103"><span class="calibre_4">3.4.10 Audio Devices: /dev/snd/*, /dev/dsp, /dev/audio, and More</span></a></li><li value="11" class="calibre_7"><a href="#calibre_link-104"><span class="calibre_4">3.4.11 Device File Creation</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-105"><span class="calibre_4"> 3.5 udev</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-106"><span class="calibre_4">3.5.1 devtmpfs</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-107"><span class="calibre_4">3.5.2 udevd Operation and Configuration</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-108"><span class="calibre_4">3.5.3 udevadm</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-109"><span class="calibre_4">3.5.4 Device Monitoring</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-110"><span class="calibre_4"> 3.6 In-Depth: SCSI and the Linux Kernel</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-111"><span class="calibre_4">3.6.1 USB Storage and SCSI</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-112"><span class="calibre_4">3.6.2 SCSI and ATA</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-113"><span class="calibre_4">3.6.3 Generic SCSI Devices</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-114"><span class="calibre_4">3.6.4 Multiple Access Methods for a Single Device</span></a></li></ol></li></ol></li><li value="10" class="calibre_3"><a href="#calibre_link-115"><span class="bold"><span class="calibre_4">CHAPTER 4: DISKS AND FILESYSTEMS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-116"><span class="calibre_4"> 4.1 Partitioning Disk Devices</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-117"><span class="calibre_4">4.1.1 Viewing a Partition Table</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-118"><span class="calibre_4">4.1.2 Modifying Partition Tables</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-119"><span class="calibre_4">4.1.3 Creating a Partition Table</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-120"><span class="calibre_4">4.1.4 Navigating Disk and Partition Geometry</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-121"><span class="calibre_4">4.1.5 Reading from Solid-State Disks </span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-122"><span class="calibre_4"> 4.2 Filesystems</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-123"><span class="calibre_4">4.2.1 Filesystem Types</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-124"><span class="calibre_4">4.2.2 Creating a Filesystem</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-125"><span class="calibre_4">4.2.3 Mounting a Filesystem</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-126"><span class="calibre_4">4.2.4 Filesystem UUID</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-127"><span class="calibre_4">4.2.5 Disk Buffering, Caching, and Filesystems</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-128"><span class="calibre_4">4.2.6 Filesystem Mount Options</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-129"><span class="calibre_4">4.2.7 Remounting a Filesystem</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-130"><span class="calibre_4">4.2.8 The /etc/fstab Filesystem Table</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-131"><span class="calibre_4">4.2.9 Alternatives to /etc/fstab</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-132"><span class="calibre_4">4.2.10 Filesystem Capacity</span></a></li><li value="11" class="calibre_7"><a href="#calibre_link-133"><span class="calibre_4">4.2.11 Checking and Repairing Filesystems</span></a></li><li value="12" class="calibre_7"><a href="#calibre_link-134"><span class="calibre_4">4.2.12 Special-Purpose Filesystems</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-135"><span class="calibre_4"> 4.3 Swap Space</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-136"><span class="calibre_4">4.3.1 Using a Disk Partition as Swap Space</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-137"><span class="calibre_4">4.3.2 Using a File as Swap Space</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-138"><span class="calibre_4">4.3.3 Determining How Much Swap You Need</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-139"><span class="calibre_4"> 4.4 The Logical Volume Manager</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-140"><span class="calibre_4">4.4.1 Working with LVM</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-141"><span class="calibre_4">4.4.2 The LVM Implementation</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-142"><span class="calibre_4"> 4.5 Looking Forward: Disks and User Space</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-143"><span class="calibre_4"> 4.6 Inside a Traditional Filesystem</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-144"><span class="calibre_4">4.6.1 Inode Details and the Link Count </span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-145"><span class="calibre_4">4.6.2 Block Allocation</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-146"><span class="calibre_4">4.6.3 Working with Filesystems in User Space</span></a></li></ol></li></ol></li><li value="11" class="calibre_3"><a href="#calibre_link-147"><span class="bold"><span class="calibre_4">CHAPTER 5: HOW THE LINUX KERNEL BOOTS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-148"><span class="calibre_4"> 5.1 Startup Messages</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-149"><span class="calibre_4"> 5.2 Kernel Initialization and Boot Options</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-150"><span class="calibre_4"> 5.3 Kernel Parameters</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-151"><span class="calibre_4"> 5.4 Boot Loaders</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-152"><span class="calibre_4">5.4.1 Boot Loader Tasks</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-153"><span class="calibre_4">5.4.2 Boot Loader Overview</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-154"><span class="calibre_4">5.5.1 Exploring Devices and Partitions with the GRUB Command Line</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-155"><span class="calibre_4">5.5.2 GRUB Configuration</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-156"><span class="calibre_4">5.5.3 GRUB Installation</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-157"><span class="calibre_4"> 5.6 UEFI Secure Boot Problems</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-158"><span class="calibre_4"> 5.7 Chainloading Other Operating Systems</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-159"><span class="calibre_4"> 5.8 Boot Loader Details</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-160"><span class="calibre_4">5.8.1 MBR Boot</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-161"><span class="calibre_4">5.8.2 UEFI Boot</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-162"><span class="calibre_4">5.8.3 How GRUB Works</span></a></li></ol></li></ol></li><li value="12" class="calibre_3"><a href="#calibre_link-163"><span class="bold"><span class="calibre_4">CHAPTER 6: HOW USER SPACE STARTS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-164"><span class="calibre_4"> 6.2 Identifying Your init</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-165"><span class="calibre_4"> 6.3 systemd</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-166"><span class="calibre_4">6.3.1 Units and Unit Types</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-167"><span class="calibre_4">6.3.2 Booting and Unit Dependency Graphs</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-168"><span class="calibre_4">6.3.3 systemd Configuration</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-169"><span class="calibre_4">6.3.4 systemd Operation</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-170"><span class="calibre_4">6.3.5 systemd Process Tracking and Synchronization</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-171"><span class="calibre_4">6.3.6 systemd Dependencies</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-172"><span class="calibre_4">6.3.7 systemd On-Demand and Resource-Parallelized Startup</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-173"><span class="calibre_4">6.3.8 systemd Auxiliary Components</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-174"><span class="calibre_4"> 6.4 System V Runlevels</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-175"><span class="calibre_4"> 6.5 System V init</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-176"><span class="calibre_4">6.5.1 System V init: Startup Command Sequence</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-177"><span class="calibre_4">6.5.2 The System V init Link Farm</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-178"><span class="calibre_4">6.5.3 run-parts</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-179"><span class="calibre_4">6.5.4 System V init Control</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-180"><span class="calibre_4">6.5.5 systemd System V Compatibility</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-181"><span class="calibre_4"> 6.6 Shutting Down Your System</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-182"><span class="calibre_4"> 6.7 The Initial RAM Filesystem</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-183"><span class="calibre_4"> 6.8 Emergency Booting and Single-User Mode</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-184"><span class="calibre_4"> 6.9 Looking Forward</span></a></li></ol></li><li value="13" class="calibre_3"><a href="#calibre_link-185"><span class="bold"><span class="calibre_4">CHAPTER 7: SYSTEM CONFIGURATION: LOGGING, SYSTEM TIME, BATCH JOBS, AND USERS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-186"><span class="calibre_4"> 7.1 System Logging</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-187"><span class="calibre_4">7.1.1 Checking Your Log Setup</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-188"><span class="calibre_4">7.1.2 Searching and Monitoring Logs</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-189"><span class="calibre_4">7.1.3 Logfile Rotation</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-190"><span class="calibre_4">7.1.4 Journal Maintenance</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-191"><span class="calibre_4">7.1.5 A Closer Look at System Logging</span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-192"><span class="calibre_4"> 7.2 The Structure of /etc</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-193"><span class="calibre_4"> 7.3 User Management Files</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-194"><span class="calibre_4">7.3.1 The /etc/passwd File</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-195"><span class="calibre_4">7.3.2 Special Users</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-196"><span class="calibre_4">7.3.3 The /etc/shadow File</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-197"><span class="calibre_4">7.3.4 Manipulating Users and Passwords</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-198"><span class="calibre_4">7.3.5 Working with Groups</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-199"><span class="calibre_4"> 7.4 getty and login</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-200"><span class="calibre_4"> 7.5 Setting the Time</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-201"><span class="calibre_4">7.5.1 Kernel Time Representation and Time Zones</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-202"><span class="calibre_4">7.5.2 Network Time</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-203"><span class="calibre_4"> 7.6 Scheduling Recurring Tasks with cron and Timer Units</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-204"><span class="calibre_4">7.6.1 Installing Crontab Files</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-205"><span class="calibre_4">7.6.2 System Crontab Files</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-206"><span class="calibre_4">7.6.3 Timer Units</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-207"><span class="calibre_4">7.6.4 cron vs. Timer Units</span></a></li></ol></li><li value="7" class="calibre_8"><a href="#calibre_link-208"><span class="calibre_4"> 7.7 Scheduling One-Time Tasks with at</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-209"><span class="calibre_4">7.7.1 Timer Unit Equivalents</span></a></li></ol></li><li value="8" class="calibre_8"><a href="#calibre_link-210"><span class="calibre_4"> 7.8 Timer Units Running as Regular Users</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-211"><span class="calibre_4"> 7.9 User Access Topics</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-212"><span class="calibre_4">7.9.1 User IDs and User Switching</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-213"><span class="calibre_4">7.9.2 Process Ownership, Effective UID, Real UID, and Saved UID</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-214"><span class="calibre_4">7.9.3 User Identification, Authentication, and Authorization</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-215"><span class="calibre_4">7.9.4 Using Libraries for User Information</span></a></li></ol></li><li value="10" class="calibre_8"><a href="#calibre_link-216"><span class="calibre_4"> 7.10 Pluggable Authentication Modules</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-217"><span class="calibre_4">7.10.1 PAM Configuration</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-218"><span class="calibre_4">7.10.2 Tips on PAM Configuration Syntax</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-219"><span class="calibre_4">7.10.3 PAM and Passwords</span></a></li></ol></li><li value="11" class="calibre_8"><a href="#calibre_link-220"><span class="calibre_4"> 7.11 Looking Forward</span></a></li></ol></li><li value="14" class="calibre_3"><a href="#calibre_link-221"><span class="bold"><span class="calibre_4">CHAPTER 8: A CLOSER LOOK AT PROCESSES AND RESOURCE UTILIZATION</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-222"><span class="calibre_4"> 8.1 Tracking Processes</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-223"><span class="calibre_4"> 8.2 Finding Open Files with lsof</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-224"><span class="calibre_4">8.2.1 Reading the lsof Output</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-225"><span class="calibre_4">8.2.2 Using lsof</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-226"><span class="calibre_4"> 8.3 Tracing Program Execution and System Calls</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-227"><span class="calibre_4">8.3.1 strace</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-228"><span class="calibre_4">8.3.2 ltrace</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-229"><span class="calibre_4"> 8.4 Threads</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-230"><span class="calibre_4">8.4.1 Single-Threaded and Multithreaded Processes</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-231"><span class="calibre_4">8.4.2 Viewing Threads</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-232"><span class="calibre_4">8.5.1 Measuring CPU Time</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-233"><span class="calibre_4">8.5.2 Adjusting Process Priorities</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-234"><span class="calibre_4">8.5.3 Measuring CPU Performance with Load Averages</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-235"><span class="calibre_4">8.5.4 Monitoring Memory Status</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-236"><span class="calibre_4">8.5.5 Monitoring CPU and Memory Performance with vmstat</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-237"><span class="calibre_4">8.5.6 I/O Monitoring</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-238"><span class="calibre_4">8.5.7 Per-Process Monitoring with pidstat</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-239"><span class="calibre_4"> 8.6 Control Groups (cgroups)</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-240"><span class="calibre_4">8.6.1 Differentiating Between cgroup Versions </span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-241"><span class="calibre_4">8.6.2 Viewing cgroups</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-242"><span class="calibre_4">8.6.3 Manipulating and Creating cgroups</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-243"><span class="calibre_4">8.6.4 Viewing Resource Utilization</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-244"><span class="calibre_4"> 8.7 Further Topics</span></a></li></ol></li><li value="15" class="calibre_3"><a href="#calibre_link-245"><span class="bold"><span class="calibre_4">CHAPTER 9: UNDERSTANDING YOUR NETWORK AND ITS CONFIGURATION</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-246"><span class="calibre_4"> 9.1 Network Basics</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-247"><span class="calibre_4"> 9.2 Packets</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-248"><span class="calibre_4"> 9.3 Network Layers</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-249"><span class="calibre_4"> 9.4 The Internet Layer</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-250"><span class="calibre_4">9.4.1 Viewing IP Addresses</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-251"><span class="calibre_4">9.4.2 Subnets</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-252"><span class="calibre_4">9.4.3 Common Subnet Masks and CIDR Notation</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-253"><span class="calibre_4"> 9.5 Routes and the Kernel Routing Table</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-254"><span class="calibre_4"> 9.6 The Default Gateway</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-255"><span class="calibre_4"> 9.7 IPv6 Addresses and Networks</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-256"><span class="calibre_4">9.7.1 Viewing IPv6 Configuration on Your System</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-257"><span class="calibre_4">9.7.2 Configuring Dual-Stack Networks</span></a></li></ol></li><li value="8" class="calibre_8"><a href="#calibre_link-258"><span class="calibre_4"> 9.8 Basic ICMP and DNS Tools</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-259"><span class="calibre_4">9.8.1 ping</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-260"><span class="calibre_4">9.8.2 DNS and host</span></a></li></ol></li><li value="9" class="calibre_8"><a href="#calibre_link-261"><span class="calibre_4"> 9.9 The Physical Layer and Ethernet</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-262"><span class="calibre_4"> 9.10 Understanding Kernel Network Interfaces</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-263"><span class="calibre_4">9.11.1 Manually Configuring Interfaces </span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-264"><span class="calibre_4">9.11.2 Manually Adding and Deleting Routes</span></a></li></ol></li><li value="11" class="calibre_8"><a href="#calibre_link-265"><span class="calibre_4"> 9.12 Boot-Activated Network Configuration</span></a></li><li value="12" class="calibre_7"><a href="#calibre_link-266"><span class="calibre_4"> 9.13 Problems with Manual and Boot-Activated Network Configuration</span></a></li><li value="13" class="calibre_7"><a href="#calibre_link-267"><span class="calibre_4"> 9.14 Network Configuration Managers</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-268"><span class="calibre_4">9.14.1 NetworkManager Operation</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-269"><span class="calibre_4">9.14.2 NetworkManager Interaction</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-270"><span class="calibre_4">9.14.3 NetworkManager Configuration</span></a></li></ol></li><li value="14" class="calibre_8"><a href="#calibre_link-271"><span class="calibre_4"> 9.15 Resolving Hostnames</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-272"><span class="calibre_4">9.15.1 /etc/hosts</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-273"><span class="calibre_4">9.15.2 resolv.conf</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-274"><span class="calibre_4">9.15.3 Caching and Zero-Configuration DNS</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-275"><span class="calibre_4">9.15.4 /etc/nsswitch.conf</span></a></li></ol></li><li value="15" class="calibre_8"><a href="#calibre_link-276"><span class="calibre_4"> 9.16 Localhost</span></a></li><li value="16" class="calibre_7"><a href="#calibre_link-277"><span class="calibre_4"> 9.17 The Transport Layer: TCP, UDP, and Services</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-278"><span class="calibre_4">9.17.1 TCP Ports and Connections</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-279"><span class="calibre_4">9.17.2 UDP</span></a></li></ol></li><li value="17" class="calibre_8"><a href="#calibre_link-280"><span class="calibre_4"> 9.18 Revisiting a Simple Local Network</span></a></li><li value="18" class="calibre_7"><a href="#calibre_link-281"><span class="calibre_4"> 9.19 Understanding DHCP</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-282"><span class="calibre_4">9.19.1 Linux DHCP Clients</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-283"><span class="calibre_4">9.19.2 Linux DHCP Servers</span></a></li></ol></li><li value="19" class="calibre_8"><a href="#calibre_link-284"><span class="calibre_4"> 9.20 Automatic IPv6 Network Configuration</span></a></li><li value="20" class="calibre_7"><a href="#calibre_link-285"><span class="calibre_4"> 9.21 Configuring Linux as a Router</span></a></li><li value="21" class="calibre_7"><a href="#calibre_link-286"><span class="calibre_4"> 9.22 Private Networks (IPv4)</span></a></li><li value="22" class="calibre_7"><a href="#calibre_link-287"><span class="calibre_4"> 9.23 Network Address Translation (IP Masquerading)</span></a></li><li value="23" class="calibre_7"><a href="#calibre_link-288"><span class="calibre_4"> 9.24 Routers and Linux</span></a></li><li value="24" class="calibre_7"><a href="#calibre_link-289"><span class="calibre_4"> 9.25 Firewalls</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-290"><span class="calibre_4">9.25.1 Linux Firewall Basics</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-291"><span class="calibre_4">9.25.2 Setting Firewall Rules</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-292"><span class="calibre_4">9.25.3 Firewall Strategies</span></a></li></ol></li><li value="25" class="calibre_8"><a href="#calibre_link-293"><span class="calibre_4"> 9.26 Ethernet, IP, ARP, and NDP</span></a></li><li value="26" class="calibre_7"><a href="#calibre_link-294"><span class="calibre_4"> 9.27 Wireless Ethernet</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-295"><span class="calibre_4">9.27.1 iw</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-296"><span class="calibre_4">9.27.2 Wireless Security</span></a></li></ol></li><li value="27" class="calibre_8"><a href="#calibre_link-297"><span class="calibre_4"> 9.28 Summary</span></a></li></ol></li><li value="16" class="calibre_3"><a href="#calibre_link-298"><span class="bold"><span class="calibre_4">CHAPTER 10: NETWORK APPLICATIONS AND SERVICES</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-299"><span class="calibre_4"> 10.1 The Basics of Services</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-300"><span class="calibre_4"> 10.2 A Closer Look</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-301"><span class="calibre_4"> 10.3 Network Servers</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-302"><span class="calibre_4">10.3.1  Secure Shell</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-303"><span class="calibre_4">10.3.2  The sshd Server</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-304"><span class="calibre_4">10.3.3  fail2ban</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-305"><span class="calibre_4">10.3.4  The SSH Client</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-306"><span class="calibre_4"> 10.4 Pre-systemd Network Connection Servers: inetd/xinetd</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-307"><span class="calibre_4"> 10.5 Diagnostic Tools</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-308"><span class="calibre_4">10.5.1  lsof</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-309"><span class="calibre_4">10.5.2  tcpdump</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-310"><span class="calibre_4">10.5.3  netcat</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-311"><span class="calibre_4">10.5.4  Port Scanning</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-312"><span class="calibre_4"> 10.6 Remote Procedure Calls</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-313"><span class="calibre_4"> 10.7 Network Security</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-314"><span class="calibre_4">10.7.1  Typical Vulnerabilities</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-315"><span class="calibre_4">10.7.2  Security Resources</span></a></li></ol></li><li value="8" class="calibre_8"><a href="#calibre_link-316"><span class="calibre_4"> 10.8 Looking Forward</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-317"><span class="calibre_4"> 10.9 Network Sockets</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-318"><span class="calibre_4"> 10.10 Unix Domain Sockets</span></a></li></ol></li><li value="17" class="calibre_3"><a href="#calibre_link-319"><span class="bold"><span class="calibre_4">CHAPTER 11: INTRODUCTION TO SHELL SCRIPTS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-320"><span class="calibre_4"> 11.1 Shell Script Basics</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-321"><span class="calibre_4">11.1.1 Limitations of Shell Scripts</span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-322"><span class="calibre_4"> 11.2 Quoting and Literals</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-323"><span class="calibre_4">11.2.1 Literals</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-324"><span class="calibre_4">11.2.2 Single Quotes</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-325"><span class="calibre_4">11.2.3 Double Quotes</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-326"><span class="calibre_4">11.2.4 Literal Single Quotes</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-327"><span class="calibre_4"> 11.3 Special Variables</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-328"><span class="calibre_4">11.3.1 Individual Arguments: $1, $2, and So On</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-329"><span class="calibre_4">11.3.2 Number of Arguments: $#</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-330"><span class="calibre_4">11.3.3 All Arguments: $@</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-331"><span class="calibre_4">11.3.4 Script Name: $0</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-332"><span class="calibre_4">11.3.5 Process ID: $$</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-333"><span class="calibre_4">11.3.6 Exit Code: $?</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-334"><span class="calibre_4"> 11.4 Exit Codes</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-335"><span class="calibre_4"> 11.5 Conditionals</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-336"><span class="calibre_4">11.5.1 A Workaround for Empty Parameter Lists</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-337"><span class="calibre_4">11.5.2 Other Commands for Tests</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-338"><span class="calibre_4">11.5.3 elif</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-339"><span class="calibre_4">11.5.4 Logical Constructs</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-340"><span class="calibre_4">11.5.5 Testing Conditions</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-341"><span class="calibre_4">11.5.6 case</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-342"><span class="calibre_4"> 11.6 Loops</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-343"><span class="calibre_4">11.6.1 for Loops</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-344"><span class="calibre_4">11.6.2 while Loops</span></a></li></ol></li><li value="7" class="calibre_8"><a href="#calibre_link-345"><span class="calibre_4"> 11.7 Command Substitution</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-346"><span class="calibre_4"> 11.8 Temporary File Management</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-347"><span class="calibre_4"> 11.9 Here Documents</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-348"><span class="calibre_4"> 11.10 Important Shell Script Utilities</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-349"><span class="calibre_4">11.10.1  basename</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-350"><span class="calibre_4">11.10.2  awk</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-351"><span class="calibre_4">11.10.3  sed</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-352"><span class="calibre_4">11.10.4  xargs</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-353"><span class="calibre_4">11.10.5  expr</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-354"><span class="calibre_4">11.10.6  exec</span></a></li></ol></li><li value="11" class="calibre_8"><a href="#calibre_link-355"><span class="calibre_4"> 11.11 Subshells</span></a></li><li value="12" class="calibre_7"><a href="#calibre_link-356"><span class="calibre_4"> 11.12 Including Other Files in Scripts</span></a></li><li value="13" class="calibre_7"><a href="#calibre_link-357"><span class="calibre_4"> 11.13 Reading User Input</span></a></li><li value="14" class="calibre_7"><a href="#calibre_link-358"><span class="calibre_4"> 11.14 When (Not) to Use Shell Scripts</span></a></li></ol></li><li value="18" class="calibre_3"><a href="#calibre_link-359"><span class="bold"><span class="calibre_4">CHAPTER 12: NETWORK FILE TRANSFER AND SHARING</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-360"><span class="calibre_4"> 12.1 Quick Copy</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-361"><span class="calibre_4"> 12.2 rsync</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-362"><span class="calibre_4">12.2.1  Getting Started with rsync</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-363"><span class="calibre_4">12.2.2  Making Exact Copies of a Directory Structure</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-364"><span class="calibre_4">12.2.3  Using the Trailing Slash</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-365"><span class="calibre_4">12.2.4  Excluding Files and Directories</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-366"><span class="calibre_4">12.2.5  Checking Transfers, Adding Safeguards, and Using Verbose Mode</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-367"><span class="calibre_4">12.2.6  Compressing Data</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-368"><span class="calibre_4">12.2.7  Limiting Bandwidth</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-369"><span class="calibre_4">12.2.8  Transferring Files to Your Computer</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-370"><span class="calibre_4">12.2.9  Further rsync Topics</span></a></li><li value="10" class="calibre_7"><a href="#calibre_link-371"><span class="calibre_4">12.3.1  File Sharing Usage and Performance</span></a></li><li value="11" class="calibre_7"><a href="#calibre_link-372"><span class="calibre_4">12.3.2  File Sharing Security</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-373"><span class="calibre_4"> 12.4 Sharing Files with Samba</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-374"><span class="calibre_4">12.4.1  Server Configuration</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-375"><span class="calibre_4">12.4.2  Server Access Control</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-376"><span class="calibre_4">12.4.3  Passwords</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-377"><span class="calibre_4">12.4.4  Manual Server Startup</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-378"><span class="calibre_4">12.4.5  Diagnostics and Logfiles</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-379"><span class="calibre_4">12.4.6  File Share Configuration</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-380"><span class="calibre_4">12.4.7  Home Directories</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-381"><span class="calibre_4">12.4.8  Printer Sharing</span></a></li><li value="9" class="calibre_7"><a href="#calibre_link-382"><span class="calibre_4">12.4.9  The Samba Client</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-383"><span class="calibre_4"> 12.5 SSHFS</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-384"><span class="calibre_4"> 12.6 NFS</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-385"><span class="calibre_4"> 12.7 Cloud Storage</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-386"><span class="calibre_4"> 12.8 The State of Network File Sharing</span></a></li></ol></li><li value="19" class="calibre_3"><a href="#calibre_link-387"><span class="bold"><span class="calibre_4">CHAPTER 13: USER ENVIRONMENTS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-388"><span class="calibre_4"> 13.1 Guidelines for Creating Startup Files</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-389"><span class="calibre_4"> 13.2 When to Alter Startup Files</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-390"><span class="calibre_4"> 13.3 Shell Startup File Elements</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-391"><span class="calibre_4">13.3.1  The Command Path</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-392"><span class="calibre_4">13.3.2  The Manual Page Path</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-393"><span class="calibre_4">13.3.3  The Prompt</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-394"><span class="calibre_4">13.3.4  Aliases</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-395"><span class="calibre_4">13.3.5  The Permissions Mask</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-396"><span class="calibre_4"> 13.4 Startup File Order and Examples</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-397"><span class="calibre_4">13.4.1  The bash Shell</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-398"><span class="calibre_4">13.4.2  The tcsh Shell</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-399"><span class="calibre_4"> 13.5 Default User Settings</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-400"><span class="calibre_4">13.5.1  Shell Defaults</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-401"><span class="calibre_4">13.5.2  Editor</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-402"><span class="calibre_4">13.5.3  Pager</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-403"><span class="calibre_4"> 13.6 Startup File Pitfalls</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-404"><span class="calibre_4"> 13.7 Further Startup Topics</span></a></li></ol></li><li value="20" class="calibre_3"><a href="#calibre_link-405"><span class="bold"><span class="calibre_4">CHAPTER 14: A BRIEF SURVEY OF THE LINUX DESKTOP AND PRINTING</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-406"><span class="calibre_4"> 14.1 Desktop Components</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-407"><span class="calibre_4">14.1.1  Framebuffers</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-408"><span class="calibre_4">14.1.2  The X Window System</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-409"><span class="calibre_4">14.1.3  Wayland</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-410"><span class="calibre_4">14.1.4  Window Managers</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-411"><span class="calibre_4">14.1.5  Toolkits</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-412"><span class="calibre_4">14.1.6  Desktop Environments</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-413"><span class="calibre_4">14.1.7  Applications</span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-414"><span class="calibre_4"> 14.2 Are You Running Wayland or X?</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-415"><span class="calibre_4"> 14.3 A Closer Look at Wayland</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-416"><span class="calibre_4">14.3.1  The Compositing Window Manager</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-417"><span class="calibre_4">14.3.2  libinput</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-418"><span class="calibre_4">14.3.3  X Compatibility in Wayland</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-419"><span class="calibre_4"> 14.4 A Closer Look at the X Window System</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-420"><span class="calibre_4">14.4.1  Display Managers</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-421"><span class="calibre_4">14.4.2  Network Transparency</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-422"><span class="calibre_4">14.4.3 Ways of Exploring X Clients</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-423"><span class="calibre_4">14.4.4  X Events</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-424"><span class="calibre_4">14.4.5  X Input and Preference Settings</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-425"><span class="calibre_4"> 14.5 D-Bus</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-426"><span class="calibre_4">14.5.1  System and Session Instances</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-427"><span class="calibre_4">14.5.2  D-Bus Message Monitoring</span></a></li></ol></li><li value="6" class="calibre_8"><a href="#calibre_link-428"><span class="calibre_4"> 14.6 Printing</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-429"><span class="calibre_4">14.6.1  CUPS</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-430"><span class="calibre_4">14.6.2  Format Conversion and Print Filters</span></a></li></ol></li><li value="7" class="calibre_8"><a href="#calibre_link-431"><span class="calibre_4"> 14.7 Other Desktop Topics</span></a></li></ol></li><li value="21" class="calibre_3"><a href="#calibre_link-432"><span class="bold"><span class="calibre_4">CHAPTER 15: DEVELOPMENT TOOLS</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-433"><span class="calibre_4"> 15.1 The C Compiler</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-434"><span class="calibre_4">15.1.1  Compiling Multiple Source Files</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-435"><span class="calibre_4">15.1.2  Linking with Libraries</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-436"><span class="calibre_4">15.1.3 Working with Shared Libraries</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-437"><span class="calibre_4">15.1.4  Working with Header (Include) Files and Directories</span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-438"><span class="calibre_4"> 15.2 make</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-439"><span class="calibre_4">15.2.1  A Sample Makefile </span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-440"><span class="calibre_4">15.2.2  Built-in Rules</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-441"><span class="calibre_4">15.2.3  Final Program Build </span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-442"><span class="calibre_4">15.2.4  Dependency Updates</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-443"><span class="calibre_4">15.2.5  Command-Line Arguments and Options</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-444"><span class="calibre_4">15.2.6  Standard Macros and Variables</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-445"><span class="calibre_4">15.2.7  Conventional Targets</span></a></li><li value="8" class="calibre_7"><a href="#calibre_link-446"><span class="calibre_4">15.2.8  Makefile Organization</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-447"><span class="calibre_4"> 15.3 Lex and Yacc</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-448"><span class="calibre_4"> 15.4 Scripting Languages</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-449"><span class="calibre_4">15.4.1  Python</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-450"><span class="calibre_4">15.4.2  Perl</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-451"><span class="calibre_4">15.4.3  Other Scripting Languages</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-452"><span class="calibre_4"> 15.5 Java</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-453"><span class="calibre_4"> 15.6 Looking Forward: Compiling Packages</span></a></li></ol></li><li value="22" class="calibre_3"><a href="#calibre_link-454"><span class="bold"><span class="calibre_4">CHAPTER 16: INTRODUCTION TO COMPILING SOFTWARE FROM C SOURCE CODE</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-455"><span class="calibre_4"> 16.1 Software Build Systems</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-456"><span class="calibre_4"> 16.2 Unpacking C Source Packages</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-457"><span class="calibre_4"> 16.3 GNU Autoconf</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-458"><span class="calibre_4">16.3.1  An Autoconf Example</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-459"><span class="calibre_4">16.3.2  Installation Using a Packaging Tool</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-460"><span class="calibre_4">16.3.3  configure Script Options</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-461"><span class="calibre_4">16.3.4  Environment Variables</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-462"><span class="calibre_4">16.3.5  Autoconf Targets</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-463"><span class="calibre_4">16.3.6  Autoconf Logfiles</span></a></li><li value="7" class="calibre_7"><a href="#calibre_link-464"><span class="calibre_4">16.3.7  pkg-config</span></a></li></ol></li><li value="4" class="calibre_8"><a href="#calibre_link-465"><span class="calibre_4"> 16.4 Installation Practice</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-466"><span class="calibre_4">16.4.1  Where to Install</span></a></li></ol></li><li value="5" class="calibre_8"><a href="#calibre_link-467"><span class="calibre_4"> 16.5 Applying a Patch</span></a></li><li value="6" class="calibre_7"><a href="#calibre_link-468"><span class="calibre_4"> 16.6 Troubleshooting Compiles and Installations</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-469"><span class="calibre_4">16.6.1  Specific Errors</span></a></li></ol></li><li value="7" class="calibre_8"><a href="#calibre_link-470"><span class="calibre_4"> 16.7 Looking Forward</span></a></li></ol></li><li value="23" class="calibre_3"><a href="#calibre_link-471"><span class="bold"><span class="calibre_4">CHAPTER 17: VIRTUALIZATION</span></span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-472"><span class="calibre_4"> 17.1 Virtual Machines</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-473"><span class="calibre_4">17.1.1  Hypervisors</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-474"><span class="calibre_4">17.1.2  Hardware in a Virtual Machine</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-475"><span class="calibre_4">17.1.3  Common Uses of Virtual Machines</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-476"><span class="calibre_4">17.1.4  Drawbacks of Virtual Machines</span></a></li></ol></li><li value="2" class="calibre_8"><a href="#calibre_link-477"><span class="calibre_4"> 17.2 Containers</span></a>
<div class="calibre_5">&nbsp;</div><ol class="calibre_6"><li value="1" class="calibre_7"><a href="#calibre_link-478"><span class="calibre_4">17.2.1  Docker, Podman, and Privileges</span></a></li><li value="2" class="calibre_7"><a href="#calibre_link-479"><span class="calibre_4">17.2.2  A Docker Example</span></a></li><li value="3" class="calibre_7"><a href="#calibre_link-480"><span class="calibre_4">17.2.3  LXC</span></a></li><li value="4" class="calibre_7"><a href="#calibre_link-481"><span class="calibre_4">17.2.4  Kubernetes</span></a></li><li value="5" class="calibre_7"><a href="#calibre_link-482"><span class="calibre_4">17.2.5  Pitfalls of Containers</span></a></li></ol></li><li value="3" class="calibre_8"><a href="#calibre_link-483"><span class="calibre_4"> 17.3 Runtime-Based Virtualization</span></a></li></ol></li><li value="24" class="calibre_3"><a href="#calibre_link-484"><span class="bold"><span class="calibre_4">INDEX</span></span></a></li></ol><p class="calibre_9">
<a></a>
</p><div class="mbp_pagebreak"></div><p id="calibre_link-1" class="calibre_10"><span class="calibre1"><span class="bold">Reviews for </span></span><span class="calibre1"><span class="italic"><span class="bold">How Linux Works</span></span></span></p><blockquote class="calibre_11"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><span class="calibre3"><span class="calibre_13">“If you are interested in Linux, </span></span><span class="calibre3"><span class="italic">How Linux Works: What Every Superuser Should Know</span></span><span class="calibre3"><span class="calibre_13"> is a must-read title.”</span></span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_14"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_15"><span class="calibre3">&mdash;</span><span class="calibre3"><span class="calibre_13">L</span></span><span class="calibre3">INUX</span><span class="calibre3"><span class="calibre_13">I</span></span><span class="calibre3">NSIDER</span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_16"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><span class="calibre3"><span class="calibre_13">“Lots to offer on almost every aspect of the Linux architecture.”</span></span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_14"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_15"><span class="calibre3">&mdash;</span><span class="calibre3"><span class="calibre_13">E</span></span><span class="calibre3">VERYDAY </span><span class="calibre3"><span class="calibre_13">L</span></span><span class="calibre3">INUX </span><span class="calibre3"><span class="calibre_13">U</span></span><span class="calibre3">SER</span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_16"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><span class="calibre3"><span class="calibre_13">“You’ll get an essential understanding of what’s going on under the hood without getting bogged down in minutiae&mdash;making this a very refreshing (and wholly recommended) addition to the Linux literature.”</span></span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_14"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_15"><span class="calibre3">&mdash;</span><span class="calibre3"><span class="calibre_13">P</span></span><span class="calibre3">HIL </span><span class="calibre3"><span class="calibre_13">B</span></span><span class="calibre3">ULL, CO-AUTHOR OF </span><span class="calibre3"><span class="italic">U</span></span><span class="calibre3"><span class="italic">BUNTU </span></span><span class="calibre3"><span class="italic">M</span></span><span class="calibre3"><span class="italic">ADE </span></span><span class="calibre3"><span class="italic">E</span></span><span class="calibre3"><span class="italic">ASY</span></span><span class="calibre3"> AND MEMBER OF THE </span><span class="calibre3"><span class="calibre_13">U</span></span><span class="calibre3">BUNTU DOCUMENTATION TEAM</span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_16"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><span class="calibre3"><span class="calibre_13">“Dives straight into the transparent depths of Linux-based operating systems and shows us how all the pieces fit together.”</span></span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_14"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_15"><span class="calibre3">&mdash;</span><span class="calibre3"><span class="calibre_13">D</span></span><span class="calibre3">ISTRO</span><span class="calibre3"><span class="calibre_13">W</span></span><span class="calibre3">ATCH</span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_16"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><span class="calibre3"><span class="calibre_13">“Earns its place on the shelf as an essential reference.”</span></span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre_14"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_15"><span class="calibre3">&mdash;</span><span class="calibre3"><span class="italic">T</span></span><span class="calibre3"><span class="italic">HE </span></span><span class="calibre3"><span class="italic">M</span></span><span class="calibre3"><span class="italic">AG</span></span><span class="calibre3"><span class="italic">P</span></span><span class="calibre3"><span class="italic">I</span></span><span class="calibre3"> MAGAZINE</span></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-2" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_18"><span class="calibre4"><span class="bold">HOW LINUX WORKS</span></span></p><p class="calibre_"><span class="calibre1"><span class="bold"><span class="calibre_13">3rd Edition</span></span></span></p><div class="mbp_pagebreak"></div><p class="calibre_19"><span class="calibre5"><span class="bold">What Every Superuser Should Know</span></span></p><p class="calibre_19"><span class="calibre6"><span class="bold"><span class="calibre_13">by Brian Ward</span></span></span></p><p class="calibre_10"><img src="images/000000.jpg" class="calibre_20" /><span class="calibre3">
</span></p><p class="calibre_21"><span class="calibre_13">San Francisco</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-3" class="calibre_22"><span class="calibre3"><span class="bold">How Linux Works, 3rd Edition.</span></span><span class="calibre3"><span class="calibre_13"> Copyright © 2021 by Brian Ward.</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">All rights reserved. No part of this work may be reproduced or transmitted in any form or by any means, electronic or mechanical, including photocopying, recording, or by any information storage or retrieval system, without the prior written permission of the copyright owner and the publisher.</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">Second printing </span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> 24 23 22 21 2 3 4 5 6 7 8 9</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">ISBN-13: 978-1-7185-0040-2 (print)</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">ISBN-13: 978-1-7185-0041-9 (ebook)</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">Publisher: William Pollock</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Executive Editor: Barbara Yien</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Production Editor: Rachel Monaghan</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Developmental Editors: Larry Wake and Jill Franklin</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Cover and Interior Design: Octopod Studios</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Technical Reviewers: Jordi Gutiérrez Hermoso and Petros Koutoupis</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Copyeditor: Rachel Monaghan</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Compositor: Cody Gates, Happenstance Type-O-Rama</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">Proofreader: James M. Fraleigh</span></span><br class="calibre7" /></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">For information on book distributors or translations, please contact No Starch Press, Inc. directly:</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">No Starch Press, Inc.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">245 8th Street, San Francisco, CA 94103</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13">phone: 1-415-863-9900; </span></span><a href="mailto:info@nostarch.com"><span class="calibre3"><span class="italic"><span class="calibre_4">info@nostarch.com</span></span></span></a><br class="calibre7" /><a href="http://www.nostarch.com"><span class="calibre3"><span class="italic"><span class="calibre_4">www.nostarch.com</span></span></span></a></p><p class="calibre_9"><span class="calibre3"><span class="italic">The Library of Congress has catalogued the first edition as follows:</span></span></p><p class="calibre_9"><span class="calibre3"><span class="calibre_13">Ward, Brian.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;How Linux works : what every superuser should know / Brian Ward.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p. cm.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;Includes index.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;ISBN 1-59327-035-6</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;1. Linux. 2. Operating systems (Computers). I. Title.</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;&nbsp;QA76.76.O63 W3654 2004</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;&nbsp;&nbsp;005.4’32--dc22</span></span><br class="calibre7" /><span class="calibre3"><span class="calibre_13"> &nbsp;2004002692</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">No Starch Press and the No Starch Press logo are registered trademarks of No Starch Press, Inc. Other product and company names mentioned herein may be the trademarks of their respective owners. Rather than use a trademark symbol with every occurrence of a trademarked name, we are using the names only in an editorial fashion and to the benefit of the trademark owner, with no intention of infringement of the trademark.</span></span></p><p class="calibre_22"><span class="calibre3"><span class="calibre_13">The information in this book is distributed on an “As Is” basis, without warranty. While every precaution has been taken in the preparation of this work, neither the author nor No Starch Press, Inc. shall have any liability to any person or entity with respect to any loss or damage caused or alleged to be caused directly or indirectly by the information contained in it.</span></span></p><div class="mbp_pagebreak"></div><p id="calibre_link-4" class="calibre_23"><span class="calibre1"><span class="bold">About the Author</span></span></p><p class="calibre_24"><span class="bold">Brian Ward</span><span class="calibre_13"> has been working with Linux since 1993. He is also the author of </span><span class="italic">The Linux Kernel HOWTO</span><span class="calibre_13">, </span><span class="italic">The Book of VMware</span><span class="calibre_13"> (No Starch Press), and </span><span class="italic">The Linux Problem Solver </span><span class="calibre_13">(No Starch Press).</span></p><div class="mbp_pagebreak"></div><p class="calibre_23"><span class="calibre1"><span class="bold">About the Technical Reviewers</span></span></p><p class="calibre_24"><span class="bold">Jordi Gutiérrez Hermoso</span><span class="calibre_13"> is a GNU/Linux user and developer with almost two decades of experience, with occasional contributions in various circles of the free software communities, such as GNU Octave and Mercurial. His professional work has allowed him to collaborate with and learn about diverse topics such as digital cryptographic signatures, medical imaging, and most recently greenhouse gas accounting and ecological map data, all built entirely with Linux and other free software. When he is not near a computer he enjoys swimming, mathematics, and knitting.</span></p><p class="calibre_25"><span class="bold">Petros Koutoupis</span><span class="calibre_13"> is currently a senior performance software engineer at HPE (formerly Cray Inc.) for its Lustre High Performance File System division. He is also the creator and maintainer of the RapidDisk Project (</span><a href="http://www.rapiddisk.org"><span class="italic"><span class="calibre_4">www.rapiddisk.org</span></span></a><span class="calibre_13">). Petros has worked in the data storage industry for well over a decade and has helped pioneer the many technologies unleashed in the wild today.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-5" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_"><span class="calibre1"><span class="bold">ACKNOWLEDGMENTS</span></span></p><p class="calibre_26"><span class="calibre_13">Contributions to this book come from not just those who were involved in the development process, but also those without whom I wouldn’t know anything about Linux. These include James Duncan, Douglas N. Arnold, Bill Fenner, Ken Hornstein, Scott Dickson, Dan Ehrlich, Felix Lee, and Gregory P. Smith. Previous editions included help from Karol Jurado, Laurel Chun, Serena Yang, Alison Law, Ri-ley Hoffman, Scott Schwartz, Dan Sully, Dominique Poulain, Donald Karon, and Gina Steele.</span></p><p class="calibre_27"><span class="calibre_13">This third edition benefits from the excellent work of Barbara Yien, Rachel Monaghan, Jill Franklin, Larry Wake, Jordi Gutiérrez Hermoso, and Petros Koutoupis. As the publisher of No Starch Press, Bill Pollock has been instrumental in this book since the first edition. And once more, Hsinju Hsieh has put up with me for another revi-sion.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-6" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_"><span class="calibre1"><span class="bold">PREFACE</span></span></p><p class="calibre_26"><span class="calibre_13">Your system shouldn’t be a mystery. You should be able to make your software do what you want it to do without “magic” incantations or rituals. The key to attaining this power lies in understanding the fundamentals of what the software does and how it works, and that’s what this book is all about. You should never have to fight with a computer.</span></p><p class="calibre_27"><span class="calibre_13">Linux is a great platform for learning because it doesn’t try to hide anything from you. In particular, you can find most system configuration details in easy-to-read plaintext files. The only tricky part is figuring out which parts are responsible for what and how they all fit together.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-7" class="calibre_23"><span class="calibre1"><span class="bold">Who Should Read This Book?</span></span></p><p class="calibre_24"><span class="calibre_13">Your interest in learning how Linux works may have come from any number of sources. In the professional realm, operations and DevOps folks need to know nearly everything that you’ll find in this book. Linux software architects and developers should also know this material in order to make the best use of the operating system. Researchers and students, often running their own Linux systems, will also find that this book provides useful explanations for </span><span class="italic">why</span><span class="calibre_13"> things are set up the way they are.</span></p><p class="calibre_27"><span class="calibre_13">Then there are the tinkerers&mdash;people who just love to play around with their computers for fun, profit, or both. Want to know why certain things work while others don’t? Want to know what happens if you move something around? You’re probably a tinkerer.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-8" class="calibre_23"><span class="calibre1"><span class="bold">Prerequisites</span></span></p><p class="calibre_24"><span class="calibre_13">Although Linux is beloved by programmers, you don’t need to be a programmer to read this book; you need only basic computer-user knowledge. That is, you should be able to bumble around a GUI (especially the installer and settings interface for a Linux distribution) and know what files and directories (folders) are. You should also be prepared to check additional documentation on your system and on the web. The most important thing you need is to be ready and willing to play around with your computer.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-9" class="calibre_23"><span class="calibre1"><span class="bold">How to Read This Book</span></span></p><p class="calibre_24"><span class="calibre_13">Building the requisite knowledge is a challenge in tackling any technical subject. Explaining how software systems work can get </span><span class="italic">really</span><span class="calibre_13"> complicated. Too much detail can bog down readers and make important concepts difficult to grasp (the human brain just can’t process so many new ideas at once), but too little detail can leave readers in the dark and unprepared for later material.</span></p><p class="calibre_27"><span class="calibre_13">I’ve designed most chapters to tackle the most important material first: the basic information that you’ll need in order to progress. In places, I’ve simplified things in order to keep focus. As a chapter progresses, you’ll see much more detail, especially in the last few sections. Do you need to know those bits right away? In most cases, no; I note this where applicable. If your eyes start to glaze over when you’re faced with a lot of extra details about concepts you just learned, don’t hesitate to skip ahead to the next chapter or take a break. The nitty-gritty will still be there waiting for you.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-10" class="calibre_23"><span class="calibre1"><span class="bold">A Hands-on Approach</span></span></p><p class="calibre_24"><span class="calibre_13">However you choose to proceed through this book, you should have a Linux machine in front of you, preferably one that you’re confident abusing with experiments. You might prefer to play around with a virtual installation&mdash;I used VirtualBox to test much of the material in this book. You also should have superuser (root) access, but try to use a regular user account most of the time. You’ll mostly work at the command line, in a terminal window or a remote session. If you haven’t worked much in that environment, no problem; </span>Chapter 2<span class="calibre_13"> will bring you up to speed.</span></p><p class="calibre_27"><span class="calibre_13">Commands in this book typically look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls /</span></span><span class="calibre3"><br class="calibre7" />[some output]</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Enter the text in bold; the nonbolded text that follows is what the machine spits back. The </span><span class="calibre3">$</span><span class="calibre_13"> is the prompt for a regular user account. If you see a </span><span class="calibre3">#</span><span class="calibre_13"> as a prompt, you need to be superuser. (More on that in </span>Chapter 2<span class="calibre_13">.)</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-11" class="calibre_23"><span class="calibre1"><span class="bold">How This Book Is Organized</span></span></p><p class="calibre_24"><span class="calibre_13">I’ve grouped the book’s chapters into three basic parts. The first is introductory, giving a bird’s-eye view of the system and then offering hands-on experience with some tools you’ll need for as long as you run Linux. Next, you’ll explore each part of the system in more detail, from device management to network configuration, following the general order in which the system starts. Finally, you’ll get a tour of some pieces of a running system, learn some essential skills, and get some insight into the tools that programmers use.</span></p><p class="calibre_27"><span class="calibre_13"> With the exception of </span>Chapter 2<span class="calibre_13">, most of the early chapters heavily involve the Linux kernel, but you’ll work your way into user space as the book progresses. (If you don’t know what I’m talking about here, don’t worry; I’ll explain in </span>Chapter 1<span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13">The material is meant to be as distribution-agnostic as possible. Having said this, it can be tedious to cover all variations in systems software, so I’ve tried to cover the two major distribution families: Debian (including Ubuntu) and RHEL/Fedora/CentOS. I’ve also focused on desktop and server installations. A significant amount of material carries over into embedded systems, such as Android and OpenWRT, but it’s up to you to discover the differences on those platforms.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-12" class="calibre_23"><span class="calibre1"><span class="bold">What’s New in the Third Edition?</span></span></p><p class="calibre_24"><span class="calibre_13">The second edition was published during a time of transition for Linux systems. Several traditional components were in the process of being replaced, which made handling some subjects tricky, because readers could encounter a wide variety of configurations. Now, however, those new pieces (systemd in particular) have near-universal adoption, so I’ve been able to streamline a fair amount of the discussion.</span></p><p class="calibre_27"><span class="calibre_13">I’ve retained the emphasis on the kernel’s role in a Linux system. This material has proven popular, and you probably interact with the kernel more than you realize.</span></p><p class="calibre_27"><span class="calibre_13">I’ve added a new chapter introducing virtualization. Although Linux has always been popular on virtual machines (such as cloud services), that type of virtualization lies outside the scope of this book, because the way the system operates on a virtual machine is almost the same as on “bare metal” hardware. So, the discussion here primarily focuses on deciphering the terminology you’ll encounter. However, containers have gained in popularity since the second edition was published, and they also fit here, because they basically consist of a bunch of Linux features like the ones described throughout the rest of the book. Containers make heavy use of cgroups, which also get new treatment in this third edition.</span></p><p class="calibre_27"><span class="calibre_13">Other subjects (not necessarily related to containers) I happily expanded on are the Logical Volume Manager, the journald logging system, and IPv6 in the networking material.</span></p><p class="calibre_27"><span class="calibre_13">Though I’ve added a significant amount of content, the book is still a reasonable size. I want to provide the information you need to get on the fast track, and that includes explaining certain details along the way that can be hard to grasp, but I don’t want you to have to become a weightlifter in order to pick up this book. Once you master the important subjects here, you should have no trouble seeking out and understanding more details.</span></p><p class="calibre_27"><span class="calibre_13"> The first edition included historical information that I removed later to improve focus. If you’re interested in Linux and how it relates to the history of Unix, pick up Peter H. Salus’s </span><span class="italic">The Daemon, the Gnu, and the Penguin</span><span class="calibre_13"> (Reed Media Services, 2008). It does a great job of explaining how the software we use has evolved over time.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-13" class="calibre_23"><span class="calibre1"><span class="bold">A Note on Terminology</span></span></p><p class="calibre_24"><span class="calibre_13">The names of certain operating system elements have caused a fair amount of debate historically&mdash;even the word </span><span class="italic">Linux</span><span class="calibre_13"> itself. Should it be “Linux,” or should it be “GNU/Linux” to reflect that the operating system also contains pieces from the GNU Project? Throughout this book, I’ve tried to use the most common, least awkward names possible.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-14" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-556" class="calibre_10"><span class="calibre4"><span class="bold">1</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">THE BIG PICTURE</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">At first glance, a contemporary operating system such as Linux is very complicated, with a dizzying number of pieces simultaneously running and communicating. For example, a web server can talk to a database server, which could in turn use a shared library that many other programs use. How does all of this manage to work, and how can you make sense of any of it?</span></span></p><p class="calibre_33"><span class="calibre_13"> The most effective way to understand how an operating system works is through </span><span class="italic">abstraction</span><span class="calibre_13">&mdash;a fancy way of saying that you can ignore most of the details that make up a piece that you’re trying to understand, and concentrate instead on its basic purpose and operation. For example, when you ride in a car, you normally don’t need to think about details such as the mounting bolts that hold the motor inside the car or the people who build and maintain the road upon which the car drives. All you really need to know is what the car does (transports you somewhere else) and a few basics about how to use it (how to operate the door and seat belt).</span></p><p id="calibre_link-557" class="calibre_27"><span class="calibre_13">This level of abstraction might work if you’re just a passenger in the car. But if you also need to drive it, you have to dig deeper and break up your abstraction into a few parts. You now expand your knowledge in three areas: the car itself (such as its size and capabilities), how to operate the controls (steering wheel, accelerator pedal, and so on), and the features of the road.</span></p><p class="calibre_27"><span class="calibre_13">Abstraction can be a great help when you’re trying to find and fix problems. For example, let’s say you’re driving a car and the ride is rough. You can quickly assess the three basic car-related abstractions just mentioned to determine the source of the problem. It should be fairly easy to eliminate the first two abstractions (your car or the way you’re driving) if neither is the issue, so you can narrow the problem down to the road itself. You’ll probably find that the road is bumpy. Now, if you want, you can dig deeper into your abstraction of the road and find out why the road has deteriorated or, if the road is new, why the construction workers did a lousy job.</span></p><p class="calibre_27"><span class="calibre_13"> Software developers use abstraction as a tool when building an operating system and its applications. There are many terms for an abstracted subdivision in computer software&mdash;including </span><span class="italic">subsystem</span><span class="calibre_13">, </span><span class="italic">module</span><span class="calibre_13">, and </span><span class="italic">package</span><span class="calibre_13">&mdash;but we’ll use the term </span><span class="italic">component</span><span class="calibre_13"> in this chapter because it’s simple. When building a software component, developers typically don’t think much about the internal structure of other components, but they do consider other components they can use (so that they don’t have to write any additional unnecessary software) and how to use them.</span></p><p class="calibre_27"><span class="calibre_13">This chapter provides a high-level overview of the components that make up a Linux system. Although each one has a tremendous number of technical details in its internal makeup, we’re going to ignore these details and concentrate on what the components do in relation to the whole system. We’ll look at the details in subsequent chapters.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-15" class="calibre_23"><span class="calibre1"><span class="bold"> 1.1 Levels and Layers of Abstraction in a Linux System</span></span></p><p class="calibre_24"><span class="calibre_13">Using abstraction to split computing systems into components makes things easier to understand, but it doesn’t work without organization. We arrange components into </span><span class="italic">layers</span><span class="calibre_13"> or </span><span class="italic">levels</span><span class="calibre_13">, classifications (or groupings) of components according to where the components sit between the user and the hardware. Web browsers, games, and such sit at the top layer; at the bottom layer we have the memory in the computer hardware&mdash;the 0s and 1s. The operating system occupies many of the layers in between.</span></p><p class="calibre_27"><span class="calibre_13"> A Linux system has three main levels. </span><a></a><a href="#calibre_link-485"><span class="italic"><span class="calibre_4">Figure 1-1</span></span></a><span class="calibre_13"> shows these levels and some of the components inside each level. The </span><span class="italic">hardware</span><span class="calibre_13"> is at the base. Hardware includes the memory as well as one or more central processing units (CPUs) to perform computation and to read from and write to memory. Devices such as disks and network interfaces are also part of the hardware.</span></p><p class="calibre_27"><span class="calibre_13"> The next level up is the </span><span class="italic">kernel</span><span class="calibre_13">, which is the core of the operating system. The kernel is software residing in memory that tells the CPU where to look for its next task. Acting as a mediator, the kernel manages the hardware (especially main memory) and is the primary interface between the hardware and any running program.</span></p><p id="calibre_link-814" class="calibre_27"><span class="italic">Processes</span><span class="calibre_13">&mdash;the running programs that the kernel manages&mdash;collectively make up the system’s upper level, called </span><span class="italic">user space</span><span class="calibre_13">. (A more specific term for process is </span><span class="italic">user process</span><span class="calibre_13">, regardless of whether a user directly interacts with the process. For example, all web servers run as user processes.)</span></p><p class="calibre_34"><img src="images/000025.jpg" class="calibre_35" />
</p><p id="calibre_link-485" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 1-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: General Linux system organization</span></span></span></p><p class="calibre_37"><span class="calibre_13"> There is a critical difference between how the kernel and the user processes run: the kernel runs in </span><span class="italic">kernel mode</span><span class="calibre_13">, and the user processes run in </span><span class="italic">user mode</span><span class="calibre_13">. Code running in kernel mode has unrestricted access to the processor and main memory. This is a powerful but dangerous privilege that allows the kernel to easily corrupt and crash the entire system. The memory area that only the kernel can access is called </span><span class="italic">kernel space</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> User mode, in comparison, restricts access to a (usually quite small) subset of memory and safe CPU operations. </span><span class="italic">User space</span><span class="calibre_13"> refers to the parts of main memory that the user processes can access. If a process makes a mistake and crashes, the consequences are limited and can be cleaned up by the kernel. This means that if your web browser crashes, it probably won’t take down the scientific computation that has been running in the background for days.</span></p><p class="calibre_27"><span class="calibre_13">In theory, a user process gone haywire can’t cause serious damage to the rest of the system. In reality, it depends on what you consider “serious damage,” as well as the particular privileges of the process, because some processes are allowed to do more than others. For example, can a user process completely wreck the data on a disk? With the correct permissions, yes&mdash;and you might consider this to be fairly dangerous. There are safeguards to prevent this, however, and most processes simply aren’t allowed to wreak havoc in this manner.</span></p><blockquote id="calibre_link-686" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The Linux kernel can run kernel threads, which look much like processes but have access to kernel space. Some examples are </span></span><span class="calibre3">kthreadd</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">kblockd</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-16" class="calibre_42"><span class="calibre1"><span class="bold"> 1.2 Hardware: Understanding Main Memory</span></span></p><p class="calibre_24"><span class="calibre_13">Of all of the hardware on a computer system, </span><span class="italic">main memory</span><span class="calibre_13"> is perhaps the most important. In its rawest form, main memory is just a big storage area for a bunch of 0s and 1s. Each slot for a 0 or 1 is called a </span><span class="italic">bit</span><span class="calibre_13">. This is where the running kernel and processes reside&mdash;they’re just big collections of bits. All input and output from peripheral devices flows through main memory, also as a bunch of bits. A CPU is just an operator on memory; it reads its instructions and data from the memory and writes data back out to the memory.</span></p><p class="calibre_27"><span class="calibre_13"> You’ll often hear the term </span><span class="italic">state</span><span class="calibre_13"> in reference to memory, processes, the kernel, and other parts of a computer system. Strictly speaking, a state is a particular arrangement of bits. For example, if you have four bits in your memory, 0110, 0001, and 1011 represent three different states.</span></p><p class="calibre_27"><span class="calibre_13">When you consider that a single process can easily consist of millions of bits in memory, it’s often easier to use abstract terms when talking about states. Instead of describing a state using bits, you describe what something has done or is doing at the moment. For example, you might say, “The process is waiting for input” or, “The process is performing Stage 2 of its startup.”</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Because it’s common to refer to the state in abstract terms rather than to the actual bits, the term </span></span>image<span class="italic"><span class="calibre_13"> refers to a particular physical arrangement of bits.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-17" class="calibre_42"><span class="calibre1"><span class="bold"> 1.3 The Kernel</span></span></p><p class="calibre_24"><span class="calibre_13">Why are we talking about main memory and states? Nearly everything that the kernel does revolves around main memory. One of the kernel’s tasks is to split memory into many subdivisions, and it must maintain certain state information about those subdivisions at all times. Each process gets its own share of memory, and the kernel must ensure that each process keeps to its share.</span></p><p class="calibre_27"><span class="calibre_13">The kernel is in charge of managing tasks in four general system areas:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Processes</span> The kernel is responsible for determining which processes are allowed to use the CPU.</li><li value="2" class="calibre_8"><span class="bold">Memory</span> The kernel needs to keep track of all memory&mdash;what is currently allocated to a particular process, what might be shared between processes, and what is free.</li><li value="3" class="calibre_8"><span class="bold">Device drivers</span> The kernel acts as an interface between hardware (such as a disk) and processes. It’s usually the kernel’s job to operate the hardware.</li><li value="4" class="calibre_8"><span class="bold">System calls and support</span> Processes normally use system calls to communicate with the kernel.</li></ol><p class="calibre_33"><span class="calibre_13">We’ll now briefly explore each of these areas.</span></p><blockquote id="calibre_link-644" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re interested in the detailed workings of a kernel, two good textbooks are </span></span>Operating System Concepts<span class="italic"><span class="calibre_13">, 10th edition, by Abraham Silberschatz, Peter B. Galvin, and Greg Gagne (Wiley, 2018), and </span></span>Modern Operating Systems<span class="italic"><span class="calibre_13">, 4th edition, by Andrew S. Tanenbaum and Herbert Bos (Prentice Hall, 2014).</span></span></blockquote><p id="calibre_link-18" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">1.3.1 Process Management</span></span></span></p><p class="calibre_45"><span class="italic">Process management</span><span class="calibre_13"> describes the starting, pausing, resuming, scheduling, and terminating of processes. The concepts behind starting and terminating processes are fairly straightforward, but describing how a process uses the CPU in its normal course of operation is a bit more complex.</span></p><p class="calibre_27"><span class="calibre_13"> On any modern operating system, many processes run “simultaneously.” For example, you might have a web browser and a spreadsheet open on a desktop computer at the same time. However, things are not as they appear: the processes behind these applications typically do not run at </span><span class="italic">exactly</span><span class="calibre_13"> the same time.</span></p><p class="calibre_27"><span class="calibre_13"> Consider a system with a one-core CPU. Many processes may be </span><span class="italic">able</span><span class="calibre_13"> to use the CPU, but only one process can actually use the CPU at any given time. In practice, each process uses the CPU for a small fraction of a second, then pauses; then another process uses the CPU for another small fraction of a second; then another process takes a turn, and so on. The act of one process giving up control of the CPU to another process is called a </span><span class="italic">context switch</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Each piece of time&mdash;called a </span><span class="italic">time slice</span><span class="calibre_13">&mdash;gives a process enough time for significant computation (and indeed, a process often finishes its current task during a single slice). However, because the slices are so small, humans can’t perceive them, and the system appears to be running multiple processes at the same time (a capability known as </span><span class="italic">multitasking</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13">The kernel is responsible for context switching. To understand how this works, let’s think about a situation in which a process is running in user mode but its time slice is up. Here’s what happens:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The CPU (the actual hardware) interrupts the current process based on an internal timer, switches into kernel mode, and hands control back to the kernel.</li><li value="2" class="calibre_8">The kernel records the current state of the CPU and memory, which will be essential to resuming the process that was just interrupted.</li><li value="3" class="calibre_8">The kernel performs any tasks that might have come up during the preceding time slice (such as collecting data from input and output, or I/O, operations).</li><li value="4" class="calibre_8">The kernel is now ready to let another process run. The kernel analyzes the list of processes that are ready to run and chooses one.</li><li value="5" class="calibre_8">The kernel prepares the memory for this new process and then prepares the CPU.</li><li value="6" class="calibre_8">The kernel tells the CPU how long the time slice for the new process will last.</li><li value="7" class="calibre_8">The kernel switches the CPU into user mode and hands control of the CPU to the process.</li></ol><p id="calibre_link-645" class="calibre_33"><span class="calibre_13">The context switch answers the important question of </span><span class="italic">when</span><span class="calibre_13"> the kernel runs. The answer is that it runs </span><span class="italic">between</span><span class="calibre_13"> process time slices during a context switch.</span></p><p class="calibre_27"><span class="calibre_13">In the case of a multi-CPU system, as most current machines are, things become slightly more complicated because the kernel doesn’t need to relinquish control of its current CPU in order to allow a process to run on a different CPU, and more than one process may run at a time. However, to maximize the usage of all available CPUs, the kernel typically performs these steps anyway (and may use certain tricks to grab a little more CPU time for itself).</span></p><p id="calibre_link-19" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">1.3.2 Memory Management</span></span></span></p><p class="calibre_45"><span class="calibre_13">The kernel must manage memory during a context switch, which can be a complex job. The following conditions must hold:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">The kernel must have its own private area in memory that user processes can’t access.</li><li value="2" class="calibre_8">Each user process needs its own section of memory.</li><li value="3" class="calibre_8">One user process may not access the private memory of another process.</li><li value="4" class="calibre_8">User processes can share memory.</li><li value="5" class="calibre_8">Some memory in user processes can be read-only.</li><li value="6" class="calibre_8">The system can use more memory than is physically present by using disk space as auxiliary.</li></ul><p class="calibre_33"><span class="calibre_13"> Fortunately for the kernel, there is help. Modern CPUs include a </span><span class="italic">memory management unit (MMU)</span><span class="calibre_13"> that enables a memory access scheme called </span><span class="italic">virtual memory</span><span class="calibre_13">. When using virtual memory, a process does not directly access the memory by its physical location in the hardware. Instead, the kernel sets up each process to act as if it had an entire machine to itself. When the process accesses some of its memory, the MMU intercepts the access and uses a memory address map to translate the memory location from the process point of view into an actual physical memory location in the machine. The kernel must still initialize and continuously maintain and alter this memory address map. For example, during a context switch, the kernel has to change the map from the outgoing process to the incoming process.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The implementation of a memory address map is called a </span></span>page table<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">You’ll learn more about how to view memory performance in Chapter 8.</span></p><p id="calibre_link-20" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">1.3.3 Device Drivers and Management</span></span></span></p><p class="calibre_45"><span class="calibre_13">The kernel’s role with devices is relatively simple. A device is typically accessible only in kernel mode because improper access (such as a user process asking to turn off the power) could crash the machine. A notable difficulty is that different devices rarely have the same programming interface, even if the devices perform the same task (for example, two different network cards). Therefore, device drivers have traditionally been part of the kernel, and they strive to present a uniform interface to user processes in order to simplify the software developer’s job.</span><a id="calibre_link-687"></a></p><p id="calibre_link-21" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">1.3.4 System Calls and Support</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are several other kinds of kernel features available to user processes. For example, </span><span class="italic">system calls</span><span class="calibre_13"> (or </span><span class="italic">syscalls</span><span class="calibre_13">) perform specific tasks that a user process alone cannot do well or at all. For example, the acts of opening, reading, and writing files all involve system calls.</span></p><p class="calibre_27"><span class="calibre_13"> Two system calls, </span><span class="calibre3">fork()</span><span class="calibre_13"> and </span><span class="calibre3">exec()</span><span class="calibre_13">, are important to understanding how processes start:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">fork()</span></span> When a process calls <span class="calibre3">fork()</span>, the kernel creates a nearly identical copy of the process.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">exec()</span></span> When a process calls <span class="calibre3">exec(</span><span class="calibre3"><span class="italic">program</span></span><span class="calibre3">)</span>, the kernel loads and starts <span class="calibre3"><span class="italic">program</span></span>, replacing the current process.</li></ol><p class="calibre_33"><span class="calibre_13"> Other than init (see Chapter 6), </span><span class="italic">all</span><span class="calibre_13"> new user processes on a Linux system start as a result of </span><span class="calibre3">fork()</span><span class="calibre_13">, and most of the time, you also run </span><span class="calibre3">exec()</span><span class="calibre_13"> to start a new program instead of running a copy of an existing process. A very simple example is any program that you run at the command line, such as the </span><span class="calibre3">ls</span><span class="calibre_13"> command to show the contents of a directory. When you enter </span><span class="calibre3">ls</span><span class="calibre_13"> into a terminal window, the shell that’s running inside the terminal window calls </span><span class="calibre3">fork()</span><span class="calibre_13"> to create a copy of the shell, and then the new copy of the shell calls </span><span class="calibre3">exec(ls)</span><span class="calibre_13"> to run </span><span class="calibre3">ls</span><span class="calibre_13">. </span><a></a><a href="#calibre_link-486"><span class="italic"><span class="calibre_4">Figure 1-2</span></span></a><span class="calibre_13"> shows the flow of processes and system calls for starting a program like </span><span class="calibre3">ls</span><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000001.jpg" class="calibre_48" />
</p><p id="calibre_link-486" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 1-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Starting a new process</span></span></span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> System calls are normally denoted with parentheses. In the example shown in </span></span><a href="#calibre_link-486"><span class="italic"><span class="calibre_4">Figure 1-2</span></span></a><span class="italic"><span class="calibre_13">, the process asking the kernel to create another process must perform a </span></span><span class="calibre3">fork()</span><span class="italic"><span class="calibre_13"> system call. This notation derives from the way the call would be written in the C programming language. You don’t need to know C to understand this book; just remember that a system call is an interaction between a process and the kernel. In addition, this book simplifies certain groups of system calls. For example, </span></span><span class="calibre3">exec()</span><span class="italic"><span class="calibre_13"> refers to an entire family of system calls that all perform a similar task but differ in programming. There is also a variant on a process called a thread, which we’ll cover in Chapter 8.</span></span></blockquote><p id="calibre_link-819" class="calibre_37"><span class="calibre_13">The kernel also supports user processes with features other than traditional system calls, the most common of which are </span><span class="italic">pseudodevices</span><span class="calibre_13">. Pseudodevices look like devices to user processes, but they’re implemented purely in software. This means they don’t technically need to be in the kernel, but they are usually there for practical reasons. For example, the kernel random number generator device (</span><span class="italic">/dev/random</span><span class="calibre_13">) would be difficult to implement securely with a user process.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Technically, a user process that accesses a pseudodevice must use a system call to open the device, so processes can’t entirely avoid system calls.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-22" class="calibre_42"><span class="calibre1"><span class="bold"> 1.4 User Space</span></span></p><p class="calibre_24"><span class="calibre_13">As mentioned earlier, the main memory that the kernel allocates for user processes is called </span><span class="italic">user space</span><span class="calibre_13">. Because a process is simply a state (or image) in memory, user space also refers to the memory for the entire collection of running processes. (You may also hear the more informal term </span><span class="italic">userland</span><span class="calibre_13"> used for user space; sometimes this also means the programs running in user space.)</span></p><p class="calibre_27"><span class="calibre_13"> Most of the real action on a Linux system happens in user space. Though all processes are essentially equal from the kernel’s point of view, they perform different tasks for users. There is a rudimentary service level (or layer) structure to the kinds of system components that user processes represent. </span><a></a><a href="#calibre_link-487"><span class="italic"><span class="calibre_4">Figure 1-3</span></span></a><span class="calibre_13"> shows how an example set of components fit together and interact on a Linux system. Basic services are at the bottom level (closest to the kernel), utility services are in the middle, and applications that users touch are at the top. </span><a href="#calibre_link-487"><span class="italic"><span class="calibre_4">Figure 1-3</span></span></a><span class="calibre_13"> is a greatly simplified diagram because only six components are shown, but you can see that the components at the top are closest to the user (the user interface and web browser); the components in the middle level include a domain name caching server that the web browser uses; and there are several smaller components at the bottom.</span></p><p class="calibre_34"><img src="images/000043.jpg" class="calibre_50" />
</p><p id="calibre_link-487" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 1-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Process types and interactions</span></span></span></p><p id="calibre_link-762" class="calibre_37"><span class="calibre_13">The bottom level tends to consist of small components that perform single, uncomplicated tasks. The middle level has larger components such as mail, print, and database services. Finally, components at the top level perform complicated tasks that the user often controls directly. Components also use other components. Generally, if one component wants to use another, the second component is either at the same service level or below.</span></p><p class="calibre_27"><span class="calibre_13"> However, </span><a href="#calibre_link-487"><span class="italic"><span class="calibre_4">Figure 1-3</span></span></a><span class="calibre_13"> is only an approximation of the arrangement of user space. In reality, there are no rules in user space. For example, most applications and services write diagnostic messages known as </span><span class="italic">logs</span><span class="calibre_13">. Most programs use the standard syslog service to write log messages, but some prefer to do all of the logging themselves.</span></p><p class="calibre_27"><span class="calibre_13"> In addition, it’s difficult to categorize some user-space components. Server components such as web and database servers can be considered very high-level applications because their tasks are often complicated, so you might place these at the top level in </span><a href="#calibre_link-487"><span class="italic"><span class="calibre_4">Figure 1-3</span></span></a><span class="calibre_13">. However, user applications may depend on these servers to perform tasks that they’d rather not do themselves, so you could also make a case for placing them at the middle level.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-23" class="calibre_23"><span class="calibre1"><span class="bold"> 1.5 Users</span></span></p><p class="calibre_24"><span class="calibre_13">The Linux kernel supports the traditional concept of a Unix user. A </span><span class="italic">user</span><span class="calibre_13"> is an entity that can run processes and own files. A user is most often associated with a </span><span class="italic">username</span><span class="calibre_13">; for example, a system could have a user named </span><span class="italic">billyjoe</span><span class="calibre_13">. However, the kernel does not manage the usernames; instead, it identifies users by simple numeric identifiers called </span><span class="italic">user IDs</span><span class="calibre_13">. (You’ll learn more about how usernames correspond to user IDs in </span>Chapter 7<span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13"> Users exist primarily to support permissions and boundaries. Every user-space process has a user </span><span class="italic">owner</span><span class="calibre_13">, and processes are said to run </span><span class="italic">as</span><span class="calibre_13"> the owner. A user may terminate or modify the behavior of its own processes (within certain limits), but it cannot interfere with other users’ processes. In addition, users may own files and choose whether to share them with other users.</span></p><p class="calibre_27"><span class="calibre_13"> A Linux system normally has a number of users in addition to the ones that correspond to the real human beings who use the system. You’ll read about these in more detail in </span>Chapter 3<span class="calibre_13">, but the most important user to know about is </span><span class="italic">root</span><span class="calibre_13">. The root user is an exception to the preceding rules because root may terminate and alter another user’s processes and access any file on the local system. For this reason, root is known as the </span><span class="italic">superuser</span><span class="calibre_13">. A person who can operate as root&mdash;that is, who has </span><span class="italic">root access</span><span class="calibre_13">&mdash;is an administrator on a traditional Unix system.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Operating as root can be dangerous. It can be difficult to identify and correct mistakes because the system will let you do anything, even if it is harmful to the system. For this reason, system designers constantly try to make root access as unnecessary as possible&mdash;for example, by not requiring root access to switch between wireless networks on a notebook. In addition, as powerful as the root user is, it still runs in the operating system’s user mode, not kernel mode.</span></span></blockquote><p id="calibre_link-785" class="calibre_37"><span class="italic">Groups</span><span class="calibre_13"> are sets of users. The primary purpose of groups is to allow a user to share file access to other members of a group.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-24" class="calibre_23"><span class="calibre1"><span class="bold"> 1.6 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">So far, you’ve seen what constitutes a </span><span class="italic">running</span><span class="calibre_13"> Linux system. User processes make up the environment that you directly interact with; the kernel manages processes and hardware. Both the kernel and processes reside in memory.</span></p><p class="calibre_27"><span class="calibre_13">This is great background information, but you can’t learn the details of a Linux system by reading about it alone; you need to get your hands dirty. The next chapter starts your journey by teaching you some user-space basics. Along the way, you’ll learn about a major part of the Linux system that this chapter doesn’t discuss: long-term storage (disks, files, and the like). After all, you need to store your programs and data somewhere.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-25" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-871" class="calibre_10"><span class="calibre4"><span class="bold">2</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">BASIC COMMANDS AND DIRECTORY HIERARCHY</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter is a guide to the Unix commands and utilities you’ll encounter throughout this book. This is preliminary material, and you may already know a substantial amount of it. Even if you think you’re up to speed, take a few moments to flip through the chapter just to make sure, especially when it comes to the directory hierarchy material in </span></span><span class="calibre1">Section 2.19</span><span class="calibre1"><span class="calibre_13">.</span></span></p><p class="calibre_33"><span class="calibre_13"> Why Unix commands? Isn’t this a book about how Linux works? It is, of course, but Linux is a Unix flavor at heart. You’ll see the word </span><span class="italic">Unix</span><span class="calibre_13"> in this chapter more than </span><span class="italic">Linux</span><span class="calibre_13"> because you can take what you learn straight over to BSD and other Unix-flavored systems. I’ve attempted to avoid covering too many Linux-specific user interface extensions, not only to give you a better background for using the other operating systems, but also because these extensions tend to be unstable. You’ll be able to adapt to new Linux releases much more quickly if you know the core commands. In addition, knowing these commands can boost your understanding of the kernel, as many correspond directly to system calls.</span><a id="calibre_link-547"></a></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> For more details about Unix for beginners than you’ll find here, consider reading </span></span>The Linux Command Line<span class="italic"><span class="calibre_13">, 2nd edition (No Starch Press, 2019), </span></span>UNIX for the Impatient<span class="italic"><span class="calibre_13">, 2nd edition (Addison-Wesley Professional, 1995), and </span></span>Learning the UNIX Operating System<span class="italic"><span class="calibre_13">, 5th edition (O’Reilly, 2001).</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-26" class="calibre_42"><span class="calibre1"><span class="bold"> 2.1 The Bourne Shell: /bin/sh</span></span></p><p class="calibre_24"><span class="calibre_13">The shell is one of the most important parts of a Unix system. A </span><span class="italic">shell</span><span class="calibre_13"> is a program that runs commands, like the ones that users enter into a terminal window. These commands can be other programs or built-in features of the shell. The shell also serves as a small programming environment. Unix programmers often break common tasks into smaller components and use the shell to manage tasks and piece things together.</span></p><p class="calibre_27"><span class="calibre_13"> Many important parts of the system are actually </span><span class="italic">shell scripts</span><span class="calibre_13">&mdash;text files that contain a sequence of shell commands. If you’ve worked with MS-DOS previously, you can think of shell scripts as very powerful </span><span class="italic">.BAT</span><span class="calibre_13"> files. Because they’re important, </span>Chapter 11<span class="calibre_13"> is devoted entirely to shell scripts.</span></p><p class="calibre_27"><span class="calibre_13">As you progress through this book and gain practice, you’ll add to your knowledge of manipulating commands using the shell. One of the best things about the shell is that if you make a mistake, you can easily see what you typed to find out what went wrong, and then try again.</span></p><p class="calibre_27"><span class="calibre_13"> There are many different Unix shells, but all derive features from the Bourne shell (</span><span class="italic">/bin/sh</span><span class="calibre_13">), a standard shell developed at Bell Labs for early versions of Unix. Every Unix system needs a version of the Bourne shell in order to function correctly, as you will see throughout this book.</span></p><p class="calibre_27"><span class="calibre_13"> Linux uses an enhanced version of the Bourne shell called </span><span class="calibre3">bash</span><span class="calibre_13"> or the “Bourne-again” shell. The </span><span class="calibre3">bash</span><span class="calibre_13"> shell is the default shell on most Linux distributions, and </span><span class="italic">/bin/sh</span><span class="calibre_13"> is normally a link to </span><span class="calibre3">bash</span><span class="calibre_13"> on a Linux system. You should use the </span><span class="calibre3">bash</span><span class="calibre_13"> shell when running the examples in this book.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You may not have </span></span><span class="calibre3">bash</span><span class="italic"><span class="calibre_13"> as your default shell if you’re using this chapter as a guide for a Unix account at an organization where you’re not the system administrator. You can change your shell with </span></span><span class="calibre3">chsh</span><span class="italic"><span class="calibre_13"> or ask your system administrator for help.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-27" class="calibre_42"><span class="calibre1"><span class="bold"> 2.2 Using the Shell</span></span></p><p class="calibre_24"><span class="calibre_13">When you install Linux, you should create at least one regular user to be your personal account. For this chapter, you should log in as the regular user.</span></p><p id="calibre_link-28" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.2.1 The Shell Window</span></span></span></p><p class="calibre_45"><span class="calibre_13">After logging in, open a shell window (often referred to as a </span><span class="italic">terminal</span><span class="calibre_13">). The easiest way to do so from a GUI like Gnome or KDE is to open a terminal application, which starts a shell inside a new window. Once you’ve opened a shell, it should display a prompt at the top that usually ends with a dollar sign (</span><span class="calibre3">$</span><span class="calibre_13">). On Ubuntu, that prompt should look like </span><span class="calibre3"><span class="italic">name@host:path</span></span><span class="calibre3">$</span><span class="calibre_13">, and on Fedora, it’s </span><span class="calibre3">[</span><span class="calibre3"><span class="italic">name@host path</span></span><span class="calibre3">]$</span><span class="calibre_13">, where </span><span class="calibre3"><span class="italic">name</span></span><span class="calibre_13"> is your username, </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13"> is the name of your machine, and </span><span class="calibre3"><span class="italic">path</span></span><span class="calibre_13"> is your current working directory (see </span>Section 2.4.1<span class="calibre_13">). If you’re familiar with Windows, the shell window will look something like a DOS command prompt; in macOS the Terminal application is essentially the same as a Linux shell window.</span></p><p class="calibre_27"><span class="calibre_13"> This book contains many commands that you will type at a shell prompt. They all begin with a single </span><span class="calibre3">$</span><span class="calibre_13"> to denote the shell prompt. For example, type this command (just the part in bold, not the </span><span class="calibre3">$</span><span class="calibre_13">) and press </span>ENTER<span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo Hello there.</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Many shell commands in this book start with </span></span><span class="calibre3">#</span><span class="italic"><span class="calibre_13">. You should run these commands as the superuser (root), so they require extra caution. The best practice when running them is to use </span></span><span class="calibre3">sudo</span><span class="italic"><span class="calibre_13"> in order to provide some protection and a log that you can look up later for possible errors. You’ll see how to do this in </span></span><span class="italic">Section 2.20</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Now enter this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This command displays the contents of the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> system information file and then returns your shell prompt. Don’t worry about what </span><span class="italic">this</span><span class="calibre_13"> file does right now; you’ll learn all about it in </span>Chapter 7<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Commands usually begin with a program to run and may be followed by </span><span class="italic">arguments</span><span class="calibre_13"> that tell the program what to operate on and how to do so. Here, the program is </span><span class="calibre3">cat</span><span class="calibre_13">, and there is one argument, </span><span class="calibre3">/etc/passwd</span><span class="calibre_13">. Many arguments are options that modify the default behavior of a program and typically begin with a dash (</span><span class="calibre3">-</span><span class="calibre_13">). You’ll see this shortly in the discussion of </span><span class="calibre3">ls</span><span class="calibre_13">. There are some exceptions that don’t follow this normal command structure, however, such as shell built-ins and the temporary use of environment variables.</span></p><p id="calibre_link-29" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.2.2 cat</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">cat</span><span class="calibre_13"> program is one of the easiest in Unix to understand; it simply outputs the contents of one or more files or another source of input. The general syntax of a </span><span class="calibre3">cat</span><span class="calibre_13"> command is as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span><span class="calibre3"><span class="bold"> ...</span></span></blockquote></blockquote><p id="calibre_link-611" class="calibre_30"><span class="calibre_13">When you run this command, </span><span class="calibre3">cat</span><span class="calibre_13"> prints the contents of </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre_13">, </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre_13">, and any other files that you specify as arguments (denoted by </span><span class="calibre3">...</span><span class="calibre_13"> in the preceding example), and then exits. The program is called </span><span class="calibre3">cat</span><span class="calibre_13"> because it performs concatenation when it prints the contents of more than one file. There are many ways to run </span><span class="calibre3">cat</span><span class="calibre_13">; let’s use it to explore Unix I/O.</span></p><p id="calibre_link-30" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.2.3 Standard Input and Standard Output</span></span></span></p><p class="calibre_45"><span class="calibre_13">Unix processes use I/O </span><span class="italic">streams</span><span class="calibre_13"> to read and write data. Processes read data from input streams and write data to output streams. Streams are very flexible. For example, the source of an input stream can be a file, a device, a terminal window, or even the output stream from another process.</span></p><p class="calibre_27"><span class="calibre_13"> To see an input stream at work, enter </span><span class="calibre3"><span class="bold">cat</span></span><span class="calibre_13"> (with no arguments) and press </span>ENTER<span class="calibre_13">. This time, you won’t get any immediate output, and you won’t get your shell prompt back because </span><span class="calibre3">cat</span><span class="calibre_13"> is still running. Now type anything and press </span>ENTER<span class="calibre_13"> at the end of each line. When used like this, the </span><span class="calibre3">cat</span><span class="calibre_13"> command repeats any line that you type. Once you’re sufficiently bored, press </span>CTRL<span class="calibre_13">-D on an empty line to terminate </span><span class="calibre3">cat</span><span class="calibre_13"> and return to the shell prompt.</span></p><p class="calibre_27"><span class="calibre_13"> The reason </span><span class="calibre3">cat</span><span class="calibre_13"> adopts an interactive behavior here has to do with streams. When you don’t specify an input filename, </span><span class="calibre3">cat</span><span class="calibre_13"> reads from the </span><span class="italic">standard input</span><span class="calibre_13"> stream provided by the Linux kernel rather than a stream connected to a file. In this case, the standard input is connected to the terminal where you run </span><span class="calibre3">cat</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Pressing </span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-D on an empty line stops the current standard input entry from the terminal with an EOF (end-of-file) message (and often terminates a program). Don’t confuse this with </span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-C, which usually terminates a program regardless of its input or output.</span></span></blockquote><p class="calibre_37"><span class="italic">Standard output</span><span class="calibre_13"> is similar. The kernel gives each process a standard output stream where it can write its output. The </span><span class="calibre3">cat</span><span class="calibre_13"> command always writes its output to the standard output. When you ran </span><span class="calibre3">cat</span><span class="calibre_13"> in the terminal, the standard output was connected to that terminal, so that’s where you saw the output.</span></p><p class="calibre_27"><span class="calibre_13"> Standard input and output are often abbreviated as </span><span class="italic">stdin</span><span class="calibre_13"> and </span><span class="italic">stdout</span><span class="calibre_13">. Many commands operate as </span><span class="calibre3">cat</span><span class="calibre_13"> does; if you don’t specify an input file, the command reads from stdin. Output is a little different. Some programs (like </span><span class="calibre3">cat</span><span class="calibre_13">) send output only to stdout, but others have the option to send output directly to files.</span></p><p class="calibre_27"><span class="calibre_13"> There is a third standard I/O stream, called </span><span class="italic">standard error</span><span class="calibre_13">. You’ll see it in </span>Section 2.14.1<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> One of the best features of standard streams is that you can easily manipulate them to read and write to places other than the terminal, as you’ll learn in </span>Section 2.14<span class="calibre_13">. In particular, you’ll learn how to connect streams to files and other processes.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-31" class="calibre_23"><span class="calibre1"><span class="bold">2.3 Basic Commands</span></span></p><p class="calibre_24"><span class="calibre_13">Now let’s look at some more Unix commands. Most of the following programs take multiple arguments, and some have so many options and formats that an unabridged listing would be pointless. This is a simplified list of the basic commands; you don’t need all of the details just yet.</span></p><p id="calibre_link-32" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.3.1 ls</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">ls</span><span class="calibre_13"> command lists the contents of a directory. The default is the current directory, but you can add any directory or file as an argument, and there are many useful options. For example, use </span><span class="calibre3">ls -l</span><span class="calibre_13"> for a detailed (long) listing and </span><span class="calibre3">ls -F</span><span class="calibre_13"> to display file type information. Here is a sample long listing; it includes the owner of the file (column 3), the group (column 4), the file size (column 5), and the modification date/time (between column 5 and the filename):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l</span></span><span class="calibre3"><br class="calibre7" />total 3616<br class="calibre7" />-rw-r--r-- 1 juser users 3804&nbsp;&nbsp;&nbsp; May 28 10:40&nbsp; abusive.c<br class="calibre7" />-rw-r--r-- 1 juser users 4165&nbsp;&nbsp;&nbsp; Aug 13 10:01&nbsp; battery.zip<br class="calibre7" />-rw-r--r-- 1 juser users 131219&nbsp; Aug 13 10:33&nbsp; beav_1.40-13.tar.gz<br class="calibre7" />-rw-r--r-- 1 juser users 6255&nbsp;&nbsp;&nbsp; May 20 14:34&nbsp; country.c<br class="calibre7" />drwxr-xr-x 2 juser users 4096&nbsp;&nbsp;&nbsp; Jul 17 20:00&nbsp; cs335<br class="calibre7" />-rwxr-xr-x 1 juser users 7108&nbsp;&nbsp;&nbsp; Jun 16 13:05&nbsp; dhry<br class="calibre7" />-rw-r--r-- 1 juser users 11309&nbsp;&nbsp; Aug 13 10:26&nbsp; dhry.c<br class="calibre7" />-rw-r--r-- 1 juser users 56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Jul&nbsp; 9 15:30&nbsp; doit<br class="calibre7" />drwxr-xr-x 6 juser users 4096&nbsp;&nbsp;&nbsp; Feb 20 13:51&nbsp; dw<br class="calibre7" />drwxr-xr-x 3 juser users 4096&nbsp;&nbsp;&nbsp; Jul&nbsp; 1 16:05&nbsp; hough-stuff</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’ll learn more about column 1 of this output in </span>Section 2.17<span class="calibre_13">. You can ignore column 2 for now; it’s the number of hard links to the file and is explained in </span>Section 4.6<span class="calibre_13">.</span></p><p id="calibre_link-33" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.3.2 cp</span></span></span></p><p class="calibre_45"><span class="calibre_13">In its simplest form, </span><span class="calibre3">cp</span><span class="calibre_13"> copies files. For example, to copy </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre_13"> to </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre_13">, enter this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cp </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You can also copy a file to another directory, keeping the same file name in that directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cp </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To copy more than one file to a directory (folder) named </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13">, try something like this example, which copies three files:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cp </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file3</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p id="calibre_link-34" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">2.3.3 mv</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">mv</span><span class="calibre_13"> (move) command works much like </span><span class="calibre3">cp</span><span class="calibre_13">. In its simplest form, it renames a file. For example, to rename </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre_13"> to </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre_13">, enter this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">mv </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also use </span><span class="calibre3">mv</span><span class="calibre_13"> to move files to other directories in the same way as </span><span class="calibre3">cp</span><span class="calibre_13">.</span></p><p id="calibre_link-35" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.3.4 touch</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">touch</span><span class="calibre_13"> command can create a file. If the target file already exists, </span><span class="calibre3">touch</span><span class="calibre_13"> doesn’t change the file, but it does update the file’s modification timestamp. For example, to create an empty file, enter this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">touch </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Then run </span><span class="calibre3"><span class="bold">ls -l</span></span><span class="calibre_13"> on that file. You should see output like the following, where the date and time indicate when you ran </span><span class="calibre3">touch</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><br class="calibre7" />-rw-r--r-- 1 juser users 0&nbsp; May 21 18:32 </span><span class="calibre3"><span class="italic">file</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To see a timestamp update, wait at least a minute and then run the same </span><span class="calibre3">touch</span><span class="calibre_13"> command again. The timestamp returned by </span><span class="calibre3">ls -l</span><span class="calibre_13"> will update.</span></p><p id="calibre_link-36" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.3.5 rm</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">rm</span><span class="calibre_13"> command deletes (removes) a file. After you remove a file, it’s usually gone from your system and generally cannot be undeleted unless you restore it from a backup.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rm </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p id="calibre_link-37" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">2.3.6 echo</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">echo</span><span class="calibre_13"> command prints its arguments to the standard output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo Hello again.</span></span><span class="calibre3"><br class="calibre7" />Hello again.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">echo</span><span class="calibre_13"> command is very useful for finding expansions of shell globs (“wildcards” such as </span><span class="calibre3">*</span><span class="calibre_13">) and variables (such as </span><span class="calibre3">$HOME</span><span class="calibre_13">), which you will encounter later in this chapter.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-38" class="calibre_23"><span class="calibre1"><span class="bold"> 2.4 Navigating Directories</span></span></p><p class="calibre_24"><span class="calibre_13">The Unix directory hierarchy starts at </span><span class="italic">/</span><span class="calibre_13">, also called the </span><span class="italic">root directory</span><span class="calibre_13">. The directory separator is the slash (</span><span class="italic">/</span><span class="calibre_13">), </span><span class="italic">not</span><span class="calibre_13"> the backslash (\). There are several standard subdirectories in the root directory, such as </span><a id="calibre_link-546"></a><span class="italic">/usr</span><span class="calibre_13">, as you’ll learn in </span>Section 2.19<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> When you refer to a file or directory, you specify a </span><span class="italic">path</span><span class="calibre_13"> or </span><span class="italic">pathname</span><span class="calibre_13">. When a path starts with </span><span class="italic">/</span><span class="calibre_13"> (such as </span><span class="italic">/usr/lib</span><span class="calibre_13">), it’s a </span><span class="italic">full</span><span class="calibre_13"> or </span><span class="italic">absolute</span><span class="calibre_13"> path.</span></p><p class="calibre_27"><span class="calibre_13"> A path component identified by two dots (</span><span class="italic">..</span><span class="calibre_13">) specifies the parent of a directory. For example, if you’re working in </span><span class="italic">/usr/lib</span><span class="calibre_13">, the path </span><span class="italic">..</span><span class="calibre_13"> would refer to </span><span class="italic">/usr</span><span class="calibre_13">. Similarly, </span><span class="italic">../bin</span><span class="calibre_13"> would refer to </span><span class="italic">/usr/bin</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> One dot (</span><span class="italic">.</span><span class="calibre_13">) refers to the current directory; for example, if you’re in </span><span class="italic">/usr/lib</span><span class="calibre_13">, the path . is still </span><span class="italic">/usr/lib</span><span class="calibre_13">, and </span><span class="italic">./X11</span><span class="calibre_13"> is </span><span class="italic">/usr/lib/X11</span><span class="calibre_13">. You won’t have to use </span><span class="italic">.</span><span class="calibre_13"> very often because most commands default to the current directory if a path doesn’t start with </span><span class="italic">/</span><span class="calibre_13"> (so you could just use </span><span class="italic">X11</span><span class="calibre_13"> instead of </span><span class="italic">./X11</span><span class="calibre_13"> in the preceding example).</span></p><p class="calibre_27"><span class="calibre_13"> A path not beginning with </span><span class="italic">/</span><span class="calibre_13"> is called a </span><span class="italic">relative path</span><span class="calibre_13">. Most of the time, you’ll work with relative pathnames, because you’ll already be in or near the directory you need.</span></p><p class="calibre_27"><span class="calibre_13">Now that you have a sense of the basic directory mechanics, here are some essential directory commands.</span></p><p id="calibre_link-39" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.4.1 cd</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="italic">current working directory</span><span class="calibre_13"> is the directory that a process (such as the shell) is currently in. In addition to the default shell prompt in most Linux distributions, you can see your current directory with the </span><span class="calibre3">pwd</span><span class="calibre_13"> command, described in </span>Section 2.5.3<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Each process can independently set its own current working directory. The </span><span class="calibre3">cd</span><span class="calibre_13"> command changes the shell’s current working directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cd </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you omit </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13">, the shell returns to your </span><span class="italic">home directory</span><span class="calibre_13">, the directory where you started when you first logged in. Some programs abbreviate your home directory with the </span><span class="calibre3">~</span><span class="calibre_13"> symbol (a </span><span class="italic">tilde</span><span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">cd</span><span class="italic"><span class="calibre_13"> command is a shell built-in. It wouldn’t work as a separate program because if it were to run as a subprocess, it could not (normally) change its parent’s current working directory. This may not seem a particularly important distinction at the moment, but there are times when knowing this fact can clear up confusion.</span></span></blockquote><p id="calibre_link-40" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.4.2 mkdir</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">mkdir</span><span class="calibre_13"> command creates a new directory </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">mkdir </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p id="calibre_link-41" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">2.4.3 rmdir</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">rmdir</span><span class="calibre_13"> command removes the directory </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rmdir </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p id="calibre_link-552" class="calibre_30"><span class="calibre_13">If </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> isn’t empty, this command fails. However, if you’re impatient, you probably don’t want to laboriously delete all the files and subdirectories inside </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> first. You can use </span><span class="calibre3">rm -r</span><span class="calibre3"><span class="italic"> dir</span></span><span class="calibre_13"> to delete a directory and its contents, but be careful! This is one of the few commands that can do serious damage, especially if you run it as the superuser. The </span><span class="calibre3">-r</span><span class="calibre_13"> option specifies </span><span class="italic">recursive delete</span><span class="calibre_13"> to repeatedly delete everything inside </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13">. Don’t use the </span><span class="calibre3">-r</span><span class="calibre_13"> flag with globs such as a star (</span><span class="calibre3">*</span><span class="calibre_13">). And above all, always double-check your command before you run it.</span></p><p id="calibre_link-42" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.4.4 Shell Globbing (“Wildcards”)</span></span></span></p><p class="calibre_45"><span class="calibre_13">The shell can match simple patterns to file and directory names, a process known as </span><span class="italic">globbing</span><span class="calibre_13">. This is similar to the concept of wildcards in other systems. The simplest of these is the glob character </span><span class="calibre3">*</span><span class="calibre_13">, which tells the shell to match any number of arbitrary characters. For example, the following command prints a list of files in the current directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo *</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The shell matches arguments containing globs to filenames, substitutes the filenames for those arguments, and then runs the revised command line. The substitution is called </span><span class="italic">expansion</span><span class="calibre_13"> because the shell substitutes all matching filenames for a simplified expression. Here are some ways to use </span><span class="calibre3">*</span><span class="calibre_13"> to expand filenames:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"><span class="calibre3">at*</span> expands to all filenames that start with <span class="calibre3">at</span>.</li><li value="2" class="calibre_8"><span class="calibre3">*at</span> expands to all filenames that end with <span class="calibre3">at</span>.</li><li value="3" class="calibre_8"><span class="calibre3">*at*</span> expands to all filenames that contain <span class="calibre3">at</span>.</li></ul><p class="calibre_33"><span class="calibre_13"> If no files match a glob, the </span><span class="calibre3">bash</span><span class="calibre_13"> shell performs no expansion, and the command runs with literal characters such as </span><span class="calibre3">*.</span><span class="calibre_13"> For example, try a command such as </span><span class="calibre3">echo *dfkdsafh</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re used to the Windows command prompt, you might instinctively type </span></span><span class="calibre3">*.*</span><span class="italic"><span class="calibre_13"> to match all files. Break this habit now. In Linux and other versions of Unix, you must use </span></span><span class="calibre3">*</span><span class="italic"><span class="calibre_13"> to match all files. In the Unix shell, </span></span><span class="calibre3">*.*</span><span class="italic"><span class="calibre_13"> matches only files and directories that contain the dot (</span></span><span class="calibre3">.</span><span class="italic"><span class="calibre_13">) character in their names. Unix filenames do not need extensions and often do not carry them.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Another shell glob character, the question mark (</span><span class="calibre3">?</span><span class="calibre_13">), instructs the shell to match exactly one arbitrary character. For example, </span><span class="calibre3">b?at</span><span class="calibre_13"> matches </span><span class="calibre3">boat</span><span class="calibre_13"> and </span><span class="calibre3">brat</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If you don’t want the shell to expand a glob in a command, enclose the glob in single quotes (</span><span class="calibre3">''</span><span class="calibre_13">). For example, the command </span><span class="calibre3">echo '*'</span><span class="calibre_13"> prints a star. You will find this handy for a few of the commands described in the next section, such as </span><a id="calibre_link-553"></a><span class="calibre3">grep</span><span class="calibre_13"> and </span><span class="calibre3">find</span><span class="calibre_13">. (You’ll learn more much about quoting in </span>Section 11.2<span class="calibre_13">.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> It is important to remember that the shell performs expansions </span></span>before<span class="italic"><span class="calibre_13"> running commands, and </span></span>only<span class="italic"><span class="calibre_13"> then. Therefore, if a </span></span><span class="calibre3">*</span><span class="italic"><span class="calibre_13"> makes it to a command without expanding, the shell won’t do anything more with it; it’s up to the command to decide what it wants to do.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> There is more to the shell’s pattern-matching capabilities, but </span><span class="calibre3">*</span><span class="calibre_13"> and </span><span class="calibre3">?</span><span class="calibre_13"> are what you need to know now. </span>Section 2.7<span class="calibre_13"> describes glob behavior with those funny files that start with a dot.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-43" class="calibre_23"><span class="calibre1"><span class="bold"> 2.5 Intermediate Commands</span></span></p><p class="calibre_24"><span class="calibre_13">This section describes the most essential intermediate Unix commands.</span></p><p id="calibre_link-44" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.1 grep</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">grep</span><span class="calibre_13"> command prints the lines from a file or input stream that match an expression. For example, to print the lines in the</span><span class="italic"> /etc/passwd </span><span class="calibre_13">file that contain the text </span><span class="calibre3">root</span><span class="calibre_13">, enter this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep root /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">grep</span><span class="calibre_13"> command is extraordinarily handy when operating on multiple files at once because it prints the filename in addition to the matching line. For example, if you want to check every file in </span><span class="italic">/etc</span><span class="calibre_13"> that contains the word </span><span class="calibre3">root</span><span class="calibre_13">, you could use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep root /etc/*</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Two of the most important </span><span class="calibre3">grep</span><span class="calibre_13"> options are </span><span class="calibre3">-i</span><span class="calibre_13"> (for case-insensitive matches) and </span><span class="calibre3">-v</span><span class="calibre_13"> (which inverts the search&mdash;that is, prints all lines that </span><span class="italic">don’t</span><span class="calibre_13"> match). There is also a more powerful variant called </span><span class="calibre3">egrep</span><span class="calibre_13"> (which is just a synonym for </span><span class="calibre3">grep -E</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre3">grep</span><span class="calibre_13"> understands </span><span class="italic">regular expressions</span><span class="calibre_13">, patterns that are grounded in computer science theory and are very common in Unix utilities. Regular expressions are more powerful than wildcard-style patterns, and they have a different syntax. There are three important things to remember about regular expressions:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"><span class="calibre3">.*</span> matches any number of characters, including none (like the <span class="calibre3">*</span> in globs and wildcards).</li><li value="2" class="calibre_8"><span class="calibre3">.+</span> matches any one or more characters.</li><li value="3" class="calibre_8"><span class="calibre3">.</span> matches exactly one arbitrary character.</li></ul><blockquote id="calibre_link-702" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The grep(1) manual page contains a detailed description of regular expressions, but it can be somewhat difficult to read. To learn more, you can read </span></span>Mastering Regular Expressions<span class="italic"><span class="calibre_13">, 3rd edition, by Jeffrey E. F. Friedl (O’Reilly, 2006), or see the regular expressions chapter of </span></span>Programming Perl<span class="italic"><span class="calibre_13">, 4th edition, by Tom Christensen et al. (O’Reilly, 2012). If you like math and are interested in where regular expressions come from, look up </span></span>Introduction to Automata Theory, Languages, and Computation<span class="italic"><span class="calibre_13">, 3rd edition, by Jeffrey Ullman and John Hopcroft (Prentice Hall, 2006).</span></span></blockquote><p id="calibre_link-45" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.5.2 less</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">less</span><span class="calibre_13"> command comes in handy when a file is really big or when a command’s output is long and scrolls off the top of the screen.</span></p><p class="calibre_27"><span class="calibre_13"> To page through a big file like </span><span class="italic">/usr/share/dict/words</span><span class="calibre_13">, you can use the command </span><span class="calibre3">less</span><span class="calibre_13">
</span><span class="calibre3">/usr/share/dict/words</span><span class="calibre_13">. When running </span><span class="calibre3">less</span><span class="calibre_13">, you’ll see the contents of the file one screenful at a time. Press the spacebar to go forward in the file and press b (lowercase) to skip back one screenful. To quit, press q.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">less</span><span class="italic"><span class="calibre_13"> command is an enhanced version of an older program named </span></span><span class="calibre3">more</span><span class="italic"><span class="calibre_13">. Linux desktops and servers have </span></span><span class="calibre3">less</span><span class="italic"><span class="calibre_13">, but it’s not standard on many embedded systems and other Unix systems. If you ever run into a situation when you can’t use </span></span><span class="calibre3">less</span><span class="italic"><span class="calibre_13">, try </span></span><span class="calibre3">more</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You can also search for text inside </span><span class="calibre3">less</span><span class="calibre_13">. For example, to search forward for a word, you can type </span><span class="calibre3">/</span><span class="calibre3"><span class="italic">word</span></span><span class="calibre_13">, and to search backward, you can use </span><span class="calibre3">?</span><span class="calibre3"><span class="italic">word</span></span><span class="calibre_13">. When you find a match, press n to continue searching.</span></p><p class="calibre_27"><span class="calibre_13"> As you’ll learn in </span>Section 2.14<span class="calibre_13">, you can send the standard output of nearly any program directly to another program’s standard input. This is exceptionally useful when you have a command with a lot of output to sift through and you’d like to use something like </span><span class="calibre3">less</span><span class="calibre_13"> to view the output. Here’s an example of sending the output of a </span><span class="calibre3">grep</span><span class="calibre_13"> command to </span><span class="calibre3">less</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep ie /usr/share/dict/words | less</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Try this command out for yourself. You’ll probably find many similar uses for </span><span class="calibre3">less</span><span class="calibre_13">.</span></p><p id="calibre_link-46" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.3 pwd</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">pwd</span><span class="calibre_13"> (print working directory) program simply outputs the name of the current working directory. You may be wondering why you need this when most Linux distributions set up user accounts with the current working directory in the prompt. There are two reasons.</span></p><p class="calibre_27"><span class="calibre_13"> First, not all prompts include the current working directory, especially because you may want to get rid of it in your own prompt because it takes up a lot of space. If you do so, you need </span><span class="calibre3">pwd</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Second, the symbolic links that you’ll learn about in </span>Section 2.17.2<span class="calibre_13"> can sometimes obscure the true full path of the current working directory. Use </span><span class="calibre3">pwd -P</span><span class="calibre_13"> to eliminate this confusion.</span></p><p id="calibre_link-47" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.4 diff</span></span></span></p><p class="calibre_45"><span class="calibre_13">To see the differences between two text files, use </span><span class="calibre3">diff</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">diff </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Several options can control the format of the output, and the default output format is often the most comprehensible for human beings. However, most programmers prefer the output from </span><span class="calibre3">diff -u</span><span class="calibre_13"> when they need to send the output to someone else, because automated tools have an easier time with this format.</span></p><p id="calibre_link-48" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.5 file</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you see a file and are unsure of its format, try using the </span><span class="calibre3">file</span><span class="calibre_13"> command to see if the system can guess it:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">file </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You may be surprised by how much this innocent-looking command can do.</span></p><p id="calibre_link-49" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.6 find and locate</span></span></span></p><p class="calibre_45"><span class="calibre_13">It’s frustrating when you know that a certain file is in a directory tree somewhere but you just don’t know where. Run </span><span class="calibre3">find</span><span class="calibre_13"> to find </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> in </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">find </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold"> -name </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold"> -print</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Like most programs in this section, </span><span class="calibre3">find</span><span class="calibre_13"> is capable of some fancy stuff. However, don’t try options such as </span><span class="calibre3">-exec</span><span class="calibre_13"> before you know the form shown here by heart and understand why you need the </span><span class="calibre3">-name</span><span class="calibre_13"> and </span><span class="calibre3">-print</span><span class="calibre_13"> options. The </span><span class="calibre3">find</span><span class="calibre_13"> command accepts special pattern-matching characters such as </span><span class="calibre3">*</span><span class="calibre_13">, but you must enclose them in single quotes (</span><span class="calibre3">'*'</span><span class="calibre_13">) to protect the special characters from the shell’s own globbing feature. (Recall from </span>Section 2.4.4<span class="calibre_13"> that the shell expands globs </span><span class="italic">before</span><span class="calibre_13"> running commands.)</span></p><p class="calibre_27"><span class="calibre_13"> Most systems also have a </span><span class="calibre3">locate</span><span class="calibre_13"> command for finding files. Rather than searching for a file in real time, </span><span class="calibre3">locate</span><span class="calibre_13"> searches an index that the system builds periodically. Searching with </span><span class="calibre3">locate</span><span class="calibre_13"> is much faster than </span><span class="calibre3">find</span><span class="calibre_13">, but if the file you’re looking for is newer than the index, </span><span class="calibre3">locate</span><span class="calibre_13"> won’t find it.</span></p><p id="calibre_link-50" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.7 head and tail</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">head</span><span class="calibre_13"> and </span><span class="calibre3">tail</span><span class="calibre_13"> commands allow you to quickly view a portion of a file or stream of data. For example, </span><span class="calibre3">head /etc/passwd</span><span class="calibre_13"> shows the first 10 lines of the password file, and </span><span class="calibre3">tail /etc/passwd</span><span class="calibre_13"> shows the last 10 lines.</span></p><p class="calibre_27"><span class="calibre_13"> To change the number of lines to display, use the </span><span class="calibre3"><span class="italic">-n</span></span><span class="calibre_13"> option, where </span><span class="calibre3"><span class="italic">n</span></span><span class="calibre_13"> is the number of lines you want to see (for example, </span><span class="calibre3">head -5 /etc/passwd</span><span class="calibre_13">). To print lines starting at line </span><span class="calibre3"><span class="italic">n</span></span><span class="calibre_13">, use </span><span class="calibre3">tail +</span><span class="calibre3"><span class="italic">n</span></span><span class="calibre_13">.</span></p><p id="calibre_link-51" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.5.8 sort</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">sort</span><span class="calibre_13"> command quickly puts the lines of a text file in alphanumeric order. If the file’s lines start with numbers and you want to sort in numerical order, use the </span><span class="calibre3">-n</span><span class="calibre_13"> option. The </span><span class="calibre3">-r</span><span class="calibre_13"> option reverses the order of the sort.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-52" class="calibre_23"><span class="calibre1"><span class="bold"> 2.6 Changing Your Password and Shell</span></span></p><p class="calibre_24"><span class="calibre_13">Use the </span><span class="calibre3">passwd</span><span class="calibre_13"> command to change your password. You’ll be asked for your old password and then prompted for your new password twice.</span></p><p class="calibre_27"><span class="calibre_13">The best passwords tend to be long “nonsense” sentences that are easy to remember. The longer the password (in terms of character length), the better; try for 16 characters or more. (In the very old days, the number of characters you could use was limited, so you were advised to add strange characters and such.)</span></p><p class="calibre_27"><span class="calibre_13"> You can change your shell with the </span><span class="calibre3">chsh</span><span class="calibre_13"> command (to an alternative such as </span><span class="calibre3">zsh</span><span class="calibre_13">, </span><span class="calibre3">ksh</span><span class="calibre_13"> or </span><span class="calibre3">tcsh</span><span class="calibre_13">), but keep in mind that this book assumes you’re running </span><span class="calibre3">bash</span><span class="calibre_13">, so if you make a change, some of the examples may not work.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-53" class="calibre_23"><span class="calibre1"><span class="bold"> 2.7 Dot Files</span></span></p><p class="calibre_24"><span class="calibre_13">Change to your home directory if you’re not already there, type </span><span class="calibre3">ls</span><span class="calibre_13"> to take a look around, and then run </span><span class="calibre3">ls -a</span><span class="calibre_13">. Do you see the difference in the output? When you run </span><span class="calibre3">ls</span><span class="calibre_13"> without the </span><span class="calibre3">-a</span><span class="calibre_13">, you won’t see the configuration files called </span><span class="italic">dot files</span><span class="calibre_13">. These are files and directories whose names begin with a dot (</span><span class="calibre3">.</span><span class="calibre_13">). Common dot files are </span><span class="italic">.bashrc</span><span class="calibre_13"> and </span><span class="italic">.login</span><span class="calibre_13">, and there are dot directories, too, such as </span><span class="italic">.ssh</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> There’s nothing special about dot files or directories. Some programs don’t show them by default so that you won’t see a complete mess when listing the contents of your home directory. For example, </span><span class="calibre3">ls</span><span class="calibre_13"> doesn’t list dot files unless you use the </span><span class="calibre3">-a</span><span class="calibre_13"> option. In addition, shell globs don’t match dot files unless you explicitly use a pattern such as </span><span class="calibre3">.*</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can run into problems with globs because </span></span><span class="calibre3">.*</span><span class="italic"><span class="calibre_13"> matches </span></span><span class="calibre3">.</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">..</span><span class="italic"><span class="calibre_13"> (the current and parent directories). You may wish to use a pattern such as </span></span><span class="calibre3">.[^.]*</span><span class="italic"><span class="calibre_13"> or </span></span><span class="calibre3">.??*</span><span class="italic"><span class="calibre_13"> to get all dot files </span></span>except<span class="italic"><span class="calibre_13"> the current and parent directories.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-54" class="calibre_42"><span class="calibre1"><span class="bold"> 2.8 Environment and Shell Variables</span></span></p><p class="calibre_24"><span class="calibre_13">The shell can store temporary variables, called </span><span class="italic">shell variables</span><span class="calibre_13">, containing the values of text strings. Shell variables are very useful for keeping track of values in scripts, and some shell variables control the way the shell behaves. (For example, the </span><span class="calibre3">bash</span><span class="calibre_13"> shell reads the </span><span class="calibre3">PS1</span><span class="calibre_13"> variable before displaying the prompt.)</span></p><p id="calibre_link-730" class="calibre_27"><span class="calibre_13">To assign a value to a shell variable, use the equal sign (</span><span class="calibre3">=</span><span class="calibre_13">). Here’s a simple example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">STUFF=blah</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The preceding example sets the value of the variable named </span><span class="calibre3">STUFF</span><span class="calibre_13"> to </span><span class="calibre3">blah</span><span class="calibre_13">. To access this variable, use </span><span class="calibre3">$STUFF</span><span class="calibre_13"> (for example, try running </span><span class="calibre3">echo $STUFF</span><span class="calibre_13">). You’ll learn about the many uses of shell variables in </span>Chapter 11<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t put any spaces around the </span></span><span class="calibre3">=</span><span class="italic"><span class="calibre_13"> when assigning a variable.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> An </span><span class="italic">environment variable</span><span class="calibre_13"> is like a shell variable, but it’s not specific to the shell. All processes on Unix systems have environment variable storage. The main difference between environment and shell variables is that the operating system passes all of your shell’s environment variables to programs that the shell runs, whereas shell variables cannot be accessed in the commands that you run.</span></p><p class="calibre_27"><span class="calibre_13"> You assign an environment variable with the shell’s </span><span class="calibre3">export</span><span class="calibre_13"> command. For example, if you’d like to make the </span><span class="calibre3">$STUFF</span><span class="calibre_13"> shell variable into an environment variable, use the following:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">STUFF=blah</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">export STUFF</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Because child processes inherit environment variables from their parent, many programs read them for configuration and options. For example, you can put your favorite </span><span class="calibre3">less</span><span class="calibre_13"> command-line options in the </span><span class="calibre3">LESS</span><span class="calibre_13"> environment variable, and </span><span class="calibre3">less</span><span class="calibre_13"> will use those options when you run it. (Many manual pages contain a section labeled ENVIRONMENT that describes these variables.)</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-55" class="calibre_23"><span class="calibre1"><span class="bold"> 2.9 The Command Path</span></span></p><p class="calibre_24"><span class="calibre3">PATH</span><span class="calibre_13"> is a special environment variable that contains the </span><span class="italic">command path</span><span class="calibre_13"> (or </span><span class="italic">path</span><span class="calibre_13"> for short), a list of system directories that the shell searches when trying to locate a command. For example, when you run </span><span class="calibre3">ls</span><span class="calibre_13">, the shell searches the directories listed in </span><span class="calibre3">PATH</span><span class="calibre_13"> for the </span><span class="calibre3">ls</span><span class="calibre_13"> program. If programs with the same name appear in several directories in the path, the shell runs the first matching program.</span></p><p class="calibre_27"><span class="calibre_13"> If you run </span><span class="calibre3">echo $PATH</span><span class="calibre_13">, you’ll see that the path components are separated by colons (</span><span class="calibre3">:</span><span class="calibre_13">). For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo $PATH</span></span><span class="calibre3"><br class="calibre7" />/usr/local/bin:/usr/bin:/bin</span></blockquote></blockquote><p id="calibre_link-847" class="calibre_30"><span class="calibre_13">To tell the shell to look in more places for programs, change the </span><span class="calibre3">PATH</span><span class="calibre_13"> environment variable. For example, by using this command, you can add a directory </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> to the beginning of the path so that the shell looks in </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> before looking in any of the other </span><span class="calibre3">PATH</span><span class="calibre_13"> directories:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">PATH=</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">:$PATH</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Or you can append a directory name to the end of the </span><span class="calibre3">PATH</span><span class="calibre_13"> variable, causing the shell to look in </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> last:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">PATH=$PATH:</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can accidentally wipe out your entire path if you mistype </span></span><span class="calibre3">$PATH</span><span class="italic"><span class="calibre_13"> when modifying your path. If this happens, don’t panic! The damage isn’t permanent; you can just start a new shell. (For a lasting effect, you need to mistype it when editing a certain configuration file, and even then it isn’t difficult to rectify.) The easiest way to return to normal is to close the current terminal window and start another.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-56" class="calibre_42"><span class="calibre1"><span class="bold"> 2.10 Special Characters</span></span></p><p class="calibre_24"><span class="calibre_13">When discussing Linux with others, you should know a few names for some of the special characters that you’ll encounter. If you’re amused by this sort of thing, see the “Jargon File” (</span><span class="italic">http://www.catb.org/jargon/html/</span><span class="calibre_13">) or its printed companion, </span><span class="italic">The New Hacker’s Dictionary</span><span class="calibre_13">, 3rd edition, by Eric S. Raymond (MIT Press, 1996).</span></p><p class="calibre_27"><a href="#calibre_link-488"><span class="italic"><span class="calibre_4">Table 2-1</span></span></a><span class="calibre_13"> describes a select set of the special characters, many of which you’ve already seen in this chapter. Some utilities, such as the Perl programming language, use almost all of these special characters! (Keep in mind that these are the American names for the characters.)</span></p><p id="calibre_link-488" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 2-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Special Characters</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Character&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Name(s)&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Uses&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">*&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;star, asterisk&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Regular expression, glob character&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">.&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;dot&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Current directory, file/hostname delimiter&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">!&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;bang&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Negation, command history&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">|&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;pipe&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Command pipes&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">/&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;(forward) slash&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Directory delimiter, search command&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">\&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;backslash&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Literals, macros (</span></span><span class="calibre3"><span class="italic">never&nbsp;</span></span><span class="calibre3"><span class="calibre_13"> directories) </span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">$&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;dollar&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Variables, end of line&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">'&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;tick, (single) quote&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Literal strings&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">`&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;backtick, backquote&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Command substitution&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">"&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;double quote&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Semi-literal strings&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">^&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;caret&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Negation, beginning of line&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">&nbsp;~</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;tilde, squiggle&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Negation, directory shortcut&nbsp;</span></span>
</td></tr><a id="calibre_link-630"></a><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">#&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;hash, sharp, pound&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Comments, preprocessor, substitutions&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">[ ]&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;(square) brackets&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Ranges&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">{ }&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;braces, (curly) brackets&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Statement blocks, ranges&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">_&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;underscore, under&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Cheap substitute for a space used when spaces aren’t wanted or allowed, or when autocomplete algorithms get confused&nbsp;</span></span>
</td></tr></table><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You will often see control characters marked with a caret; for example, ^C for </span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-C.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-57" class="calibre_42"><span class="calibre1"><span class="bold"> 2.11 Command-Line Editing</span></span></p><p class="calibre_24"><span class="calibre_13">As you play with the shell, notice that you can edit the command line using the left and right arrow keys, as well as page through previous commands using the up and down arrows. This is standard on most Linux systems.</span></p><p class="calibre_27"><span class="calibre_13"> However, it’s a good idea to forget about the arrow keys and use control key combinations instead. If you learn the ones listed in </span><a></a><a href="#calibre_link-489"><span class="italic"><span class="calibre_4">Table 2-2</span></span></a><span class="calibre_13">, you’ll find that you’re better able to enter text in the many Unix programs that use these standard keystrokes.</span></p><p id="calibre_link-489" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 2-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Command-Line Keystrokes</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Keystroke&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Action&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-B </span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Move the cursor left&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-F </span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Move the cursor right&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-P </span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;View the previous command (or move the cursor up)&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-N </span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;View the next command (or move the cursor down)&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-A </span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Move the cursor to the beginning of the line&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-E </span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Move the cursor to the end of the line&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-W </span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Erase the preceding word&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-U </span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Erase from cursor to beginning of line&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-K </span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Erase from cursor to end of line&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-Y </span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Paste erased text (for example, from </span></span><span class="calibre3">CTRL&nbsp;</span><span class="calibre3"><span class="calibre_13">-U) </span></span>
</td></tr></table><div class="mbp_pagebreak"></div><p id="calibre_link-58" class="calibre_23"><span class="calibre1"><span class="bold"> 2.12 Text Editors</span></span></p><p class="calibre_24"><span class="calibre_13">Speaking of editing, it’s time to learn an editor. To get serious with Unix, you must be able to edit text files without damaging them. Most parts of the system use plaintext configuration files (like the ones in </span><span class="italic">/etc</span><span class="calibre_13">). It’s not difficult to edit files, but you will do it so often that you need a powerful tool for the job.</span></p><p id="calibre_link-719" class="calibre_27"><span class="calibre_13">You should try to learn one of the two de facto standard Unix text editors, vi and Emacs. Most Unix wizards are religious about their choice of editor, but don’t listen to them. Just choose for yourself. If you choose one that matches the way that you work, you’ll find it easier to learn. Basically, the choice comes down to this:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">If you want an editor that can do almost anything and has extensive online help, and you don’t mind doing some extra typing to get these features, try Emacs.</li><li value="2" class="calibre_8">If speed is everything, give vi a shot; it “plays” a bit like a video game.</li></ul><p class="calibre_33"><span class="italic">Learning the vi and Vim Editors: Unix Text Processing</span><span class="calibre_13">, 7th edition, by Arnold Robbins, Elbert Hannah, and Linda Lamb (O’Reilly, 2008), can tell you everything you need to know about vi. For Emacs, use the online tutorial: start Emacs, press </span>CTRL<span class="calibre_13">-H, and then type T. Or read </span><span class="italic">GNU Emacs Manual</span><span class="calibre_13">, 18th edition, by Richard M. Stallman (Free Software Foundation, 2018).</span></p><p class="calibre_27"><span class="calibre_13">You might be tempted to experiment with a friendlier editor when you first start out, such as nano, Pico, or one of the myriad GUI editors out there, but if you tend to make a habit out of the first thing that you use, you don’t want to go this route.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Editing text is where you’ll first start to see a difference between the terminal and the GUI. Editors such as vi run inside the terminal window, using the standard terminal I/O interface. GUI editors start their own window and present their own interface, independent of terminals. Emacs runs in a GUI by default but will run in a terminal window as well.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-59" class="calibre_42"><span class="calibre1"><span class="bold"> 2.13 Getting Online Help</span></span></p><p class="calibre_24"><span class="calibre_13">Linux systems come with a wealth of documentation. For basic commands, the manual pages (or </span><span class="italic">man pages</span><span class="calibre_13">) will tell you what you need to know. For example, to see the manual page for the </span><span class="calibre3">ls</span><span class="calibre_13"> command, run </span><span class="calibre3">man</span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">man ls</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Most manual pages concentrate primarily on reference information, perhaps with some examples and cross-references, but that’s about it. Don’t expect a tutorial, and don’t expect an engaging literary style.</span></p><p class="calibre_27"><span class="calibre_13">When programs have many options, the manual page often lists the options in some systematic way (for example, in alphabetical order), but it won’t tell you what the important ones are. If you’re patient, you can usually find what you need to know in the man page. If you’re impatient, ask a friend&mdash;or pay someone to be your friend so that you can ask him or her.</span></p><p class="calibre_27"><span class="calibre_13"> To search for a manual page by keyword, use the </span><span class="calibre3">-k</span><span class="calibre_13"> option:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">man -k </span></span><span class="calibre3"><span class="italic"><span class="bold">keyword</span></span></span></blockquote></blockquote><p id="calibre_link-743" class="calibre_30"><span class="calibre_13">This is helpful if you don’t quite know the name of the command that you want. For example, if you’re looking for a command to sort something, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">man -k sort</span></span><span class="calibre3"><br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />comm (1) - compare two sorted files line by line<br class="calibre7" />qsort (3) - sorts an array<br class="calibre7" />sort (1) - sort lines of text files<br class="calibre7" />sortm (1) - sort messages<br class="calibre7" />tsort (1) - perform topological sort<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output includes the manual page name, the manual section (see below), and a quick description of what the manual page contains.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you have any questions about the commands described in the previous sections, you may be able to find the answers by using the </span></span><span class="calibre3">man</span><span class="italic"><span class="calibre_13"> command.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Manual pages are referenced by numbered sections. When someone refers to a manual page, they often put the section number in parentheses next to the name, like ping(8). </span><a></a><a href="#calibre_link-490"><span class="italic"><span class="calibre_4">Table 2-3</span></span></a><span class="calibre_13"> lists the sections and their numbers.</span></p><p id="calibre_link-490" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 2-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Online Manual Sections</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Section&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Description&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;1&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;User commands&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;2&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Kernel system calls&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;3&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Higher-level Unix programming library documentation &nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;4&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Device interface and driver information&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;5&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;File descriptions (system configuration files)&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;6&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Games&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;7&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;File formats, conventions, and encodings (ASCII, suffixes, and so on)&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;8&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;System commands and servers&nbsp;</span></span>
</td></tr></table><p class="calibre_37"><span class="calibre_13">Sections 1, 5, 7, and 8 should be good supplements to this book. Section 4 may be of marginal use, and Section 6 would be great if only it were a little larger. You probably won’t be able to use Section 3 if you aren’t a programmer, but you may be able to understand some of the material in Section 2 once you’ve read more about system calls in this book.</span></p><p class="calibre_27"><span class="calibre_13"> Some common terms have many matching manual pages across several sections. By default, </span><span class="calibre3">man</span><span class="calibre_13"> displays the first page that it finds. You can select a manual page by section. For example, to read the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file description (as opposed to the </span><span class="calibre3">passwd</span><span class="calibre_13"> command), you can insert the section number before the page name like so:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">man 5 passwd</span></span></blockquote></blockquote><p id="calibre_link-554" class="calibre_30"><span class="calibre_13">Manual pages cover the essentials, but there are many more ways to get online help (aside from searching the internet). If you’re just looking for a certain option for a command, try entering a command name followed by </span><span class="calibre3">--help</span><span class="calibre_13"> or </span><span class="calibre3">-h</span><span class="calibre_13"> (the option varies from command to command). You may get a deluge (as in the case of </span><span class="calibre3">ls --help</span><span class="calibre_13">), or you may find just what you’re looking for.</span></p><p class="calibre_27"><span class="calibre_13"> Some time ago, the GNU Project decided that it didn’t like manual pages very much and switched to another format called </span><span class="italic">info</span><span class="calibre_13"> (or </span><span class="italic">texinfo</span><span class="calibre_13">). Often this documentation goes further than a typical manual page does, but it can be more complex. To access an info manual, use </span><span class="calibre3">info</span><span class="calibre_13"> with the command name:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">info </span></span><span class="calibre3"><span class="italic"><span class="bold">command</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you don’t like the </span><span class="calibre3">info</span><span class="calibre_13"> reader, you can send the output to </span><span class="calibre3">less</span><span class="calibre_13"> (just add </span><span class="calibre3">| less</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> Some packages dump their available documentation into </span><span class="italic">/usr/share/doc</span><span class="calibre_13"> with no regard for online manual systems such as </span><span class="calibre3">man</span><span class="calibre_13"> or </span><span class="calibre3">info</span><span class="calibre_13">. See this directory on your system if you find yourself searching for documentation&mdash;and, of course, search the internet.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-60" class="calibre_23"><span class="calibre1"><span class="bold"> 2.14 Shell Input and Output</span></span></p><p class="calibre_24"><span class="calibre_13">Now that you’re familiar with basic Unix commands, files, and directories, you’re ready to learn how to redirect standard input and output. Let’s start with standard output.</span></p><p class="calibre_27"><span class="calibre_13"> To send the output of </span><span class="calibre3"><span class="italic">command</span></span><span class="calibre_13"> to a file instead of the terminal, use the </span><span class="calibre3">&gt;</span><span class="calibre_13"> redirection character:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="italic"><span class="bold">command</span></span></span><span class="calibre3"><span class="bold"> &gt; </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The shell creates </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> if it does not already exist. If </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> exists, the shell erases (</span><span class="italic">clobbers</span><span class="calibre_13">) the original file first. (Some shells have parameters that prevent clobbering. For example, you can enter </span><span class="calibre3">set -C</span><span class="calibre_13"> to avoid clobbering in </span><span class="calibre3">bash</span><span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13"> You can append the output to the file instead of overwriting it with the </span><span class="calibre3">&gt;&gt;</span><span class="calibre_13"> redirection syntax:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="italic"><span class="bold">command</span></span></span><span class="calibre3"><span class="bold"> &gt;&gt; </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This is a handy way to collect output in one place when executing sequences of related commands.</span></p><p class="calibre_27"><span class="calibre_13"> To send the standard output of a command to the standard input of another command, use the pipe character (</span><span class="calibre3">|</span><span class="calibre_13">). To see how this works, try these two commands:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">head /proc/cpuinfo</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">head /proc/cpuinfo | tr a-z A-Z</span></span></blockquote></blockquote><p id="calibre_link-555" class="calibre_30"><span class="calibre_13">You can send output through as many piped commands as you wish; just add another pipe before each additional command.</span></p><p id="calibre_link-61" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.14.1 Standard Error</span></span></span></p><p class="calibre_45"><span class="calibre_13">Occasionally, you may redirect standard output but find that the program still prints something to the terminal. This is called </span><span class="italic">standard error</span><span class="calibre_13"> (stderr); it’s an additional output stream for diagnostics and debugging. For example, this command produces an error:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls /fffffffff &gt; f</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> After completion, </span><span class="italic">f</span><span class="calibre_13"> should be empty, but you still see the following error message on the terminal as standard error:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">ls: cannot access /fffffffff: No such file or directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can redirect the standard error if you like. For example, to send standard output to </span><span class="italic">f</span><span class="calibre_13"> and standard error to </span><span class="italic">e</span><span class="calibre_13">, use the </span><span class="calibre3">2&gt;</span><span class="calibre_13"> syntax, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls /fffffffff &gt; f 2&gt; e</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The number 2 specifies the </span><span class="italic">stream ID</span><span class="calibre_13"> that the shell modifies. Stream ID 1 is standard output (the default), and 2 is standard error.</span></p><p class="calibre_27"><span class="calibre_13"> You can also send the standard error to the same place as stdout with the </span><span class="calibre3">&gt;&amp;</span><span class="calibre_13"> notation. For example, to send both standard output and standard error to the file named </span><span class="italic">f</span><span class="calibre_13">, try this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls /fffffffff &gt; f 2&gt;&amp;1</span></span></blockquote></blockquote><p id="calibre_link-62" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">2.14.2 Standard Input Redirection</span></span></span></p><p class="calibre_45"><span class="calibre_13">To channel a file to a program’s standard input, use the </span><span class="calibre3">&lt;</span><span class="calibre_13"> operator:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">head &lt; /proc/cpuinfo</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You will occasionally run into a program that requires this type of redirection, but because most Unix commands accept filenames as arguments, this isn’t very common. For example, the preceding command could have been written as </span><span class="calibre3">head /proc/cpuinfo</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-63" class="calibre_23"><span class="calibre1"><span class="bold"> 2.15 Understanding Error Messages</span></span></p><p class="calibre_24"><span class="calibre_13">When you encounter a problem on a Unix-like system such as Linux, you </span><span class="italic">must</span><span class="calibre_13"> read the error message. Unlike messages from other operating systems, Unix errors usually tell you exactly what went wrong.</span></p><p id="calibre_link-64" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.15.1 Anatomy of a Unix Error Message</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most Unix programs generate and report the same basic error messages, but there can be subtle differences between the output of any two programs. Here’s an example that you’ll certainly encounter in some form or other:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls /dsafsda</span></span><span class="calibre3"><br class="calibre7" />ls: cannot access /dsafsda: No such file or directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">There are three components to this message:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The program name, <span class="calibre3">ls</span>. Some programs omit this identifying information, which can be annoying when you’re writing shell scripts, but it’s not really a big deal.</li><li value="2" class="calibre_8"> The filename, <span class="calibre3">/dsafsda</span>, which is a more specific piece of information. There’s a problem with this path.</li><li value="3" class="calibre_8"> The error <span class="calibre3">No such file or directory</span> indicates the problem with the filename.</li></ul><p class="calibre_33"><span class="calibre_13"> Putting it all together, you get something like “</span><span class="calibre3">ls</span><span class="calibre_13"> tried to open </span><span class="calibre3">/dsafsda</span><span class="calibre_13"> but couldn’t because it doesn’t exist.” This may seem obvious, but these messages can get a little confusing when you run a shell script that includes an erroneous command under a different name.</span></p><p class="calibre_27"><span class="calibre_13"> When troubleshooting errors, always address the first error first. Some programs report that they can’t do anything before reporting a host of other problems. For example, say you run a fictitious program called </span><span class="calibre3">scumd</span><span class="calibre_13"> and you see this error message:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">scumd: cannot access /etc/scumd/config: No such file or directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Following this is a huge list of other error messages that looks like a complete catastrophe. Don’t let those other errors distract you. You probably just need to create </span><span class="italic">/etc/scumd/config</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t confuse error messages with warning messages. Warnings often look like errors, but they contain the word </span></span>warning<span class="italic"><span class="calibre_13">. A warning usually means something is wrong but the program will try to continue running anyway. To fix a problem noted in a warning message, you may have to hunt down a process and kill it before doing anything else. (You’ll learn about listing and killing processes in </span></span><span class="italic">Section 2.16</span><span class="italic"><span class="calibre_13">.)</span></span></blockquote><p id="calibre_link-65" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.15.2 Common Errors</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many errors you’ll encounter in Unix programs result from things that can go wrong with files and processes. Quite a few of these errors stem directly from conditions that kernel system calls encounter, so you can learn something about how the kernel sends problems back to processes by looking at them.</span></p><p id="calibre_link-599" class="calibre_46"><span class="bold">No such file or directory</span></p><p class="calibre_25"><span class="calibre_13">This is the number one error. You tried to access a file that doesn’t exist. Because the Unix file I/O system doesn’t discriminate much between files and directories, this error message covers both cases. You get it when you try to read a file that doesn’t exist, when you try to change to a directory that isn’t there, when you try to write to a file in a directory that doesn’t exist, and so on. This error is also known as ENOENT, short for “Error NO ENTity.”</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re interested in system calls, this is usually the result of </span></span><span class="calibre3">open()</span><span class="italic"><span class="calibre_13"> returning ENOENT. See the open(2) manual page for more information on the errors it can encounter.</span></span></blockquote><p class="calibre_23"><span class="bold">File exists</span></p><p class="calibre_25"><span class="calibre_13">In this case, you probably tried to create a file that already exists. This is common when you try to create a directory with the same name as a file.</span></p><p class="calibre_46"><span class="bold">Not a directory, Is a directory</span></p><p class="calibre_25"><span class="calibre_13">These messages pop up when you try to use a file as a directory, or a directory as a file. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">touch a</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">touch a/b</span></span><span class="calibre3"><br class="calibre7" />touch: a/b: Not a directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice that the error message applies only to the </span><span class="calibre3">a</span><span class="calibre_13"> part of </span><span class="calibre3">a/b</span><span class="calibre_13">. When you encounter this problem, you may need to dig around a little to find the path component that is being treated like a directory.</span></p><p class="calibre_46"><span class="bold">No space left on device</span></p><p class="calibre_25"><span class="calibre_13">You’re out of disk space.</span></p><p class="calibre_46"><span class="bold">Permission denied</span></p><p class="calibre_25"><span class="calibre_13">You get this error when you attempt to read or write to a file or directory that you’re not allowed to access (you have insufficient privileges). This error also shows when you try to execute a file that does not have the execute bit set (even if you can read the file). You’ll read more about permissions in </span>Section 2.17<span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">Operation not permitted</span></p><p class="calibre_25"><span class="calibre_13">This usually happens when you try to kill a process that you don’t own.</span></p><p class="calibre_46"><span class="bold">Segmentation fault, Bus error</span></p><p class="calibre_25"><span class="calibre_13">A </span><span class="italic">segmentation fault</span><span class="calibre_13"> essentially means that the person who wrote the program that you just ran screwed up somewhere. The program tried to access a part of memory that it was not allowed to touch, and the operating system killed it. Similarly, a </span><a id="calibre_link-600"></a><span class="italic">bus error</span><span class="calibre_13"> means that the program tried to access some memory in a way it shouldn’t have. When you get one of these errors, you might be giving a program some input that it did not expect. In rare cases, it might be faulty memory hardware.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-66" class="calibre_23"><span class="calibre1"><span class="bold"> 2.16 Listing and Manipulating Processes</span></span></p><p class="calibre_24"><span class="calibre_13">Recall from </span>Chapter 1<span class="calibre_13"> that a process is a running program. Each process on the system has a numeric </span><span class="italic">process ID</span><span class="calibre_13">
</span><span class="italic">(PID)</span><span class="calibre_13">. For a quick listing of running processes, just run </span><span class="calibre3"><span class="bold">ps</span></span><span class="calibre_13"> on the command line. You should get a list like this one:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps</span></span><span class="calibre3"> PID TTY STAT TIME COMMAND 520 p0&nbsp; S&nbsp;&nbsp;&nbsp; 0:00 -bash 545&nbsp; ?&nbsp; S&nbsp;&nbsp;&nbsp; 3:59 /usr/X11R6/bin/ctwm -W 548&nbsp; ?&nbsp; S&nbsp;&nbsp;&nbsp; 0:10 xclock -geometry -0-0 2159 pd&nbsp; SW&nbsp;&nbsp; 0:00 /usr/bin/vi lib/addresses<br class="calibre7" />31956 p3&nbsp; R&nbsp;&nbsp;&nbsp; 0:00 ps</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The fields are as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">PID</span></span> The process ID.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">TTY</span></span> The terminal device where the process is running. More about this later.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">STAT</span></span> The process status&mdash;that is, what the process is doing and where its memory resides. For example, <span class="calibre3">S</span> means sleeping and <span class="calibre3">R</span> means running. (See the ps(1) manual page for a description of all the symbols.)</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">TIME</span></span> The amount of CPU time in minutes and seconds that the process has used so far. In other words, the total amount of time that the process has spent running instructions on the processor. Remember that because processes don’t run constantly, this is different from the time since the process started (or “wall-clock time”).</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">COMMAND</span></span> This one might seem obvious as the command used to run the program, but be aware that a process can change this field from its original value. Furthermore, the shell can perform glob expansion, and this field will reflect the expanded command instead of what you enter at the prompt.</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> PIDs are unique for each process running on a system. However, after a process terminates, the kernel can eventually reuse the PID for a new process.</span></span></blockquote><p id="calibre_link-67" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.16.1 ps Command Options</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">ps</span><span class="calibre_13"> command has many options. To make things more confusing, you can specify options in three different styles&mdash;Unix, BSD, and GNU. Many people find the BSD style to be the most comfortable (perhaps because it involves less typing), so that’s what we’ll use in this book. Here are some of the most useful option combinations:</span><a id="calibre_link-549"></a></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">ps x</span></span> Show all of your running processes.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">ps ax</span></span> Show all processes on the system, not just the ones you own.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">ps u</span></span> Include more detailed information on processes.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">ps w</span></span> Show full command names, not just what fits on one line.</li></ol><p class="calibre_33"><span class="calibre_13"> As with other programs, you can combine options, as in </span><span class="calibre3">ps aux</span><span class="calibre_13"> and </span><span class="calibre3">ps auxw</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> To check on a specific process, add its PID to the argument list of the </span><span class="calibre3">ps</span><span class="calibre_13"> command. For example, to inspect the current shell process, you can use </span><span class="calibre3">ps u $$</span><span class="calibre_13"> (</span><span class="calibre3">$$</span><span class="calibre_13"> is a shell variable that evaluates to the current shell’s PID). You’ll find information on the administration commands </span><span class="calibre3">top</span><span class="calibre_13"> and </span><span class="calibre3">lsof</span><span class="calibre_13"> in </span>Chapter 8<span class="calibre_13">. These can be useful for locating processes, even when you’re doing something other than system maintenance.</span></p><p id="calibre_link-68" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.16.2 Process Termination</span></span></span></p><p class="calibre_45"><span class="calibre_13">To terminate a process, you send it a </span><span class="italic">signal</span><span class="calibre_13">&mdash;a message to a process from the kernel&mdash;with the </span><span class="calibre3">kill</span><span class="calibre_13"> command. In most cases, all you need to do is this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">kill </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> There are many types of signals. The default (used above) is </span><span class="calibre3">TERM</span><span class="calibre_13">, or terminate. You can send different signals by adding an extra option to </span><span class="calibre3">kill</span><span class="calibre_13">. For example, to freeze a process instead of terminating it, use the </span><span class="calibre3">STOP</span><span class="calibre_13"> signal:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">kill -STOP </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A stopped process is still in memory, ready to pick up where it left off. Use the </span><span class="calibre3">CONT</span><span class="calibre_13"> signal to continue running the process again:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">kill -CONT </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Using </span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-C to terminate a process that is running in the current terminal is the same as using </span></span><span class="calibre3">kill</span><span class="italic"><span class="calibre_13"> to end the process with the </span></span><span class="calibre3">INT</span><span class="italic"><span class="calibre_13"> (interrupt) signal.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The kernel gives most processes a chance to clean up after themselves upon receiving signals (with the </span><span class="italic">signal handler</span><span class="calibre_13"> mechanism). However, some processes may choose a nonterminating action in response to a signal, get wedged in the act of trying to handle it, or simply ignore it, so you might find a process still running after you try to terminate it. If this happens and you really need to kill a process, the most brutal way to terminate it is with the </span><span class="calibre3">KILL</span><span class="calibre_13"> signal. Unlike other signals, </span><span class="calibre3">KILL</span><span class="calibre_13"> cannot be ignored; in fact, the operating system doesn’t even give the process a chance. The kernel just terminates the process and forcibly removes it from memory. Use this method only as a last resort.</span></p><p id="calibre_link-577" class="calibre_27"><span class="calibre_13">You should not kill processes indiscriminately, especially if you don’t know what they’re doing. You may be shooting yourself in the foot.</span></p><p class="calibre_27"><span class="calibre_13"> You may see other users entering numbers instead of names with </span><span class="calibre3">kill</span><span class="calibre_13">&mdash;for example, </span><span class="calibre3">kill -9</span><span class="calibre_13"> instead of </span><span class="calibre3">kill -KILL</span><span class="calibre_13">. This is because the kernel uses numbers to denote the different signals; you can use </span><span class="calibre3">kill</span><span class="calibre_13"> this way if you know the number of the signal that you want to send. Run </span><span class="calibre3"><span class="bold">kill -l</span></span><span class="calibre_13"> to get a mapping of signal numbers to names.</span></p><p id="calibre_link-69" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.16.3 Job Control</span></span></span></p><p class="calibre_45"><span class="calibre_13">Shells support </span><span class="italic">job control</span><span class="calibre_13">, a way to send </span><span class="calibre3">TSTP</span><span class="calibre_13"> (similar to </span><span class="calibre3">STOP</span><span class="calibre_13">) and </span><span class="calibre3">CONT</span><span class="calibre_13"> signals to programs by using various keystrokes and commands. This allows you to suspend and switch between programs you’re using. For example, you can send a </span><span class="calibre3">TSTP</span><span class="calibre_13"> signal with </span>CTRL<span class="calibre_13">-Z and then start the process again by entering </span><span class="calibre3">fg</span><span class="calibre_13"> (bring to foreground) or </span><span class="calibre3">bg</span><span class="calibre_13"> (move to background; see the next section). But despite its utility and the habits of many experienced users, job control is not necessary and can be confusing for beginners: It’s common for users to press </span>CTRL-<span class="calibre_13">Z instead of </span>CTRL<span class="calibre_13">-C, forget about what they were running, and eventually end up with numerous suspended processes.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE &nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> To see if you’ve accidentally suspended any processes on your current terminal, run the </span></span><span class="calibre3"><span class="bold">jobs</span></span><span class="italic"><span class="calibre_13"> command.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> If you want to run multiple programs, run each in a separate terminal window, put noninteractive processes in the background (as explained in the next section), and learn to use the </span><span class="calibre3">screen</span><span class="calibre_13"> and </span><span class="calibre3">tmux</span><span class="calibre_13"> utilities.</span></p><p id="calibre_link-70" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.16.4 Background Processes</span></span></span></p><p class="calibre_45"><span class="calibre_13">Normally, when you run a Unix command from the shell, you don’t get the shell prompt back until the program finishes executing. However, you can detach a process from the shell and put it in the “background” with the ampersand (</span><span class="calibre3">&amp;</span><span class="calibre_13">); this gives you the prompt back. For example, if you have a large file that you need to decompress with </span><span class="calibre3">gunzip</span><span class="calibre_13"> (you’ll see this in </span>Section 2.18<span class="calibre_13">), and you want to do some other stuff while it’s running, run a command like this one:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">gunzip </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.gz &amp;</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The shell should respond by printing the PID of the new background process, and the prompt should return immediately so that you can continue working. If the process takes a very long time, it can even continue to run after you log out, which comes in particularly handy if you have to run a program that does a lot of number crunching. If the process finishes before you log out or close the terminal window, the shell usually notifies you, depending on your setup.</span></p><blockquote id="calibre_link-758" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re remotely accessing a machine and want to keep a program running when you log out, you may need to use the </span></span><span class="calibre3">nohup</span><span class="italic"><span class="calibre_13"> command; see its manual page for details.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The dark side of running background processes is that they may expect to work with the standard input (or worse, read directly from the terminal). If a program tries to read something from the standard input when it’s in the background, it can freeze (try </span><span class="calibre3">fg</span><span class="calibre_13"> to bring it back) or terminate. Also, if the program writes to the standard output or standard error, the output can appear in the terminal window with no regard for anything else running there, meaning that you can get unexpected output when you’re working on something else.</span></p><p class="calibre_27"><span class="calibre_13"> The best way to make sure that a background process doesn’t bother you is to redirect its output (and possibly input) as described in </span>Section 2.14<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If spurious output from background processes gets in your way, learn how to redraw the content of your terminal window. The </span><span class="calibre3">bash</span><span class="calibre_13"> shell and most full-screen interactive programs support </span>CTRL<span class="calibre_13">-L to redraw the entire screen. If a program is reading from the standard input, </span>CTRL<span class="calibre_13">-R usually redraws the current line, but pressing the wrong sequence at the wrong time can leave you in an even worse situation than before. For example, entering </span>CTRL<span class="calibre_13">-R at the </span><span class="calibre3">bash</span><span class="calibre_13"> prompt puts you in reverse isearch mode (press </span>ESC<span class="calibre_13"> to exit).</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-71" class="calibre_23"><span class="calibre1"><span class="bold"> 2.17 File Modes and Permissions</span></span></p><p class="calibre_24"><span class="calibre_13">Every Unix file has a set of </span><span class="italic">permissions</span><span class="calibre_13"> that determine whether you can read, write, or run the file. Running </span><span class="calibre3">ls -l</span><span class="calibre_13"> displays the permissions. Here’s an example of such a display:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">-rw-r--r--1 1 juser somegroup 7041&nbsp; Mar 26 19:34&nbsp; endnotes.html</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The file’s </span><span class="italic">mode</span><span class="calibre_13">
</span>1<span class="calibre_13"> represents the file’s permissions and some extra information. There are four parts to the mode, as illustrated in </span><a></a><a href="#calibre_link-491"><span class="italic"><span class="calibre_4">Figure 2-1</span></span></a><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000026.jpg" class="calibre_57" />
</p><p id="calibre_link-491" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 2-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: The pieces of a file mode</span></span></span></p><p class="calibre_37"><span class="calibre_13"> The first character of the mode is the </span><span class="italic">file type</span><span class="calibre_13">. A dash (</span><span class="calibre3">-</span><span class="calibre_13">) in this position, as in the example, denotes a </span><span class="italic">regular</span><span class="calibre_13"> file, meaning that there’s nothing special about the file; it’s just binary or text data. This is by far the most common kind of file. Directories are also common and are indicated by a </span><span class="calibre3">d</span><span class="calibre_13"> in the file type slot. (</span>Section 3.1<span class="calibre_13"> lists the remaining file types.)</span></p><p id="calibre_link-619" class="calibre_27"><span class="calibre_13">The rest of a file’s mode contains the permissions, which break down into three sets: </span><span class="italic">user</span><span class="calibre_13">, </span><span class="italic">group</span><span class="calibre_13">, and </span><span class="italic">other</span><span class="calibre_13">, in that order. For example, the </span><span class="calibre3">rw-</span><span class="calibre_13"> characters in the example are the user permissions, the </span><span class="calibre3">r--</span><span class="calibre_13"> characters that follow are the group permissions, and the final </span><span class="calibre3">r--</span><span class="calibre_13"> characters are the other permissions.</span></p><p class="calibre_27"><span class="calibre_13">Each permission set can contain four basic representations:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"><span class="calibre3">r</span> means that the file is readable.</li><li value="2" class="calibre_8"><span class="calibre3">w</span> means that the file is writable.</li><li value="3" class="calibre_8"><span class="calibre3">x</span> means that the file is executable (you can run it as a program).</li><li value="4" class="calibre_8"><span class="calibre3">-</span> means “nothing” (more specifically, the permission for that slot in the set has not been granted).</li></ul><p class="calibre_33"><span class="calibre_13"> The user permissions (the first set) pertain to the user who owns the file. In the preceding example, that’s </span><span class="calibre3">juser</span><span class="calibre_13">. The second set, group permissions, are for the file’s group (</span><span class="calibre3">somegroup</span><span class="calibre_13"> in the example). Any user in that group can take advantage of these permissions. (Use the </span><span class="calibre3">groups</span><span class="calibre_13"> command to see what group you’re in, and see </span>Section 7.3.5<span class="calibre_13"> for more information.)</span></p><p class="calibre_27"><span class="calibre_13"> Everyone else on the system has access according to the third set, the other permissions, which are sometimes called </span><span class="italic">world</span><span class="calibre_13"> permissions.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Each read, write, and execute permission slot is sometimes called a </span></span>permission bit<span class="italic"><span class="calibre_13"> because the underlying representation in the operating system is a series of bits. Therefore, you may hear people refer to parts of the permissions as “the read bits.”</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Some executable files have an </span><span class="calibre3">s</span><span class="calibre_13"> in the user permissions listing instead of an </span><span class="calibre3">x</span><span class="calibre_13">. This indicates that the executable is </span><span class="italic">setuid</span><span class="calibre_13">, meaning that when you execute the program, it runs as though the file owner is the user instead of you. Many programs use this setuid bit to run as root in order to get the privileges they need to change system files. One example is the </span><span class="calibre3">passwd</span><span class="calibre_13"> program, which needs to change the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file.</span></p><p id="calibre_link-72" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.17.1 Modifying Permissions</span></span></span></p><p class="calibre_45"><span class="calibre_13">To change permissions on a file or directory, use the </span><span class="calibre3">chmod</span><span class="calibre_13"> command. First, pick the set of permissions that you want to change, and then pick the bit to change. For example, to add group (</span><span class="calibre3">g</span><span class="calibre_13">) and world (</span><span class="calibre3">o</span><span class="calibre_13">, for “other”) read (</span><span class="calibre3">r</span><span class="calibre_13">) permissions to </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13">, you could run these two commands:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">chmod g+r </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">chmod o+r </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Or you could do it all in one shot:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">chmod go+r </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p id="calibre_link-620" class="calibre_30"><span class="calibre_13">To remove these permissions, use </span><span class="calibre3">go-r</span><span class="calibre_13"> instead of </span><span class="calibre3">go+r</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Obviously, you shouldn’t make files world-writable because doing so enables anyone on your system to change them. But would this also allow anyone connected to the internet to change them? Probably not, unless your system has a network security hole. In that case, file permissions won’t help you anyway.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">You may sometimes see people changing permissions with numbers, for example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">chmod 644 </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This is called an </span><span class="italic">absolute</span><span class="calibre_13"> change because it sets </span><span class="italic">all</span><span class="calibre_13"> permission bits at once. To understand how this works, you need to know how to represent the permission bits in octal form (each numeral represents a number in base 8, 0 through 7, and corresponds to a permission set). See the chmod(1) manual page or info manual for more.</span></p><p class="calibre_27"><span class="calibre_13"> You don’t really need to know how to construct absolute modes if you prefer to use them; just memorize the modes that you use most often. </span><a></a><a href="#calibre_link-492"><span class="italic"><span class="calibre_4">Table 2-4</span></span></a><span class="calibre_13"> lists the most common ones.</span></p><p id="calibre_link-492" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 2-4</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Absolute Permission Modes</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Mode&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Meaning&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Used for&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">644&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;user: read/write; group, other: read&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;files&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">600&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;user: read/write; group, other: none&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;files&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">755&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;user: read/write/execute; group, other: read/execute&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;directories, programs&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">700&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;user: read/write/execute; group, other: none&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;directories, programs&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">711&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;user: read/write/execute; group, other: execute&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;directories&nbsp;</span></span><span class="calibre_56">
</span></td></tr></table><p class="calibre_37"><span class="calibre_13">Directories also have permissions. You can list the contents of a directory if it’s readable, but you can only access a file in a directory if the directory is executable. You need both in most cases; one common mistake people make when setting the permissions of directories is to accidentally remove the execute permission when using absolute modes.</span></p><p class="calibre_27"><span class="calibre_13"> Finally, you can specify a set of default permissions with the </span><span class="calibre3">umask</span><span class="calibre_13"> shell command, which applies a predefined set of permissions to any new file you create. In general, use </span><span class="calibre3">umask 022</span><span class="calibre_13"> if you want everyone to be able to see all of the files and directories that you create, and use </span><span class="calibre3">umask 077</span><span class="calibre_13"> if you don’t. If you want to make your desired permissions mask apply to new windows and later sessions, you need to put the </span><span class="calibre3">umask</span><span class="calibre_13"> command with the desired mode in one of your startup files, as discussed in </span>Chapter 13<span class="calibre_13">.</span></p><p id="calibre_link-73" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.17.2 Working with Symbolic Links</span></span></span></p><p class="calibre_45"><span class="calibre_13">A </span><span class="italic">symbolic link</span><span class="calibre_13"> is a file that points to another file or a directory, effectively creating an alias (like a shortcut in Windows). Symbolic links offer quick access to obscure directory paths.</span></p><p class="calibre_27"><span class="calibre_13"> In a long directory listing, symbolic links look like this (notice the </span><span class="calibre3">l</span><span class="calibre_13"> as the file type in the file mode):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">lrwxrwxrwx 1 ruser users&nbsp; 11 Feb 27 13:52&nbsp; somedir -&gt; /home/origdir</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you try to access </span><span class="italic">somedir</span><span class="calibre_13"> in this directory, the system gives you </span><span class="italic">/home/origdir</span><span class="calibre_13"> instead. Symbolic links are simply filenames that point to other names. Their names and the paths to which they point don’t have to mean anything. In the preceding example, </span><span class="italic">/home/origdir</span><span class="calibre_13"> doesn’t need to exist.</span></p><p class="calibre_27"><span class="calibre_13"> In fact, if </span><span class="italic">/home/origdir</span><span class="calibre_13"> does not exist, any program that accesses </span><span class="italic">somedir</span><span class="calibre_13"> returns an error reporting that </span><span class="italic">somedir</span><span class="calibre_13"> doesn’t exist (except for </span><span class="calibre3">ls somedir</span><span class="calibre_13">, a command that stupidly informs you that </span><span class="italic">somedir</span><span class="calibre_13"> is </span><span class="italic">somedir</span><span class="calibre_13">). This can be baffling because you can see something named </span><span class="italic">somedir</span><span class="calibre_13"> right in front of your eyes.</span></p><p class="calibre_27"><span class="calibre_13"> This is not the only way that symbolic links can be confusing. Another problem is that you can’t identify the characteristics of a link target just by looking at the name of the link; you must follow the link to see if it goes to a file or directory. Your system may also have links that point to other links, which are called </span><span class="italic">chained symbolic links</span><span class="calibre_13"> and can be a nuisance when you’re trying to track them down.</span></p><p class="calibre_27"><span class="calibre_13"> To create a symbolic link from </span><span class="italic">target</span><span class="calibre_13"> to </span><span class="italic">linkname</span><span class="calibre_13">, use </span><span class="calibre3">ln -s</span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ln -s </span></span><span class="calibre3"><span class="italic"><span class="bold">target</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">linkname</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3"><span class="italic">linkname</span></span><span class="calibre_13"> argument is the name of the symbolic link, the </span><span class="calibre3"><span class="italic">target</span></span><span class="calibre_13"> argument is the path of the file or directory that the link </span><span class="italic">points</span><span class="calibre_13"> to, and the </span><span class="calibre3">-s</span><span class="calibre_13"> flag specifies a symbolic link (see the warning that follows).</span></p><p class="calibre_27"><span class="calibre_13"> When making a symbolic link, check the command twice before you run it, because several things can go wrong. For example, if you accidentally reverse the order of the arguments (</span><span class="calibre3">ln -s </span><span class="calibre3"><span class="italic">linkname target</span></span><span class="calibre_13">), you’re in for some fun if </span><span class="italic">linkname</span><span class="calibre_13"> is a directory that already exists. If this is the case (and it quite often is), </span><span class="calibre3">ln</span><span class="calibre_13"> creates a link named </span><span class="italic">target</span><span class="calibre_13"> inside </span><span class="italic">linkname,</span><span class="calibre_13"> and the link will point to itself unless </span><span class="italic">linkname</span><span class="calibre_13"> is a full path. If something goes wrong when you create a symbolic link to a directory, check that directory for errant symbolic links and remove them.</span></p><p class="calibre_27"><span class="calibre_13">Symbolic links can also cause headaches when you don’t know that they exist. For example, you can easily edit what you think is a copy of a file but is actually a symbolic link to the original.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t forget the </span></span><span class="calibre3">-s</span><span class="italic"><span class="calibre_13"> option when creating a symbolic link. Without it, </span></span><span class="calibre3">ln</span><span class="italic"><span class="calibre_13"> creates a hard link, giving an additional real filename to a single file. The new filename has the status of the old one; it points (links) directly to the file data instead of to another filename as a symbolic link does. Hard links can be even more confusing than symbolic links. Unless you understand the material in </span></span><span class="italic">Section 4.6</span><span class="italic"><span class="calibre_13">, avoid using them.</span></span></blockquote><p id="calibre_link-563" class="calibre_37"><span class="calibre_13">With all these warnings about symbolic links, you might be wondering why anyone would want to use them. As it turns out, their pitfalls are significantly outweighed by the power they provide for organizing files and their ability to easily patch up small problems. One common use case is when a program expects to find a particular file or directory that already exists somewhere else on your system. You don’t want to make a copy, and if you can’t change the program, you can just create a symbolic link from it to the actual file or directory location.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-74" class="calibre_23"><span class="calibre1"><span class="bold"> 2.18 Archiving and Compressing Files</span></span></p><p class="calibre_24"><span class="calibre_13">Now that you’ve learned about files, permissions, and possible errors, you need to master </span><span class="calibre3">gzip</span><span class="calibre_13"> and </span><span class="calibre3">tar</span><span class="calibre_13">, two common utilities for compressing and bundling files and directories.</span></p><p id="calibre_link-75" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.18.1 gzip</span></span></span></p><p class="calibre_45"><span class="calibre_13">The program </span><span class="calibre3">gzip</span><span class="calibre_13"> (GNU Zip) is one of the current standard Unix compression programs. A file that ends with </span><span class="italic">.gz</span><span class="calibre_13"> is a GNU Zip archive. Use </span><span class="calibre3">gunzip </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre3">.gz</span><span class="calibre_13"> to uncompress </span><span class="italic">&lt;file&gt;.gz</span><span class="calibre_13"> and remove the suffix; to compress the file again, use </span><span class="calibre3">gzip </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13">.</span></p><p id="calibre_link-76" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.18.2 tar</span></span></span></p><p class="calibre_45"><span class="calibre_13">Unlike the ZIP programs for other operating systems, </span><span class="calibre3">gzip</span><span class="calibre_13"> does not create archives of files; that is, it doesn’t pack multiple files and directories into a single file. To create an archive, use </span><span class="calibre3">tar</span><span class="calibre_13"> instead:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">tar cvf </span></span><span class="calibre3"><span class="italic"><span class="bold">archive</span></span></span><span class="calibre3"><span class="bold">.tar </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span><span class="calibre3"><span class="bold"> ...</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Archives created by </span><span class="calibre3">tar</span><span class="calibre_13"> usually have a </span><span class="italic">.tar</span><span class="calibre_13"> suffix (this is by convention; it isn’t required). For example, in the previous command, </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre_13">, </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre_13">, and so on are the names of the files and directories that you wish to archive in </span><span class="italic">&lt;archive&gt;.tar</span><span class="calibre_13">. The </span><span class="calibre3">c</span><span class="calibre_13"> flag activates </span><span class="italic">create mode</span><span class="calibre_13">. The </span><span class="calibre3">v</span><span class="calibre_13"> and </span><span class="calibre3">f</span><span class="calibre_13"> flags have more specific roles.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">v</span><span class="calibre_13"> flag activates verbose diagnostic output, causing </span><span class="calibre3">tar</span><span class="calibre_13"> to print the names of the files and directories in the archive when it encounters them. Adding another </span><span class="calibre3">v</span><span class="calibre_13"> causes </span><span class="calibre3">tar</span><span class="calibre_13"> to print details such as file size and permissions. If you don’t want </span><span class="calibre3">tar</span><span class="calibre_13"> to tell you what it’s doing, omit the </span><span class="calibre3">v</span><span class="calibre_13"> flag.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">f</span><span class="calibre_13"> flag denotes the file option. The next argument on the command line after the </span><span class="calibre3">f</span><span class="calibre_13"> flag must be the archive file for </span><span class="calibre3">tar</span><span class="calibre_13"> to create (in the preceding example, it is </span><span class="italic">&lt;archive&gt;.tar</span><span class="calibre_13">). You </span><span class="italic">must</span><span class="calibre_13"> use this option followed by a filename at all times, except with tape drives. To use standard input or output, set the filename to a dash (</span><span class="calibre3">-</span><span class="calibre_13">).</span></p><p id="calibre_link-565" class="calibre_46"><span class="bold">Unpacking .tar Files</span></p><p class="calibre_25"><span class="calibre_13">To unpack a </span><span class="italic">.tar</span><span class="calibre_13"> file with </span><span class="calibre3">tar</span><span class="calibre_13"> use the </span><span class="calibre3">x</span><span class="calibre_13"> flag:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">tar xvf </span></span><span class="calibre3"><span class="italic"><span class="bold">archive</span></span></span><span class="calibre3"><span class="bold">.tar</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this command, the </span><span class="calibre3">x</span><span class="calibre_13"> flag puts </span><span class="calibre3">tar</span><span class="calibre_13"> into </span><span class="italic">extract</span><span class="calibre_13"> (</span><span class="italic">unpack</span><span class="calibre_13">) </span><span class="italic">mode</span><span class="calibre_13">. You can extract individual parts of the archive by entering the names of the parts at the end of the command line, but you must know their exact names. (To find out for sure, see the table-of-contents mode described next.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> When using extract mode, remember that </span></span><span class="calibre3">tar</span><span class="italic"><span class="calibre_13"> does not remove the archived </span></span>.tar<span class="italic"><span class="calibre_13"> file after extracting its contents.</span></span></blockquote><p class="calibre_23"><span class="bold">Using Table-of-Contents Mode</span></p><p class="calibre_25"><span class="calibre_13">Before unpacking, it’s usually a good idea to check the contents of a </span><span class="italic">.tar</span><span class="calibre_13"> file with the </span><span class="italic">table-of-contents mode</span><span class="calibre_13"> by using the </span><span class="calibre3">t</span><span class="calibre_13"> flag instead of the </span><span class="calibre3">x</span><span class="calibre_13"> flag. This mode verifies the archive’s basic integrity and prints the names of all files inside. If you don’t test an archive before unpacking it, you can end up dumping a huge mess of files into the current directory, which can be really difficult to clean up.</span></p><p class="calibre_27"><span class="calibre_13"> When you check an archive with the </span><span class="calibre3">t</span><span class="calibre_13"> mode, verify that everything is in a rational directory structure; that is, all file pathnames in the archive should start with the same directory. If you’re unsure, create a temporary directory, change to it, and then extract. (You can always use </span><span class="calibre3">mv * ..</span><span class="calibre_13"> if the archive didn’t create a mess.)</span></p><p class="calibre_27"><span class="calibre_13"> When unpacking, consider using the </span><span class="calibre3">p</span><span class="calibre_13"> option to preserve permissions. Use this in extract mode to override your </span><span class="calibre3">umask</span><span class="calibre_13"> and get the exact permissions specified in the archive. The </span><span class="calibre3">p</span><span class="calibre_13"> option is the default when you’re working as the superuser. If you’re having trouble with permissions and ownership when unpacking an archive as the superuser, make sure that you’re waiting until the command terminates and you get the shell prompt back. Although you may only want to extract a small part of an archive, </span><span class="calibre3">tar</span><span class="calibre_13"> must run through the whole thing, and you must not interrupt the process because it sets the permissions only </span><span class="italic">after</span><span class="calibre_13"> checking the entire archive.</span></p><p class="calibre_27"><span class="calibre_13"> Commit </span><span class="italic">all</span><span class="calibre_13"> of the </span><span class="calibre3">tar</span><span class="calibre_13"> options and modes in this section to memory. If you’re having trouble, make some flash cards. This may sound like grade school, but it’s very important to avoid careless mistakes with this command.</span></p><p id="calibre_link-77" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.18.3 Compressed Archives (.tar.gz)</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many beginners find it confusing that archives are normally found compressed, with filenames ending in </span><span class="italic">.tar.gz</span><span class="calibre_13">. To unpack a compressed archive, work from the right side to the left; get rid of the </span><span class="italic">.gz</span><span class="calibre_13"> first and then worry about the </span><span class="italic">.tar</span><span class="calibre_13">. For example, these two commands decompress and unpack </span><span class="italic">&lt;file&gt;.tar.gz</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">gunzip </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.tar.gz</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">tar xvf </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.tar</span></span></blockquote></blockquote><p id="calibre_link-564" class="calibre_30"><span class="calibre_13">When starting out, it’s fine to do this one step at a time, first running </span><span class="calibre3">gunzip</span><span class="calibre_13"> to decompress and then </span><span class="calibre3">tar</span><span class="calibre_13"> to verify and unpack. To create a compressed archive, do the reverse: run </span><span class="calibre3">tar</span><span class="calibre_13"> first and </span><span class="calibre3">gzip</span><span class="calibre_13"> second. Do this frequently enough, and you’ll soon memorize how the archiving and compression process works. But even if you don’t do it all that often, you can see how tiresome all of the typing can become and you’ll start looking for shortcuts. Let’s take a look at those now.</span></p><p id="calibre_link-78" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.18.4 zcat</span></span></span></p><p class="calibre_45"><span class="calibre_13">The method just shown isn’t the fastest or most efficient way to invoke </span><span class="calibre3">tar</span><span class="calibre_13"> on a compressed archive, and it wastes disk space and kernel I/O time. A better way is to combine archival and compression functions with a pipeline. For example, this command pipeline unpacks </span><span class="italic">&lt;file&gt;.tar.gz</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">zcat </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.tar.gz | tar xvf -</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">zcat</span><span class="calibre_13"> command is the same as </span><span class="calibre3">gunzip -dc</span><span class="calibre_13">. The </span><span class="calibre3">-d</span><span class="calibre_13"> option decompresses and the </span><span class="calibre3">-c</span><span class="calibre_13"> option sends the result to standard output (in this case, to the </span><span class="calibre3">tar</span><span class="calibre_13"> command).</span></p><p class="calibre_27"><span class="calibre_13"> Because it’s so common to use </span><span class="calibre3">zcat</span><span class="calibre_13">, the version of </span><span class="calibre3">tar</span><span class="calibre_13"> that comes with Linux has a shortcut. You can use </span><span class="calibre3">z</span><span class="calibre_13"> as an option to automatically invoke </span><span class="calibre3">gzip</span><span class="calibre_13"> on the archive; this works both for extracting an archive (with the </span><span class="calibre3">x</span><span class="calibre_13"> or </span><span class="calibre3">t</span><span class="calibre_13"> modes in </span><span class="calibre3">tar</span><span class="calibre_13">) and creating one (with </span><span class="calibre3">c</span><span class="calibre_13">). For example, use the following to verify a compressed archive:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">tar ztvf </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.tar.gz</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">However, try to remember that you’re actually performing two steps when taking the shortcut.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A </span></span>.tgz<span class="italic"><span class="calibre_13"> file is the same as a </span></span>.tar.gz<span class="italic"><span class="calibre_13"> file. The suffix is meant to fit into FAT (MS-DOS-based) filesystems.</span></span></blockquote><p id="calibre_link-79" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.18.5 Other Compression Utilities</span></span></span></p><p class="calibre_45"><span class="calibre_13">Two more compression programs are </span><span class="calibre3">xz</span><span class="calibre_13"> and </span><span class="calibre3">bzip2</span><span class="calibre_13">, whose compressed files end with </span><span class="italic">.xz</span><span class="calibre_13"> and </span><span class="italic">.bz2</span><span class="calibre_13">, respectively. While marginally slower than </span><span class="calibre3">gzip</span><span class="calibre_13">, these often compact text files a little more. The decompressing programs to use are </span><span class="calibre3">unxz</span><span class="calibre_13"> and </span><span class="calibre3">bunzip2</span><span class="calibre_13">, and the options of both are close enough to their </span><span class="calibre3">gzip</span><span class="calibre_13"> counterparts that you don’t need to learn anything new.</span></p><p class="calibre_27"><span class="calibre_13"> Most Linux distributions come with </span><span class="calibre3">zip</span><span class="calibre_13"> and </span><span class="calibre3">unzip</span><span class="calibre_13"> programs that are compatible with the ZIP archives on Windows systems. They work on the usual </span><span class="italic">.zip</span><span class="calibre_13"> files as well as self-extracting archives ending in </span><span class="italic">.exe</span><span class="calibre_13">. But if you encounter a file that ends in </span><span class="italic">.Z</span><span class="calibre_13">, you have found a relic created by the </span><span class="calibre3">compress</span><span class="calibre_13"> program, which was once the Unix standard. The </span><span class="calibre3">gunzip</span><span class="calibre_13"> program can unpack these files, but </span><span class="calibre3">gzip</span><span class="calibre_13"> won’t create them.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-80" class="calibre_23"><span class="calibre1"><span class="bold">2.19 Linux Directory Hierarchy Essentials</span></span></p><p class="calibre_24"><span class="calibre_13">Now that you know how to examine files, change directories, and read manual pages, you’re ready to start exploring your system files and directories. The details of the Linux directory structure are outlined in the Filesystem Hierarchy Standard, or FHS (</span><span class="italic">https://refspecs.linuxfoundation.org/fhs.shtml</span><span class="calibre_13">), but a brief walkthrough should suffice for now.</span></p><p class="calibre_27"><a href="#calibre_link-493"><span class="italic"><span class="calibre_4">Figure 2-2</span></span></a><span class="calibre_13"> offers a simplified overview of the hierarchy, showing some of the directories under </span><span class="italic">/</span><span class="calibre_13">, </span><span class="italic">/usr</span><span class="calibre_13">, and </span><span class="italic">/var</span><span class="calibre_13">. Notice that the directory structure under </span><span class="italic">/usr</span><span class="calibre_13"> contains some of the same directory names as </span><span class="italic">/</span><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000028.jpg" class="calibre_58" />
</p><p id="calibre_link-493" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 2-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Linux directory hierarchy</span></span></span></p><p class="calibre_37"><span class="calibre_13">Here are the most important subdirectories in root:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="italic"><span class="bold">/bin</span></span> Contains ready-to-run programs (also known as <span class="italic">executables</span>), including most of the basic Unix commands such as <span class="calibre3">ls</span> and <span class="calibre3">cp</span>. Most of the programs in <span class="italic">/bin</span> are in binary format, having been created by a C compiler, but some are shell scripts in modern systems.</li><li value="2" class="calibre_8"><span class="italic"><span class="bold">/dev</span></span> Contains device files. You’ll learn more about these in Chapter 3.</li><li value="3" class="calibre_8"><span class="italic"><span class="bold">/etc</span></span> This core system configuration directory (pronounced <span class="italic">EHT-see</span>) contains the user password, boot, device, networking, and other setup files.</li><li value="4" class="calibre_8"><span class="italic"><span class="bold">/home</span></span> Holds home (personal) directories for regular users. Most Unix installations conform to this standard.</li><li value="5" class="calibre_8"><span class="italic"><span class="bold">/lib</span></span> An abbreviation for <span class="italic">library</span>, this directory holds library files containing code that executables can use. There are two types of libraries: static and shared. The <span class="italic">/lib</span> directory should contain only shared libraries, but other lib directories, such as <span class="italic">/usr/lib,</span> contain both varieties as well as other auxiliary files. (We’ll discuss shared libraries in more detail in Chapter 15.)</li><li value="6" class="calibre_8"><span class="italic"><span class="bold">/proc</span></span> Provides system statistics through a browsable directory-and-file interface. Much of the <span class="italic">/proc</span> subdirectory structure on Linux is unique, but many other Unix variants have similar features. The <span class="italic">/proc</span> directory contains information about currently running processes as well as some kernel parameters.</li><li value="7" class="calibre_8"><span class="italic"><span class="bold">/run</span></span> Contains runtime data specific to the system, including certain process IDs, socket files, status records, and, in many cases, system logging. This is a relatively recent addition to the root directory; in older systems, you can find it in <span class="italic">/var/run</span>. On newer systems, <span class="italic">/var/run</span> is a symbolic link to <span class="italic">/run</span>.</li><a id="calibre_link-585"></a><li value="8" class="calibre_8"><span class="italic"><span class="bold">/sys</span></span> This directory is similar to <span class="italic">/proc</span> in that it provides a device and system interface. You’ll read more about <span class="italic">/sys</span> in Chapter 3.</li><li value="9" class="calibre_8"><span class="italic"><span class="bold">/sbin</span></span> The place for system executables. Programs in /<span class="italic">sbin</span> directories relate to system management, so regular users usually do not have /<span class="italic">sbin</span> components in their command paths. Many of the utilities found here don’t work if not run as root.</li><li value="10" class="calibre_8"><span class="italic"><span class="bold">/tmp</span></span> A storage area for smaller, temporary files that you don’t care much about. Any user may read to and write from <span class="italic">/tmp</span>, but the user may not have permission to access another user’s files there. Many programs use this directory as a workspace. If something is extremely important, don’t put it in <span class="italic">/tmp</span> because most distributions clear <span class="italic">/tmp</span> when the machine boots and some even remove its old files periodically. Also, don’t let <span class="italic">/tmp</span> fill up with garbage because its space is usually shared with something critical (the rest of <span class="italic">/</span>, for example).</li><li value="11" class="calibre_8"><span class="italic"><span class="bold">/usr</span></span> Although pronounced “user,” this subdirectory has no user files. Instead, it contains a large directory hierarchy, including the bulk of the Linux system. Many of the directory names in <span class="italic">/usr</span> are the same as those in the root directory (like <span class="italic">/usr/bin</span> and <span class="italic">/usr/lib</span>), and they hold the same type of files. (The reason that the root directory does not contain the complete system is primarily historic&mdash;in the past, it was to keep space requirements low for the root.)</li><li value="12" class="calibre_8"><span class="italic"><span class="bold">/var</span></span> The variable subdirectory, where programs record information that can change over the course of time. System logging, user tracking, caches, and other files that system programs create and manage are here. (You’ll notice a <span class="italic">/var/tmp</span> directory here, but the system doesn’t wipe it on boot.)</li></ol><p id="calibre_link-81" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.19.1 Other Root Subdirectories</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are a few other interesting subdirectories in the root directory:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="italic"><span class="bold">/boot</span></span> Contains kernel boot loader files. These files pertain only to the very first stage of the Linux startup procedure, so you won’t find information about how Linux starts up its services in this directory. See Chapter 5 for more about this.</li><li value="2" class="calibre_8"><span class="italic"><span class="bold">/media</span></span> A base attachment point for removable media such as flash drives that is found in many distributions.</li><li value="3" class="calibre_8"><span class="italic"><span class="bold">/opt</span></span> This may contain additional third-party software. Many systems don’t use <span class="italic">/opt</span>.</li></ol><p id="calibre_link-82" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.19.2 The /usr Directory</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="italic">/usr</span><span class="calibre_13"> directory may look relatively clean at first glance, but a quick look at </span><span class="italic">/usr/bin</span><span class="calibre_13"> and </span><span class="italic">/usr/lib</span><span class="calibre_13"> reveals that there’s a lot here; </span><span class="italic">/usr</span><span class="calibre_13"> is where most of the user-space programs and data reside. In addition to </span><span class="italic">/usr/bin</span><span class="calibre_13">, </span><span class="italic">/usr/sbin</span><span class="calibre_13">, and </span><span class="italic">/usr/lib</span><span class="calibre_13">, </span><span class="italic">/usr</span><span class="calibre_13"> contains the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="italic"><span class="bold">/include</span></span> Holds header files used by the C compiler.</li><li value="2" class="calibre_8"><span class="italic"><span class="bold">/local</span></span> Is where administrators can install their own software. Its structure should look like that of <span class="italic">/</span> and <span class="italic">/usr</span>.</li><li value="3" class="calibre_8"><span class="italic"><span class="bold">/man</span></span> Contains manual pages.</li><li value="4" class="calibre_8"><span class="italic"><span class="bold">/share</span></span> Contains files that should work on other kinds of Unix machines with no loss of functionality. These are usually auxiliary data files that programs and libraries read as necessary. In the past, networks of machines would share this directory from a file server, but today a <span class="italic">share</span> directory used in this manner is rare because there are no realistic space restraints for these kinds of files on contemporary systems. Instead, on Linux distributions, you’ll find /<span class="italic">man</span>, /<span class="italic">info</span>, and many other subdirectories here because it is an easily understood convention.</li></ol><p id="calibre_link-83" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.19.3 Kernel Location</span></span></span></p><p class="calibre_45"><span class="calibre_13">On Linux systems, the kernel is normally a binary file </span><span class="italic">/vmlinuz</span><span class="calibre_13"> or </span><span class="italic">/boot/vmlinuz</span><span class="calibre_13">. A </span><span class="italic">boot loader</span><span class="calibre_13"> loads this file into memory and sets it in motion when the system boots. (You’ll find details on the boot loader in </span>Chapter 5<span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13"> Once the boot loader starts the kernel, the main kernel file is no longer used by the running system. However, you’ll find many modules that the kernel loads and unloads on demand during the course of normal system operation. Called </span><span class="italic">loadable kernel modules</span><span class="calibre_13">, they are located under </span><span class="italic">/lib/modules</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-84" class="calibre_23"><span class="calibre1"><span class="bold"> 2.20 Running Commands as the Superuser</span></span></p><p class="calibre_24"><span class="calibre_13">Before going any further, you should learn how to run commands as the superuser. You may be tempted to start a root shell, but doing so has many disadvantages:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">You have no record of system-altering commands.</li><li value="2" class="calibre_8">You have no record of the users who performed system-altering commands.</li><li value="3" class="calibre_8">You don’t have access to your normal shell environment.</li><li value="4" class="calibre_8">You have to enter the root password (if you have one).</li></ul><p id="calibre_link-85" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.20.1 sudo</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most distributions use a package called </span><span class="calibre3">sudo</span><span class="calibre_13"> to allow administrators to run commands as root when they are logged in as themselves. For example, in </span>Chapter 7<span class="calibre_13">, you’ll learn about using </span><span class="calibre3">vipw</span><span class="calibre_13"> to edit the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file. You could do it like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sudo vipw</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When you run this command, </span><span class="calibre3">sudo</span><span class="calibre_13"> logs this action with the syslog service under the local2 facility. You’ll also learn more about system logs in </span>Chapter 7<span class="calibre_13">.</span></p><p id="calibre_link-86" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">2.20.2 /etc/sudoers</span></span></span></p><p class="calibre_45"><span class="calibre_13">Of course, the system doesn’t let just </span><span class="italic">any</span><span class="calibre_13"> user run commands as the superuser; you must configure the privileged users in your </span><span class="italic">/etc/sudoers</span><span class="calibre_13"> file. The </span><span class="calibre3">sudo</span><span class="calibre_13"> package has many options (that you’ll probably never use), which makes the syntax in </span><span class="italic">/etc/sudoers</span><span class="calibre_13"> somewhat complicated. For example, this file gives </span><span class="calibre3"><span class="italic">user1</span></span><span class="calibre_13"> and </span><span class="calibre3"><span class="italic">user2</span></span><span class="calibre_13"> the power to run any command as root without having to enter a password:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">User_Alias ADMINS = </span><span class="calibre3"><span class="italic">user1</span></span><span class="calibre3">, </span><span class="calibre3"><span class="italic">user2</span></span><span class="calibre3"><br class="calibre7" />ADMINS ALL = NOPASSWD: ALL<br class="calibre7" />root ALL=(ALL) ALL</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The first line defines an </span><span class="calibre3">ADMINS</span><span class="calibre_13"> user alias with the two users, and the second line grants the privileges. The </span><span class="calibre3">ALL = NOPASSWD: ALL</span><span class="calibre_13"> part means that the users in the </span><span class="calibre3">ADMINS</span><span class="calibre_13"> alias can use </span><span class="calibre3">sudo</span><span class="calibre_13"> to execute commands as root. The second </span><span class="calibre3">ALL</span><span class="calibre_13"> means “any command.” The first </span><span class="calibre3">ALL</span><span class="calibre_13"> means “any host.” (If you have more than one machine, you can set different kinds of access for each machine or group of machines, but we won’t cover that feature.)</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">root ALL=(ALL) ALL</span><span class="calibre_13"> simply means that the superuser may also use </span><span class="calibre3">sudo</span><span class="calibre_13"> to run any command on any host. The extra </span><span class="calibre3">(ALL)</span><span class="calibre_13"> means that the superuser may also run commands as any other user. You can extend this privilege to the </span><span class="calibre3">ADMINS</span><span class="calibre_13"> users by adding </span><span class="calibre3">(ALL)</span><span class="calibre_13"> to the second </span><span class="italic">/etc/sudoers</span><span class="calibre_13"> line, as shown here:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">ADMINS ALL = (ALL) NOPASSWD: ALL</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Use the </span></span><span class="calibre3">visudo</span><span class="italic"><span class="calibre_13"> command to edit </span></span>/etc/sudoers<span class="italic"><span class="calibre_13">. This command checks for file syntax errors after you save the file.</span></span></blockquote><p id="calibre_link-87" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">2.20.3 sudo Logs</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although we’ll go into logs in more detail later in the book, you can find the </span><span class="calibre3">sudo</span><span class="calibre_13"> logs on most systems with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl SYSLOG_IDENTIFIER=sudo</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On older systems, you’ll need to look for a logfile in </span><span class="italic">/var/log</span><span class="calibre_13">, such as </span><span class="italic">/var/log/auth.log</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> That’s it for </span><span class="calibre3">sudo</span><span class="calibre_13"> for now. If you need to use its more advanced features, see the sudoers(5) and sudo(8) manual pages. (The actual mechanics of user switching are covered in </span>Chapter 7<span class="calibre_13">.)</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-88" class="calibre_23"><span class="calibre1"><span class="bold"> 2.21 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">You should now know how to do the following at the command line: run programs, redirect output, interact with files and directories, view process listings, view manual pages, and generally make your way around the user space of a Linux system. You should also be able to run commands as the superuser. You may not yet know much about the internal details of user-space components or what goes on in the kernel, but with the basics of files and processes under your belt, you’re on your way. In the next few chapters, you’ll be working with both kernel and user-space system components using the command-line tools that you just learned.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-89" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-682" class="calibre_10"><span class="calibre4"><span class="bold">3</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">DEVICES</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter is a basic tour of the kernel-provided device infrastructure in a functioning Linux system. Throughout the history of Linux, there have been many changes to how the kernel presents devices to the user. We’ll begin by looking at the traditional system of device files to see how the kernel provides device configuration information through sysfs. Our goal is to be able to extract information about the devices on a system in order to understand a few rudimentary operations. Later chapters will cover interacting with specific kinds of devices in greater detail.</span></span></p><p id="calibre_link-676" class="calibre_33"><span class="calibre_13">It’s important to understand how the kernel interacts with user space when presented with new devices. The udev system enables user-space programs to automatically configure and use new devices. You’ll see the basic workings of how the kernel sends a message to a user-space process through udev, as well as what the process does with it.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-90" class="calibre_23"><span class="calibre1"><span class="bold"> 3.1 Device Files</span></span></p><p class="calibre_24"><span class="calibre_13">It’s easy to manipulate most devices on a Unix system because the kernel presents many of the device I/O interfaces to user processes as files. These </span><span class="italic">device files</span><span class="calibre_13"> are sometimes called </span><span class="italic">device nodes</span><span class="calibre_13">. Aside from programmers using regular file operations to work with devices, some devices are also accessible to standard programs like </span><span class="calibre3">cat</span><span class="calibre_13">, so you don’t have to be a programmer to use a device. However, there is a limit to what you can do with a file interface, so not all devices or device capabilities are accessible with standard file I/O.</span></p><p class="calibre_27"><span class="calibre_13"> Linux uses the same design for device files as do other Unix flavors. Device files are in the </span><span class="italic">/dev</span><span class="calibre_13"> directory, and running </span><span class="calibre3">ls /dev</span><span class="calibre_13"> reveals quite a few files in </span><span class="italic">/dev</span><span class="calibre_13">. So how do you work with devices?</span></p><p class="calibre_27"><span class="calibre_13">To get started, consider this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo blah blah &gt; /dev/null</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Like any other command with redirected output, this sends some stuff from the standard output to a file. However, the file is </span><span class="italic">/dev/null</span><span class="calibre_13">, a device, so the kernel bypasses its usual file operations and uses a device driver on data written to this device. In the case of </span><span class="italic">/dev/null</span><span class="calibre_13">, the kernel simply accepts the input data and throws it away.</span></p><p class="calibre_27"><span class="calibre_13"> To identify a device and view its permissions, use </span><span class="calibre3">ls -l</span><span class="calibre_13">. Here are some examples:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l</span></span><span class="calibre3"><br class="calibre7" />brw-rw----&nbsp;&nbsp; 1 root disk 8, 1 Sep&nbsp; 6 08:37 sda1<br class="calibre7" />crw-rw-rw-&nbsp;&nbsp; 1 root root 1, 3 Sep&nbsp; 6 08:37 null<br class="calibre7" />prw-r--r--&nbsp;&nbsp; 1 root root&nbsp;&nbsp;&nbsp; 0 Mar&nbsp; 3 19:17 fdata<br class="calibre7" />srw-rw-rw-&nbsp;&nbsp; 1 root root&nbsp;&nbsp;&nbsp; 0 Dec 18 07:43 log</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Note the first character of each line (the first character of the file’s mode). If this character is </span><span class="calibre3">b</span><span class="calibre_13">, </span><span class="calibre3">c</span><span class="calibre_13">, </span><span class="calibre3">p</span><span class="calibre_13">, or </span><span class="calibre3">s</span><span class="calibre_13">, the file is a device. These letters stand for </span><span class="italic">block</span><span class="calibre_13">, </span><span class="italic">character</span><span class="calibre_13">, </span><span class="italic">pipe</span><span class="calibre_13">, and </span><span class="italic">socket</span><span class="calibre_13">, respectively:</span></p><p class="calibre_23"><span class="bold">Block device</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> Programs access data from a block device in fixed chunks. The <span class="italic">sda1</span> in the preceding example is a <span class="italic">disk device</span>, a type of block device. Disks can be easily split up into blocks of data. Because a block device’s total size is fixed and easy to index, processes have quick random access to any block in the device with the help of the kernel.</li></ol><p id="calibre_link-680" class="calibre_23"><span class="bold">Character device</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> Character devices work with data streams. You can only read characters from or write characters to character devices, as previously demonstrated with <span class="italic">/dev/null</span>. Character devices don’t have a size; when you read from or write to one, the kernel usually performs a read or write operation on it. Printers directly attached to your computer are represented by character devices. It’s important to note that during character device interaction, the kernel cannot back up and reexamine the data stream after it has passed data to a device or process.</li></ol><p class="calibre_23"><span class="bold">Pipe device</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="italic">Named pipes</span> are like character devices, with another process at the other end of the I/O stream instead of a kernel driver.</li></ol><p class="calibre_23"><span class="bold">Socket device</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="italic">Sockets</span> are special-purpose interfaces that are frequently used for interprocess communication. They’re often found outside of the <span class="italic">/dev</span> directory. Socket files represent Unix domain sockets; you’ll learn more about those in Chapter 10.</li></ol><p class="calibre_33"><span class="calibre_13"> In file listings from </span><span class="calibre3">ls -l</span><span class="calibre_13"> of block and character devices, the numbers before the dates are the </span><span class="italic">major</span><span class="calibre_13"> and </span><span class="italic">minor</span><span class="calibre_13"> device numbers that the kernel uses to identify the device. Similar devices usually have the same major number, such as </span><span class="italic">sda3</span><span class="calibre_13"> and </span><span class="italic">sdb1</span><span class="calibre_13"> (both of which are hard disk partitions).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Not all devices have device files, because the block and character device I/O interfaces are not appropriate in all cases. For example, network interfaces don’t have device files. It is theoretically possible to interact with a network interface using a single character device, but because it would be difficult, the kernel offers other I/O interfaces.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-91" class="calibre_42"><span class="calibre1"><span class="bold"> 3.2 The sysfs Device Path</span></span></p><p class="calibre_24"><span class="calibre_13">The traditional Unix </span><span class="italic">/dev</span><span class="calibre_13"> directory is a convenient way for user processes to reference and interface with devices supported by the kernel, but it’s also a very simplistic scheme. The name of the device in </span><span class="italic">/dev</span><span class="calibre_13"> tells you a little about the device, but usually not enough to be helpful. Another problem is that the kernel assigns devices in the order in which they are found, so a device may have a different name between reboots.</span></p><p class="calibre_27"><span class="calibre_13"> To provide a uniform view for attached devices based on their actual hardware attributes, the Linux kernel offers the </span><span class="italic">sysfs</span><span class="calibre_13"> interface through a system of files and directories. The base path for devices is </span><span class="italic">/sys/devices</span><span class="calibre_13">. For example, the SATA hard disk at </span><span class="italic">/dev/sda</span><span class="calibre_13"> might have the following path in sysfs:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/sys/devices/pci0000:00/0000:00:17.0/ata3/host0/target0:0:0/0:0:0:0/block/sda</span></blockquote></blockquote><p id="calibre_link-664" class="calibre_30"><span class="calibre_13">As you can see, this path is quite long compared with the </span><span class="italic">/dev/sda</span><span class="calibre_13"> filename, which is also a directory. But you can’t really compare the two paths because they have different purposes. The </span><span class="italic">/dev</span><span class="calibre_13"> file enables user processes to use the device, whereas the </span><span class="italic">/sys/devices</span><span class="calibre_13"> path is used to view information and manage the device. If you list the contents of a device path such as the preceding one, you’ll see something like the following:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">alignment_offset&nbsp; discard_alignment&nbsp; holders&nbsp;&nbsp; removable&nbsp; size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; uevent<br class="calibre7" />bdi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; events&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inflight&nbsp; ro&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; slaves<br class="calibre7" />capability&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; events_async&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; power&nbsp;&nbsp;&nbsp;&nbsp; sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stat<br class="calibre7" />dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; events_poll_msecs&nbsp; queue&nbsp;&nbsp;&nbsp;&nbsp; sda2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subsystem<br class="calibre7" />device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext_range&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; range&nbsp;&nbsp;&nbsp;&nbsp; sda5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trace</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The files and subdirectories here are meant to be read primarily by programs rather than humans, but you can get an idea of what they contain and represent by looking at an example such as the /</span><span class="italic">dev</span><span class="calibre_13"> file. Running </span><span class="calibre3">cat dev</span><span class="calibre_13"> in this directory displays the numbers </span><span class="calibre3">8:0</span><span class="calibre_13">, which happen to be the major and minor device numbers of </span><span class="italic">/dev/sda</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> There are a few shortcuts in the </span><span class="italic">/sys</span><span class="calibre_13"> directory. For example, </span><span class="italic">/sys/block</span><span class="calibre_13"> should contain all of the block devices available on a system. However, those are just symbolic links; you’d run </span><span class="calibre3">ls -l /sys/block</span><span class="calibre_13"> to reveal the true sysfs paths.</span></p><p class="calibre_27"><span class="calibre_13"> It can be difficult to find the sysfs location of a device in </span><span class="italic">/dev</span><span class="calibre_13">. Use the </span><span class="calibre3">udevadm</span><span class="calibre_13"> command as follows to show the path and several other interesting attributes:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">udevadm info --query=all --name=/dev/sda</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’ll find more details about </span><span class="calibre3">udevadm</span><span class="calibre_13"> and the entire udev system in </span>Section 3.5<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-92" class="calibre_23"><span class="calibre1"><span class="bold"> 3.3 dd and Devices</span></span></p><p class="calibre_24"><span class="calibre_13">The program </span><span class="calibre3">dd</span><span class="calibre_13"> is extremely useful when you are working with block and character devices. Its sole function is to read from an input file or stream and write to an output file or stream, possibly doing some encoding conversion on the way. One particularly useful </span><span class="calibre3">dd</span><span class="calibre_13"> feature with respect to block devices is that you can process a chunk of data in the middle of a file, ignoring what comes before or after.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="calibre3">dd</span><span class="italic"><span class="calibre_13"> is very powerful, so make sure you know what you’re doing when you run it. It’s very easy to corrupt files and data on devices by making a careless mistake. It often helps to write the output to a new file if you’re not sure what it will do.</span></span></blockquote><p class="calibre_37"><span class="calibre3">dd</span><span class="calibre_13"> copies data in blocks of a fixed size. Here’s how to use </span><span class="calibre3">dd</span><span class="calibre_13"> with a character device, utilizing a few common options:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">dd if=/dev/zero of=new_file bs=1024 count=1</span></span></blockquote></blockquote><p id="calibre_link-665" class="calibre_30"><span class="calibre_13">As you can see, the </span><span class="calibre3">dd</span><span class="calibre_13"> option format differs from the option formats of most other Unix commands; it’s based on an old IBM Job Control Language (JCL) style. Rather than use the dash (</span><span class="calibre3">-</span><span class="calibre_13">) character to signal an option, you name an option and set its value with the equal (</span><span class="calibre3">=</span><span class="calibre_13">) sign. The preceding example copies a single 1,024-byte block from </span><span class="italic">/dev/zero</span><span class="calibre_13"> (a continuous stream of zero bytes) to </span><span class="italic">new_file</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> These are the important </span><span class="calibre3">dd</span><span class="calibre_13"> options:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">if=</span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span> The input file. The default is the standard input.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">of=</span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span> The output file. The default is the standard output.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">bs=</span></span><span class="calibre3"><span class="italic"><span class="bold">size</span></span></span> The block size. <span class="calibre3">dd</span> reads and writes this many bytes of data at a time. To abbreviate large chunks of data, you can use <span class="calibre3">b</span> and <span class="calibre3">k</span> to signify 512 and 1,024 bytes, respectively. Therefore, the preceding example could read <span class="calibre3">bs=1k</span> instead of <span class="calibre3">bs=1024</span>.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">ibs=</span></span><span class="calibre3"><span class="italic"><span class="bold">size</span></span></span><span class="bold">, </span><span class="calibre3"><span class="bold">obs=</span></span><span class="calibre3"><span class="italic"><span class="bold">size</span></span></span> The input and output block sizes. If you can use the same block size for both input and output, use the <span class="calibre3">bs</span> option; if not, use <span class="calibre3">ibs</span> and <span class="calibre3">obs</span> for input and output, respectively.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">count=</span></span><span class="calibre3"><span class="italic"><span class="bold">num</span></span></span> The total number of blocks to copy. When working with a huge file&mdash;or with a device that supplies an endless stream of data, such as <span class="italic">/dev/zero</span>&mdash;you want <span class="calibre3">dd</span> to stop at a fixed point; otherwise, you could waste a lot of disk space, CPU time, or both. Use <span class="calibre3">count</span> with the <span class="calibre3">skip</span><span class="bold">
</span>parameter to copy a small piece from a large file or device.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">skip=</span></span><span class="calibre3"><span class="italic"><span class="bold">num</span></span></span> Skip past the first <span class="calibre3"><span class="italic">num</span></span> blocks in the input file or stream, and do not copy them to the output.</li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-93" class="calibre_23"><span class="calibre1"><span class="bold"> 3.4 Device Name Summary</span></span></p><p class="calibre_24"><span class="calibre_13">It can sometimes be difficult to find the name of a device (for example, when partitioning a disk). Here are a few ways to find out what it is:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Query udevd using <span class="calibre3">udevadm</span> (see Section 3.5).</li><li value="2" class="calibre_8"> Look for the device in the <span class="italic">/sys</span> directory.</li><li value="3" class="calibre_8"> Guess the name from the output of the <span class="calibre3">journalctl -k</span> command (which prints the kernel messages) or the kernel system log (see Section 7.1). This output might contain a description of the devices on your system.</li><li value="4" class="calibre_8"> For a disk device that is already visible to the system, you can check the output of the <span class="calibre3">mount</span> command.</li><li value="5" class="calibre_8"> Run <span class="calibre3">cat /proc/devices</span> to see the block and character devices for which your system currently has drivers. Each line consists of a number and name. The number is the major number of the device as described in Section 3.1. If you can guess the device from the name, look in <span class="italic">/dev</span> for the character or block devices with the corresponding major number, and you’ve found the device files.</li></ul><p id="calibre_link-681" class="calibre_33"><span class="calibre_13">Among these methods, only the first is reliable, but it does require udev. If you get into a situation where udev is not available, try the other methods but keep in mind that the kernel might not have a device file for your hardware.</span></p><p class="calibre_27"><span class="calibre_13">The following sections list the most common Linux devices and their naming conventions.</span></p><p id="calibre_link-94" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.1 Hard Disks: /dev/sd*</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most hard disks attached to current Linux systems correspond to device names with an </span><span class="italic">sd</span><span class="calibre_13"> prefix, such as </span><span class="italic">/dev/sda</span><span class="calibre_13">, </span><span class="italic">/dev/sdb</span><span class="calibre_13">, and so on. These devices represent entire disks; the kernel makes separate device files, such as </span><span class="italic">/dev/sda1</span><span class="calibre_13"> and </span><span class="italic">/dev/sda2</span><span class="calibre_13">, for the partitions on a disk.</span></p><p class="calibre_27"><span class="calibre_13"> The naming convention requires a little explanation. The </span><span class="italic">sd</span><span class="calibre_13"> portion of the name stands for </span><span class="italic">SCSI disk</span><span class="calibre_13">. </span><span class="italic">Small Computer System Interface (SCSI)</span><span class="calibre_13"> was originally developed as a hardware and protocol standard for communication between devices such as disks and other peripherals. Although traditional SCSI hardware isn’t used in most modern machines, the SCSI protocol is everywhere due to its adaptability. For example, USB storage devices use it to communicate. The story on SATA (Serial ATA, a common storage bus on PCs) disks is a little more complicated, but the Linux kernel still uses SCSI commands at a certain point when talking to them.</span></p><p class="calibre_27"><span class="calibre_13"> To list the SCSI devices on your system, use a utility that walks the device paths provided by sysfs. One of the most succinct tools is </span><span class="calibre3">lsscsi</span><span class="calibre_13">. Here’s what you can expect when you run it:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">lsscsi</span></span><span class="calibre3"><br class="calibre7" />[0:0:0:0]1&nbsp; disk2&nbsp; ATA&nbsp;&nbsp;&nbsp;&nbsp; WDC WD3200AAJS-2&nbsp; 01.0&nbsp; /dev/sda3<br class="calibre7" />[2:0:0:0]&nbsp;&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; FLASH&nbsp;&nbsp; Drive UT_USB20&nbsp;&nbsp;&nbsp; 0.00&nbsp; /dev/sdb</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The first column </span>1<span class="calibre_13"> identifies the address of the device on the system, the second </span>2<span class="calibre_13"> describes what kind of device it is, and the last </span>3<span class="calibre_13"> indicates where to find the device file. Everything else is vendor information.</span></p><p class="calibre_27"><span class="calibre_13">Linux assigns devices to device files in the order in which its drivers encounter the devices. So, in the previous example, the kernel found the disk first and the flash drive second.</span></p><p class="calibre_27"><span class="calibre_13"> Unfortunately, this device assignment scheme has traditionally caused problems when you are reconfiguring hardware. Say, for example, that you have a system with three disks: </span><span class="italic">/dev/sda</span><span class="calibre_13">, </span><span class="italic">/dev/sdb</span><span class="calibre_13">, and </span><span class="italic">/dev/sdc</span><span class="calibre_13">. If </span><span class="italic">/dev/sdb</span><span class="calibre_13"> explodes and you must remove it so that the machine can work again, the former </span><span class="italic">/dev/sdc</span><span class="calibre_13"> moves to </span><span class="italic">/dev/sdb</span><span class="calibre_13">, and there’s no longer a </span><span class="italic">/dev/sdc</span><span class="calibre_13">. If you were referring to the device names directly in the </span><span class="italic">fstab</span><span class="calibre_13"> file (see </span>Section 4.2.8<span class="calibre_13">), you’d have to make some changes to that file in order to get things (mostly) back to normal. To solve this problem, many Linux systems use the Universally Unique Identifier (UUID; see </span>Section 4.2.4<span class="calibre_13">) and/or the Logical Volume Manager (LVM) stable disk device mapping.</span></p><p id="calibre_link-677" class="calibre_27"><span class="calibre_13">This discussion has barely scratched the surface of how to use disks and other storage devices on Linux systems. See </span>Chapter 4<span class="calibre_13"> for more information about using disks. Later in this chapter, we’ll examine how SCSI support works in the Linux kernel.</span></p><p id="calibre_link-95" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.2 Virtual Disks: /dev/xvd*, /dev/vd*</span></span></span></p><p class="calibre_45"><span class="calibre_13">Some disk devices are optimized for virtual machines such as AWS instances and VirtualBox. The Xen virtualization system uses the </span><span class="italic">/dev/xvd</span><span class="calibre_13"> prefix, and </span><span class="italic">/dev/vd</span><span class="calibre_13"> is a similar type.</span></p><p id="calibre_link-96" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.3 Non-Volatile Memory Devices: /dev/nvme*</span></span></span></p><p class="calibre_45"><span class="calibre_13">Some systems now use the Non-Volatile Memory Express (NVMe) interface to talk to some kinds of solid-state storage. In Linux, these devices show up at </span><span class="italic">/dev/nvme*</span><span class="calibre_13">. You can use the </span><span class="calibre3">nvme list</span><span class="calibre_13"> command to get a listing of these devices on your system.</span></p><p id="calibre_link-97" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.4 Device Mapper: /dev/dm-*, /dev/mapper/*</span></span></span></p><p class="calibre_45"><span class="calibre_13">A level up from disks and other direct block storage on some systems is the LVM, which uses a kernel system called the device mapper. If you see block devices starting with </span><span class="italic">/dev/dm-</span><span class="calibre_13"> and symbolic links in </span><span class="italic">/dev/mapper</span><span class="calibre_13">, your system probably uses it. You’ll learn all about this in </span>Chapter 4<span class="calibre_13">.</span></p><p id="calibre_link-98" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.5 CD and DVD Drives: /dev/sr*</span></span></span></p><p class="calibre_45"><span class="calibre_13">Linux recognizes most optical storage drives as the SCSI devices </span><span class="italic">/dev/sr0</span><span class="calibre_13">, </span><span class="italic">/dev/sr1</span><span class="calibre_13">, and so on. However, if the drive uses an older interface, it might show up as a PATA device, as discussed next. The </span><span class="italic">/dev/sr*</span><span class="calibre_13"> devices are read only, and they are used only for reading from discs. For the write and rewrite capabilities of optical devices, you’ll use the “generic” SCSI devices such as </span><span class="italic">/dev/sg0</span><span class="calibre_13">.</span></p><p id="calibre_link-99" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.6 PATA Hard Disks: /dev/hd*</span></span></span></p><p class="calibre_45"><span class="calibre_13">PATA (Parallel ATA) is an older type of storage bus. The Linux block devices </span><span class="italic">/dev/hda</span><span class="calibre_13">, </span><span class="italic">/dev/hdb</span><span class="calibre_13">, </span><span class="italic">/dev/hdc</span><span class="calibre_13">, and </span><span class="italic">/dev/hdd</span><span class="calibre_13"> are common on older versions of the Linux kernel and with older hardware. These are fixed assignments based on the device pairs on interfaces 0 and 1. At times, you might find a SATA drive recognized as one of these disks. This means that the SATA drive is running in a compatibility mode, which hinders performance. Check your BIOS settings to see if you can switch the SATA controller to its native mode.</span></p><p id="calibre_link-100" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.7 Terminals: /dev/tty*, /dev/pts/*, and /dev/tty</span></span></span></p><p class="calibre_45"><span class="italic">Terminals</span><span class="calibre_13"> are devices for moving characters between a user process and an I/O device, usually for text output to a terminal screen. The terminal device interface goes back a long way, to the days when terminals were typewriter-based devices and many were attached to a single machine.</span><a id="calibre_link-646"></a></p><p class="calibre_27"><span class="calibre_13"> Most terminals are </span><span class="italic">pseudoterminal</span><span class="calibre_13"> devices, emulated terminals that understand the I/O features of real terminals. Rather than talk to a real piece of hardware, the kernel presents the I/O interface to a piece of software, such as the shell terminal window that you probably type most of your commands into.</span></p><p class="calibre_27"><span class="calibre_13"> Two common terminal devices are </span><span class="italic">/dev/tty1</span><span class="calibre_13"> (the first virtual console) and </span><span class="italic">/dev/pts/0</span><span class="calibre_13"> (the first pseudoterminal device). The </span><span class="italic">/dev/pts</span><span class="calibre_13"> directory itself is a dedicated filesystem.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">/dev/tty</span><span class="calibre_13"> device is the controlling terminal of the current process. If a program is currently reading from and writing to a terminal, this device is a synonym for that terminal. A process does not need to be attached to a terminal.</span></p><p class="calibre_46"><span class="bold">Display Modes and Virtual Consoles</span></p><p class="calibre_25"><span class="calibre_13">Linux has two primary display modes: </span><span class="italic">text mode</span><span class="calibre_13"> and a graphical mode (</span>Chapter 14<span class="calibre_13"> introduces the windowing systems that use this mode). Although Linux systems traditionally booted in text mode, most distributions now use kernel parameters and interim graphical display mechanisms (bootsplashes such as plymouth) to completely hide text mode as the system is booting. In such cases, the system switches over to full graphics mode near the end of the boot process.</span></p><p class="calibre_27"><span class="calibre_13"> Linux supports </span><span class="italic">virtual consoles</span><span class="calibre_13"> to multiplex the display. Each virtual console may run in graphics or text mode. When in text mode, you can switch between consoles with an </span>ALT&ndash;<span class="calibre_13">function key combination&mdash;for example, </span>ALT<span class="calibre_13">-F1 takes you to </span><span class="italic">/dev/tty1</span><span class="calibre_13">, </span>ALT<span class="calibre_13">-F2 goes to </span><span class="italic">/dev/tty2</span><span class="calibre_13">, and so on. Many of these virtual consoles may be occupied by a </span><span class="calibre3">getty</span><span class="calibre_13"> process running a login prompt, as described in </span>Section 7.4<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> A virtual console used in graphics mode is slightly different. Rather than getting a virtual console assignment from the init configuration, a graphical environment takes over a free virtual console unless directed to use a specific one. For example, if you have </span><span class="calibre3">getty</span><span class="calibre_13"> processes running on </span><span class="italic">tty1</span><span class="calibre_13"> and </span><span class="italic">tty2</span><span class="calibre_13">, a new graphical environment takes over </span><span class="italic">tty3</span><span class="calibre_13">. In addition, once in graphics mode, you must normally press a </span>CTRL<span class="calibre_13">-</span>ALT<span class="calibre_13">&ndash;function key combination to switch to another virtual console instead of the simpler </span>ALT<span class="calibre_13">&ndash;function key combination.</span></p><p class="calibre_27"><span class="calibre_13"> The upshot of all of this is that if you want to see your text console after your system boots, press </span>CTRL-ALT<span class="calibre_13">-F1. To return to the graphical environment, press </span>ALT<span class="calibre_13">-F2, </span>ALT-<span class="calibre_13">F3, and so on, until you get to the graphical environment.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Some distributions use </span></span>tty1<span class="italic"><span class="calibre_13"> in graphics mode. In this case, you will need to try other consoles.</span></span></blockquote><p id="calibre_link-561" class="calibre_37"><span class="calibre_13">If you run into trouble switching consoles due to a malfunctioning input mechanism or some other circumstance, you can try to force the system to change consoles with the </span><span class="calibre3">chvt</span><span class="calibre_13"> command. For example, to switch to </span><span class="italic">tty1</span><span class="calibre_13">, run the following as root:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">chvt 1</span></span></blockquote></blockquote><p id="calibre_link-101" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">3.4.8 Serial Ports: /dev/ttyS*, /dev/ttyUSB*, /dev/ttyACM*</span></span></span></p><p class="calibre_45"><span class="calibre_13">Older RS-232 type and similar serial ports are represented as true terminal devices. You can’t do much on the command line with serial port devices because there are too many settings to worry about, such as baud rate and flow control, but you can use the </span><span class="calibre3">screen</span><span class="calibre_13"> command to connect to a terminal by adding the device path as an argument. You may need read and write permission to the device; sometimes you can do this by adding yourself to a particular group such as </span><span class="calibre3">dialout</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The port known as COM1 on Windows is </span><span class="italic">/dev/ttyS0</span><span class="calibre_13">; COM2 is </span><span class="italic">/dev/ttyS1</span><span class="calibre_13">; and so on. Plug-in USB serial adapters show up with </span><span class="italic">USB</span><span class="calibre_13"> and </span><span class="italic">ACM</span><span class="calibre_13"> with the names </span><span class="italic">/dev/ttyUSB0</span><span class="calibre_13">, </span><span class="italic">/dev/ttyACM0</span><span class="calibre_13">, </span><span class="italic">/dev/ttyUSB1</span><span class="calibre_13">, </span><span class="italic">/dev/ttyACM1</span><span class="calibre_13">, and so on.</span></p><p class="calibre_27"><span class="calibre_13"> Some of the most interesting applications involving serial ports are microcontroller-based boards that you can plug into your Linux system for development and testing. For example, you can access the console and read-eval-print loop of CircuitPython boards through a USB serial interface. All you need to do is plug one in, look for the device (it’s usually </span><span class="italic">/dev/ttyACM0</span><span class="calibre_13">), and connect to it with </span><span class="calibre3">screen</span><span class="calibre_13">.</span></p><p id="calibre_link-102" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.9 Parallel Ports: /dev/lp0 and /dev/lp1</span></span></span></p><p class="calibre_45"><span class="calibre_13">Representing an interface type that has largely been replaced by USB and networks, the unidirectional parallel port devices </span><span class="italic">/dev/lp0</span><span class="calibre_13"> and </span><span class="italic">/dev/lp1</span><span class="calibre_13"> correspond to LPT1: and LPT2: in Windows. You can send files (such as a file to be printed) directly to a parallel port with the </span><span class="calibre3">cat</span><span class="calibre_13"> command, but you might need to give the printer an extra form feed or reset afterward. A print server such as CUPS is much better at handling interaction with a printer.</span></p><p class="calibre_27"><span class="calibre_13"> The bidirectional parallel ports are </span><span class="italic">/dev/parport0</span><span class="calibre_13"> and </span><span class="italic">/dev/parport1</span><span class="calibre_13">.</span></p><p id="calibre_link-103" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.4.10 Audio Devices: /dev/snd/*, /dev/dsp, /dev/audio, and More</span></span></span></p><p class="calibre_45"><span class="calibre_13">Linux has two sets of audio devices. There are separate devices for the Advanced Linux Sound Architecture (ALSA) system interface and the older Open Sound System (OSS). The ALSA devices are in the </span><span class="italic">/dev/snd</span><span class="calibre_13"> directory, but it’s difficult to work with them directly. Linux systems that use ALSA support OSS backward-compatible devices if the OSS kernel support is currently loaded.</span></p><p id="calibre_link-562" class="calibre_27"><span class="calibre_13">Some rudimentary operations are possible with the OSS </span><span class="italic">dsp</span><span class="calibre_13"> and </span><span class="italic">audio</span><span class="calibre_13"> devices. For example, the computer plays any WAV file that you send to </span><span class="italic">/dev/dsp</span><span class="calibre_13">. However, the hardware may not do what you expect due to frequency mismatches. Furthermore, on most systems, the device is often busy as soon as you log in.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Linux sound is a messy subject due to the many layers involved. We’ve just talked about the kernel-level devices, but typically there are user-space servers such as pulseaudio that manage audio from different sources and act as intermediaries between the sound devices and other user-space processes.</span></span></blockquote><p id="calibre_link-104" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">3.4.11 Device File Creation</span></span></span></p><p class="calibre_45"><span class="calibre_13">On any reasonably recent Linux system, you do not create your own device files; they’re created by devtmpfs and udev (see </span>Section 3.5<span class="calibre_13">). However, it is instructive to see how to do so, and on a rare occasion, you might need to create a named pipe or a socket file.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">mknod</span><span class="calibre_13"> command creates one device. You must know the device name as well as its major and minor numbers. For example, creating </span><span class="italic">/dev/sda1</span><span class="calibre_13"> is a matter of using the following command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mknod /dev/sda1 b 8 1</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">b 8 1</span><span class="calibre_13"> specifies a block device with a major number 8 and a minor number 1. For character or named pipe devices, use </span><span class="calibre3">c</span><span class="calibre_13"> or </span><span class="calibre3">p</span><span class="calibre_13"> instead of </span><span class="calibre3">b</span><span class="calibre_13"> (omit the major and minor numbers for named pipes).</span></p><p class="calibre_27"><span class="calibre_13"> In older versions of Unix and Linux, maintaining the </span><span class="italic">/dev</span><span class="calibre_13"> directory was a challenge. With every significant kernel upgrade or driver addition, the kernel could support more kinds of devices, meaning that there would be a new set of major and minor numbers to be assigned to device filenames. To tackle this maintenance challenge, each system had a </span><span class="calibre3">MAKEDEV</span><span class="calibre_13"> program in </span><span class="italic">/dev</span><span class="calibre_13"> to create groups of devices. When you upgraded your system, you would try to find an update to </span><span class="calibre3">MAKEDEV</span><span class="calibre_13"> and then run it in order to create new devices.</span></p><p class="calibre_27"><span class="calibre_13"> This static system became ungainly, so a replacement was in order. The first attempt to fix it was devfs, a kernel-space implementation of </span><span class="italic">/dev</span><span class="calibre_13"> that contained all of the devices that the current kernel supported. However, there were a number of limitations, which led to the development of udev and devtmpfs.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-105" class="calibre_23"><span class="calibre1"><span class="bold"> 3.5 udev</span></span></p><p class="calibre_24"><span class="calibre_13">We’ve already talked about how unnecessary complexity in the kernel is dangerous because you can too easily introduce system instability. Device file management is an example: you can create device files in user space, so why would you do this in the kernel? The Linux kernel can send notifications to a user-space process called udevd upon detecting a new device on the system (for example, when someone attaches a USB flash drive). This udevd process could examine the new device’s characteristics, create a device file, and then perform any device initialization.</span><a id="calibre_link-691"></a></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You’ll almost certainly see udevd running on your system as systemd-udevd because it’s a part of the startup mechanism you’ll see in </span></span><span class="italic">Chapter 6</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">That was the theory. Unfortunately, there is a problem with this approach&mdash;device files are necessary early in the boot procedure, so udevd must also start early. But to create device files, udevd cannot depend on any devices that it is supposed to create, and it needs to perform its initial startup very quickly so that the rest of the system doesn’t get held up waiting for udevd to start.</span></p><p id="calibre_link-106" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.5.1 devtmpfs</span></span></span></p><p class="calibre_45"><span class="calibre_13">The devtmpfs filesystem was developed in response to the problem of device availability during boot (see </span>Section 4.2<span class="calibre_13"> for more details on filesystems). This filesystem is similar to the older devfs support, but simplified. The kernel creates device files as necessary, but it also notifies udevd that a new device is available. Upon receiving this signal, udevd does not create the device files, but it does perform device initialization along with setting permissions and notifying other processes that new devices are available. Additionally, it creates a number of symbolic links in </span><span class="italic">/dev</span><span class="calibre_13"> to further identify devices. You can find examples in the directory </span><span class="italic">/dev/disk/by-id</span><span class="calibre_13">, where each attached disk has one or more entries.</span></p><p class="calibre_27"><span class="calibre_13"> For example, consider the links for a typical disk (attached at </span><span class="italic">/dev/sda</span><span class="calibre_13">) and its partitions in </span><span class="italic">/dev/disk/by-id</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l /dev/disk/by-id</span></span><span class="calibre3"><br class="calibre7" />lrwxrwxrwx 1 root root&nbsp; 9 Jul 26 10:23 scsi-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671 -&gt; ../../sda<br class="calibre7" />lrwxrwxrwx 1 root root 10 Jul 26 10:23 scsi-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671-part1 -&gt;<br class="calibre7" />../../sda1<br class="calibre7" />lrwxrwxrwx 1 root root 10 Jul 26 10:23 scsi-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671-part2 -&gt;<br class="calibre7" />../../sda2<br class="calibre7" />lrwxrwxrwx 1 root root 10 Jul 26 10:23 scsi-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671-part5 -&gt;<br class="calibre7" />../../sda5</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The udevd process names the links by interface type, and then by manufacturer and model information, serial number, and partition (if applicable).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The “tmp” in devtmpfs indicates that the filesystem resides in main memory with read/write capability by user-space processes; this characteristic enables udevd to create these symbolic links. We’ll see some more details in </span></span><span class="italic">Section 4.2.12</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> But how does udevd know which symbolic links to create, and how does it create them? The next section describes how udevd does its work. However, you don’t need to know any of this or any of the other remaining material in this chapter to continue on with the book. In fact, if this is your first time looking at Linux devices, you’re highly encouraged to skip to the next chapter to start learning about how to use disks.</span><a id="calibre_link-689"></a></p><p id="calibre_link-107" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.5.2 udevd Operation and Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">The udevd daemon operates as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The kernel sends udevd a notification event, called a <span class="italic">uevent</span>, through an internal network link.</li><li value="2" class="calibre_8">udevd loads all of the attributes in the uevent.</li><li value="3" class="calibre_8">udevd parses its rules, filters and updates the uevent based on those rules, and takes actions or sets more attributes accordingly.</li></ol><p class="calibre_33"><span class="calibre_13"> An incoming uevent that udevd receives from the kernel might look like this (you’ll learn how to get this output with the </span><span class="calibre3">udevadm monitor --property</span><span class="calibre_13"> command in </span>Section 3.5.4<span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">ACTION=change<br class="calibre7" />DEVNAME=sde<br class="calibre7" />DEVPATH=/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2/1-1.2:1.0/host4/<br class="calibre7" />target4:0:0/4:0:0:3/block/sde<br class="calibre7" />DEVTYPE=disk<br class="calibre7" />DISK_MEDIA_CHANGE=1<br class="calibre7" />MAJOR=8<br class="calibre7" />MINOR=64<br class="calibre7" />SEQNUM=2752<br class="calibre7" />SUBSYSTEM=block<br class="calibre7" />UDEV_LOG=3</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This particular event is a change to a device. After receiving the uevent, udevd knows the name of the device, the sysfs device path, and a number of other attributes associated with the properties; it is now ready to start processing rules.</span></p><p class="calibre_27"><span class="calibre_13"> The rules files are in the </span><span class="italic">/lib/udev/rules.d</span><span class="calibre_13"> and </span><span class="italic">/etc/udev/rules.d</span><span class="calibre_13"> directories. The rules in </span><span class="italic">/lib</span><span class="calibre_13"> are the defaults, and the rules in </span><span class="italic">/etc</span><span class="calibre_13"> are overrides. A full explanation of the rules would be tedious, and you can learn much more from the udev(7) manual page, but here is some basic information about how udevd reads them:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">udevd reads rules from start to finish of a rules file.</li><li value="2" class="calibre_8">After reading a rule and possibly executing its action, udevd continues reading the current rules file for more applicable rules.</li><li value="3" class="calibre_8">There are directives (such as <span class="calibre3">GOTO</span>) to skip over parts of rules files if necessary. These are usually placed at the top of a rules file to skip over the entire file if it’s irrelevant to a particular device that udevd is configuring.</li></ol><p class="calibre_33"><span class="calibre_13">Let’s look at the symbolic links from the </span><span class="italic">/dev/sda</span><span class="calibre_13"> example in </span>Section 3.5.1<span class="calibre_13">. Those links were defined by rules in </span><span class="italic">/lib/udev/rules.d/60-persistent-storage.rules</span><span class="calibre_13">. Inside, you’ll see the following lines:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># ATA<br class="calibre7" />KERNEL=="sd*[!0-9]|sr*", ENV{ID_SERIAL}!="?*", SUBSYSTEMS=="scsi", ATTRS{vendor}=="ATA", IMPORT{program}="ata_id --export $devnode"<br class="calibre7" /># ATAPI devices (SPC-3 or later)<br class="calibre7" />KERNEL=="sd*[!0-9]|sr*", ENV{ID_SERIAL}!="?*", SUBSYSTEMS=="scsi", ATTRS{type}=="5",ATTRS{scsi_level}=="[6-9]*", IMPORT{program}="ata_id --export $devnode"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> These rules match ATA disks and optical media presented through the kernel’s SCSI subsystem (see </span>Section 3.6<span class="calibre_13">). You can see that there are a few rules to catch different ways the devices may be represented, but the idea is that udevd will try to match a device starting with </span><span class="italic">sd</span><span class="calibre_13"> or </span><span class="italic">sr</span><span class="calibre_13"> but without a number (with the </span><span class="calibre3">KERNEL=="sd*[!0-9]|sr*"</span><span class="calibre_13"> expression), as well as a subsystem (</span><span class="calibre3">SUBSYSTEMS=="scsi"</span><span class="calibre_13">), and, finally, some other attributes, depending on the type of device. If all of those conditional expressions are true in either of the rules, udevd moves to the next and final expression:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">IMPORT{program}="ata_id --export $tempnode"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This is not a conditional. Instead, it’s a directive to import variables from the </span><span class="italic">/lib/udev/ata_id</span><span class="calibre_13"> command. If you have such a disk, try it yourself on the command line. It will look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">/lib/udev/ata_id --export /dev/sda</span></span><span class="calibre3"><br class="calibre7" />ID_ATA=1<br class="calibre7" />ID_TYPE=disk<br class="calibre7" />ID_BUS=ata<br class="calibre7" />ID_MODEL=WDC_WD3200AAJS-22L7A0<br class="calibre7" />ID_MODEL_ENC=WDC\x20WD3200AAJS22L7A0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br class="calibre7" />\x20\x20\x20\x20\x20\x20\x20\x20\x20<br class="calibre7" />ID_REVISION=01.03E10<br class="calibre7" />ID_SERIAL=WDC_WD3200AAJS-22L7A0_WD-WMAV2FU80671<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The import now sets the environment so that all of the variable names in this output are set to the values shown. For example, any rule that follows will now recognize </span><span class="calibre3">ENV{ID_TYPE}</span><span class="calibre_13"> as </span><span class="calibre3">disk</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> In the two rules we’ve seen so far, of particular note is </span><span class="calibre3">ID_SERIAL</span><span class="calibre_13">. In each rule, this conditional appears second:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">ENV{ID_SERIAL}!="?*"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This expression evaluates to true if </span><span class="calibre3">ID_SERIAL</span><span class="calibre_13"> is not set. Therefore, if </span><span class="calibre3">ID_SERIAL</span><span class="calibre_13">
</span><span class="italic">is</span><span class="calibre_13"> set, the conditional is false, the entire current rule does not apply, and udevd moves to the next rule.</span></p><p id="calibre_link-690" class="calibre_27"><span class="calibre_13">Why is this here? The purpose of these two rules is to run </span><span class="calibre3">ata_id</span><span class="calibre_13"> to find the serial number of the disk device and then add these attributes to the current working copy of the uevent. You’ll find this general pattern in many udev rules.</span></p><p class="calibre_27"><span class="calibre_13"> With </span><span class="calibre3">ENV{ID_SERIAL}</span><span class="calibre_13"> set, udevd can now evaluate this rule later on in the rules file, which looks for any attached SCSI disks:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">KERNEL=="sd*|sr*|cciss*", ENV{DEVTYPE}=="disk", ENV{ID_SERIAL}=="?*",SYMLINK+="disk/by-id/$env{ID_BUS}-$env{ID_SERIAL}"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can see that this rule requires </span><span class="calibre3">ENV{ID_SERIAL}</span><span class="calibre_13"> to be set, and it has one directive:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">SYMLINK+="disk/by-id/$env{ID_BUS}-$env{ID_SERIAL}"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This directive tells udevd to add a symbolic link for the incoming device. So now you know where the device symbolic links came from!</span></p><p class="calibre_27"><span class="calibre_13"> You may be wondering how to tell a conditional expression from a directive. Conditionals are denoted by two equal signs (</span><span class="calibre3">==</span><span class="calibre_13">) or a bang equal (</span><span class="calibre3">!=</span><span class="calibre_13">), and directives by a single equal sign (</span><span class="calibre3">=</span><span class="calibre_13">), a plus equal (</span><span class="calibre3">+=</span><span class="calibre_13">), or a colon equal (</span><span class="calibre3">:=</span><span class="calibre_13">).</span></p><p id="calibre_link-108" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.5.3 udevadm</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">udevadm</span><span class="calibre_13"> program is an administration tool for udevd. You can reload udevd rules and trigger events, but perhaps the most powerful features of </span><span class="calibre3">udevadm</span><span class="calibre_13"> are the ability to search for and explore system devices and the ability to monitor uevents as udevd receives them from the kernel. The command syntax can be somewhat complicated, though. There are long and short forms for most options; we’ll use the long ones here.</span></p><p class="calibre_27"><span class="calibre_13"> Let’s start by examining a system device. Returning to the example in </span>Section 3.5.2<span class="calibre_13">, in order to look at all of the udev attributes used and generated in conjunction with the rules for a device such as </span><span class="italic">/dev/sda</span><span class="calibre_13">, run the following command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">udevadm info --query=all --name=/dev/sda</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">P: /devices/pci0000:00/0000:00:1f.2/host0/target0:0:0/0:0:0:0/block/sda<br class="calibre7" />N: sda<br class="calibre7" />S: disk/by-id/ata-WDC_WD3200AAJS-22L7A0_WD-WMAV2FU80671<br class="calibre7" />S: disk/by-id/scsi-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671<br class="calibre7" />S: disk/by-id/wwn-0x50014ee057faef84<br class="calibre7" />S: disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0<br class="calibre7" />E: DEVLINKS=/dev/disk/by-id/ata-WDC_WD3200AAJS-22L7A0_WD-WMAV2FU80671 /dev/disk/by-id/scsi<br class="calibre7" />-SATA_WDC_WD3200AAJS-_WD-WMAV2FU80671 /dev/disk/by-id/wwn-0x50014ee057faef84 /dev/disk/by<br class="calibre7" />-path/pci-0000:00:1f.2-scsi-0:0:0:0<br class="calibre7" />E: DEVNAME=/dev/sdaE: DEVPATH=/devices/pci0000:00/0000:00:1f.2/host0/target0:0:0/0:0:0:0/block/sda<br class="calibre7" />E: DEVTYPE=disk<br class="calibre7" />E: ID_ATA=1<br class="calibre7" />E: ID_ATA_DOWNLOAD_MICROCODE=1<br class="calibre7" />E: ID_ATA_FEATURE_SET_AAM=1<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote><a id="calibre_link-688"></a></blockquote><p class="calibre_30"><span class="calibre_13"> The prefix in each line indicates an attribute or other characteristic of the device. In this case, the </span><span class="calibre3">P:</span><span class="calibre_13"> at the top is the sysfs device path, the </span><span class="calibre3">N:</span><span class="calibre_13"> is the device node (that is, the name given to the </span><span class="italic">/dev</span><span class="calibre_13"> file), </span><span class="calibre3">S</span><span class="calibre_13">: indicates a symbolic link to the device node that udevd placed in </span><span class="italic">/dev</span><span class="calibre_13"> according to its rules, and </span><span class="calibre3">E:</span><span class="calibre_13"> is additional device information extracted in the udevd rules. (There was far more output in this example than was necessary to show here; try the command for yourself to get a feel for what it does.)</span></p><p id="calibre_link-109" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.5.4 Device Monitoring</span></span></span></p><p class="calibre_45"><span class="calibre_13">To monitor uevents with </span><span class="calibre3">udevadm</span><span class="calibre_13">, use the </span><span class="calibre3">monitor</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">udevadm monitor</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Output (for example, when you insert a flash media device) looks like this abbreviated sample:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">KERNEL[658299.569485] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)<br class="calibre7" />KERNEL[658299.569667] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)<br class="calibre7" />KERNEL[658299.570614] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/host15 <br class="calibre7" />(scsi)<br class="calibre7" />KERNEL[658299.570645] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/ <br class="calibre7" />host15/scsi_host/host15 (scsi_host)<br class="calibre7" />UDEV [658299.622579] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2 (usb)<br class="calibre7" />UDEV [658299.623014] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0 (usb)<br class="calibre7" />UDEV [658299.623673] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/host15 <br class="calibre7" />(scsi)<br class="calibre7" />UDEV [658299.623690] add /devices/pci0000:00/0000:00:1d.0/usb2/2-1/2-1.2/2-1.2:1.0/<br class="calibre7" />host15/scsi_host/host15 (scsi_host)<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> There are two copies of each message in this output because the default behavior is to print both the incoming message from the kernel (marked with </span><span class="calibre3">KERNEL</span><span class="calibre_13">) and the processing messages from udevd. To see only kernel events, add the </span><span class="calibre3">--kernel</span><span class="calibre_13"> option, and to see only udevd processing events, use </span><span class="calibre3">--udev</span><span class="calibre_13">. To see the whole incoming uevent, including the attributes as shown in </span>Section 3.5.2<span class="calibre_13">, use the </span><span class="calibre3">--property</span><span class="calibre_13"> option. The </span><span class="calibre3">--udev</span><span class="calibre_13"> and </span><span class="calibre3">--property</span><span class="calibre_13"> options together show the uevent after processing.</span></p><p class="calibre_27"><span class="calibre_13">You can also filter events by subsystem. For example, to see only kernel messages pertaining to changes in the SCSI subsystem, use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">udevadm monitor --kernel --subsystem-match=scsi</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> For more on </span><span class="calibre3">udevadm</span><span class="calibre_13">, see the udevadm(8) manual page.</span></p><p id="calibre_link-692" class="calibre_27"><span class="calibre_13">There’s much more to udev. For example, there’s a daemon called udisksd that listens for events in order to automatically attach disks and to notify other processes that new disks are available.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-110" class="calibre_23"><span class="calibre1"><span class="bold"> 3.6 In-Depth: SCSI and the Linux Kernel</span></span></p><p class="calibre_24"><span class="calibre_13">In this section, we’ll take a look at the SCSI support in the Linux kernel as a way to explore part of the Linux kernel architecture. You don’t need to know any of this information in order to use disks, so if you’re in a hurry to use one, move on to </span>Chapter 4<span class="calibre_13">. In addition, the material here is more advanced and theoretical in nature that what you’ve seen so far, so if you want to stay hands-on, you should definitely skip to the next chapter.</span></p><p class="calibre_27"><span class="calibre_13"> Let’s begin with a little background. The traditional SCSI hardware setup is a host adapter linked with a chain of devices over an SCSI bus, as shown in </span><a></a><a href="#calibre_link-494"><span class="italic"><span class="calibre_4">Figure 3-1</span></span></a><span class="calibre_13">. The host adapter is attached to a computer. The host adapter and devices each have an SCSI ID, and there can be 8 or 16 IDs per bus, depending on the SCSI version. Some administrators might use the term </span><span class="italic">SCSI target</span><span class="calibre_13"> to refer to a device and its SCSI ID because one end of a session in the SCSI protocol is called the target.</span></p><p class="calibre_34"><img src="images/000020.jpg" class="calibre_59" />
</p><p id="calibre_link-494" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 3-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: SCSI bus with host adapter and devices</span></span></span></p><p class="calibre_37"><span class="calibre_13">Any device can communicate with another through the SCSI command set in a peer-to-peer relationship. The computer is not directly attached to the device chain, so it must go through the host adapter in order to communicate with disks and other devices. Typically, the computer sends SCSI commands to the host adapter to relay to the devices, and the devices relay responses back through the host adapter.</span></p><p class="calibre_27"><span class="calibre_13"> Newer versions of SCSI, such as Serial Attached SCSI (SAS),</span><span class="italic">
</span><span class="calibre_13">offer exceptional performance, but you probably won’t find true SCSI devices in most machines. You’ll more often encounter USB storage devices that use SCSI commands. In addition, devices supporting ATAPI (such as CD/DVD-ROM drives) use a version of the SCSI command set.</span></p><p class="calibre_27"><span class="calibre_13"> SATA disks also appear on your system as SCSI devices, but they are slightly different because most of them communicate through a translation layer in the libata library (see </span>Section 3.6.2<span class="calibre_13">). Some SATA controllers (especially high-performance RAID controllers) perform this translation in hardware.</span></p><p id="calibre_link-714" class="calibre_27"><span class="calibre_13">How does this all fit together? Consider the devices shown on the following system:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">lsscsi</span></span><span class="calibre3"><br class="calibre7" />[0:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; ATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WDC WD3200AAJS-2&nbsp; 01.0&nbsp; /dev/sda<br class="calibre7" />[1:0:0:0]&nbsp;&nbsp; cd/dvd&nbsp; Slimtype&nbsp; DVD A DS8A5SH&nbsp;&nbsp;&nbsp;&nbsp; XA15&nbsp; /dev/sr0<br class="calibre7" />[2:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader CF&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sdb<br class="calibre7" />[2:0:0:1]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader SM XD&nbsp; 0100&nbsp; /dev/sdc<br class="calibre7" />[2:0:0:2]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader MS&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sdd<br class="calibre7" />[2:0:0:3]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader SD&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sde<br class="calibre7" />[3:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; FLASH&nbsp;&nbsp;&nbsp;&nbsp; Drive UT_USB20&nbsp;&nbsp;&nbsp; 0.00&nbsp; /dev/sdf</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The numbers in square brackets are, from left to right, the SCSI host adapter number, the SCSI bus number, the device SCSI ID, and the LUN (logical unit number, a further subdivision of a device). In this example, there are four attached adapters (scsi0, scsi1, scsi2, and scsi3), each of which has a single bus (all with bus number 0), and just one device on each bus (all with target 0). The USB card reader at 2:0:0 has four logical units, though&mdash;one for each kind of flash card that can be inserted. The kernel has assigned a different device file to each logical unit.</span></p><p class="calibre_27"><span class="calibre_13"> Despite not being SCSI devices, NVMe devices can sometimes show up in the </span><span class="calibre3">lsscsi</span><span class="calibre_13"> output with an </span><span class="calibre3">N</span><span class="calibre_13"> as the adapter number.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you want to try </span></span><span class="calibre3">lsscsi</span><span class="italic"><span class="calibre_13"> for yourself, you may need to install it as an additional package.</span></span></blockquote><p class="calibre_37"><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">Figure 3-2</span></span></a><span class="calibre_13"> illustrates the driver and interface hierarchy inside the kernel for this particular system configuration, from the individual device drivers up to the block drivers. It does not include the SCSI generic (</span><span class="italic">sg</span><span class="calibre_13">) drivers.</span></p><p class="calibre_27"><span class="calibre_13">Although this is a large structure and may look overwhelming at first, the data flow in the figure is very linear. Let’s begin dissecting it by looking at the SCSI subsystem and its three layers of drivers:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The top layer handles operations for a class of device. For example, the <span class="italic">sd</span> (SCSI disk) driver is at this layer; it knows how to translate requests from the kernel block device interface into disk-specific commands in the SCSI protocol, and vice versa.</li><li value="2" class="calibre_8">The middle layer moderates and routes the SCSI messages between the top and bottom layers, and keeps track of all of the SCSI buses and devices attached to the system.</li><li value="3" class="calibre_8"> The bottom layer handles hardware-specific actions. The drivers here send outgoing SCSI protocol messages to specific host adapters or hardware, and they extract incoming messages from the hardware. The reason for this separation from the top layer is that although SCSI messages are uniform for a device class (such as the disk class), different kinds of host adapters have varying procedures for sending the same messages. <blockquote class="calibre_16"><blockquote class="calibre_29"><img src="images/000002.jpg" class="calibre_60" />
</blockquote></blockquote><blockquote class="calibre_61"><blockquote class="calibre_29"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 3-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Linux SCSI subsystem schematic</span></span></span></blockquote></blockquote></li><a id="calibre_link-495"></a></ul><p class="calibre_37"><span class="calibre_13"> The top and bottom layers contain many different drivers, but it’s important to remember that, for any given device file on your system, the kernel (nearly always) uses one top-layer driver and one lower-layer driver. For the disk at </span><span class="italic">/dev/sda</span><span class="calibre_13"> in our example, the kernel uses the </span><span class="italic">sd</span><span class="calibre_13"> top-layer driver and the ATA bridge lower-layer driver.</span></p><p id="calibre_link-825" class="calibre_27"><span class="calibre_13">There are times when you might use more than one upper-layer driver for one hardware device (see </span>Section 3.6.3<span class="calibre_13">). For true hardware SCSI devices, such as a disk attached to an SCSI host adapter or a hardware RAID controller, the lower-layer drivers talk directly to the hardware below. However, for most hardware that you find attached to the SCSI subsystem, it’s a different story.</span></p><p id="calibre_link-111" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.6.1 USB Storage and SCSI</span></span></span></p><p class="calibre_45"><span class="calibre_13">In order for the SCSI subsystem to talk to common USB storage hardware, as shown in </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">Figure 3-2</span></span></a><span class="calibre_13">, the kernel needs more than just a lower-layer SCSI driver. A USB flash drive represented by </span><span class="italic">/dev/sdf</span><span class="calibre_13"> understands SCSI commands, but to actually communicate with the drive, the kernel needs to know how to talk through the USB system.</span></p><p class="calibre_27"><span class="calibre_13"> In the abstract, USB is quite similar to SCSI&mdash;it has device classes, buses, and host controllers. Therefore, it should be no surprise that the Linux kernel includes a three-layer USB subsystem that closely resembles the SCSI subsystem, with device-class drivers at the top, a bus management core in the middle, and host controller drivers at the bottom. Much as the SCSI subsystem passes SCSI commands between its components, the USB subsystem passes USB messages between its components. There’s even an </span><span class="calibre3">lsusb</span><span class="calibre_13"> command that is similar to </span><span class="calibre3">lsscsi</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">The part we’re really interested in here is the USB storage driver at the top. This driver acts as a translator. On one end, the driver speaks SCSI, and on the other, it speaks USB. Because the storage hardware includes SCSI commands inside its USB messages, the driver has a relatively easy job: it mostly repackages data.</span></p><p class="calibre_27"><span class="calibre_13">With both the SCSI and USB subsystems in place, you have almost everything you need to talk to the flash drive. The final missing link is the lower-layer driver in the SCSI subsystem because the USB storage driver is a part of the USB subsystem, not the SCSI subsystem. (For organizational reasons, the two subsystems should not share a driver.) To get the subsystems to talk to one another, a simple, lower-layer SCSI bridge driver connects to the USB subsystem’s storage driver.</span></p><p id="calibre_link-112" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.6.2 SCSI and ATA</span></span></span></p><p class="calibre_45"><span class="calibre_13">The SATA hard disk and optical drive shown in </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">Figure 3-2</span></span></a><span class="calibre_13"> both use the same SATA interface. To connect the SATA-specific drivers of the kernel to the SCSI subsystem, the kernel employs a bridge driver, as with the USB drives, but with a different mechanism and additional complications. The optical drive speaks ATAPI, a version of SCSI commands encoded in the ATA protocol. However, the hard disk does not use ATAPI and does not encode any SCSI commands!</span></p><p class="calibre_27"><span class="calibre_13"> The Linux kernel uses part of a library called libata to reconcile SATA (and ATA) drives with the SCSI subsystem. For the ATAPI-speaking optical drives, this is a relatively simple task of packaging and extracting SCSI commands into and from the ATA protocol. But for the hard disk, the task is much more complicated because the library must do a full command translation.</span><a id="calibre_link-571"></a></p><p class="calibre_27"><span class="calibre_13">The job of the optical drive is similar to typing an English book into a computer. You don’t need to understand what the book is about in order to do this job, nor do you even need to understand English. But the task for the hard disk is more like reading a German book and typing it into the computer as an English translation. In this case, you need to understand both languages as well as the book’s content.</span></p><p class="calibre_27"><span class="calibre_13"> Despite this difficulty, libata performs this task and makes it possible to attach ATA/SATA interfaces and devices to the SCSI subsystem. (There are typically more drivers involved than just the one SATA host driver shown in </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">Figure 3-2</span></span></a><span class="calibre_13">, but they’re not shown for the sake of simplicity.)</span></p><p id="calibre_link-113" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.6.3 Generic SCSI Devices</span></span></span></p><p class="calibre_45"><span class="calibre_13">When a user-space process communicates with the SCSI subsystem, it normally does so through the block device layer and/or another other kernel service that sits on top of an SCSI device class driver (like </span><span class="italic">sd</span><span class="calibre_13"> or </span><span class="italic">sr</span><span class="calibre_13">). In other words, most user processes never need to know anything about SCSI devices or their commands.</span></p><p class="calibre_27"><span class="calibre_13"> However, user processes can bypass device class drivers and give SCSI protocol commands directly to devices through their </span><span class="italic">generic devices</span><span class="calibre_13">. For example, consider the system described in </span>Section 3.6<span class="calibre_13">, but this time, take a look at what happens when you add the </span><span class="calibre3">-g</span><span class="calibre_13"> option to </span><span class="calibre3">lsscsi</span><span class="calibre_13"> in order to show the generic devices:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">lsscsi -g</span></span><span class="calibre3"><br class="calibre7" />[0:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; ATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WDC WD3200AAJS-2&nbsp; 01.0&nbsp; /dev/sda 1/dev/sg0<br class="calibre7" />[1:0:0:0]&nbsp;&nbsp; cd/dvd&nbsp; Slimtype&nbsp; DVD A DS8A5SH&nbsp;&nbsp;&nbsp;&nbsp; XA15&nbsp; /dev/sr0&nbsp;&nbsp; /dev/sg1<br class="calibre7" />[2:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader CF&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sdb&nbsp;&nbsp; /dev/sg2<br class="calibre7" />[2:0:0:1]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader SM XD&nbsp; 0100&nbsp; /dev/sdc&nbsp;&nbsp; /dev/sg3<br class="calibre7" />[2:0:0:2]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader MS&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sdd&nbsp;&nbsp; /dev/sg4<br class="calibre7" />[2:0:0:3]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; USB2.0&nbsp;&nbsp;&nbsp; CardReader SD&nbsp;&nbsp;&nbsp;&nbsp; 0100&nbsp; /dev/sde&nbsp;&nbsp; /dev/sg5<br class="calibre7" />[3:0:0:0]&nbsp;&nbsp; disk&nbsp;&nbsp;&nbsp; FLASH&nbsp;&nbsp;&nbsp;&nbsp; Drive UT_USB20&nbsp;&nbsp;&nbsp; 0.00&nbsp; /dev/sdf&nbsp;&nbsp; /dev/sg6</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In addition to the usual block device file, each entry lists an SCSI generic device file in the last column </span>1<span class="calibre_13">. For example, the generic device for the optical drive at </span><span class="italic">/dev/sr0</span><span class="calibre_13"> is </span><span class="italic">/dev/sg1</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Why would you want to use a generic device? The answer has to do with the complexity of code in the kernel. As tasks get more complicated, it’s better to leave them out of the kernel. Consider CD/DVD writing and reading. Reading an optical disc is a fairly simple operation, and there’s a specialized kernel driver for it.</span></p><p class="calibre_27"><span class="calibre_13"> However, writing an optical disc is significantly more difficult than reading, and no critical system services depend on the action of writing. There’s no reason to threaten kernel space with this activity. Therefore, to </span><span class="italic">write</span><span class="calibre_13"> to an optical disc in Linux, you run a user-space program that talks to a generic SCSI device, such as </span><span class="italic">/dev/sg1.</span><span class="calibre_13"> This program might be a little more inefficient than a kernel driver, but it’s far easier to build and maintain.</span></p><p id="calibre_link-114" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">3.6.4 Multiple Access Methods for a Single Device</span></span></span></p><p class="calibre_45"><span class="calibre_13">The two points of access (</span><span class="italic">sr</span><span class="calibre_13"> and </span><span class="italic">sg</span><span class="calibre_13">) for an optical drive from user space are illustrated for the Linux SCSI subsystem in </span><a></a><a href="#calibre_link-496"><span class="italic"><span class="calibre_4">Figure 3-3</span></span></a><span class="calibre_13"> (any drivers below the SCSI lower layer have been omitted). Process A reads from the drive using the </span><span class="italic">sr</span><span class="calibre_13"> driver, and process B writes to the drive with the </span><span class="italic">sg</span><span class="calibre_13"> driver. However, processes like these would not normally run simultaneously to access the same device.</span></p><p class="calibre_34"><img src="images/000037.jpg" class="calibre_62" />
</p><p id="calibre_link-496" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 3-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Optical device driver schematic</span></span></span></p><p class="calibre_37"><span class="calibre_13"> In </span><a href="#calibre_link-496"><span class="italic"><span class="calibre_4">Figure 3-3</span></span></a><span class="calibre_13">, process A reads from the block device. But do user processes really read data this way? Normally, the answer is no, not directly. There are more layers on top of the block devices and even more points of access for hard disks, as you’ll learn in the next chapter.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-115" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-683" class="calibre_10"><span class="calibre4"><span class="bold">4</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">DISKS AND FILESYSTEMS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">In </span></span><span class="calibre1">Chapter 3</span><span class="calibre1"><span class="calibre_13">, we saw an overview of some of the top-level disk devices that the kernel makes available. In this chapter, we’ll discuss in detail how to work with disks on a Linux system. You’ll learn how to partition disks, create and maintain the filesystems that go inside disk partitions, and work with swap space.</span></span></p><p class="calibre_33"><span class="calibre_13"> Recall that disk devices have names like </span><span class="italic">/dev/sda</span><span class="calibre_13">, the first SCSI subsystem disk. This kind of block device represents the entire disk, but there are many different components and layers inside a disk.</span></p><p class="calibre_27"><a href="#calibre_link-497"><span class="italic"><span class="calibre_4">Figure 4-1</span></span></a><span class="calibre_13"> illustrates a schematic of a simple Linux disk (note that the figure is not to scale). As you progress through this chapter, you’ll learn where each piece fits in.</span></p><p id="calibre_link-713" class="calibre_63">
</p><p class="calibre_34"><img src="images/000041.jpg" class="calibre_64" />
</p><p id="calibre_link-497" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Typical Linux disk schematic</span></span></span></p><p class="calibre_37"><span class="italic">Partitions</span><span class="calibre_13"> are subdivisions of the whole disk. On Linux, they’re denoted with a number after the whole block device, so they have names like </span><span class="italic">/dev/sda1</span><span class="calibre_13"> and </span><span class="italic">/dev/sdb3</span><span class="calibre_13">. The kernel presents each partition as a block device, just as it would an entire disk. Partitions are defined on a small area of the disk called a </span><span class="italic">partition table</span><span class="calibre_13"> (also called a </span><span class="italic">disk label</span><span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Multiple data partitions were once common on systems with large disks because older PCs could boot only from certain parts of the disk. Also, administrators used partitions to reserve a certain amount of space for operating system areas; for example, they didn’t want users to be able to fill up the entire system and prevent critical services from working. This practice is not unique to Unix; you’ll still find many new Windows systems with several partitions on a single disk. In addition, most systems have a separate swap partition.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">The kernel makes it possible for you to access both an entire disk and one of its partitions at the same time, but you wouldn’t normally do so unless you were copying the entire disk.</span></p><p class="calibre_27"><span class="calibre_13"> The Linux </span><span class="italic">Logical Volume Manager (LVM)</span><span class="calibre_13"> adds more flexibility to traditional disk devices and partitions, and is now in use in many systems. We’ll cover LVM in Section </span>4.4<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The next layer up from the partition is the </span><span class="italic">filesystem</span><span class="calibre_13">, the database of files and directories that you’re accustomed to interacting with in user space. We’ll explore filesystems in </span>Section 4.2<span class="calibre_13">.</span></p><p id="calibre_link-711" class="calibre_27"><span class="calibre_13">As you can see in </span><a href="#calibre_link-497"><span class="italic"><span class="calibre_4">Figure 4-1</span></span></a><span class="calibre_13">, if you want to access the data in a file, you need to use the appropriate partition location from the partition table and then search the filesystem database on that partition for the desired file data.</span></p><p class="calibre_27"><span class="calibre_13"> To access data on a disk, the Linux kernel uses the system of layers shown in </span><a></a><a href="#calibre_link-498"><span class="italic"><span class="calibre_4">Figure 4-2</span></span></a><span class="calibre_13">. The SCSI subsystem and everything else described in </span>Section 3.6<span class="calibre_13"> are represented by a single box. Notice that you can work with the disk through the filesystem as well as directly through the disk devices. You’ll see how both methods work in this chapter. To make things simpler, LVM is not represented in </span><a href="#calibre_link-498"><span class="italic"><span class="calibre_4">Figure 4-2</span></span></a><span class="calibre_13">, but it has components in the block device interface and a few management components in user space.</span></p><p class="calibre_27"><span class="calibre_13">To get a handle on how everything fits together, let’s start at the bottom with partitions.</span></p><p class="calibre_34"><img src="images/000007.jpg" class="calibre_65" />
</p><p id="calibre_link-498" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Kernel schematic for disk access</span></span></span></p><div class="mbp_pagebreak"></div><p id="calibre_link-116" class="calibre_23"><span class="calibre1"><span class="bold">4.1 Partitioning Disk Devices</span></span></p><p class="calibre_24"><span class="calibre_13">There are many kinds of partition tables. There’s nothing special about a partition table&mdash;it’s just a bunch of data that says how the blocks on the disk are divided.</span></p><p class="calibre_27"><span class="calibre_13"> The traditional table, dating back to the PC days, is the one found inside the </span><span class="italic">Master Boot Record (MBR)</span><span class="calibre_13">, and it has many limitations. Most newer systems use the </span><span class="italic">Globally Unique Identifier Partition Table (GPT)</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Here are a few of the many Linux partitioning tools:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">parted</span></span>
<span class="bold">(“partition editor”)</span> A text-based tool that supports both MBR and GPT.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">gparted</span></span> A graphical version of <span class="calibre3">parted</span>.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">fdisk</span></span> The traditional text-based Linux disk partitioning tool. Recent versions of <span class="calibre3">fdisk</span> support the MBR, GPT, and many other kinds of partition tables, but older versions were limited to MBR support.</li></ol><p class="calibre_33"><span class="calibre_13"> Because it has supported both the MBR and GPT for some time, and it’s easy to run single commands to get partition labels, we’ll use </span><span class="calibre3">parted</span><span class="calibre_13"> to display partition tables. However, when creating and altering partition tables, we’ll use </span><span class="calibre3">fdisk</span><span class="calibre_13">. This will illustrate both interfaces, and why many people prefer the </span><span class="calibre3">fdisk</span><span class="calibre_13"> interface due to its interactive nature and the fact that it doesn’t make any changes to the disk until you’ve had a chance to review them (we’ll discuss this shortly).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There’s a critical difference between partitioning and filesystem manipulation: the partition table defines simple boundaries on the disk, whereas a filesystem is a much more involved data system. For this reason, we’ll use separate tools for partitioning and creating filesystems (see </span></span><span class="italic">Section 4.2.2</span><span class="italic"><span class="calibre_13">).</span></span></blockquote><p id="calibre_link-117" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.1.1 Viewing a Partition Table</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can view your system’s partition table with </span><span class="calibre3">parted -l</span><span class="calibre_13">. This sample output shows two disk devices with two different kinds of partition tables:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">parted -l</span></span><span class="calibre3"><br class="calibre7" />Model: ATA KINGSTON SM2280S (scsi)1 Disk /dev/sda: 240GB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: msdos<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; File system&nbsp;&nbsp;&nbsp;&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1049kB&nbsp; 223GB&nbsp; 223GB&nbsp;&nbsp; primary&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boot 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 223GB&nbsp;&nbsp; 240GB&nbsp; 17.0GB&nbsp; extended 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 223GB&nbsp;&nbsp; 240GB&nbsp; 17.0GB&nbsp; logical&nbsp;&nbsp; linux-swap(v1)<br class="calibre7" />Model: Generic Flash Disk (scsi)2 Disk /dev/sdf: 4284MBSector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: gpt<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; File system&nbsp; Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1049kB&nbsp; 1050MB&nbsp; 1049MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myfirst 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1050MB&nbsp; 4284MB&nbsp; 3235MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mysecond</span></blockquote><a id="calibre_link-756"></a></blockquote><p class="calibre_30"><span class="calibre_13"> The first device (</span><span class="italic">/dev/sda</span><span class="calibre_13">) </span>1<span class="calibre_13"> uses the traditional MBR partition table (which </span><span class="calibre3">parted</span><span class="calibre_13"> calls </span><span class="calibre3">msdos</span><span class="calibre_13">), and the second (</span><span class="italic">/dev/sdf</span><span class="calibre_13">) </span>2<span class="calibre_13"> contains a GPT. Notice that the two table types store different sets of parameters. In particular, the MBR table has no </span><span class="calibre3">Name</span><span class="calibre_13"> column because names don’t exist under that scheme. (I arbitrarily chose the names </span><span class="calibre3">myfirst</span><span class="calibre_13"> and </span><span class="calibre3">mysecond</span><span class="calibre_13"> in the GPT.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Watch out for the unit sizes when reading partition tables. The </span></span><span class="calibre3">parted</span><span class="italic"><span class="calibre_13"> output shows an approximated size based on what </span></span><span class="calibre3">parted</span><span class="italic"><span class="calibre_13"> thinks is easiest to read. On the other hand, </span></span><span class="calibre3">fdisk -l</span><span class="italic"><span class="calibre_13"> shows an exact number, but in most cases, the units are 512-byte “sectors,” which can be confusing because it might look like you’ve doubled the actual sizes of your disk and partitions. A close look at the </span></span><span class="calibre3">fdisk</span><span class="italic"><span class="calibre_13"> partition table view also reveals the sector size information.</span></span></blockquote><p class="calibre_23"><span class="bold">MBR Basics</span></p><p class="calibre_25"><span class="calibre_13">The MBR table in this example contains primary, extended, and logical partitions. A </span><span class="italic">primary partition</span><span class="calibre_13"> is a normal subdivision of the disk; partition 1 is an example. The basic MBR has a limit of four primary partitions, so if you want more than four, you must designate one as an </span><span class="italic">extended partition</span><span class="calibre_13">. An extended partition breaks down into </span><span class="italic">logical partitions</span><span class="calibre_13">, which the operating system can then use as it would any other partition. In this example, partition 2 is an extended partition that contains logical partition 5.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The filesystem type that </span></span><span class="calibre3">parted</span><span class="italic"><span class="calibre_13"> lists is not necessarily the same as the system ID field in its MBR entries. The MBR system ID is just a number identifying the partition type; for example, </span></span><span class="calibre3">83</span><span class="italic"><span class="calibre_13"> is a Linux partition and </span></span><span class="calibre3">82</span><span class="italic"><span class="calibre_13"> is a Linux swap partition. However, </span></span><span class="calibre3">parted</span><span class="italic"><span class="calibre_13"> attempts to be more informative by determining on its own what kind of filesystem is on that partition. If you absolutely must know the system ID for an MBR, use </span></span><span class="calibre3">fdisk -l</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_23"><span class="bold">LVM Partitions: A Sneak Peek</span></p><p class="calibre_25"><span class="calibre_13">When viewing your partition table, if you see partitions labeled as LVM (code </span><span class="calibre3">8e</span><span class="calibre_13"> as the partition type), devices named </span><span class="calibre3">/dev/dm-*</span><span class="calibre_13">, or references to the “device mapper,” then your system uses LVM. Our discussion will start with traditional direct disk partitioning, which will look slightly different from what’s on a system using LVM.</span></p><p id="calibre_link-708" class="calibre_27"><span class="calibre_13">Just so you know what to expect, let’s take a quick look at some sample </span><span class="calibre3">parted -l</span><span class="calibre_13"> output on a system with LVM (a fresh installation of Ubuntu using LVM on VirtualBox). First, there’s a description of the actual partition table, which looks mostly as you’d expect, except for the </span><span class="calibre3">lvm</span><span class="calibre_13"> flag:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Model: ATA VBOX HARDDISK (scsi)<br class="calibre7" />Disk /dev/sda: 10.7GB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: msdos<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; File system&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1049kB&nbsp; 10.7GB&nbsp; 10.7GB&nbsp; primary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boot, lvm</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Then there are some devices that look like they should be partitions, but are called disks:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Model: Linux device-mapper (linear) (dm)<br class="calibre7" />Disk /dev/mapper/ubuntu--vg-swap_1: 1023MB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: loop<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; File system&nbsp;&nbsp;&nbsp;&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00B&nbsp; 1023MB&nbsp; 1023MB&nbsp; linux-swap(v1)<br class="calibre7" />Model: Linux device-mapper (linear) (dm)<br class="calibre7" />Disk /dev/mapper/ubuntu--vg-root: 9672MB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: loop<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; File system&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00B&nbsp; 9672MB&nbsp; 9672MB&nbsp; ext4</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A simple way to think about this is that the partitions have been somehow separated from the partition table. You’ll see what’s actually going on in </span>Section 4.4<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You’ll get much less detailed output with </span></span><span class="calibre3">fdisk -l</span><span class="italic"><span class="calibre_13">; in the preceding case, you won’t see anything beyond one LVM-labeled physical partition.</span></span></blockquote><p class="calibre_23"><span class="bold">Initial Kernel Read</span></p><p class="calibre_25"><span class="calibre_13">When initially reading the MBR table, the Linux kernel produces debugging output like this (remember that you can view this with </span><span class="calibre3">journalctl -k</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"> sda: sda1 sda2 &lt; sda5 &gt;</span></blockquote></blockquote><p id="calibre_link-757" class="calibre_30"><span class="calibre_13">The </span><span class="calibre3">sda2 &lt; sda5 &gt;</span><span class="calibre_13"> portion of the output indicates that </span><span class="italic">/dev/sda2</span><span class="calibre_13"> is an extended partition containing one logical partition, </span><span class="italic">/dev/sda5</span><span class="calibre_13">. You’ll normally ignore the extended partition itself because you typically care only about accessing the logical partitions it contains.</span></p><p id="calibre_link-118" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.1.2 Modifying Partition Tables</span></span></span></p><p class="calibre_45"><span class="calibre_13">Viewing partition tables is a relatively simple and harmless operation. Altering partition tables is also relatively easy, but making this kind of change to the disk involves risks. Keep the following in mind:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Changing the partition table makes it quite difficult to recover any data on partitions that you delete or redefine, because doing so can erase the location of the filesystems on those partitions. Make sure you have a backup if the disk you’re partitioning contains critical data.</li><li value="2" class="calibre_8"> Ensure that no partitions on your target disk are currently in use. This is a concern because most Linux distributions automatically mount any detected filesystem. (See Section 4.2.3 for more on mounting and unmounting.)</li></ul><p class="calibre_33"><span class="calibre_13"> When you’re ready, choose your partitioning program. If you’d like to use </span><span class="calibre3">parted</span><span class="calibre_13">, you can use the command-line </span><span class="calibre3">parted</span><span class="calibre_13"> utility or a graphical interface, such as </span><span class="calibre3">gparted</span><span class="calibre_13">; </span><span class="calibre3">fdisk</span><span class="calibre_13"> is fairly easy to work with on the command line. These utilities all have online help and are easy to learn. (Try using them on a flash device or something similar if you don’t have any spare disks.)</span></p><p class="calibre_27"><span class="calibre_13"> That said, there is a major difference in the way that </span><span class="calibre3">fdisk</span><span class="calibre_13"> and </span><span class="calibre3">parted</span><span class="calibre_13"> work. With </span><span class="calibre3">fdisk</span><span class="calibre_13">, you design your new partition table before making the actual changes to the disk, and it makes the changes only when you exit the program. But with </span><span class="calibre3">parted</span><span class="calibre_13">, partitions are created, modified, and removed </span><span class="italic">as you issue the commands</span><span class="calibre_13">. You don’t get the chance to review the partition table before you change it.</span></p><p class="calibre_27"><span class="calibre_13"> These differences are also key to understanding how the two utilities interact with the kernel. Both </span><span class="calibre3">fdisk</span><span class="calibre_13"> and </span><span class="calibre3">parted</span><span class="calibre_13"> modify the partitions entirely in user space; there’s no need to provide kernel support for rewriting a partition table, because user space can read and modify all of a block device.</span></p><p class="calibre_27"><span class="calibre_13"> At some point, though, the kernel must read the partition table in order to present the partitions as block devices so you can use them. The </span><span class="calibre3">fdisk</span><span class="calibre_13"> utility uses a relatively simple method. After modifying the partition table, </span><span class="calibre3">fdisk</span><span class="calibre_13"> issues a single system call to tell the kernel that it should reread the disk’s partition table (you’ll see an example of how to interact with </span><span class="calibre3">fdisk</span><span class="calibre_13"> shortly). The kernel then generates debugging output, which you can view with </span><span class="calibre3">journalctl -k</span><span class="calibre_13">. For example, if you create two partitions on </span><span class="italic">/dev/sdf</span><span class="calibre_13">, you’ll see this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">sdf: sdf1 sdf2</span></blockquote></blockquote><p id="calibre_link-584" class="calibre_30"><span class="calibre_13">The </span><span class="calibre3">parted</span><span class="calibre_13"> tools do not use this disk-wide system call; instead, they signal the kernel when individual partitions are altered. After processing a single partition change, the kernel does not produce the preceding debugging output.</span></p><p class="calibre_27"><span class="calibre_13">There are a few ways to see the partition changes:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Use <span class="calibre3">udevadm</span> to watch the kernel event changes. For example, the command <span class="calibre3">udevadm monitor --kernel</span> will show the old partition devices being removed and the new ones being added.</li><li value="2" class="calibre_8"> Check <span class="italic">/proc/partitions</span> for full partition information.</li><li value="3" class="calibre_8"> Check <span class="italic">/sys/block/device/</span> for altered partition system interfaces or <span class="italic">/dev</span> for altered partition devices.</li></ul><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">FORCING A PARTITION TABLE RELOAD</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">If you absolutely must confirm your modifications to a partition table, you can use the </span></span><span class="calibre3">blockdev</span><span class="calibre3"><span class="calibre_13"> command to perform the old-style system call that </span></span><span class="calibre3">fdisk</span><span class="calibre3"><span class="calibre_13"> issues. For example, to force the kernel to reload the partition table on </span></span><span class="calibre3"><span class="italic">/dev/sdf</span></span><span class="calibre3"><span class="calibre_13">, run this:</span></span></blockquote><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3">blockdev --rereadpt /dev/sdf</span></blockquote></blockquote><p id="calibre_link-119" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">4.1.3 Creating a Partition Table</span></span></span></p><p class="calibre_45"><span class="calibre_13">Let’s apply everything you just learned by creating a new partition table on a new, empty disk. This example shows the following scenario:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">4GB disk (a small USB flash device, unused; if you want to follow this example, use any size device that you have at hand)</li><li value="2" class="calibre_8">MBR-style partition table</li><li value="3" class="calibre_8">Two partitions intended to be populated with an ext4 filesystem: 200MB and 3.8GB</li><li value="4" class="calibre_8"> Disk device at <span class="italic">/dev/sdd</span>; you’ll need to find your own device location with <span class="calibre3">lsblk</span></li></ul><p class="calibre_33"><span class="calibre_13"> You’ll use </span><span class="calibre3">fdisk</span><span class="calibre_13"> to do the work. Recall that this is an interactive command, so after ensuring that nothing on the disk is mounted, you’ll start at the command prompt with the device name:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">fdisk /dev/sdd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You’ll get an introductory message and then a command prompt like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help):</span></blockquote></blockquote><p id="calibre_link-709" class="calibre_30"><span class="calibre_13">First, print the current table with the </span><span class="calibre3">p</span><span class="calibre_13"> command (</span><span class="calibre3">fdisk</span><span class="calibre_13"> commands are rather terse). Your interaction will probably look something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help): </span><span class="calibre3"><span class="bold">p</span></span><span class="calibre3"><br class="calibre7" />Disk /dev/sdd: 4 GiB, 4284481536 bytes, 8368128 sectors<br class="calibre7" />Units: sectors of 1 * 512 = 512 bytes<br class="calibre7" />Sector size (logical/physical): 512 bytes / 512 bytes<br class="calibre7" />I/O size (minimum/optimal): 512 bytes / 512 bytes<br class="calibre7" />Disklabel type: dos<br class="calibre7" />Disk identifier: 0x88f290cc<br class="calibre7" />Device&nbsp;&nbsp;&nbsp;&nbsp; Boot Start&nbsp;&nbsp;&nbsp;&nbsp; End Sectors Size Id Type<br class="calibre7" />/dev/sdd1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2048 8368127 8366080&nbsp;&nbsp; 4G&nbsp; c W95 FAT32 (LBA)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Most devices already contain one FAT-style partition, like this one at </span><span class="italic">/dev/sdd1</span><span class="calibre_13">. Because you want to create new partitions for Linux (and, of course, you’re sure you don’t need anything here), you can delete the existing ones like so:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help): </span><span class="calibre3"><span class="bold">d</span></span><span class="calibre3"><br class="calibre7" />Selected partition 1<br class="calibre7" />Partition 1 has been deleted.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Remember that </span><span class="calibre3">fdisk</span><span class="calibre_13"> doesn’t make changes until you explicitly write the partition table, so you haven’t yet modified the disk. If you make a mistake you can’t recover from, use the </span><span class="calibre3">q</span><span class="calibre_13"> command to quit </span><span class="calibre3">fdisk</span><span class="calibre_13"> without writing the changes.</span></p><p class="calibre_27"><span class="calibre_13"> Now you’ll create the first 200MB partition with the </span><span class="calibre3">n</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help): </span><span class="calibre3"><span class="bold">n</span></span><span class="calibre3"><br class="calibre7" />Partition type p&nbsp;&nbsp; primary (0 primary, 0 extended, 4 free) e&nbsp;&nbsp; extended (container for logical partitions)<br class="calibre7" />Select (default p): </span><span class="calibre3"><span class="bold">p</span></span><span class="calibre3"><br class="calibre7" />Partition number (1-4, default 1): </span><span class="calibre3">1</span><span class="calibre3"><br class="calibre7" />First sector (2048-8368127, default 2048): </span><span class="calibre3"><span class="bold">2048</span></span><span class="calibre3"><br class="calibre7" />Last sector, +sectors or +size{K,M,G,T,P} (2048-8368127, default 8368127): </span><span class="calibre3"><span class="bold">+200M</span></span><span class="calibre3"><br class="calibre7" />Created a new partition 1 of type 'Linux' and of size 200 MiB.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3">fdisk</span><span class="calibre_13"> prompts you for the MBR partition style, the partition number, the start of the partition, and its end (or size). The default values are quite often what you want. The only thing changed here is the partition end/size with the </span><span class="calibre3">+</span><span class="calibre_13"> syntax to specify a size and unit.</span></p><p class="calibre_27"><span class="calibre_13"> Creating the second partition works the same way, except you’ll use all default values, so we won’t go over that. When you’re finished laying out the partitions, use the </span><span class="calibre3">p</span><span class="calibre_13"> (print) command to review:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help): </span><span class="calibre3"><span class="bold">p</span></span><span class="calibre3"><br class="calibre7" />[--snip--]<br class="calibre7" />Device&nbsp;&nbsp;&nbsp;&nbsp; Boot&nbsp; Start&nbsp;&nbsp;&nbsp;&nbsp; End Sectors&nbsp; Size Id Type<br class="calibre7" />/dev/sdd1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2048&nbsp; 411647&nbsp; 409600&nbsp; 200M 83 Linux/dev/sdd2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 411648 8368127 7956480&nbsp; 3.8G 83 Linux</span></blockquote><a id="calibre_link-658"></a></blockquote><p class="calibre_30"><span class="calibre_13"> When you’re ready to write the partition table, use the </span><span class="calibre3">w</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Command (m for help): </span><span class="calibre3"><span class="bold">w</span></span><span class="calibre3"><br class="calibre7" />The partition table has been altered.<br class="calibre7" />Calling ioctl() to re-read partition table.<br class="calibre7" />Syncing disks.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Note that </span><span class="calibre3">fdisk</span><span class="calibre_13"> doesn’t ask you if you’re sure as a safety measure; it simply does its work and exits.</span></p><p class="calibre_27"><span class="calibre_13"> If you’re interested in additional diagnostic messages, use </span><span class="calibre3">journalctl -k</span><span class="calibre_13"> to see the kernel read messages mentioned earlier, but remember that you’ll get them only if you’re using </span><span class="calibre3">fdisk</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> At this point, you have all the basics to start partitioning disks, but if you’d like more details about disks, read on. Otherwise, skip ahead to </span>Section 4.2<span class="calibre_13"> to learn about putting a filesystem on the disk.</span></p><p id="calibre_link-120" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.1.4 Navigating Disk and Partition Geometry</span></span></span></p><p class="calibre_45"><span class="calibre_13">Any device with moving parts introduces complexity into a software system because there are physical elements that resist abstraction. A hard disk is no exception; even though you can think of a hard disk as a block device with random access to any block, there can be serious performance consequences if the system isn’t careful about how it lays out data on the disk. Consider the physical properties of the simple single-platter disk illustrated in </span><a></a><a href="#calibre_link-499"><span class="italic"><span class="calibre_4">Figure 4-3</span></span></a><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000035.jpg" class="calibre_67" />
</p><p id="calibre_link-499" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Top-down view of a hard disk</span></span></span></p><p class="calibre_37"><span class="calibre_13"> The disk consists of a spinning platter on a spindle, with a head attached to a moving arm that can sweep across the radius of the disk. As the disk spins underneath the head, the head reads data. When the arm is in one position, the head can read data only from a fixed circle. This circle is called a </span><span class="italic">cylinder</span><span class="calibre_13"> because larger disks have more than one platter, all stacked and spinning around the same spindle. Each platter can have one or two heads, for the top and/or bottom of the platter, and all heads are attached to the same arm and move in concert. Because the arm moves, there are many cylinders on the disk, from small ones around the center to large ones around the periphery of the disk. Finally, you can divide a cylinder into slices called </span><a id="calibre_link-659"></a><span class="italic">sectors</span><span class="calibre_13">. This way of thinking about the disk geometry is called </span><span class="italic">CHS</span><span class="calibre_13">, for </span><span class="italic">cylinder-head-sector</span><span class="calibre_13">; in older systems, you could find any part of the disk by addressing it with these three parameters.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A </span></span>track<span class="italic"><span class="calibre_13"> is the part of a cylinder that a single head accesses, so in </span></span><a href="#calibre_link-499"><span class="italic"><span class="calibre_4">Figure 4-3</span></span></a><span class="italic"><span class="calibre_13">, the cylinder is also a track. You don’t need to worry about tracks.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The kernel and the various partitioning programs can tell you what a disk reports as its number of cylinders. However, on any halfway recent hard disk, </span><span class="italic">the reported values are fiction</span><span class="calibre_13">! The traditional addressing scheme that uses CHS doesn’t scale with modern disk hardware, nor does it account for the fact that you can put more data into outer cylinders than inner cylinders. Disk hardware supports </span><span class="italic">Logical Block Addressing (LBA)</span><span class="calibre_13"> to address a location on the disk by a block number (this is a much more straightforward interface), but remnants of CHS remain. For example, the MBR partition table contains CHS information as well as LBA equivalents, and some boot loaders are still dumb enough to believe the CHS values (don’t worry&mdash;most Linux boot loaders use the LBA values).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The word </span></span>sector<span class="italic"><span class="calibre_13"> is confusing, because Linux partitioning programs can use it to mean a different value.</span></span></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_68"><span class="bold">ARE CYLINDER BOUNDARIES IMPORTANT?</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">The idea of cylinders was once critical to partitioning because cylinders are ideal boundaries for partitions. Reading a data stream from a cylinder is very fast because the head can continuously pick up data as the disk spins. A partition arranged as a set of adjacent cylinders also allows for fast continuous data access because the head doesn’t need to move very far between cylinders.</span></span></blockquote><blockquote class="calibre_69"><span class="calibre3"><span class="calibre_13">Although disks look roughly the same as they always have, the notion of precise partition alignment has become obsolete. Some older partitioning programs complain if you don’t place your partitions precisely on cylinder boundaries. Ignore this; there’s little you can do, because the reported CHS values of modern disks simply aren’t true. The disk’s LBA scheme, along with better logic in newer partitioning utilities, ensures that your partitions are laid out in a reasonable manner.</span></span></blockquote><p id="calibre_link-121" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.1.5 Reading from Solid-State Disks</span></span></span></p><p class="calibre_45"><span class="calibre_13">Storage devices with no moving parts, such as </span><span class="italic">solid-state disks (SSDs)</span><span class="calibre_13">, are radically different from spinning disks in terms of their access characteristics. For these, random access isn’t a problem because there’s no head to sweep across a platter, but certain characteristics can change how an SSD performs.</span></p><p class="calibre_27"><span class="calibre_13"> One of the most significant factors affecting the performance of SSDs is </span><span class="italic">partition alignment</span><span class="calibre_13">. When you read data from an SSD, you read it in chunks (called </span><span class="italic">pages</span><span class="calibre_13">, not to be confused with virtual memory pages)&mdash;such as 4,096 or 8,192 bytes at a time&mdash;and the read must begin at a multiple of that size. This means that if your partition and its data do not lie on a boundary, you may have to do two reads instead of one for small, common operations, such as reading the contents of a directory.</span></p><p class="calibre_27"><span class="calibre_13">Reasonably new versions of partitioning utilities include logic to put newly created partitions at the proper offsets from the beginning of the disks, so you probably don’t need to worry about improper partition alignment. Partitioning tools currently don’t make any calculations; instead, they just align partitions on 1MB boundaries or, more precisely, 2,048 512-byte blocks. This is a rather conservative approach because the boundary aligns with page sizes of 4,096, 8,192, and so on, all the way up to 1,048,576.</span></p><p class="calibre_27"><span class="calibre_13"> However, if you’re curious or want to make sure that your partitions begin on a boundary, you can easily find this information in the </span><span class="italic">/sys/block</span><span class="calibre_13"> directory. Here’s an example for the partition </span><span class="italic">/dev/sdf2</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat /sys/block/sdf/sdf2/start</span></span><span class="calibre3"><br class="calibre7" />1953126</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The output here is the partition’s offset from the start of the device, in units of 512 bytes (again, confusingly called </span><span class="italic">sectors</span><span class="calibre_13"> by the Linux system). If this SSD uses 4,096-byte pages, there are eight of these sectors in a page. All you need to do is see if you can evenly divide the partition offset by 8. In this case, you can’t, so the partition would not attain optimal performance.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-122" class="calibre_23"><span class="calibre1"><span class="bold"> 4.2 Filesystems</span></span></p><p class="calibre_24"><span class="calibre_13">The last link between the kernel and user space for disks is typically the </span><span class="italic">filesystem</span><span class="calibre_13">; this is what you’re accustomed to interacting with when you run commands like </span><span class="calibre3">ls</span><span class="calibre_13"> and </span><span class="calibre3">cd</span><span class="calibre_13">. As previously mentioned, the filesystem is a form of database; it supplies the structure to transform a simple block device into the sophisticated hierarchy of files and subdirectories that users can understand.</span></p><p class="calibre_27"><span class="calibre_13"> At one time, all filesystems resided on disks and other physical media that were intended exclusively for data storage. However, the tree-like directory structure and I/O interface of filesystems are quite versatile, so filesystems now perform a variety of tasks, such as the system interfaces that you see in </span><span class="italic">/sys</span><span class="calibre_13"> and </span><span class="italic">/proc</span><span class="calibre_13">. Filesystems are traditionally implemented in the kernel, but the innovation of 9P from Plan 9 (</span><a id="calibre_link-693"></a><a href="https://en.wikipedia.org/wiki/9P_(protocol)"><span class="italic"><span class="calibre_4">https://en.wikipedia.org/wiki/9P_(protocol)</span></span></a><span class="calibre_13">) has inspired the development of user-space filesystems. The </span><span class="italic">File System in User Space (FUSE)</span><span class="calibre_13"> feature allows user-space filesystems in Linux.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">Virtual File System (VFS)</span><span class="calibre_13"> abstraction layer completes the filesystem implementation. Much as the SCSI subsystem standardizes communication between different device types and kernel control commands, VFS ensures that all filesystem implementations support a standard interface so that user-space applications access files and directories in the same manner. VFS support has enabled Linux to support an extraordinarily large number of filesystems.</span></p><p id="calibre_link-123" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.1 Filesystem Types</span></span></span></p><p class="calibre_45"><span class="calibre_13">Linux filesystem support includes native designs optimized for Linux; foreign types, such as the Windows FAT family; universal filesystems, like ISO 9660; and many others. The following list includes the most common types of filesystems for data storage. The type names as recognized by Linux are in parentheses next to the filesystem names.</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The <span class="italic">Fourth Extended filesystem</span> (ext4) is the current iteration of a line of filesystems native to Linux. The <span class="italic">Second Extended filesystem</span> (ext2) was a longtime default for Linux systems inspired by traditional Unix filesystems, such as the Unix File System (UFS) and the Fast File System (FFS). The <span class="italic">Third Extended filesystem</span> (ext3) added a journal feature (a small cache outside the normal filesystem data structure) to enhance data integrity and hasten booting. The ext4 filesystem is an incremental improvement and supports larger files than ext2 or ext3 as well as a greater number of subdirectories. <blockquote class="calibre_70"><blockquote class="calibre_29"><span class="calibre_13">There’s a certain amount of backward compatibility in the extended filesystem series. For example, you can mount ext2 and ext3 filesystems as each other, and you can mount ext2 and ext3 filesystems as ext4, but you </span><span class="italic">cannot</span><span class="calibre_13"> mount ext4 as ext2 or ext3.</span></blockquote></blockquote></li><li value="2" class="calibre_8"><span class="italic">Btrfs, or B-tree filesystem</span> (btrfs), is a newer filesystem native to Linux designed to scale beyond the capabilities of ext4.</li><li value="3" class="calibre_8"><span class="italic">FAT filesystems</span> (msdos, vfat, exfat) pertain to Microsoft systems. The simple msdos type supports the very primitive monocase variety in MS-DOS systems. Most removable flash media, such as SD cards and USB drives, contain vfat (up to 4GB) or exfat (4GB and up) partitions by default. Windows systems can use either a FAT-based filesystem or the more advanced <span class="italic">NT File System</span> (ntfs).</li><li value="4" class="calibre_8"><span class="italic">XFS</span> is a high-performance filesystem used by default by some distributions, such as Red Hat Enterprise Linux 7.0 and beyond.</li><li value="5" class="calibre_8"><span class="italic">HFS+</span> (hfsplus) is an Apple standard used on most Macintosh systems.</li><li value="6" class="calibre_8"><span class="italic">ISO 9660</span> (iso9660) is a CD-ROM standard. Most CD-ROMs use some variety of the ISO 9660 standard.</li></ul><div class="mbp_pagebreak"></div><blockquote id="calibre_link-766" class="calibre_66"><span class="bold">LINUX FILESYSTEM EVOLUTION</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">The Extended filesystem series has long been perfectly acceptable to most users, and the fact that it has remained the de facto standard for so long is a testament to its utility, but also to its adaptability. The Linux development community has a tendency to completely replace components that don’t meet current needs, but every time the Extended filesystem has come up short, someone has upgraded it in response. Nonetheless, many advances have been made in filesystem technology that even ext4 cannot utilize due to the backward-compatibility requirement. These advances are primarily in scalability enhancements pertaining to very large numbers of files, large files, and similar scenarios.</span></span></blockquote><blockquote class="calibre_69"><span class="calibre3"><span class="calibre_13">At the time of this writing, Btrfs is the default for one major Linux distribution. If this proves a success, it’s likely that Btrfs will be poised to replace the Extended series.</span></span></blockquote><p id="calibre_link-124" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.2.2 Creating a Filesystem</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you’re preparing a new storage device, once you’re finished with the partitioning process described in </span>Section 4.1<span class="calibre_13">, you’re ready to create a filesystem. As with partitioning, you’ll do this in user space because a user-space process can directly access and manipulate a block device.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">mkfs</span><span class="calibre_13"> utility can create many kinds of filesystems. For example, you can create an ext4 partition on </span><span class="italic">/dev/sdf2</span><span class="calibre_13"> with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mkfs -t ext4 /dev/sdf2</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">mkfs</span><span class="calibre_13"> program automatically determines the number of blocks in a device and sets some reasonable defaults. Unless you really know what you’re doing and feel like reading the documentation in detail, don’t change them.</span></p><p class="calibre_27"><span class="calibre_13"> When you create a filesystem, </span><span class="calibre3">mkfs</span><span class="calibre_13"> prints diagnostic output as it works, including output pertaining to the superblock. The </span><span class="italic">superblock</span><span class="calibre_13"> is a key component at the top level of the filesystem database, and it’s so important that </span><span class="calibre3">mkfs</span><span class="calibre_13"> creates a number of backups in case the original is destroyed. Consider recording a few of the superblock backup numbers when </span><span class="calibre3">mkfs</span><span class="calibre_13"> runs, in case you need to recover the superblock in the event of a disk failure (see </span>Section 4.2.11<span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Filesystem creation is a task that you should perform only after adding a new disk or repartitioning an old one. You should create a filesystem just once for each new partition that has no preexisting data (or that has data you want to remove). Creating a new filesystem on top of an existing filesystem will effectively destroy the old data.</span></span></blockquote><div class="mbp_pagebreak"></div><blockquote id="calibre_link-768" class="calibre_68"><span class="bold">WHAT IS MKFS?</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">It turns out that </span></span><span class="calibre3">mkfs</span><span class="calibre3"><span class="calibre_13"> is only a frontend for a series of filesystem creation programs,</span></span><span class="calibre3"><span class="italic">
</span></span><span class="calibre3">mkfs.</span><span class="calibre3"><span class="italic">fs</span></span><span class="calibre3"><span class="calibre_13">, where </span></span><span class="calibre3"><span class="italic">fs</span></span><span class="calibre3"><span class="calibre_13"> is a filesystem type. So when you run </span></span><span class="calibre3">mkfs -t ext4</span><span class="calibre3"><span class="calibre_13">, </span></span><span class="calibre3">mkfs</span><span class="calibre3"><span class="calibre_13"> in turn runs </span></span><span class="calibre3">mkfs.ext4</span><span class="calibre3"><span class="calibre_13">.</span></span></blockquote><blockquote class="calibre_69"><span class="calibre3"><span class="calibre_13"> And there’s even more indirection. Inspect the </span></span><span class="calibre3"><span class="italic">mkfs.*</span></span><span class="calibre3"><span class="calibre_13"> files behind the commands, and you’ll see the following:</span></span></blockquote><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l /sbin/mkfs.*</span></span><span class="calibre3"><br class="calibre7" />-rwxr-xr-x 1 root root 17896 Mar 29 21:49 /sbin/mkfs.bfs<br class="calibre7" />-rwxr-xr-x 1 root root 30280 Mar 29 21:49 /sbin/mkfs.cramfs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 6 Mar 30 13:25 /sbin/mkfs.ext2 -&gt; mke2fs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 6 Mar 30 13:25 /sbin/mkfs.ext3 -&gt; mke2fs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 6 Mar 30 13:25 /sbin/mkfs.ext4 -&gt; mke2fs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 6 Mar 30 13:25 /sbin/mkfs.ext4dev -&gt; mke2fs<br class="calibre7" />-rwxr-xr-x 1 root root 26200 Mar 29 21:49 /sbin/mkfs.minix<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 7 Dec 19&nbsp; 2011 /sbin/mkfs.msdos -&gt; mkdosfs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 6 Mar&nbsp; 5&nbsp; 2012 /sbin/mkfs.ntfs -&gt; mkntfs<br class="calibre7" />lrwxrwxrwx 1 root root&nbsp;&nbsp;&nbsp;&nbsp; 7 Dec 19&nbsp; 2011 /sbin/mkfs.vfat -&gt; mkdosfs</span></blockquote></blockquote><blockquote class="calibre_71"><span class="calibre3"><span class="calibre_13"> As you can see, </span></span><span class="calibre3"><span class="italic">mkfs.ext4</span></span><span class="calibre3"><span class="calibre_13"> is just a symbolic link to </span></span><span class="calibre3"><span class="italic">mke2fs</span></span><span class="calibre3"><span class="calibre_13">. This is important to remember if you run across a system without a specific </span></span><span class="calibre3">mkfs</span><span class="calibre3"><span class="calibre_13"> command or when you’re looking up the documentation for a particular filesystem. Each filesystem’s creation utility has its own manual page, like mke2fs(8). This shouldn’t be a problem on most systems, because accessing the mkfs.ext4(8) manual page should redirect you to the mke2fs(8) manual page, but keep it in mind.</span></span></blockquote><p id="calibre_link-125" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.2.3 Mounting a Filesystem</span></span></span></p><p class="calibre_45"><span class="calibre_13">On Unix, the process of attaching a filesystem to a running system is called </span><span class="italic">mounting</span><span class="calibre_13">. When the system boots, the kernel reads some configuration data and mounts root (</span><span class="calibre3">/</span><span class="calibre_13">) based on the configuration data.</span></p><p class="calibre_27"><span class="calibre_13">In order to mount a filesystem, you must know the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">The filesystem’s device, location, or identifier (such as a disk partition&mdash;where the actual filesystem data resides). Some special-purpose filesystems, such as proc and sysfs, don’t have locations.</li><li value="2" class="calibre_8">The filesystem type.</li><li value="3" class="calibre_8"> The <span class="italic">mount point</span>&mdash;the place in the current system’s directory hierarchy where the filesystem will be attached. The mount point is always a normal directory. For instance, you could use <span class="italic">/music</span> as a mount point for a filesystem containing music. The mount point need not be directly below <span class="italic">/</span>; it can be anywhere on the system.</li></ul><p id="calibre_link-769" class="calibre_33"><span class="calibre_13">The common terminology for mounting a filesystem is “mount a device </span><span class="italic">on</span><span class="calibre_13"> a mount point.” To learn the current filesystem status of your system, you run </span><span class="calibre3">mount</span><span class="calibre_13">. The output (which can be quite lengthy) should look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">mount</span></span><span class="calibre3"><br class="calibre7" />/dev/sda1 on / type ext4 (rw,errors=remount-ro)<br class="calibre7" />proc on /proc type proc (rw,noexec,nosuid,nodev)<br class="calibre7" />sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)<br class="calibre7" />fusectl on /sys/fs/fuse/connections type fusectl (rw)<br class="calibre7" />debugfs on /sys/kernel/debug type debugfs (rw)<br class="calibre7" />securityfs on /sys/kernel/security type securityfs (rw)<br class="calibre7" />udev on /dev type devtmpfs (rw,mode=0755)<br class="calibre7" />devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)<br class="calibre7" />tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Each line corresponds to one currently mounted filesystem, with items in this order:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The device, such as <span class="italic">/dev/sda3</span>. Notice that some of these aren’t real devices (<span class="calibre3">proc</span>, for example) but are stand-ins for real device names because these special-purpose filesystems do not need devices.</li><li value="2" class="calibre_8">The word <span class="calibre3">on</span>.</li><li value="3" class="calibre_8">The mount point.</li><li value="4" class="calibre_8">The word <span class="calibre3">type</span>.</li><li value="5" class="calibre_8">The filesystem type, usually in the form of a short identifier.</li><li value="6" class="calibre_8">Mount options (in parentheses). See Section 4.2.6 for more details.</li></ol><p class="calibre_33"><span class="calibre_13"> To mount a filesystem manually, use the </span><span class="calibre3">mount</span><span class="calibre_13"> command as follows with the filesystem type, device, and desired mount point:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -t </span></span><span class="calibre3"><span class="italic"><span class="bold">type device mountpoint</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> For example, to mount the Fourth Extended filesystem found on the device </span><span class="italic">/dev/sdf2</span><span class="calibre_13"> on </span><span class="italic">/home/extra</span><span class="calibre_13">, use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -t ext4 /dev/sdf2 /home/extra</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You normally don’t need to supply the </span><span class="calibre3">-t</span><span class="calibre_13">
</span><span class="calibre3"><span class="italic">type</span></span><span class="calibre_13"> option because </span><span class="calibre3">mount</span><span class="calibre_13"> usually figures it out for you. However, sometimes it’s necessary to distinguish between two similar types, such as the various FAT-style filesystems.</span></p><p class="calibre_27"><span class="calibre_13"> To unmount (detach) a filesystem, use the </span><span class="calibre3">umount</span><span class="calibre_13"> command as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">umount</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">mountpoint</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You can also unmount a filesystem with its device instead of its mount point.</span></p><blockquote id="calibre_link-582" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Almost all Linux systems include a temporary mount point, </span></span>/mnt<span class="italic"><span class="calibre_13">, which is typically used for testing. Feel free to use it when experimenting with your system, but if you intend to mount a filesystem for extended use, find or make another spot.</span></span></blockquote><p id="calibre_link-126" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.2.4 Filesystem UUID</span></span></span></p><p class="calibre_45"><span class="calibre_13">The method of mounting filesystems discussed in the preceding section depends on device names. However, device names can change because they depend on the order in which the kernel finds the devices. To solve this problem, you can identify and mount filesystems by their </span><span class="italic">universally unique identifier (UUID)</span><span class="calibre_13">, an industry standard for unique “serial numbers” to identify objects in a computer system. Filesystem creation programs like </span><span class="calibre3">mke2fs</span><span class="calibre_13"> generate a UUID when initializing the filesystem data structure.</span></p><p class="calibre_27"><span class="calibre_13"> To view a list of devices and the corresponding filesystems and UUIDs on your system, use the </span><span class="calibre3">blkid</span><span class="calibre_13"> (block ID) program:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">blkid</span></span><span class="calibre3"><br class="calibre7" />/dev/sdf2: UUID="b600fe63-d2e9-461c-a5cd-d3b373a5e1d2" TYPE="ext4" <br class="calibre7" />/dev/sda1: UUID="17f12d53-c3d7-4ab3-943e-a0a72366c9fa" TYPE="ext4" PARTUUID="c9a5ebb0-01"<br class="calibre7" />/dev/sda5: UUID="b600fe63-d2e9-461c-a5cd-d3b373a5e1d2" TYPE="swap" PARTUUID="c9a5ebb0-05"<br class="calibre7" />/dev/sde1: UUID="4859-EFEA" TYPE="vfat"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this example, </span><span class="calibre3">blkid</span><span class="calibre_13"> found four partitions with data: two with ext4 filesystems, one with a swap space signature (see </span>Section 4.3<span class="calibre_13">), and one with a FAT-based filesystem. The Linux native partitions all have standard UUIDs, but the FAT partition doesn’t. You can reference the FAT partition with its FAT volume serial number (in this case, 4859-EFEA).</span></p><p class="calibre_27"><span class="calibre_13"> To mount a filesystem by its UUID, use the </span><span class="calibre3">UUID</span><span class="calibre_13"> mount option. For example, to mount the first filesystem from the preceding list on </span><span class="italic">/home/extra</span><span class="calibre_13">, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount UUID=b600fe63-d2e9-461c-a5cd-d3b373a5e1d2 /home/extra</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Typically you won’t manually mount filesystems by UUID like this, because you normally know the device, and it’s much easier to mount a device by its name than by its crazy UUID. Still, it’s important to understand UUIDs. For one thing, they’re the preferred way to mount non-LVM filesystems in </span><span class="italic">/etc/fstab</span><span class="calibre_13"> automatically at boot time (see </span>Section 4.2.8<span class="calibre_13">). In addition, many distributions use the UUID as a mount point when you insert removable media. In the preceding example, the FAT filesystem is on a flash media card. An Ubuntu system with someone logged in will mount this partition at </span><span class="italic">/media/user/4859-EFEA</span><span class="calibre_13"> upon insertion. The udevd daemon described in </span>Chapter 3<span class="calibre_13"> handles the initial event for the device insertion.</span></p><p class="calibre_27"><span class="calibre_13">You can change the UUID of a filesystem if necessary (for example, if you copied the complete filesystem from somewhere else and now need to distinguish it from the original). See the tune2fs(8) manual page for how to do this on an ext2/ext3/ext4 filesystem.</span></p><p id="calibre_link-127" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.5 Disk Buffering, Caching, and Filesystems</span></span></span></p><p class="calibre_45"><span class="calibre_13">Linux, like other Unix variants, buffers writes to the disk. This means the kernel usually doesn’t immediately write changes to filesystems when processes request changes. Instead, it stores those changes in RAM until the kernel determines a good time to actually write them to the disk. This buffering system is transparent to the user and provides a very significant performance gain.</span></p><p class="calibre_27"><span class="calibre_13"> When you unmount a filesystem with </span><span class="calibre3">umount</span><span class="calibre_13">, the kernel automatically </span><span class="italic">synchronizes</span><span class="calibre_13"> with the disk, writing the changes in its buffer to the disk. You can also force the kernel to do this at any time by running the </span><span class="calibre3">sync</span><span class="calibre_13"> command, which by default synchronizes all the disks on the system. If for some reason you can’t unmount a filesystem before you turn off the system, be sure to run </span><span class="calibre3">sync</span><span class="calibre_13"> first.</span></p><p class="calibre_27"><span class="calibre_13">In addition, the kernel uses RAM to cache blocks as they’re read from a disk. Therefore, if one or more processes repeatedly access a file, the kernel doesn’t have to go to the disk again and again&mdash;it can simply read from the cache and save time and resources.</span></p><p id="calibre_link-128" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.6 Filesystem Mount Options</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are many ways to change the </span><span class="calibre3">mount</span><span class="calibre_13"> command behavior, which you’ll often need to do when working with removable media or performing system maintenance. In fact, the total number of </span><span class="calibre3">mount</span><span class="calibre_13"> options is staggering. The extensive mount(8) manual page is a good reference, but it’s hard to know where to start and what you can safely ignore. You’ll see the most useful options in this section.</span></p><p class="calibre_27"><span class="calibre_13"> Options fall into two rough categories: general and filesystem-specific. General options typically work for all filesystem types and include </span><span class="calibre3">-t</span><span class="calibre_13"> for specifying the filesystem type, as shown earlier. In contrast, a filesystem-specific option pertains only to certain filesystem types.</span></p><p class="calibre_27"><span class="calibre_13"> To activate a filesystem option, use the </span><span class="calibre3">-o</span><span class="calibre_13"> switch followed by the option. For example, </span><span class="calibre3">-o remount,rw</span><span class="calibre_13"> remounts a filesystem already mounted as read-only in read-write mode.</span></p><p class="calibre_46"><span class="bold">Short General Options</span></p><p class="calibre_25"><span class="calibre_13">General options have a short syntax. The most important are:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">-r</span></span> The <span class="calibre3">-r</span> option mounts the filesystem in read-only mode. This has a number of uses, from write protection to bootstrapping. You don’t need to specify this option when accessing a read-only device, such as a CD-ROM; the system will do it for you (and will also tell you about the read-only status).</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">-n</span></span> The <span class="calibre3">-n</span> option ensures that <span class="calibre3">mount</span> does not try to update the system runtime mount database, <span class="italic">/etc/mtab</span>. By default, the <span class="calibre3">mount</span> operation fails when it cannot write to this file, so this option is important at boot time because the root partition (including the system mount database) is read-only at first. You’ll also find this option handy when trying to fix a system problem in single-user mode, because the system mount database may not be available at the time.</li><a id="calibre_link-742"></a><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">-t</span></span> The <span class="calibre3">-t </span><span class="calibre3"><span class="italic">type</span></span> option specifies the filesystem type.</li></ol><p class="calibre_46"><span class="bold">Long Options</span></p><p class="calibre_25"><span class="calibre_13">Short options like </span><span class="calibre3">-r</span><span class="calibre_13"> are too limited for the ever-increasing number of </span><span class="calibre3">mount</span><span class="calibre_13"> options; there are too few letters in the alphabet to accommodate all possible options. Short options are also troublesome because it’s difficult to determine an option’s meaning based on a single letter. Many general options and all filesystem-specific options use a longer, more flexible option format.</span></p><p class="calibre_27"><span class="calibre_13"> To use long options with </span><span class="calibre3">mount</span><span class="calibre_13"> on the command line, start with </span><span class="calibre3">-o</span><span class="calibre_13"> followed by the appropriate keywords separated by commas. Here’s a complete example, with the long options following </span><span class="calibre3">-o</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -t vfat /dev/sde1 /dos -o ro,uid=1000</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The two long options here are </span><span class="calibre3">ro</span><span class="calibre_13"> and </span><span class="calibre3">uid=1000</span><span class="calibre_13">. The </span><span class="calibre3">ro</span><span class="calibre_13"> option specifies read-only mode and is the same as the </span><span class="calibre3">-r</span><span class="calibre_13"> short option. The </span><span class="calibre3">uid=1000</span><span class="calibre_13"> option tells the kernel to treat all files on the filesystem as if user ID 1000 is the owner.</span></p><p class="calibre_27"><span class="calibre_13">The most useful long options are these:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">exec</span></span><span class="bold">, </span><span class="calibre3"><span class="bold">noexec</span></span> Enables or disables execution of programs on the filesystem.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">suid</span></span><span class="bold">, </span><span class="calibre3"><span class="bold">nosuid</span></span> Enables or disables <span class="calibre3">setuid</span> programs.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">ro</span></span> Mounts the filesystem in read-only mode (as does the <span class="calibre3">-r</span> short option).</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">rw</span></span> Mounts the filesystem in read-write mode.</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There is a difference between Unix and DOS text files, principally in how lines end. In Unix, only a linefeed (</span></span><span class="calibre3">\n</span><span class="italic"><span class="calibre_13">, ASCII 0x0A) marks the end of a line, but DOS uses a carriage return (</span></span><span class="calibre3">\r</span><span class="italic"><span class="calibre_13">, ASCII 0x0D) followed by a linefeed. There have been many attempts at automatic conversion at the filesystem level, but these are always problematic. Text editors such as vim can automatically detect the newline style of a file and maintain it appropriately. It’s easier to keep the styles uniform this way.</span></span></blockquote><p id="calibre_link-129" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.2.7 Remounting a Filesystem</span></span></span></p><p class="calibre_45"><span class="calibre_13">There will be times when you need to change the </span><span class="calibre3">mount</span><span class="calibre_13"> options for a currently mounted filesystem; the most common situation is when you need to make a read-only filesystem writable during crash recovery. In that case, you need to reattach the filesystem at the same mount point.</span></p><p id="calibre_link-736" class="calibre_27"><span class="calibre_13">The following command remounts the root directory in read-write mode (you need the </span><span class="calibre3">-n</span><span class="calibre_13"> option because the </span><span class="calibre3">mount</span><span class="calibre_13"> command can’t write to the system mount database when the root is read-only):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -n -o remount /</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This command assumes that the correct device listing for </span><span class="italic">/</span><span class="calibre_13"> is in </span><span class="italic">/etc/fstab</span><span class="calibre_13"> (as discussed in the next section). If it isn’t, you must specify the device as an additional option.</span></p><p id="calibre_link-130" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.8 The /etc/fstab Filesystem Table</span></span></span></p><p class="calibre_45"><span class="calibre_13">To mount filesystems at boot time and take the drudgery out of the </span><span class="calibre3">mount</span><span class="calibre_13"> command, Linux systems keep a permanent list of filesystems and options in </span><span class="italic">/etc/fstab</span><span class="calibre_13">. This is a plaintext file in a very simple format, as </span><a></a><a href="#calibre_link-500"><span class="italic"><span class="calibre_4">Listing 4-1</span></span></a><span class="calibre_13"> shows.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">UUID=70ccd6e7-6ae6-44f6-812c-51aab8036d29 / ext4 errors=remount-ro 0 1<br class="calibre7" />UUID=592dcfd1-58da-4769-9ea8-5f412a896980 none swap sw 0 0<br class="calibre7" />/dev/sr0 /cdrom iso9660&nbsp; ro,user,nosuid,noauto 0 0</span></blockquote></blockquote><blockquote id="calibre_link-500" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 4-1</span></span><span class="italic"><span class="calibre_13">: List of filesystems and options in </span></span>/etc/fstab</blockquote><p class="calibre_37"><span class="calibre_13">Each line corresponds to one filesystem and is broken into six fields. From left to right, these fields are:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">The device or UUID</span> Most current Linux systems no longer use the device in <span class="italic">/etc/fstab</span>, preferring the UUID.</li><li value="2" class="calibre_8"><span class="bold">The mount point</span> Indicates where to attach the filesystem.</li><li value="3" class="calibre_8"><span class="bold">The filesystem type</span> You may not recognize <span class="calibre3">swap</span> in this list; this is a swap partition (see Section 4.3).</li><li value="4" class="calibre_8"><span class="bold">Options</span> Long options, separated by commas.</li><li value="5" class="calibre_8"><span class="bold">Backup information for use by the </span><span class="calibre3"><span class="bold">dump</span></span><span class="bold"> command</span> The <span class="calibre3">dump</span> command is a long-obsolete backup utility; this field is no longer relevant. You should always set it to <span class="calibre3">0</span>.</li><li value="6" class="calibre_8"><span class="bold">The filesystem integrity test order</span> To ensure that <span class="calibre3">fsck</span> always runs on the root first, always set this to <span class="calibre3">1</span> for the root filesystem and <span class="calibre3">2</span> for any other locally attached filesystems on a hard disk or SSD. Use <span class="calibre3">0</span> to disable the bootup check for every other filesystem, including read-only devices, swap, and the <span class="italic">/proc</span> filesystem (see the <span class="calibre3">fsck</span> command in Section 4.2.11).</li></ol><p class="calibre_33"><span class="calibre_13"> When using </span><span class="calibre3">mount</span><span class="calibre_13">, you can take some shortcuts if the filesystem you want to work with is in </span><span class="italic">/etc/fstab</span><span class="calibre_13">. For example, if you were using </span><a href="#calibre_link-500"><span class="italic"><span class="calibre_4">Listing 4-1</span></span></a><span class="calibre_13"> and mounting a CD-ROM, you would simply run </span><span class="calibre3">mount /cdrom</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You can also try to simultaneously mount all entries in </span><span class="italic">/etc/fstab</span><span class="calibre_13"> that do not contain the </span><span class="calibre3">noauto</span><span class="calibre_13"> option with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -a</span></span></blockquote></blockquote><p id="calibre_link-698" class="calibre_30"><a href="#calibre_link-500"><span class="italic"><span class="calibre_4">Listing 4-1</span></span></a><span class="calibre_13"> introduces some new options&mdash;namely, </span><span class="calibre3">errors</span><span class="calibre_13">, </span><span class="calibre3">noauto</span><span class="calibre_13">, and </span><span class="calibre3">user</span><span class="calibre_13">, because they don’t apply outside the </span><span class="italic">/etc/fstab</span><span class="calibre_13"> file. In addition, you’ll often see the </span><span class="calibre3">defaults</span><span class="calibre_13"> option here. These options are defined as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">defaults</span></span> This sets the <span class="calibre3">mount</span> defaults: read-write mode, enable device files, executables, the <span class="calibre3">setuid</span> bit, and so on. Use this when you don’t want to give the filesystem any special options but you do want to fill all fields in <span class="italic">/etc/fstab</span>.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">errors</span></span> This ext2/3/4-specific parameter sets the kernel behavior when the system has trouble mounting a filesystem. The default is normally <span class="calibre3">errors=continue</span>, meaning that the kernel should return an error code and keep running. To have the kernel try the mount again in read-only mode, use <span class="calibre3">errors=remount-ro</span>. The <span class="calibre3">errors=panic</span> setting tells the kernel (and your system) to halt when there’s a problem with the mount.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">noauto</span></span> This option tells a <span class="calibre3">mount -a</span> command to ignore the entry. Use this to prevent a boot-time mount of a removable-media device, such as a flash storage device.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">user</span></span> This option allows unprivileged users to run <span class="calibre3">mount</span> on a particular entry, which can be handy for allowing certain kinds of access to removable media. Because users can put a <span class="italic">setuid-root</span> file on removable media with another system, this option also sets <span class="calibre3">nosuid</span>, <span class="calibre3">noexec</span>, and <span class="calibre3">nodev</span> (to bar special device files). Keep in mind that for removable media and other general cases, this option is now of limited use, because most systems use <span class="calibre3">ubus</span> along with other mechanisms to automatically mount inserted media. However, this option can be useful in special cases when you want to grant control over mounting specific directories.</li></ol><p id="calibre_link-131" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.9 Alternatives to /etc/fstab</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although the </span><span class="italic">/etc/fstab</span><span class="calibre_13"> file has been the traditional way to represent filesystems and their mount points, there are two alternatives. The first is an </span><span class="italic">/etc/fstab.d</span><span class="calibre_13"> directory, which contains individual filesystem configuration files (one file for each filesystem). The idea is very similar to many other configuration directories that you’ll see throughout this book.</span></p><p class="calibre_27"><span class="calibre_13"> A second alternative is to configure </span><span class="italic">systemd units</span><span class="calibre_13"> for the filesystems. You’ll learn more about systemd and its units in </span>Chapter 6<span class="calibre_13">. However, the systemd unit configuration is often generated from (or based on) the </span><span class="italic">/etc/fstab</span><span class="calibre_13"> file, so you may find some overlap on your system.</span></p><p id="calibre_link-132" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.10 Filesystem Capacity</span></span></span></p><p class="calibre_45"><span class="calibre_13">To view the size and utilization of your currently mounted filesystems, use the </span><span class="calibre3">df</span><span class="calibre_13"> command. The output can be very extensive (and it gets longer all the time, thanks to specialized filesystems), but it should include information on your actual storage devices.</span></p><p id="calibre_link-721" class="calibre_63">
</p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">df</span></span><span class="calibre3"><br class="calibre7" />Filesystem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1K-blocks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Used&nbsp; Available Use% Mounted on<br class="calibre7" />/dev/sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 214234312 127989560&nbsp;&nbsp; 75339204&nbsp; 63% /<br class="calibre7" />/dev/sdd2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3043836&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4632&nbsp;&nbsp;&nbsp; 2864872&nbsp;&nbsp; 1% /media/user/uuid</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here’s a brief description of the fields in the </span><span class="calibre3">df</span><span class="calibre_13"> output:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Filesystem</span></span> The filesystem device</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">1K-blocks</span></span> The total capacity of the filesystem in blocks of 1,024 bytes</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">Used</span></span> The number of occupied blocks</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">Available</span></span> The number of free blocks</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">Use%</span></span> The percentage of blocks in use</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">Mounted on</span></span> The mount point</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re having trouble finding the correct line in the </span></span><span class="calibre3">df</span><span class="italic"><span class="calibre_13"> output corresponding to a particular directory, run the </span></span><span class="calibre3">df dir</span><span class="italic"><span class="calibre_13"> command, where </span></span><span class="calibre3">dir</span><span class="italic"><span class="calibre_13"> is the directory you want to examine. This limits output to the filesystem for that directory. A very common use is </span></span><span class="calibre3">df .</span><span class="italic"><span class="calibre_13">, which limits the output to the device holding your current directory.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> It should be easy to see that the two filesystems here are roughly 215GB and 3GB in size. However, the capacity numbers may look a little strange because 127,989,560 plus 75,339,204 does not equal 214,234,312, and 127,989,560 is not 63 percent of 214,234,312. In both cases, 5 percent of the total capacity is unaccounted for. In fact, the space is there, but it’s hidden in </span><span class="italic">reserved</span><span class="calibre_13"> blocks. Only the superuser can use the reserved blocks of the filesystem when it starts to fill up. This feature keeps system servers from immediately failing when they run out of disk space.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">GETTING A USAGE LISTING</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">If your disk fills up and you need to know where all of those space-hogging media files are, use the </span></span><span class="calibre3">du</span><span class="calibre3"><span class="calibre_13"> command. With no arguments, </span></span><span class="calibre3">du</span><span class="calibre3"><span class="calibre_13"> prints the disk usage of every directory in the directory hierarchy, starting at the current working directory. (That can be a </span></span><span class="calibre3"><span class="italic">long</span></span><span class="calibre3"><span class="calibre_13"> listing; if you want to see an example, just run </span></span><span class="calibre3">cd /; du</span><span class="calibre3"><span class="calibre_13"> to get the idea. Press </span></span><span class="calibre3">CTRL</span><span class="calibre3"><span class="calibre_13">-C</span></span><span class="calibre3">
</span><span class="calibre3"><span class="calibre_13">when you get bored.) The </span></span><span class="calibre3">du -s</span><span class="calibre3"><span class="calibre_13"> command turns on summary mode to print only the grand total. To evaluate everything (files and subdirectories) in a particular directory, change to that directory and run </span></span><span class="calibre3">du -s *</span><span class="calibre3"><span class="calibre_13">, keeping in mind that there can be some dot directories that this command won’t catch.</span></span></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The POSIX standard defines a block size of 512 bytes. However, this size is harder to read, so by default, the </span></span><span class="calibre3">df</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">du</span><span class="italic"><span class="calibre_13"> output in most Linux distributions is in 1,024-byte blocks. If you insist on displaying the numbers in 512-byte blocks, set the POSIXLY_CORRECT environment variable. To explicitly specify 1,024-byte blocks, use the </span></span><a id="calibre_link-699"></a><span class="calibre3">-k</span><span class="italic"><span class="calibre_13"> option (both utilities support this). The </span></span><span class="calibre3">df</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">du</span><span class="italic"><span class="calibre_13"> programs also have a </span></span><span class="calibre3">-m</span><span class="italic"><span class="calibre_13"> option to list capacities in 1MB blocks and a </span></span><span class="calibre3">-h</span><span class="italic"><span class="calibre_13"> option to take a best guess at what’s easiest for a person to read, based on the overall sizes of the filesystems.</span></span></blockquote><p id="calibre_link-133" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">4.2.11 Checking and Repairing Filesystems</span></span></span></p><p class="calibre_45"><span class="calibre_13">The optimizations that Unix filesystems offer are made possible by a sophisticated database mechanism. For filesystems to work seamlessly, the kernel has to trust that a mounted filesystem has no errors and also that the hardware stores data reliably. If errors exist, data loss and system crashes may result.</span></p><p class="calibre_27"><span class="calibre_13">Aside from hardware problems, filesystem errors are usually due to a user shutting down the system in a rude way (for example, by pulling out the power cord). In such cases, the previous filesystem cache in memory may not match the data on the disk, and the system also may be in the process of altering the filesystem when you happen to give the computer a kick. Although many filesystems support journals to make filesystem corruption far less common, you should always shut down the system properly. Regardless of the filesystem in use, filesystem checks are still necessary every now and then to make sure that everything is still in order.</span></p><p class="calibre_27"><span class="calibre_13"> The tool to check a filesystem is </span><span class="calibre3">fsck</span><span class="calibre_13">. As with the </span><span class="calibre3">mkfs</span><span class="calibre_13"> program, there’s a different version of </span><span class="calibre3">fsck</span><span class="calibre_13"> for each filesystem type that Linux supports. For example, when run on an Extended filesystem series (ext2/ext3/ext4), </span><span class="calibre3">fsck</span><span class="calibre_13"> recognizes the filesystem type and starts the </span><span class="calibre3">e2fsck</span><span class="calibre_13"> utility. Therefore, you generally don’t need to type </span><span class="calibre3">e2fsck</span><span class="calibre_13">, unless </span><span class="calibre3">fsck</span><span class="calibre_13"> can’t figure out the filesystem type or you’re looking for the </span><span class="calibre3">e2fsck</span><span class="calibre_13"> manual page.</span></p><p class="calibre_27"><span class="calibre_13"> The information presented in this section is specific to the Extended filesystem series and </span><span class="calibre3">e2fsck</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> To run </span><span class="calibre3">fsck</span><span class="calibre_13"> in interactive manual mode, give the device or the mount point (as listed in </span><span class="italic">/etc/fstab</span><span class="calibre_13">) as the argument. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">fsck /dev/sdb1</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Never use </span></span><span class="calibre3">fsck</span><span class="italic"><span class="calibre_13"> on a mounted filesystem&mdash;the kernel may alter the disk data as you run the check, causing runtime mismatches that can crash your system and corrupt files. There is only one exception: if you mount the root partition read-only in single-user mode, you may use </span></span><span class="calibre3">fsck</span><span class="italic"><span class="calibre_13"> on it.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> In manual mode, </span><span class="calibre3">fsck</span><span class="calibre_13"> prints verbose status reports on its passes, which should look something like this when there are no problems:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Pass 1: Checking inodes, blocks, and sizes<br class="calibre7" />Pass 2: Checking directory structure<br class="calibre7" />Pass 3: Checking directory connectivity<br class="calibre7" />Pass 4: Checking reference counts<br class="calibre7" />Pass 5: Checking group summary information<br class="calibre7" />/dev/sdb1: 11/1976 files (0.0% non-contiguous), 265/7891 blocks</span></blockquote></blockquote><p id="calibre_link-798" class="calibre_30"><span class="calibre_13">If </span><span class="calibre3">fsck</span><span class="calibre_13"> finds a problem in manual mode, it stops and asks a question relevant to fixing the problem. These questions deal with the internal structure of the filesystem, such as reconnecting loose inodes and clearing blocks (</span><span class="italic">inodes</span><span class="calibre_13"> are building blocks of the filesystem; you’ll see how they work in </span>Section 4.6<span class="calibre_13">). When </span><span class="calibre3">fsck</span><span class="calibre_13"> asks you about reconnecting an inode, it has found a file that doesn’t appear to have a name. When reconnecting such a file, </span><span class="calibre3">fsck</span><span class="calibre_13"> places the file in the </span><span class="italic">lost+found</span><span class="calibre_13"> directory in the filesystem, with a number as the filename. If this happens, you need to guess the name based on the file’s contents; the original filename is probably gone.</span></p><p class="calibre_27"><span class="calibre_13"> In general, it’s pointless to sit through the </span><span class="calibre3">fsck</span><span class="calibre_13"> repair process if you’ve just uncleanly shut down the system, because </span><span class="calibre3">fsck</span><span class="calibre_13"> may have a lot of minor errors to fix. Fortunately, </span><span class="calibre3">e2fsck</span><span class="calibre_13"> has a </span><span class="calibre3">-p</span><span class="calibre_13"> option that automatically fixes ordinary problems without asking and aborts when there’s a serious error. In fact, Linux distributions run a variant of </span><span class="calibre3">fsck -p</span><span class="calibre_13"> at boot time. (You may also see </span><span class="calibre3">fsck -a</span><span class="calibre_13">, which does the same thing.)</span></p><p class="calibre_27"><span class="calibre_13"> If you suspect a major disaster on your system, such as a hardware failure or device misconfiguration, you need to decide on a course of action, because </span><span class="calibre3">fsck</span><span class="calibre_13"> can really mess up a filesystem that has larger problems. (One telltale sign that your system has a serious problem is if </span><span class="calibre3">fsck</span><span class="calibre_13"> asks a </span><span class="italic">lot</span><span class="calibre_13"> of questions in manual mode.)</span></p><p class="calibre_27"><span class="calibre_13"> If you think that something really bad has happened, try running </span><span class="calibre3">fsck -n</span><span class="calibre_13"> to check the filesystem without modifying anything. If there’s a problem with the device configuration that you think you can fix (such as loose cables or an incorrect number of blocks in the partition table), fix it before running </span><span class="calibre3">fsck</span><span class="calibre_13"> for real, or you’re likely to lose a lot of data.</span></p><p class="calibre_27"><span class="calibre_13"> If you suspect that only the superblock is corrupt (for example, because someone wrote to the beginning of the disk partition), you might be able to recover the filesystem with one of the superblock backups that </span><span class="calibre3">mkfs</span><span class="calibre_13"> creates. Use </span><span class="calibre3">fsck -b</span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic">num</span></span><span class="calibre_13"> to replace the corrupted superblock with an alternate at block </span><span class="calibre3"><span class="italic">num</span></span><span class="calibre_13"> and hope for the best.</span></p><p class="calibre_27"><span class="calibre_13"> If you don’t know where to find a backup superblock, you might be able to run </span><span class="calibre3">mkfs -n</span><span class="calibre_13"> on the device to view a list of superblock backup numbers without destroying your data. (Again, </span><span class="italic">make sure</span><span class="calibre_13"> that you’re using </span><span class="calibre3">-n</span><span class="calibre_13">, or you’ll </span><span class="italic">really</span><span class="calibre_13"> tear up the filesystem.)</span></p><p class="calibre_46"><span class="bold">Checking ext3 and ext4 Filesystems</span></p><p class="calibre_25"><span class="calibre_13">You normally do not need to check ext3 and ext4 filesystems manually because the journal ensures data integrity (recall that the </span><span class="italic">journal</span><span class="calibre_13"> is a small data cache that has not yet been written to a specific spot in the filesystem). If you don’t shut your system down cleanly, you can expect the journal to contain some data. To flush the journal in an ext3 or ext4 filesystem to the regular filesystem database, run </span><span class="calibre3">e2fsck</span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">e2fsck &ndash;fy /dev/</span></span><span class="calibre3"><span class="italic"><span class="bold">disk_device</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> However, you may want to mount a broken ext3 or ext4 filesystem in ext2 mode, because the kernel won’t mount an ext3 or ext4 filesystem with a nonempty journal.</span><span class="calibre3"><span class="italic"><span class="bold">
</span></span></span></p><p id="calibre_link-666" class="calibre_46"><span class="bold">The Worst Case</span></p><p class="calibre_25"><span class="calibre_13">Disk problems that are more severe leave you with few choices:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> You can try to extract the entire filesystem image from the disk with <span class="calibre3">dd</span> and transfer it to a partition on another disk of the same size.</li><li value="2" class="calibre_8">You can try to patch the filesystem as much as possible, mount it in read-only mode, and salvage what you can.</li><li value="3" class="calibre_8"> You can try <span class="calibre3">debugfs</span>.</li></ul><p class="calibre_33"><span class="calibre_13"> In the first two cases, you still need to repair the filesystem before you mount it, unless you feel like picking through the raw data by hand. If you like, you can choose to answer </span><span class="calibre3">y</span><span class="calibre_13"> to all of the </span><span class="calibre3">fsck</span><span class="calibre_13"> questions by entering </span><span class="calibre3">fsck -y</span><span class="calibre_13">, but do this as a last resort because issues may come up during the repair process that you would rather handle manually.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">debugfs</span><span class="calibre_13"> tool allows you to look through the files on a filesystem and copy them elsewhere. By default, it opens filesystems in read-only mode. If you’re recovering data, it’s probably a good idea to keep your files intact to avoid messing things up further.</span></p><p class="calibre_27"><span class="calibre_13">Now, if you’re really desperate&mdash;say with a catastrophic disk failure on your hands and no backups&mdash;there isn’t a lot you can do other than hope a professional service can “scrape the platters.”</span></p><p id="calibre_link-134" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.2.12 Special-Purpose Filesystems</span></span></span></p><p class="calibre_45"><span class="calibre_13">Not all filesystems represent storage on physical media. Most versions of Unix have filesystems that serve as system interfaces. That is, rather than serving only as a means to store data on a device, a filesystem can represent system information, such as process IDs and kernel diagnostics. This idea goes back to the </span><span class="italic">/dev</span><span class="calibre_13"> mechanism, which is an early model of using files for I/O interfaces. The </span><span class="italic">/proc</span><span class="calibre_13"> idea came from the eighth edition of research Unix, implemented by Tom J. Killian and accelerated when Bell Labs (including many of the original Unix designers) created Plan 9&mdash;a research operating system that took filesystem abstraction to a whole new level (</span><a href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs"><span class="italic"><span class="calibre_4">https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs</span></span></a><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13">Some of the special filesystem types in common use on Linux include:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">proc</span></span> Mounted on <span class="italic">/proc</span>. The name <span class="calibre3">proc</span> is an abbreviation for <span class="italic">process</span>. Each <span class="italic">numbered</span> directory inside <span class="italic">/proc</span> refers to the ID of a current process on the system; the files in each directory represent various aspects of that process. The directory <span class="italic">/proc/self</span> represents the current process. The Linux <span class="calibre3">proc</span> filesystem includes a great deal of additional kernel and hardware information in files like <span class="italic">/proc/cpuinfo</span>. Keep in mind that the kernel design guidelines recommend moving information unrelated to processes out of <span class="italic">/proc</span> and into <span class="italic">/sys</span>, so system information in <span class="italic">/proc</span> might not be the most current interface.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">sysfs</span></span> Mounted on <span class="italic">/sys</span>. (You saw this in Chapter 3.)</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">tmpfs</span></span> Mounted on <span class="italic">/run</span> and other locations. With <span class="calibre3">tmpfs</span>, you can use your physical memory and swap space as temporary storage. You can mount <span class="calibre3">tmpfs</span> where you like, using the <span class="calibre3">size</span> and <span class="calibre3">nr_blocks</span> long options to control the maximum size. However, be careful not to pour things constantly into a <span class="calibre3">tmpfs</span> location, because your system will eventually run out of memory and programs will start to crash.</li><a id="calibre_link-772"></a><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">squashfs</span></span> A type of read-only filesystem where content is stored in a compressed format and extracted on demand through a loopback device. One example use is in the snap package management system that mounts packages under the <span class="italic">/snap</span> directory.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">overlay</span></span> A filesystem that merges directories into a composite. Containers often use overlay filesystems; you’ll see how they work in Chapter 17.</li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-135" class="calibre_23"><span class="calibre1"><span class="bold"> 4.3 Swap Space</span></span></p><p class="calibre_24"><span class="calibre_13">Not every partition on a disk contains a filesystem. It’s also possible to augment the RAM on a machine with disk space. If you run out of real memory, the Linux virtual memory system can automatically move pieces of memory to and from disk storage. This is called </span><span class="italic">swapping</span><span class="calibre_13"> because pieces of idle programs are swapped to the disk in exchange for active pieces residing on the disk. The disk area used to store memory pages is called </span><span class="italic">swap space</span><span class="calibre_13"> (or just </span><span class="italic">swap</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">free</span><span class="calibre_13"> command’s output includes the current swap usage in kilobytes as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">free</span></span><span class="calibre3"> total&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; used&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; free<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />Swap:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 514072&nbsp;&nbsp;&nbsp;&nbsp; 189804&nbsp;&nbsp;&nbsp;&nbsp; 324268</span></blockquote></blockquote><p id="calibre_link-136" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">4.3.1 Using a Disk Partition as Swap Space</span></span></span></p><p class="calibre_45"><span class="calibre_13">To use an entire disk partition as swap, follow these steps:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Make sure the partition is empty.</li><li value="2" class="calibre_8">Run <span class="calibre3">mkswap </span><span class="calibre3"><span class="italic">dev</span></span>, where <span class="calibre3"><span class="italic">dev</span></span> is the partition’s device. This command puts a <span class="italic">swap signature</span> on the partition, marking it as swap space (rather than a filesystem or otherwise).</li><li value="3" class="calibre_8">Execute <span class="calibre3">swapon </span><span class="calibre3"><span class="italic">dev</span></span> to register the space with the kernel.</li></ol><p class="calibre_33"><span class="calibre_13"> After creating a swap partition, you can put a new swap entry in your </span><span class="italic">/etc/fstab</span><span class="calibre_13"> file to make the system use the swap space as soon as the machine boots. Here’s a sample entry that uses </span><span class="italic">/dev/sda5</span><span class="calibre_13"> as a swap partition:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/dev/sda5 none swap sw 0 0</span></blockquote></blockquote><p id="calibre_link-848" class="calibre_30"><span class="calibre_13">Swap signatures have UUIDs, so keep in mind that many systems now use these instead of raw device names.</span></p><p id="calibre_link-137" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.3.2 Using a File as Swap Space</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can use a regular file as swap space if you’re in a situation where you would be forced to repartition a disk in order to create a swap partition. You shouldn’t notice any problems when doing this.</span></p><p class="calibre_27"><span class="calibre_13">Use these commands to create an empty file, initialize it as swap, and add it to the swap pool:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dd if=/dev/zero of=</span></span><span class="calibre3"><span class="italic"><span class="bold">swap_file</span></span></span><span class="calibre3">
</span><span class="calibre3"><span class="bold">bs=1024k count=</span></span><span class="calibre3"><span class="italic"><span class="bold">num_mb</span></span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">mkswap </span></span><span class="calibre3"><span class="italic"><span class="bold">swap_file</span></span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">swapon </span></span><span class="calibre3"><span class="italic"><span class="bold">swap_file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3"><span class="italic">swap_file</span></span><span class="calibre_13"> is the name of the new swap file, and </span><span class="calibre3"><span class="italic">num_mb</span></span><span class="calibre_13"> is the desired size in megabytes.</span></p><p class="calibre_27"><span class="calibre_13"> To remove a swap partition or file from the kernel’s active pool, use the </span><span class="calibre3">swapoff</span><span class="calibre_13"> command. Your system must have enough free remaining memory (real and swap combined) to accommodate any active pages in the part of the swap pool that you’re removing.</span></p><p id="calibre_link-138" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.3.3 Determining How Much Swap You Need</span></span></span></p><p class="calibre_45"><span class="calibre_13">At one time, Unix conventional wisdom said you should always reserve at least twice as much swap space as you have real memory. Today, not only do the enormous disk and memory capacities available cloud the issue, but so do the ways we use the system. On one hand, disk space is so plentiful, it’s tempting to allocate more than double the memory size. On the other hand, you may never even dip into your swap space because you have so much real memory.</span></p><p class="calibre_27"><span class="calibre_13">The “double the real memory” rule dated from a time when multiple users would be logged in to one machine. Not all of them would be active, though, so it was convenient to be able to swap out the memory of the inactive users when an active user needed more memory.</span></p><p class="calibre_27"><span class="calibre_13">The same may still hold true for a single-user machine. If you’re running many processes, it’s generally fine to swap out parts of inactive processes or even inactive pieces of active processes. However, if you frequently access swap space because many active processes want to use the memory at once, you’ll suffer serious performance problems because disk I/O (even that of SSDs) is just too slow to keep up with the rest of the system. The only solutions are to buy more memory, terminate some processes, or complain.</span></p><p class="calibre_27"><span class="calibre_13">Sometimes, the Linux kernel may choose to swap out a process in favor of a little more disk cache. To prevent this behavior, some administrators configure certain systems with no swap space at all. For example, high-performance servers should never dip into swap space and should avoid disk access if at all possible.</span></p><blockquote id="calibre_link-684" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> It’s dangerous to configure no swap space on a general-purpose machine. If a machine completely runs out of both real memory and swap space, the Linux kernel invokes the out-of-memory (OOM) killer to kill a process in order to free up some memory. You obviously don’t want this to happen to your desktop applications. On the other hand, high-performance servers include sophisticated monitoring, redundancy, and load-balancing systems to ensure that they never reach the danger zone.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You’ll learn much more about how the memory system works in </span>Chapter 8<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-139" class="calibre_23"><span class="calibre1"><span class="bold"> 4.4 The Logical Volume Manager</span></span></p><p class="calibre_24"><span class="calibre_13">So far we’ve looked at direct management and use of disks through partitions, specifying the exact locations on storage devices where certain data should reside. You know that accessing a block device like </span><span class="italic">/dev/sda1</span><span class="calibre_13"> leads you to a place on a particular device according to the partition table on </span><span class="italic">/dev/sda</span><span class="calibre_13">, even if the exact location may be left to the hardware.</span></p><p class="calibre_27"><span class="calibre_13"> This usually works fine, but it does have some disadvantages, especially when it comes to making changes to your disks </span><span class="italic">after</span><span class="calibre_13"> installation. For example, if you want to upgrade a disk, you must install the new disk, partition, add filesystems, possibly do some boot loader changes and other tasks, and finally switch over to the new disk. This process can be error-prone and requires several reboots. It’s perhaps worse when you want to install an additional disk to get more capacity&mdash;here, you have to pick a new mount point for the filesystem on that disk and hope that you can manually distribute your data between the old and new disks.</span></p><p class="calibre_27"><span class="calibre_13"> The LVM deals with these problems by adding another layer between the physical block devices and the filesystem. The idea is that you select a set of </span><span class="italic">physical volumes</span><span class="calibre_13"> (usually just block devices, such as disk partitions) to include into a </span><span class="italic">volume group</span><span class="calibre_13">, which acts as a sort of generic data pool. Then you carve </span><span class="italic">logical volumes</span><span class="calibre_13"> out of the volume group.</span></p><p class="calibre_27"><a href="#calibre_link-501"><span class="italic"><span class="calibre_4">Figure 4-4</span></span></a><span class="calibre_13"> shows a schematic of how these fit together for one volume group. This figure shows several physical and logical volumes, but many LVM-based systems have only one PV and just two logical volumes (for root and swap).</span></p><p class="calibre_34"><img src="images/000017.jpg" class="calibre_72" />
</p><p id="calibre_link-501" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-4</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: How PVs and logical volumes fit together in a volume group</span></span></span></p><p id="calibre_link-685" class="calibre_37"><span class="calibre_13">Logical volumes are just block devices, and they typically contain filesystems or swap signatures, so you can think of the relationship between a volume group and its logical volumes as similar to that of a disk and its partitions. The critical difference is that you don’t normally define how the logical volumes are laid out in the volume group&mdash;the LVM works all of this out.</span></p><p class="calibre_27"><span class="calibre_13">The LVM allows some powerful and extremely useful operations, such as:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Add more PVs (such as another disk) to a volume group, increasing its size.</li><li value="2" class="calibre_8">Remove PVs as long as there’s enough space remaining to accommodate existing logical volumes inside a volume group.</li><li value="3" class="calibre_8"> Resize logical volumes (and as a consequence, resize filesystems with the <span class="calibre3">fsadm</span> utility).</li></ul><p class="calibre_33"><span class="calibre_13">You can do all of this without rebooting the machine, and in most cases without unmounting any filesystems. Although adding new physical disk hardware can require a shutdown, cloud computing environments often allow you to add new block storage devices on the fly, making LVM an excellent choice for systems that need this kind of flexibility.</span></p><p class="calibre_27"><span class="calibre_13"> We’re going to explore LVM in a moderate amount of detail. First, we’ll see how to interact with and manipulate logical volumes and their components, and then we’ll take a closer look at how LVM works and the kernel driver that it’s built on. However, the discussion here is not essential to understanding the rest of the book, so if you get too bogged down, feel free to skip ahead to </span>Chapter 5<span class="calibre_13">.</span></p><p id="calibre_link-140" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.4.1 Working with LVM</span></span></span></p><p class="calibre_45"><span class="calibre_13">LVM has a number of user-space tools for managing volumes and volume groups. Most of these are based around the </span><span class="calibre3">lvm</span><span class="calibre_13"> command, an interactive general-purpose tool. There are individual commands (which are just symbolic links to LVM) to perform specific tasks. For example, the </span><span class="calibre3">vgs</span><span class="calibre_13"> command has the same effect as typing </span><span class="calibre3">vgs</span><span class="calibre_13"> at the </span><span class="calibre3">lvm&gt;</span><span class="calibre_13"> prompt of the interactive </span><span class="calibre3">lvm</span><span class="calibre_13"> tool, and you’ll find that </span><span class="italic">vgs</span><span class="calibre_13"> (usually in </span><span class="italic">/sbin</span><span class="calibre_13">) is a symbolic link to </span><span class="italic">lvm</span><span class="calibre_13">. We’ll use the individual commands in this book.</span></p><p class="calibre_27"><span class="calibre_13"> In the next few sections, we’ll look at the components of a system that uses logical volumes. The first examples come from a standard Ubuntu installation using the LVM partitioning option, so many of the names will contain the word </span><span class="italic">Ubuntu</span><span class="calibre_13">. However, none of the technical details are specific to that distribution.</span></p><p class="calibre_46"><span class="bold">Listing and Understanding Volume Groups</span></p><p class="calibre_25"><span class="calibre_13">The </span><span class="calibre3">vgs</span><span class="calibre_13"> command just mentioned shows the volume groups currently configured on the system. The output is fairly concise. Here’s what you might see in our example LVM installation:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgs</span></span><span class="calibre3"> VG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #PV #LV #SN Attr&nbsp;&nbsp; VSize&nbsp;&nbsp; VFree&nbsp; ubuntu-vg&nbsp;&nbsp; 1&nbsp;&nbsp; 2&nbsp;&nbsp; 0 wz--n- &lt;10.00g 36.00m</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The first line is a header, with each successive line representing a volume group. The columns are as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">VG</span></span> The volume group name. <span class="calibre3">ubuntu-vg</span> is the generic name that the Ubuntu installer assigns when configuring a system with LVM.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">#PV</span></span> The number of physical volumes that the volume group’s storage comprises.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">#LV</span></span> The number of logical volumes inside the volume group.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">#SN</span></span> The number of logical volume <span class="italic">snapshots</span>. We won’t go into detail about these.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">Attr</span></span> A number of status attributes of the volume group. Here, <span class="calibre3">w</span> (writeable), <span class="calibre3">z</span> (resizable), and <span class="calibre3">n</span> (normal allocation policy) are active.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">VSize</span></span> The volume group size.</li><li value="7" class="calibre_8"><span class="calibre3"><span class="bold">VFree</span></span> The amount of unallocated space on the volume group.</li></ol><p class="calibre_33"><span class="calibre_13"> This synopsis of a volume group is sufficient for most purposes. If you want to go a little deeper into a volume group, use the </span><span class="calibre3">vgdisplay</span><span class="calibre_13"> command, which is very useful for understanding a volume group’s properties. Here’s the same volume group with </span><span class="calibre3">vgdisplay</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgdisplay</span></span><span class="calibre3"> --- Volume group --- VG Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ubuntu-vg System ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Format&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lvm2 Metadata Areas&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 Metadata Sequence No&nbsp; 3 VG Access&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read/write VG Status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resizable MAX LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Cur LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 Open LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 Max PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Cur PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 Act PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 VG Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;10.00 GiB PE Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.00 MiB Total PE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2559 Alloc PE / Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2550 / 9.96 GiB Free&nbsp; PE / Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 / 36.00 MiB VG UUID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0zs0TV-wnT5-laOy-vJ0h-rUae-YPdv-pPwaAs</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You saw some of this before, but there are some new items of note:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Open LV</span></span> The number of logical volumes currently in use.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">Cur PV</span></span> The number of physical volumes the volume group comprises.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">Act LV</span></span> The number of active physical volumes in the volume group.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">VG UUID</span></span> The volume group’s universally unique identifier. It’s possible to have more than one volume group with the same name on a system; in this case, the UUID can help you isolate a particular one. Most LVM tools (such as <span class="calibre3">vgrename</span>, which can help you resolve a situation like this) accept the UUID as an alternative to the volume group name. Be warned that you’re about to see a lot of different UUIDs; every component of LVM has one.</li><a id="calibre_link-829"></a></ol><p class="calibre_33"><span class="calibre_13"> A </span><span class="italic">physical extent</span><span class="calibre_13"> (abbreviated as </span><span class="calibre3">PE</span><span class="calibre_13"> in the </span><span class="calibre3">vgdisplay</span><span class="calibre_13"> output) is a piece of a physical volume, much like a block, but on a much larger scale. In this example, the PE size is 4MB. You can see that most of the PEs on this volume group are in use, but that’s not a cause for alarm. This is merely the amount of space on the volume group allocated for the logical partitions (in this case, a filesystem and swap space); it doesn’t reflect the actual usage within the filesystem.</span></p><p class="calibre_46"><span class="bold">Listing Logical Volumes</span></p><p class="calibre_25"><span class="calibre_13">Similar to volume groups, the commands to list logical volumes are </span><span class="calibre3">lvs</span><span class="calibre_13"> for a short listing and </span><span class="calibre3">lvdisplay</span><span class="calibre_13"> for more detail. Here’s a sample of </span><span class="calibre3">lvs</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvs</span></span><span class="calibre3"> LV&nbsp;&nbsp;&nbsp;&nbsp; VG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Attr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LSize&nbsp;&nbsp; Pool Origin Data%&nbsp; Meta%&nbsp; Move Log Cpy%Sync Convert root&nbsp;&nbsp; ubuntu-vg -wi-ao----&nbsp; &lt;9.01g swap_1 ubuntu-vg -wi-ao---- 976.00m</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">On basic LVM configurations, only the first four columns are important to understand, and the remaining columns may be empty, as is the case here (we won’t cover those). The relevant columns here are:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">LV</span></span> The logical volume name.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">VG</span></span> The volume group where the logical volume resides.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">Attr</span></span> Attributes of the logical volume. Here, they are <span class="calibre3">w</span> (writeable), <span class="calibre3">i</span> (inherited allocation policy), <span class="calibre3">a</span> (active), and <span class="calibre3">o</span> (open). In more advanced volume group configurations, more of these slots are active&mdash;in particular, the first, seventh, and ninth.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">LSize</span></span> The size of the logical volume.</li></ol><p class="calibre_33"><span class="calibre_13"> Running the more detailed </span><span class="calibre3">lvdisplay</span><span class="calibre_13"> helps to shed some light on where a logical volume fits into your system. Here’s the output for one of our logical volumes:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvdisplay /dev/ubuntu-vg/root</span></span><span class="calibre3"> --- Logical volume --- LV Path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /dev/ubuntu-vg/root LV Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root VG Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ubuntu-vg LV UUID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CELZaz-PWr3-tr3z-dA3P-syC7-KWsT-4YiUW2 LV Write Access&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read/write LV Creation host, time ubuntu, 2018-11-13 15:48:20 -0500 LV Status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; available # open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 LV Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;9.01 GiB Current LE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2306&nbsp; Segments&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 Allocation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inherit Read ahead sectors&nbsp;&nbsp;&nbsp;&nbsp; auto - currently set to&nbsp;&nbsp;&nbsp;&nbsp; 256 Block device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 253:0</span></blockquote><a id="calibre_link-678"></a></blockquote><p class="calibre_30"><span class="calibre_13"> There is a lot of interesting stuff here, and most of it is fairly self-explanatory (note that the UUID of the logical volume is different from that of its volume group). Perhaps the most important thing you haven’t seen yet is first: </span><span class="calibre3">LV Path</span><span class="calibre_13">,</span><span class="calibre3">
</span><span class="calibre_13">the device path of the logical volume. Some systems, but not all, use this as the mount point of the filesystem or swap space (in a systemd mount unit or </span><span class="italic">/etc/fstab</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> Even though you can see the major and minor device numbers of the logical volume’s block device (here, 253 and 0), as well as something that looks like a device path, it’s not actually the path that the kernel uses. A quick look at </span><span class="italic">/dev/ubuntu-vg/root</span><span class="calibre_13"> reveals that something else is going on:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l /dev/ubuntu-vg/root</span></span><span class="calibre3"><br class="calibre7" />lrwxrwxrwx 1 root root 7 Nov 14 06:58 /dev/ubuntu-vg/root -&gt; ../dm-0</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As you can see, this is just a symbolic link to </span><span class="italic">/dev/dm-0</span><span class="calibre_13">. Let’s look at that briefly.</span></p><p class="calibre_46"><span class="bold">Using Logical Volume Devices</span></p><p class="calibre_25"><span class="calibre_13">Once LVM has done its setup work on your system, logical volume block devices are available at </span><span class="italic">/dev/dm-0</span><span class="calibre_13">, </span><span class="italic">/dev/dm-1</span><span class="calibre_13">, and so on, and may be arranged in any order. Due to the unpredictability of these device names, LVM also creates symbolic links to the devices that have stable names based on the volume group and logical volume names. You saw this in the preceding section with </span><span class="italic">/dev/ubuntu-vg/root</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> There’s an additional location for symbolic links in most implementations: </span><span class="italic">/dev/mapper</span><span class="calibre_13">. The name format here is also based on the volume group and logical volume, but there’s no directory hierarchy; instead, the links have names like </span><span class="italic">ubuntu--vg-root</span><span class="calibre_13">. Here, udev has transformed the single dash in the volume group into a double dash, and then separated the volume group and logical volume names with a single dash.</span></p><p class="calibre_27"><span class="calibre_13"> Many systems use the links in </span><span class="italic">/dev/mapper</span><span class="calibre_13"> in their </span><span class="italic">/etc/fstab</span><span class="calibre_13">, systemd, and boot loader configurations in order to point the system to the logical volumes used for filesystems and swap space.</span></p><p class="calibre_27"><span class="calibre_13">In any case, these symbolic links point to block devices for the logical volumes, and you can interact with them just as you would any other block device: create filesystems, create swap partitions, and so on.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you take a look around </span></span>/dev/mapper<span class="italic"><span class="calibre_13">, you’ll also see a file named </span></span>control<span class="italic"><span class="calibre_13">. You might be wondering about that file, as well as why the real block device files begin with </span></span>dm-<span class="italic"><span class="calibre_13">; does this coincide with </span></span>/dev/mapper<span class="italic"><span class="calibre_13"> somehow? We’ll address these questions at the end of this chapter.</span></span></blockquote><p id="calibre_link-830" class="calibre_23"><span class="bold">Working with Physical Volumes</span></p><p class="calibre_25"><span class="calibre_13">The final major piece of LVM to examine is the </span><span class="italic">physical volume (PV)</span><span class="calibre_13">. A volume group is built from one or more PVs. Although a PV may seem like a straightforward part of the LVM system, it contains a little more information than meets the eye. Much like volume groups and logical volumes, the LVM commands to view PVs are </span><span class="calibre3">pvs</span><span class="calibre_13"> (for a short list) and </span><span class="calibre3">pvdisplay</span><span class="calibre_13"> (for a more in-depth view). Here’s the </span><span class="calibre3">pvs</span><span class="calibre_13"> display for our example system:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">pvs</span></span><span class="calibre3"> PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Fmt&nbsp; Attr PSize&nbsp;&nbsp; PFree&nbsp; /dev/sda1&nbsp; ubuntu-vg lvm2 a--&nbsp; &lt;10.00g 36.00m</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> And here’s </span><span class="calibre3">pvdisplay</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">pvdisplay</span></span><span class="calibre3"> --- Physical volume --- PV Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /dev/sda1 VG Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ubuntu-vg PV Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;10.00 GiB / not usable 2.00 MiB Allocatable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yes&nbsp; PE Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.00 MiB Total PE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2559 Free PE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 Allocated PE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2550 PV UUID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v2Qb1A-XC2e-2G4l-NdgJ-lnan-rjm5-47eMe5</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">From the previous discussion of volume groups and logical volumes, you should understand most of this output. Here are some notes:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">There’s no special name for the PV other than the block device. There’s no need for one&mdash;all of the names required to reference a logical volume are at the volume group level and above. However, the PV does have a UUID, which is required to compose a volume group.</li><li value="2" class="calibre_8">In this case, the number of PEs matches the usage in the volume group (which we saw earlier), because this is the only PV in the group.</li><li value="3" class="calibre_8">There’s a tiny amount of space that LVM labels as not usable because it’s not enough to fill a full PE.</li><li value="4" class="calibre_8"> The <span class="calibre3">a</span> in the attributes of the <span class="calibre3">pvs</span> output corresponds to <span class="calibre3">Allocatable</span> in the <span class="calibre3">pvdisplay</span> output, and it simply means that if you want to allocate space for a logical volume in the volume group, LVM can choose to use this PV. However, in this case, there are only nine unallocated PEs (a total of 36MB), so not much is available for new logical volumes.</li></ul><p class="calibre_33"><span class="calibre_13"> As alluded to earlier, PVs contain more than just information about their own individual contribution to a volume group. Each PV contains </span><span class="italic">physical volume metadata</span><span class="calibre_13">, extensive information about its volume group and its logical volumes. We’ll explore PV metadata shortly, but first let’s get some hands-on experience to see how what we’ve learned fits together.</span></p><p id="calibre_link-826" class="calibre_46"><span class="bold">Constructing a Logical Volume System</span></p><p class="calibre_25"><span class="calibre_13">Let’s look at an example of how to create a new volume group and some logical volumes out of two disk devices. We’ll combine two disk devices of 5GB and 15GB into a volume group and then divide this space into two logical volumes of 10GB each&mdash;a nearly impossible task without LVM. The example shown here uses VirtualBox disks. Although the capacities are quite small on any contemporary system, they suffice for illustration.</span></p><p class="calibre_27"><a href="#calibre_link-502"><span class="italic"><span class="calibre_4">Figure 4-5</span></span></a><span class="calibre_13"> shows the volume schematic. The new disks are at </span><span class="italic">/dev/sdb</span><span class="calibre_13"> and </span><span class="italic">/dev/sdc</span><span class="calibre_13">, the new volume group will be called </span><span class="calibre3">myvg</span><span class="calibre_13">, and the two new logical volumes are called </span><span class="calibre3">mylv1</span><span class="calibre_13"> and </span><span class="calibre3">mylv2</span><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000038.jpg" class="calibre_73" />
</p><p id="calibre_link-502" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-5</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Constructing a logical volume system</span></span></span></p><p class="calibre_37"><span class="calibre_13"> The first task is to create a single partition on each of these disks and label it for LVM. Do this with a partitioning program (see </span>Section 4.1.2<span class="calibre_13">), using the partition type ID </span><span class="calibre3">8e</span><span class="calibre_13">, so that the partition tables look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">parted /dev/sdb print</span></span><span class="calibre3"><br class="calibre7" />Model: ATA VBOX HARDDISK (scsi)<br class="calibre7" />Disk /dev/sdb: 5616MB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: msdos<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; File system&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1049kB&nbsp; 5616MB&nbsp; 5615MB&nbsp; primary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lvm<br class="calibre7" /># </span><span class="calibre3"><span class="bold">parted /dev/sdc print</span></span><span class="calibre3"><br class="calibre7" />Model: ATA VBOX HARDDISK (scsi)<br class="calibre7" />Disk /dev/sdc: 16.0GB<br class="calibre7" />Sector size (logical/physical): 512B/512B<br class="calibre7" />Partition Table: msdos<br class="calibre7" />Disk Flags: <br class="calibre7" />Number&nbsp; Start&nbsp;&nbsp; End&nbsp;&nbsp;&nbsp;&nbsp; Size&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; File system&nbsp; Flags 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1049kB&nbsp; 16.0GB&nbsp; 16.0GB&nbsp; primary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lvm</span></blockquote></blockquote><p id="calibre_link-831" class="calibre_30"><span class="calibre_13">You don’t necessarily need to partition a disk to make it a PV. PVs can be any block device, even entire-disk devices, such as </span><span class="italic">/dev/sdb</span><span class="calibre_13">. However, partitioning enables booting from the disk, and it also provides a means of identifying the block devices as LVM physical volumes.</span></p><p class="calibre_46"><span class="bold">Creating Physical Volumes and a Volume Group</span></p><p class="calibre_25"><span class="calibre_13">With the new partitions of </span><span class="italic">/dev/sdb1</span><span class="calibre_13"> and </span><span class="italic">/dev/sdc1</span><span class="calibre_13"> in hand, the first step with LVM is to designate one of the partitions as a PV and assign it to a new volume group. A single command, </span><span class="calibre3">vgcreate</span><span class="calibre_13">, performs this task. Here’s how to create a volume group called </span><span class="calibre3">myvg</span><span class="calibre_13"> with </span><span class="italic">/dev/sdb1</span><span class="calibre_13"> as the initial PV:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgcreate myvg /dev/sdb1</span></span><span class="calibre3"> Physical volume "/dev/sdb1" successfully created. Volume group "myvg" successfully created</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can also create a PV first in a separate step with the </span></span><span class="calibre3">pvcreate</span><span class="italic"><span class="calibre_13"> command. However, </span></span><span class="calibre3">vgcr</span><span class="calibre3">e</span><span class="calibre3">ate</span><span class="italic"><span class="calibre_13"> performs this step on a partition if nothing is currently present.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> At this point, most systems automatically detect the new volume group; run a command such as </span><span class="calibre3">vgs</span><span class="calibre_13"> to verify (keeping in mind that there may be existing volume groups on your system that show up in addition to the one you just created):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgs</span></span><span class="calibre3"> VG&nbsp;&nbsp; #PV #LV #SN Attr&nbsp;&nbsp; VSize&nbsp; VFree&nbsp; myvg&nbsp;&nbsp; 1&nbsp;&nbsp; 0&nbsp;&nbsp; 0 wz--n- &lt;5.23g &lt;5.23g</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you don’t see the new volume group, try running </span></span><span class="calibre3">pvscan</span><span class="italic"><span class="calibre_13"> first. If your system doesn’t automatically detect changes to LVM, you’ll need to run </span></span><span class="calibre3">pvscan</span><span class="italic"><span class="calibre_13"> every time you make a change.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Now you can add your second PV at </span><span class="italic">/dev/sdc1</span><span class="calibre_13"> to the volume group with the </span><span class="calibre3">vgextend</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgextend myvg /dev/sdc1</span></span><span class="calibre3"> Physical volume "/dev/sdc1" successfully created. Volume group "myvg" successfully extended</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Running </span><span class="calibre3">vgs</span><span class="calibre_13"> now shows two PVs, and the size is that of the two partitions combined:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgs</span></span><span class="calibre3"> VG&nbsp;&nbsp;&nbsp; #PV #LV #SN Attr&nbsp;&nbsp; VSize&nbsp;&nbsp; VFree&nbsp;&nbsp; myvg&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp; 0&nbsp;&nbsp; 0 wz--n- &lt;20.16g &lt;20.16g</span></blockquote></blockquote><p id="calibre_link-827" class="calibre_42"><span class="bold">Creating Logical Volumes</span></p><p class="calibre_25"><span class="calibre_13">The final step at the block device level is to create the logical volumes. As mentioned before, we’re going to create two logical volumes of 10GB each, but feel free to experiment with other possibilities, such as one big logical volume or multiple smaller ones.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">lvcreate</span><span class="calibre_13"> command allocates a new logical volume in a volume group. The only real complexities in creating simple logical volumes are determining the sizes when there is more than one per volume group, and specifying the type of logical volume. Remember that PVs are divided into extents; the number of PEs available may not </span><span class="italic">quite</span><span class="calibre_13"> line up with your desired size. However, it should be close enough so that it doesn’t present a concern, so if this your first time working with the LVM, you don’t really have to pay attention to PEs.</span></p><p class="calibre_27"><span class="calibre_13"> When using </span><span class="calibre3">lvcreate</span><span class="calibre_13">, you can specify a logical volume’s size by numeric capacity in bytes with the </span><span class="calibre3">--size</span><span class="calibre_13"> option or by number of PEs with the </span><span class="calibre3">--extents</span><span class="calibre_13"> option.</span></p><p class="calibre_27"><span class="calibre_13"> So, to see how this works, and to complete the LVM schematic in </span><a href="#calibre_link-502"><span class="italic"><span class="calibre_4">Figure 4-5</span></span></a><span class="calibre_13">, we’ll create logical volumes named </span><span class="calibre3">mylv1</span><span class="calibre_13"> and </span><span class="calibre3">mylv2</span><span class="calibre_13"> using </span><span class="calibre3">--size</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvcreate --size 10g --type linear -n mylv1 myvg</span></span><span class="calibre3"> Logical volume "mylv1" created.<br class="calibre7" /># </span><span class="calibre3"><span class="bold">lvcreate --size 10g --type linear -n mylv2 myvg</span></span><span class="calibre3"> Logical volume "mylv2" created.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The type here is the linear mapping, the simplest type when you don’t need redundancy or any other special features (we won’t work with any other types in this book). In this case, </span><span class="calibre3">--type linear</span><span class="calibre_13"> is optional because it’s the default mapping.</span></p><p class="calibre_27"><span class="calibre_13"> After running these commands, verify that the logical volumes exist with an </span><span class="calibre3">lvs</span><span class="calibre_13"> command, and then take a closer look at the current state of the volume group with </span><span class="calibre3">vgdisplay</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">vgdisplay myvg</span></span><span class="calibre3"> --- Volume group --- VG Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myvg System ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Format&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lvm2 Metadata Areas&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 Metadata Sequence No&nbsp; 4 VG Access&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; read/write VG Status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resizable MAX LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Cur LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 Open LV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Max PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Cur PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 Act PV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 VG Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20.16 GiB PE Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.00 MiB Total PE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5162 Alloc PE / Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5120 / 20.00 GiB&nbsp; Free&nbsp; PE / Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 42 / 168.00 MiB VG UUID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1pHrOe-e5zy-TUtK-5gnN-SpDY-shM8-Cbokf3</span></blockquote><a id="calibre_link-679"></a></blockquote><p class="calibre_30"><span class="calibre_13">Notice how there are 42 free PEs because the sizes that we chose for the logical volumes didn’t quite take up all of the available extents in the volume group.</span></p><p class="calibre_46"><span class="bold">Manipulating Logical Volumes: Creating Partitions</span></p><p class="calibre_25"><span class="calibre_13">With the new logical volumes available, you can now make use of them by putting filesystems on the devices and mounting them just like any normal disk partition. As mentioned earlier, there will be symbolic links to the devices in </span><span class="italic">/dev/mapper</span><span class="calibre_13"> and (for this case) a </span><span class="italic">/dev/myvg</span><span class="calibre_13"> directory for the volume group. So, for example, you might run the following three commands to create a filesystem, mount it temporarily, and see how much actual space you have on a logical volume:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mkfs -t ext4 /dev/mapper/myvg-mylv1</span></span><span class="calibre3"><br class="calibre7" />mke2fs 1.44.1 (24-Mar-2018)<br class="calibre7" />Creating filesystem with 2621440 4k blocks and 655360 inodes<br class="calibre7" />Filesystem UUID: 83cc4119-625c-49d1-88c4-e2359a15a887<br class="calibre7" />Superblock backups stored on blocks:&nbsp; 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632<br class="calibre7" />Allocating group tables: done<br class="calibre7" />Writing inode tables: done<br class="calibre7" />Creating journal (16384 blocks): done<br class="calibre7" />Writing superblocks and filesystem accounting information: done <br class="calibre7" /># </span><span class="calibre3"><span class="bold">mount /dev/mapper/myvg-mylv1 /mnt</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">df /mnt</span></span><span class="calibre3"><br class="calibre7" />Filesystem&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1K-blocks&nbsp; Used Available Use% Mounted on<br class="calibre7" />/dev/mapper/myvg-mylv1&nbsp; 10255636 36888&nbsp;&nbsp; 9678076&nbsp;&nbsp; 1% /mnt</span></blockquote></blockquote><p class="calibre_42"><span class="bold">Removing Logical Volumes</span></p><p class="calibre_25"><span class="calibre_13">We haven’t yet looked at any operations on the other logical volume, </span><span class="italic">mylv2</span><span class="calibre_13">, so let’s use it to make this example more interesting. Say you find you’re not really using that second logical volume. You decide to remove it and resize the first logical volume to take over the remaining space on the volume group. </span><a></a><a href="#calibre_link-503"><span class="italic"><span class="calibre_4">Figure 4-6</span></span></a><span class="calibre_13"> shows our goal.</span></p><p class="calibre_27"><span class="calibre_13"> Assuming you’ve already moved or backed up anything important on the logical volume you’re going to delete, and that it’s not in current system use (that is, you’ve unmounted it), first remove it with </span><span class="calibre3">lvremove</span><span class="calibre_13">. When manipulating logical volumes with this command, you’ll refer to them using a different syntax&mdash;by separating the volume group and logical volume names by a slash (</span><span class="calibre3">myvg/mylv2</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvremove myvg/mylv2</span></span><span class="calibre3"><br class="calibre7" />Do you really want to remove and DISCARD active logical volume myvg/mylv2? [y/n]: </span><span class="calibre3"><span class="bold">y</span></span><span class="calibre3"> Logical volume "mylv2" successfully removed</span></blockquote></blockquote><p id="calibre_link-828" class="calibre_"></p><p class="calibre_34"><img src="images/000016.jpg" class="calibre_73" />
</p><p id="calibre_link-503" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-6</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Results of reconfiguring logical volumes</span></span></span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Be careful when you run </span></span><span class="calibre3">lvremove</span><span class="italic"><span class="calibre_13">. Because you haven’t used this syntax with the other LVM commands you’ve seen so far, you might accidentally use a space instead of the slash. If you make that mistake in this particular case, </span></span><span class="calibre3">lvremove</span><span class="italic"><span class="calibre_13"> assumes that you want to remove </span></span>all of the logical volumes<span class="italic"><span class="calibre_13"> on the volume groups </span></span><span class="calibre3">myvg</span><span class="italic"><span class="calibre_13">
</span></span>and<span class="italic"><span class="calibre_13">
</span></span><span class="calibre3">mylv2</span><span class="italic"><span class="calibre_13">. (You almost certainly don’t have a volume group named </span></span><span class="calibre3">mylv2</span><span class="italic"><span class="calibre_13">, but that’s not your biggest problem at the moment.) So, if you’re not paying attention, you could remove </span></span>all<span class="italic"><span class="calibre_13"> of the logical volumes on a volume group, not just one.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> As you can see from this interaction, </span><span class="calibre3">lvremove</span><span class="calibre_13"> tries to protect you from blunders by double-checking that you really want to remove each logical volume targeted for removal. It also won’t try to remove a volume that’s in use. But don’t just assume that you should reply </span><span class="calibre3">y</span><span class="calibre_13"> to any question you’re asked.</span></p><p class="calibre_46"><span class="bold">Resizing Logical Volumes and Filesystems</span></p><p class="calibre_25"><span class="calibre_13">Now you can resize the first logical volume, </span><span class="calibre3">mylv1</span><span class="calibre_13">. You can do this even when the volume is in use and its filesystem is mounted. However, it’s important to understand that there are two steps. To use your larger logical volume, you need to resize both it </span><span class="italic">and</span><span class="calibre_13"> the filesystem inside it (which you can also do while it’s mounted). But because this is such a common operation, the </span><span class="calibre3">lvresize</span><span class="calibre_13"> command that resizes a logical volume has an option (</span><span class="calibre3">-r</span><span class="calibre_13">) to perform the filesystem resizing for you also.</span></p><p class="calibre_27"><span class="calibre_13"> For illustration only, let’s use two separate commands to see how this works. There are several ways to specify the change in size to a logical volume, but in this case, the most straightforward method is to add all of the free PEs in the volume group to the logical volume. Recall that you can find that number with </span><span class="calibre3">vgdisplay</span><span class="calibre_13">; in our running example, it’s 2,602. Here’s the </span><span class="calibre3">lvresize</span><span class="calibre_13"> command to add all of those to </span><span class="calibre3">mylv1</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvresize -l +2602 myvg/mylv1</span></span><span class="calibre3"> Size of logical volume myvg/mylv1 changed from 10.00 GiB (2560 extents) to 20.16 GiB (5162 extents). Logical volume myvg/mylv1 successfully resized.</span></blockquote></blockquote><p id="calibre_link-773" class="calibre_30"><span class="calibre_13">Now you need to resize the filesystem inside. You can do this with the </span><span class="calibre3">fsadm</span><span class="calibre_13"> command. It’s fun to watch it work in verbose mode (use the </span><span class="calibre3">-v</span><span class="calibre_13"> option):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">fsadm -v resize /dev/mapper/myvg-mylv1</span></span><span class="calibre3"> fsadm: "ext4" filesystem found on "/dev/mapper/myvg-mylv1".<br class="calibre7" />fsadm: Device "/dev/mapper/myvg-mylv1" size is 21650997248 bytes<br class="calibre7" />fsadm: Parsing tune2fs -l "/dev/mapper/myvg-mylv1"<br class="calibre7" />fsadm: Resizing filesystem on device "/dev/mapper/myvg-mylv1" to 21650997248 bytes (2621440 -&gt; 5285888 blocks of 4096 bytes)<br class="calibre7" />fsadm: Executing resize2fs /dev/mapper/myvg-mylv1 5285888<br class="calibre7" />resize2fs 1.44.1 (24-Mar-2018)<br class="calibre7" />Filesystem at /dev/mapper/myvg-mylv1 is mounted on /mnt; on-line resizing required<br class="calibre7" />old_desc_blocks = 2, new_desc_blocks = 3<br class="calibre7" />The filesystem on /dev/mapper/myvg-mylv1 is now 5285888 (4k) blocks long.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As you can see from the output, </span><span class="calibre3">fsadm</span><span class="calibre_13"> is just a script that knows how to transform its arguments into the ones used by filesystem-specific tools like </span><span class="calibre3">resize2fs</span><span class="calibre_13">. By default, if you don’t specify a size, it’ll simply resize to fit the entire device.</span></p><p class="calibre_27"><span class="calibre_13"> Now that you’ve seen the details of resizing volumes, you’re probably looking for shortcuts. The much simpler approach is to use a different syntax for the size and have </span><span class="calibre3">lvresize</span><span class="calibre_13"> perform the partition resizing for you, with this single command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lvresize -r -l +100%FREE myvg/mylv1</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> It’s rather nice that you can expand an ext2/ext3/ext4 filesystem while it’s mounted. Unfortunately, it doesn’t work in reverse. You </span><span class="italic">cannot</span><span class="calibre_13"> shrink a filesystem when it’s mounted. Not only must you unmount the filesystem, but the process of shrinking a logical volume requires you to do the steps in reverse. So, when resizing manually, you’d need to resize the partition before the logical volume, making sure that the new logical volume is still big enough to contain the filesystem. Again, it’s </span><span class="italic">much</span><span class="calibre_13"> easier to use </span><span class="calibre3">lvresize</span><span class="calibre_13"> with the </span><span class="calibre3">-r</span><span class="calibre_13"> option so that it can coordinate the filesystem and logical volume sizes for you.</span></p><p id="calibre_link-141" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.4.2 The LVM Implementation</span></span></span></p><p class="calibre_45"><span class="calibre_13">With the more practical operational basics of LVM covered, we can now take a brief look at its implementation. As with almost every other topic in this book, LVM contains a number of layers and components, with a fairly careful separation between the parts in kernel and user space.</span></p><p class="calibre_27"><span class="calibre_13">As you’ll see soon, finding PVs to discover the structure of the volume groups and logical volumes is somewhat complicated, and the Linux kernel would rather not deal with any of it. There’s no reason for any of this to happen in kernel space; PVs are just block devices, and user space has random access to block devices. In fact, LVM (more specifically, LVM2 in current systems) itself is just the name for a suite of user-space utilities that know the LVM structure.</span></p><p id="calibre_link-696" class="calibre_27"><span class="calibre_13">On the other hand, the kernel handles the work of routing a request for a location on a logical volume’s block device to the true location on an actual device. The driver for this is the </span><span class="italic">device mapper</span><span class="calibre_13"> (sometimes shortened to </span><span class="italic">devmapper</span><span class="calibre_13">), a new layer sandwiched between normal block devices and the filesystem. As the name suggests, the task the device mapper performs is like following a map; you can almost think of it as translating a street address into an absolute location like global latitude/longitude coordinates. (It’s a form of virtualization; the virtual memory we’ll see elsewhere in the book works on a similar concept.)</span></p><p class="calibre_27"><span class="calibre_13">There’s some glue between LVM user-space tools and the device mapper: a few utilities that run in user space to manage the device map in the kernel. Let’s look at both the LVM side and the kernel side, starting with LVM.</span></p><p class="calibre_46"><span class="bold">LVM Utilities and Scanning for Physical Volumes</span></p><p class="calibre_25"><span class="calibre_13">Before it does anything, an LVM utility must first scan the available block devices to look for PVs. The steps that LVM must perform in user space are roughly as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Find all of the PVs on the system.</li><li value="2" class="calibre_8">Find all of the volume groups that the PVs belong to by UUID (this information is contained in the PVs).</li><li value="3" class="calibre_8">Verify that everything is complete (that is, all necessary PVs that belong to the volume group are present).</li><li value="4" class="calibre_8">Find all of the logical volumes in the volume groups.</li><li value="5" class="calibre_8">Figure out the scheme for mapping data from the PVs to the logical volumes.</li></ol><p class="calibre_33"><span class="calibre_13">There’s a header at the beginning of every PV that identifies the volume as well as its volume groups and the logical volumes within. The LVM utilities can put this information together and determine whether all PVs necessary for a volume group (and its logical volumes) are present. If everything checks out, LVM can work on getting the information to the kernel.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re interested in the appearance of the LVM header on a PV, you can run a command such as this:</span></span></blockquote><blockquote class="calibre_43"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dd if=/dev/sdb1 count=1000 | strings | less</span></span></blockquote><blockquote class="calibre_71"><span class="italic"><span class="calibre_13">In this case, we’re using </span></span>/dev/sdb1<span class="italic"><span class="calibre_13"> as the PV. Don’t expect the output to be very pretty, but it does show the information required for LVM.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Any LVM utility, such as </span><span class="calibre3">pvscan</span><span class="calibre_13">, </span><span class="calibre3">lvs</span><span class="calibre_13">, or </span><span class="calibre3">vgcreate</span><span class="calibre_13">, is capable of performing the work of scanning and processing PVs.</span></p><p class="calibre_46"><span class="bold">The Device Mapper</span></p><p class="calibre_25"><span class="calibre_13">After LVM has determined the structure of the logical volumes from all of the headers on the PVs, it communicates with the kernel’s device mapper driver in order to initialize the block devices for the logical volumes and load their mapping tables. It achieves this with the ioctl(2) system call (a commonly used kernel interface) on the </span><a id="calibre_link-715"></a><span class="italic">/dev/mapper/control</span><span class="calibre_13"> device file. It’s not really practical to try to monitor this interaction, but it’s possible to look at the details of the results with the </span><span class="calibre3">dmsetup</span><span class="calibre_13"> command.</span></p><p class="calibre_27"><span class="calibre_13"> To get an inventory of mapped devices currently serviced by the device mapper, use </span><span class="calibre3">dmsetup info</span><span class="calibre_13">. Here’s what you might get for one of the logical volumes created earlier in this chapter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dmsetup info</span></span><span class="calibre3"><br class="calibre7" />Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myvg-mylv1<br class="calibre7" />State:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ACTIVE<br class="calibre7" />Read Ahead:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 256<br class="calibre7" />Tables present:&nbsp;&nbsp;&nbsp; LIVE<br class="calibre7" />Open count:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br class="calibre7" />Event number:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br class="calibre7" />Major, minor:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 253, 1<br class="calibre7" />Number of targets: 2<br class="calibre7" />UUID: LVM-1pHrOee5zyTUtK5gnNSpDYshM8Cbokf3OfwX4T0w2XncjGrwct7nwGhpp7l7J5aQ</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The major and minor number of the device correspond to the </span><span class="italic">/dev/dm-*</span><span class="calibre_13"> device file for the mapped device; the major number for this device mapper is 253. Because the minor number is 1, the device file is named </span><span class="italic">/dev/dm-1</span><span class="calibre_13">. Notice that the kernel has a name and yet another UUID for the mapped device. LVM supplied these to the kernel (the kernel UUID is just a concatenation of the volume group and logical volume UUIDs).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Remember the symbolic links such as </span></span>/dev/mapper/myvg-mylv1<span class="italic"><span class="calibre_13">? udev creates those in response to new devices from the device mapper, using a rules file like we saw in </span></span><span class="italic">Section 3.5.2.</span></blockquote><p class="calibre_37"><span class="calibre_13"> You can also view the table that LVM gave to the device mapper, by issuing the command </span><span class="calibre3">dmsetup table</span><span class="calibre_13">. Here’s what that looks like for our earlier example when there were two 10GB logical volumes (</span><span class="calibre3">mylv1</span><span class="calibre_13"> and </span><span class="calibre3">mylv2</span><span class="calibre_13">) spread across the two physical volumes of 5GB (</span><span class="italic">/dev/sdb1</span><span class="calibre_13">) and 15GB (</span><span class="italic">/dev/sdc1</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dmsetup table</span></span><span class="calibre3"><br class="calibre7" />myvg-mylv2: 0 10960896 linear 8:17 2048<br class="calibre7" />myvg-mylv2: 10960896 10010624 linear 8:33 20973568<br class="calibre7" />myvg-mylv1: 0 20971520 linear 8:33 2048</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Each line provides a segment of the map for a given mapped device. For the device </span><span class="calibre3">myvg-mylv2</span><span class="calibre_13">, there are two pieces, and for </span><span class="calibre3">myvg-mylv1</span><span class="calibre_13">, there’s a single one. The fields after the name, in order, are:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The start offset of the mapped device. The units are in 512-byte “sectors,” or the normal block size that you see in many other devices.</li><li value="2" class="calibre_8">The length of this segment.</li><li value="3" class="calibre_8">The mapping scheme. Here, it’s the simple one-to-one linear scheme.</li><li value="4" class="calibre_8">The major and minor device number pair of a source device&mdash;that is, what LVM calls physical volumes. Here 8:17 is <span class="italic">/dev/sdb1</span> and 8:33 is <span class="italic">/dev/sdc1</span>.</li><a id="calibre_link-697"></a><li value="5" class="calibre_8">A starting offset on the source device.</li></ol><p class="calibre_33"><span class="calibre_13"> What’s interesting here is that in our example, LVM chose to use the space in </span><span class="italic">/dev/sdc1</span><span class="calibre_13"> for the first logical volume that we created (</span><span class="calibre3">mylv1</span><span class="calibre_13">). LVM decided that it wanted to lay out the first 10GB logical volume in a contiguous manner, and the only way to do that was on </span><span class="italic">/dev/sdc1</span><span class="calibre_13">. However, when creating the second logical volume (</span><span class="calibre3">mylv2</span><span class="calibre_13">), LVM had no choice but to spread it into two segments across the two PVs. </span><a></a><a href="#calibre_link-504"><span class="italic"><span class="calibre_4">Figure 4-7</span></span></a><span class="calibre_13"> shows the arrangement.</span></p><p class="calibre_34"><img src="images/000036.jpg" class="calibre_74" />
</p><p id="calibre_link-504" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-7</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: How LVM arranges </span></span></span><span class="calibre3"><span class="italic">mylv1</span></span><span class="calibre3"><span class="italic"><span class="calibre_13"> and </span></span></span><span class="calibre3"><span class="italic">mylv2</span></span></p><p class="calibre_37"><span class="calibre_13"> As a further consequence, when we removed </span><span class="calibre3">mylv2</span><span class="calibre_13"> and expanded </span><span class="calibre3">mylv1</span><span class="calibre_13"> to fit the remaining space in the volume group, the original start offset in the PV remained where it was on </span><span class="italic">/dev/sdc1</span><span class="calibre_13">, but everything else changed to include the remainder of the PVs:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dmsetup table</span></span><span class="calibre3"><br class="calibre7" />myvg-mylv1: 0 31326208 linear 8:33 2048<br class="calibre7" />myvg-mylv1: 31326208 10960896 linear 8:17 2048</span></blockquote></blockquote><p class="calibre_30"><a href="#calibre_link-505"><span class="italic"><span class="calibre_4">Figure 4-8</span></span></a><span class="calibre_13"> shows the arrangement.</span></p><p class="calibre_34"><img src="images/000010.jpg" class="calibre_75" />
</p><p id="calibre_link-505" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-8</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: The arrangement after we remove </span></span></span><span class="calibre3"><span class="italic">mylv2</span></span><span class="calibre3"><span class="italic"><span class="calibre_13"> and expand </span></span></span><span class="calibre3"><span class="italic">mylv1</span></span></p><p class="calibre_37"><span class="calibre_13">You can experiment with logical volumes and the device mapper to your heart’s content with virtual machines and see how the mappings turn out. Many features, such as software RAID and encrypted disks, are built on the device mapper.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-142" class="calibre_23"><span class="calibre1"><span class="bold">4.5 Looking Forward: Disks and User Space</span></span></p><p class="calibre_24"><span class="calibre_13">In disk-related components on a Unix system, the boundaries between user space and the kernel can be difficult to characterize. As you’ve seen, the kernel handles raw block I/O from the devices, and user-space tools can use the block I/O through device files. However, user space typically uses the block I/O only for initializing operations, such as partitioning, filesystem creation, and swap space creation. In normal use, user space uses only the filesystem support that the kernel provides on top of the block I/O. Similarly, the kernel also handles most of the tedious details when dealing with swap space in the virtual memory system.</span></p><p class="calibre_27"><span class="calibre_13">The remainder of this chapter briefly looks at the innards of a Linux filesystem. This is more advanced material, and you certainly don’t need to know it to proceed with the book. If this is your first time through, skip to the next chapter and start learning about how Linux boots.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-143" class="calibre_23"><span class="calibre1"><span class="bold"> 4.6 Inside a Traditional Filesystem</span></span></p><p class="calibre_24"><span class="calibre_13">A traditional Unix filesystem has two primary components: a pool of data blocks where you can store data and a database system that manages the data pool. The database is centered around the inode data structure. An </span><span class="italic">inode</span><span class="calibre_13"> is a set of data that describes a particular file, including its type, permissions, and&mdash;perhaps most important&mdash;where in the data pool the file data resides. Inodes are identified by numbers listed in an inode table.</span></p><p class="calibre_27"><span class="calibre_13">Filenames and directories are also implemented as inodes. A directory inode contains a list of filenames and links corresponding to other inodes.</span></p><p class="calibre_27"><span class="calibre_13">To provide a real-life example, I created a new filesystem, mounted it, and changed the directory to the mount point. Then, I added some files and directories with these commands:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">mkdir dir_1</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">mkdir dir_2</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo a &gt; dir_1/file_1</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo b &gt; dir_1/file_2</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo c &gt; dir_1/file_3</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo d &gt; dir_2/file_4</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">ln dir_1/file_3 dir_2/file_5</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Note that I created </span><span class="italic">dir_2/file_5</span><span class="calibre_13"> as a hard link to </span><span class="italic">dir_1/file_3</span><span class="calibre_13">, meaning that these two filenames actually represent the same file (more on this shortly). Feel free to try this yourself. It doesn’t necessarily need to be on a new filesystem.</span></p><p class="calibre_27"><span class="calibre_13"> If you were to explore the directories in this filesystem, its contents would appear as shown in </span><a></a><a href="#calibre_link-506"><span class="italic"><span class="calibre_4">Figure 4-9</span></span></a><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you try this on your own system, the inode numbers will probably be different, especially if you run the commands to create the files and directories on an existing filesystem. The specific numbers aren’t important; it’s all about the data that they point to.</span></span></blockquote><p id="calibre_link-703" class="calibre_">
</p><p class="calibre_34"><img src="images/000032.jpg" class="calibre_76" />
</p><p id="calibre_link-506" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-9</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: User-level representation of a filesystem</span></span></span></p><p class="calibre_37"><span class="calibre_13"> The actual layout of the filesystem as a set of inodes, shown in </span><a></a><a href="#calibre_link-507"><span class="italic"><span class="calibre_4">Figure 4-10</span></span></a><span class="calibre_13">, doesn’t look nearly as clean as the user-level representation.</span></p><p class="calibre_34"><img src="images/000008.jpg" class="calibre_77" />
</p><p id="calibre_link-507" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-10</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Inode structure of the filesystem shown in </span></span></span><a href="#calibre_link-506"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 4-9</span></span></span></a></p><p class="calibre_37"><span class="calibre_13"> How do we make sense of this? For any ext2/3/4 filesystem, you start at inode number 2, which is the </span><span class="italic">root inode</span><span class="calibre_13"> (try not to confuse this with the system root filesystem). From the inode table in </span><a href="#calibre_link-507"><span class="italic"><span class="calibre_4">Figure 4-10</span></span></a><span class="calibre_13">, you can see that this is a directory inode (</span><span class="italic">dir</span><span class="calibre_13">), so you can follow the arrow over to the data pool, where you see the contents of the root directory: two entries named </span><a id="calibre_link-704"></a><span class="italic">dir_1</span><span class="calibre_13"> and </span><span class="italic">dir_2</span><span class="calibre_13"> corresponding to inodes 12 and 7633, respectively. To explore those entries, go back to the inode table and look at either of those inodes.</span></p><p class="calibre_27"><span class="calibre_13"> To examine </span><span class="italic">dir_1/file_2</span><span class="calibre_13"> in this filesystem, the kernel does the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Determines the path’s components: a directory named <span class="italic">dir_1</span>, followed by a component named <span class="italic">file_2</span>.</li><li value="2" class="calibre_8">Follows the root inode to its directory data.</li><li value="3" class="calibre_8">Finds the name <span class="italic">dir_1</span> in inode 2’s directory data, which points to inode number 12.</li><li value="4" class="calibre_8">Looks up inode 12 in the inode table and verifies that it is a directory inode.</li><li value="5" class="calibre_8">Follows inode 12’s data link to its directory information (the second box down in the data pool).</li><li value="6" class="calibre_8">Locates the second component of the path (<span class="italic">file_2</span>) in inode 12’s directory data. This entry points to inode number 14.</li><li value="7" class="calibre_8">Looks up inode 14 in the directory table. This is a file inode.</li></ol><p class="calibre_33"><span class="calibre_13">At this point, the kernel knows the properties of the file and can open it by following inode 14’s data link.</span></p><p class="calibre_27"><span class="calibre_13"> This system, of inodes pointing to directory data structures and directory data structures pointing to inodes, allows you to create the filesystem hierarchy that you’re used to. In addition, notice that the directory inodes contain entries for </span><span class="italic">.</span><span class="calibre_13"> (the current directory) and </span><span class="italic">..</span><span class="calibre_13"> (the parent directory, except for the root directory). This makes it easy to get a point of reference and to navigate back down the directory structure.</span></p><p id="calibre_link-144" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.6.1 Inode Details and the Link Count</span></span></span></p><p class="calibre_45"><span class="calibre_13">To view the inode numbers for any directory, use the </span><span class="calibre3">ls -i</span><span class="calibre_13"> command. Here’s what you’d get at the root of this example (for more detailed inode information, use the </span><span class="calibre3">stat</span><span class="calibre_13"> command):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -i</span></span><span class="calibre3"> 12 dir_1&nbsp; 7633 dir_2</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’re probably wondering about the </span><span class="italic">link count</span><span class="calibre_13"> in the inode table. You’ve already seen the link count in the output of the common </span><span class="calibre3">ls -l</span><span class="calibre_13"> command, but you likely ignored it. How does the link count relate to the files in </span><a href="#calibre_link-506"><span class="italic"><span class="calibre_4">Figure 4-9</span></span></a><span class="calibre_13">, in particular the “hard-linked” </span><span class="italic">file_5</span><span class="calibre_13">? The link count field is the number of total directory entries (across all directories) that point to an inode. Most of the files have a link count of 1 because they occur only once in the directory entries. This is expected. Most of the time when you create a file, you create a new directory entry and a new inode to go with it. However, inode 15 occurs twice. First it’s created as </span><span class="italic">dir_1/file_3</span><span class="calibre_13">, and then it’s linked to as </span><span class="italic">dir_2/file_5</span><span class="calibre_13">. A hard link is just a manually created entry in a directory to an inode that already exists. The </span><span class="calibre3">ln</span><span class="calibre_13"> command (without the </span><span class="calibre3">-s</span><span class="calibre_13"> option) allows you to create new hard links manually.</span></p><p id="calibre_link-583" class="calibre_27"><span class="calibre_13">This is also why removing a file is sometimes called </span><span class="italic">unlinking</span><span class="calibre_13">. If you run </span><span class="calibre3">rm dir_1/file_2</span><span class="calibre_13">, the kernel searches for an entry named </span><span class="italic">file_2</span><span class="calibre_13"> in inode 12’s directory entries. Upon finding that </span><span class="italic">file_2</span><span class="calibre_13"> corresponds to inode 14, the kernel removes the directory entry and then subtracts 1 from inode 14’s link count. As a result, inode 14’s link count will be 0, and the kernel will know that there are no longer any names linking to the inode. Therefore, it can now delete the inode and any data associated with it.</span></p><p class="calibre_27"><span class="calibre_13"> However, if you run </span><span class="calibre3">rm dir_1/file_3</span><span class="calibre_13">, the end result is that the link count of inode 15 goes from 2 to 1 (because </span><span class="italic">dir_2/file_5</span><span class="calibre_13"> still points there), and the kernel knows not to remove the inode.</span></p><p class="calibre_27"><span class="calibre_13"> Link counts work much the same for directories. Note that inode 12’s link count is 2, because there are two inode links there: one for </span><span class="italic">dir_1</span><span class="calibre_13"> in the directory entries for inode 2 and the second a self-reference (</span><span class="calibre3">.</span><span class="calibre_13">) in its own directory entries. If you create a new directory </span><span class="italic">dir_1/dir_3</span><span class="calibre_13">, the link count for inode 12 would go to 3 because the new directory would include a parent (</span><span class="calibre3">..</span><span class="calibre_13">) entry that links back to inode 12, much as inode 12’s parent link points to inode 2.</span></p><p class="calibre_27"><span class="calibre_13"> There is one small exception in link counts. The root inode 2 has a link count of 4. However, </span><a href="#calibre_link-507"><span class="italic"><span class="calibre_4">Figure 4-10</span></span></a><span class="calibre_13"> shows only three directory entry links. The “fourth” link is in the filesystem’s superblock because the superblock tells you where to find the root inode.</span></p><p class="calibre_27"><span class="calibre_13"> Don’t be afraid to experiment on your system. Creating a directory structure and then using </span><span class="calibre3">ls -i</span><span class="calibre_13"> or </span><span class="calibre3">stat</span><span class="calibre_13"> to walk through the pieces is harmless. You don’t need to be root (unless you mount and create a new filesystem).</span></p><p id="calibre_link-145" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.6.2 Block Allocation</span></span></span></p><p class="calibre_45"><span class="calibre_13">There’s still one piece missing from our discussion. When allocating data pool blocks for a new file, how does the filesystem know which blocks are in use and which are available? One of the most basic ways is to use an additional management data structure called a </span><span class="italic">block bitmap</span><span class="calibre_13">. In this scheme, the filesystem reserves a series of bytes, with each bit corresponding to one block in the data pool. A value of 0 means that the block is free, and a 1 means that it’s in use. Thus, allocating and deallocating blocks is a matter of flipping bits.</span></p><p class="calibre_27"><span class="calibre_13"> Problems in a filesystem arise when the inode table data doesn’t match the block allocation data or when the link counts are incorrect; for example, this can happen when you don’t cleanly shut down a system. Therefore, when you check a filesystem, as described in </span>Section 4.2.11<span class="calibre_13">, the </span><span class="calibre3">fsck</span><span class="calibre_13"> program walks through the inode table and directory structure to generate new link counts and a new block allocation map (such as the block bitmap), and then it compares the newly generated data with the filesystem on the disk. If there are mismatches, </span><span class="calibre3">fsck</span><span class="calibre_13"> must fix the link counts and determine what to do with any inodes and/or data that didn’t come up when it traversed the directory structure. Most </span><span class="calibre3">fsck</span><span class="calibre_13"> programs make these “orphans” new files in the filesystem’s </span><span class="italic">lost+found</span><span class="calibre_13"> directory.</span></p><p id="calibre_link-146" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">4.6.3 Working with Filesystems in User Space</span></span></span></p><p class="calibre_45"><span class="calibre_13">When working with files and directories in user space, you shouldn’t have to worry much about the implementation going on below them. Processes are expected to access the contents of files and directories of a mounted filesystem through kernel system calls. Curiously, though, you do have access to certain filesystem information that doesn’t seem to fit in user space&mdash;in particular, the </span><span class="calibre3">stat()</span><span class="calibre_13"> system call returns inode numbers and link counts.</span></p><p class="calibre_27"><span class="calibre_13">When you’re not maintaining a filesystem, do you have to worry about inode numbers, link counts, and other implementation details? Generally, no. This stuff is accessible to user-mode programs primarily for backward compatibility. Furthermore, not all filesystems available in Linux have these filesystem internals. The VFS interface layer ensures that system calls always return inode numbers and link counts, but those numbers may not necessarily mean anything.</span></p><p class="calibre_27"><span class="calibre_13"> You may not be able to perform traditional Unix filesystem operations on nontraditional filesystems. For example, you can’t use </span><span class="calibre3">ln</span><span class="calibre_13"> to create a hard link on a mounted VFAT filesystem because its directory entry structure, designed for Windows rather than Unix/Linux, does not support that concept.</span></p><p class="calibre_27"><span class="calibre_13">Fortunately, the system calls available to user space on Linux systems provide enough abstraction for painless file access&mdash;you don’t need to know anything about the underlying implementation in order to access files. In addition, filenames are flexible in format and mixed-case names are supported, making it easy to support other hierarchical-style filesystems.</span></p><p class="calibre_27"><span class="calibre_13">Remember, specific filesystem support does not necessarily need to be in the kernel. For example, in user-space filesystems, the kernel only needs to act as a conduit for system calls.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-147" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-588" class="calibre_10"><span class="calibre4"><span class="bold">5</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">HOW THE LINUX KERNEL BOOTS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">You now know the physical and logical structure of a Linux system, what the kernel is, and how to work with processes. This chapter will teach you how the kernel starts, or </span></span><span class="calibre1"><span class="italic">boots</span></span><span class="calibre1"><span class="calibre_13">. In other words, you’ll learn how the kernel moves into memory and what it does up to the point where the first user process starts.</span></span></p><p class="calibre_33"><span class="calibre_13">A simplified view of the boot process looks like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The machine’s BIOS or boot firmware loads and runs a boot loader.</li><li value="2" class="calibre_8">The boot loader finds the kernel image on disk, loads it into memory, and starts it.</li><li value="3" class="calibre_8">The kernel initializes the devices and its drivers.</li><li value="4" class="calibre_8">The kernel mounts the root filesystem.</li><li value="5" class="calibre_8">The kernel starts a program called <span class="italic">init</span> with a process ID of 1. This point is the <span class="italic">user space start</span>.</li><li value="6" class="calibre_8">init sets the rest of the system processes in motion.</li><a id="calibre_link-589"></a><li value="7" class="calibre_8">At some point, init starts a process allowing you to log in, usually at the end or near the end of the boot sequence.</li></ol><p class="calibre_33"><span class="calibre_13"> This chapter covers the first couple of stages, focusing on the boot loaders and kernel. </span>Chapter 6<span class="calibre_13"> continues with the user space start by detailing </span><span class="italic">systemd</span><span class="calibre_13">, the most widespread version of init on Linux systems.</span></p><p class="calibre_27"><span class="calibre_13">Being able to identify each stage of the boot process will prove invaluable to you in fixing boot problems and understanding the system as a whole. However, the default behavior in many Linux distributions often makes it difficult, if not impossible, to identify the first few boot stages as they proceed, so you’ll probably be able to get a good look only after they’ve completed and you log in.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-148" class="calibre_23"><span class="calibre1"><span class="bold"> 5.1 Startup Messages</span></span></p><p class="calibre_24"><span class="calibre_13">Traditional Unix systems produce many diagnostic messages upon boot that tell you about the boot process. The messages come first from the kernel and then from processes and initialization procedures that init starts. However, these messages aren’t pretty or consistent, and in some cases they aren’t even very informative. In addition, hardware improvements have caused the kernel to start much faster than before; the messages flash by so quickly, it can be difficult to see what’s happening. As a result, most current Linux distributions do their best to hide boot diagnostics with splash screens and other forms of filler to distract you while the system starts.</span></p><p class="calibre_27"><span class="calibre_13"> The best way to view the kernel’s boot and runtime diagnostic messages is to retrieve the journal for the kernel with the </span><span class="calibre3">journalctl</span><span class="calibre_13"> command. Running </span><span class="calibre3">journalctl -k</span><span class="calibre_13"> displays the messages from the current boot, but you can view previous boots with the </span><span class="calibre3">-b</span><span class="calibre_13"> option. We’ll cover the journal in more detail in </span>Chapter 7<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If you don’t have systemd, you can check for a logfile such as </span><span class="italic">/var/log/kern.log</span><span class="calibre_13"> or run the </span><span class="calibre3">dmesg</span><span class="calibre_13"> command to view the messages in the </span><span class="italic">kernel ring buffer</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Here’s a sample of what you can expect to see from the </span><span class="calibre3">journalctl -k</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">microcode: microcode updated early to revision 0xd6, date = 2019-10-03<br class="calibre7" />Linux version 4.15.0-112-generic (buildd@lcy01-amd64-027) (gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)) #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020 (Ubuntu 4.15.0-112.113-generic 4.15.18)<br class="calibre7" />Command line: BOOT_IMAGE=/boot/vmlinuz-4.15.0-112-generic root=UUID=17f12d53-c3d7-4ab3-943e-a0a72366c9fa ro quiet splash vt.handoff=1<br class="calibre7" />KERNEL supported cpus:<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />scsi 2:0:0:0: Direct-Access&nbsp;&nbsp;&nbsp;&nbsp; ATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KINGSTON SM2280S 01.R PQ: 0 ANSI: 5<br class="calibre7" />sd 2:0:0:0: Attached scsi generic sg0 type 0<br class="calibre7" />sd 2:0:0:0: [sda] 468862128 512-byte logical blocks: (240 GB/224 GiB)sd 2:0:0:0: [sda] Write Protect is off<br class="calibre7" />sd 2:0:0:0: [sda] Mode Sense: 00 3a 00 00<br class="calibre7" />sd 2:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA sda: sda1 sda2 &lt; sda5 &gt;<br class="calibre7" />sd 2:0:0:0: [sda] Attached SCSI disk<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote><a id="calibre_link-590"></a></blockquote><p class="calibre_30"><span class="calibre_13">After the kernel has started, the user-space startup procedure often generates messages. These messages will likely be more difficult to view and review because on most systems you won’t find them in a single logfile. Startup scripts are designed to send messages to the console that are erased after the boot process finishes. However, this isn’t a problem on Linux systems because systemd captures diagnostic messages from startup and runtime that would normally go to the console.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-149" class="calibre_23"><span class="calibre1"><span class="bold"> 5.2 Kernel Initialization and Boot Options</span></span></p><p class="calibre_24"><span class="calibre_13">Upon startup, the Linux kernel initializes in this general order:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">CPU inspection</li><li value="2" class="calibre_8">Memory inspection</li><li value="3" class="calibre_8">Device bus discovery</li><li value="4" class="calibre_8">Device discovery</li><li value="5" class="calibre_8">Auxiliary kernel subsystem setup (networking and the like)</li><li value="6" class="calibre_8">Root filesystem mount</li><li value="7" class="calibre_8">User space start</li></ol><p class="calibre_33"><span class="calibre_13"> The first two steps aren’t too remarkable, but when the kernel gets to devices, the question of dependencies arises. For example, the disk device drivers may depend on bus support and SCSI subsystem support, as you saw in </span>Chapter 3<span class="calibre_13">. Then, later in the initialization process, the kernel must mount a root filesystem before starting init.</span></p><p class="calibre_27"><span class="calibre_13"> In general, you won’t have to worry about the dependencies, except that some necessary components may be loadable kernel modules rather than part of the main kernel. Some machines may need to load these kernel modules before the true root filesystem is mounted. We’ll cover this problem and its initial RAM filesystem (initrd) workaround solutions in </span>Section 6.7<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">The kernel emits certain kinds of messages indicating that it’s getting ready to start its first user process:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Freeing unused kernel memory: 2408K<br class="calibre7" />Write protecting the kernel read-only data: 20480k<br class="calibre7" />Freeing unused kernel memory: 2008K<br class="calibre7" />Freeing unused kernel memory: 1892K</span></blockquote></blockquote><p id="calibre_link-705" class="calibre_30"><span class="calibre_13">Here, not only is the kernel cleaning up some unused memory, but it’s also protecting its own data. Then, if you’re running a new enough kernel, you’ll see the kernel start the first user-space process as init:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Run /init as init process with arguments: --</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Later on, you should be able to see the root filesystem being mounted and systemd starting up, sending a few messages of its own to the kernel log:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)<br class="calibre7" />systemd[1]: systemd 237 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy=hybrid)<br class="calibre7" />systemd[1]: Detected architecture x86-64.<br class="calibre7" />systemd[1]: Set hostname to &lt;duplex&gt;.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">At this point, you definitely know that user space has started.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-150" class="calibre_23"><span class="calibre1"><span class="bold"> 5.3 Kernel Parameters</span></span></p><p class="calibre_24"><span class="calibre_13">When the Linux kernel starts, it receives a set of text-based </span><span class="italic">kernel parameters</span><span class="calibre_13"> containing a few additional system details. The parameters specify many different types of behavior, such as the amount of diagnostic output the kernel should produce and device driver&ndash;specific options.</span></p><p class="calibre_27"><span class="calibre_13"> You can view the parameters passed to your system’s currently running kernel by looking at the </span><span class="italic">/proc/cmdline</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat /proc/cmdline</span></span><span class="calibre3"><br class="calibre7" />BOOT_IMAGE=/boot/vmlinuz-4.15.0-43-generic root=UUID=17f12d53-c3d7-4ab3-943e-a0a72366c9fa ro quiet splash vt.handoff=1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The parameters are either simple one-word flags, such as </span><span class="calibre3">ro</span><span class="calibre_13"> and </span><span class="calibre3">quiet</span><span class="calibre_13">, or </span><span class="calibre3"><span class="italic">key</span></span><span class="calibre3">=</span><span class="calibre3"><span class="italic">value</span></span><span class="calibre_13"> pairs, such as </span><span class="calibre3">vt.handoff=1</span><span class="calibre_13">. Many of the parameters are unimportant, such as the </span><span class="calibre3">splash</span><span class="calibre_13"> flag for displaying a splash screen, but one that is critical is the </span><span class="calibre3">root</span><span class="calibre_13"> parameter. This is the location of the root filesystem; without it, the kernel cannot properly perform the user space start.</span></p><p class="calibre_27"><span class="calibre_13">The root filesystem can be specified as a device file, as in this example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root=/dev/sda1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">On most contemporary systems, there are two alternatives that are more common. First, you might see a logical volume such as this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root=/dev/mapper/my-system-root</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You may also see a UUID (see </span>Section 4.2.4<span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root=UUID=17f12d53-c3d7-4ab3-943e-a0a72366c9fa</span></blockquote></blockquote><p id="calibre_link-578" class="calibre_30"><span class="calibre_13">Both of these are preferable because they do not depend on a specific kernel device mapping.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">ro</span><span class="calibre_13"> parameter instructs the kernel to mount the root filesystem in read-only mode upon user space start. This is normal; read-only mode ensures that </span><span class="calibre3">fsck</span><span class="calibre_13"> can check the root filesystem safely before trying to do anything serious. After the check, the bootup process remounts the root filesystem in read-write mode.</span></p><p class="calibre_27"><span class="calibre_13"> Upon encountering a parameter that it doesn’t understand, the Linux kernel saves that parameter. The kernel later passes the parameter to init when performing the user space start. For example, if you add </span><span class="calibre3">-s</span><span class="calibre_13"> to the kernel parameters, the kernel passes the </span><span class="calibre3">-s</span><span class="calibre_13"> to the init program to indicate that it should start in single-user mode.</span></p><p class="calibre_27"><span class="calibre_13"> If you’re interested in the basic boot parameters, the bootparam(7) manual page gives an overview. If you’re looking for something very specific, you can check out </span><span class="italic">kernel-params.txt</span><span class="calibre_13">, a reference file that comes with the Linux kernel.</span></p><p class="calibre_27"><span class="calibre_13"> With these basics covered, you should feel free to skip ahead to </span>Chapter 6<span class="calibre_13"> to learn the specifics of user space start, the initial RAM disk, and the init program that the kernel runs as its first process. The remainder of this chapter details how the kernel loads into memory and starts, including how it gets its parameters.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-151" class="calibre_23"><span class="calibre1"><span class="bold"> 5.4 Boot Loaders</span></span></p><p class="calibre_24"><span class="calibre_13">At the start of the boot process, before the kernel and init start, a </span><span class="italic">boot loader</span><span class="calibre_13"> program starts the kernel. The boot loader’s job sounds simple: it loads the kernel into memory from somewhere on a disk and then starts the kernel with a set of kernel parameters. However, this job is more complicated than it appears. To understand why, consider the questions that the boot loader must answer:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Where is the kernel?</li><li value="2" class="calibre_8">What kernel parameters should be passed to the kernel when it starts?</li></ul><p class="calibre_33"><span class="calibre_13">The answers are (typically) that the kernel and its parameters are usually somewhere on the root filesystem. It may sound like the kernel parameters should be easy to find, but remember that the kernel itself is not yet running, and it’s the kernel that usually traverses a filesystem to find the necessary files. Worse, the kernel device drivers normally used to access the disk are also unavailable. Think of this as a kind of “chicken or egg” problem. It can get even more complicated than this, but for now, let’s see how a boot loader overcomes the obstacles of the drivers and the filesystem.</span></p><p class="calibre_27"><span class="calibre_13"> A boot loader does need a driver to access the disk, but it’s not the same one that the kernel uses. On PCs, boot loaders use the traditional </span><span class="italic">Basic Input/Output System (BIOS)</span><span class="calibre_13"> or the newer </span><span class="italic">Unified Extensible Firmware Interface (UEFI)</span><span class="calibre_13"> to access disks. (</span><span class="italic">Extensible Firmware Interface</span><span class="calibre_13">, or </span><span class="italic">EFI</span><span class="calibre_13">, and UEFI will be discussed in more detail in </span>Section 5.8.2<span class="calibre_13">.) Contemporary disk hardware includes firmware allowing the BIOS or UEFI to access attached storage hardware via </span><a id="calibre_link-579"></a><span class="italic">Logical Block Addressing (LBA)</span><span class="calibre_13">. LBA is a universal, simple way to access data from any disk, but its performance is poor. This isn’t a problem, though, because boot loaders are often the only programs that must use this mode for disk access; after starting, the kernel has access to its own high-performance drivers.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> To determine if your system uses a BIOS or UEFI, run </span></span><span class="calibre3"><span class="bold">efibootmgr</span></span><span class="italic"><span class="calibre_13">. If you get a list of boot targets, your system has UEFI. If instead you’re told that EFI variables aren’t supported, your system uses a BIOS. Alternatively, you can check to see that </span></span>/sys/firmware/efi<span class="italic"><span class="calibre_13"> exists; if so, your system uses UEFI.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Once access to the disk’s raw data has been resolved, the boot loader must do the work of locating the desired data on the filesystem. Most common boot loaders can read partition tables and have built-in support for read-only access to filesystems. Thus, they can find and read the files that they need to get the kernel into memory. This capability makes it far easier to dynamically configure and enhance the boot loader. Linux boot loaders have not always had this capability; without it, configuring the boot loader was more difficult.</span></p><p class="calibre_27"><span class="calibre_13">In general, there’s been a pattern of the kernel adding new features (especially in storage technology), followed by boot loaders adding separate, simplified versions of those features to compensate.</span></p><p id="calibre_link-152" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.4.1 Boot Loader Tasks</span></span></span></p><p class="calibre_45"><span class="calibre_13">A Linux boot loader’s core functionality includes the ability to do the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Select from multiple kernels.</li><li value="2" class="calibre_8">Switch between sets of kernel parameters.</li><li value="3" class="calibre_8">Allow the user to manually override and edit kernel image names and parameters (for example, to enter single-user mode).</li><li value="4" class="calibre_8">Provide support for booting other operating systems.</li></ul><p class="calibre_33"><span class="calibre_13">Boot loaders have become considerably more advanced since the inception of the Linux kernel, with features such as command-line history and menu systems, but a basic need has always been flexibility in kernel image and parameter selection. (One surprising phenomenon is that some needs have actually diminished. For example, because you can perform an emergency or recovery boot from a USB storage device, you rarely have to worry about manually entering kernel parameters or going into single-user mode.) Current boot loaders offer more power than ever, which can be particularly handy if you’re building custom kernels or just want to tweak parameters.</span></p><p id="calibre_link-153" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.4.2 Boot Loader Overview</span></span></span></p><p class="calibre_45"><span class="calibre_13">Here are the main boot loaders that you may encounter:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">GRUB</span> A near-universal standard on Linux systems, with BIOS/MBR and UEFI versions.</li><li value="2" class="calibre_8"><span class="bold">LILO</span> One of the first Linux boot loaders. ELILO is a UEFI version.</li><li value="3" class="calibre_8"><span class="bold">SYSLINUX</span> Can be configured to run from many different kinds of filesystems.</li><li value="4" class="calibre_8"><span class="bold">LOADLIN</span> Boots a kernel from MS-DOS.</li><li value="5" class="calibre_8"><span class="bold">systemd-boot </span>A simple UEFI boot manager.</li><li value="6" class="calibre_8"><span class="bold">coreboot</span> (formerly LinuxBIOS) A high-performance replacement for the PC BIOS that can include a kernel.</li><li value="7" class="calibre_8"><span class="bold">Linux Kernel EFISTUB</span> A kernel plug-in for loading the kernel directly from a EFI/UEFI System Partition (ESP).</li><li value="8" class="calibre_8"><span class="bold">efilinux</span> A UEFI boot loader intended to serve as a model and reference for other UEFI boot loaders.</li></ol><p class="calibre_33"><span class="calibre_13">This book deals almost exclusively with GRUB. The rationale behind using other boot loaders is that they’re simpler to configure than GRUB, they’re faster, or they provide some other special-purpose functionality.</span></p><p class="calibre_27"><span class="calibre_13">You can learn a lot about a boot loader by getting to a boot prompt where you can enter a kernel name and parameters. To do this, you need to know how to get to a boot prompt or menu. Unfortunately, this can sometimes be difficult to figure out because Linux distributions heavily customize boot loader behavior and appearance. It’s usually impossible to tell just by watching the boot process which boot loader the distribution uses.</span></p><p class="calibre_27"><span class="calibre_13">The next sections tell you how to get to a boot prompt in order to enter a kernel name and parameters. Once you’re comfortable with that, you’ll see how to configure and install a boot loader.</span></p><div class="mbp_pagebreak"></div><p class="calibre_23"><span class="calibre1"><span class="bold"> 5.5 GRUB Introduction</span></span></p><p class="calibre_24"><span class="calibre_13">GRUB stands for </span><span class="italic">Grand Unified Boot Loader</span><span class="calibre_13">. We’ll cover GRUB 2, but there’s also an older version called GRUB Legacy that’s no longer in active use.</span></p><p class="calibre_27"><span class="calibre_13">One of GRUB’s most important capabilities is filesystem navigation that allows for easy kernel image and configuration selection. One of the best ways to see this in action and to learn about GRUB in general is to look at its menu. The interface is easy to navigate, but there’s a good chance that you’ve never seen it.</span></p><p class="calibre_27"><span class="calibre_13"> To access the GRUB menu, press and hold </span>SHIFT<span class="calibre_13"> when your BIOS startup screen first appears, or </span>ESC<span class="calibre_13"> if your system has UEFI. Otherwise, the boot loader configuration may not pause before loading the kernel. </span><a></a><a href="#calibre_link-508"><span class="italic"><span class="calibre_4">Figure 5-1</span></span></a><span class="calibre_13"> shows the GRUB menu.</span></p><p id="calibre_link-706" class="calibre_63">
</p><p class="calibre_34"><img src="images/000006.jpg" class="calibre_78" />
</p><p id="calibre_link-508" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 5-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: GRUB menu</span></span></span></p><p class="calibre_37"><span class="calibre_13">Try the following to explore the boot loader:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Reboot or power on your Linux system.</li><li value="2" class="calibre_8">Hold down SHIFT during the BIOS self-test or ESC at the firmware splash screen to get the GRUB menu. (Sometimes these screens are not visible, so you have to guess when to press the button.)</li><li value="3" class="calibre_8">Press e to view the boot loader configuration commands for the default boot option. You should see something like <a href="#calibre_link-509"><span class="italic"><span class="calibre_4">Figure 5-2</span></span></a> (you might have to scroll down to see all of the details). <blockquote class="calibre_16"><blockquote class="calibre_29"><img src="images/000029.jpg" class="calibre_79" />
</blockquote></blockquote><blockquote class="calibre_61"><blockquote class="calibre_29"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 5-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: GRUB configuration editor</span></span></span></blockquote></blockquote></li><a id="calibre_link-509"></a></ol><p id="calibre_link-707" class="calibre_37"><span class="calibre_13">This screen tells us that for this configuration, the root is set with a UUID, the kernel image is </span><span class="italic">/boot/vmlinuz-4.15.0-45-generic</span><span class="calibre_13">, and the kernel parameters include </span><span class="calibre3">ro</span><span class="calibre_13">, </span><span class="calibre3">quiet</span><span class="calibre_13">, and </span><span class="calibre3">splash</span><span class="calibre_13">. The initial RAM filesystem is </span><span class="italic">/boot/initrd.img-4.15.0-45-generic</span><span class="calibre_13">. But if you’ve never seen this sort of configuration before, you might find it somewhat confusing. Why are there multiple references to </span><span class="calibre3">root</span><span class="calibre_13">, and why are they different? Why is </span><span class="calibre3">insmod</span><span class="calibre_13"> here? If you’ve seen this before, you might remember that it’s a Linux kernel feature normally run by udevd.</span></p><p class="calibre_27"><span class="calibre_13"> The double takes are warranted, because GRUB doesn’t </span><span class="italic">use</span><span class="calibre_13"> the Linux kernel (remember, its job is to </span><span class="italic">start</span><span class="calibre_13"> the kernel). The configuration you see consists wholly of features and commands internal to GRUB, which exists in its own separate world.</span></p><p class="calibre_27"><span class="calibre_13"> The confusion stems partly from the fact that GRUB borrows terminology from many sources. GRUB has its own “kernel” and its own </span><span class="calibre3">insmod</span><span class="calibre_13"> command to dynamically load GRUB modules, completely independent of the Linux kernel. Many GRUB commands are similar to Unix shell commands; there’s even an </span><span class="calibre3">ls</span><span class="calibre_13"> command to list files.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There’s a GRUB module for LVM that is required to boot systems where the kernel resides on a logical volume. You might see this on your system.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> By far, the most confusion results from GRUB’s use of the word </span><span class="italic">root</span><span class="calibre_13">. Normally, you think of root as your system’s root filesystem. In a GRUB configuration, this is a kernel parameter, located somewhere after the image name of the </span><span class="calibre3">linux</span><span class="calibre_13"> command.</span></p><p class="calibre_27"><span class="calibre_13">Every other reference to root in the configuration is to the GRUB root, which exists only inside of GRUB. The GRUB “root” is the filesystem where GRUB searches for kernel and RAM filesystem image files.</span></p><p class="calibre_27"><span class="calibre_13"> In </span><a href="#calibre_link-509"><span class="italic"><span class="calibre_4">Figure 5-2</span></span></a><span class="calibre_13">, the GRUB root is first set to a GRUB-specific device (</span><span class="calibre3">hd0,msdos1</span><span class="calibre_13">), a default value for this configuration </span>1<span class="calibre_13">. In the next command, GRUB then searches for a particular UUID on a partition </span>2<span class="calibre_13">. If it finds that UUID, it sets the GRUB root to that partition.</span></p><p class="calibre_27"><span class="calibre_13"> To wrap it up, the </span><span class="calibre3">linux</span><span class="calibre_13"> command’s first argument (</span><span class="calibre3">/boot/vmlinuz-</span><span class="calibre_13">. . .) is the location of the Linux kernel image file </span>3<span class="calibre_13">. GRUB loads this file from the GRUB root. The </span><span class="calibre3">initrd</span><span class="calibre_13"> command is similar, specifying the file for the initial RAM filesystem covered in </span>Chapter 6<span class="calibre_13">
</span>4<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You can edit this configuration inside GRUB; doing so is usually the easiest way to temporarily fix an erroneous boot. To permanently fix a boot problem, you’ll need to change the configuration (see </span>Section 5.5.2<span class="calibre_13">), but for now, let’s go one step deeper and examine some GRUB internals with the command-line interface.</span></p><p id="calibre_link-154" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.5.1 Exploring Devices and Partitions with the GRUB Command Line</span></span></span></p><p class="calibre_45"><span class="calibre_13">As you can see in </span><a href="#calibre_link-509"><span class="italic"><span class="calibre_4">Figure 5-2</span></span></a><span class="calibre_13">, GRUB has its own device-addressing scheme. For example, the first hard disk found is named hd0, followed by hd1, and so on. Device name assignments are subject to change, but fortunately GRUB can search all partitions for UUIDs to find the one where the kernel resides, as you just saw in </span><a href="#calibre_link-509"><span class="italic"><span class="calibre_4">Figure 5-2</span></span></a><span class="calibre_13"> with the </span><span class="calibre3">search</span><span class="calibre_13"> command.</span></p><p id="calibre_link-774" class="calibre_46"><span class="bold">Listing Devices</span></p><p class="calibre_25"><span class="calibre_13">To get a feel for how GRUB refers to the devices on your system, access the GRUB command line by pressing c at the boot menu or configuration editor. You should get the GRUB prompt:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt;</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can enter any command here that you see in a configuration, but to get started, try a diagnostic command instead: </span><span class="calibre3">ls</span><span class="calibre_13">. With no arguments, the output is a list of devices known to GRUB:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">ls</span></span><span class="calibre3"><br class="calibre7" />(hd0) (hd0,msdos1)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this case, there is one main disk device denoted by </span><span class="calibre3">(hd0)</span><span class="calibre_13"> and a single partition </span><span class="calibre3">(hd0,msdos1)</span><span class="calibre_13">. If there were a swap partition on the disk, it would show up as well, such as </span><span class="calibre3">(hd0,msdos5)</span><span class="calibre_13">. The </span><span class="calibre3">msdos</span><span class="calibre_13"> prefix on the partitions tells you that the disk contains an MBR partition table; it would begin with </span><span class="calibre3">gpt</span><span class="calibre_13"> for GPT, found on UEFI systems. (There are even deeper combinations with a third identifier, where a BSD disklabel map resides inside a partition, but you won’t normally have to worry about this unless you’re running multiple operating systems on one machine.)</span></p><p class="calibre_27"><span class="calibre_13"> To get more detailed information, use </span><span class="calibre3">ls -l</span><span class="calibre_13">. This command can be particularly useful because it displays any UUIDs of the partition filesystems. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">ls -l</span></span><span class="calibre3"><br class="calibre7" />Device hd0: No known filesystem detected &ndash; Sector size 512B - Total size 32009856KiB Partition hd0,msdos1: Filesystem type ext* &ndash; Last modification time 2019-02-14 19:11:28 Thursday, UUID 8b92610e-1db7-4ba3-ac2f-30ee24b39ed0 - Partition start at 1024Kib - Total size 32008192KiB</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This particular disk has a Linux ext2/3/4 filesystem on the first MBR partition. Systems using a swap partition will show another partition, but you won’t be able to tell its type from the output.</span></p><p class="calibre_46"><span class="bold">File Navigation</span></p><p class="calibre_25"><span class="calibre_13">Now let’s look at GRUB’s filesystem navigation capabilities. Determine the GRUB root with the </span><span class="calibre3">echo</span><span class="calibre_13"> command (recall that this is where GRUB expects to find the kernel):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">echo $root</span></span><span class="calibre3"><br class="calibre7" />hd0,msdos1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To use GRUB’s </span><span class="calibre3">ls</span><span class="calibre_13"> command to list the files and directories in that root, you can append a forward slash to the end of the partition:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">ls (hd0,msdos1)/</span></span></blockquote></blockquote><p id="calibre_link-586" class="calibre_30"><span class="calibre_13">Because it’s inconvenient to type the actual root partition, you can substitute the </span><span class="calibre3">root</span><span class="calibre_13"> variable to save yourself some time:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">ls ($root)/</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The output is a short list of file and directory names on that partition’s filesystem, such as </span><span class="italic">etc/</span><span class="calibre_13">, </span><span class="italic">bin/</span><span class="calibre_13">, and </span><span class="italic">dev/</span><span class="calibre_13">. This is now a completely different function of the GRUB </span><span class="calibre3">ls</span><span class="calibre_13"> command. Before, you were listing devices, partition tables, and perhaps some filesystem header information. Now you’re actually looking at the contents of filesystems.</span></p><p class="calibre_27"><span class="calibre_13"> You can take a deeper look into the files and directories on a partition in a similar manner. For example, to inspect the </span><span class="italic">/boot</span><span class="calibre_13"> directory, start with the following:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">ls ($root)/boot</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Use the up and down arrow keys to flip through the GRUB command history and the left and right arrows to edit the current command line. The standard readline keys (</span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-N, </span></span><span class="italic">CTRL</span><span class="italic"><span class="calibre_13">-P, and so on) also work.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You can also view all currently set GRUB variables with the </span><span class="calibre3">set</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">grub&gt; </span><span class="calibre3"><span class="bold">set</span></span><span class="calibre3"><br class="calibre7" />?=0<br class="calibre7" />color_highlight=black/white<br class="calibre7" />color_normal=white/black<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />prefix=(hd0,msdos1)/boot/grub<br class="calibre7" />root=hd0,msdos1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> One of the most important of these variables is </span><span class="calibre3">$prefix</span><span class="calibre_13">, the filesystem and directory where GRUB expects to find its configuration and auxiliary support. We’ll discuss GRUB configuration next.</span></p><p class="calibre_27"><span class="calibre_13"> Once you’ve finished with the GRUB command-line interface, you can press </span>ESC<span class="calibre_13"> to return to the GRUB menu. Alternatively, if you’ve set all of the necessary configuration for boot (including the </span><span class="calibre3">linux</span><span class="calibre_13"> and possibly </span><span class="calibre3">initrd</span><span class="calibre_13"> variables), you can enter the </span><span class="calibre3">boot</span><span class="calibre_13"> command to boot that configuration. In any case, boot your system. We’re going to explore the GRUB configuration, and that’s best done when you have your full system available.</span></p><p id="calibre_link-155" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.5.2 GRUB Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">The GRUB configuration directory is usually </span><span class="italic">/boot/grub</span><span class="calibre_13"> or </span><span class="italic">/boot/grub2</span><span class="calibre_13">. It contains the central configuration file, </span><span class="italic">grub.cfg</span><span class="calibre_13">, an architecture-specific directory such as </span><span class="italic">i386-pc</span><span class="calibre_13"> containing loadable modules with a </span><span class="italic">.mod</span><span class="calibre_13"> suffix, and a few other items such as fonts and localization information. We won’t modify </span><span class="italic">grub.cfg</span><span class="calibre_13"> directly; instead, we’ll use the </span><span class="calibre3">grub-mkconfig</span><span class="calibre_13"> command (or </span><span class="calibre3">grub2-mkconfig</span><span class="calibre_13"> on Fedora).</span></p><p id="calibre_link-788" class="calibre_46"><span class="bold">Reviewing grub.cfg</span></p><p class="calibre_25"><span class="calibre_13">First, take a quick look at </span><span class="italic">grub.cfg</span><span class="calibre_13"> to see how GRUB initializes its menu and kernel options. You’ll see that the file consists of GRUB commands, which usually begin with a number of initialization steps followed by a series of menu entries for different kernel and boot configurations. The initialization isn’t complicated, but there are a lot of conditionals at the beginning that might lead you to believe otherwise. This first part just consists of a bunch of function definitions, default values, and video setup commands such as this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">if loadfont $font ; then set gfxmode=auto load_video insmod gfxterm --</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Many variables such as </span></span><span class="calibre3">$font</span><span class="italic"><span class="calibre_13"> originate from a </span></span><span class="calibre3">load_env</span><span class="italic"><span class="calibre_13"> call near the beginning of </span></span>grub.cfg<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Later in the configuration file, you’ll find the available boot configurations, each beginning with the </span><span class="calibre3">menuentry</span><span class="calibre_13"> command. You should be able to read and understand this example based on what you learned in the preceding section:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">menuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-8b92610e-1db7-4ba3-ac2f-30ee24b39ed0' { recordfail load_video gfxmode $linux_gfx_mode insmod gzio if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi insmod part_msdos insmod ext2 set root='hd0,msdos1' search --no-floppy --fs-uuid --set=root 8b92610e-1db7-4ba3-ac2f-30ee24b39ed0 linux&nbsp;&nbsp; /boot/vmlinuz-4.15.0-45-generic root=UUID=8b92610e-1db7-4ba3-ac2f-30ee24b39ed0 ro quiet splash $vt_handoff initrd&nbsp; /boot/initrd.img-4.15.0-45-generic<br class="calibre7" />}</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Examine your </span><span class="italic">grub.cfg</span><span class="calibre_13"> file for </span><span class="calibre3">submenu</span><span class="calibre_13"> commands containing multiple </span><span class="calibre3">menuentry</span><span class="calibre_13"> commands. Many distributions use the </span><span class="calibre3">submenu</span><span class="calibre_13"> command for older versions of the kernel so that they don’t crowd the GRUB menu.</span></p><p class="calibre_46"><span class="bold">Generating a New Configuration File</span></p><p class="calibre_25"><span class="calibre_13">If you want to make changes to your GRUB configuration, don’t edit your </span><span class="italic">grub.cfg</span><span class="calibre_13"> file directly, because it’s automatically generated and the system occasionally overwrites it. You’ll set up your new configuration elsewhere and then run </span><span class="calibre3">grub-mkconfig</span><span class="calibre_13"> to generate the new configuration.</span></p><p id="calibre_link-786" class="calibre_27"><span class="calibre_13">To see how the configuration generation works, look at the very beginning of </span><span class="italic">grub.cfg</span><span class="calibre_13">. There should be comment lines such as this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">### BEGIN /etc/grub.d/00_header ###</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Upon further inspection, you’ll find that nearly every file in </span><span class="italic">/etc/grub.d</span><span class="calibre_13"> is a shell script that produces a piece of the </span><span class="italic">grub.cfg</span><span class="calibre_13"> file. The </span><span class="calibre3">grub-mkconfig</span><span class="calibre_13"> command itself is a shell script that runs everything in </span><span class="italic">/etc/grub.d</span><span class="calibre_13">. Keep in mind that GRUB itself does not run these scripts at boot time; we run the scripts in user space to generate the </span><span class="italic">grub.cfg</span><span class="calibre_13"> file that GRUB runs.</span></p><p class="calibre_27"><span class="calibre_13">Try it yourself as root. Don’t worry about overwriting your current configuration. This command by itself simply prints the configuration to the standard output.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">grub-mkconfig</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> What if you want to add menu entries and other commands to the GRUB configuration? The short answer is that you should put your customizations into a new </span><span class="italic">custom.cfg</span><span class="calibre_13"> file in your GRUB configuration directory (usually </span><span class="italic">/boot/grub/custom.cfg</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> The long answer is a little more complicated. The </span><span class="italic">/etc/grub.d</span><span class="calibre_13"> configuration directory gives you two options: </span><span class="italic">40_custom</span><span class="calibre_13"> and </span><span class="italic">41_custom</span><span class="calibre_13">. The first, </span><span class="italic">40_custom</span><span class="calibre_13">, is a script that you can edit yourself, but it’s the least stable; a package upgrade is likely to destroy any changes you make. The </span><span class="italic">41_custom</span><span class="calibre_13"> script is simpler; it’s just a series of commands that load </span><span class="italic">custom.cfg</span><span class="calibre_13"> when GRUB starts. If you choose this second option, your changes won’t appear when you generate your configuration file because GRUB does all of the work at boot time.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The numbers in front of the filenames affect the processing order; lower numbers come first in the configuration file.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The two options for custom configuration files aren’t particularly extensive, and there’s nothing stopping you from adding your own scripts to generate configuration data. You might see some additions specific to your particular distribution in the </span><span class="italic">/etc/grub.d</span><span class="calibre_13"> directory. For example, Ubuntu adds memory tester boot options (</span><span class="calibre3">memtest86+</span><span class="calibre_13">) to the configuration.</span></p><p class="calibre_27"><span class="calibre_13"> To write and install a newly generated GRUB configuration file, you can write the configuration to your GRUB directory with the </span><span class="calibre3">-o</span><span class="calibre_13"> option to </span><span class="calibre3">grub-mkconfig</span><span class="calibre_13">, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">grub-mkconfig -o /boot/grub/grub.cfg</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">As usual, back up your old configuration and make sure that you’re installing to the correct directory.</span></p><p class="calibre_27"><span class="calibre_13"> Now we’re going to get into some of the more technical details of GRUB and boot loaders. If you’re tired of hearing about boot loaders and the kernel, skip to </span>Chapter 6<span class="calibre_13">.</span></p><p id="calibre_link-156" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.5.3 GRUB Installation</span></span></span></p><p class="calibre_45"><span class="calibre_13">Installing GRUB is more involved than configuring it. Fortunately, you won’t normally have to worry about installation because your distribution should handle it for you. However, if you’re trying to duplicate or restore a bootable disk, or preparing your own boot sequence, you might need to install it on your own.</span></p><p class="calibre_27"><span class="calibre_13"> Before proceeding, read </span>Section 5.4<span class="calibre_13"> to get an idea of how PCs boot and determine whether you’re using MBR or UEFI boot. Next, build the GRUB software set and determine where your GRUB directory will be; the default is </span><span class="italic">/boot/grub</span><span class="calibre_13">. You may not need to build GRUB if your distribution does it for you, but if you do, see </span>Chapter 16<span class="calibre_13"> for how to build software from source code. Make sure that you build the correct target: it’s different for MBR or UEFI boot (and there are even differences between 32-bit and 64-bit EFI).</span></p><p class="calibre_46"><span class="bold">Installing GRUB on Your System</span></p><p class="calibre_25"><span class="calibre_13">Installing the boot loader requires that you or an installer program determine the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The target GRUB directory as seen by your currently running system. As just mentioned, that’s usually <span class="italic">/boot/grub</span>, but it might be different if you’re installing GRUB on another disk for use on another system.</li><li value="2" class="calibre_8">The current device of the GRUB target disk.</li><li value="3" class="calibre_8"> For UEFI booting, the current mount point of the EFI system partition (usually <span class="italic">/boot/efi</span>).</li></ul><p class="calibre_33"><span class="calibre_13"> Remember that GRUB is a modular system, but in order to load modules, it must read the filesystem that contains the GRUB directory. Your task is to construct a version of GRUB capable of reading that filesystem so that it can load the rest of its configuration (</span><span class="italic">grub.cfg</span><span class="calibre_13">) and any required modules. On Linux, this usually means building a version of GRUB with its </span><span class="italic">ext2.mod</span><span class="calibre_13"> module (and possibly </span><span class="italic">lvm.mod</span><span class="calibre_13">) preloaded. Once you have this version, all you need to do is place it on the bootable part of the disk and place the rest of the required files into </span><span class="italic">/boot/grub</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Fortunately, GRUB comes with a utility called </span><span class="calibre3">grub-install</span><span class="calibre_13"> (not to be confused with </span><span class="calibre3">install-grub</span><span class="calibre_13">, which you might find on some older systems), which performs most of the work of installing the GRUB files and configuration for you. For example, if your current disk is at </span><span class="italic">/dev/sda</span><span class="calibre_13"> and you want to install GRUB on that disk’s MBR with your current </span><span class="italic">/boot/grub </span><span class="calibre_13">directory, use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">grub-install /dev/sda</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Incorrectly installing GRUB may break the bootup sequence on your system, so don’t take this command lightly. If you’re concerned, research how to back up your MBR with </span></span><span class="calibre3">dd</span><span class="italic"><span class="calibre_13">, back up any other currently installed GRUB directory, and make sure that you have an emergency bootup plan.</span></span></blockquote><p id="calibre_link-587" class="calibre_23"><span class="bold">Installing GRUB Using MBR on an External Storage Device</span></p><p class="calibre_25"><span class="calibre_13">To install GRUB on a storage device outside the current system, you must manually specify the GRUB directory on that device as your current system now sees it. For example, say you have a target device of </span><span class="italic">/dev/sdc</span><span class="calibre_13"> and that device’s root filesystem containing </span><span class="italic">/boot</span><span class="calibre_13"> (for example, </span><span class="italic">/dev/sdc1</span><span class="calibre_13">) is mounted on </span><span class="italic">/mnt</span><span class="calibre_13"> of your current system. This implies that when you install GRUB, your current system will see the GRUB files in </span><span class="italic">/mnt/boot/grub</span><span class="calibre_13">. When running </span><span class="calibre3">grub-install</span><span class="calibre_13">, tell it where those files should go as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">grub-install --boot-directory=/mnt/boot /dev/sdc</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On most MBR systems, </span><span class="italic">/boot</span><span class="calibre_13"> is a part of the root filesystem, but some installations put </span><span class="italic">/boot</span><span class="calibre_13"> into its own separate filesystem. Make sure that you know where your target </span><span class="italic">/boot</span><span class="calibre_13"> resides.</span></p><p class="calibre_46"><span class="bold">Installing GRUB with UEFI</span></p><p class="calibre_25"><span class="calibre_13">UEFI installation is supposed to be easier, because all you have to do is copy the boot loader into place. But you also need to “announce” the boot loader to the firmware&mdash;that is, save the loader configuration to the NVRAM&mdash;with the </span><span class="calibre3">efibootmgr</span><span class="calibre_13"> command. The </span><span class="calibre3">grub-install</span><span class="calibre_13"> command runs this if it’s available, so normally you can install GRUB on a UEFI system like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">grub-install --efi-directory=</span></span><span class="calibre3"><span class="italic"><span class="bold">efi_dir</span></span></span><span class="calibre3"><span class="bold"> &ndash;-bootloader-id=</span></span><span class="calibre3"><span class="italic"><span class="bold">name</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3"><span class="italic">efi_dir</span></span><span class="calibre_13"> is where the UEFI directory appears on your current system (usually </span><span class="italic">/boot/efi/EFI</span><span class="calibre_13">, because the UEFI partition is typically mounted at </span><span class="italic">/boot/efi</span><span class="calibre_13">) and </span><span class="calibre3"><span class="italic">name</span></span><span class="calibre_13"> is an identifier for the boot loader.</span></p><p class="calibre_27"><span class="calibre_13">Unfortunately, many problems can crop up when you’re installing a UEFI boot loader. For example, if you’re installing to a disk that will eventually end up in another system, you have to figure out how to announce that boot loader to the new system’s firmware. And there are differences in the install procedure for removable media.</span></p><p class="calibre_27"><span class="calibre_13">But one of the biggest problems is UEFI secure boot.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-157" class="calibre_23"><span class="calibre1"><span class="bold"> 5.6 UEFI Secure Boot Problems</span></span></p><p class="calibre_24"><span class="calibre_13">One newer problem affecting Linux installations is dealing with the </span><span class="italic">secure boot</span><span class="calibre_13"> feature found on recent PCs. When active, this UEFI mechanism requires any boot loader to be digitally signed by a trusted authority in order to run. Microsoft has required hardware vendors shipping Windows 8 and later with their systems to use secure boot. The result is that if you try to install an unsigned boot loader on these systems, the firmware will reject the loader and the operating system won’t load.</span></p><p class="calibre_27"><span class="calibre_13"> Major Linux distributions have no problem with secure boot because they include signed boot loaders, usually based on a UEFI version of GRUB. Often there’s a small signed shim that goes between UEFI and GRUB; UEFI runs the shim, which in turn executes GRUB. Protecting against booting unauthorized software is an important feature if your machine is not in a trustworthy environment or needs to meet certain security requirements, so some distributions go a step further and require that the entire boot sequence (including the kernel) be signed.</span><a id="calibre_link-594"></a></p><p class="calibre_27"><span class="calibre_13">There are some disadvantages to secure boot systems, especially for someone experimenting with building their own boot loaders. You can get around the secure boot requirement by disabling it in the UEFI settings. However, this won’t work cleanly for dual-boot systems since Windows won’t run without secure boot enabled.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-158" class="calibre_23"><span class="calibre1"><span class="bold"> 5.7 Chainloading Other Operating Systems</span></span></p><p class="calibre_24"><span class="calibre_13">UEFI makes it relatively easy to support loading other operating systems because you can install multiple boot loaders in the EFI partition. However, the older MBR style doesn’t support this functionality, and even if you do have UEFI, you may still have an individual partition with an MBR-style boot loader that you want to use. Instead of configuring and running a Linux kernel, GRUB can load and run a different boot loader on a specific partition on your disk; this is called </span><span class="italic">chainloading</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> To chainload, create a new menu entry in your GRUB configuration (using one of the methods described in the section </span>“Generating a New Configuration File”<span class="calibre_13">). Here’s an example for a Windows installation on the third partition of a disk:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">menuentry "Windows" {<br class="calibre7" />	insmod chain<br class="calibre7" />	insmod ntfs<br class="calibre7" />	set root=(hd0,3)<br class="calibre7" />	chainloader +1<br class="calibre7" />}</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">+1</span><span class="calibre_13"> option tells </span><span class="calibre3">chainloader</span><span class="calibre_13"> to load whatever is at the first sector of a partition. You can also get it to directly load a file, by using a line like this to load the </span><span class="italic">io.sys</span><span class="calibre_13"> MS-DOS loader:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">menuentry "DOS" {<br class="calibre7" />	insmod chain<br class="calibre7" />	insmod fat<br class="calibre7" />	set root=(hd0,3)<br class="calibre7" />	chainloader /io.sys<br class="calibre7" />}</span></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-159" class="calibre_42"><span class="calibre1"><span class="bold"> 5.8 Boot Loader Details</span></span></p><p class="calibre_24"><span class="calibre_13">Now we’ll look quickly at some boot loader internals. To understand how boot loaders like GRUB work, first we’ll survey how a PC boots when you turn it on. Because they must address the many inadequacies of traditional PC boot mechanisms, boot loading schemes have several variations, but there are two main ones: MBR and UEFI.</span><a id="calibre_link-580"></a></p><p id="calibre_link-160" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.8.1 MBR Boot</span></span></span></p><p class="calibre_45"><span class="calibre_13">In addition to the partition information described in </span>Section 4.1<span class="calibre_13">, the MBR includes a small area of 441 bytes that the PC BIOS loads and executes after its Power-On Self-Test (POST). Unfortunately, this space is inadequate to house almost any boot loader, so additional space is necessary, resulting in what is sometimes called a </span><span class="italic">multistage boot loader</span><span class="calibre_13">. In this case the initial piece of code in the MBR does nothing other than load the rest of the boot loader code. The remaining pieces of the boot loader are usually stuffed into the space between the MBR and the first partition on the disk. This isn’t terribly secure because anything can overwrite the code there, but most boot loaders do it, including most GRUB installations.</span></p><p class="calibre_27"><span class="calibre_13"> This scheme of shoving the boot loader code after the MBR doesn’t work with a GPT-partitioned disk using the BIOS to boot because the GPT information resides in the area after the MBR. (GPT leaves the traditional MBR alone for backward compatibility.) The workaround for GPT is to create a small partition called a </span><span class="italic">BIOS boot partition</span><span class="calibre_13"> with a special UUID (</span><span class="calibre3">21686148-6449-6E6F-744E-656564454649</span><span class="calibre_13">) to give the full boot loader code a place to reside. However, this isn’t a common configuration, because GPT is normally used with UEFI, not the traditional BIOS. It’s usually found only in older systems that have very large disks (greater than 2TB); these are too large for MBR.</span></p><p id="calibre_link-161" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.8.2 UEFI Boot</span></span></span></p><p class="calibre_45"><span class="calibre_13">PC manufacturers and software companies realized that the traditional PC BIOS is severely limited, so they decided to develop a replacement called Extensible Firmware Interface (EFI), which we’ve already discussed a bit in a few places in this chapter. EFI took a while to catch on for most PCs, but today it’s the most common, especially now that Microsoft requires secure boot for Windows. The current standard is Unified EFI (UEFI), which includes features such as a built-in shell and the ability to read partition tables and navigate filesystems. The GPT partitioning scheme is part of the UEFI standard.</span></p><p class="calibre_27"><span class="calibre_13"> Booting is radically different on UEFI systems compared to MBR. For the most part, it’s much easier to understand. Rather than executable boot code residing outside of a filesystem, there’s always a special VFAT filesystem called the EFI System Partition (ESP), which contains a directory named </span><span class="italic">EFI</span><span class="calibre_13">. The ESP is usually mounted on your Linux system at </span><span class="italic">/boot/efi</span><span class="calibre_13">, so you’ll probably find most of the EFI directory structure starting at </span><span class="italic">/boot/efi/EFI</span><span class="calibre_13">. Each boot loader has its own identifier and a corresponding subdirectory, such as </span><span class="italic">efi/microsoft</span><span class="calibre_13">, </span><span class="italic">efi/apple</span><span class="calibre_13">, </span><span class="italic">efi/ubuntu</span><span class="calibre_13">, or </span><span class="italic">efi/grub</span><span class="calibre_13">. A boot loader file has a </span><span class="italic">.efi</span><span class="calibre_13"> extension and resides in one of these subdirectories, along with other supporting files. If you go exploring, you might find files such as </span><span class="italic">grubx64.efi</span><span class="calibre_13"> (the EFI version of GRUB) and </span><span class="italic">shimx64.efi</span><span class="calibre_13">.</span></p><blockquote id="calibre_link-787" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The ESP differs from a BIOS boot partition, described in </span></span><span class="italic">Section 5.8.1</span><span class="italic"><span class="calibre_13">, and has a different UUID. You shouldn’t encounter a system with both.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">There’s a wrinkle, though: you can’t just put old boot loader code into the ESP, because the old code was written for the BIOS interface. Instead, you must provide a boot loader written for UEFI. For example, when using GRUB, you must install the UEFI version of GRUB rather than the BIOS version. And, as explained earlier in “Installing GRUB with UEFI,” you must announce new boot loaders to the firmware.</span></p><p class="calibre_27"><span class="calibre_13"> Finally, as </span>Section 5.6<span class="calibre_13"> noted, we have to contend with the “secure boot” issue.</span></p><p id="calibre_link-162" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">5.8.3 How GRUB Works</span></span></span></p><p class="calibre_45"><span class="calibre_13">Let’s wrap up our discussion of GRUB by looking at how it does its work:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The PC BIOS or firmware initializes the hardware and searches its boot-order storage devices for boot code.</li><li value="2" class="calibre_8">Upon finding the boot code, the BIOS/firmware loads and executes it. This is where GRUB begins.</li><li value="3" class="calibre_8">The GRUB core loads.</li><li value="4" class="calibre_8">The core initializes. At this point, GRUB can now access disks and filesystems.</li><li value="5" class="calibre_8">GRUB identifies its boot partition and loads a configuration there.</li><li value="6" class="calibre_8">GRUB gives the user a chance to change the configuration.</li><li value="7" class="calibre_8">After a timeout or user action, GRUB executes the configuration (the sequence of commands in the <span class="italic">grub.cfg</span> file, as outlined in Section 5.5.2).</li><li value="8" class="calibre_8">In the course of executing the configuration, GRUB may load additional code (modules) in the boot partition. Some of these modules may be preloaded.</li><li value="9" class="calibre_8">GRUB executes a <span class="calibre3">boot</span> command to load and execute the kernel as specified by the configuration’s <span class="calibre3">linux</span> command.</li></ol><p class="calibre_33"><span class="calibre_13"> Steps 3 and 4 of this sequence, where the GRUB core loads, can be complicated due to the inadequacies of traditional PC boot mechanisms. The biggest question is “Where </span><span class="italic">is</span><span class="calibre_13"> the GRUB core?” There are three basic possibilities:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Partially stuffed between the MBR and the beginning of the first partition</li><li value="2" class="calibre_8">In a regular partition</li><li value="3" class="calibre_8">In a special boot partition: a GPT boot partition, ESP, or elsewhere</li></ul><p class="calibre_33"><span class="calibre_13"> In all cases except where you have an UEFI/ESP, the PC BIOS loads 512 bytes from the MBR, and that’s where GRUB starts. This little piece (derived from </span><span class="italic">boot.img</span><span class="calibre_13"> in the GRUB directory) isn’t yet the core, but it contains the start location of the core and loads the core from this point.</span></p><p id="calibre_link-595" class="calibre_27"><span class="calibre_13">However, if you have an ESP, the GRUB core goes there as a file. The firmware can navigate the ESP and directly execute all of GRUB or any other operating system loader located there. (You might have a shim in the ESP that goes just before GRUB to handle secure boot, but the idea is the same.)</span></p><p class="calibre_27"><span class="calibre_13"> Still, on most systems, this isn’t the complete picture. The boot loader might also need to load an initial RAM filesystem image into memory before loading and executing the kernel. That’s what the </span><span class="calibre3">initrd</span><span class="calibre_13"> configuration parameter specifies, and we’ll cover it in </span>Section 6.7<span class="calibre_13">. But before you learn about the initial RAM filesystem, you should learn about the user space start&mdash;that’s where the next chapter begins.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-163" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-872" class="calibre_10"><span class="calibre4"><span class="bold">6</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">HOW USER SPACE STARTS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">The point where the kernel starts init, its first user-space process, is significant&mdash;not just because the memory and CPU are finally ready for normal system operation, but because that’s where you can see how the rest of the system builds up as a whole. Prior to this point, the kernel follows a well-controlled path of execution defined by a relatively small number of software developers. User space is far more modular and customizable, and it’s also quite easy to see what goes into the user-space startup and operation. If you’re feeling a little adventurous, you can use this to an advantage, because understanding and changing the user-space startup requires no low-level programming.</span></span></p><p id="calibre_link-795" class="calibre_33"><span class="calibre_13">User space starts in roughly this order:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">init</li><li value="2" class="calibre_8">Essential low-level services, such as udevd and syslogd</li><li value="3" class="calibre_8">Network configuration</li><li value="4" class="calibre_8">Mid- and high-level services (cron, printing, and so on)</li><li value="5" class="calibre_8">Login prompts, GUIs, and high-level applications, such as web servers</li></ol><div class="mbp_pagebreak"></div><p class="calibre_23"><span class="calibre1"><span class="bold"> 6.1 Introduction to init</span></span></p><p class="calibre_24"><span class="italic">init</span><span class="calibre_13"> is a user-space program like any other program on the Linux system, and you’ll find it in </span><span class="italic">/sbin</span><span class="calibre_13"> along with many of the other system binaries. Its main purpose is to start and stop the essential service processes on the system.</span></p><p class="calibre_27"><span class="calibre_13">On all current releases of major Linux distributions, the standard implementation of init is systemd. This chapter focuses on how systemd works and how to interact with it.</span></p><p class="calibre_27"><span class="calibre_13">There are two other varieties of init that you may encounter on older systems. System V init is a traditional sequenced init (Sys V, usually pronounced “sys-five,” with origins in Unix System V), found on Red Hat Enterprise Linux (RHEL) prior to version 7.0 and Debian 8. Upstart is the init on Ubuntu distributions prior to version 15.04.</span></p><p class="calibre_27"><span class="calibre_13"> Other versions of init exist, especially on embedded platforms. For example, Android has its own init, and a version called </span><span class="italic">runit</span><span class="calibre_13"> is popular on lightweight systems. The BSDs also have their own version of init, but you’re unlikely to see them on a contemporary Linux machine. (Some distributions have also modified the System V init configuration to resemble the BSD style.)</span></p><p class="calibre_27"><span class="calibre_13">Different implementations of init have been developed to address several shortcomings in System V init. To understand the problems, consider the inner workings of a traditional init. It’s basically a series of scripts that init runs, in sequence, one at a time. Each script usually starts one service or configures an individual piece of the system. In most cases, it’s relatively easy to resolve dependencies, plus there’s a lot of flexibility to accommodate unusual startup requirements by modifying scripts.</span></p><p class="calibre_27"><span class="calibre_13">However, this scheme suffers from some significant limitations. These can be grouped into “performance problems” and “system management hassles.” The most important of these are as follows:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Performance suffers because two parts of the boot sequence cannot normally run at once.</li><li value="2" class="calibre_8"> Managing a running system can be difficult. Startup scripts are expected to start service daemons. To find the PID of a service daemon, you need to use <span class="calibre3">ps</span>, some other mechanism specific to the service, or a semistandardized system of recording the PID, such as <span class="italic">/var/run/myservice.pid</span>.</li><li value="3" class="calibre_8">Startup scripts tend to include a lot of standard “boilerplate” code, sometimes making it difficult to read and understand what they do.</li><a id="calibre_link-796"></a><li value="4" class="calibre_8">There is little notion of on-demand services and configuration. Most services start at boot time; system configuration is largely set at that time as well. At one time, the traditional inetd daemon was able to handle on-demand network services, but it has largely fallen out of use.</li></ul><p class="calibre_33"><span class="calibre_13">Contemporary init systems have dealt with these problems by changing how services start, how they are supervised, and how the dependencies are configured. You’ll soon see how this works in systemd, but first, you should make sure that you’re running it.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-164" class="calibre_23"><span class="calibre1"><span class="bold"> 6.2 Identifying Your init</span></span></p><p class="calibre_24"><span class="calibre_13">Determining your system’s version of init usually isn’t difficult. Viewing the init(1) manual page normally tells you right away, but if you’re not sure, check your system as follows:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> If your system has <span class="italic">/usr/lib/systemd</span> and <span class="italic">/etc/systemd</span> directories, you have systemd.</li><li value="2" class="calibre_8"> If you have an <span class="italic">/etc/init</span> directory that contains several <span class="italic">.conf</span> files, you’re probably running Upstart (unless you’re running Debian 7 or older, in which case you probably have System V init). We won’t cover Upstart in this book because it has been widely supplanted by systemd.</li><li value="3" class="calibre_8"> If neither of the above is true, but you have an <span class="italic">/etc/inittab</span> file, you’re probably running System V init. Go to Section 6.5.</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-165" class="calibre_23"><span class="calibre1"><span class="bold"> 6.3 systemd</span></span></p><p class="calibre_24"><span class="calibre_13">The systemd init is one of the newest init implementations on Linux. In addition to handling the regular boot process, systemd aims to incorporate the functionality of a number of standard Unix services, such as cron and inetd. It takes some inspiration from Apple’s launchd.</span></p><p class="calibre_27"><span class="calibre_13">Where systemd really stands out from its predecessors is its advanced service management capabilities. Unlike a traditional init, systemd can track individual service daemons after they start, and group together multiple processes associated with a service, giving you more power and insight into exactly what is running on the system.</span></p><p class="calibre_27"><span class="calibre_13"> systemd is goal-oriented. At the top level, you can think of defining a goal, called a </span><span class="italic">unit</span><span class="calibre_13">, for some system task. A unit can contain instructions for common startup tasks, such as starting a daemon, and it also has dependencies, which are other units. When starting (or </span><span class="italic">activating</span><span class="calibre_13">) a unit, systemd attempts to activate its dependencies and then moves on to the details of the unit.</span></p><p id="calibre_link-770" class="calibre_27"><span class="calibre_13">When starting services, systemd does not follow a rigid sequence; instead, it activates units whenever they are ready. After boot, systemd can react to system events (such as the uevents outlined in </span>Chapter 3<span class="calibre_13">) by activating additional units.</span></p><p class="calibre_27"><span class="calibre_13">Let’s start by looking at a top-level view of units, activation, and the initial boot process. Then you’ll be ready to see the specifics of unit configuration and the many varieties of unit dependencies. Along the way, you’ll get a grip on how to view and control a running system.</span></p><p id="calibre_link-166" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.1 Units and Unit Types</span></span></span></p><p class="calibre_45"><span class="calibre_13">One way that systemd is more ambitious than previous versions of init is that it doesn’t just operate processes and services; it can also manage filesystem mounts, monitor network connection requests, run timers, and more. Each capability is called a </span><span class="italic">unit type</span><span class="calibre_13">, and each specific function (such as a service) is called a </span><span class="italic">unit</span><span class="calibre_13">. When you turn on a unit, you </span><span class="italic">activate</span><span class="calibre_13"> it. Each unit has its own configuration file; we’ll explore those files in </span>Section<span class="calibre_13">
</span>6.3.3<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">These are the most significant unit types that perform the boot-time tasks on a typical Linux system:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Service units</span> Control the service daemons found on a Unix system.</li><li value="2" class="calibre_8"><span class="bold">Target units</span> Control other units, usually by grouping them.</li><li value="3" class="calibre_8"><span class="bold">Socket units</span> Represent incoming network connection request locations.</li><li value="4" class="calibre_8"><span class="bold">Mount units</span> Represent the attachment of filesystems to the system. <blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can find a complete list of unit types in the systemd(1) manual page.</span></span></blockquote></blockquote></li></ol><div class="mbp_pagebreak"></div><p class="calibre_30"><span class="calibre_13">Of these, service and target units are the most common and the easiest to understand. Let’s take a look at how they fit together when you boot a system.</span></p><p id="calibre_link-167" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.2 Booting and Unit Dependency Graphs</span></span></span></p><p class="calibre_45"><span class="calibre_13">When you boot a system, you’re activating a default unit, normally a target unit called </span><span class="italic">default.target</span><span class="calibre_13"> that groups together a number of service and mount units as dependencies. As a result, it’s somewhat easy to get a partial picture of what’s going to happen when you boot. You might expect the unit dependencies to form a tree&mdash;with one unit at the top, branching into several units below for later stages of the boot process&mdash;but they actually form a graph. A unit that comes late in the boot process can depend on several previous units, making earlier branches of a dependency tree join back together. You can even create a dependency graph with the </span><span class="calibre3">systemd-analyze dot</span><span class="calibre_13"> command. The entire graph is quite large on a typical system (requiring significant computing power to render), and it’s hard to read, but there are ways to filter units and zero in on individual portions.</span></p><p id="calibre_link-732" class="calibre_27"><a href="#calibre_link-510"><span class="italic"><span class="calibre_4">Figure 6-1</span></span></a><span class="calibre_13"> shows a very small part of the dependency graph for the </span><span class="italic">default.target</span><span class="calibre_13"> unit found on a typical system. When you activate that unit, all of the units below it also activate.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> On most systems, </span></span>default.target<span class="italic"><span class="calibre_13"> is a link to some other high-level target unit, such as one that represents a user interface startup. On the system shown in </span></span><a href="#calibre_link-510"><span class="italic"><span class="calibre_4">Figure 6-1</span></span></a><span class="italic"><span class="calibre_13">, </span></span>default.target<span class="italic"><span class="calibre_13"> groups the units necessary to start a GUI.</span></span></blockquote><p class="calibre_23"><img src="images/000034.jpg" class="calibre_80" />
</p><p id="calibre_link-510" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 6-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Unit dependency graph</span></span></span></p><p class="calibre_37"><span class="calibre_13"> This figure is a greatly simplified view. On your own system, you won’t find it feasible to sketch out the dependencies just by looking at the unit configuration file at the top and working your way down. We’ll take a closer look at how dependencies work in </span>Section 6.3.6<span class="calibre_13">.</span></p><p id="calibre_link-168" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.3 systemd Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">The systemd configuration files are spread among many directories across the system, so you might need to do a little hunting when you’re looking for a particular file. There are two main directories for systemd configuration: the </span><span class="italic">system unit</span><span class="calibre_13"> directory (global configuration; usually </span><span class="italic">/lib/systemd/system</span><span class="calibre_13"> or </span><span class="italic">/usr/lib/systemd/system</span><span class="calibre_13">) and the </span><span class="italic">system configuration</span><span class="calibre_13"> directory (local definitions; usually </span><span class="italic">/etc/systemd/system</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> To prevent confusion, stick to this rule: avoid making changes to the system unit directory, because your distribution will maintain it for you. Make your local changes to the system configuration directory. This general rule also applies systemwide. When given the choice between modifying something in </span><span class="italic">/usr</span><span class="calibre_13"> and </span><span class="italic">/etc</span><span class="calibre_13">, always change </span><span class="italic">/etc</span><span class="calibre_13">.</span></p><p id="calibre_link-662" class="calibre_27"><span class="calibre_13">You can check the current systemd configuration search path (including precedence) with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">systemctl -p UnitPath show</span></span><span class="calibre3">UnitPath=/etc/systemd/system.control /run/systemd/system.control /run/systemd/transient /etc/systemd/system /run/systemd/system /run/systemd/generator /lib/systemd/system /run/systemd/generator.late</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">To see the system unit and configuration directories on your system, use the following commands:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">pkg-config systemd --variable=systemdsystemunitdir</span></span><span class="calibre3"><br class="calibre7" />/lib/systemd/system<br class="calibre7" />$ </span><span class="calibre3"><span class="bold">pkg-config systemd --variable=systemdsystemconfdir</span></span><span class="calibre3"><br class="calibre7" />/etc/systemd/system</span></blockquote></blockquote><p class="calibre_42"><span class="bold">Unit Files</span></p><p class="calibre_25"><span class="calibre_13">The format for unit files is derived from the XDG Desktop Entry specification (used for </span><span class="italic">.desktop</span><span class="calibre_13"> files, which are very similar to </span><span class="italic">.ini</span><span class="calibre_13"> files on Microsoft systems), with section names in square brackets (</span><span class="calibre3">[]</span><span class="calibre_13">) and variable and value assignments (options) in each section.</span></p><p class="calibre_27"><span class="calibre_13"> As an example, consider the </span><span class="italic">dbus-daemon.service</span><span class="calibre_13"> unit file for the desktop bus daemon:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=D-Bus System Message Bus<br class="calibre7" />Documentation=man:dbus-daemon(1)<br class="calibre7" />Requires=dbus.socket<br class="calibre7" />RefuseManualStart=yes<br class="calibre7" />[Service]<br class="calibre7" />ExecStart=/usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only<br class="calibre7" />ExecReload=/usr/bin/dbus-send --print-reply --system --type=method_call --dest= org.freedesktop.DBus / org.freedesktop.DBus.ReloadConfig</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> There are two sections, </span><span class="calibre3">[Unit]</span><span class="calibre_13"> and </span><span class="calibre3">[Service]</span><span class="calibre_13">. The </span><span class="calibre3">[Unit]</span><span class="calibre_13"> section gives some details about the unit and contains description and dependency information. In particular, this unit requires the </span><span class="italic">dbus.socket</span><span class="calibre_13"> unit as a dependency.</span></p><p class="calibre_27"><span class="calibre_13"> In a service unit such as this, you’ll find the details about the service in the </span><span class="calibre3">[Service]</span><span class="calibre_13"> section, including how to prepare, start, and reload the service. You’ll find a complete listing in the systemd.service(5) and systemd.exec(5) manual pages, as well as in the discussion of process tracking in </span>Section 6.3.5<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Many other unit configuration files are similarly straightforward. For example, the service unit file </span><span class="italic">sshd.service</span><span class="calibre_13"> enables remote secure shell logins by starting sshd.</span></p><blockquote id="calibre_link-670" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The unit files you find on your system may differ slightly. In this example, you saw that Fedora uses the name </span></span>dbus-daemon.service<span class="italic"><span class="calibre_13">, and Ubuntu uses </span></span>dbus.service<span class="italic"><span class="calibre_13">. There may be changes in the actual files as well, but they are often superficial.</span></span></blockquote><p class="calibre_23"><span class="bold">Variables</span></p><p class="calibre_25"><span class="calibre_13">You’ll often find variables inside unit files. Here’s a section from a different unit file, this one for the secure shell that you’ll learn about in </span>Chapter 10<span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Service]<br class="calibre7" />EnvironmentFile=/etc/sysconfig/sshd<br class="calibre7" />ExecStartPre=/usr/sbin/sshd-keygen<br class="calibre7" />ExecStart=/usr/sbin/sshd -D $OPTIONS $CRYPTO_POLICY<br class="calibre7" />ExecReload=/bin/kill -HUP $MAINPID</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Everything that starts with a dollar sign (</span><span class="calibre3">$</span><span class="calibre_13">) is a variable. Although these variables have the same syntax, their origins are different. The </span><span class="calibre3">$OPTIONS</span><span class="calibre_13"> and </span><span class="calibre3">$CRYPTO_POLICY</span><span class="calibre_13"> options, which you can pass to sshd upon unit activation, are defined in the file specified by the </span><span class="calibre3">EnvironmentFile</span><span class="calibre_13"> setting. In this particular case, you can look at </span><span class="italic">/etc/sysconfig/sshd</span><span class="calibre_13"> to determine if the variables are set and, if so, what their values are.</span></p><p class="calibre_27"><span class="calibre_13"> In comparison, </span><span class="calibre3">$MAINPID</span><span class="calibre_13"> contains the ID of the </span><span class="italic">tracked process</span><span class="calibre_13"> of the service (see </span>Section 6.3.5<span class="calibre_13">). Upon unit activation, systemd records and stores this PID so that you can use it to manipulate a service-specific process later on. The </span><span class="italic">sshd.service</span><span class="calibre_13"> unit file uses </span><span class="calibre3">$MAINPID</span><span class="calibre_13"> to send a hangup (HUP) signal to sshd when you want to reload the configuration (this is a very common technique for dealing with reloads and restarting Unix daemons).</span></p><p class="calibre_46"><span class="bold">Specifiers</span></p><p class="calibre_25"><span class="calibre_13">A </span><span class="italic">specifier</span><span class="calibre_13"> is a variable-like feature often found in unit files. Specifiers start with a percent sign (</span><span class="calibre3">%</span><span class="calibre_13">). For example, the </span><span class="calibre3">%n</span><span class="calibre_13"> specifier is the current unit name, and the </span><span class="calibre3">%H</span><span class="calibre_13"> specifier is the current hostname.</span></p><p class="calibre_27"><span class="calibre_13"> You can also use specifiers to create multiple copies of a unit from a single unit file. One example is the set of </span><span class="calibre3">getty</span><span class="calibre_13"> processes that control the login prompts on virtual consoles, such as </span><span class="italic">tty1</span><span class="calibre_13"> and </span><span class="italic">tty2</span><span class="calibre_13">. To use this feature, add an @ symbol to the end of the unit name, before the dot in the unit filename.</span></p><p class="calibre_27"><span class="calibre_13"> For example, the </span><span class="calibre3">getty</span><span class="calibre_13"> unit filename is </span><span class="italic">getty@.service</span><span class="calibre_13"> in most distributions, allowing for the dynamic creation of units, such as </span><span class="italic">getty@tty1</span><span class="calibre_13"> and </span><span class="italic">getty@tty2</span><span class="calibre_13">. Anything after the @ is called the </span><span class="italic">instance</span><span class="calibre_13">. When you look at one of these unit files, you may also see a </span><span class="calibre3">%I</span><span class="calibre_13"> or </span><span class="calibre3">%i</span><span class="calibre_13"> specifier. When activating a service from a unit file with instances, systemd replaces the </span><span class="calibre3">%I</span><span class="calibre_13"> or </span><span class="calibre3">%i</span><span class="calibre_13"> specifier with the instance to create the new service name.</span></p><p id="calibre_link-169" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.4 systemd Operation</span></span></span></p><p class="calibre_45"><span class="calibre_13">You’ll interact with systemd primarily through the </span><span class="calibre3">systemctl</span><span class="calibre_13"> command, which allows you to activate and deactivate services, list status, reload the configuration, and much more.</span></p><p class="calibre_27"><span class="calibre_13"> The most essential commands help you to obtain unit information. For example, to view a list of active units on your system, issue a </span><span class="calibre3">list-units</span><span class="calibre_13"> command. (This is the default command for </span><span class="calibre3">systemctl</span><span class="calibre_13">, so technically you don’t need the </span><span class="calibre3">list-units</span><span class="calibre_13"> argument.)</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">systemctl list-units</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The output format is typical of a Unix information-listing command. For example, the header and the line for </span><span class="italic">-.mount</span><span class="calibre_13"> (the root filesystem) looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">UNIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOAD&nbsp;&nbsp; ACTIVE SUB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DESCRIPTION<br class="calibre7" />-.mount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loaded active mounted&nbsp;&nbsp; Root Mount</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> By default, </span><span class="calibre3">systemctl list-units</span><span class="calibre_13"> produces a lot of output, because a typical system has numerous active units, but it’s still an abridged form because </span><span class="calibre3">systemctl</span><span class="calibre_13"> truncates any really large unit names. To see the full names of the units, use the </span><span class="calibre3">--full</span><span class="calibre_13"> option, and to see all units (not just those that are active), use the </span><span class="calibre3">--all</span><span class="calibre_13"> option.</span></p><p class="calibre_27"><span class="calibre_13"> A particularly useful </span><span class="calibre3">systemctl</span><span class="calibre_13"> operation is getting the status of a specific unit. For example, here’s a typical </span><span class="calibre3">status</span><span class="calibre_13"> command and some of its output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">systemctl status sshd.service</span></span><span class="calibre3"><br class="calibre7" />· sshd.service - OpenBSD Secure Shell server Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled) Active: active (running) since Fri 2021-04-16 08:15:41 EDT; 1 months 1 days ago Main PID: 1110 (sshd) Tasks: 1 (limit: 4915) CGroup: /system.slice/sshd.service ⌙1110 /usr/sbin/sshd -D</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">A number of log messages may also follow this output. If you’re used to a traditional init system, you might be surprised by the amount of useful information available from this one command. You get not only the state of the unit but also the processes associated with the service, when the unit started, and a number of log messages, if available.</span></p><p class="calibre_27"><span class="calibre_13">The output for other unit types includes similar useful information; for example, the output from mount units includes when the mount happened, the exact command line used for it, and its exit status.</span></p><p class="calibre_27"><span class="calibre_13"> One interesting piece of the output is the control group (cgroup) name. In the preceding example, the control group is </span><span class="calibre3">/system.slice/sshd.service</span><span class="calibre_13">, and the processes in the cgroup are shown below it. However, you may also see control groups named starting with </span><a id="calibre_link-807"></a><span class="calibre3">systemd:/system</span><span class="calibre_13"> if the processes of a unit (for example, a mount unit) have already terminated. You can view systemd-related cgroups without the rest of the unit status with the </span><span class="calibre3">systemd-cgls</span><span class="calibre_13"> command. You’ll learn more about how systemd uses cgroups in </span>Section 6.3.5<span class="calibre_13">, and how cgroups work in</span> Section 8.6<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">status</span><span class="calibre_13"> command also displays only the most recent diagnostic log messages for the unit. You can view all of a unit’s messages like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl --unit=</span></span><span class="calibre3"><span class="italic"><span class="bold">unit_name</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’ll learn much more about </span><span class="calibre3">journalctl</span><span class="calibre_13"> in </span>Chapter 7<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Depending on your system and user configuration, you might need superuser privileges to run </span></span><span class="calibre3">journalctl</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_23"><span class="bold">How Jobs Relate to Starting, Stopping, and Reloading Units</span></p><p class="calibre_25"><span class="calibre_13">To activate, deactivate, and restart units, you use the commands </span><span class="calibre3">systemctl start</span><span class="calibre_13">, </span><span class="calibre3">systemctl stop</span><span class="calibre_13">, and </span><span class="calibre3">systemctl restart</span><span class="calibre_13">. However, if you’ve changed a unit configuration file, you can tell systemd to reload the file in one of two ways:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">systemctl reload </span></span><span class="calibre3"><span class="italic"><span class="bold">unit</span></span></span> Reloads just the configuration for <span class="calibre3"><span class="italic">unit</span></span>.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">systemctl daemon-reload</span></span> Reloads all unit configurations.</li></ol><p class="calibre_33"><span class="calibre_13"> Requests to activate, reactivate, and restart units are called </span><span class="italic">jobs</span><span class="calibre_13"> in systemd, and they are essentially unit state changes. You can check the current jobs on a system with:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">systemctl list-jobs</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">If a system has been up for some time, you can reasonably expect there to be no active jobs because all activations required to start the system should be complete. However, at boot time, you can sometimes log in fast enough to see jobs for units that start very slowly. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">&nbsp; JOB UNIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATE&nbsp;&nbsp; 1 graphical.target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waiting 2 multi-user.target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waiting 71 systemd-...nlevel.service start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waiting 75 sm-client.service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waiting 76 sendmail.service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; running 120 systemd-...ead-done.timer start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; waiting</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this case, job 76, the </span><span class="italic">sendmail.service</span><span class="calibre_13"> unit startup, is taking a really long time. The other listed jobs are in a waiting state, most likely because they’re all waiting for job 76. When </span><span class="italic">sendmail.service</span><span class="calibre_13"> finishes starting and is fully active, job 76 will complete, the rest of the jobs will also complete, and the job list will be empty.</span></p><blockquote id="calibre_link-865" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The term </span></span>job<span class="italic"><span class="calibre_13"> can be confusing, especially because some other init systems use it to refer to features that are more like systemd units. These jobs also have nothing to do with the shell’s job control.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> See </span>Section 6.6<span class="calibre_13"> to learn how to shut down and reboot the system.</span></p><p class="calibre_46"><span class="bold">Adding Units to systemd</span></p><p class="calibre_25"><span class="calibre_13">Adding units to systemd is primarily a matter of creating, then activating and possibly enabling, unit files. You should normally put your own unit files in the system configuration directory (</span><span class="italic">/etc/systemd/system</span><span class="calibre_13">)</span><span class="italic">
</span><span class="calibre_13">so that you won’t confuse them with anything that came with your distribution and so that the distribution won’t overwrite them when you upgrade.</span></p><p class="calibre_27"><span class="calibre_13">Because it’s easy to create target units that don’t actually do anything or interfere with your system, give it a try. To create two targets, one with a dependency on the other, follow these steps:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Create a unit file named <span class="italic">test1.target</span> in <span class="italic">/etc/systemd/system</span>: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=test 1</span></blockquote></blockquote></blockquote></li><li value="2" class="calibre_81">Create a <span class="italic">test2.target</span> file with a dependency on <span class="italic">test1.target</span>: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=test 2<br class="calibre7" />Wants=test1.target</span></blockquote></blockquote></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre_13">The </span><span class="calibre3">Wants</span><span class="calibre_13"> keyword here defines a dependency that causes </span><span class="italic">test1.target</span><span class="calibre_13"> to activate when you activate </span><span class="italic">test2.target</span><span class="calibre_13">. Activate the </span><span class="italic">test2.target</span><span class="calibre_13"> unit to see it in action:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl start test2.target</span></span></blockquote></blockquote></blockquote></li><li value="3" class="calibre_81">Verify that both units are active: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl status test1.target test2.target</span></span><span class="calibre3"><br class="calibre7" />· test1.target - test 1 Loaded: loaded (/etc/systemd/system/test1.target; static; vendor preset: enabled) Active: active since Tue 2019-05-28 14:45:00 EDT; 16s ago<br class="calibre7" />May 28 14:45:00 duplex systemd[1]: Reached target test 1.<br class="calibre7" />· test2.target - test 2 Loaded: loaded (/etc/systemd/system/test2.target; static; vendor preset: enabled) Active: active since Tue 2019-05-28 14:45:00 EDT; 17s ago</span></blockquote></blockquote></blockquote></li><li value="4" class="calibre_81">If your unit file has an <span class="calibre3">[Install]</span> section, you need to “enable” the unit before activating it: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"># systemctl enable </span></span><span class="calibre3"><span class="italic"><span class="bold">unit</span></span></span></blockquote></blockquote></blockquote></li><a id="calibre_link-612"></a></ol><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">[Install]</span><span class="calibre_13"> section is another way to create a dependency. We’ll look at it (and dependencies as a whole) in more detail in </span>Section 6.3.6<span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">Removing Units from systemd</span></p><p class="calibre_25"><span class="calibre_13">To remove a unit, follow these steps:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Deactivate the unit if necessary: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl stop </span></span><span class="calibre3"><span class="italic"><span class="bold">unit</span></span></span></blockquote></blockquote></blockquote></li><li value="2" class="calibre_81">If the unit has an <span class="calibre3">[Install]</span> section, disable the unit to remove any symbolic links created by the dependency system: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl disable </span></span><span class="calibre3"><span class="italic"><span class="bold">unit</span></span></span></blockquote></blockquote></blockquote></li></ol><p class="calibre_30"><span class="calibre_13">You can then remove the unit file if you like.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Disabling a unit that is implicitly enabled (that is, does not have an </span></span><span class="calibre3">[Install]</span><span class="italic"><span class="calibre_13"> section) has no effect.</span></span></blockquote><p id="calibre_link-170" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">6.3.5 systemd Process Tracking and Synchronization</span></span></span></p><p class="calibre_45"><span class="calibre_13">systemd wants a reasonable amount of information and control over every process it starts. This has been difficult historically. A service can start in different ways; it could fork new instances of itself or even daemonize and detach itself from the original process. There’s also no telling how many subprocesses the server can spawn.</span></p><p class="calibre_27"><span class="calibre_13"> In order to manage activated units easily, systemd uses the previously mentioned cgroups, a Linux kernel feature that allows for finer tracking of a process hierarchy. The use of cgroups also helps minimize the work that a package developer or administrator needs to do in order to create a working unit file. In systemd, you don’t have to worry about accounting for every possible startup behavior; all you need to know is whether a service startup process forks. Use the </span><span class="calibre3">Type</span><span class="calibre_13"> option in your service unit file to indicate startup behavior. There are two basic startup styles:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Type=simple</span></span> The service process doesn’t fork and terminate; it remains the main service process.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">Type=forking</span></span> The service forks, and systemd expects the original service process to terminate. Upon this termination, systemd assumes the service is ready.</li></ol><p id="calibre_link-660" class="calibre_33"><span class="calibre_13">The </span><span class="calibre3">Type=simple</span><span class="calibre_13"> option doesn’t account for the fact that a service may take some time to initiate, and as a result systemd doesn’t know when to start any dependent units that absolutely require such a service to be ready. One way to deal with this is to use delayed startup (see </span>Section 6.3.7<span class="calibre_13">). However, some </span><span class="calibre3">Type</span><span class="calibre_13"> startup styles can indicate that the service itself will notify systemd when it’s ready:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Type=notify</span></span> When ready, the service sends a notification specific to systemd with a special function call.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">Type=dbus</span></span> When ready, the service registers itself on the D-Bus (Desktop Bus).</li></ol><p class="calibre_33"><span class="calibre_13"> Another service startup style is specified with </span><span class="calibre3">Type=oneshot</span><span class="calibre_13">; here the service process terminates completely with no child processes after starting. It’s like </span><span class="calibre3">Type=simple</span><span class="calibre_13">, except that systemd does not consider the service to be started until the service process terminates. Any strict dependencies (which you’ll see soon) will not start until that termination. A service using </span><span class="calibre3">Type=oneshot</span><span class="calibre_13"> also gets a default </span><span class="calibre3">RemainAfterExit=yes</span><span class="calibre_13"> directive so that systemd regards a service as active even after its processes terminate.</span></p><p class="calibre_27"><span class="calibre_13"> A final option is </span><span class="calibre3">Type=idle</span><span class="calibre_13">. This works like the </span><span class="calibre3">simple</span><span class="calibre_13"> style, but it instructs systemd not to start the service until all active jobs finish. The idea here is just to delay a service start until other services have started to keep services from stepping on one another’s output. Remember, once a service has started, the systemd job that started it terminates, so waiting for all other jobs to finish ensures that nothing else is starting.</span></p><p class="calibre_27"><span class="calibre_13"> If you’re interested in how cgroups work, we’ll explore them in more detail in </span>Section 8.6<span class="calibre_13">.</span></p><p id="calibre_link-171" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.6 systemd Dependencies</span></span></span></p><p class="calibre_45"><span class="calibre_13">A flexible system for boot-time and operational dependencies requires some degree of complexity, because overly strict rules can cause poor system performance and instability. For example, say you want to display a login prompt after starting a database server, so you define a strict dependency from the login prompt to the database server. This means if the database server fails, the login prompt will also fail, and you won’t even be able to log in to your machine to fix the issue!</span></p><p class="calibre_27"><span class="calibre_13"> Unix boot-time tasks are fairly fault tolerant and can often fail without causing serious problems for standard services. For example, if you removed a system’s data disk but left its </span><span class="italic">/etc/fstab</span><span class="calibre_13"> entry (or mount unit in systemd), the boot-time filesystem mount would fail. Though this failure might affect application servers (such as web servers), it typically wouldn’t affect standard system operation.</span></p><p class="calibre_27"><span class="calibre_13">To accommodate the need for flexibility and fault tolerance, systemd offers several dependency types and styles. Let’s first look at the basic types, labeled by their keyword syntax:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Requires  </span></span> Strict dependencies. When activating a unit with a <span class="calibre3">Requires</span> dependency unit, systemd attempts to activate the dependency unit. If the dependency unit fails, systemd also deactivates the dependent unit.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">Wants</span></span><span class="bold"> </span> Dependencies for activation only. Upon activating a unit, systemd activates the unit’s <span class="calibre3">Wants</span> dependencies, but it doesn’t care if those dependencies fail.</li><a id="calibre_link-864"></a><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">Requisite</span></span><span class="bold"> </span> Units that must already be active. Before activating a unit with a <span class="calibre3">Requisite</span> dependency, systemd first checks the status of the dependency. If the dependency hasn’t been activated, systemd fails on activation of the unit with the dependency.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">Conflicts</span></span><span class="bold"> </span> Negative dependencies. When activating a unit with a <span class="calibre3">Conflict</span> dependency, systemd automatically deactivates the opposing dependency if it’s active. Simultaneous activation of conflicting units fails.</li></ol><p class="calibre_33"><span class="calibre_13"> The </span><span class="calibre3">Wants</span><span class="calibre_13"> dependency type is especially significant because it doesn’t propagate failures to other units. The systemd.service(5) manual page states that this is how you should specify dependencies if possible, and it’s easy to see why. This behavior produces a much more robust system, giving you the benefit of a traditional init, where the failure of an earlier startup component doesn’t necessarily prohibit later components from starting.</span></p><p class="calibre_27"><span class="calibre_13"> You can view a unit’s dependencies with the </span><span class="calibre3">systemctl</span><span class="calibre_13"> command, as long as you specify a type of dependency, such as </span><span class="calibre3">Wants</span><span class="calibre_13"> or </span><span class="calibre3">Requires</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl show -p </span></span><span class="calibre3"><span class="italic"><span class="bold">type unit</span></span></span></blockquote></blockquote><p class="calibre_42"><span class="bold">Ordering</span></p><p class="calibre_25"><span class="calibre_13">So far, the dependency syntax you’ve seen hasn’t explicitly specified order. For example, activating most service units with </span><span class="calibre3">Requires</span><span class="calibre_13"> or </span><span class="calibre3">Wants</span><span class="calibre_13"> dependencies causes these units to start at the same time. This is optimal, because you want to start as many services as possible as quickly as possible to reduce boot time. However, there are situations when one unit must start after another. For instance, in the system that </span><a href="#calibre_link-510"><span class="italic"><span class="calibre_4">Figure 6-1</span></span></a><span class="calibre_13"> is based on, the </span><span class="italic">default.target</span><span class="calibre_13"> unit is set to start after </span><span class="italic">multi-user.target</span><span class="calibre_13"> (this order distinction is not shown in the figure).</span></p><p class="calibre_27"><span class="calibre_13">To activate units in a particular order, use the following dependency modifiers:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">Before</span></span><span class="bold"> </span> The current unit will activate before the listed unit(s). For example, if <span class="calibre3">Before=bar.target</span> appears in <span class="italic">foo.target</span>, systemd activates <span class="italic">foo.target</span> before <span class="italic">bar.target</span>.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">After</span></span><span class="bold"> </span> The current unit activates after the listed unit(s).</li></ol><p class="calibre_33"><span class="calibre_13">When you use ordering, systemd waits until a unit has an active status before activating its dependent units.</span></p><p class="calibre_46"><span class="bold">Default and Implicit Dependencies</span></p><p class="calibre_25"><span class="calibre_13">As you explore dependencies (especially with </span><span class="calibre3">systemd-analyze</span><span class="calibre_13">), you might start to notice that some units acquire dependencies that aren’t explicitly stated in unit files or other visible mechanisms. You’re most likely to encounter this in target units with </span><span class="calibre3">Wants</span><span class="calibre_13"> dependencies&mdash;you’ll find that systemd adds an </span><a id="calibre_link-866"></a><span class="calibre3">After</span><span class="calibre_13"> modifier alongside any unit listed as a </span><span class="calibre3">Wants</span><span class="calibre_13"> dependency. These additional dependencies are internal to systemd, calculated at boot time, and not stored in configuration files.</span></p><p class="calibre_27"><span class="calibre_13"> The added </span><span class="calibre3">After</span><span class="calibre_13"> modifier is called a </span><span class="italic">default dependency</span><span class="calibre_13">, an automatic addition to the unit configuration meant to avoid common mistakes and keep unit files small. These dependencies vary according to the type of unit. For example, systemd doesn’t add the same default dependencies for target units as it does for service units. These differences are listed in the DEFAULT DEPENDENCIES sections of the unit configuration manual pages, such as systemd.service(5) and systemd.target(5).</span></p><p class="calibre_27"><span class="calibre_13"> You can disable a default dependency in a unit by adding </span><span class="calibre3">DefaultDependencies=no</span><span class="calibre_13"> to its configuration file.</span></p><p class="calibre_46"><span class="bold">Conditional Dependencies</span></p><p class="calibre_25"><span class="calibre_13">You can use several</span><span class="italic"> conditional dependency </span><span class="calibre_13">parameters to test various operating system states rather than systemd units. For example:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">ConditionPathExists=p</span></span><span class="bold"> </span> True if the (file) path <span class="italic">p</span> exists in the system.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">ConditionPathIsDirectory=p</span></span><span class="bold"> </span> True if <span class="italic">p</span> is a directory.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">ConditionFileNotEmpty=p</span></span><span class="bold"> </span> True if <span class="italic">p</span> is a file and it’s not zero-length.</li></ol><p class="calibre_33"><span class="calibre_13">If a conditional dependency in a unit is false when systemd tries to activate the unit, the unit does not activate, although this applies only to the unit in which it appears. That is, if you activate a unit that has a conditional dependency and some unit dependencies, systemd attempts to activate those unit dependencies regardless of whether the condition is true or false.</span></p><p class="calibre_27"><span class="calibre_13"> Other dependencies are primarily variations on the preceding ones. For example, the </span><span class="calibre3">RequiresOverridable</span><span class="calibre_13"> dependency is just like </span><span class="calibre3">Requires</span><span class="calibre_13"> when running normally, but it acts like a </span><span class="calibre3">Wants</span><span class="calibre_13"> dependency if a unit is manually activated. For a full list, see the systemd.unit(5) manual page.</span></p><p class="calibre_46"><span class="bold">The [Install] Section and Enabling Units</span></p><p class="calibre_25"><span class="calibre_13">So far, we’ve been looking at how to define dependencies in a dependent unit’s configuration file. It’s also possible to do this “in reverse”&mdash;that is, by specifying the dependent unit in a dependency’s unit file. You can do this by adding a </span><span class="calibre3">WantedBy</span><span class="calibre_13"> or </span><span class="calibre3">RequiredBy</span><span class="calibre_13"> parameter in the </span><span class="calibre3">[Install]</span><span class="calibre_13"> section. This mechanism allows you to alter when a unit should start without modifying additional configuration files (for example, when you’d rather not edit a system unit file).</span></p><p class="calibre_27"><span class="calibre_13"> To see how this works, consider the example units back in </span>Section 6.3.4<span class="calibre_13">. We had two units, </span><span class="italic">test1.target</span><span class="calibre_13"> and </span><span class="italic">test2.target</span><span class="calibre_13">, with </span><span class="italic">test2.target</span><span class="calibre_13"> having a </span><span class="calibre3">Wants</span><span class="calibre_13"> dependency on </span><span class="italic">test1.target</span><span class="calibre_13">. We can change them so that </span><span class="italic">test1.target</span><span class="calibre_13"> looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=test 1<br class="calibre7" />[Install]<br class="calibre7" />WantedBy=test2.target</span></blockquote></blockquote><p id="calibre_link-868" class="calibre_30"><span class="calibre_13">And </span><span class="italic">test2.target</span><span class="calibre_13"> is as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=test 2</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Because you now have a unit with an </span><span class="calibre3">[Install]</span><span class="calibre_13"> section, you need to </span><span class="italic">enable</span><span class="calibre_13"> the unit with </span><span class="calibre3">systemctl</span><span class="calibre_13"> before you can start it. Here’s how that works with </span><span class="italic">test1.target</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl enable test1.target</span></span><span class="calibre3"><br class="calibre7" />Created symlink /etc/systemd/system/test2.target.wants/test1.target → /etc/systemd/system/test1.target.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice the output here&mdash;the effect of enabling a unit is to create a symbolic link in a </span><span class="italic">.wants</span><span class="calibre_13"> subdirectory corresponding to the dependent unit (</span><span class="italic">test2.target</span><span class="calibre_13"> in this case). You can now start both units at the same time with </span><span class="calibre3">systemctl start test2.target</span><span class="calibre_13"> because the dependency is in place.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Enabling a unit does not activate it.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> To disable the unit (and remove the symbolic link), use </span><span class="calibre3">systemctl</span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl disable test1.target</span></span><span class="calibre3"><br class="calibre7" />Removed /etc/systemd/system/test2.target.wants/test1.target.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The two units in this example also give you a chance to experiment with different startup scenarios. For example, see what happens when you try to start only </span><span class="italic">test1.target</span><span class="calibre_13">, or when you try to start </span><span class="italic">test2.target</span><span class="calibre_13"> without enabling </span><span class="italic">test1.target</span><span class="calibre_13">. Or, try changing </span><span class="calibre3">WantedBy</span><span class="calibre_13"> to </span><span class="calibre3">RequiredBy</span><span class="calibre_13">. (Remember, you can check the status of a unit with </span><span class="calibre3">systemctl status</span><span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13"> During normal operation, systemd ignores the </span><span class="calibre3">[Install]</span><span class="calibre_13"> section in a unit but notes its presence and, by default, considers the unit to be disabled. Enabling a unit survives reboots.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">[Install]</span><span class="calibre_13"> section is usually responsible for the </span><span class="italic">.wants</span><span class="calibre_13"> and </span><span class="italic">.requires</span><span class="calibre_13"> directories in the system configuration directory (</span><span class="italic">/etc/systemd/system</span><span class="calibre_13">). However, the unit configuration directory (</span><span class="italic">[/usr]/lib/systemd/system</span><span class="calibre_13">) also contains </span><span class="italic">.wants</span><span class="calibre_13"> directories, and you may also add links that don’t correspond to </span><span class="calibre3">[Install]</span><span class="calibre_13"> sections in the unit files. These manual additions are a simple way to add a dependency without modifying a unit file that may be overwritten in the future (by a software upgrade, for instance), but they’re not particularly encouraged because a manual addition is difficult to trace.</span></p><p id="calibre_link-172" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.7 systemd On-Demand and Resource-Parallelized Startup</span></span></span></p><p class="calibre_45"><span class="calibre_13">One of systemd’s features is the ability to delay a unit startup until it is absolutely needed. The setup typically works like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">You create a systemd unit (call it Unit A) for the system service you’d like to provide.</li><li value="2" class="calibre_8">You identify a system resource, such as a network port/socket, file, or device, that Unit A uses to offer its services.</li><a id="calibre_link-869"></a><li value="3" class="calibre_8">You create another systemd unit, Unit R, to represent that resource. These units are classified into types, such as socket units, path units, and device units.</li><li value="4" class="calibre_8">You define the relationship between Unit A and Unit R. Normally, this is implicit based on the units’ names, but it can also be explicit, as we’ll see shortly.</li></ol><p class="calibre_33"><span class="calibre_13">Once in place, the operation proceeds as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Upon activation of Unit R, systemd monitors the resource.</li><li value="2" class="calibre_8">When anything tries to access the resource, systemd blocks the resource, and the input to the resource is buffered.</li><li value="3" class="calibre_8">systemd activates Unit A.</li><li value="4" class="calibre_8">When ready, the service from Unit A takes control of the resource, reads the buffered input, and runs normally.</li></ol><p class="calibre_33"><span class="calibre_13">There are a few concerns here:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">You must make sure that your resource unit covers every resource that the service provides. This normally isn’t a problem, because most services have just one point of access.</li><li value="2" class="calibre_8">You need to make sure your resource unit is tied to the service unit that it represents. This can be implicit or explicit, and in some cases, many options represent different ways for systemd to perform the handoff to the service unit.</li><li value="3" class="calibre_8">Not all servers know how to interface with the resource units systemd can provide.</li></ul><p class="calibre_33"><span class="calibre_13">If you already know what traditional utilities like inetd, xinetd, and automount do, you’ll see many similarities. Indeed, the concept is nothing new; systemd even includes support for automount units.</span></p><p class="calibre_46"><span class="bold">An Example Socket Unit and Service</span></p><p class="calibre_25"><span class="calibre_13">Let’s look at an example, a simple network echo service. This is somewhat advanced material, and you might not fully understand it until you’ve read the discussion of TCP, ports, and listening in </span>Chapter 9<span class="calibre_13"> and sockets in </span>Chapter 10<span class="calibre_13">, but you should be able to get the basic idea.</span></p><p class="calibre_27"><span class="calibre_13"> The idea of an echo service is to repeat anything that a network client sends after connecting; ours will listen on TCP port 22222. We’ll start building it with a </span><span class="italic">socket unit</span><span class="calibre_13"> to represent the port, as shown in the following </span><span class="italic">echo.socket</span><span class="calibre_13"> unit file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=echo socket[Socket]<br class="calibre7" />ListenStream=22222<br class="calibre7" />Accept=true</span></blockquote><a id="calibre_link-870"></a></blockquote><p class="calibre_30"><span class="calibre_13">Note that there’s no mention of the service unit that this socket supports inside the unit file. So, what is that corresponding service unit file?</span></p><p class="calibre_27"><span class="calibre_13"> Its name is </span><span class="italic">echo@.service</span><span class="calibre_13">. The link is established by naming convention; if a service unit file has the same prefix as a </span><span class="italic">.socket</span><span class="calibre_13"> file (in this case, </span><span class="italic">echo</span><span class="calibre_13">), systemd knows to activate that service unit when there’s activity on the socket unit. In this case, systemd creates an instance of </span><span class="italic">echo@.service</span><span class="calibre_13"> when there’s activity on </span><span class="italic">echo.socket</span><span class="calibre_13">. Here’s the </span><span class="italic">echo@.service</span><span class="calibre_13"> unit file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=echo service<br class="calibre7" />[Service]<br class="calibre7" />ExecStart=/bin/cat<br class="calibre7" />StandardInput=socket</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you don’t like the implicit activation of units based on the prefixes, or you need to link units with different prefixes, you can use an explicit option in the unit defining your resource. For example, use </span></span><span class="calibre3">Socket=bar.socket</span><span class="italic"><span class="calibre_13"> inside </span></span>foo.service<span class="italic"><span class="calibre_13"> to have </span></span>bar.socket<span class="italic"><span class="calibre_13"> hand its socket to </span></span>foo.service<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> To get this example unit running, you need to start the </span><span class="italic">echo.socket</span><span class="calibre_13"> unit:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl start echo.socket</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Now you can test the service by connecting to your local TCP port 22222 with a utility such as </span><span class="calibre3">telnet</span><span class="calibre_13">. The service repeats what you enter; here’s an example interaction:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">telnet localhost 22222</span></span><span class="calibre3"><br class="calibre7" />Trying 127.0.0.1...<br class="calibre7" />Connected to localhost.<br class="calibre7" />Escape character is '^]'.</span><span class="calibre3"><span class="bold">Hi there.</span></span><span class="calibre3"><br class="calibre7" />Hi there.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When you’re bored with this and want to get back to your shell, press </span>CTRL<span class="calibre_13">-] on a line by itself and then press </span>CTRL<span class="calibre_13">-D. To stop the service, stop the socket unit like so:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl stop echo.socket</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="calibre3">telnet</span><span class="italic"><span class="calibre_13"> may not be installed by default on your distribution.</span></span></blockquote><p id="calibre_link-810" class="calibre_23"><span class="bold">Instances and Handoff</span></p><p class="calibre_25"><span class="calibre_13">Because the </span><span class="italic">echo@.service</span><span class="calibre_13"> unit supports multiple simultaneous instances, there’s an </span><span class="italic">@</span><span class="calibre_13"> in the name (recall that the </span><span class="italic">@</span><span class="calibre_13"> specifier signifies parameterization). Why would you want multiple instances? Say you have more than one network client connecting to the service at the same time, and you want each connection to have its own instance. In this case, the service unit </span><span class="italic">must</span><span class="calibre_13"> support multiple instances because we included the </span><span class="calibre3">Accept=true</span><span class="calibre_13"> option in </span><span class="italic">echo.socket</span><span class="calibre_13">. That option instructs systemd not only to listen on the port, but also to accept incoming connections on behalf of the service unit and pass it to them, creating a separate instance for each connection. Each instance reads data from the connection as standard input, but it doesn’t necessarily need to know that the data is coming from a network connection.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Most network connections require more flexibility than just a simple gateway to standard input and output, so don’t expect to be able to create complex network services with a service unit file like the </span></span>echo@.service<span class="italic"><span class="calibre_13"> unit file shown here.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> If a service unit can do the work of accepting a connection, don’t put an </span><span class="italic">@</span><span class="calibre_13"> in its unit filename, and don’t put </span><span class="calibre3">Accept=true</span><span class="calibre_13"> in the socket unit. In this case, the service unit takes complete control of the socket from systemd, which in turn does not attempt to listen on the network port again until the service unit finishes.</span></p><p class="calibre_27"><span class="calibre_13">The many different resources and options for handoff to service units make it difficult to provide a categorical summary. Not only that, but the documentation for the options is spread out over several manual pages. For the resource-oriented units, check systemd.socket(5), systemd.path(5), and systemd.device(5). One document that’s often overlooked for service units is systemd.exec(5), which contains information about how the service unit can expect to receive a resource upon activation.</span></p><p class="calibre_46"><span class="bold">Boot Optimization with Auxiliary Units</span></p><p class="calibre_25"><span class="calibre_13">An overall goal of systemd is to simplify dependency order and speed up boot time. Resource units such as socket units provide a way to do this that’s similar to on-demand startup. We’ll still have a service unit and an auxiliary unit representing the service unit’s offered resource, except that in this case, systemd starts the service unit as soon as it activates the auxiliary unit rather than waiting around for a request.</span></p><p class="calibre_27"><span class="calibre_13"> The reason for this scheme is that essential boot-time service units such as </span><span class="italic">systemd-journald.service</span><span class="calibre_13"> take some time to start, and many other units depend on them. However, systemd can offer the essential resource of a unit (such as a socket unit) very quickly, and then it can immediately activate not only the essential unit but also any units that depend on it. Once the essential unit is ready, it takes control of the resource.</span></p><p class="calibre_27"><a href="#calibre_link-511"><span class="italic"><span class="calibre_4">Figure 6-2</span></span></a><span class="calibre_13"> shows how this might work in a traditional sequential system. In this boot timeline, Service E provides an essential Resource R. Services A, B, and C depend on this resource (but not on each other) and must wait until Service E has started. Because the system will not start a new service until it’s done starting the preceding one, it takes quite a long time to get around to starting Service C.</span><a id="calibre_link-867"></a></p><p class="calibre_34"><img src="images/000033.jpg" class="calibre_83" />
</p><p id="calibre_link-511" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 6-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Sequential boot timeline with a resource dependency</span></span></span></p><p class="calibre_37"><a href="#calibre_link-512"><span class="italic"><span class="calibre_4">Figure 6-3</span></span></a><span class="calibre_13"> shows a possible equivalent systemd boot configuration. The services are represented by Units A, B, C, and E, with a new Unit R representing the resource that Unit E provides. Because systemd can provide an interface for Unit R while Unit E starts, Units A, B, C, and E can all be started at the same time. When ready, Unit E takes over for Unit R. An interesting point here is that Unit A, B, or C may not need to access the resource that Unit R provides before finishing startup. What we’re doing is providing them with the </span><span class="italic">option</span><span class="calibre_13"> to start accessing the resource as soon as possible.</span></p><p class="calibre_34"><img src="images/000030.jpg" class="calibre_84" />
</p><p id="calibre_link-512" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 6-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: systemd boot timeline with a resource unit</span></span></span></p><blockquote id="calibre_link-797" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> When you parallelize startup like this, there’s a chance that your system will slow down temporarily due to a large number of units starting at once.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">The takeaway is that, although you’re not creating an on-demand unit startup in this case, you’re using the same features that make on-demand startup possible. For common real-world examples, see the journald and D-Bus configuration units on a machine running systemd; they’re very likely to be parallelized in this way.</span></p><p id="calibre_link-173" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.3.8 systemd Auxiliary Components</span></span></span></p><p class="calibre_45"><span class="calibre_13">As systemd has grown in popularity, it has grown to include support for a few tasks not related to startup and service management, both directly and through auxiliary compatibility layers. You may notice the numerous programs in </span><span class="italic">/lib/systemd</span><span class="calibre_13">; these are the executables related to those functions.</span></p><p class="calibre_27"><span class="calibre_13">Here are a few specific system services:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">udevd</span> You learned about this in Chapter 3; it’s part of systemd.</li><li value="2" class="calibre_8"><span class="bold">journald</span> A logging service that handles a few different logging mechanisms, including the traditional Unix <span class="calibre3">syslog</span> service. You’ll read more about this in Chapter 7.</li><li value="3" class="calibre_8"><span class="bold">resolved</span> A name service caching daemon for DNS; you’ll learn about that in Chapter 9.</li></ol><p class="calibre_33"><span class="calibre_13"> All of the executables for these services are prefixed with </span><span class="calibre3">systemd-</span><span class="calibre_13">. For example, the systemd-integrated udevd is called </span><span class="calibre3">systemd-udevd</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If you dig deeper, you’ll find that some of these programs are relatively simple wrappers. Their function is to run standard system utilities and notify systemd of the results. One example is </span><span class="calibre3">systemd-fsck</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If you see a program in </span><span class="italic">/lib/systemd</span><span class="calibre_13"> that you can’t identify, check for a manual page. There’s a good chance that it will describe not only the utility but also the type of unit it’s meant to augment.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-174" class="calibre_23"><span class="calibre1"><span class="bold"> 6.4 System V Runlevels</span></span></p><p class="calibre_24"><span class="calibre_13">Now that you’ve learned about systemd and how it works, let’s shift gears and look at some aspects of the traditional System V init. At any given time on a Linux system, a certain base set of processes (such as crond and udevd) is running. In System V init, this state of the machine is called its </span><span class="italic">runlevel</span><span class="calibre_13">, which is denoted by a number from 0 through 6. A system spends most of its time in a single runlevel, but when you shut down the machine, init switches to a different runlevel in order to terminate the system services in an orderly fashion and tell the kernel to stop.</span></p><p class="calibre_27"><span class="calibre_13"> You can check your system’s runlevel with the </span><span class="calibre3">who -r</span><span class="calibre_13"> command like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">who -r</span></span><span class="calibre3"><br class="calibre7" />run-level 5&nbsp; 2019-01-27 16:43</span></blockquote></blockquote><p id="calibre_link-739" class="calibre_30"><span class="calibre_13">This output tells us that the current runlevel is 5, as well as the date and time that the runlevel was established.</span></p><p class="calibre_27"><span class="calibre_13">Runlevels serve various purposes, but the most common one is to distinguish between system startup, shutdown, single-user mode, and console mode states. For example, most systems traditionally used runlevels 2 through 4 for the text console; a runlevel of 5 means that the system starts a GUI login.</span></p><p class="calibre_27"><span class="calibre_13">But runlevels are becoming a thing of the past. Even though systemd supports them, it considers runlevels obsolete as end states for the system, preferring target units instead. To systemd, runlevels exist primarily to start services that support only the System V init scripts.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-175" class="calibre_23"><span class="calibre1"><span class="bold"> 6.5 System V init</span></span></p><p class="calibre_24"><span class="calibre_13">The System V init implementation is among the oldest used on Linux; its core idea is to support an orderly bootup to different runlevels with a carefully constructed startup sequence. System V init is now uncommon on most server and desktop installations, but you may encounter it in versions of RHEL prior to version 7.0, as well as in embedded Linux environments, such as routers and phones. In addition, some older packages may only provide startup scripts designed for System V init; systemd can handle those with a compatibility mode that we’ll discuss in </span>Section 6.5.5<span class="calibre_13">. We’ll look at the basics here, but keep in mind that you might not actually encounter anything covered in this section.</span></p><p class="calibre_27"><span class="calibre_13"> A typical System V init installation has two components: a central configuration file and a large set of boot scripts augmented by a symbolic link farm. The configuration file </span><span class="italic">/etc/inittab</span><span class="calibre_13"> is where it all starts. If you have System V init, look for a line like the following in your </span><span class="italic">inittab</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">id:5:initdefault:</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This indicates that the default runlevel is 5.</span></p><p class="calibre_27"><span class="calibre_13"> All lines in </span><span class="italic">inittab</span><span class="calibre_13"> take the following form, with four fields separated by colons in this order:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">A unique identifier (a short string, such as <span class="calibre3">id</span> in the previous example).</li><li value="2" class="calibre_8">The applicable runlevel number(s).</li><li value="3" class="calibre_8">The action that init should take (default runlevel to 5 in the previous example).</li><li value="4" class="calibre_8">A command to execute (optional).</li></ol><p class="calibre_33"><span class="calibre_13"> To see how commands work in an </span><span class="italic">inittab</span><span class="calibre_13"> file, consider this line:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">l5:5:wait:/etc/rc.d/rc 5</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This particular line is important because it triggers most of the system configuration and services. Here, the </span><span class="calibre3">wait</span><span class="calibre_13"> action determines when and how System V init runs the command: run </span><span class="calibre3">/etc/rc.d/rc 5</span><span class="calibre_13"> once when entering runlevel 5 and then wait for this command to finish before doing anything else. The </span><a id="calibre_link-740"></a><span class="calibre3">rc 5</span><span class="calibre_13"> command executes anything in </span><span class="italic">/etc/rc5.d</span><span class="calibre_13"> that starts with a number (in numeric order). We’ll cover this in more detail shortly.</span></p><p class="calibre_27"><span class="calibre_13"> The following are some of the most common </span><span class="italic">inittab</span><span class="calibre_13"> actions in addition to </span><span class="calibre3">initdefault</span><span class="calibre_13"> and </span><span class="calibre3">wait</span><span class="calibre_13">:</span></p><p class="calibre_63"><span class="calibre3"><span class="bold">respawn</span></span>
</p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The <span class="calibre3">respawn</span> action tells init to run the command that follows and, if the command finishes executing, to run it again. You’re likely to see something like this in an <span class="italic">inittab</span> file: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">1:2345:respawn:/sbin/mingetty tty1</span></blockquote></blockquote></blockquote></li><li value="2" class="calibre_81"> The <span class="calibre3">getty</span> programs provide login prompts. The preceding line is used for the first virtual console (<span class="italic">/dev/tty1</span>), which is the one you see when you press ALT-F1 or CTRL-ALT-F1 (see Section 3.4.7). The <span class="calibre3">respawn</span> action brings the login prompt back after you log out.</li></ol><p class="calibre_85"><span class="calibre3"><span class="bold">ctrlaltdel</span></span>
</p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The <span class="calibre3">ctrlaltdel</span> action controls what the system does when you press CTRL-ALT-DEL on a virtual console. On most systems, this is some sort of reboot command using the <span class="calibre3">shutdown</span> command (discussed in Section 6.6).</li></ol><p class="calibre_85"><span class="calibre3"><span class="bold">sysinit</span></span>
</p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The <span class="calibre3">sysinit</span> action is the first thing that init should run when starting, before entering any runlevels. <blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> For more available actions, see the inittab(5) manual page.</span></span></blockquote></blockquote></li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-176" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">6.5.1 System V init: Startup Command Sequence</span></span></span></p><p class="calibre_45"><span class="calibre_13">Now let’s look at how System V init starts system services, just before it lets you log in. Recall this </span><span class="italic">inittab</span><span class="calibre_13"> line from earlier:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">l5:5:wait:/etc/rc.d/rc 5</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This short line triggers many other programs. In fact, </span><span class="calibre3">rc</span><span class="calibre_13"> stands for </span><span class="italic">run commands</span><span class="calibre_13">, which many people refer to as </span><span class="italic">scripts</span><span class="calibre_13">, </span><span class="italic">programs</span><span class="calibre_13">, or </span><span class="italic">services</span><span class="calibre_13">. But where are these commands?</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">5</span><span class="calibre_13"> in this line tells us that we’re talking about runlevel 5. The commands are probably in either </span><span class="italic">/etc/rc.d/rc5.d</span><span class="calibre_13"> or </span><span class="italic">/etc/rc5.d</span><span class="calibre_13">. (Runlevel 1 uses </span><span class="italic">rc1.d</span><span class="calibre_13">, runlevel 2 uses </span><span class="italic">rc2.d</span><span class="calibre_13">, and so on.) For example, you might find the following items in the </span><span class="italic">rc5.d</span><span class="calibre_13"> directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">S10sysklogd&nbsp;&nbsp;&nbsp;&nbsp; S20ppp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S99gpm<br class="calibre7" />S12kerneld&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S25netstd_nfs&nbsp;&nbsp; S99httpd<br class="calibre7" />S15netstd_init&nbsp; S30netstd_misc&nbsp; S99rmnologinS18netbase&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S45pcmcia&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S99sshd<br class="calibre7" />S20acct&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S89atd <br class="calibre7" />S20logoutd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S89cron </span></blockquote><a id="calibre_link-738"></a></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">rc 5</span><span class="calibre_13"> command starts programs in the </span><span class="italic">rc5.d</span><span class="calibre_13"> directory by executing the following commands in this sequence:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">S10sysklogd start<br class="calibre7" />S12kerneld start<br class="calibre7" />S15netstd_init start<br class="calibre7" />S18netbase start<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />S99sshd start</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice the </span><span class="calibre3">start</span><span class="calibre_13"> argument in each command. The capital </span><span class="italic">S</span><span class="calibre_13"> in a command name means that the command should run in </span><span class="italic">start</span><span class="calibre_13"> mode, and the number (00 through 99) determines where in the sequence </span><span class="calibre3">rc</span><span class="calibre_13"> starts the command. The </span><span class="italic">rc*.d</span><span class="calibre_13"> commands are usually shell scripts that start programs in </span><span class="italic">/sbin</span><span class="calibre_13"> or </span><span class="italic">/usr/sbin</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Normally, you can figure out what a particular command does by viewing the script with </span><span class="calibre3">less</span><span class="calibre_13"> or another pager program.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Some </span></span>rc*.d<span class="italic"><span class="calibre_13"> directories contain commands that start with </span></span>K<span class="italic"><span class="calibre_13"> (for “kill,” or stop mode). In this case, </span></span><span class="calibre3">rc</span><span class="italic"><span class="calibre_13"> runs the command with the </span></span><span class="calibre3">stop</span><span class="italic"><span class="calibre_13"> argument instead of </span></span><span class="calibre3">start</span><span class="italic"><span class="calibre_13">. You’ll most likely encounter </span></span><span class="calibre3">K</span><span class="italic"><span class="calibre_13"> commands in runlevels that shut down the system.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You can run these commands by hand; however, normally you’ll want to do so through the </span><span class="italic">init.d</span><span class="calibre_13"> directory instead of the </span><span class="italic">rc*.d</span><span class="calibre_13"> directories, which we’ll look at next.</span></p><p id="calibre_link-177" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.5.2 The System V init Link Farm</span></span></span></p><p class="calibre_45"><span class="calibre_13">The contents of the </span><span class="italic">rc*.d</span><span class="calibre_13"> directories are actually symbolic links to files in yet another directory, </span><span class="italic">init.d</span><span class="calibre_13">. If your goal is to interact with, add, delete, or modify services in the </span><span class="italic">rc*.d</span><span class="calibre_13"> directories, you need to understand these symbolic links. A long listing of a directory such as </span><span class="italic">rc5.d</span><span class="calibre_13"> reveals a structure like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">lrwxrwxrwx . . . S10sysklogd -&gt; ../init.d/sysklogd<br class="calibre7" />lrwxrwxrwx . . . S12kerneld -&gt; ../init.d/kerneld<br class="calibre7" />lrwxrwxrwx . . . S15netstd_init -&gt; ../init.d/netstd_init<br class="calibre7" />lrwxrwxrwx . . . S18netbase -&gt; ../init.d/netbase<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />lrwxrwxrwx . . . S99httpd -&gt; ../init.d/httpd<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A large number of symbolic links across several subdirectories like this is called a </span><span class="italic">link farm</span><span class="calibre_13">. Linux distributions contain these links so that they can use the same startup scripts for all runlevels. This is a convention, not a requirement, but it simplifies organization.</span></p><p id="calibre_link-857" class="calibre_46"><span class="bold">Starting and Stopping Services</span></p><p class="calibre_25"><span class="calibre_13">To start and stop services by hand, use the script in the </span><span class="italic">init.d</span><span class="calibre_13"> directory. For example, one way to start the httpd web server program manually is to run </span><span class="calibre3">init.d/httpd start</span><span class="calibre_13">. Similarly, to kill a running service, you can use the </span><span class="calibre3">stop</span><span class="calibre_13"> argument (</span><span class="calibre3">httpd stop</span><span class="calibre_13">, for instance).</span></p><p class="calibre_46"><span class="bold">Modifying the Boot Sequence</span></p><p class="calibre_25"><span class="calibre_13">Changing the boot sequence in System V init is normally done by modifying the link farm. The most common change is to prevent one of the commands in the </span><span class="italic">init.d</span><span class="calibre_13"> directory from running in a particular runlevel. You have to be careful about how you do this, however. For example, you might consider removing the symbolic link in the appropriate </span><span class="italic">rc*.d</span><span class="calibre_13"> directory. But if you ever need to put the link back, you might have trouble remembering its exact name. One of the best approaches is to add an underscore (</span><span class="calibre3">_</span><span class="calibre_13">) at the beginning of the link name, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mv S99httpd _S99httpd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This change causes </span><span class="calibre3">rc</span><span class="calibre_13"> to ignore </span><span class="italic">_S99httpd</span><span class="calibre_13"> because the filename no longer starts with </span><span class="italic">S</span><span class="calibre_13"> or </span><span class="italic">K</span><span class="calibre_13">, but the original name still indicates its purpose.</span></p><p class="calibre_27"><span class="calibre_13"> To add a service, create a script like those in the </span><span class="italic">init.d</span><span class="calibre_13"> directory and then create a symbolic link in the correct </span><span class="italic">rc*.d</span><span class="calibre_13"> directory. The easiest way to do this is to copy and modify one of the scripts already in </span><span class="italic">init.d</span><span class="calibre_13"> that you understand (see </span>Chapter 11<span class="calibre_13"> for more information on shell scripts).</span></p><p class="calibre_27"><span class="calibre_13">When adding a service, choose an appropriate place in the boot sequence to start it. If the service starts too soon, it may not work due to a dependency on some other service. For nonessential services, most systems administrators prefer numbers in the 90s, which puts the services after most of the services that came with the system.</span></p><p id="calibre_link-178" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.5.3 run-parts</span></span></span></p><p class="calibre_45"><span class="calibre_13">The mechanism that System V init uses to run the </span><span class="italic">init.d</span><span class="calibre_13"> scripts has found its way into many Linux systems, regardless of whether they use System V init. It’s a utility called </span><span class="calibre3">run-parts</span><span class="calibre_13">, and the only thing it does is run a bunch of executable programs in a given directory, in some kind of predictable order. You can think of </span><span class="calibre3">run-parts</span><span class="calibre_13"> as almost like a person who enters the </span><span class="calibre3">ls</span><span class="calibre_13"> command in some directory and then just runs whatever programs are listed in the output.</span></p><p class="calibre_27"><span class="calibre_13"> The default behavior is to run all programs in a directory, but you often have the option to select certain programs and ignore others. In some distributions, you don’t need much control over the programs that run. For example, Fedora ships with a very simple </span><span class="calibre3">run-parts</span><span class="calibre_13"> utility.</span></p><p class="calibre_27"><span class="calibre_13"> Other distributions, such as Debian and Ubuntu, have a more complicated </span><span class="calibre3">run-parts</span><span class="calibre_13"> program. Their features include the ability to run programs based on a regular expression (for example, using the </span><span class="calibre3">S[0-9]{2}</span><span class="calibre_13"> expression for running all “start” scripts in an </span><a id="calibre_link-746"></a><span class="italic">/etc/init.d </span><span class="calibre_13">runlevel</span><span class="italic">
</span><span class="calibre_13">directory) and to pass arguments to the programs. These capabilities allow you to start and stop System V runlevels with a single command.</span></p><p class="calibre_27"><span class="calibre_13"> You don’t really need to understand the details of how to use </span><span class="calibre3">run-parts</span><span class="calibre_13">; in fact, most people don’t know that it even exists. The main things to remember are that it shows up in scripts from time to time and that it exists solely to run the programs in a given directory.</span></p><p id="calibre_link-179" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.5.4 System V init Control</span></span></span></p><p class="calibre_45"><span class="calibre_13">Occasionally, you’ll need to give init a little kick to tell it to switch runlevels, to reread its configuration, or to shut down the system. To control System V init, you use </span><span class="calibre3">telinit</span><span class="calibre_13">. For example, to switch to runlevel 3, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">telinit 3</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When switching runlevels, init tries to kill off any processes not in the </span><span class="italic">inittab</span><span class="calibre_13"> file for the new runlevel, so be careful when changing runlevels.</span></p><p class="calibre_27"><span class="calibre_13"> When you need to add or remove jobs, or make any other change to the </span><span class="italic">inittab</span><span class="calibre_13"> file, you must tell init about the change and have it reload the file. The </span><span class="calibre3">telinit</span><span class="calibre_13"> command for this is:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">telinit q</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also use </span><span class="calibre3">telinit s</span><span class="calibre_13"> to switch to single-user mode.</span></p><p id="calibre_link-180" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">6.5.5 systemd System V Compatibility</span></span></span></p><p class="calibre_45"><span class="calibre_13">One feature that sets systemd apart from other newer-generation init systems is that it tries to do a more complete job of tracking services started by System V&ndash;compatible init scripts. It works like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">First, systemd activates <span class="italic">runlevel&lt;N&gt;.target</span>, where <span class="italic">N</span> is the runlevel.</li><li value="2" class="calibre_8">For each symbolic link in <span class="italic">/etc/rc&lt;N&gt;.d</span>, systemd identifies the script in <span class="italic">/etc/init.d</span>.</li><li value="3" class="calibre_8">systemd associates the script name with a service unit (for example, <span class="italic">/etc/init.d/foo</span> would be <span class="italic">foo.service</span>).</li><li value="4" class="calibre_8">systemd activates the service unit and runs the script with either a <span class="calibre3">start</span> or <span class="calibre3">stop</span> argument, based on its name in <span class="italic">rc&lt;N&gt;.d</span>.</li><li value="5" class="calibre_8">systemd attempts to associate any processes from the script with the service unit.</li></ol><p class="calibre_33"><span class="calibre_13"> Because systemd makes the association with a service unit name, you can use </span><span class="calibre3">systemctl</span><span class="calibre_13"> to restart the service or view its status. But don’t expect any miracles from System V compatibility mode; it still must run the init scripts serially, for example.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-181" class="calibre_23"><span class="calibre1"><span class="bold">6.6 Shutting Down Your System</span></span></p><p class="calibre_24"><span class="calibre_13">init controls how the system shuts down and reboots. The commands to shut down the system are the same regardless of which version of init you run. The proper way to shut down a Linux machine is to use the </span><span class="calibre3">shutdown</span><span class="calibre_13"> command.</span></p><p class="calibre_27"><span class="calibre_13"> There are two basic ways to use </span><span class="calibre3">shutdown</span><span class="calibre_13">. If you </span><span class="italic">halt</span><span class="calibre_13"> the system, it shuts the machine down and keeps it down. To make the machine halt immediately, run this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">shutdown -h now</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On most machines and versions of Linux, a halt cuts the power to the machine. You can also </span><span class="italic">reboot</span><span class="calibre_13"> the machine. For a reboot, use </span><span class="calibre3">-r</span><span class="calibre_13"> instead of </span><span class="calibre3">-h</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">The shutdown process takes several seconds. You should avoid resetting or powering off a machine during a shutdown.</span></p><p class="calibre_27"><span class="calibre_13"> In the preceding example, </span><span class="calibre3">now</span><span class="calibre_13"> is the time to shut down. Including a time argument is mandatory, but there are many ways to specify it. For example, if you want the machine to shut down sometime in the future, you can use </span><span class="calibre3">+</span><span class="calibre3"><span class="italic">n</span></span><span class="calibre_13">, where </span><span class="calibre3"><span class="italic">n</span></span><span class="calibre_13"> is the number of minutes </span><span class="calibre3">shutdown</span><span class="calibre_13"> should wait before proceeding. See the shutdown(8) manual page for other options.</span></p><p class="calibre_27"><span class="calibre_13">To make the system reboot in 10 minutes, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">shutdown -r +10</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On Linux, </span><span class="calibre3">shutdown</span><span class="calibre_13"> notifies anyone logged on that the machine is going down, but it does little real work. If you specify a time other than </span><span class="calibre3">now</span><span class="calibre_13">, the </span><span class="calibre3">shutdown</span><span class="calibre_13"> command creates a file called </span><span class="italic">/etc/nologin</span><span class="calibre_13">. When this file is present, the system prohibits logins by anyone except the superuser.</span></p><p class="calibre_27"><span class="calibre_13"> When the system shutdown time finally arrives, </span><span class="calibre3">shutdown</span><span class="calibre_13"> tells init to begin the shutdown process. On systemd, this means activating the shutdown units, and on System V init, it means changing the runlevel to 0 (halt) or 6 (reboot). Regardless of the init implementation or configuration, the procedure generally goes like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">init asks every process to shut down cleanly.</li><li value="2" class="calibre_8">If a process doesn’t respond after a while, init kills it, first trying a TERM signal.</li><li value="3" class="calibre_8">If the TERM signal doesn’t work, init uses the KILL signal on any stragglers.</li><li value="4" class="calibre_8">The system locks system files into place and makes other preparations for shutdown.</li><li value="5" class="calibre_8">The system unmounts all filesystems other than the root.</li><li value="6" class="calibre_8">The system remounts the root filesystem read-only.</li><li value="7" class="calibre_8">The final step is to tell the kernel to reboot or stop with the <span class="calibre3">reboot(2)</span> system call. This can be done by init or an auxiliary program, such as <span class="calibre3">reboot</span>, <span class="calibre3">halt</span>, or <span class="calibre3">poweroff</span>.</li><a id="calibre_link-789"></a></ol><p class="calibre_33"><span class="calibre_13"> The </span><span class="calibre3">reboot</span><span class="calibre_13"> and </span><span class="calibre3">halt</span><span class="calibre_13"> programs behave differently depending on how they’re called, which may cause confusion. By default, these programs call </span><span class="calibre3">shutdown</span><span class="calibre_13"> with the </span><span class="calibre3">-r</span><span class="calibre_13"> or </span><span class="calibre3">-h</span><span class="calibre_13"> options. However, if the system is already at a halt or reboot runlevel, the programs tell the kernel to shut itself off immediately. If you really want to shut down your machine in a hurry, regardless of any potential damage from a disorderly shutdown, use the </span><span class="calibre3">-f</span><span class="calibre_13"> (force) option.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-182" class="calibre_23"><span class="calibre1"><span class="bold"> 6.7 The Initial RAM Filesystem</span></span></p><p class="calibre_24"><span class="calibre_13">The Linux boot process is, for the most part, fairly straightforward. However, one component has always been somewhat confounding: </span><span class="italic">initramfs</span><span class="calibre_13">, or the </span><span class="italic">initial RAM filesystem</span><span class="calibre_13">. Think of it as a little user-space wedge that goes in front of the normal user mode start. But first, let’s talk about why it exists.</span></p><p class="calibre_27"><span class="calibre_13">The problem stems from the availability of many different kinds of storage hardware. Remember, the Linux kernel does not talk to the PC BIOS interface or EFI to get data from disks, so in order to mount its root filesystem, it needs driver support for the underlying storage mechanism. For example, if the root is on a RAID array connected to a third-party controller, the kernel needs the driver for that controller first. Unfortunately, there are so many storage controller drivers that distributions can’t include all of them in their kernels, so many drivers are shipped as loadable modules. But loadable modules are files, and if your kernel doesn’t have a filesystem mounted in the first place, it can’t load the driver modules that it needs.</span></p><p class="calibre_27"><span class="calibre_13"> The workaround is to gather a small collection of kernel driver modules along with a few other utilities into an archive. The boot loader loads this archive into memory before running the kernel. Upon start, the kernel reads the contents of the archive into a temporary RAM filesystem (the initramfs), mounts it at </span><span class="italic">/</span><span class="calibre_13">, and performs the user-mode handoff to the init on the initramfs. Then, the utilities included in the initramfs allow the kernel to load the necessary driver modules for the real root filesystem. Finally, the utilities mount the real root filesystem and start the true init.</span></p><p class="calibre_27"><span class="calibre_13">Implementations vary and are ever-evolving. On some distributions, the init on the initramfs is a fairly simple shell script that starts a udevd to load drivers, and then mounts the real root and executes the init there. On distributions that use systemd, you’ll typically see an entire systemd installation there with no unit configuration files and just a few udevd configuration files.</span></p><p class="calibre_27"><span class="calibre_13"> One basic characteristic of the initial RAM filesystem that has (so far) remained unchanged since its inception is the ability to bypass it if you don’t need it. That is, if your kernel has all the drivers it needs to mount your root filesystem, you can omit the initial RAM filesystem in your boot loader configuration. When successful, eliminating the initial RAM filesystem slightly shortens boot time. Try it yourself at boot time by using the GRUB menu editor to remove the </span><a id="calibre_link-648"></a><span class="calibre3">initrd</span><span class="calibre_13"> line. (It’s best not to experiment by changing the GRUB configuration file, as you can make a mistake that will be difficult to repair.) It has gradually become a little more difficult to bypass the initial RAM filesystem because features such as mount-by-UUID may not be available with generic distribution kernels.</span></p><p class="calibre_27"><span class="calibre_13"> You can check the contents of your initial RAM filesystem, but you’ll need to do a little bit of detective work. Most systems now use archives created by </span><span class="calibre3">mkinitramfs</span><span class="calibre_13"> that you can unpack with </span><span class="calibre3">unmkinitramfs</span><span class="calibre_13">. Others might be older compressed </span><span class="calibre3">cpio</span><span class="calibre_13"> archives (see the cpio(1) manual page).</span></p><p class="calibre_27"><span class="calibre_13">One particular piece of interest is the “pivot” near the very end of the init process on the initial RAM filesystem. This part is responsible for removing the contents of the temporary filesystem (to save memory) and permanently switch to the real root.</span></p><p class="calibre_27"><span class="calibre_13"> You won’t typically create your own initial RAM filesystem, as it’s a painstaking process. There are a number of utilities for creating initial RAM filesystem images, and your distribution likely comes with one. Two of the most common are </span><span class="calibre3">mkinitramfs</span><span class="calibre_13"> and </span><span class="calibre3">dracut</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The term </span></span>initial RAM filesystem<span class="italic"><span class="calibre_13">
</span></span>(initramfs) <span class="italic"><span class="calibre_13">refers to the implementation that uses the </span></span><span class="calibre3">cpio</span><span class="italic"><span class="calibre_13"> archive as the source of the temporary filesystem. There’s an older version called the </span></span>initial RAM disk<span class="italic"><span class="calibre_13">, or </span></span>initrd<span class="italic"><span class="calibre_13">, that uses a disk image as the basis of the temporary filesystem. This has fallen into disuse because it’s much easier to maintain a </span></span><span class="calibre3">cpio</span><span class="italic"><span class="calibre_13"> archive. However, you’ll often see the term </span></span>initrd<span class="italic"><span class="calibre_13"> used to refer to a </span></span><span class="calibre3">cpio</span><span class="italic"><span class="calibre_13">-based initial RAM filesystem. Often, the filenames and configuration files still contain </span></span>initrd<span class="italic"><span class="calibre_13">.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-183" class="calibre_42"><span class="calibre1"><span class="bold"> 6.8 Emergency Booting and Single-User Mode</span></span></p><p class="calibre_24"><span class="calibre_13">When something goes wrong with the system, your first recourse is usually to boot the system with a distribution’s “live” image or with a dedicated rescue image, such as SystemRescueCD, that you can put on removable media. A live image is simply a Linux system that can boot and run without an installation process; most distributions’ installation images double as live images. Common tasks for fixing a system include the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Checking filesystems after a system crash.</li><li value="2" class="calibre_8">Resetting a forgotten password.</li><li value="3" class="calibre_8"> Fixing problems in critical files, such as <span class="italic">/etc/fstab</span> and <span class="italic">/etc/passwd.</span></li><li value="4" class="calibre_8">Restoring from backups after a system crash.</li></ul><p class="calibre_33"><span class="calibre_13"> Another option for booting quickly to a usable state is </span><span class="italic">single-user mode</span><span class="calibre_13">. The idea is that the system quickly boots to a root shell instead of going through the whole mess of services. In the System V init, single-user mode is usually runlevel 1. In systemd, it’s represented by </span><span class="italic">rescue.target</span><span class="calibre_13">. You normally enter the mode with the </span><span class="calibre3">-s</span><span class="calibre_13"> parameter to the boot loader. You may need to type the root password to enter single-user mode.</span></p><p id="calibre_link-854" class="calibre_27"><span class="calibre_13">The biggest problem with single-user mode is that it doesn’t offer many amenities. The network almost certainly won’t be available (and if it is, it will be hard to use), you won’t have a GUI, and your terminal may not even work correctly. For this reason, live images are nearly always considered preferable.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-184" class="calibre_23"><span class="calibre1"><span class="bold"> 6.9 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">You’ve now seen the kernel and user-space startup phases of a Linux system, and how systemd tracks services once they’ve started. Next we’ll go a little deeper into user space. There are two areas to explore, starting with a number of system configuration files that all Linux programs use when interacting with certain elements of user space. Then we’ll see essential services that systemd starts.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-185" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-733" class="calibre_10"><span class="calibre4"><span class="bold">7</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">SYSTEM CONFIGURATION: LOGGING, SYSTEM TIME, BATCH JOBS, AND USERS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">When you first look in the </span></span><span class="calibre1"><span class="italic">/etc</span></span><span class="calibre1"><span class="calibre_13"> directory to explore your system’s configuration, you might feel a bit overwhelmed. The good news is that although most of the files you see affect a system’s operations to some extent, only a few are fundamental.</span></span></p><p class="calibre_33"><span class="calibre_13"> This chapter covers the parts of the system that make the infrastructure discussed in </span>Chapter 4<span class="calibre_13"> available to the user-space software that we normally interact with, such as the tools covered in </span>Chapter 2<span class="calibre_13">. In particular, we’ll look at the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">System logging</li><li value="2" class="calibre_8">Configuration files that the system libraries access to get server and user information</li><li value="3" class="calibre_8">A few selected server programs (sometimes called <span class="italic">daemons</span>) that run when the system boots</li><a id="calibre_link-811"></a><li value="4" class="calibre_8">Configuration utilities that can be used to tweak the server programs and configuration files</li><li value="5" class="calibre_8">Time configuration</li><li value="6" class="calibre_8">Periodic task scheduling</li></ul><p class="calibre_33"><span class="calibre_13">The widespread use of systemd has reduced the number of basic, independent daemons found on a typical Linux system. One example is the system logging (syslogd) daemon, whose functionality is now largely provided by a daemon built into systemd (journald). Still, a few traditional daemons remain, such as crond and atd.</span></p><p class="calibre_27"><span class="calibre_13"> As in previous chapters, this chapter includes virtually no networking material because the network is a separate building block of the system. In </span>Chapter 9<span class="calibre_13">, you’ll see where the network fits in.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-186" class="calibre_23"><span class="calibre1"><span class="bold"> 7.1 System Logging</span></span></p><p class="calibre_24"><span class="calibre_13">Most system programs write their diagnostic output as messages to the </span><span class="italic">syslog</span><span class="calibre_13"> service. The traditional syslogd daemon performs this service by waiting for messages and, upon receiving one, sending it to an appropriate channel, such as a file or a database. On most contemporary systems, journald (which comes with systemd) does most of the work. Though we’ll concentrate on journald in this book, we’ll also cover many aspects of the traditional syslog.</span></p><p class="calibre_27"><span class="calibre_13"> The system logger is one of the most important parts of the system. When something goes wrong and you don’t know where to start, it’s always wise to check the log. If you have journald, you’ll do this with the </span><span class="calibre3">journalctl</span><span class="calibre_13"> command, which we’ll cover in </span>Section 7.1.2<span class="calibre_13">. On older systems, you’ll need to check the files themselves. In either case, log messages look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Aug 19 17:59:48 duplex sshd[484]: Server listening on 0.0.0.0 port 22.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A log message typically contains important information such as the process name, process ID, and timestamp. There can also be two other fields: the </span><span class="italic">facility</span><span class="calibre_13"> (a general category) and </span><span class="italic">severity</span><span class="calibre_13"> (how urgent the message is). We’ll discuss those in more detail later.</span></p><p class="calibre_27"><span class="calibre_13">Understanding logging in a Linux system can be somewhat challenging due to varied combinations of older and newer software components. Some distributions, such as Fedora, have moved to a journald-only default, while others run a version of the older syslogd (such as rsyslogd) alongside journald. Older distributions and some specialized systems may not use systemd at all and have only one of the syslogd versions. In addition, some software systems bypass standardized logging altogether and write their own.</span></p><p id="calibre_link-187" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.1.1 Checking Your Log Setup</span></span></span></p><p class="calibre_45"><span class="calibre_13">You should inspect your own system to see what sort of logging is installed. Here’s how:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Check for journald, which you almost certainly have if you’re running systemd. Although you can look for journald in a process listing, the easiest way is to simply run <span class="calibre3">journalctl</span>. If journald is active on your system, you’ll get a paged list of log messages.</li><li value="2" class="calibre_8">Check for rsyslogd. Look for rsyslogd in a process listing, and look for <span class="italic">/etc/rsyslog.conf</span>.</li><li value="3" class="calibre_8">If you don’t have rsyslogd, check for syslog-ng (another version of syslogd) by looking for a directory called <span class="italic">/etc/syslog-ng</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> Continue your tour by looking in </span><span class="italic">/var/log</span><span class="calibre_13"> for logfiles. If you have a version of syslogd, this directory should contain many files, most created by your syslog daemon. However, there will be a few files here that are maintained by other services; two examples are </span><span class="italic">wtmp</span><span class="calibre_13"> and </span><span class="italic">lastlog</span><span class="calibre_13">, the logfiles that utilities such as </span><span class="calibre3">last</span><span class="calibre_13"> and </span><span class="calibre3">lastlog</span><span class="calibre_13"> access in order to get login records.</span></p><p class="calibre_27"><span class="calibre_13"> In addition, there may be further subdirectories in </span><span class="italic">/var/log</span><span class="calibre_13"> containing logs. These nearly always come from other services. One of them, </span><span class="italic">/var/log/journal</span><span class="calibre_13">, is where journald stores its (binary) logfiles.</span></p><p id="calibre_link-188" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.1.2 Searching and Monitoring Logs</span></span></span></p><p class="calibre_45"><span class="calibre_13">Unless you have a system without journald or you’re searching a logfile maintained by some other utility, you’ll look through the journal. With no arguments, the </span><span class="calibre3">journalctl</span><span class="calibre_13"> access tool is like a fire hose, giving you all of the messages in the journal, starting with the oldest (just as they would appear in a logfile). Mercifully, </span><span class="calibre3">journalctl</span><span class="calibre_13"> defaults to using a pager such as </span><span class="calibre3">less</span><span class="calibre_13"> to display messages so your terminal won’t be flooded. You can search messages with the pager and reverse the message time order with </span><span class="calibre3">journalctl -r</span><span class="calibre_13">, but there are much better ways of finding logs.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> To get full access to the journal messages, you need to run </span></span><span class="calibre3">journalctl</span><span class="italic"><span class="calibre_13"> either as root or as a user belonging to the adm or systemd-journal groups. The default user on most distributions has access.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> In general, you can search individual fields of journals just by adding them to the command line; for example, run </span><span class="calibre3">journalctl _PID=8792</span><span class="calibre_13"> to search for messages from process ID 8792. However, the most powerful filtering features are more general in nature. You can specify one or more if you need multiple criteria.</span></p><p class="calibre_46"><span class="bold">Filtering by Time</span></p><p class="calibre_25"><span class="calibre_13">The </span><span class="calibre3">-S</span><span class="calibre_13"> (since) option is among the most useful in narrowing in on a specific time. Here’s an example of one of the easiest and most effective ways to use it:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -S -4h</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The </span><span class="calibre3">-4h</span><span class="calibre_13"> part of this command may look like an option, but in reality, it’s a time specification telling </span><span class="calibre3">journalctl</span><span class="calibre_13"> to search for messages from the past four hours in your current time zone. You can also use a combination of a specific day and/or time:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -S 06:00:00</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">journalctl -S 2020-01-14</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">journalctl -S '2020-01-14 14:30:00'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">-U</span><span class="calibre_13"> (until) option works the same way, specifying a time up to which </span><span class="calibre3">journalctl</span><span class="calibre_13"> should retrieve messages. However, it’s often not as useful because you’ll typically page or search through messages until you find what you need, then just quit.</span></p><p class="calibre_46"><span class="bold">Filtering by Unit</span></p><p class="calibre_25"><span class="calibre_13">Another quick and effective way to get at relevant logs is to filter by systemd unit. You can do this with the </span><span class="calibre3">-u</span><span class="calibre_13"> option, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -u cron.service</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can normally omit the unit type (</span><span class="calibre3">.service</span><span class="calibre_13"> in this case) when filtering by unit.</span></p><p class="calibre_27"><span class="calibre_13">If you don’t know the name of a particular unit, try this command to list all units in the journal:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -F _SYSTEMD_UNIT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">-F</span><span class="calibre_13"> option shows all values in the journal for a particular field.</span></p><p class="calibre_46"><span class="bold">Finding Fields</span></p><p class="calibre_25"><span class="calibre_13">Sometimes you just need to know which field to search. You can list all available fields as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -N</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Any field beginning with an underscore (such as </span><span class="calibre3">_SYSTEMD_UNIT</span><span class="calibre_13"> from the previous example) is a trusted field; the client that sends a message cannot alter these fields.</span></p><p class="calibre_46"><span class="bold">Filtering by Text</span></p><p class="calibre_25"><span class="calibre_13">A classic method of searching logfiles is to run </span><span class="calibre3">grep</span><span class="calibre_13"> over all of them, hoping to find a relevant line or spot in a file where there might be more information. Similarly, you can search journal messages by regular expression with the </span><span class="calibre3">-g</span><span class="calibre_13"> option, as in this example, which will return messages containing </span><span class="calibre3">kernel </span><span class="calibre_13">followed somewhere by </span><span class="calibre3">memory</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ journalctl -g 'kernel.*memory'</span></blockquote></blockquote><p id="calibre_link-591" class="calibre_30"><span class="calibre_13">Unfortunately, when you search the journal this way, you get </span><span class="italic">only</span><span class="calibre_13"> the messages that match the expression. Often, important information might be nearby in terms of time. Try to pick out the timestamp from a match, and then run </span><span class="calibre3">journalctl -S</span><span class="calibre_13"> with a time just before to see what messages came around the same time.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">-g</span><span class="italic"><span class="calibre_13"> option requires a build of </span></span><span class="calibre3">journalctl</span><span class="italic"><span class="calibre_13"> with a particular library. Some distributions do not include a version that supports </span></span><span class="calibre3">-g</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_23"><span class="bold">Filtering by Boot</span></p><p class="calibre_25"><span class="calibre_13">Often, you’ll find yourself looking through the logs for messages around the time when a machine booted or just before it went down (and rebooted). It’s very easy to get the messages from just one boot, from when the machine started until it stopped. For example, if you’re looking for the start of the current boot, just use the </span><span class="calibre3">-b</span><span class="calibre_13"> option:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -b</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also add an offset; for example, to start at the previous boot, use an offset of </span><span class="calibre3">-1</span><span class="calibre_13">.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ j</span><span class="calibre3"><span class="bold">ournalctl -b -1</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can quickly check whether the machine shut down cleanly on the last cycle by combining the </span></span><span class="calibre3">-b</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">-r</span><span class="italic"><span class="calibre_13"> (reverse) options. Try it; if the output looks like the example here, the shutdown was clean:</span></span></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3">journalctl -r -b -1</span><span class="calibre3"><br class="calibre7" />-- Logs begin at Wed 2019-04-03 12:29:31 EDT, end at Fri 2019-08-02 19:10:14 EDT. --<br class="calibre7" />Jul 18 12:19:52 mymachine systemd-journald[602]: Journal stopped<br class="calibre7" />Jul 18 12:19:52 mymachine systemd-shutdown[1]: Sending SIGTERM to remaining processes...<br class="calibre7" />Jul 18 12:19:51 mymachine systemd-shutdown[1]: Syncing filesystems and block devices.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Instead of an offset like </span><span class="calibre3">-1</span><span class="calibre_13">, you can also view boots by IDs. Run the following to get the boot IDs:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl --list-boots</span></span><span class="calibre3"><br class="calibre7" />-1 e598bd09e5c046838012ba61075dccbb Fri 2019-03-22 17:20:01 EDT&mdash;Fri 2019-04-12 08:13:52 EDT 0 5696e69b1c0b42d58b9c57c31d8c89cc Fri 2019-04-12 08:15:39 EDT&mdash;Fri 2019-08-02 19:17:01 EDT</span></blockquote></blockquote><p id="calibre_link-592" class="calibre_30"><span class="calibre_13">Finally, you can display kernel messages (with or without selecting a particular boot) with </span><span class="calibre3">journalctl -k</span><span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">Filtering by Severity/Priority</span></p><p class="calibre_25"><span class="calibre_13">Some programs produce a large number of diagnostic messages that can obscure important logs. You can filter by the severity level by specifying a value between 0 (most important) and 7 (least important) alongside the </span><span class="calibre3">-p</span><span class="calibre_13"> option. For example, to get the logs from levels 0 through 3, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -p 3</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you want only the logs from a specific set of severity levels, use the </span><span class="calibre3">..</span><span class="calibre_13"> range syntax:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -p 2..3</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Filtering by severity sounds like it may save a lot of time, but you might not find much use for it. Most applications don’t generate large amounts of informational data by default, though some include configuration options to enable more verbose logging.</span></p><p class="calibre_46"><span class="bold">Simple Log Monitoring</span></p><p class="calibre_25"><span class="calibre_13">One traditional way to monitor logs is to use </span><span class="calibre3">tail -f</span><span class="calibre_13"> or the </span><span class="calibre3">less</span><span class="calibre_13"> follow mode (</span><span class="calibre3">less +F</span><span class="calibre_13">) on a logfile to see messages as they arrive from the system logger. This isn’t a very effective regular system monitoring practice (it’s too easy to miss something), but it’s useful for examining a service when you’re trying to find a problem, or get a closer look at startup and operation in real time.</span></p><p class="calibre_27"><span class="calibre_13"> Using </span><span class="calibre3">tail -f</span><span class="calibre_13"> doesn’t work with journald because it doesn’t use plaintext files; instead, you can use the </span><span class="calibre3">-f</span><span class="calibre_13"> option to </span><span class="calibre3">journalctl</span><span class="calibre_13"> to produce the same effect of printing logs as they arrive:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">journalctl -f</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This simple invocation is good enough for most needs. However, you may want to add some of the preceding filtering options if your system has a fairly constant stream of log messages not related to what you’re looking for.</span></p><p id="calibre_link-189" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.1.3 Logfile Rotation</span></span></span></p><p class="calibre_45"><span class="calibre_13">When you’re using a syslog daemon, any log message that your system records goes into a logfile somewhere, which means you need to delete old messages occasionally so that they don’t eventually consume all of your storage space. Different distributions do this in different ways, but most use the </span><span class="calibre3">logrotate</span><span class="calibre_13"> utility.</span></p><p class="calibre_27"><span class="calibre_13"> The mechanism is called </span><span class="italic">log rotation</span><span class="calibre_13">. Because a traditional text logfile contains the oldest messages at the beginning and the newest at the end, it’s quite difficult to remove just the older messages from a file to free up some space. Instead, a log maintained by </span><span class="calibre3">logrotate</span><span class="calibre_13"> is divided into many chunks.</span></p><p id="calibre_link-812" class="calibre_27"><span class="calibre_13">Say you have a logfile called </span><span class="italic">auth.log</span><span class="calibre_13"> in </span><span class="italic">/var/log</span><span class="calibre_13"> containing the most recent log messages. Then there’s an </span><span class="italic">auth.log.1</span><span class="calibre_13">, </span><span class="italic">auth.log.2</span><span class="calibre_13">, and </span><span class="italic">auth.log.3</span><span class="calibre_13">, each with progressively older data. When </span><span class="calibre3">logrotate</span><span class="calibre_13"> decides that it’s time to delete some old data, it “rotates” the files like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Removes the oldest file, <span class="italic">auth.log.3</span>.</li><li value="2" class="calibre_8">Renames <span class="italic">auth.log.2</span> to <span class="italic">auth.log.3</span>.</li><li value="3" class="calibre_8">Renames <span class="italic">auth.log.1</span> to <span class="italic">auth.log.2</span>.</li><li value="4" class="calibre_8">Renames <span class="italic">auth.log</span> to <span class="italic">auth.log.1</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> The names and some details vary across distributions. For example, the Ubuntu configuration specifies that </span><span class="calibre3">logrotate</span><span class="calibre_13"> should compress the file that’s moved from the “1” position to the “2” position, so in the previous example, you would have </span><span class="italic">auth.log.2.gz</span><span class="calibre_13"> and </span><span class="italic">auth.log.3.gz</span><span class="calibre_13">. In other distributions, </span><span class="calibre3">logrotate</span><span class="calibre_13"> renames the logfiles with a date suffix, such as </span><span class="italic">-20200529</span><span class="calibre_13">. One advantage of this scheme is that it’s easier to find a logfile from a specific time.</span></p><p class="calibre_27"><span class="calibre_13"> You might be wondering what happens if </span><span class="calibre3">logrotate</span><span class="calibre_13"> performs a rotation around the same time that another utility (such as rsyslogd) wants to add to the logfile. For example, say the logging program opens the logfile for writing but doesn’t close it before </span><span class="calibre3">logrotate</span><span class="calibre_13"> performs the rename. In this somewhat unusual scenario, the log message would be written successfully, because in Linux, once a file is open, the I/O system has no way to know it was renamed. But note that the file the message appears in will be the file with the new name, such as </span><span class="italic">auth.log.1</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If </span><span class="calibre3">logrotate</span><span class="calibre_13"> has already renamed the file before the logging program attempts to open it, the </span><span class="calibre3">open()</span><span class="calibre_13"> system call creates a new logfile (such as </span><span class="italic">auth.log</span><span class="calibre_13">), just as it would if </span><span class="calibre3">logrotate</span><span class="calibre_13"> weren’t running.</span></p><p id="calibre_link-190" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.1.4 Journal Maintenance</span></span></span></p><p class="calibre_45"><span class="calibre_13">The journals stored in </span><span class="italic">/var/log/journal</span><span class="calibre_13"> don’t need rotation, because journald itself can identify and remove old messages. Unlike traditional log management, journald normally decides to delete messages based on how much space is left on the journal’s filesystem, how much space the journal should take as a percentage of the filesystem, and what the maximum journal size is set to. There are other options for log management, such as the maximum allowed age of a log message. You’ll find a description of the defaults as well as the other settings in the journald.conf(5) manual page.</span></p><p id="calibre_link-191" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.1.5 A Closer Look at System Logging</span></span></span></p><p class="calibre_45"><span class="calibre_13">Now that you’ve seen some of the operational details of syslog and the journal, it’s time to step back a bit and look at the reasons why and how logging works the way it does. This discussion is more theoretical than hands-on; you can skip to the next topic in the book without a problem.</span></p><p class="calibre_27"><span class="calibre_13"> In the 1980s, a gap was starting to emerge: Unix servers needed a way to record diagnostic information, but there was no standard for doing so. When syslog appeared with the sendmail email server, it made enough sense that developers of other services readily adopted it. RFC 3164 describes the evolution of syslog.</span><a id="calibre_link-823"></a></p><p class="calibre_27"><span class="calibre_13"> The mechanism is fairly simple. A traditional syslogd listens and waits for messages on Unix domain socket </span><span class="italic">/dev/log</span><span class="calibre_13">. One additional powerful feature of syslogd is the ability to listen on a network socket in addition to </span><span class="italic">/dev/log</span><span class="calibre_13">, enabling client machines to send messages across a network.</span></p><p class="calibre_27"><span class="calibre_13">This makes it possible to consolidate all syslog messages from an entire network onto one logging server, and for this reason, syslog became very popular with network administrators. Many network devices, such as routers and embedded devices, can act as syslog clients, sending their diagnostic messages to a server.</span></p><p class="calibre_27"><span class="calibre_13">Syslog has a classic client-server architecture, including its own protocol (currently defined in RFC 5424). However, the protocol wasn’t always standard, and earlier versions didn’t accommodate much structure beyond some basics. Programmers using syslog were expected to come up with a descriptive, yet clear and brief, log message format for their own applications. Over time, the protocol added new features while still trying to maintain as much backward compatibility as possible.</span></p><p class="calibre_46"><span class="bold">Facility, Severity, and Other Fields</span></p><p class="calibre_25"><span class="calibre_13">Because syslog sends messages of various types from different services to different destinations, it needs a way to classify each message. The traditional method is to use encoded values of facility and severity that were usually (but not always) included in a message. In addition to file output, even very old versions of syslogd were capable of sending important messages to consoles and directly to particular logged-in users based on the messages’ facility and severity&mdash;an early tool for system monitoring.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">facility</span><span class="calibre_13"> is a general category of service, identifying what sent the message. Facilities include services and system components such as kernel, mail system, and printer.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">severity</span><span class="calibre_13"> is the urgency of the log message. There are eight levels, numbered 0 through 7. They’re usually referred to by name, although the names aren’t very consistent and have varied across implementations:</span><span class="calibre3">
</span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">0: emerg&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">4: warning&nbsp;</span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">1: alert&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">5: notice&nbsp;</span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">2: crit&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">6: info&nbsp;</span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">3: err&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">7: debug&nbsp;</span>
</td></tr></table><p class="calibre_27"><span class="calibre_13"> The facility and severity together make up the </span><span class="italic">priority</span><span class="calibre_13">, packaged as one number in the syslog protocol. You can read all about these fields in RFC 5424, learn how to specify them in applications in the syslog(3) manual page, and learn how to match them in the rsyslog.conf(5) manual page. However, you might run into some confusion when translating them to the journald world, where the severity is referred to as the priority (for example, when you run </span><a id="calibre_link-808"></a><span class="calibre3">journalctl -o json</span><span class="calibre_13"> to get machine-readable log output).</span></p><p class="calibre_27"><span class="calibre_13">Unfortunately, when you start to examine the details of the priority part of the protocol, you’ll find that it hasn’t kept pace with changes and requirements in the rest of the OS. The severity definition still holds up well, but the available facilities are hardwired and include seldom-used services such as UUCP, with no way to define new ones (only a number of generic local0 through local7 slots).</span></p><p class="calibre_27"><span class="calibre_13"> We’ve already talked about some of the other fields in log data, but RFC 5424 also includes a provision for </span><span class="italic">structured data</span><span class="calibre_13">, sets of arbitrary key-value pairs that application programmers can use to define their own fields. Though these can be used with journald with some extra work, it’s much more common to send them to other kinds of databases.</span></p><p class="calibre_46"><span class="bold">The Relationship Between Syslog and journald</span></p><p class="calibre_25"><span class="calibre_13">The fact that journald has completely displaced syslog on some systems might have you asking why syslog remains on others. There are two main reasons:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Syslog has a well-defined means of aggregating logs across many machines. It is much easier to monitor logs when they are on just one machine.</li><li value="2" class="calibre_8">Versions of syslog such as rsyslogd are modular and capable of output to many different formats and databases (including the journal format). This makes it easier to connect them to analysis and monitoring tools.</li></ul><p class="calibre_33"><span class="calibre_13">By contrast, journald emphasizes collecting and organizing the log output of a single machine into a single format.</span></p><p class="calibre_27"><span class="calibre_13">When you want to do something more complicated, journald’s capability of feeding its logs into a different logger offers a high degree of versatility. This is especially true when you consider that systemd can collect the output of server units and send them to journald, giving you access to even more log data than what applications send to syslog.</span></p><p class="calibre_46"><span class="bold">Final Notes on Logging</span></p><p class="calibre_25"><span class="calibre_13">Logging on Linux systems has changed significantly during its history, and it’s a near-certainty that it will continue to evolve. At the moment, the process of collecting, storing, and retrieving logs on a single machine is well defined, but there are other aspects of logging that aren’t standardized.</span></p><p class="calibre_27"><span class="calibre_13">First, there’s a dizzying array of options available when you want to aggregate and store logs over a network of machines. Instead of a centralized log server simply storing logs in text files, the logs can now go into databases, and often the centralized server itself is replaced by an internet service.</span></p><p id="calibre_link-734" class="calibre_27"><span class="calibre_13">Next, the nature of how logs are consumed has changed. At one time, logs were not considered to be “real” data; their primary purpose was a resource that the (human) administrator could read when something went wrong. However, as applications have become more complex, logging needs have grown. These new requirements include the capability to search, extract, display, and analyze the data inside the logs. Although we have many ways of storing logs in databases, tools to use the logs in applications are still in their infancy.</span></p><p class="calibre_27"><span class="calibre_13"> Finally, there’s the matter of ensuring that the logs are trustworthy. The original syslog had no authentication to speak of; you simply trusted that whatever application and/or machine sending the log was telling the truth. In addition, the logs were not encrypted, making them vulnerable to snooping on the network. This was a serious risk in networks that required high security. Contemporary syslog servers have standard methods of encrypting a log message and authenticating the machine where it originates. However, when you get down to individual applications, the picture becomes less clear. For example, how can you be sure that the thing that calls itself your web server actually </span><span class="italic">is</span><span class="calibre_13"> the web server?</span></p><p class="calibre_27"><span class="calibre_13">We’ll explore a few somewhat advanced authentication topics later in the chapter. But for now, let’s move on to the basics of how configuration files are organized on the system.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-192" class="calibre_23"><span class="calibre1"><span class="bold"> 7.2 The Structure of /etc</span></span></p><p class="calibre_24"><span class="calibre_13">Most system configuration files on a Linux system are found in </span><span class="italic">/etc</span><span class="calibre_13">. Historically, each program or system service had one or more configuration files there, and due to the large number of components on a Unix system, </span><span class="italic">/etc</span><span class="calibre_13"> would accumulate files quickly.</span></p><p class="calibre_27"><span class="calibre_13"> There were two problems with this approach: it was hard to find particular configuration files on a running system, and it was difficult to maintain a system configured this way. For example, if you wanted to change the </span><span class="calibre3">sudo</span><span class="calibre_13"> configuration, you’d have to edit </span><span class="italic">/etc/sudoers</span><span class="calibre_13">. But after your change, an upgrade to your distribution could wipe out your customizations because it would overwrite everything in </span><span class="italic">/etc</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The trend for many years has been to place system configuration files into subdirectories under </span><span class="italic">/etc</span><span class="calibre_13">, as you’ve already seen for systemd, which uses </span><span class="italic">/etc/systemd</span><span class="calibre_13">. There are still a few individual configuration files in </span><span class="italic">/etc</span><span class="calibre_13">, but if you run </span><span class="calibre3">ls</span><span class="calibre_13">
</span><span class="calibre3">-F</span><span class="calibre_13">
</span><span class="calibre3">/etc</span><span class="calibre_13">, you’ll see that most of the items there are now subdirectories.</span></p><p class="calibre_27"><span class="calibre_13"> To solve the problem of overwriting configuration files, you can now place customizations in separate files in the configuration subdirectories, such as the ones in </span><span class="italic">/etc/grub.d</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> What kind of configuration files are found in </span><span class="italic">/etc</span><span class="calibre_13">? The basic guideline is that customizable configurations for a single machine, such as user information (</span><span class="italic">/etc/passwd</span><span class="calibre_13">) and network details (</span><span class="italic">/etc/network</span><span class="calibre_13">), go into </span><span class="italic">/etc</span><span class="calibre_13">. However, general application details, such as a distribution’s defaults for a user interface, don’t belong in </span><a id="calibre_link-735"></a><span class="italic">/etc</span><span class="calibre_13">. System default configuration files not meant to be customized also are usually found elsewhere, as with the prepackaged systemd unit files in </span><span class="italic">/usr/lib/systemd</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">You’ve already seen some of the configuration files that pertain to booting. Let’s continue by looking at how users are configured on a system.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-193" class="calibre_23"><span class="calibre1"><span class="bold"> 7.3 User Management Files</span></span></p><p class="calibre_24"><span class="calibre_13">Unix systems allow for multiple independent users. At the kernel level, users are simply numbers (user IDs), but because it’s much easier to remember a name than a number, you’ll normally work instead with </span><span class="italic">usernames </span><span class="calibre_13">(or </span><span class="italic">login names</span><span class="calibre_13">) when managing Linux. Usernames exist only in user space, so any program that works with a username needs to find its corresponding user ID when talking to the kernel.</span></p><p id="calibre_link-194" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.3.1 The /etc/passwd File</span></span></span></p><p class="calibre_45"><span class="calibre_13">The plaintext file </span><span class="italic">/etc/passwd</span><span class="calibre_13"> maps usernames to user IDs. It looks like </span><a></a><a href="#calibre_link-513"><span class="italic"><span class="calibre_4">Listing 7-1</span></span></a><span class="calibre_13">.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root:x:0:0:Superuser:/root:/bin/sh<br class="calibre7" />daemon:*:1:1:daemon:/usr/sbin:/bin/sh<br class="calibre7" />bin:*:2:2:bin:/bin:/bin/sh<br class="calibre7" />sys:*:3:3:sys:/dev:/bin/sh<br class="calibre7" />nobody:*:65534:65534:nobody:/home:/bin/false<br class="calibre7" />juser:x:3119:1000:J. Random User:/home/juser:/bin/bash<br class="calibre7" />beazley:x:143:1000:David Beazley:/home/beazley:/bin/bash</span></blockquote></blockquote><blockquote id="calibre_link-513" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 7-1</span></span><span class="italic"><span class="calibre_13">: A list of users in </span></span>/etc/passwd</blockquote><p class="calibre_37"><span class="calibre_13">Each line represents one user and has seven fields separated by colons. The first is the username.</span></p><p class="calibre_27"><span class="calibre_13"> Following this is the user’s encrypted password, or at least what was once the field for the password. On most Linux systems, the password is no longer actually stored in the </span><span class="italic">passwd</span><span class="calibre_13"> file, but rather in the </span><span class="italic">shadow</span><span class="calibre_13"> file (see </span>Section 7.3.3<span class="calibre_13">). The </span><span class="italic">shadow</span><span class="calibre_13"> file format is similar to that of </span><span class="italic">passwd</span><span class="calibre_13">, but normal users don’t have read permission for </span><span class="italic">shadow</span><span class="calibre_13">. The second field in </span><span class="italic">passwd</span><span class="calibre_13"> or </span><span class="italic">shadow</span><span class="calibre_13"> is the encrypted password, and it looks like a bunch of unreadable garbage, such as </span><span class="calibre3">d1CVEWiB/oppc</span><span class="calibre_13">. Unix passwords are never stored as clear text; in fact, the field is not the password itself, but a derivation of it. In most cases, it’s exceptionally difficult to get the original password from this field (assuming that the password is not easy to guess).</span></p><p class="calibre_27"><span class="calibre_13"> An </span><span class="calibre3">x</span><span class="calibre_13"> in the second </span><span class="italic">passwd</span><span class="calibre_13"> file field indicates that the encrypted password is stored in the </span><span class="italic">shadow</span><span class="calibre_13"> file (which should be configured on your system). An asterisk (</span><span class="calibre3">*</span><span class="calibre_13">) indicates that the user cannot log in.</span></p><p class="calibre_27"><span class="calibre_13"> If this password field is blank (that is, you see two colons in a row, like </span><span class="calibre3">::</span><span class="calibre_13">), no password is required to log in. Beware of blank passwords like this. You should never have a user able to log in without a password.</span></p><p id="calibre_link-779" class="calibre_27"><span class="calibre_13">The remaining </span><span class="italic">passwd</span><span class="calibre_13"> fields are as follows:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The <span class="italic">user ID</span>
<span class="italic">(UID)</span>, which is the user’s representation in the kernel. You can have two entries with the same user ID, but this will confuse you&mdash;and possibly your software as well&mdash;so keep the user ID unique.</li><li value="2" class="calibre_8"> The <span class="italic">group ID</span>
<span class="italic">(GID)</span>, which should be one of the numbered entries in the <span class="italic">/etc/group</span> file. Groups determine file permissions and little else. This group is also called the user’s <span class="italic">primary group</span>.</li><li value="3" class="calibre_8"> The user’s real name (often called the <span class="italic">GECOS</span> field). You’ll sometimes find commas in this field, denoting room and telephone numbers.</li><li value="4" class="calibre_8">The user’s home directory.</li><li value="5" class="calibre_8">The user’s shell (the program that runs when the user runs a terminal session).</li></ul><p class="calibre_33"><a href="#calibre_link-514"><span class="italic"><span class="calibre_4">Figure 7-1</span></span></a><span class="calibre_13"> identifies the various fields in one of the entries in </span><a href="#calibre_link-513"><span class="italic"><span class="calibre_4">Listing 7-1</span></span></a><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000024.jpg" class="calibre_86" />
</p><p id="calibre_link-514" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 7-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: An entry in the password file</span></span></span></p><p class="calibre_37"><span class="calibre_13"> The </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file syntax is fairly strict, allowing for no comments or blank lines.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A user in </span></span>/etc/passwd<span class="italic"><span class="calibre_13"> and a corresponding home directory are collectively known as an </span></span>account<span class="italic"><span class="calibre_13">. However, remember that this is a user-space convention. An entry in the </span></span>passwd<span class="italic"><span class="calibre_13"> file is usually enough to qualify; the home directory doesn’t have to exist in order for most programs to recognize an account. Furthermore, there are ways to add users on a system without explicitly including them in the </span></span>passwd<span class="italic"><span class="calibre_13"> file; for example, adding users from a network server using something like NIS (Network Information Service) or LDAP (Lightweight Directory Access Protocol) was once common.</span></span></blockquote><p id="calibre_link-195" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">7.3.2 Special Users</span></span></span></p><p class="calibre_45"><span class="calibre_13">You’ll find a few special users in </span><span class="italic">/etc/passwd</span><span class="calibre_13">. The </span><span class="italic">superuser</span><span class="calibre_13"> (root) always has UID 0 and GID 0, as in </span><a href="#calibre_link-513"><span class="italic"><span class="calibre_4">Listing 7-1</span></span></a><span class="calibre_13">. Some users, such as daemon, have no login privileges. The nobody user is an underprivileged user; some processes run as nobody because it cannot (normally) write to anything on the system.</span></p><p id="calibre_link-744" class="calibre_27"><span class="calibre_13">Users that cannot log in are called </span><span class="italic">pseudo-users</span><span class="calibre_13">. Although they can’t log in, the system can start processes with their user IDs. Pseudo-users such as nobody are usually created for security reasons.</span></p><p class="calibre_27"><span class="calibre_13">Again, these are all user-space conventions. These users have no special meaning to the kernel; the only user ID that means anything special to the kernel is the superuser’s, 0. It’s possible to give the nobody user access to everything on the system just as you would with any other user.</span></p><p id="calibre_link-196" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.3.3 The /etc/shadow File</span></span></span></p><p class="calibre_45"><span class="calibre_13">The shadow password file (</span><span class="italic">/etc/shadow</span><span class="calibre_13">) on a Linux system normally contains user authentication information, including the encrypted passwords and password expiration information that correspond to the users in </span><span class="italic">/etc/passwd</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">shadow</span><span class="calibre_13"> file was introduced to provide a more flexible (and perhaps more secure) way of storing passwords. It included a suite of libraries and utilities, many of which were soon replaced by pieces of PAM (Pluggable Authentication Modules; we’ll cover this advanced topic in </span>Section 7.10<span class="calibre_13">). Rather than introduce an entirely new set of files for Linux, PAM uses </span><span class="italic">/etc/shadow</span><span class="calibre_13">, but not certain corresponding configuration files such as </span><span class="italic">/etc/login.defs</span><span class="calibre_13">.</span></p><p id="calibre_link-197" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.3.4 Manipulating Users and Passwords</span></span></span></p><p class="calibre_45"><span class="calibre_13">Regular users interact with </span><span class="italic">/etc/passwd</span><span class="calibre_13"> using the </span><span class="calibre3">passwd</span><span class="calibre_13"> command and a few other tools. Use </span><span class="calibre3">passwd</span><span class="calibre_13"> to change your password. You can use </span><span class="calibre3">chfn</span><span class="calibre_13"> and </span><span class="calibre3">chsh</span><span class="calibre_13"> to change the real name and shell, respectively (the shell must be listed in </span><span class="italic">/etc/shells</span><span class="calibre_13">). These are all suid-root executables, because only the superuser can change the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file.</span></p><p class="calibre_46"><span class="bold">Changing /etc/passwd as the Superuser</span></p><p class="calibre_25"><span class="calibre_13">Because </span><span class="italic">/etc/passwd</span><span class="calibre_13"> is just a normal plaintext file, the superuser is technically allowed to use any text editor to make changes. To add a user, it’s possible to simply add an appropriate line and create a home directory for the user; to delete, you can do the opposite.</span></p><p class="calibre_27"><span class="calibre_13"> However, directly editing </span><span class="italic">passwd</span><span class="calibre_13"> like this is a bad idea. Not only is it too easy to make a mistake, but you can also get caught with a concurrency problem if something else is making </span><span class="italic">passwd</span><span class="calibre_13"> changes at the same time. It’s much easier (and safer) to make changes to users using separate commands available from the terminal or through the GUI. For example, to set a user’s password, run </span><span class="calibre3">passwd </span><span class="calibre3"><span class="italic">user</span></span><span class="calibre_13"> as the superuser. Use </span><span class="calibre3">adduser</span><span class="calibre_13"> and </span><span class="calibre3">userdel</span><span class="calibre_13"> to add and remove users, respectively.</span></p><p class="calibre_27"><span class="calibre_13"> However, if you really must edit the file directly (for example, if it’s somehow corrupted), use the </span><span class="calibre3">vipw</span><span class="calibre_13"> program, which backs up and locks </span><span class="italic">/etc/passwd</span><span class="calibre_13"> while you’re editing it as an added precaution. To edit </span><span class="italic">/etc/shadow</span><span class="calibre_13"> instead of </span><span class="italic">/etc/passwd</span><span class="calibre_13">, use </span><span class="calibre3">vipw -s</span><span class="calibre_13">. (Hopefully, you’ll never need to do either of these.)</span></p><p id="calibre_link-198" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.3.5 Working with Groups</span></span></span></p><p class="calibre_45"><span class="italic">Groups</span><span class="calibre_13"> in Unix offer a way to share files among certain users. The idea is that you can set read or write permission bits for a particular group, excluding everyone else. This feature was once important because many users shared one machine or network, but it’s become less significant in recent years as workstations are shared less often.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">/etc/group</span><span class="calibre_13"> file defines the group IDs (such as the ones found in the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file). </span><a></a><a href="#calibre_link-515"><span class="italic"><span class="calibre_4">Listing 7-2</span></span></a><span class="calibre_13"> is an example.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root:*:0:juser<br class="calibre7" />daemon:*:1:<br class="calibre7" />bin:*:2:<br class="calibre7" />sys:*:3:<br class="calibre7" />adm:*:4:<br class="calibre7" />disk:*:6:juser,beazley<br class="calibre7" />nogroup:*:65534:<br class="calibre7" />user:*:1000:</span></blockquote></blockquote><blockquote id="calibre_link-515" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 7-2</span></span><span class="italic"><span class="calibre_13">: A sample </span></span>/etc/group<span class="italic"><span class="calibre_13"> file</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> As with the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file, each line in</span><span class="italic"> /etc/group</span><span class="calibre_13"> is a set of fields separated by colons. The fields in each entry are as follows, from left to right:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">The group name</span> This appears when you run a command like <span class="calibre3">ls -l</span>.</li><li value="2" class="calibre_8"><span class="bold">The group password</span> Unix group passwords are hardly ever used, nor should you use them (a good alternative in most cases is <span class="calibre3">sudo</span>). Use <span class="calibre3">*</span> or any other default value. An <span class="calibre3">x</span> here means that there’s a corresponding entry in <span class="italic">/etc/gshadow</span>, and this is also nearly always a disabled password, denoted with a <span class="calibre3">*</span> or <span class="calibre3">!</span>.</li><li value="3" class="calibre_8"><span class="bold">The group ID (a number)</span> The GID must be unique within the <span class="calibre3">group</span> file. This number goes into a user’s group field in that user’s <span class="italic">/etc/passwd</span> entry.</li><li value="4" class="calibre_8"><span class="bold">An optional list of users that belong to the group</span> In addition to the users listed here, users with the corresponding group ID in their <span class="italic">passwd</span> file entries also belong to the group.</li></ol><p class="calibre_33"><a href="#calibre_link-516"><span class="italic"><span class="calibre_4">Figure 7-2</span></span></a><span class="calibre_13"> identifies the fields in a </span><span class="italic">group</span><span class="calibre_13"> file entry.</span></p><p class="calibre_34"><img src="images/000014.jpg" class="calibre_87" />
</p><p id="calibre_link-516" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 7-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: An entry in the </span></span></span><span class="calibre3">group</span><span class="calibre3"><span class="italic"><span class="calibre_13"> file</span></span></span></p><p class="calibre_37"><span class="calibre_13"> To see the groups you belong to, run </span><span class="calibre3"><span class="bold">groups</span></span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Linux distributions often create a new group for each new user added, with the same name as the user.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-199" class="calibre_42"><span class="calibre1"><span class="bold">7.4 getty and login</span></span></p><p class="calibre_24"><span class="calibre_13">The </span><span class="calibre3">getty</span><span class="calibre_13"> program attaches to terminals and displays a login prompt. On most Linux systems, </span><span class="calibre3">getty</span><span class="calibre_13"> is uncomplicated because the system uses it only for logins on virtual terminals. In a process listing, it usually looks something like this (for example, when running on </span><span class="italic">/dev/tty1</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps ao args | grep getty</span></span><span class="calibre3"><br class="calibre7" />/sbin/agetty -o -p -- \u --noclear tty1 linux</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On many systems, you may not even see a </span><span class="calibre3">getty</span><span class="calibre_13"> process until you access a virtual terminal with something like </span>CTRL-ALT-F1<span class="calibre_13">. This example shows </span><span class="calibre3">agetty</span><span class="calibre_13">, the version that many Linux distributions include by default.</span></p><p class="calibre_27"><span class="calibre_13"> After you enter your login name, </span><span class="calibre3">getty</span><span class="calibre_13"> replaces itself with the </span><span class="calibre3">login</span><span class="calibre_13"> program, which asks for your password. If you enter the correct password, </span><span class="calibre3">login</span><span class="calibre_13"> replaces itself (using </span><span class="calibre3">exec()</span><span class="calibre_13">) with your shell. Otherwise, you get a “Login incorrect” message. Much of the </span><span class="calibre3">login</span><span class="calibre_13"> program’s real authentication work is handled by PAM (see </span>Section 7.10<span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> When investigating </span></span><span class="calibre3">getty</span><span class="italic"><span class="calibre_13">, you may come across a reference to a baud rate such as “38400.” This setting is all but obsolete. Virtual terminals ignore the baud rate; it’s only there for connecting to real serial lines.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You now know what </span><span class="calibre3">getty</span><span class="calibre_13"> and </span><span class="calibre3">login</span><span class="calibre_13"> do, but you’ll probably never need to configure or change them. In fact, you’ll rarely even use them, because most users now log in either through a graphical interface such as </span><span class="calibre3">gdm</span><span class="calibre_13"> or remotely with SSH, neither of which uses </span><span class="calibre3">getty</span><span class="calibre_13"> or </span><span class="calibre3">login</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-200" class="calibre_23"><span class="calibre1"><span class="bold"> 7.5 Setting the Time</span></span></p><p class="calibre_24"><span class="calibre_13">Unix machines depend on accurate timekeeping. The kernel maintains the </span><span class="italic">system clock</span><span class="calibre_13">, which is the clock consulted when you run commands like </span><span class="calibre3">date</span><span class="calibre_13">. You can also set the system clock using the </span><span class="calibre3">date</span><span class="calibre_13"> command, but it’s usually a bad idea to do so because you’ll never get the time exactly right. Your system clock should be as close to the correct time as possible.</span></p><p class="calibre_27"><span class="calibre_13"> PC hardware has a battery-backed </span><span class="italic">real-time clock (RTC)</span><span class="calibre_13">. The RTC isn’t the best clock in the world, but it’s better than nothing. The kernel usually sets its time based on the RTC at boot time, and you can reset the system clock to the current hardware time with </span><span class="calibre3">hwclock</span><span class="calibre_13">. Keep your hardware clock in Universal Coordinated Time (UTC) in order to avoid any trouble with time zone or daylight saving time corrections. You can set the RTC to your kernel’s UTC clock using this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">hwclock --systohc --utc</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Unfortunately, the kernel is even worse at keeping time than the RTC, and because Unix machines often stay up for months or years on a single boot, they tend to develop time drift. </span><a id="calibre_link-663"></a><span class="italic">Time drift</span><span class="calibre_13"> is the current difference between the kernel time and the true time (as defined by an atomic clock or another very accurate clock).</span></p><p class="calibre_27"><span class="calibre_13"> You shouldn’t try to fix time drift with </span><span class="calibre3">hwclock</span><span class="calibre_13"> because time-based system events can get lost or mangled. You could run a utility like </span><span class="calibre3">adjtimex</span><span class="calibre_13"> to smoothly update the clock based on the RTC, but usually it’s best to keep your system time correct with a network time daemon (see </span>Section 7.5.2<span class="calibre_13">).</span></p><p id="calibre_link-201" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.5.1 Kernel Time Representation and Time Zones</span></span></span></p><p class="calibre_45"><span class="calibre_13">The kernel’s system clock represents the current time as the number of seconds since 12:00 midnight on January 1, 1970, UTC. To see this number at the moment, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">date +%s</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To convert this number into something that humans can read, user-space programs change it to local time and compensate for daylight saving time and any other strange circumstances (such as living in Indiana). The local time zone is controlled by the file </span><span class="italic">/etc/localtime</span><span class="calibre_13">. (Don’t bother trying to look at it; it’s a binary file.)</span></p><p class="calibre_27"><span class="calibre_13"> The time zone files on your system are in </span><span class="italic">/usr/share/zoneinfo</span><span class="calibre_13">. You’ll find that this directory contains a lot of time zones and aliases for time zones. To set your system’s time zone manually, either copy one of the files in </span><span class="italic">/usr/share/zoneinfo</span><span class="calibre_13"> to </span><span class="italic">/etc/localtime</span><span class="calibre_13"> (or make a symbolic link) or change it with your distribution’s time zone tool. The command-line program </span><span class="calibre3">tzselect</span><span class="calibre_13"> may help you identify a time zone file.</span></p><p class="calibre_27"><span class="calibre_13"> To use a time zone other than the system default for just one shell session, set the </span><span class="calibre3">TZ</span><span class="calibre_13"> environment variable to the name of a file in </span><span class="italic">/usr/share/zoneinfo</span><span class="calibre_13"> and test the change, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">export TZ=US/Central</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">date</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">As with other environment variables, you can also set the time zone for the duration of a single command like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">TZ=US/Central date</span></span></blockquote></blockquote><p id="calibre_link-202" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">7.5.2 Network Time</span></span></span></p><p class="calibre_45"><span class="calibre_13">If your machine is permanently connected to the internet, you can run a Network Time Protocol (NTP) daemon to maintain the time using a remote server. This was once handled by the ntpd daemon, but as with many other services, systemd has replaced this with its own package, named timesyncd. Most Linux distributions include timesyncd, and it’s enabled by default. You shouldn’t need to configure it, but if you’re interested in how to do it, the timesyncd.conf(5) manual page can help you. The most common override is to change the remote time server(s).</span><a id="calibre_link-655"></a></p><p class="calibre_27"><span class="calibre_13"> If you want to run ntpd instead, you’ll need to disable timesyncd if you’ve got it installed. Go to </span><a href="https://www.ntppool.org/"><span class="italic"><span class="calibre_4">https://www.ntppool.org/</span></span></a><span class="calibre_13"> to see the instructions there. This site might also be useful if you still want to use timesyncd with different servers.</span></p><p class="calibre_27"><span class="calibre_13">If your machine doesn’t have a permanent internet connection, you can use a daemon such as chronyd to maintain the time during disconnections.</span></p><p class="calibre_27"><span class="calibre_13">You can also set your hardware clock based on the network time in order to help your system maintain time coherency when it reboots. Many distributions do this automatically, but to do it manually, make sure that your system time is set from the network and then run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">hwclock --systohc &ndash;-utc</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-203" class="calibre_42"><span class="calibre1"><span class="bold"> 7.6 Scheduling Recurring Tasks with cron and Timer Units</span></span></p><p class="calibre_24"><span class="calibre_13">There are two ways to run programs on a repeating schedule: cron, and systemd timer units. This ability is vital to automating system maintenance tasks. One example is logfile rotation utilities to ensure that your hard drive doesn’t fill up with old logfiles (as discussed earlier in the chapter). The cron service has long been the de facto standard for doing this, and we’ll cover it in detail. However, systemd’s timer units are an alternative to cron with advantages in certain cases, so we’ll see how to use them as well.</span></p><p class="calibre_27"><span class="calibre_13"> You can run any program with cron at whatever times suit you. The program running through cron is called a </span><span class="italic">cron job</span><span class="calibre_13">. To install a cron job, you’ll create an entry line in your </span><span class="italic">crontab file</span><span class="calibre_13">, usually by running the </span><span class="calibre3">crontab</span><span class="calibre_13"> command. For example, the following crontab file entry schedules the </span><span class="calibre3">/home/juser/bin/spmake</span><span class="calibre_13"> command daily at 9:15 </span>AM<span class="calibre_13"> (in the local time zone):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">15 09 * * * /home/juser/bin/spmake</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The five fields at the beginning of this line, delimited by whitespace, specify the scheduled time (see also </span><a></a><a href="#calibre_link-517"><span class="italic"><span class="calibre_4">Figure 7-3</span></span></a><span class="calibre_13">). The fields are as follows, in order:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Minute (0 through 59). This cron job is set for minute 15.</li><li value="2" class="calibre_8">Hour (0 through 23). This job is set for the ninth hour.</li><li value="3" class="calibre_8">Day of month (1 through 31).</li><li value="4" class="calibre_8">Month (1 through 12).</li><li value="5" class="calibre_8"> Day of week (0 through 7). The numbers 0 and 7 are Sunday. <blockquote class="calibre_16"><blockquote class="calibre_29"><img src="images/000005.jpg" class="calibre_88" />
</blockquote></blockquote><blockquote class="calibre_61"><blockquote class="calibre_29"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 7-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: An entry in the crontab file</span></span></span></blockquote></blockquote></li><a id="calibre_link-517"></a></ul><p class="calibre_37"><span class="calibre_13"> A star (</span><span class="calibre3">*</span><span class="calibre_13">) in any field means to match every value. The preceding example runs </span><span class="calibre3">spmake</span><span class="calibre_13"> daily because the day of month, month, and day of week fields are all filled with stars, which cron reads as “run this job every day, of every month, of every day of the week.”</span></p><p class="calibre_27"><span class="calibre_13"> To run </span><span class="calibre3">spmake</span><span class="calibre_13"> only on the 14th day of each month, you would use this crontab line:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">15 09 </span><span class="calibre3"><span class="bold">14</span></span><span class="calibre3"> * * /home/juser/bin/spmake</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can select more than one time for each field. For example, to run the program on the 5th and the 14th day of each month, you could enter </span><span class="calibre3">5,14</span><span class="calibre_13"> in the third field:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">15 09 </span><span class="calibre3"><span class="bold">5,14</span></span><span class="calibre3"> * * /home/juser/bin/spmake</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If the cron job generates standard output or an error or exits abnormally, cron should email this information to the owner of the cron job (assuming that email works on your system). Redirect the output to </span></span>/dev/null<span class="italic"><span class="calibre_13"> or some other logfile if you find the email annoying.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">The crontab(5) manual page provides complete information on the crontab format.</span></p><p id="calibre_link-204" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.6.1 Installing Crontab Files</span></span></span></p><p class="calibre_45"><span class="calibre_13">Each user can have their own crontab file, which means that every system may have multiple crontabs, usually found in </span><span class="italic">/var/spool/cron/crontabs</span><span class="calibre_13">. Normal users can’t write to this directory; the </span><span class="calibre3">crontab</span><span class="calibre_13"> command installs, lists, edits, and removes a user’s crontab.</span></p><p class="calibre_27"><span class="calibre_13"> The easiest way to install a crontab is to put your crontab entries into a file and then use </span><span class="calibre3">crontab </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> to install </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> as your current crontab. The </span><span class="calibre3">crontab</span><span class="calibre_13"> command checks the file format to make sure that you haven’t made any mistakes. To list your cron jobs, run </span><span class="calibre3">crontab -l</span><span class="calibre_13">. To remove the crontab, use </span><span class="calibre3">crontab -r</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> After you’ve created your initial crontab, it can be a bit messy to use temporary files to make further edits. Instead, you can edit and install your crontab in one step with the </span><a id="calibre_link-656"></a><span class="calibre3">crontab -e</span><span class="calibre_13"> command. If you make a mistake, </span><span class="calibre3">crontab</span><span class="calibre_13"> should tell you where the mistake is and ask if you want to try editing again.</span></p><p id="calibre_link-205" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.6.2 System Crontab Files</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many common cron-activated system tasks are run as the superuser. However, rather than editing and maintaining a superuser’s crontab to schedule these, Linux distributions normally have an </span><span class="italic">/etc/crontab</span><span class="calibre_13"> file for the entire system. You won’t use </span><span class="calibre3">crontab</span><span class="calibre_13"> to edit this file, and in any case, it’s slightly different in format: before the command to run, there’s an additional field specifying the user that should run the job. (This gives you the opportunity to group system tasks together even if they aren’t all run by the same user.) For example, this cron job defined in </span><span class="italic">/etc/crontab</span><span class="calibre_13"> runs at 6:42 </span>AM<span class="calibre_13"> as the superuser (</span><span class="calibre3">root</span><span class="calibre_13">
</span>1<span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">42 6 * * * root1 /usr/local/bin/cleansystem &gt; /dev/null 2&gt;&amp;1</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Some distributions store additional system crontab files in the </span></span>/etc/cron.d<span class="italic"><span class="calibre_13"> directory. These files may have any name, but they have the same format as </span></span>/etc/crontab<span class="italic"><span class="calibre_13">. There may also be some directories such as </span></span>/etc/cron.daily<span class="italic"><span class="calibre_13">, but the files here are usually scripts run by a specific cron job in </span></span>/etc/crontab<span class="italic"><span class="calibre_13"> or </span></span>/etc/cron.d<span class="italic"><span class="calibre_13">. It can sometimes be confusing to track down where the jobs are and when they run.</span></span></blockquote><p id="calibre_link-206" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">7.6.3 Timer Units</span></span></span></p><p class="calibre_45"><span class="calibre_13">An alternative to creating a cron job for a periodic task is to build a systemd timer unit. For an entirely new task, you must create two units: a timer unit and a service unit. The reason for two units is that a timer unit doesn’t contain any specifics about the task to perform; it’s just an activation mechanism to run a service unit (or conceptually, another kind of unit, but the most common usage is for service units).</span></p><p class="calibre_27"><span class="calibre_13"> Let’s look at a typical timer/service unit pair, starting with the timer unit. Let’s call this </span><span class="italic">loggertest.timer</span><span class="calibre_13">; as with other custom unit files, we’ll put it in </span><span class="italic">/etc/systemd/system </span><span class="calibre_13">(see </span><a></a><a href="#calibre_link-518"><span class="italic"><span class="calibre_4">Listing 7-3</span></span></a><span class="calibre_13">).</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=Example timer unit<br class="calibre7" />[Timer]<br class="calibre7" />OnCalendar=*-*-* *:00,20,40<br class="calibre7" />Unit=loggertest.service<br class="calibre7" />[Install]<br class="calibre7" />WantedBy=timers.target</span></blockquote></blockquote><blockquote id="calibre_link-518" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 7-3</span></span><span class="italic"><span class="calibre_13">: </span></span><span class="calibre3"><span class="italic">loggertest.timer</span></span></blockquote><p id="calibre_link-809" class="calibre_37"><span class="calibre_13">This timer runs every 20 minutes, with the </span><span class="calibre3">OnCalendar</span><span class="calibre_13"> option resembling the cron syntax. In this example, it’s at the top of each hour, as well as 20 and 40 minutes past each hour.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">OnCalendar</span><span class="calibre_13"> time format is </span><span class="calibre3"><span class="italic">year</span></span><span class="calibre3">-</span><span class="calibre3"><span class="italic">month</span></span><span class="calibre3">-</span><span class="calibre3"><span class="italic">day</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic">hour</span></span><span class="calibre3">:</span><span class="calibre3"><span class="italic">minute</span></span><span class="calibre3">:</span><span class="calibre3"><span class="italic">second</span></span><span class="calibre_13">. The field for seconds is optional. As with cron, a </span><span class="calibre3">*</span><span class="calibre_13"> represents a sort of wildcard, and commas allow for multiple values. The periodic </span><span class="calibre3">/</span><span class="calibre_13"> syntax is also valid; in the preceding example, you could change the </span><span class="calibre3">*:00,20,40</span><span class="calibre_13"> to </span><span class="calibre3">*:00/20</span><span class="calibre_13"> (every 20 minutes) for the same effect.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The syntax for times in the </span></span><span class="calibre3">OnCalendar</span><span class="italic"><span class="calibre_13"> field has many shortcuts and variations. See the Calendar Events section of the systemd.time(7) manual page for the full list.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The associated service unit is named </span><span class="italic">loggertest.service </span><span class="calibre_13">(see </span><a></a><a href="#calibre_link-519"><span class="italic"><span class="calibre_4">Listing 7-4</span></span></a><span class="calibre_13">). We explicitly named it in the timer with the </span><span class="calibre3">Unit</span><span class="calibre_13"> option, but this isn’t strictly necessary because systemd looks for a </span><span class="italic">.service</span><span class="calibre_13"> file with the same base name as the timer unit file. This service unit also goes in </span><span class="italic">/etc/systemd/system</span><span class="calibre_13">, and looks quite similar to the service units that you saw back in </span>Chapter 6<span class="calibre_13">.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[Unit]<br class="calibre7" />Description=Example Test Service<br class="calibre7" />[Service]<br class="calibre7" />Type=oneshot<br class="calibre7" />ExecStart=/usr/bin/logger -p local3.debug I\'m a logger</span></blockquote></blockquote><blockquote id="calibre_link-519" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 7-4</span></span><span class="italic"><span class="calibre_13">: </span></span><span class="calibre3"><span class="italic">loggertest.service</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The meat of this is the </span><span class="calibre3">ExecStart</span><span class="calibre_13"> line, which is the command that the service runs when activated. This particular example sends a message to the system log.</span></p><p class="calibre_27"><span class="calibre_13"> Note the use of </span><span class="calibre3">oneshot</span><span class="calibre_13"> as the service type, indicating that the service is expected to run and exit, and that systemd won’t consider the service started until the command specified by </span><span class="calibre3">ExecStart</span><span class="calibre_13"> completes. This has a few advantages for timers:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> You can specify multiple <span class="calibre3">ExecStart</span> commands in the unit file. The other service unit styles that we saw in Chapter 6 do not allow this.</li><li value="2" class="calibre_8"> It’s easier to control strict dependency order when activating other units using <span class="calibre3">Wants</span> and <span class="calibre3">Before</span> dependency directives.</li><li value="3" class="calibre_8"> You have better records of start and end times of the unit in the journal. <blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> In this unit example, we’re using </span></span><span class="calibre3">logger</span><span class="italic"><span class="calibre_13"> to send an entry to syslog and the journal. You read in </span></span><span class="italic">Section 7.1.2</span><span class="italic"><span class="calibre_13"> that you can view log messages by unit. However, the unit could finish up before journald has a chance to receive the message. This is a race condition, and in the case that the unit completes too quickly, journald won’t be able to look up the unit associated with the syslog message (this is done by process ID). Consequently, the message that gets written in the journal may not include a unit field, rendering a filtering command such as </span></span><span class="calibre3">journalctl -f -u loggertest.service</span><span class="italic"><span class="calibre_13"> incapable of showing the syslog message. This isn’t normally a problem in longer-running services.</span></span></blockquote></blockquote></li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-207" class="calibre_23"><a id="calibre_link-569"></a><span class="calibre6"><span class="italic"><span class="bold">7.6.4 cron vs. Timer Units</span></span></span></p><p class="calibre_45"><span class="calibre_13">The cron utility is one of the oldest components of a Linux system; it’s been around for decades (predating Linux itself), and its configuration format hasn’t changed much for many years. When something gets to be this old, it becomes fodder for replacement.</span></p><p class="calibre_27"><span class="calibre_13">The systemd timer units that you just saw may seem like a logical replacement, and indeed, many distributions have now moved system-level periodic maintenance tasks to timer units. But it turns out that cron has some advantages:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Simpler configuration</li><li value="2" class="calibre_8">Compatibility with many third-party services</li><li value="3" class="calibre_8">Easier for users to install their own tasks</li></ul><p class="calibre_33"><span class="calibre_13">Timer units offer these advantages:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Superior tracking of processes associated with tasks/units with cgroups</li><li value="2" class="calibre_8">Excellent tracking of diagnostic information in the journal</li><li value="3" class="calibre_8">Additional options for activation times and frequencies</li><li value="4" class="calibre_8">Ability to use systemd dependencies and activation mechanisms</li></ul><p class="calibre_33"><span class="calibre_13"> Perhaps someday there will be a compatibility layer for cron jobs in much the same manner as mount units and </span><span class="italic">/etc/fstab</span><span class="calibre_13">. However, configuration alone is a reason why it’s unlikely that the cron format will go away any time soon. As you’ll see in the next section, a utility called </span><span class="calibre3">systemd-run</span><span class="calibre_13"> does allow for creating timer units and associated services without creating unit files, but the management and implementation differ enough that many users would likely prefer cron. You’ll see some of this shortly when we discuss </span><span class="calibre3">at</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-208" class="calibre_23"><span class="calibre1"><span class="bold"> 7.7 Scheduling One-Time Tasks with at</span></span></p><p class="calibre_24"><span class="calibre_13">To run a job once in the future without using cron, use the </span><span class="calibre3">at</span><span class="calibre_13"> service. For example, to run </span><span class="calibre3">myjob</span><span class="calibre_13"> at 10:30 </span>PM<span class="calibre_13">, enter this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">at 22:30</span></span><span class="calibre3"><br class="calibre7" />at&gt; </span><span class="calibre3"><span class="bold">myjob</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> End the input with </span>CTRL<span class="calibre_13">-D. (The </span><span class="calibre3">at</span><span class="calibre_13"> utility reads the commands from the standard input.)</span></p><p id="calibre_link-570" class="calibre_27"><span class="calibre_13">To check that the job has been scheduled, use </span><span class="calibre3">atq</span><span class="calibre_13">. To remove it, use </span><span class="calibre3">atrm</span><span class="calibre_13">. You can also schedule jobs days into the future by adding the date in </span><span class="calibre3"><span class="italic">DD.MM.YY</span></span><span class="calibre_13"> format&mdash;for example, </span><span class="calibre3">at 22:30 30.09.15</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> There isn’t much else to the </span><span class="calibre3">at</span><span class="calibre_13"> command. Though it isn’t used that often, it can be invaluable when the need does arise.</span></p><p id="calibre_link-209" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.7.1 Timer Unit Equivalents</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can use systemd timer units as a substitute for </span><span class="calibre3">at</span><span class="calibre_13">. These are much easier to create than the periodic timer units that you saw earlier, and can be run on the command line like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemd-run </span></span><span class="calibre3">--</span><span class="calibre3"><span class="bold">on-calendar='2022-08-14 18:00' /bin/echo this is a test</span></span><span class="calibre3"><br class="calibre7" />Running timer as unit: run-rbd000cc6ee6f45b69cb87ca0839c12de.timer<br class="calibre7" />Will run service as unit: run-rbd000cc6ee6f45b69cb87ca0839c12de.service</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">systemd-run</span><span class="calibre_13"> command creates a transient timer unit that you can view with the usual </span><span class="calibre3">systemctl list-timers</span><span class="calibre_13"> command. If you don’t care about a specific time, you can specify a time offset instead with </span><span class="calibre3">--on-active</span><span class="calibre_13"> (for example, </span><span class="calibre3">--on-active=30m</span><span class="calibre_13"> for 30 minutes in the future).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> When using </span></span><span class="calibre3">--on-calendar</span><span class="italic"><span class="calibre_13">, it’s important that you include a (future) calendar date as well as the time. Otherwise, the timer and service units will remain, with the timer running the service every day at the specified time, much as it would if you created a normal timer unit as described earlier. The syntax for this option is the same as the </span></span><span class="calibre3">OnCalendar</span><span class="italic"><span class="calibre_13"> option in timer units.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-210" class="calibre_42"><span class="calibre1"><span class="bold"> 7.8 Timer Units Running as Regular Users</span></span></p><p class="calibre_24"><span class="calibre_13">All of the systemd timer units we’ve seen so far have been run as root. It’s also possible to create a timer unit as a regular user. To do this, add the </span><span class="calibre3">--user</span><span class="calibre_13"> option to </span><span class="calibre3">systemd-run</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">However, if you log out before the unit runs, the unit won’t start; and if you log out before the unit completes, the unit terminates. This happens because systemd has a user manager associated with a logged-in user, and this is necessary to run timer units. You can tell systemd to keep the user manager around after you log out with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">loginctl enable-linger</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">As root, you can also enable a manager for another user:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">loginctl enable-linger </span></span><span class="calibre3"><span class="italic"><span class="bold">user</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-211" class="calibre_42"><span class="calibre1"><span class="bold">7.9 User Access Topics</span></span></p><p class="calibre_24"><span class="calibre_13">The remainder of this chapter covers several topics on how users get the permission to log in, switch to other users, and perform other related tasks. This is somewhat advanced material, and you’re welcome to skip to the next chapter if you’re ready to get your hands dirty with some process internals.</span></p><p id="calibre_link-212" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.9.1 User IDs and User Switching</span></span></span></p><p class="calibre_45"><span class="calibre_13">We’ve discussed how setuid programs such as </span><span class="calibre3">sudo</span><span class="calibre_13"> and </span><span class="calibre3">su</span><span class="calibre_13"> allow you to temporarily change users, and we’ve covered system components like </span><span class="calibre3">login</span><span class="calibre_13"> that control user access. Perhaps you’re wondering how these pieces work and what role the kernel plays in user switching.</span></p><p class="calibre_27"><span class="calibre_13"> When you temporarily switch to another user, all you’re really doing is changing your user ID. There are two ways to do this, and the kernel handles both. The first is with a setuid executable, which was covered in </span>Section 2.17<span class="calibre_13">. The second is through the </span><span class="calibre3">setuid()</span><span class="calibre_13"> family of system calls. There are a few different versions of this system call to accommodate the various user IDs associated with a process, as you’ll learn in </span>Section 7.9.2<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The kernel has basic rules about what a process can or can’t do, but here are the three essentials that cover setuid executables and </span><span class="calibre3">setuid()</span><span class="calibre_13">:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">A process can run a setuid executable as long as it has adequate file permissions.</li><li value="2" class="calibre_8"> A process running as root (user ID 0) can use <span class="calibre3">setuid()</span> to become any other user.</li><li value="3" class="calibre_8"> A process not running as root has severe restrictions on how it may use <span class="calibre3">setuid()</span>; in most cases, it cannot.</li></ul><p class="calibre_33"><span class="calibre_13"> As a consequence of these rules, if you want to switch user IDs from a regular user to another user, you often need a combination of the methods. For example, the </span><span class="calibre3">sudo</span><span class="calibre_13"> executable is setuid root, and once running, it can call </span><span class="calibre3">setuid()</span><span class="calibre_13"> to become another user.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> At its core, user switching has nothing to do with passwords or usernames. Those are strictly user-space concepts, as you first saw in the </span></span>/etc/passwd<span class="italic"><span class="calibre_13"> file in Section 7.3.1. You’ll learn more details about how this works in Section 7.9.4.</span></span></blockquote><p id="calibre_link-213" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">7.9.2 Process Ownership, Effective UID, Real UID, and Saved UID</span></span></span></p><p class="calibre_45"><span class="calibre_13">Our discussion of user IDs so far has been simplified. In reality, every process has more than one user ID. So far, you are familiar with the </span><span class="italic">effective user ID</span><span class="calibre_13">
</span><span class="italic">(effective UID, or euid)</span><span class="calibre_13">, which defines the access rights for a process (most significantly, file permissions). A second user ID, the </span><span class="italic">real user ID</span><span class="calibre_13">
</span><span class="italic">(real UID, or ruid)</span><span class="calibre_13">, indicates who initiated a process. Normally, these IDs are identical, but when you run a setuid program, Linux sets the euid to the program’s owner during execution, but it keeps your original user ID in the ruid.</span></p><p id="calibre_link-723" class="calibre_27"><span class="calibre_13">The difference between the effective and real UIDs is confusing, so much so that a lot of documentation regarding process ownership is incorrect.</span></p><p class="calibre_27"><span class="calibre_13"> Think of the euid as the </span><span class="italic">actor</span><span class="calibre_13"> and the ruid as the </span><span class="italic">owner</span><span class="calibre_13">. The ruid defines the user that can interact with the running process&mdash;most significantly, which user can kill and send signals to a process. For example, if user A starts a new process that runs as user B (based on setuid permissions), user A still owns the process and can kill it.</span></p><p class="calibre_27"><span class="calibre_13"> We’ve seen that most processes have the same euid and ruid. As a result, the default output for </span><span class="calibre3">ps</span><span class="calibre_13"> and other system diagnostic programs show only the euid. To view both user IDs on your system, try this, but don’t be surprised if you find that the two user ID columns are identical for all processes on your system:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps -eo pid,euser,ruser,comm</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To create an exception just so that you can see different values in the columns, try experimenting by creating a setuid copy of the </span><span class="calibre3">sleep</span><span class="calibre_13"> command, running the copy for a few seconds, and then running the preceding </span><span class="calibre3">ps</span><span class="calibre_13"> command in another window before the copy terminates.</span></p><p class="calibre_27"><span class="calibre_13"> To add to the confusion, in addition to the real and effective user IDs, there’s also a </span><span class="italic">saved user ID</span><span class="calibre_13"> (which is usually not abbreviated). A process can switch its euid to the ruid or saved user ID during execution. (To make things even more complicated, Linux has yet another user ID: the </span><span class="italic">file system user ID</span><span class="calibre_13">, or </span><span class="italic">fsuid</span><span class="calibre_13">, which defines the user accessing the filesystem but is rarely used.)</span></p><p class="calibre_46"><span class="bold">Typical Setuid Program Behavior</span></p><p class="calibre_25"><span class="calibre_13">The idea of the ruid might contradict your previous experience. Why don’t you have to deal with the other user IDs very frequently? For example, after starting a process with </span><span class="calibre3">sudo</span><span class="calibre_13">, if you want to kill it, you still use </span><span class="calibre3">sudo</span><span class="calibre_13">; you can’t kill it as your own regular user. Shouldn’t your regular user be the ruid in this case, giving you the correct permissions?</span></p><p class="calibre_27"><span class="calibre_13"> The cause of this behavior is that </span><span class="calibre3">sudo</span><span class="calibre_13"> and many other setuid programs explicitly change the euid </span><span class="italic">and</span><span class="calibre_13"> ruid with one of the </span><span class="calibre3">setuid()</span><span class="calibre_13"> system calls. These programs do so because there are often unintended side effects and access problems when all of the user IDs do not match.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re interested in the details and rules regarding user ID switching, read the setuid(2) manual page and check the other manual pages listed in the SEE ALSO section. There are many different system calls for diverse situations.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Some programs don’t like to have an ruid of root. To prevent </span><span class="calibre3">sudo</span><span class="calibre_13"> from changing the ruid, add this line to your </span><span class="italic">/etc/sudoers</span><span class="calibre_13"> file (and beware of side effects on other programs you want to run as root!):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stay_setuid</span></blockquote></blockquote><p id="calibre_link-780" class="calibre_42"><span class="bold">Security Implications</span></p><p class="calibre_25"><span class="calibre_13">Because the Linux kernel handles all user switches (and as a result, file access permissions) through setuid programs and subsequent system calls, systems developers and administrators must be extremely careful with two things:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">The number and quality of programs that have setuid permissions</li><li value="2" class="calibre_8">What those programs do</li></ul><p class="calibre_33"><span class="calibre_13"> If you make a copy of the </span><span class="calibre3">bash</span><span class="calibre_13"> shell that is setuid root, any local user can execute it and have complete run of the system. It’s really that simple. Furthermore, even a special-purpose program that is setuid root can pose a danger if it has bugs. Exploiting weaknesses in programs running as root is a primary method of systems intrusion, and there are too many such exploits to count.</span></p><p class="calibre_27"><span class="calibre_13">Because there are so many ways to break into a system, preventing intrusion is a multifaceted affair. One of the most essential ways to keep unwanted activity off your system is to enforce user authentication with usernames and good passwords.</span></p><p id="calibre_link-214" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.9.3 User Identification, Authentication, and Authorization</span></span></span></p><p class="calibre_45"><span class="calibre_13">A multiuser system must provide basic support for user security in three areas: identification, authentication, and authorization. The </span><span class="italic">identification</span><span class="calibre_13"> portion of security answers the question of </span><span class="italic">who</span><span class="calibre_13"> users are. The </span><span class="italic">authentication</span><span class="calibre_13"> piece asks users to </span><span class="italic">prove</span><span class="calibre_13"> that they are who they say they are. Finally, </span><span class="italic">authorization</span><span class="calibre_13"> is used to define and limit what users are </span><span class="italic">allowed</span><span class="calibre_13"> to do.</span></p><p class="calibre_27"><span class="calibre_13"> When it comes to user identification, the Linux kernel knows only the numeric user IDs for process and file ownership. The kernel knows authorization rules for how to run setuid executables and how user IDs may run the </span><span class="calibre3">setuid()</span><span class="calibre_13"> family of system calls to change from one user to another. However, the kernel doesn’t know anything about authentication: usernames, passwords, and so on. Practically everything related to authentication happens in user space.</span></p><p class="calibre_27"><span class="calibre_13"> We discussed the mapping between user IDs and passwords in </span>Section 7.3.1<span class="calibre_13">; now we’ll cover how user processes access this mapping. We’ll begin with an oversimplified case, in which a user process wants to know its username (the name corresponding to the euid). On a traditional Unix system, a process could do something like this to get its username:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The process asks the kernel for its euid with the <span class="calibre3">geteuid()</span> system call.</li><li value="2" class="calibre_8">The process opens the <span class="italic">/etc/passwd</span> file and starts reading at the beginning.</li><li value="3" class="calibre_8">The process reads a line of the <span class="italic">/etc/passwd</span> file. If there’s nothing left to read, the process has failed to find the username.</li><li value="4" class="calibre_8">The process parses the line into fields (breaking out everything between the colons). The third field is the user ID for the current line.</li><li value="5" class="calibre_8">The process compares the ID from step 4 to the ID from step 1. If they’re identical, the first field in step 4 is the desired username, and the process can stop searching and use this name.</li><a id="calibre_link-745"></a><li value="6" class="calibre_8">The process moves on to the next line in <span class="italic">/etc/passwd</span> and goes back to step 3.</li></ol><p class="calibre_33"><span class="calibre_13">This is a long procedure, and a real-world implementation is usually even more complicated.</span></p><p id="calibre_link-215" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.9.4 Using Libraries for User Information</span></span></span></p><p class="calibre_45"><span class="calibre_13">If every developer who needed to know the current username had to write all of the code you’ve just seen, the system would be a horrifyingly disjointed, buggy, bloated, and unmaintainable mess. Fortunately, there are often standard libraries we can use to perform repetitive tasks like this; in this case, all you’d normally need to do to get a username is call a function like </span><span class="calibre3">getpwuid()</span><span class="calibre_13"> in the standard library after you have the answer from </span><span class="calibre3">geteuid()</span><span class="calibre_13">. (See the manual pages for these calls for more on how they work.)</span></p><p class="calibre_27"><span class="calibre_13"> The standard library is shared among the executables on your system, so you can make significant changes to the authentication implementation without changing any program. For example, you can move away from using </span><span class="italic">/etc/passwd</span><span class="calibre_13"> for your users and use a network service such as LDAP instead by changing only the system configuration.</span></p><p class="calibre_27"><span class="calibre_13"> This approach has worked well for identifying usernames associated with user IDs, but passwords have proven more troublesome. </span>Section 7.3.1<span class="calibre_13"> describes how, traditionally, the encrypted password was part of </span><span class="italic">/etc/passwd</span><span class="calibre_13">, so if you wanted to verify a password that a user entered, you’d encrypt whatever the user typed and compare it to the contents of the </span><span class="italic">/etc/passwd</span><span class="calibre_13"> file.</span></p><p class="calibre_27"><span class="calibre_13">This traditional implementation has many limitations, including:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">It doesn’t allow you to set a system-wide standard for the encryption protocol.</li><li value="2" class="calibre_8">It assumes that you have access to the encrypted password.</li><li value="3" class="calibre_8">It assumes that you want to prompt the user for a password every time the user wants to access something that requires authentication (which gets annoying).</li><li value="4" class="calibre_8">It assumes that you want to use passwords. If you want to use one-time tokens, smart cards, biometrics, or some other form of user authentication, you have to add that support yourself.</li></ul><p class="calibre_33"><span class="calibre_13"> Some of these limitations contributed to the development of the </span><span class="italic">shadow</span><span class="calibre_13"> password package discussed in </span>Section 7.3.3<span class="calibre_13">, which took the first step in allowing system-wide password configuration. But the solution to the bulk of the problems came with the design and implementation of PAM.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-216" class="calibre_23"><span class="calibre1"><span class="bold"> 7.10 Pluggable Authentication Modules</span></span></p><p class="calibre_24"><span class="calibre_13">To accommodate flexibility in user authentication, in 1995 Sun Microsystems proposed a new standard called </span><span class="italic">Pluggable Authentication Modules (PAM)</span><span class="calibre_13">, a system of shared libraries for authentication (Open Software Foundation RFC 86.0, October 1995). To authenticate a user, an application hands the user to PAM to determine whether the user can successfully identify itself. This way, it’s relatively easy to add support for additional authentication techniques, such as two-factor and physical keys. In addition to authentication mechanism support, PAM also provides a limited amount of authorization control for services (for example, if you’d like to deny a service like cron to certain users).</span><a id="calibre_link-622"></a></p><p class="calibre_27"><span class="calibre_13"> Because there are many kinds of authentication scenarios, PAM employs a number of dynamically loadable </span><span class="italic">authentication modules</span><span class="calibre_13">. Each module performs a specific task and is a shared object that processes can load dynamically and run in their executable space. For example, </span><span class="italic">pam_unix.so</span><span class="calibre_13"> is a module that can check a user’s password.</span></p><p class="calibre_27"><span class="calibre_13">This is tricky business, to say the least. The programming interface isn’t easy, and it’s not clear that PAM actually solves all of the existing problems. Nevertheless, PAM is supported in nearly every program that requires authentication on a Linux system, and most distributions use PAM. And because it works on top of the existing Unix authentication API, integrating support into a client requires little, if any, extra work.</span></p><p id="calibre_link-217" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.10.1 PAM Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">We’ll explore the basics of how PAM works by examining its configuration. You’ll normally find PAM’s application configuration files in the </span><span class="italic">/etc/pam.d</span><span class="calibre_13"> directory (older systems may use a single </span><span class="italic">/etc/pam.conf</span><span class="calibre_13"> file). Most installations include many files, so you may not know where to start. Some filenames, such as </span><span class="italic">cron</span><span class="calibre_13"> and </span><span class="italic">passwd</span><span class="calibre_13">, correspond to parts of the system that you know already.</span></p><p class="calibre_27"><span class="calibre_13"> Because the specific configuration in these files varies significantly between distributions, it can be difficult to find a commonly applicable example. We’ll look at an example configuration line that you might find for </span><span class="calibre3">chsh</span><span class="calibre_13"> (the change shell program):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requisite&nbsp;&nbsp; pam_shells.so</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This line says that the user’s shell must be listed in </span><span class="italic">/etc/shells</span><span class="calibre_13"> in order for the user to successfully authenticate with the </span><span class="calibre3">chsh</span><span class="calibre_13"> program. Let’s see how. Each configuration line has three fields: a function type, control argument, and module, in that order. Here’s what they mean for this example:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Function type</span> The function that a user application asks PAM to perform. Here, it’s <span class="calibre3">auth</span>, the task of authenticating the user.</li><li value="2" class="calibre_8"><span class="bold">Control argument</span> This setting controls what PAM does <span class="italic">after</span> success or failure of its action for the current line (<span class="calibre3">requisite</span> in this example). We’ll get to this shortly.</li><li value="3" class="calibre_8"><span class="bold">Module</span> The authentication module that runs for this line, determining what the line actually does. Here, the <span class="italic">pam_shells.so</span> module checks to see whether the user’s current shell is listed in <span class="italic">/etc/shells</span>.</li></ol><p class="calibre_33"><span class="calibre_13">PAM configuration is detailed on the pam.conf(5) manual page. Let’s look at a few of the essentials.</span></p><p class="calibre_46"><span class="bold">Function Types</span></p><p class="calibre_25"><span class="calibre_13">A user application can ask PAM to perform one of the following four functions:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">auth</span></span> Authenticate a user (see if the user is who they say they are).</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">account</span></span> Check user account status (whether the user is authorized to do something, for example).</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">session</span></span> Perform something only for the user’s current session (such as displaying a message of the day).</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">password</span></span> Change a user’s password or other credentials.</li></ol><p class="calibre_33"><span class="calibre_13"> For any configuration line, the module and function together determine PAM’s action. A module can have more than one function type, so when determining the purpose of a configuration line, always remember to consider the function and module as a pair. For example, the </span><span class="italic">pam_unix.so</span><span class="calibre_13"> module checks a password when performing the </span><span class="calibre3">auth</span><span class="calibre_13"> function, but it sets a password when performing the </span><span class="calibre3">password</span><span class="calibre_13"> function.</span></p><p class="calibre_46"><span class="bold">Control Arguments and Stacked Rules</span></p><p class="calibre_25"><span class="calibre_13">One important feature of PAM is that the rules specified by its configuration lines </span><span class="italic">stack</span><span class="calibre_13">, meaning that you can apply many rules when performing a function. This is why the control argument is important: the success or failure of an action in one line can impact subsequent lines or cause the entire function to succeed or fail.</span></p><p class="calibre_27"><span class="calibre_13">There are two kinds of control arguments: the simple syntax and a more advanced syntax. Here are the three major simple syntax control arguments that you’ll find in a rule:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">sufficient</span></span> If this rule succeeds, the authentication is successful, and PAM doesn’t need to look at any more rules. If the rule fails, PAM proceeds to additional rules.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">requisite</span></span> If this rule succeeds, PAM proceeds to additional rules. If the rule fails, the authentication is unsuccessful, and PAM doesn’t need to look at any more rules.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">required</span></span> If this rule succeeds, PAM proceeds to additional rules. If the rule fails, PAM proceeds to additional rules but will always return an unsuccessful authentication regardless of the end result of the additional rules.</li></ol><p class="calibre_33"><span class="calibre_13"> Continuing with the preceding example, here is an example stack for the </span><span class="calibre3">chsh</span><span class="calibre_13"> authentication function:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sufficient&nbsp;&nbsp;&nbsp;&nbsp; pam_rootok.so<br class="calibre7" />auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requisite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pam_shells.so<br class="calibre7" />auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sufficient&nbsp;&nbsp;&nbsp;&nbsp; pam_unix.so<br class="calibre7" />auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; required&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pam_deny.so</span></blockquote></blockquote><p id="calibre_link-623" class="calibre_30"><span class="calibre_13">With this configuration, when the </span><span class="calibre3">chsh</span><span class="calibre_13"> command asks PAM to perform the authentication function, PAM does the following (see </span><a></a><a href="#calibre_link-520"><span class="italic"><span class="calibre_4">Figure 7-4</span></span></a><span class="calibre_13"> for a flowchart):</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The <span class="italic">pam_rootok.so</span> module checks to see if root is the user trying to authenticate. If so, it immediately succeeds and attempts no further authentication. This works because the control argument is set to <span class="calibre3">sufficient</span>, meaning that success from this action is good enough for PAM to immediately report success back to <span class="calibre3">chsh</span>. Otherwise, it proceeds to step 2. <blockquote class="calibre_16"><blockquote class="calibre_29"><img src="images/000018.jpg" class="calibre_89" />
</blockquote></blockquote><blockquote class="calibre_61"><blockquote class="calibre_29"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 7-4</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: PAM rule execution flow</span></span></span></blockquote></blockquote></li><a id="calibre_link-520"></a><li value="2" class="calibre_3">The <span class="italic">pam_shells.so</span> module checks to see if the user’s shell is listed in <span class="italic">/etc/shells</span>. If it’s not there, the module returns failure, and the <span class="calibre3">requisite</span> control argument indicates that PAM must immediately report this failure back to <span class="calibre3">chsh</span> and attempt no further authentication. Otherwise, the module returns success and fulfills the control flag of <span class="calibre3">requisite</span>; proceed to step 3.</li><a></a><li value="3" class="calibre_8">The <span class="italic">pam_unix.so</span> module asks the user for their password and checks it. The control argument is set to <span class="calibre3">sufficient</span>, so success from this module (a correct password) is enough for PAM to report success to <span class="calibre3">chsh</span>. If the password is incorrect, PAM continues to step 4.</li><li value="4" class="calibre_8">The <span class="italic">pam_deny.so</span> module always fails, and because the control argument is set to <span class="calibre3">required</span>, PAM reports failure back to <span class="calibre3">chsh</span>. This is a default for when there’s nothing left to try. (Note that a <span class="calibre3">required</span> control argument doesn’t cause PAM to fail its function immediately&mdash;it will run any lines left on its stack&mdash;but PAM will always report failure back to the application.) <blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t confuse the terms </span></span>function<span class="italic"><span class="calibre_13"> and </span></span>action<span class="italic"><span class="calibre_13"> when working with PAM. The function is the high-level goal: what the user application wants PAM to do (authenticate a user, for example). An action is a specific step that PAM takes in order to reach that goal. Just remember that the user application invokes the function first and that PAM takes care of the particulars with actions.</span></span></blockquote></blockquote></li></ol><div class="mbp_pagebreak"></div><p class="calibre_30"><span class="calibre_13"> The advanced control argument syntax, denoted inside square brackets (</span><span class="calibre3">[]</span><span class="calibre_13">), allows you to manually control a reaction based on the specific return value of the module (not just success or failure). For details, see the pam.conf(5) manual page; when you understand the simple syntax, you’ll have no trouble with the advanced syntax.</span></p><p class="calibre_46"><span class="bold">Module Arguments</span></p><p class="calibre_25"><span class="calibre_13">PAM modules can take arguments after the module name. You’ll often encounter this example with the </span><span class="italic">pam_unix.so</span><span class="calibre_13"> module:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">auth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sufficient&nbsp;&nbsp; pam_unix.so&nbsp;&nbsp; nullok</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">nullok</span><span class="calibre_13"> argument here says that the user can have no password (the default would be failure if the user has no password).</span></p><p id="calibre_link-218" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.10.2 Tips on PAM Configuration Syntax</span></span></span></p><p class="calibre_45"><span class="calibre_13">Due to its control flow capability and module argument syntax, the PAM configuration syntax has many features of a programming language and a certain degree of power. We’ve only scratched the surface so far, but here are a few more tips on PAM:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> To find out which PAM modules are present on your system, try <span class="calibre3">man -k pam_</span> (note the underscore). It can be difficult to track down the location of modules. Try the <span class="calibre3">locate pam_unix.so</span> command and see where that leads you.</li><li value="2" class="calibre_8">The manual pages contain the functions and arguments for each module.</li><a id="calibre_link-725"></a><li value="3" class="calibre_8"> Many distributions automatically generate certain PAM configuration files, so it may not be wise to change them directly in <span class="italic">/etc/pam.d</span>. Read the comments in your <span class="italic">/etc/pam.d</span> files before editing them; if they’re generated files, the comments will tell you where they came from.</li><li value="4" class="calibre_8"> The <span class="italic">/etc/pam.d/other</span> configuration file defines the default configuration for any application that lacks its own configuration file. The default is often to deny everything.</li><li value="5" class="calibre_8"> There are different ways to include additional configuration files in a PAM configuration file. The <span class="calibre3">@include</span> syntax loads an entire configuration file, but you can also use a control argument to load only the configuration for a particular function. The usage varies among distributions.</li><li value="6" class="calibre_8"> PAM configuration doesn’t end with module arguments. Some modules can access additional files in <span class="italic">/etc/security</span>, usually to configure per-user restrictions.</li></ul><p id="calibre_link-219" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">7.10.3 PAM and Passwords</span></span></span></p><p class="calibre_45"><span class="calibre_13">Due to the evolution of Linux password verification over the years, there are a number of password configuration artifacts that can cause confusion at times. The first to be aware of is the file </span><span class="italic">/etc/login.defs</span><span class="calibre_13">. This is the configuration file for the original shadow password suite. It contains information about the encryption algorithm used for the </span><span class="italic">/etc/shadow</span><span class="calibre_13"> password file, but it’s rarely used on a system with PAM installed, because the PAM configuration contains this information. This said, the encryption algorithm in </span><span class="italic">/etc/login.defs</span><span class="calibre_13"> should match the PAM configuration in the rare case that you run into an application that doesn’t support PAM.</span></p><p class="calibre_27"><span class="calibre_13"> Where does PAM get its information about the password encryption scheme? Remember that there are two ways for PAM to interact with passwords: the </span><span class="calibre3">auth</span><span class="calibre_13"> function (for verifying a password) and the </span><span class="calibre3">password</span><span class="calibre_13"> function (for setting a password). It’s easiest to track down the password-setting parameter. The best way is probably just to </span><span class="calibre3">grep</span><span class="calibre_13"> it:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep password.*unix /etc/pam.d/*</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The matching lines should contain </span><span class="italic">pam_unix.so</span><span class="calibre_13"> and look something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sufficient&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pam_unix.so obscure sha512</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The arguments </span><span class="calibre3">obscure</span><span class="calibre_13"> and </span><span class="calibre3">sha512</span><span class="calibre_13"> tell PAM what to do when setting a password. First, PAM checks to see if the password is “obscure” enough (that is, the password isn’t too similar to the old password, among other things), and then PAM uses the SHA512 algorithm to encrypt the new password.</span></p><p id="calibre_link-726" class="calibre_27"><span class="calibre_13">But this happens </span><span class="italic">only</span><span class="calibre_13"> when a user </span><span class="italic">sets</span><span class="calibre_13"> a password, not when PAM is </span><span class="italic">verifying</span><span class="calibre_13"> a password. So how does PAM know which algorithm to use when authenticating? Unfortunately, the configuration won’t tell you anything; there are no encryption arguments for </span><span class="italic">pam_unix.so</span><span class="calibre_13"> for the </span><span class="calibre3">auth</span><span class="calibre_13"> function. The manual pages also tell you nothing.</span></p><p class="calibre_27"><span class="calibre_13"> It turns out that (as of this writing) </span><span class="italic">pam_unix.so</span><span class="calibre_13"> simply tries to guess the algorithm, usually by asking the libcrypt library to do the dirty work of trying a whole bunch of things until something works or there’s nothing left to try. Therefore, you normally don’t have to worry about the verification encryption algorithm.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-220" class="calibre_23"><span class="calibre1"><span class="bold"> 7.11 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">We’re now at about the midpoint in our progression through this book, having covered many of the vital building blocks of a Linux system. The discussion of logging and users on a Linux system has shown you how it’s possible to divide services and tasks into small, independent chunks that can still interact to a certain extent.</span></p><p class="calibre_27"><span class="calibre_13"> This chapter dealt almost exclusively with user space, and now we need to refine our view of user-space processes and the resources they consume. To do so, we’ll go back into the kernel in </span>Chapter 8<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-221" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-813" class="calibre_10"><span class="calibre4"><span class="bold">8</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">A CLOSER LOOK AT PROCESSES AND RESOURCE UTILIZATION</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter takes you deeper into the relationships between processes, the kernel, and system resources. There are three basic kinds of hardware resources: CPU, memory, and I/O. Processes vie for these resources, and the kernel’s job is to allocate resources fairly. The kernel itself is also a resource&mdash;a software resource that processes use to perform tasks such as creating new processes and communicating with other processes.</span></span></p><p class="calibre_33"><span class="calibre_13"> Many of the tools that you see in this chapter are considered performance-monitoring tools. They’re particularly helpful if your system is slowing to a crawl and you’re trying to figure out why. However, you shouldn’t get distracted by performance. Trying to optimize a system that’s already working correctly is a waste of time. The default settings on most systems are well chosen, so you should change them only if you have very unusual needs. Instead, concentrate on understanding </span><a id="calibre_link-654"></a><span class="italic">what</span><span class="calibre_13"> the tools actually measure, and you’ll gain great insight into how the kernel works and how it interacts with processes.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-222" class="calibre_23"><span class="calibre1"><span class="bold"> 8.1 Tracking Processes</span></span></p><p class="calibre_24"><span class="calibre_13">You learned how to use </span><span class="calibre3">ps</span><span class="calibre_13"> in </span>Section 2.16<span class="calibre_13"> to list processes running on your system at a particular time. The </span><span class="calibre3">ps</span><span class="calibre_13"> command lists current processes and their usage statistics, but it does little to tell you how processes change over time. Therefore, it won’t immediately help you to determine which process is using too much CPU time or memory.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">top</span><span class="calibre_13"> program provides an interactive interface to the information that </span><span class="calibre3">ps</span><span class="calibre_13"> displays. It shows the current system status as well as the fields a </span><span class="calibre3">ps</span><span class="calibre_13"> listing shows, and it updates every second. Perhaps most important, </span><span class="calibre3">top</span><span class="calibre_13"> lists the most active processes (by default, those currently taking up the most CPU time) at the top of its display.</span></p><p class="calibre_27"><span class="calibre_13"> You can send commands to </span><span class="calibre3">top</span><span class="calibre_13"> with keystrokes. Its most frequently used commands deal with changing the sort order or filtering the process list:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Spacebar</span> Updates the display immediately</li><li value="2" class="calibre_8"><span class="bold">M</span> Sorts by current resident memory usage</li><li value="3" class="calibre_8"><span class="bold">T</span> Sorts by total (cumulative) CPU usage</li><li value="4" class="calibre_8"><span class="bold">P</span> Sorts by current CPU usage (the default)</li><li value="5" class="calibre_8"><span class="bold">u</span> Displays only one user’s processes</li><li value="6" class="calibre_8"><span class="bold">f</span> Selects different statistics to display</li><li value="7" class="calibre_8"><span class="bold">?</span> Displays a usage summary for all <span class="calibre3">top</span> commands</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">top</span><span class="italic"><span class="calibre_13"> keystroke commands are case-sensitive.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Two similar utilities, </span><span class="calibre3">atop</span><span class="calibre_13"> and </span><span class="calibre3">htop</span><span class="calibre_13">, offer an enhanced set of views and features. Most of their extra features add functionality found in other tools. For example, </span><span class="calibre3">htop</span><span class="calibre_13"> shares many of the </span><span class="calibre3">lsof</span><span class="calibre_13"> command’s abilities described in the next section.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-223" class="calibre_23"><span class="calibre1"><span class="bold"> 8.2 Finding Open Files with lsof</span></span></p><p class="calibre_24"><span class="calibre_13">The </span><span class="calibre3">lsof</span><span class="calibre_13"> command lists open files and the processes using them. Because Unix places a lot of emphasis on files, </span><span class="calibre3">lsof</span><span class="calibre_13"> is among the most useful tools for finding trouble spots. But </span><span class="calibre3">lsof</span><span class="calibre_13"> doesn’t stop at regular files&mdash;it can list network resources, dynamic libraries, pipes, and more.</span></p><p id="calibre_link-224" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.2.1 Reading the lsof Output</span></span></span></p><p class="calibre_45"><span class="calibre_13">Running </span><span class="calibre3">lsof</span><span class="calibre_13"> on the command line usually produces a tremendous amount of output. The following is a fragment of what you might see. This output (slightly adjusted for readability) includes open files from the systemd (init) process as well as a running </span><span class="calibre3">vi</span><span class="calibre_13"> process:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof</span></span><span class="calibre3"><br class="calibre7" />COMMAND&nbsp; PID&nbsp;&nbsp; USER&nbsp;&nbsp; FD&nbsp;&nbsp;&nbsp; TYPE&nbsp;&nbsp;&nbsp; DEVICE&nbsp; SIZE/OFF&nbsp;&nbsp;&nbsp; NODE NAME<br class="calibre7" />systemd&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; root&nbsp; cwd&nbsp;&nbsp;&nbsp;&nbsp; DIR&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 /<br class="calibre7" />systemd&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; root&nbsp; rtd&nbsp;&nbsp;&nbsp;&nbsp; DIR&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 /<br class="calibre7" />systemd&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; root&nbsp; txt&nbsp;&nbsp;&nbsp;&nbsp; REG&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp; 1595792&nbsp;&nbsp;&nbsp; 9961784 /lib/systemd/systemd<br class="calibre7" />systemd&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; root&nbsp; mem&nbsp;&nbsp;&nbsp;&nbsp; REG&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp; 1700792&nbsp;&nbsp;&nbsp; 9961570 /lib/x86_64-linux-gnu/libm-2.27.so<br class="calibre7" />systemd&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; root&nbsp; mem&nbsp;&nbsp;&nbsp;&nbsp; REG&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp;&nbsp; 121016&nbsp;&nbsp;&nbsp; 9961695 /lib/x86_64-linux-gnu/libudev.so.1<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />vi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1994&nbsp;&nbsp; juser&nbsp; cwd&nbsp;&nbsp;&nbsp; DIR&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096&nbsp;&nbsp;&nbsp; 4587522 /home/juser<br class="calibre7" />vi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1994&nbsp;&nbsp; juser&nbsp;&nbsp; 3u&nbsp;&nbsp;&nbsp; REG&nbsp;&nbsp;&nbsp; 8,1&nbsp;&nbsp;&nbsp;&nbsp; 12288&nbsp;&nbsp;&nbsp;&nbsp; 786440 /tmp/.ff.swp<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output lists the following fields in the top row:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">COMMAND</span></span> The command name for the process that holds the file descriptor.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">PID</span></span> The process ID.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">USER</span></span> The user running the process.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">FD</span></span> This field can contain two kinds of elements. In most of the preceding output, the <span class="calibre3">FD</span> column shows the purpose of the file. The <span class="calibre3">FD</span> field can also list the <span class="italic">file descriptor</span> of the open file&mdash;a number that a process uses together with the system libraries and kernel to identify and manipulate a file; the last line shows a file descriptor of <span class="calibre3">3</span>.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">TYPE</span></span> The file type (regular file, directory, socket, and so on).</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">DEVICE</span></span> The major and minor number of the device that holds the file.</li><li value="7" class="calibre_8"><span class="calibre3"><span class="bold">SIZE/OFF</span></span> The file’s size.</li><li value="8" class="calibre_8"><span class="calibre3"><span class="bold">NODE</span></span> The file’s inode number.</li><li value="9" class="calibre_8"><span class="calibre3"><span class="bold">NAME</span></span> The filename.</li></ol><p class="calibre_33"><span class="calibre_13"> The lsof(1) manual page contains a full list of what you might see for each field, but the output should be self-explanatory. For example, look at the entries with </span><span class="calibre3">cwd</span><span class="calibre_13"> in the </span><span class="calibre3">FD</span><span class="calibre_13"> field. Those lines indicate the current working directories of the processes. Another example is the very last line, which shows a temporary file that a user’s </span><span class="calibre3">vi</span><span class="calibre_13"> process (PID 1994) is using.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can run </span></span><span class="calibre3">lsof</span><span class="italic"><span class="calibre_13"> as root or a regular user, but you’ll get more information as root.</span></span></blockquote><p id="calibre_link-225" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">8.2.2 Using lsof</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are two basic approaches to running </span><span class="calibre3">lsof</span><span class="calibre_13">:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> List everything and pipe the output to a command like <span class="calibre3">less</span>, and then search for what you’re looking for. This can take a while due to the amount of output generated.</li><li value="2" class="calibre_8"> Narrow down the list that <span class="calibre3">lsof</span> provides with command-line options.</li></ul><p class="calibre_33"><span class="calibre_13"> You can use command-line options to provide a filename as an argument and have </span><span class="calibre3">lsof</span><span class="calibre_13"> list only the entries that match the argument. For example, the following command displays entries for open files in </span><span class="italic">/usr</span><span class="calibre_13"> and all of its subdirectories:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">lsof +D /usr</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">To list the open files for a particular process ID, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">lsof -p </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> For a brief summary of </span><span class="calibre3">lsof</span><span class="calibre_13">’s many options, run </span><span class="calibre3"><span class="bold">lsof -h</span></span><span class="calibre_13">. Most options pertain to the output format. (See </span>Chapter 10<span class="calibre_13"> for a discussion of the </span><span class="calibre3">lsof</span><span class="calibre_13"> network features.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="calibre3">lsof</span><span class="italic"><span class="calibre_13"> is highly dependent on kernel information. If you perform a distribution update to both the kernel and </span></span><span class="calibre3">lsof</span><span class="italic"><span class="calibre_13">, the updated </span></span><span class="calibre3">lsof</span><span class="italic"><span class="calibre_13"> might not work until you reboot with the new kernel.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-226" class="calibre_42"><span class="calibre1"><span class="bold"> 8.3 Tracing Program Execution and System Calls</span></span></p><p class="calibre_24"><span class="calibre_13">The tools we’ve seen so far examine active processes. However, if you have no idea why a program dies almost immediately after starting up, </span><span class="calibre3">lsof</span><span class="calibre_13"> won’t help you. In fact, you’d have a difficult time even running </span><span class="calibre3">lsof</span><span class="calibre_13"> concurrently with a failed command.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">strace</span><span class="calibre_13"> (system call trace) and </span><span class="calibre3">ltrace</span><span class="calibre_13"> (library trace) commands can help you discover what a program attempts to do. Those tools produce extraordinarily large amounts of output, but once you know what to look for, you’ll have more information at your disposal for tracking down problems.</span></p><p id="calibre_link-227" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.3.1 strace</span></span></span></p><p class="calibre_45"><span class="calibre_13">Recall that a </span><span class="italic">system call</span><span class="calibre_13"> is a privileged operation that a user-space process asks the kernel to perform, such as opening and reading data from a file. The </span><span class="calibre3">strace</span><span class="calibre_13"> utility prints all the system calls that a process makes. To see it in action, run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">strace cat /dev/null</span></span></blockquote></blockquote><p id="calibre_link-752" class="calibre_30"><span class="calibre_13">By default, </span><span class="calibre3">strace</span><span class="calibre_13"> sends its output to the standard error. If you want to save the output in a file, use the </span><span class="calibre3">-o </span><span class="calibre3"><span class="italic">save_file</span></span><span class="calibre_13"> option. You can also redirect by appending </span><span class="calibre3">2&gt; </span><span class="calibre3"><span class="italic">save_file</span></span><span class="calibre_13"> to your command line, but you’ll also capture any standard error from the command you’re examining.</span></p><p class="calibre_27"><span class="calibre_13"> In </span>Chapter 1<span class="calibre_13">, you learned that when one process wants to start another process, it invokes the </span><span class="calibre3">fork()</span><span class="calibre_13"> system call to spawn a copy of itself, and then the copy uses a member of the </span><span class="calibre3">exec()</span><span class="calibre_13"> family of system calls to start running a new program. The </span><span class="calibre3">strace</span><span class="calibre_13"> command begins working on the new process (the copy of the original process) just after the </span><span class="calibre3">fork()</span><span class="calibre_13"> call. Therefore, the first lines of the output from this command should show </span><span class="calibre3">execve()</span><span class="calibre_13"> in action, followed by a memory initialization call, </span><span class="calibre3">brk()</span><span class="calibre_13">, as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">execve("/bin/cat", ["cat", "/dev/null"], 0x7ffef0be0248 /* 59 vars */) = 0<br class="calibre7" />brk(NULL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0x561e83127000</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The next part of the output deals primarily with loading shared libraries. You can ignore this unless you really want to dig deep into the shared library system:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">access("/etc/ld.so.nohwcap", F_OK)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = -1 ENOENT (No such file or directory)<br class="calibre7" />openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3<br class="calibre7" />fstat(3, {st_mode=S_IFREG|0644, st_size=119531, ...}) = 0<br class="calibre7" />mmap(NULL, 119531, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7fa9db241000<br class="calibre7" />close(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3<br class="calibre7" />read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260\34\2\0\0\0\0\0"..., 832) = 832</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In addition, skip past the </span><span class="calibre3">mmap</span><span class="calibre_13"> output until you get to the lines near the end of the output that look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(0x88, 1), ...}) = 0<br class="calibre7" />openat(AT_FDCWD, "/dev/null", O_RDONLY) = 3<br class="calibre7" />fstat(3, {st_mode=S_IFCHR|0666, st_rdev=makedev(0x1, 3), ...}) = 0<br class="calibre7" />fadvise64(3, 0, 0, POSIX_FADV_SEQUENTIAL) = 0<br class="calibre7" />mmap(NULL, 139264, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fa9db21b000<br class="calibre7" />read(3, "", 131072)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />munmap(0x7fa9db21b000, 139264)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />close(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />close(1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />close(2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0<br class="calibre7" />exit_group(0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = ?<br class="calibre7" />+++ exited with 0 +++</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This part of the output shows the command at work. First, look at the </span><span class="calibre3">openat()</span><span class="calibre_13"> call (a slight variant of </span><span class="calibre3">open()</span><span class="calibre_13">), which opens a file. The </span><span class="calibre3">3</span><span class="calibre_13"> is a result that means success (</span><span class="calibre3">3</span><span class="calibre_13"> is the file descriptor that the kernel returns after opening the file). Below that, you can see where </span><a id="calibre_link-731"></a><span class="calibre3">cat</span><span class="calibre_13"> reads from </span><span class="italic">/dev/null</span><span class="calibre_13"> (the </span><span class="calibre3">read()</span><span class="calibre_13"> call, which also has </span><span class="calibre3">3</span><span class="calibre_13"> as the file descriptor). Then there’s nothing more to read, so the program closes the file descriptor and exits with </span><span class="calibre3">exit_group()</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> What happens when the command encounters an error? Try </span><span class="calibre3"><span class="bold">strace cat</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">not_a_file</span></span></span><span class="calibre_13"> instead and examine the </span><span class="calibre3">open()</span><span class="calibre_13"> call in the resulting output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">openat(AT_FDCWD, "not_a_file", O_RDONLY) = -1 ENOENT (No such file or directory)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Because </span><span class="calibre3">open()</span><span class="calibre_13"> couldn’t open the file, it returned </span><span class="calibre3">-1</span><span class="calibre_13"> to signal an error. You can see that </span><span class="calibre3">strace</span><span class="calibre_13"> reports the exact error and gives you a short description of the error.</span></p><p class="calibre_27"><span class="calibre_13"> Missing files are the most common problem with Unix programs, so if the system log and other log information aren’t very helpful and you have nowhere else to turn when you’re trying to track down a missing file, </span><span class="calibre3">strace</span><span class="calibre_13"> can be of great use. You can even use it on daemons that fork or detach themselves. For example, to track down the system calls of a fictitious daemon called </span><span class="calibre3">crummyd</span><span class="calibre_13">, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">strace -o crummyd_strace -ff crummyd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this example, the </span><span class="calibre3">-o</span><span class="calibre_13"> option to </span><span class="calibre3">strace</span><span class="calibre_13"> logs the action of any child process that </span><span class="calibre3">crummyd</span><span class="calibre_13"> spawns into </span><span class="calibre3">crummyd_strace.</span><span class="calibre3"><span class="italic">pid</span></span><span class="calibre_13">, where </span><span class="calibre3"><span class="italic">pid</span></span><span class="calibre_13"> is the process ID of the child process.</span></p><p id="calibre_link-228" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.3.2 ltrace</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">ltrace</span><span class="calibre_13"> command tracks shared library calls. The output is similar to that of </span><span class="calibre3">strace</span><span class="calibre_13">, which is why it’s being mentioned here, but it doesn’t track anything at the kernel level. Be warned that there are </span><span class="italic">many</span><span class="calibre_13"> more shared library calls than system calls. You’ll definitely need to filter the output, and </span><span class="calibre3">ltrace</span><span class="calibre_13"> itself has many built-in options to assist you.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> See </span></span><span class="italic">Section 15.1.3</span><span class="italic"><span class="calibre_13"> for more on shared libraries. The </span></span><span class="calibre3">ltrace</span><span class="italic"><span class="calibre_13"> command doesn’t work on statically linked binaries.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-229" class="calibre_42"><span class="calibre1"><span class="bold"> 8.4 Threads</span></span></p><p class="calibre_24"><span class="calibre_13">In Linux, some processes are divided into pieces called </span><span class="italic">threads</span><span class="calibre_13">. A thread is very similar to a process&mdash;it has an identifier (</span><span class="italic">thread ID</span><span class="calibre_13">, or </span><span class="italic">TID</span><span class="calibre_13">), and the kernel schedules and runs threads just like processes. However, unlike separate processes, which usually don’t share system resources such as memory and I/O connections with other processes, all threads inside a single process share their system resources and some memory.</span></p><p id="calibre_link-230" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.4.1 Single-Threaded and Multithreaded Processes</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many processes have only one thread. A process with one thread is </span><span class="italic">single-threaded</span><span class="calibre_13">, and a process with more than one thread is </span><span class="italic">multithreaded</span><span class="calibre_13">. All processes start out single-threaded. This starting thread is usually called the </span><a id="calibre_link-649"></a><span class="italic">main thread</span><span class="calibre_13">. The main thread may start new threads, making the process multithreaded, similar to the way a process can call </span><span class="calibre3">fork()</span><span class="calibre_13"> to start a new process.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> It’s rare to refer to threads at all when a process is single-threaded. This book doesn’t mention threads unless multithreaded processes make a difference in what you see or experience.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">The primary advantage of a multithreaded process is that when the process has a lot to do, threads can run simultaneously on multiple processors, potentially speeding up computation. Although you can also achieve simultaneous computation with multiple processes, threads start faster than processes, and it’s often easier or more efficient for threads to intercommunicate using their shared memory than it is for processes to communicate over a channel, such as a network connection or a pipe.</span></p><p class="calibre_27"><span class="calibre_13"> Some programs use threads to overcome problems managing multiple I/O resources. Traditionally, a process would sometimes use </span><span class="calibre3">fork()</span><span class="calibre_13"> to start a new subprocess in order to deal with a new input or output stream. Threads offer a similar mechanism without the overhead of starting a new process.</span></p><p id="calibre_link-231" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.4.2 Viewing Threads</span></span></span></p><p class="calibre_45"><span class="calibre_13">By default, the output from the </span><span class="calibre3">ps</span><span class="calibre_13"> and </span><span class="calibre3">top</span><span class="calibre_13"> commands shows only processes. To display the thread information in </span><span class="calibre3">ps</span><span class="calibre_13">, add the </span><span class="calibre3">m</span><span class="calibre_13"> option. </span><a></a><a href="#calibre_link-521"><span class="italic"><span class="calibre_4">Listing 8-1</span></span></a><span class="calibre_13"> shows some sample output.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps m</span></span><span class="calibre3"> PID TTY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STAT&nbsp;&nbsp; TIME COMMAND 3587 pts/3&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:00 bash1 - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ss&nbsp;&nbsp;&nbsp;&nbsp; 0:00 - 3592 pts/4&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:00 bash2 - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ss&nbsp;&nbsp;&nbsp;&nbsp; 0:00 -<br class="calibre7" />12534 tty7&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp; 668:30 /usr/lib/xorg/Xorg -core :03 - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ssl+ 659:55 - - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ssl+&nbsp;&nbsp; 0:00 - - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ssl+&nbsp;&nbsp; 0:00 - - -&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ssl+&nbsp;&nbsp; 8:35 - </span></blockquote></blockquote><blockquote id="calibre_link-521" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 8-1</span></span><span class="italic"><span class="calibre_13">: Viewing threads with </span></span><span class="calibre3"><span class="italic">ps m</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> This listing shows processes along with threads. Each line with a number in the PID column (at </span>1<span class="calibre_13">, </span>2<span class="calibre_13">, and </span>3<span class="calibre_13">) represents a process, as in the normal </span><span class="calibre3">ps</span><span class="calibre_13"> output. The lines with dashes in the PID column represent the threads associated with the process. In this output, the processes at </span>1<span class="calibre_13"> and </span>2<span class="calibre_13"> have only one thread each, but process 12534 at </span>3<span class="calibre_13"> is multithreaded, with four threads.</span></p><p id="calibre_link-851" class="calibre_27"><span class="calibre_13">If you want to view the TIDs with </span><span class="calibre3">ps</span><span class="calibre_13">, you can use a custom output format. </span><a></a><a href="#calibre_link-522"><span class="italic"><span class="calibre_4">Listing 8-2</span></span></a><span class="calibre_13"> shows only the PIDs, TIDs, and command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps m -o pid,tid,command</span></span><span class="calibre3"> PID&nbsp;&nbsp; TID&nbsp;&nbsp;&nbsp; COMMAND 3587&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp; bash -&nbsp; 3587&nbsp;&nbsp;&nbsp; - 3592&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp; bash -&nbsp; 3592&nbsp;&nbsp;&nbsp; - 12534&nbsp;&nbsp;&nbsp; -&nbsp;&nbsp;&nbsp; /usr/lib/xorg/Xorg -core :0 - 12534&nbsp;&nbsp;&nbsp; - - 13227&nbsp;&nbsp;&nbsp; - - 14443&nbsp;&nbsp;&nbsp; - - 14448&nbsp;&nbsp;&nbsp; -</span></blockquote></blockquote><blockquote id="calibre_link-522" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 8-2</span></span><span class="italic"><span class="calibre_13">: Showing PIDs and TIDs with </span></span><span class="calibre3"><span class="italic">ps m</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The sample output in this listing corresponds to the threads shown in </span><a href="#calibre_link-521"><span class="italic"><span class="calibre_4">Listing 8-1</span></span></a><span class="calibre_13">. Notice that the TIDs of the single-threaded processes are identical to the PIDs; this is the main thread. For the multithreaded process 12534, thread 12534 is also the main thread.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Normally, you won’t interact with individual threads as you would processes. You need to know a lot about how a multithreaded program was written in order to act on one thread at a time, and even then, doing so might not be a good idea.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Threads can confuse things when it comes to resource monitoring because individual threads in a multithreaded process can consume resources simultaneously. For example, </span><span class="calibre3">top</span><span class="calibre_13"> doesn’t show threads by default; you’ll need to press H to turn it on. For most of the resource monitoring tools that you’re about to see, you’ll have to do a little extra work to turn on the thread display.</span></p><div class="mbp_pagebreak"></div><p class="calibre_23"><span class="calibre1"><span class="bold"> 8.5 Introduction to Resource Monitoring</span></span></p><p class="calibre_24"><span class="calibre_13">Now we’ll discuss some topics in resource monitoring, including processor (CPU) time, memory, and disk I/O. We’ll examine utilization on a system-wide scale, as well as on a per-process basis.</span></p><p class="calibre_27"><span class="calibre_13">Many people touch the inner workings of the Linux kernel in the interest of improving performance. However, most Linux systems perform well under a distribution’s default settings, and you can spend days trying to tune your machine’s performance without meaningful results, especially if you don’t know what to look for. So rather than think about performance as you experiment with the tools in this chapter, think about seeing the kernel in action as it divides resources among processes.</span></p><p id="calibre_link-232" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.1 Measuring CPU Time</span></span></span></p><p class="calibre_45"><span class="calibre_13">To monitor one or more specific processes over time, use the </span><span class="calibre3">-p</span><span class="calibre_13"> option to </span><span class="calibre3">top</span><span class="calibre_13">, with this syntax:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">top -p </span></span><span class="calibre3"><span class="italic"><span class="bold">pid1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">[</span></span></span><span class="calibre3"><span class="bold">-p </span></span><span class="calibre3"><span class="italic"><span class="bold">pid2 ...]</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To find out how much CPU time a command uses during its lifetime, use </span><span class="calibre3">time</span><span class="calibre_13">. Unfortunately, there is some confusion here, because most shells have a built-in </span><span class="calibre3">time</span><span class="calibre_13"> command that doesn’t provide extensive statistics, and there’s a system utility at </span><span class="calibre3">/usr/bin/time</span><span class="calibre_13">. You’ll probably encounter the </span><span class="calibre3">bash</span><span class="calibre_13"> shell built-in first, so try running </span><span class="calibre3">time</span><span class="calibre_13"> with the </span><span class="calibre3">ls</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">time ls</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> After </span><span class="calibre3">ls</span><span class="calibre_13"> terminates, </span><span class="calibre3">time</span><span class="calibre_13"> should print output like the following:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">real&nbsp;&nbsp;&nbsp; 0m0.442s<br class="calibre7" />user&nbsp;&nbsp;&nbsp; 0m0.052s<br class="calibre7" />sys&nbsp;&nbsp;&nbsp;&nbsp; 0m0.091s</span></blockquote></blockquote><p class="calibre_30"><span class="italic">User time</span><span class="calibre_13"> (</span><span class="calibre3">user</span><span class="calibre_13">) is the number of seconds that the CPU has spent running the program’s </span><span class="italic">own</span><span class="calibre_13"> code. Some commands run so quickly that the CPU time is close to 0. The </span><span class="italic">system time</span><span class="calibre_13"> (</span><span class="calibre3">sys</span><span class="calibre_13"> or </span><span class="calibre3">system</span><span class="calibre_13">) is how much time the kernel spends doing the process’s work (for example, reading files and directories). Finally, real time (</span><span class="calibre3">real</span><span class="calibre_13">) (also called </span><span class="italic">elapsed time</span><span class="calibre_13">) is the total time it took to run the process from start to finish, including the time that the CPU spent doing other tasks. This number is normally not very useful for performance measurement, but subtracting the user and system time from elapsed time can give you a general idea of how long a process spends waiting for system and external resources. For example, the time spent waiting for a network server to respond to a request would show up in the elapsed time, but not in the user or system time.</span></p><p id="calibre_link-233" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.2 Adjusting Process Priorities</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can change the way the kernel schedules a process in order to give the process more or less CPU time than other processes. The kernel runs each process according to its scheduling </span><span class="italic">priority</span><span class="calibre_13">, which is a number between &ndash;20 and 20, with &ndash;20 being the foremost priority. (Yes, this can be confusing.)</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">ps -l</span><span class="calibre_13"> command lists the current priority of a process, but it’s a little easier to see the priorities in action with the </span><span class="calibre3">top</span><span class="calibre_13"> command, as shown here:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">top</span></span><span class="calibre3"><br class="calibre7" />Tasks: 244 total,&nbsp;&nbsp; 2 running, 242 sleeping,&nbsp;&nbsp; 0 stopped,&nbsp;&nbsp; 0 zombie<br class="calibre7" />Cpu(s): 31.7%us,&nbsp; 2.8%sy,&nbsp; 0.0%ni, 65.4%id,&nbsp; 0.2%wa,&nbsp; 0.0%hi,&nbsp; 0.0%si,&nbsp; 0.0%st<br class="calibre7" />Mem:&nbsp;&nbsp; 6137216k total,&nbsp; 5583560k used,&nbsp;&nbsp; 553656k free,&nbsp;&nbsp;&nbsp; 72008k buffers<br class="calibre7" />Swap:&nbsp; 4135932k total,&nbsp;&nbsp; 694192k used,&nbsp; 3441740k free,&nbsp;&nbsp; 767640k cached&nbsp; PID USER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PR&nbsp; NI&nbsp; VIRT&nbsp; RES&nbsp; SHR S %CPU %MEM&nbsp;&nbsp;&nbsp; TIME+&nbsp; COMMAND <br class="calibre7" />28883 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0 1280m 763m&nbsp; 32m S&nbsp;&nbsp; 58 12.7 213:00.65 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 1175 root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 210m&nbsp; 43m&nbsp; 28m R&nbsp;&nbsp; 44&nbsp; 0.7&nbsp; 14292:35 Xorg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4022 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 413m 201m&nbsp; 28m S&nbsp;&nbsp; 29&nbsp; 3.4&nbsp;&nbsp; 3640:13 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 4029 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 378m 206m&nbsp; 19m S&nbsp;&nbsp;&nbsp; 2&nbsp; 3.5&nbsp; 32:50.86 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 3971 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 881m 359m&nbsp; 32m S&nbsp;&nbsp;&nbsp; 2&nbsp; 6.0 563:06.88 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 5378 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 152m&nbsp; 10m 7064 S&nbsp;&nbsp;&nbsp; 1&nbsp; 0.2&nbsp; 24:30.21 xfce4-session&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3821 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 312m&nbsp; 37m&nbsp; 14m S&nbsp;&nbsp;&nbsp; 0&nbsp; 0.6&nbsp; 29:25.57 soffice.bin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4117 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 321m 105m&nbsp; 18m S&nbsp;&nbsp;&nbsp; 0&nbsp; 1.8&nbsp; 34:55.01 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 4138 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 331m&nbsp; 99m&nbsp; 21m S&nbsp;&nbsp;&nbsp; 0&nbsp; 1.7 121:44.19 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 4274 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 232m&nbsp; 60m&nbsp; 13m S&nbsp;&nbsp;&nbsp; 0&nbsp; 1.0&nbsp; 37:33.78 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp; 4267 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0 1102m 844m&nbsp; 11m S&nbsp;&nbsp;&nbsp; 0 14.1&nbsp; 29:59.27 chromium-browse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2327 bri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20&nbsp;&nbsp; 0&nbsp; 301m&nbsp; 43m&nbsp; 16m S&nbsp;&nbsp;&nbsp; 0&nbsp; 0.7 109:55.65 xfce4-panel </span></blockquote><a id="calibre_link-650"></a></blockquote><p class="calibre_30"><span class="calibre_13"> In this </span><span class="calibre3">top</span><span class="calibre_13"> output, the </span><span class="calibre3">PR</span><span class="calibre_13"> (priority) column lists the kernel’s current schedule priority for the process. The higher the number, the less likely the kernel is to schedule the process if others need CPU time. The schedule priority alone doesn’t determine the kernel’s decision to give CPU time to a process, however, and the kernel may also change the priority during program execution according to the amount of CPU time the process consumes.</span></p><p class="calibre_27"><span class="calibre_13"> Next to the priority column is the </span><span class="calibre3">NI</span><span class="calibre_13"> (</span><span class="italic">nice value</span><span class="calibre_13">) column, which gives a hint to the kernel’s scheduler. This is what you care about when trying to influence the kernel’s decision. The kernel adds the nice value to the current priority to determine the next time slot for the process. When you set the nice value higher, you’re being “nicer” to other processes because the kernel prioritizes them.</span></p><p class="calibre_27"><span class="calibre_13"> By default, the nice value is 0. Now, say you’re running a big computation in the background that you don’t want to bog down your interactive session. To make that process take a back seat to other processes and run only when the other tasks have nothing to do, you can change the nice value to 20 with the </span><span class="calibre3">renice</span><span class="calibre_13"> command (where </span><span class="calibre3"><span class="italic">pid</span></span><span class="calibre_13"> is the process ID of the process that you want to change):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">renice 20 </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">If you’re the superuser, you can set the nice value to a negative number, but doing so is almost always a bad idea because system processes may not get enough CPU time. In fact, you probably won’t need to alter nice values much because many Linux systems have only a single user, and that user doesn’t perform much real computation. (The nice value was much more important back when there were many users on a single machine.)</span></p><p id="calibre_link-234" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.3 Measuring CPU Performance with Load Averages</span></span></span></p><p class="calibre_45"><span class="calibre_13">Overall CPU performance is one of the easier metrics to measure. The </span><span class="italic">load average</span><span class="calibre_13"> is the average number of processes currently ready to run. That is, it is an estimate of the number of processes that are </span><span class="italic">capable</span><span class="calibre_13"> of using the CPU at any given time&mdash;this includes processes that are running and those that are waiting for a chance to use the CPU. When thinking about a load average, keep in mind that most processes on your system are usually waiting for input (from the keyboard, mouse, or network, for example), meaning they’re not ready to run and shouldn’t contribute anything to the load average. Only processes that are actually doing something affect the load average.</span><a id="calibre_link-834"></a></p><p class="calibre_46"><span class="bold">Using uptime</span></p><p class="calibre_25"><span class="calibre_13">The </span><span class="calibre3">uptime</span><span class="calibre_13"> command tells you three load averages in addition to how long the kernel has been running:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">uptime</span></span><span class="calibre3"><br class="calibre7" />... up 91 days, ... load average: </span><span class="calibre3"><span class="bold">0.08, 0.03, 0.01</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The three bolded numbers are the load averages for the past 1 minute, 5 minutes, and 15 minutes, respectively. As you can see, this system isn’t very busy: an average of only 0.01 processes have been running across all processors for the past 15 minutes. In other words, if you had just one processor, it was running user-space applications for only 1 percent of the last 15 minutes.</span></p><p class="calibre_27"><span class="calibre_13"> Traditionally, most desktop systems would exhibit a load average of about 0 when you were doing anything </span><span class="italic">except</span><span class="calibre_13"> compiling a program or playing a game. A load average of 0 is usually a good sign, because it means that your processor isn’t being challenged and you’re saving power.</span></p><p class="calibre_27"><span class="calibre_13">However, user interface components on current desktop systems tend to occupy more of the CPU than those in the past. In particular, certain websites (and especially their advertisements) cause web browsers to become resource hogs.</span></p><p class="calibre_27"><span class="calibre_13"> If a load average goes up to around 1, a single process is probably using the CPU nearly all of the time. To identify that process, use the </span><span class="calibre3">top</span><span class="calibre_13"> command; the process will usually rise to the top of the display.</span></p><p class="calibre_27"><span class="calibre_13">Most modern systems have more than one processor core or CPU, so multiple processes can easily run simultaneously. If you have two cores, a load average of 1 means that only one of the cores is likely active at any given time, and a load average of 2 means that both cores have just enough to do all of the time.</span></p><p class="calibre_46"><span class="bold">Managing High Loads</span></p><p class="calibre_25"><span class="calibre_13">A high load average doesn’t necessarily mean that your system is having trouble. A system with enough memory and I/O resources can easily handle many running processes. If your load average is high and your system still responds well, don’t panic; the system just has a lot of processes sharing the CPU. The processes have to compete with one another for processor time, and as a result, they’ll take longer to perform their computations than they would if they were each allowed to use the CPU all the time. Another case where a high load average might be normal is with a web or compute server, where processes can start and terminate so quickly that the load average measurement mechanism can’t function effectively.</span></p><p class="calibre_27"><span class="calibre_13"> However, if the load average is very high and you sense that the system is slowing down, you might be running into memory performance problems. When the system is low on memory, the kernel can start to </span><a id="calibre_link-651"></a><span class="italic">thrash</span><span class="calibre_13">, or rapidly swap memory to and from the disk. When this happens, many processes will become ready to run, but their memory might not be available, so they’ll remain in the ready-to-run state (contributing to the load average) for much longer than they normally would. Next we’ll look at why this can happen by exploring memory in more detail.</span></p><p id="calibre_link-235" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.4 Monitoring Memory Status</span></span></span></p><p class="calibre_45"><span class="calibre_13">One of the simplest ways to check your system’s memory status as a whole is to run the </span><span class="calibre3">free</span><span class="calibre_13"> command or view </span><span class="italic">/proc/meminfo</span><span class="calibre_13"> to see how much real memory is being used for caches and buffers. As just mentioned, performance problems can arise from memory shortages. If not much cache/buffer memory is being used (and the rest of the real memory is taken), you may need more memory. However, it’s too easy to blame a shortage of memory for every performance problem on your machine.</span></p><p class="calibre_46"><span class="bold">How Memory Works</span></p><p class="calibre_25"><span class="calibre_13">As </span>Chapter 1<span class="calibre_13"> explained, the CPU has a memory management unit (MMU) to add flexibility in memory access. The kernel assists the MMU by breaking down the memory used by processes into smaller chunks called </span><span class="italic">pages</span><span class="calibre_13">. The kernel maintains a data structure, called a </span><span class="italic">page table</span><span class="calibre_13">, that maps a process’s virtual page addresses to real page addresses in memory. As a process accesses memory, the MMU translates the virtual addresses used by the process into real addresses based on the kernel’s page table.</span></p><p class="calibre_27"><span class="calibre_13"> A user process doesn’t actually need all of its memory pages to be immediately available in order to run. The kernel generally loads and allocates pages as a process needs them; this system is known as </span><span class="italic">on-demand paging</span><span class="calibre_13"> or just </span><span class="italic">demand paging</span><span class="calibre_13">. To see how this works, consider how a program starts and runs as a new process:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The kernel loads the beginning of the program’s instruction code into memory pages.</li><li value="2" class="calibre_8">The kernel may allocate some working-memory pages to the new process.</li><li value="3" class="calibre_8">As the process runs, it might reach a point where the next instruction in its code isn’t in any of the pages that the kernel initially loaded. At this point, the kernel takes over, loads the necessary page into memory, and then lets the program resume execution.</li><li value="4" class="calibre_8">Similarly, if the program requires more working memory than was initially allocated, the kernel handles it by finding free pages (or by making room) and assigning them to the process.</li></ol><p class="calibre_33"><span class="calibre_13">You can get a system’s page size by looking at the kernel configuration:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">getconf PAGE_SIZE</span></span><span class="calibre3"><br class="calibre7" />4096</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This number is in bytes, and 4k is typical for most Linux systems.</span></p><p id="calibre_link-835" class="calibre_27"><span class="calibre_13">The kernel does not arbitrarily map pages of real memory to virtual addresses; that is, it does not put all of the available pages into one big pool and allocate from there. Real memory has many divisions that depend on hardware limitations, kernel optimization of contiguous pages, and other factors. However, you shouldn’t worry about any of this when you’re just getting started.</span></p><p class="calibre_46"><span class="bold">Page Faults</span></p><p class="calibre_25"><span class="calibre_13">If a memory page isn’t ready when a process wants to use it, the process triggers a </span><span class="italic">page fault</span><span class="calibre_13">. In the event of a page fault, the kernel takes control of the CPU from the process in order to get the page ready. There are two kinds of page faults: minor and major.</span></p><p class="calibre_63"><span class="bold">Minor page faults</span>
</p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> A <span class="italic">minor page fault</span> occurs when the desired page is actually in main memory, but the MMU doesn’t know where it is. This can happen when the process requests more memory or when the MMU doesn’t have enough space to store all of the page locations for a process (the MMU’s internal mapping table is usually quite small). In this case, the kernel tells the MMU about the page and permits the process to continue. Minor page faults are nothing to worry about, and many occur as a process runs.</li></ol><p class="calibre_85"><span class="bold">Major page faults</span>
</p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> A <span class="italic">major page fault</span> occurs when the desired memory page isn’t in main memory at all, which means that the kernel must load it from the disk or some other slow storage mechanism. A lot of major page faults will bog the system down, because the kernel must do a substantial amount of work to provide the pages, robbing normal processes of their chance to run.</li><li value="2" class="calibre_8">Some major page faults are unavoidable, such as those that occur when you load the code from disk when running a program for the first time. The biggest problems happen when you start running out of memory, which forces the kernel to start swapping pages of working memory out to the disk in order to make room for new pages and can lead to thrashing.</li></ol><p class="calibre_33"><span class="calibre_13"> You can drill down to the page faults for individual processes with the </span><span class="calibre3">ps</span><span class="calibre_13">, </span><span class="calibre3">top</span><span class="calibre_13">, and </span><span class="calibre3">time</span><span class="calibre_13"> commands. You’ll need to use the system version of </span><span class="calibre3">time</span><span class="calibre_13"> (</span><span class="calibre3">/usr/bin/time</span><span class="calibre_13">) instead of the shell built-in. The following shows a simple example of how the </span><span class="calibre3">time</span><span class="calibre_13"> command displays page faults (the output of the </span><span class="calibre3">cal</span><span class="calibre_13"> command is irrelevant, so we’re discarding it by redirecting it to </span><span class="italic">/dev/null</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">/usr/bin/time cal &gt; /dev/null</span></span><span class="calibre3"><br class="calibre7" />0.00user 0.00system 0:00.06elapsed 0%CPU (0avgtext+0avgdata 3328maxresident)k<br class="calibre7" />648inputs+0outputs (</span><span class="calibre3"><span class="bold">2major+254minor</span></span><span class="calibre3">)pagefaults 0swaps</span></blockquote></blockquote><p id="calibre_link-652" class="calibre_30"><span class="calibre_13">As you can see from the bolded text, when this program ran, there were 2 major page faults and 254 minor ones. The major page faults occurred when the kernel needed to load the program from the disk for the first time. If you ran this command again, you probably wouldn’t get any major page faults because the kernel would have cached the pages from the disk.</span></p><p class="calibre_27"><span class="calibre_13"> If you’d rather see the page faults of processes as they’re running, use </span><span class="calibre3">top</span><span class="calibre_13"> or </span><span class="calibre3">ps</span><span class="calibre_13">. When running </span><span class="calibre3">top</span><span class="calibre_13">, use </span><span class="calibre3">f</span><span class="calibre_13"> to change the displayed fields and select </span><span class="calibre3">nMaj</span><span class="calibre_13"> as one of the columns to display the number of major page faults. Selecting </span><span class="calibre3">vMj</span><span class="calibre_13"> (the number of major page faults since the last update) can be helpful if you’re trying to track down a process that might be misbehaving.</span></p><p class="calibre_27"><span class="calibre_13"> When using </span><span class="calibre3">ps</span><span class="calibre_13">, you can use a custom output format to view the page faults for a particular process. Here’s an example for PID 20365:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ps -o pid,min_flt,maj_flt 20365</span></span><span class="calibre3"> PID&nbsp; MINFL&nbsp; MAJFL20365 834182&nbsp;&nbsp;&nbsp;&nbsp; 23</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">MINFL</span><span class="calibre_13"> and </span><span class="calibre3">MAJFL</span><span class="calibre_13"> columns show the numbers of minor and major page faults. Of course, you can combine this with any other process selection options, as described in the ps(1) manual page.</span></p><p class="calibre_27"><span class="calibre_13">Viewing page faults by process can help you zero in on certain problematic components. However, if you’re interested in your system performance as a whole, you need a tool to summarize CPU and memory action across all processes.</span></p><p id="calibre_link-236" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.5 Monitoring CPU and Memory Performance with vmstat</span></span></span></p><p class="calibre_45"><span class="calibre_13">Among the many tools available to monitor system performance, the </span><span class="calibre3">vmstat</span><span class="calibre_13"> command is one of the oldest, with minimal overhead. You’ll find it handy for getting a high-level view of how often the kernel is swapping pages in and out, how busy the CPU is, and how I/O resources are being utilized.</span></p><p class="calibre_27"><span class="calibre_13"> The trick to unlocking the power of </span><span class="calibre3">vmstat</span><span class="calibre_13"> is to understand its output. For example, here’s some output from </span><span class="calibre3">vmstat 2</span><span class="calibre_13">, which reports statistics every two seconds:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">vmstat 2</span></span><span class="calibre3"><br class="calibre7" />procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu---- r&nbsp; b&nbsp;&nbsp; swpd&nbsp;&nbsp; free&nbsp;&nbsp; buff&nbsp; cache&nbsp;&nbsp; si&nbsp;&nbsp; so&nbsp;&nbsp;&nbsp; bi&nbsp;&nbsp;&nbsp; bo&nbsp;&nbsp; in&nbsp;&nbsp; cs us sy id wa 2&nbsp; 0 320416 3027696 198636 1072568&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 0 15&nbsp; 2 83&nbsp; 0 2&nbsp; 0 320416 3027288 198636 1072564&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 1182&nbsp; 407&nbsp; 636&nbsp; 1&nbsp; 0 99&nbsp; 0 1&nbsp; 0 320416 3026792 198640 1072572&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 58&nbsp; 281&nbsp; 537&nbsp; 1&nbsp; 0 99&nbsp; 0 0&nbsp; 0 320416 3024932 198648 1074924&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 308&nbsp; 318&nbsp; 541&nbsp; 0&nbsp; 0 99&nbsp; 1 0&nbsp; 0 320416 3024932 198648 1074968&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 208&nbsp; 416&nbsp; 0&nbsp; 0 99&nbsp; 0 0&nbsp; 0 320416 3026800 198648 1072616&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 207&nbsp; 389&nbsp; 0&nbsp; 0 100&nbsp; 0</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The output falls into categories: </span><span class="calibre3">procs</span><span class="calibre_13"> for processes, </span><span class="calibre3">memory</span><span class="calibre_13"> for memory usage, </span><span class="calibre3">swap</span><span class="calibre_13"> for the pages pulled in and out of swap, </span><span class="calibre3">io</span><span class="calibre_13"> for disk usage, </span><span class="calibre3">system</span><span class="calibre_13"> for the number of times the kernel switches into kernel code, and </span><span class="calibre3">cpu</span><span class="calibre_13"> for the time used by different parts of the system.</span></p><p id="calibre_link-845" class="calibre_27"><span class="calibre_13">The preceding output is typical for a system that isn’t doing much. You’ll usually start looking at the second line of output&mdash;the first one is an average for the entire uptime of the system. For example, here the system has 320,416KB of memory swapped out to the disk (</span><span class="calibre3">swpd</span><span class="calibre_13">) and around 3,027,000KB (3GB) of real memory </span><span class="calibre3">free</span><span class="calibre_13">. Even though some swap space is in use, the zero-valued </span><span class="calibre3">si</span><span class="calibre_13"> (swap-in) and </span><span class="calibre3">so</span><span class="calibre_13"> (swap-out) columns report that the kernel is not currently swapping anything in or out from the disk. The </span><span class="calibre3">buff</span><span class="calibre_13"> column indicates the amount of memory that the kernel is using for disk buffers (see </span>Section 4.2.5<span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> On the far right, under the CPU heading, you can see the distribution of CPU time in the </span><span class="calibre3">us</span><span class="calibre_13">, </span><span class="calibre3">sy</span><span class="calibre_13">, </span><span class="calibre3">id</span><span class="calibre_13">, and </span><span class="calibre3">wa</span><span class="italic">
</span><span class="calibre_13">columns. Respectively, these list the percentage of time the CPU is spending on user tasks, system (kernel) tasks, idle time, and waiting for I/O. In the preceding example, there aren’t too many user processes running (they’re using a maximum of 1 percent of the CPU); the kernel is doing practically nothing, and the CPU is sitting around doing nothing 99 percent of the time.</span></p><p class="calibre_27"><a href="#calibre_link-523"><span class="italic"><span class="calibre_4">Listing 8-3</span></span></a><span class="calibre_13"> shows what happens when a big program starts up.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu---- r&nbsp; b&nbsp;&nbsp; swpd&nbsp;&nbsp; free&nbsp;&nbsp; buff&nbsp; cache&nbsp;&nbsp; si&nbsp;&nbsp; so&nbsp;&nbsp;&nbsp; bi&nbsp;&nbsp;&nbsp; bo&nbsp;&nbsp; in&nbsp;&nbsp; cs us sy id wa 1&nbsp; 0 320412 2861252 198920 1106804&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0 2477 4481 25&nbsp; 2 72&nbsp; 0 1 1&nbsp; 0 320412 2861748 198924 1105624&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 40 2206 3966 26&nbsp; 2 72&nbsp; 0 1&nbsp; 0 320412 2860508 199320 1106504&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 210&nbsp;&nbsp;&nbsp; 18 2201 3904 26&nbsp; 2 71&nbsp; 1 1&nbsp; 1 320412 2817860 199332 1146052&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0 19912&nbsp;&nbsp;&nbsp;&nbsp; 0 2446 4223 26&nbsp; 3 63&nbsp; 8 2&nbsp; 2 34 2791608 200612 1157752&nbsp; 202&nbsp;&nbsp;&nbsp; 0&nbsp; 4960&nbsp;&nbsp; 854 3371 5714 27&nbsp; 3 51 18 2 1&nbsp; 1 320252 2772076 201076 1166656&nbsp;&nbsp; 10&nbsp;&nbsp;&nbsp; 0&nbsp; 2142&nbsp; 1190 4188 7537 30&nbsp; 3 53 14 0&nbsp; 3 320244 2727632 202104 1175420&nbsp;&nbsp; 20&nbsp;&nbsp;&nbsp; 0&nbsp; 1890&nbsp;&nbsp; 216 4631 8706 36&nbsp; 4 46 14</span></blockquote></blockquote><blockquote id="calibre_link-523" class="calibre_49"><span class="italic"><span class="calibre_4">Listing 8-3</span></span><span class="italic"><span class="calibre_13">: Memory activity</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> As you can see at </span>1<span class="calibre_13"> in </span><a href="#calibre_link-523"><span class="italic"><span class="calibre_4">Listing 8-3</span></span></a><span class="calibre_13">, the CPU starts to see some usage for an extended period, especially from user processes. Because there is enough free memory, the amount of cache and buffer space used starts to increase as the kernel uses the disk more.</span></p><p class="calibre_27"><span class="calibre_13"> Later on, we see something interesting: notice at </span>2<span class="calibre_13"> that the kernel pulls some pages into memory that were once swapped out (the </span><span class="calibre3">si</span><span class="calibre_13"> column). This means the program that just ran probably accessed some pages shared by another process, which is common&mdash;many processes use the code in certain shared libraries only when starting up.</span></p><p class="calibre_27"><span class="calibre_13"> Also notice from the </span><span class="calibre3">b</span><span class="calibre_13"> column that a few processes are </span><span class="italic">blocked</span><span class="calibre_13"> (prevented from running) while waiting for memory pages. Overall, the amount of free memory is decreasing, but it’s nowhere near being depleted. There’s also a fair amount of disk activity, as indicated by the increasing numbers in the </span><span class="calibre3">bi</span><span class="calibre_13"> (blocks in) and </span><span class="calibre3">bo</span><span class="calibre_13"> (blocks out) columns.</span></p><p class="calibre_27"><span class="calibre_13"> The output is quite different when you run out of memory. As the free space depletes, both the buffer and cache sizes decrease because the kernel increasingly needs the space for user processes. Once there is nothing left, you’ll see activity in the </span><span class="calibre3">so</span><span class="calibre_13"> (swapped out) column as the kernel starts moving pages onto the disk, at which point nearly all of the other output columns change to reflect the amount of work the kernel is doing. You see more system time, more data going in and out of the disk, and more processes blocked because the memory they want to use isn’t available (it has been swapped out).</span><a id="calibre_link-653"></a></p><p class="calibre_27"><span class="calibre_13"> We haven’t explored all of the </span><span class="calibre3">vmstat</span><span class="calibre_13"> output columns. You can dig deeper into them in the vmstat(8) manual page, but you might need to learn more about kernel memory management first from a class or a book like Silberschatz, Gagne, and Galvin’s </span><span class="italic">Operating System Concepts</span><span class="calibre_13">, 10th edition (Wiley, 2018), in order to understand them.</span></p><p id="calibre_link-237" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.6 I/O Monitoring</span></span></span></p><p class="calibre_45"><span class="calibre_13">By default, </span><span class="calibre3">vmstat</span><span class="calibre_13"> provides some general I/O statistics. Although you can get very detailed per-partition resource usage with </span><span class="calibre3">vmstat -d</span><span class="calibre_13">, you might be overwhelmed by the amount of output resulting from this option. Instead, try a tool just for I/O called </span><span class="calibre3">iostat</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Many of the I/O utilities we’ll discuss here aren’t built into most distributions by default, but they’re easily installed.</span></span></blockquote><p class="calibre_23"><span class="bold">Using iostat</span></p><p class="calibre_25"><span class="calibre_13">Like </span><span class="calibre3">vmstat</span><span class="calibre_13">, when run without any options, </span><span class="calibre3">iostat</span><span class="calibre_13"> shows the statistics for your machine’s current uptime:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">iostat</span></span><span class="calibre3"><br class="calibre7" />[</span><span class="calibre3"><span class="italic">kernel information</span></span><span class="calibre3">]<br class="calibre7" />avg-cpu:&nbsp; %user&nbsp;&nbsp; %nice %system %iowait&nbsp; %steal&nbsp;&nbsp; %idle 4.46&nbsp;&nbsp;&nbsp; 0.01&nbsp;&nbsp;&nbsp; 0.67&nbsp;&nbsp;&nbsp; 0.31&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp; 94.55<br class="calibre7" />Device:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tps&nbsp;&nbsp;&nbsp; kB_read/s&nbsp;&nbsp;&nbsp; kB_wrtn/s&nbsp;&nbsp;&nbsp; kB_read&nbsp;&nbsp;&nbsp; kB_wrtn<br class="calibre7" />sda&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.28&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 49.86&nbsp;&nbsp;&nbsp; 9493727&nbsp;&nbsp; 65011716<br class="calibre7" />sde&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1230&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 </span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">avg-cpu</span><span class="calibre_13"> part at the top reports the same CPU utilization information as other utilities that you’ve seen in this chapter, so skip down to the bottom, which shows you the following for each device:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">tps</span></span> Average number of data transfers per second</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">kB_read/s</span></span> Average number of kilobytes read per second</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">kB_wrtn/s</span></span> Average number of kilobytes written per second</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">kB_read</span></span> Total number of kilobytes read</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">kB_wrtn</span></span> Total number of kilobytes written</li></ol><p class="calibre_33"><span class="calibre_13"> Another similarity to </span><span class="calibre3">vmstat</span><span class="calibre_13"> is that you can provide an interval argument, such as </span><span class="calibre3">iostat 2</span><span class="calibre_13">, to give an update every two seconds. When using an interval, you might want to display only the device report by using the </span><span class="calibre3">-d</span><span class="calibre_13"> option (such as </span><span class="calibre3">iostat -d 2</span><span class="calibre_13">).</span></p><p id="calibre_link-712" class="calibre_27"><span class="calibre_13">By default, the </span><span class="calibre3">iostat</span><span class="calibre_13"> output omits partition information. To show all of the partition information, use the </span><span class="calibre3">-p ALL</span><span class="calibre_13"> option. Because a typical system has many partitions, you’ll get a lot of output. Here’s part of what you might see:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">iostat -p ALL</span></span><span class="calibre3"><br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />Device:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tps&nbsp;&nbsp;&nbsp; kB_read/s&nbsp;&nbsp;&nbsp; kB_wrtn/s&nbsp;&nbsp;&nbsp; kB_read&nbsp;&nbsp;&nbsp; kB_wrtn<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />sda&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.67&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.27&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 49.83&nbsp;&nbsp;&nbsp; 9496139&nbsp;&nbsp; 65051472<br class="calibre7" />sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 49.51&nbsp;&nbsp;&nbsp; 9352969&nbsp;&nbsp; 64635440<br class="calibre7" />sda2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br class="calibre7" />sda5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.32&nbsp;&nbsp;&nbsp;&nbsp; 141884&nbsp;&nbsp;&nbsp;&nbsp; 416032<br class="calibre7" />scd0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />sde&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1230&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this example, </span><span class="calibre3">sda1</span><span class="calibre_13">, </span><span class="calibre3">sda2</span><span class="calibre_13">, and </span><span class="calibre3">sda5</span><span class="calibre_13"> are all partitions of the </span><span class="calibre3">sda</span><span class="calibre_13"> disk, so the read and written columns will have some overlap. However, the sum of the partition columns won’t necessarily add up to the disk column. Although a read from </span><span class="calibre3">sda1</span><span class="calibre_13"> also counts as a read from </span><span class="calibre3">sda</span><span class="calibre_13">, keep in mind that you can read from </span><span class="calibre3">sda</span><span class="calibre_13"> directly, such as when reading the partition table.</span></p><p class="calibre_46"><span class="bold">Per-Process I/O Utilization and Monitoring: iotop</span></p><p class="calibre_25"><span class="calibre_13">If you need to dig even deeper to see I/O resources used by individual processes, the </span><span class="calibre3">iotop</span><span class="calibre_13"> tool can help. Using </span><span class="calibre3">iotop</span><span class="calibre_13"> is similar to using </span><span class="calibre3">top</span><span class="calibre_13">. It generates a continuously updating display that shows the processes using the most I/O, with a general summary at the top:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iotop</span></span><span class="calibre3"><br class="calibre7" />Total DISK READ:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.76 K/s | Total DISK WRITE:&nbsp;&nbsp;&nbsp;&nbsp; 333.31 K/s TID&nbsp; PRIO&nbsp; USER&nbsp;&nbsp;&nbsp;&nbsp; DISK READ&nbsp; DISK WRITE&nbsp; SWAPIN&nbsp;&nbsp;&nbsp;&nbsp; IO&gt;&nbsp;&nbsp;&nbsp; COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 260 be/3 root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 B/s&nbsp;&nbsp; 38.09 K/s&nbsp; 0.00 %&nbsp; 6.98 % [jbd2/sda1-8] 2611 be/4 juser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.76 K/s&nbsp;&nbsp; 10.32 K/s&nbsp; 0.00 %&nbsp; 0.21 % zeitgeist-daemon 2636 be/4 juser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 B/s&nbsp;&nbsp; 84.12 K/s&nbsp; 0.00 %&nbsp; 0.20 % zeitgeist-fts 1329 be/4 juser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 B/s&nbsp;&nbsp; 65.87 K/s&nbsp; 0.00 %&nbsp; 0.03 % soffice.b~ash-pipe=6 6845 be/4 juser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 B/s&nbsp; 812.63 B/s&nbsp; 0.00 %&nbsp; 0.00 % chromium-browser<br class="calibre7" />19069 be/4 juser&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 B/s&nbsp; 812.63 B/s&nbsp; 0.00 %&nbsp; 0.00 % rhythmbox</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Along with the user, command, and read/write columns, notice that there’s a TID column instead of a PID column. The </span><span class="calibre3">iotop</span><span class="calibre_13"> tool is one of the few utilities that displays threads instead of processes.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">PRIO</span><span class="calibre_13"> (priority) column indicates the I/O priority. It’s similar to the CPU priority that you’ve already seen, but it affects how quickly the kernel schedules I/O reads and writes for the process. In a priority such as </span><span class="calibre3">be/4</span><span class="calibre_13">, the </span><span class="calibre3">be</span><span class="calibre_13"> part is the </span><span class="italic">scheduling class</span><span class="calibre_13">, and the number is the priority level. As with CPU priorities, lower numbers are more important; for example, the kernel allows more I/O time for a process with priority </span><span class="calibre3">be/3</span><span class="calibre_13"> than one with priority </span><span class="calibre3">be/4</span><span class="calibre_13">.</span></p><p id="calibre_link-613" class="calibre_27"><span class="calibre_13">The kernel uses the scheduling class to add more control for I/O scheduling. You’ll see three scheduling classes from </span><span class="calibre3">iotop</span><span class="calibre_13">:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">be</span></span> Best effort. The kernel does its best to schedule I/O fairly for this class. Most processes run under this I/O scheduling class.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">rt</span></span> Real time. The kernel schedules any real-time I/O before any other class of I/O, no matter what.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">idle</span></span> Idle. The kernel performs I/O for this class only when there is no other I/O to be done. The idle scheduling class has no priority level.</li></ol><p class="calibre_33"><span class="calibre_13"> You can check and change the I/O priority for a process with the </span><span class="calibre3">ionice</span><span class="calibre_13"> utility; see the ionice(1) manual page for details. You’ll probably never need to worry about the I/O priority, though.</span></p><p id="calibre_link-238" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.5.7 Per-Process Monitoring with pidstat</span></span></span></p><p class="calibre_45"><span class="calibre_13">You’ve seen how you can monitor specific processes with utilities such as </span><span class="calibre3">top</span><span class="calibre_13"> and </span><span class="calibre3">iotop</span><span class="calibre_13">. However, this display refreshes over time, and each update erases the previous output. The </span><span class="calibre3">pidstat</span><span class="calibre_13"> utility allows you to see the resource consumption of a process over time in the style of </span><span class="calibre3">vmstat</span><span class="calibre_13">. Here’s a simple example for monitoring process 1329, updating every second:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">pidstat -p 1329 1</span></span><span class="calibre3"><br class="calibre7" />Linux 5.4.0-48-generic (duplex)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11/09/2020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _x86_64_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (4 CPU)<br class="calibre7" />09:26:55 PM&nbsp;&nbsp; UID&nbsp; PID&nbsp;&nbsp;&nbsp; %usr %system&nbsp; %guest&nbsp;&nbsp;&nbsp; %CPU&nbsp;&nbsp; CPU&nbsp; Command<br class="calibre7" />09:27:03 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 8.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 8.00&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; myprocess<br class="calibre7" />09:27:04 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; myprocess<br class="calibre7" />09:27:05 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 3.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 3.00&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; myprocess<br class="calibre7" />09:27:06 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 8.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 8.00&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; myprocess<br class="calibre7" />09:27:07 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 2.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 2.00&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; myprocess<br class="calibre7" />09:27:08 PM&nbsp; 1000&nbsp; 1329&nbsp;&nbsp;&nbsp; 6.00&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp;&nbsp; 6.00&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; myprocess</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The default output shows the percentages of user and system time and the overall percentage of CPU time, and it even tells you on which CPU the process was running. (The </span><span class="calibre3">%guest</span><span class="calibre_13"> column here is somewhat odd&mdash;it’s the percentage of time that the process spent running something inside a virtual machine. Unless you’re running a virtual machine, don’t worry about this.)</span></p><p class="calibre_27"><span class="calibre_13"> Although </span><span class="calibre3">pidstat</span><span class="calibre_13"> shows CPU utilization by default, it can do much more. For example, you can use the </span><span class="calibre3">-r</span><span class="calibre_13"> option to monitor memory and </span><span class="calibre3">-d</span><span class="calibre_13"> to turn on disk monitoring. Try them out, and then look at the pidstat(1) manual page to see even more options for threads, context switching, or just about anything else that we’ve talked about in this chapter.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-239" class="calibre_23"><span class="calibre1"><span class="bold"> 8.6 Control Groups (cgroups)</span></span></p><p class="calibre_24"><span class="calibre_13">So far, you’ve seen how to view and monitor resource usage, but what if you’d like to limit what processes can consume beyond what you saw with the </span><span class="calibre3">nice</span><span class="calibre_13"> command? There are several traditional systems for doing so, such as the POSIX rlimit interface, but the most flexible option for most types of resource limits on Linux systems is now the </span><a id="calibre_link-800"></a><span class="italic">cgroup</span><span class="calibre_13"> (control group) kernel feature.</span></p><p class="calibre_27"><span class="calibre_13">The basic idea is that you place several processes into a cgroup, which allows you to manage the resources that they consume on a group-wide basis. For example, if you want to limit the amount of memory that a set of processes may cumulatively consume, a cgroup can do this.</span></p><p class="calibre_27"><span class="calibre_13"> After creating a cgroup, you can add processes to it, and then use a </span><span class="italic">controller</span><span class="calibre_13"> to change how those processes behave. For example, there is a </span><span class="calibre3">cpu</span><span class="calibre_13"> controller allowing you to limit the processor time, a </span><span class="calibre3">memory</span><span class="calibre_13"> controller, and so on.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Although systemd makes extensive use of the cgroup feature and most (if not all) of the cgroups on your system may be managed by systemd, cgroups are in kernel space and do not depend on systemd.</span></span></blockquote><p id="calibre_link-240" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">8.6.1 Differentiating Between cgroup Versions</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are two versions of cgroups, 1 and 2, and unfortunately, both are currently in use and can be configured simultaneously on a system, leading to potential confusion. Aside from a somewhat different feature set, the structural differences between the versions can be summed up as follows:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> In cgroups v1, each type of controller (<span class="calibre3">cpu</span>, <span class="calibre3">memory</span>, and so on) has its own set of cgroups. A process can belong to one cgroup per controller, meaning that a process can belong to multiple cgroups. For example, in v1, a process can belong to a <span class="calibre3">cpu</span> cgroup and a <span class="calibre3">memory</span> cgroup.</li><li value="2" class="calibre_8">In cgroups v2, a process can belong to only one cgroup. You can set up different types of controllers for each cgroup.</li></ul><p class="calibre_33"><span class="calibre_13"> To visualize the difference, consider three sets of processes, A, B, and C. We want to use the </span><span class="calibre3">cpu</span><span class="calibre_13"> and </span><span class="calibre3">memory</span><span class="calibre_13"> controllers on each of them. </span><a></a><a href="#calibre_link-524"><span class="italic"><span class="calibre_4">Figure 8-1</span></span></a><span class="calibre_13"> shows the schematic for cgroups v1. We need six cgroups total, because each cgroup is limited to a single controller.</span></p><p class="calibre_34"><img src="images/000023.jpg" class="calibre_90" />
</p><p id="calibre_link-524" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 8-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: cgroups v1. A process may belong to one cgroup per controller.</span></span></span></p><p id="calibre_link-618" class="calibre_37"><a href="#calibre_link-525"><span class="italic"><span class="calibre_4">Figure 8-2</span></span></a><span class="calibre_13"> shows how to do it in cgroups v2. We need only three cgroups, because we can set up multiple controllers per cgroup.</span></p><p class="calibre_34"><img src="images/000031.jpg" class="calibre_91" />
</p><p id="calibre_link-525" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 8-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: cgroups v2. A process may belong to only one cgroup.</span></span></span></p><p class="calibre_37"><span class="calibre_13"> You can list the v1 and v2 cgroups for any process by looking at its </span><span class="italic">cgroup</span><span class="calibre_13"> file in </span><span class="italic">/proc/&lt;pid&gt;</span><span class="calibre_13">. You can start by looking at your shell’s cgroups with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat /proc/self/cgroup</span></span><span class="calibre3"><br class="calibre7" />12:rdma:/<br class="calibre7" />11:net_cls,net_prio:/<br class="calibre7" />10:perf_event:/<br class="calibre7" />9:cpuset:/<br class="calibre7" />8:cpu,cpuacct:/user.slice<br class="calibre7" />7:blkio:/user.slice<br class="calibre7" />6:memory:/user.slice<br class="calibre7" />5:pids:/user.slice/user-1000.slice/session-2.scope<br class="calibre7" />4:devices:/user.slice<br class="calibre7" />3:freezer:/<br class="calibre7" />2:hugetlb:/testcgroup 1<br class="calibre7" />1:name=systemd:/user.slice/user-1000.slice/session-2.scope<br class="calibre7" />0::/user.slice/user-1000.slice/session-2.scope</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Don’t be alarmed if the output is significantly shorter on your system; this just means that you probably have only cgroups v2. Every line of output here starts with a number and is a different cgroup. Here are some pointers on how to read it:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Numbers 2&ndash;12 are for cgroups v1. The controllers for those are listed next to the number.</li><li value="2" class="calibre_8">Number 1 is also for version 1, but it does not have a controller. This cgroup is for management purposes only (in this case, systemd configured it).</li><li value="3" class="calibre_8">The last line, number 0, is for cgroups v2. No controllers are visible here. On a system that doesn’t have cgroups v1, this will be the only line of output.</li><li value="4" class="calibre_8"> Names are hierarchical and look like parts of file paths. You can see in this example that some of the cgroups are named <span class="italic">/user.slice</span> and others <span class="italic">/user.slice/user-1000.slice/session-2.scope</span>.</li><li value="5" class="calibre_8">The name <span class="italic">/testcgroup</span> 1 was created to show that in cgroups v1, the cgroups for a process can be completely independent.</li><a id="calibre_link-616"></a><li value="6" class="calibre_8"> Names under <span class="italic">user.slice</span> that include <span class="italic">session</span> are login sessions, assigned by systemd. You’ll see them when you’re looking at a shell’s cgroups. The cgroups for your system services will be under <span class="italic">system.slice</span>.</li></ul><p class="calibre_33"><span class="calibre_13">You may have surmised that cgroups v1 has flexibility in one respect over v2 because you can assign different combinations of cgroups to processes. However, it turns out that no one actually used them this way, and this approach was more complicated to set up and implement than simply having one cgroup per process.</span></p><p class="calibre_27"><span class="calibre_13">Because cgroups v1 is being phased out, our discussion will focus on cgroups v2 from this point forward. Be aware that if a controller is being used in cgroups v1, the controller cannot be used in v2 at the same time due to potential conflicts. This means that the controller-specific parts of what we’re about to discuss won’t work correctly if your system still uses v1, but you should still be able to follow along with the v1 equivalents if you look in the right place.</span></p><p id="calibre_link-241" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.6.2 Viewing cgroups</span></span></span></p><p class="calibre_45"><span class="calibre_13">Unlike the traditional Unix system call interface for interacting with the kernel, cgroups are accessed entirely through the filesystem, which is usually mounted as a cgroup2 filesystem under </span><span class="italic">/sys/fs/cgroup</span><span class="calibre_13">. (If you’re also running cgroups v1, this will probably be under </span><span class="italic">/sys/fs/cgroup/unified</span><span class="calibre_13">.)</span></p><p class="calibre_27"><span class="calibre_13"> Let’s explore the cgroup setup of a shell. Open a shell and find its cgroup from </span><span class="italic">/proc/self/cgroup</span><span class="calibre_13"> (as shown earlier). Then look in </span><span class="italic">/sys/fs/cgroup</span><span class="calibre_13"> (or </span><span class="italic">/sys/fs/cgroup/unified</span><span class="calibre_13">). You’ll find a directory with that name; change to it and have a look around:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat /proc/self/cgroup</span></span><span class="calibre3"><br class="calibre7" />0::/user.slice/user-1000.slice/session-2.scope<br class="calibre7" />$ </span><span class="calibre3"><span class="bold">cd /sys/fs/cgroup/user.slice/user-1000.slice/session-2.scope/</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">ls</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A cgroup name can be quite long on desktop environments that like to create a new cgroup for each new application launched.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Among the many files that can be here, the primary cgroup interface files begin with </span><span class="italic">cgroup</span><span class="calibre_13">. Start by looking at </span><span class="italic">cgroup.procs</span><span class="calibre_13"> (using </span><span class="calibre3">cat</span><span class="calibre_13"> is fine), which lists the processes in the cgroup. A similar file, </span><span class="italic">cgroup.threads</span><span class="calibre_13">, also includes threads.</span></p><p class="calibre_27"><span class="calibre_13"> To see the controllers currently in use for the cgroup, look at </span><span class="italic">cgroup.controllers</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat cgroup.controllers</span></span><span class="calibre3"><br class="calibre7" />memory pids</span></blockquote></blockquote><p id="calibre_link-614" class="calibre_30"><span class="calibre_13">Most cgroups used for shells have these two controllers, which can control the amount of memory used and the total number of processes in the cgroup. To interact with a controller, look for the files that match the controller prefix. For example, if you want to see the number of threads running in the cgroup, consult </span><span class="italic">pids.current</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat pids.current</span></span><span class="calibre3"><br class="calibre7" />4</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To see the maximum amount of memory that the cgroup can consume, take a look at </span><span class="italic">memory.max</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat memory.max</span></span><span class="calibre3"><br class="calibre7" />max</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A value of </span><span class="calibre3">max</span><span class="calibre_13"> means that this cgroup has no specific limit, but because cgroups are hierarchical, a cgroup back down the subdirectory chain might limit it.</span></p><p id="calibre_link-242" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.6.3 Manipulating and Creating cgroups</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although you probably won’t ever need to alter cgroups, it’s easy to do. To put a process into a cgroup, write its PID to its </span><span class="italic">cgroup.procs</span><span class="calibre_13"> file as root:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">echo </span></span><span class="calibre3"><span class="italic"><span class="bold">pid</span></span></span><span class="calibre3"><span class="bold"> &gt; cgroup.procs</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This is how many changes to cgroups work. For example, if you want to limit the maximum number of PIDs of a cgroup (to, say, 3,000 PIDs), do it as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">echo 3000 &gt; pids.max</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Creating cgroups is trickier. Technically, it’s as easy as creating a subdirectory somewhere in the cgroup tree; when you do so, the kernel automatically creates the interface files. If a cgroup has no processes, you can remove the cgroup with </span><span class="calibre3">rmdir</span><span class="calibre_13"> even with the interface files present. What can trip you up are the rules governing cgroups, including:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> You can put processes only in outer-level (“leaf”) cgroups. For example, if you have cgroups named <span class="italic">/my-cgroup</span> and <span class="italic">/my-cgroup/my-subgroup</span>, you can’t put processes in <span class="italic">/my-cgroup</span>, but <span class="italic">/my-cgroup/my-subgroup</span> is okay. (An exception is if the cgroups have no controllers, but let’s not dig further.)</li><li value="2" class="calibre_8">A cgroup can’t have a controller that isn’t in its parent cgroup.</li><li value="3" class="calibre_8"> You must explicitly specify controllers for child cgroups. You do this through the <span class="italic">cgroup.subtree_control</span> file; for example, if you want a child cgroup to have the <span class="calibre3">cpu</span> and <span class="calibre3">pids</span> controllers, write <span class="calibre3">+cpu +pids</span> to this file.</li></ul><p id="calibre_link-617" class="calibre_33"><span class="calibre_13">An exception to these rules is the root cgroup found at the base path of the hierarchy. You can place processes in this cgroup. One reason you might want to do this is to detach a process from systemd’s control.</span></p><p id="calibre_link-243" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">8.6.4 Viewing Resource Utilization</span></span></span></p><p class="calibre_45"><span class="calibre_13">In addition to being able to limit resources by cgroup, you can also see the current resource utilization of all processes across their cgroups. Even with no controllers enabled, you can see the CPU usage of a cgroup by looking at its </span><span class="italic">cpu.stat</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cat cpu.stat</span></span><span class="calibre3"><br class="calibre7" />usage_usec 4617481<br class="calibre7" />user_usec 2170266<br class="calibre7" />system_usec 2447215</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Because this is the accumulated CPU usage over the entire lifespan of the cgroup, you can see how a service consumes processor time even if it spawns many subprocesses that eventually terminate.</span></p><p class="calibre_27"><span class="calibre_13"> You can view other types of utilization if the appropriate controllers are enabled. For example, the </span><span class="calibre3">memory</span><span class="calibre_13"> controller gives access to the </span><span class="italic">memory.current</span><span class="calibre_13"> file for current memory use and </span><span class="italic">memory.stat</span><span class="calibre_13"> file containing detailed memory data for the lifespan of the cgroup. These files are not available in the root cgroup.</span></p><p class="calibre_27"><span class="calibre_13">You can get a lot more out of cgroups. The full details for how to use each individual controller, as well as all of the rules for creating cgroups, are available in the kernel documentation; just search online for “cgroups2 documentation” and you should find it.</span></p><p class="calibre_27"><span class="calibre_13">For now, though, you should have a good idea of how cgroups work. Understanding the basics of their operation helps explain how systemd organizes processes. Later on, when you read about containers, you’ll see how they’re used for a much different purpose.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-244" class="calibre_23"><span class="calibre1"><span class="bold"> 8.7 Further Topics</span></span></p><p class="calibre_24"><span class="calibre_13">One reason there are so many tools to measure and manage resource utilization is that different types of resources are consumed in many different ways. In this chapter, you’ve seen CPU, memory, and I/O as system resources being consumed by processes, threads inside processes, and the kernel.</span></p><p class="calibre_27"><span class="calibre_13"> The other reason the tools exist is that the resources are </span><span class="italic">limited</span><span class="calibre_13">, and for a system to perform well, its components must strive to consume fewer resources. In the past, many users shared a machine, so it was necessary to make sure that each user had a fair share of resources. Now, although a modern desktop computer may not have multiple users, it still has many processes competing for resources. Likewise, high-performance network servers require intense system resource monitoring because they run many processes to handle multiple requests simultaneously.</span></p><p id="calibre_link-710" class="calibre_27"><span class="calibre_13">Further topics in resource monitoring and performance analysis you might want to explore include:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">sar</span></span><span class="bold"> (System Activity Reporter)</span> The <span class="calibre3">sar</span> package has many of the continuous monitoring capabilities of <span class="calibre3">vmstat</span>, but it also records resource utilization over time. With <span class="calibre3">sar</span>, you can look back at a particular time to see what your system was doing. This is handy when you want to analyze a past system event.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">acct</span></span><span class="bold"> (process accounting)</span> The <span class="calibre3">acct</span> package can record the processes and their resource utilization.</li><li value="3" class="calibre_8"><span class="bold">Quotas</span> You can limit the amount of disk space that a user can use with the <span class="calibre3">quota</span> system.</li></ol><p class="calibre_33"><span class="calibre_13"> If you’re interested in systems tuning and performance in particular, </span><span class="italic">Systems Performance: Enterprise and the Cloud</span><span class="calibre_13">, 2nd edition, by Brendan Gregg (Addison-Wesley, 2020) goes into much more detail.</span></p><p class="calibre_27"><span class="calibre_13">We also haven’t yet touched on the many, many tools you can use to monitor network resource utilization. To use those, though, you first need to understand how the network works. That’s where we’re headed next.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-245" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-839" class="calibre_10"><span class="calibre4"><span class="bold">9</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">UNDERSTANDING YOUR NETWORK AND ITS CONFIGURATION</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">Networking is the practice of connecting computers and sending data between them. That sounds simple enough, but to understand how it works, you need to ask two fundamental questions:</span></span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> How does the computer sending the data know <span class="italic">where</span> to send its data?</li><li value="2" class="calibre_8"> When the destination computer receives the data, how does it know <span class="italic">what</span> it just received?</li></ul><p class="calibre_33"><span class="calibre_13"> A computer answers these questions by using a series of components, with each one responsible for a certain aspect of sending, receiving, and identifying data. The components are arranged in groups that form </span><span class="italic">network layers</span><span class="calibre_13">, which stack on top of each other in order to form a complete system. The Linux kernel handles networking in a similar way to the SCSI subsystem described in </span>Chapter 3<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Because each layer tends to be independent, it’s possible to build networks with many different combinations of components. This is where network configuration can become very complicated. For this reason, we’ll begin this chapter by looking at the layers in very simple networks. You’ll learn how to view your own network settings, and when you understand the basic workings of each layer, you’ll be ready to learn how to configure those layers by yourself. Finally, you’ll move on to more advanced topics like building your own networks and configuring firewalls. (Skip over that material if your eyes start to glaze over; you can always come back.)</span><a id="calibre_link-792"></a></p><div class="mbp_pagebreak"></div><p id="calibre_link-246" class="calibre_23"><span class="calibre1"><span class="bold"> 9.1 Network Basics</span></span></p><p class="calibre_24"><span class="calibre_13">Before getting into the theory of network layers, take a look at the simple network shown in </span><a></a><a href="#calibre_link-526"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></a><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000015.jpg" class="calibre_92" />
</p><p id="calibre_link-526" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: A typical local area network with a router that provides internet access</span></span></span></p><p class="calibre_37"><span class="calibre_13"> This type of network is ubiquitous; most home and small office networks are configured this way. Each machine connected to the network is called a </span><span class="italic">host</span><span class="calibre_13">. One of these is a </span><span class="italic">router</span><span class="calibre_13">, which is a host that can move data from one network to another. In this example, these four hosts (Hosts A, B, C, and the router) form a local area network (</span><span class="italic">LAN</span><span class="calibre_13">). The connections on the LAN can be wired or wireless. There isn’t a strict definition of a LAN; the machines residing on a LAN are usually physically close and share much of the same configuration and access rights. You’ll see a specific example soon.</span></p><p class="calibre_27"><span class="calibre_13"> The router is also connected to the internet&mdash;the cloud in the figure. This connection is called the </span><span class="italic">uplink</span><span class="calibre_13"> or the wide area network (</span><span class="italic">WAN</span><span class="calibre_13">) connection, because it links the much smaller LAN to a larger network. Because the router is connected to both the LAN and the internet, all machines on the LAN also have access to the internet through the router. One of the goals of this chapter is to see how the router provides this access.</span></p><p class="calibre_27"><span class="calibre_13"> Your initial point of view will be from a Linux-based machine such as Host A on the LAN in </span><a href="#calibre_link-526"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></a><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-247" class="calibre_23"><span class="calibre1"><span class="bold"> 9.2 Packets</span></span></p><p class="calibre_24"><span class="calibre_13">A computer transmits data over a network in small chunks called </span><span class="italic">packets</span><span class="calibre_13">, which consist of two parts: a </span><span class="italic">header</span><span class="calibre_13"> and a </span><span class="italic">payload</span><span class="calibre_13">. The header contains identifying information such as the source and destination host machines and the basic protocol. The payload, on the other hand, is the actual application data that the computer wants to send (for example, HTML or image data).</span><a id="calibre_link-840"></a></p><p class="calibre_27"><span class="calibre_13">A host can send, receive, and process packets in any order, regardless of where they came from or where they’re going, which makes it possible for several hosts to communicate “simultaneously.” For example, if a host needs to transmit data to two others at once, it can alternate between the destinations in outgoing packets. Breaking messages into smaller units also makes it easier to detect and compensate for errors in transmission.</span></p><p class="calibre_27"><span class="calibre_13">For the most part, you don’t have to worry about translating between packets and the data that your application uses, because the operating system does this for you. However, it is helpful to know the role of packets in the network layers that you’re about to see.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-248" class="calibre_23"><span class="calibre1"><span class="bold"> 9.3 Network Layers</span></span></p><p class="calibre_24"><span class="calibre_13">A fully functioning network includes a set of network layers called a </span><span class="italic">network stack</span><span class="calibre_13">. Any functional network has a stack. The typical internet stack, from the top to bottom layer, looks like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Application layer</span> Contains the “language” that applications and servers use to communicate&mdash;usually a high-level protocol of some sort. Common application layer protocols include Hypertext Transfer Protocol (HTTP, used for the web), encryption protocols such as TLS, and File Transfer Protocol (FTP). Application layer protocols can often be combined. For example, TLS is commonly used in conjunction with HTTP to form HTTPS.</li><li value="2" class="calibre_8">Application layer processing occurs in user space.</li><li value="3" class="calibre_8"><span class="bold">Transport layer</span> Defines the data transmission characteristics of the application layer. This layer includes data integrity checking, source and destination ports, and specifications for breaking application data into packets at the host side (if the application layer has not already done so), and reassembling them at the destination. Transmission Control Protocol (TCP) and User Datagram Protocol (UDP) are the most common transport layer protocols. The transport layer is sometimes called the <span class="italic">protocol layer</span>.</li><li value="4" class="calibre_8">In Linux, the transport layer and all layers below are primarily handled by the kernel, but there are some exceptions where packets are sent into user space for processing.</li><li value="5" class="calibre_8"><span class="bold">Network or internet layer</span> Defines how to move packets from a source host to a destination host. The particular packet transit rule set for the internet is known as the <span class="italic">internet protocol (IP)</span>. Because we’ll only talk about internet networks in this book, we’ll really only be talking about the internet layer. However, because network layers are meant to be hardware independent, you can simultaneously configure several independent network layers&mdash;such as IP (IPv4), IPv6, IPX, and AppleTalk&mdash;on a single host.</li><a id="calibre_link-802"></a><li value="6" class="calibre_8"><span class="bold">Physical layer</span> Defines how to send raw data across a physical medium, such as Ethernet or a modem. This is sometimes called the <span class="italic">link layer</span> or <span class="italic">host-to-network layer</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> It’s important to understand the structure of a network stack because your data must travel through these layers at least twice before it reaches a program at its destination. For example, if you’re sending data from Host A to Host B, as shown in </span><a href="#calibre_link-526"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></a><span class="calibre_13">, your bytes leave the application layer on Host A and travel through the transport and network layers on Host A; then they go down to the physical medium, across the medium, and up again through the various lower levels to the application layer on Host B in much the same way. If you’re sending something to a host on the internet through the router, it will go through some (but usually not all) of the layers on the router and anything else in between.</span></p><p class="calibre_27"><span class="calibre_13">The layers sometimes bleed into each other in strange ways because it can be inefficient to process all of them in order. For example, devices that historically dealt with only the physical layer now sometimes look at the transport and internet layer data simultaneously to filter and route data quickly. In addition, the terminology itself can be confusing. For example, TLS stands for Transport Layer Security, but in reality, resides one layer higher, in the application layer. (Don’t worry about these annoying details when you’re learning the basics.)</span></p><p class="calibre_27"><span class="calibre_13"> We’ll begin by looking at how your Linux machine connects to the network in order to answer the </span><span class="italic">where</span><span class="calibre_13"> question at the beginning of the chapter. This is the lower part of the stack&mdash;the physical and network layers. Later, we’ll look at the upper two layers that answer the </span><span class="italic">what</span><span class="calibre_13"> question.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You might have heard of another set of layers known as the </span></span>Open Systems Interconnection (OSI) Reference Model<span class="italic"><span class="calibre_13">. This is a seven-layer network model often used in teaching and designing networks, but we won’t cover the OSI model because you’ll be working directly with the four layers described here. To learn </span></span>a lot<span class="italic"><span class="calibre_13"> more about layers (and networks in general), see Andrew S. Tanenbaum and David J. Wetherall’s </span></span>Computer Networks<span class="italic"><span class="calibre_13">, 5th edition (Prentice Hall, 2010).</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-249" class="calibre_42"><span class="calibre1"><span class="bold"> 9.4 The Internet Layer</span></span></p><p class="calibre_24"><span class="calibre_13">Rather than start at the very bottom of the network stack with the physical layer, we’ll start at the network layer because it can be easier to understand. The internet as we currently know it is based on internet protocol versions 4 (IPv4) and 6 (IPv6). One of the most important aspects of the internet layer is that it’s meant to be a software network that places no particular requirements on hardware or operating systems. The idea is that you can send and receive internet packets over any kind of hardware, using any operating system.</span></p><p id="calibre_link-778" class="calibre_27"><span class="calibre_13">Our discussion will start with IPv4 because it’s a little easier to read the addresses (and understand its limitations), but we’ll explain the primary differences in IPv6.</span></p><p class="calibre_27"><span class="calibre_13"> The internet’s topology is decentralized; it’s made up of smaller networks called </span><span class="italic">subnets</span><span class="calibre_13">. The idea is that all subnets are interconnected in some way. For example, in </span><a href="#calibre_link-526"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></a><span class="calibre_13">, the LAN is normally a single subnet.</span></p><p class="calibre_27"><span class="calibre_13"> A host can be attached to more than one subnet. As you saw in </span>Section 9.1<span class="calibre_13">, that kind of host is called a router if it can transmit data from one subnet to another (another term for router is </span><span class="italic">gateway</span><span class="calibre_13">). </span><a></a><a href="#calibre_link-527"><span class="italic"><span class="calibre_4">Figure 9-2</span></span></a><span class="calibre_13"> refines </span><a href="#calibre_link-526"><span class="italic"><span class="calibre_4">Figure 9-1</span></span></a><span class="calibre_13"> by identifying the LAN as a subnet, as well as internet addresses for each host and the router. The router in the figure has two addresses, the local subnet 10.23.2.1 and the link to the internet (the internet link’s address is not important right now, so it’s just labeled Uplink Address). We’ll look first at the addresses and then the subnet notation.</span></p><p class="calibre_27"><span class="calibre_13"> Each internet host has at least one numeric </span><span class="italic">IP address</span><span class="calibre_13">. For IPv4, it’s in the form of </span><span class="italic">a.b.c.d</span><span class="calibre_13">, such as 10.23.2.37. An address in this notation is called a </span><span class="italic">dotted-quad</span><span class="calibre_13"> sequence. If a host is connected to multiple subnets, it has at least one IP address per subnet. Each host’s IP address should be unique across the entire internet, but as you’ll see later, private networks and Network Address Translation (NAT) can make this a little confusing.</span></p><p class="calibre_27"><span class="calibre_13"> Don’t worry about the subnet notation in </span><a href="#calibre_link-527"><span class="italic"><span class="calibre_4">Figure 9-2</span></span></a><span class="calibre_13"> yet; we’ll discuss it shortly.</span></p><p class="calibre_34"><img src="images/000004.jpg" class="calibre_93" />
</p><p id="calibre_link-527" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Network with IP addresses</span></span></span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Technically, an IP address consists of 4 bytes (or 32 bits), </span></span>abcd<span class="italic"><span class="calibre_13">. Bytes </span></span>a<span class="italic"><span class="calibre_13"> and </span></span>d<span class="italic"><span class="calibre_13"> are numbers from 1 to 254, and </span></span>b<span class="italic"><span class="calibre_13"> and </span></span>c<span class="italic"><span class="calibre_13"> are numbers from 0 to 255. A computer processes IP addresses as raw bytes. However, it’s much easier for a human to read and write a dotted-quad address, such as 10.23.2.37, instead of something ugly like the hexadecimal 0x0A170225.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">IP addresses are like postal addresses in some ways. To communicate with another host, your machine must know that other host’s IP address.</span></p><p class="calibre_27"><span class="calibre_13">Let’s take a look at the address on your machine.</span></p><p id="calibre_link-250" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.4.1 Viewing IP Addresses</span></span></span></p><p class="calibre_45"><span class="calibre_13">One machine can have many IP addresses, accommodating multiple physical interfaces, virtual internal networks, and more. To see the addresses that are active on your Linux machine, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ip address show</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> There will probably be a lot of output (grouped by physical interface, covered in </span>Section 9.10<span class="calibre_13">), but it should include something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">2: enp0s31f6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 40:8d:5c:fc:24:1f brd ff:ff:ff:ff:ff:ff inet 10.23.2.4/24 brd 10.23.2.255 scope global noprefixroute enp0s31f6 valid_lft forever preferred_lft forever</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">ip</span><span class="calibre_13"> command’s output includes many details from the internet layer(s) and the physical layer. (Sometimes it doesn’t even include an internet address at all!) We’ll discuss the output in more detail later, but for now, concentrate on the fourth line, which reports that the host is configured to have an IPv4 address (denoted with </span><span class="calibre3">inet</span><span class="calibre_13">) of 10.23.2.4. The </span><span class="calibre3">/24</span><span class="calibre_13"> after the address helps define the subnet that the IP address belongs to. Let’s see how that works.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">ip</span><span class="italic"><span class="calibre_13"> command is the current standard network configuration tool. In other documentation, you may see the </span></span><span class="calibre3">ifconfig</span><span class="italic"><span class="calibre_13"> command. This older command has been in use in other versions of Unix for decades, but is less capable. For consistency with contemporary recommended practice (and distributions that may not even include </span></span><span class="calibre3">ifconfig</span><span class="italic"><span class="calibre_13"> by default), we’ll use </span></span><span class="calibre3">ip</span><span class="italic"><span class="calibre_13">. Some other tools that </span></span><span class="calibre3">ip</span><span class="italic"><span class="calibre_13"> supplants are </span></span><span class="calibre3">route</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">arp</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p id="calibre_link-251" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">9.4.2 Subnets</span></span></span></p><p class="calibre_45"><span class="calibre_13">A subnet, defined previously, is a connected group of hosts with IP addresses in a particular range. For example, the hosts in the range 10.23.2.1 to 10.23.2.254 could comprise a subnet, as could all hosts between 10.23.1.1 and 10.23.255.254. Usually, the subnet hosts are on the same physical network, as shown in </span><a href="#calibre_link-527"><span class="italic"><span class="calibre_4">Figure 9-2</span></span></a><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You define a subnet with two pieces: a </span><span class="italic">network prefix</span><span class="calibre_13"> (also called a </span><span class="italic">routing prefix</span><span class="calibre_13">) and a </span><span class="italic">subnet mask</span><span class="calibre_13"> (sometimes called the </span><span class="italic">network mask</span><span class="calibre_13"> or </span><span class="italic">routing mask</span><span class="calibre_13">). Let’s say you want to create a subnet containing the IP addresses between 10.23.2.1 and 10.23.2.254. The network prefix is the part that is </span><span class="italic">common</span><span class="calibre_13"> to all addresses in the subnet; in this example, it’s 10.23.2.0 with a subnet mask of 255.255.255.0. Let’s see where those numbers come from.</span></p><p class="calibre_27"><span class="calibre_13">To see how the prefix and mask work together to give you all possible IP addresses on a subnet, we’ll look at the binary form. The mask marks the bit locations in an IP address that are common to the subnet. For example, here are the binary forms of 10.23.2.0 and 255.255.255.0.</span></p><p id="calibre_link-625" class="calibre_63">
</p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">10.23.2.0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00001010 00010111 00000010 00000000<br class="calibre7" />255.255.255.0:&nbsp;&nbsp;&nbsp; 11111111 11111111 11111111 00000000</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Now, let’s use boldface to mark the bit locations in 10.23.2.0 that are 1s in 255.255.255.0:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">10.23.2.0: </span><span class="calibre3"><span class="bold">00001010 00010111 00000010</span></span><span class="calibre3"> 00000000</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Any address containing the bit configuration in bold is in the subnet. Looking at the bits that are </span><span class="italic">not</span><span class="calibre_13"> in bold (the last set of eight 0s), setting any number of these bits to 1 results in a valid IP address in this subnet, with the exception of all 0s or all 1s.</span></p><p class="calibre_27"><span class="calibre_13">Putting it all together, you can see how a host with an IP address of 10.23.2.1 and a subnet mask of 255.255.255.0 is on the same subnet as any other computer that has an IP address beginning with 10.23.2. You can denote this entire subnet as 10.23.2.0/255.255.255.0.</span></p><p class="calibre_27"><span class="calibre_13"> Now let’s see how this becomes the shorthand notation (such as /24) that you’ve seen from tools such as </span><span class="calibre3">ip</span><span class="calibre_13">.</span></p><p id="calibre_link-252" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.4.3 Common Subnet Masks and CIDR Notation</span></span></span></p><p class="calibre_45"><span class="calibre_13">In most internet tools, you’ll encounter a different form of subnet representation called </span><span class="italic">Classless Inter-Domain Routing (CIDR) notation</span><span class="calibre_13">, where a subnet such as 10.23.2.0/255.255.255.0 is written as 10.23.2.0/24. This shorthand takes advantage of the simple pattern that subnet masks follow.</span></p><p class="calibre_27"><span class="calibre_13"> Look at the mask in binary form, as in the example you saw in the preceding section. You’ll find that all subnet masks are (or should be, according to RFC 1812) just one block of 1s followed by one block of 0s. For example, you just saw that 255.255.255.0 in binary form is 24 1-bits followed by 8 0-bits. The CIDR notation identifies the subnet mask by the number of </span><span class="italic">leading</span><span class="calibre_13"> 1s in the subnet mask. Therefore, a combination such as 10.23.2.0/24 includes both the subnet prefix and its subnet mask.</span></p><p class="calibre_27"><a href="#calibre_link-528"><span class="italic"><span class="calibre_4">Table 9-1</span></span></a><span class="calibre_13"> shows several example subnet masks and their CIDR forms. The /24 subnet mask is the most common on local end-user networks; it’s often used in combination with one of the private networks that you’ll see in </span>Section 9.22<span class="calibre_13">.</span></p><p id="calibre_link-528" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 9-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Subnet Masks</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Long form&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">CIDR form&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.0.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;/8&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.255.0.0&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;/16&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.240.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;/12&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.255.255.0&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;/24&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.255.255.192&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;/26&nbsp;</span></span><span class="calibre_56">
</span></td></tr></table><blockquote id="calibre_link-667" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you aren’t familiar with conversion between decimal, binary, and hexadecimal formats, you can use a calculator utility such as </span></span><span class="calibre3">bc</span><span class="italic"><span class="calibre_13"> or </span></span><span class="calibre3">dc</span><span class="italic"><span class="calibre_13"> to convert between different radix representations. For example, in </span></span><span class="calibre3">bc</span><span class="italic"><span class="calibre_13">, you can run the command </span></span><span class="calibre3">obase=2; 240</span><span class="italic"><span class="calibre_13"> to print the number 240 in binary (base 2) form.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Taking this one step further, you might have already noticed that if you’ve got the IP address and the subnet mask, you don’t even need to bother with a separate network definition. You can combine them, as you saw back in </span>Section 9.4.1<span class="calibre_13">; the </span><span class="calibre3">ip address show</span><span class="calibre_13"> output included 10.23.2.4/24.</span></p><p class="calibre_27"><span class="calibre_13">Identifying subnets and their hosts is the first building block to understanding how the internet works. However, you still need to connect the subnets.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-253" class="calibre_23"><span class="calibre1"><span class="bold"> 9.5 Routes and the Kernel Routing Table</span></span></p><p class="calibre_24"><span class="calibre_13">Connecting internet subnets is mostly a process of sending data through hosts connected to more than one subnet. Returning to </span><a href="#calibre_link-527"><span class="italic"><span class="calibre_4">Figure 9-2</span></span></a><span class="calibre_13">, think about Host A at IP address 10.23.2.4. This host is connected to a local network of 10.23.2.0/24 and can directly reach hosts on that network. To reach hosts on the rest of the internet, it must communicate through the router (host) at 10.23.2.1.</span></p><p class="calibre_27"><span class="calibre_13"> The Linux kernel distinguishes between these two different kinds of destinations by using a </span><span class="italic">routing table</span><span class="calibre_13"> to determine its routing behavior. To show the routing table, use the </span><span class="calibre3">ip route show</span><span class="calibre_13"> command. Here’s what you might see for a simple host such as 10.23.2.4:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ip route show</span></span><span class="calibre3"><br class="calibre7" />default via 10.23.2.1 dev enp0s31f6 proto static metric 100 <br class="calibre7" />10.23.2.0/24 dev enp0s31f6 proto kernel scope link src 10.23.2.4 metric 100</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The traditional tool for viewing routes is the </span></span><span class="calibre3">route</span><span class="italic"><span class="calibre_13"> command, run as </span></span><span class="calibre3">route -n</span><span class="italic"><span class="calibre_13">. The </span></span><span class="calibre3">-n</span><span class="italic"><span class="calibre_13"> option tells </span></span><span class="calibre3">route</span><span class="italic"><span class="calibre_13"> to show IP addresses instead of attempting to show hosts and networks by name. This is an important option to remember because you’ll be able to use it in other network-related commands, such as </span></span><span class="calibre3">netstat</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">This output can be a little difficult to read. Each line is a routing rule; let’s start with the second line in this example, and break that into fields.</span></p><p class="calibre_27"><span class="calibre_13"> The first field you encounter is </span><span class="calibre3">10.23.2.0/24</span><span class="calibre_13">, which is a destination network. As with previous examples, this is the host’s local subnet. This rule says that the host can reach the local subnet directly through its network interface, indicated by the </span><span class="calibre3">dev enp0s31f6</span><span class="calibre_13"> mechanism label after the destination. (Following this field is more detail about the route, including how it was put in place. You don’t need to worry about that for now.)</span></p><p class="calibre_27"><span class="calibre_13"> Then we can move back to the first line of output, which has the destination network </span><span class="calibre3">default</span><span class="calibre_13">. This rule, which matches any host at all, is also called the </span><span class="italic">default route</span><span class="calibre_13">, explained in the next section. The mechanism is </span><a id="calibre_link-668"></a><span class="calibre3">via 10.23.2.1</span><span class="calibre_13">, indicating that traffic using the default route is to be sent to 10.23.2.1 (in our example network, this is a router); </span><span class="calibre3">dev enp0s31f6</span><span class="calibre_13"> indicates that the physical transmission will happen on that network interface.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-254" class="calibre_23"><span class="calibre1"><span class="bold"> 9.6 The Default Gateway</span></span></p><p class="calibre_24"><span class="calibre_13">The entry for </span><span class="calibre3">default</span><span class="calibre_13"> in the routing table has special significance because it matches any address on the internet. In CIDR notation, it’s 0.0.0.0/0 for IPv4. This is the default route, and the address configured as the intermediary in the default route is the </span><span class="italic">default gateway</span><span class="calibre_13">. When no other rules match, the default route always does, and the default gateway is where you send messages when there is no other choice. You can configure a host without a default gateway, but it won’t be able to reach hosts outside the destinations in the routing table.</span></p><p class="calibre_27"><span class="calibre_13">On most networks with a netmask of /24 (255.255.255.0), the router is usually at address 1 of the subnet (for example, 10.23.2.1 in 10.23.2.0/24). This is simply a convention, and there can be exceptions.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">HOW THE KERNEL CHOOSES A ROUTE</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">There’s one tricky detail in routing. Say the host wants to send something to 10.23.2.132, which matches both rules in a routing table, the default route and 10.23.2.0/24. How does the kernel know to use the second one? The order in the routing table doesn’t matter; the kernel chooses the longest destination prefix that matches. This is where CIDR notation comes in particularly handy: 10.23.2.0/24 matches, and its prefix is 24 bits long; 0.0.0.0/0 also matches, but its prefix is 0 bits long (that is, it has no prefix), so the rule for 10.23.2.0/24 takes priority.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-255" class="calibre_42"><span class="calibre1"><span class="bold"> 9.7 IPv6 Addresses and Networks</span></span></p><p class="calibre_24"><span class="calibre_13">If you look back at </span>Section 9.4<span class="calibre_13">, you can see that IPv4 addresses consist of 32 bits, or 4 bytes. This yields a total of roughly 4.3 billion addresses, which is insufficient for the current scale of the internet. There are several problems caused by the lack of addresses in IPv4, so in response, the Internet Engineering Task Force (IETF) developed the next version, IPv6. Before looking at more network tools, we’ll discuss the IPv6 address space.</span></p><p class="calibre_27"><span class="calibre_13">An IPv6 address has 128 bits&mdash;32 bytes, arranged in eight sets of 4 bytes. In long form, an address is written as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">2001:0db8:0a0b:12f0:0000:0000:0000:8b6e</span></blockquote></blockquote><p id="calibre_link-626" class="calibre_30"><span class="calibre_13">The representation is hexadecimal, with each digit ranging from 0 to f. There are a few commonly used methods of abbreviating the representation. First, you can leave out any leading zeros (for example, 0db8 becomes db8), and one&mdash;and only one&mdash;set of contiguous zero groups can become :: (two colons). Therefore, you can write the preceding address as:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">2001:db8:a0b:12f0::8b6e</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Subnets are still denoted in CIDR notation. For the end user, they often cover half of the available bits in the address space (/64), but there are instances where fewer are used. The portion of the address space that’s unique for each host is called the </span><span class="italic">interface ID</span><span class="calibre_13">. </span><a></a><a href="#calibre_link-529"><span class="italic"><span class="calibre_4">Figure 9-3</span></span></a><span class="calibre_13"> shows the breakdown of an example address with a 64-bit subnet.</span></p><p class="calibre_34"><img src="images/000009.jpg" class="calibre_94" />
</p><p id="calibre_link-529" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Subnet and interface ID of a typical IPv6 address</span></span></span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> In this book, we’re generally concerned with the average user’s point of view. It’s slightly different for a service provider, where a subnet is further divided into a routing prefix and another network ID (sometimes also called a subnet). Don’t worry about this right now.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The last thing to know for now about IPv6 is that hosts normally have at least two addresses. The first, which is valid across the internet, is called the </span><span class="italic">global unicast address</span><span class="calibre_13">. The second, for the local network, is called the </span><span class="italic">link-local address</span><span class="calibre_13">. Link-local addresses always have an fe80::/10 prefix, followed by an all-zero 54-bit network ID, and end with a 64-bit interface ID. The result is that when you see a link-local address on your system, it will be in the fe80::/64 subnet.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Global unicast addresses have the prefix 2000::/3. Because the first byte starts with 001 with this prefix, that byte can be completed as 0010 or 0011. Therefore, a global unicast address always starts with 2 or 3.</span></span></blockquote><p id="calibre_link-256" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">9.7.1 Viewing IPv6 Configuration on Your System</span></span></span></p><p class="calibre_45"><span class="calibre_13">If your system has an IPv6 configuration, you would have gotten some IPv6 information from the </span><span class="calibre3">ip</span><span class="calibre_13"> command that you ran earlier. To single out IPv6, use the </span><span class="calibre3">-6</span><span class="calibre_13"> option:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ip -6 address show</span></span><span class="calibre3"><br class="calibre7" />1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 state UNKNOWN qlen 1000 inet6 ::1/128 scope host &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; valid_lft forever preferred_lft forever<br class="calibre7" />2: enp0s31f6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 state UP qlen 1000 inet6 2001:db8:8500:e:52b6:59cc:74e9:8b6e/64 scope global dynamic noprefixroute&nbsp; valid_lft 86136sec preferred_lft 86136sec inet6 fe80::d05c:97f9:7be8:bca/64 scope link noprefixroute&nbsp; valid_lft forever preferred_lft forever</span></blockquote><a id="calibre_link-722"></a></blockquote><p class="calibre_30"><span class="calibre_13"> In addition to the loopback interface (which we’ll talk about later), you can see two more addresses. The global unicast address is denoted with </span><span class="calibre3">scope global</span><span class="calibre_13">, and the link-local address gets a </span><span class="calibre3">scope link</span><span class="calibre_13"> label.</span></p><p class="calibre_27"><span class="calibre_13">Viewing the routes is similar:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ip -6 route show</span></span><span class="calibre3"><br class="calibre7" />::1 dev lo proto kernel metric 256 pref medium1 2001:db8:8500:e::/64 dev enp0s31f6 proto ra metric 100 pref medium2 fe80::/64 dev enp0s31f6 proto kernel metric 100 pref medium3 default via fe80::800d:7bff:feb8:14a0 dev enp0s31f6 proto ra metric 100 pref medium</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This is slightly more complicated than the IPv4 setup because there are both link-local and global subnets configured. The second line </span>1<span class="calibre_13"> is for destinations in the locally attached global unicast address subnets; the host knows that it can reach them directly, and the link-local line below </span>2<span class="calibre_13"> is similar. For the default route </span>3<span class="calibre_13"> (also written as ::/0 in IPv6; remember that this is anything that’s not directly connected), this configuration arranges for traffic to go through the router at the link-local address fe80::800d:7bff:feb8:14a0 instead of its address on the global subnet. You will see later that the router usually doesn’t care about how it gets traffic, only where the traffic is supposed to go. Using a link-local address as a default gateway has the advantage that it doesn’t need to change if the global IP address space changes.</span></p><p id="calibre_link-257" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.7.2 Configuring Dual-Stack Networks</span></span></span></p><p class="calibre_45"><span class="calibre_13">As you may have guessed by now, it’s possible to configure hosts and networks to run both IPv4 and IPv6. This is sometimes called a </span><span class="italic">dual-stack network</span><span class="calibre_13">, though the use of the word </span><span class="italic">stack</span><span class="calibre_13"> is questionable as there’s really only one layer of the typical network stack that’s being duplicated in this case (true dual-stack would be something like IP+IPX). Pedantry aside, the IPv4 and IPv6 protocols are independent of each other and can run simultaneously. On such a host, it’s up to the application (such as a web browser) to choose IPv4 or IPv6 to connect to another host.</span></p><p class="calibre_27"><span class="calibre_13">An application originally written for IPv4 does not automatically have IPv6 support. Fortunately, because the layers in the stack sitting on top of the network layer are unchanged, the code necessary to communicate with IPv6 is minimal and easy to add. Most important applications and servers now include IPv6 support.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-258" class="calibre_23"><span class="calibre1"><span class="bold">9.8 Basic ICMP and DNS Tools</span></span></p><p class="calibre_24"><span class="calibre_13">Now it’s time to look at some basic practical utilities to help you interact with hosts. These tools use two protocols of particular interest: Internet Control Message Protocol (ICMP), which can help you root out problems with connectivity and routing, and the Domain Name Service (DNS) system, which maps names to IP addresses so that you don’t have to remember a bunch of numbers.</span></p><p class="calibre_27"><span class="calibre_13">ICMP is a transport layer protocol used to configure and diagnose internet networks; it differs from other transport layer protocols in that it doesn’t carry any true user data, and thus there’s no application layer above it. By comparison, DNS is an application layer protocol used to map human-readable names to internet addresses.</span></p><p id="calibre_link-259" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.8.1 ping</span></span></span></p><p class="calibre_45"><span class="calibre3">ping</span><span class="calibre_13"> (see </span><a href="https://ftp.arl.army.mil/~mike/ping.html"><span class="italic"><span class="calibre_4">https://ftp.arl.army.mil/~mike/ping.html</span></span></a><span class="calibre_13">) is one of the most basic network debugging tools. It sends ICMP echo request packets to a host that asks a recipient host to return the packet to the sender. If the recipient host gets the packet and is configured to reply, it sends an ICMP echo response packet in return.</span></p><p class="calibre_27"><span class="calibre_13"> For example, say you run </span><span class="calibre3">ping 10.23.2.1</span><span class="calibre_13"> and get this output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ping 10.23.2.1</span></span><span class="calibre3"><br class="calibre7" />PING 10.23.2.1 (10.23.2.1) 56(84) bytes of data.<br class="calibre7" />64 bytes from 10.23.2.1: icmp_req=1 ttl=64 time=1.76 ms<br class="calibre7" />64 bytes from 10.23.2.1: icmp_req=2 ttl=64 time=2.35 ms<br class="calibre7" />64 bytes from 10.23.2.1: icmp_req=4 ttl=64 time=1.69 ms<br class="calibre7" />64 bytes from 10.23.2.1: icmp_req=5 ttl=64 time=1.61 ms</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The first line says that you’re sending 56-byte packets (84 bytes, if you include the headers) to 10.23.2.1 (by default, one packet per second), and the remaining lines indicate responses from 10.23.2.1. The most important parts of the output are the sequence number (</span><span class="calibre3">icmp_req</span><span class="calibre_13">) and the round-trip time (</span><span class="calibre3">time</span><span class="calibre_13">). The number of bytes returned is the size of the packet sent plus 8. (The content of the packets isn’t important to you.)</span></p><p class="calibre_27"><span class="calibre_13"> A gap in the sequence numbers, such as the one between 2 and 4, usually means there’s some kind of connectivity problem. Packets shouldn’t be arriving out of order, because </span><span class="calibre3">ping</span><span class="calibre_13"> sends only one packet a second. If a response takes more than a second (1,000 ms) to arrive, the connection is extremely slow.</span></p><p class="calibre_27"><span class="calibre_13"> The round-trip time is the total elapsed time between the moment that the request packet leaves and the moment that the response packet arrives. If there’s no way to reach the destination, the final router to see the packet returns an ICMP “host unreachable” packet to </span><span class="calibre3">ping</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">On a wired LAN, you should expect absolutely no packet loss and very low numbers for the round-trip time. (The preceding example output is from a wireless network.) You should also expect no packet loss from your network to and from your ISP and reasonably steady round-trip times.</span></p><blockquote id="calibre_link-716" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> For security reasons, some hosts on the internet disable response to ICMP echo request packets, so you might find that you can connect to a website on a host but not get a </span></span><span class="calibre3">ping</span><span class="italic"><span class="calibre_13"> response.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You can force </span><span class="calibre3">ping</span><span class="calibre_13"> to use IPv4 or IPv6 with the </span><span class="calibre3">-4</span><span class="calibre_13"> and </span><span class="calibre3">-6</span><span class="calibre_13"> options, respectively.</span></p><p id="calibre_link-260" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.8.2 DNS and host</span></span></span></p><p class="calibre_45"><span class="calibre_13">IP addresses are difficult to remember and subject to change, which is why we normally use names such as </span><span class="italic">www.example.com</span><span class="calibre_13"> instead. The Domain Name Service (DNS) library on your system normally handles this translation automatically, but sometimes you’ll want to manually translate between a name and an IP address. To find the IP address behind a domain name, use the </span><span class="calibre3">host</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">host www.example.com</span></span><span class="calibre3"><br class="calibre7" />example.com has address 172.17.216.34<br class="calibre7" />example.com has IPv6 address 2001:db8:220:1:248:1893:25c8:1946</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Notice how this example has both the IPv4 address 172.17.216.34 and the much longer IPv6 address. There may be more than one address for a hostname, and the output may additional information such as mail exchangers.</span></p><p class="calibre_27"><span class="calibre_13"> You can also use </span><span class="calibre3">host</span><span class="calibre_13"> in reverse: enter an IP address instead of a hostname to try to discover the hostname behind the IP address. Don’t expect this to work reliably, however. A single IP address may be associated with more than one hostname, and DNS doesn’t know how to determine which of those hostnames should correspond to an IP address. In addition, the administrator for that host needs to manually set up the reverse lookup, and administrators often don’t do so.</span></p><p class="calibre_27"><span class="calibre_13"> There’s a lot more to DNS than the </span><span class="calibre3">host</span><span class="calibre_13"> command. We’ll cover basic client configuration in </span>Section 9.15<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> There are </span><span class="calibre3">-4</span><span class="calibre_13"> and </span><span class="calibre3">-6</span><span class="calibre_13"> options for </span><span class="calibre3">host</span><span class="calibre_13">, but they work differently than you might expect. They force the </span><span class="calibre3">host</span><span class="calibre_13"> command to get its information via IPv4 or IPv6, but because that information should be the same regardless of the network protocol, the output will potentially include both IPv4 and IPv6.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-261" class="calibre_23"><span class="calibre1"><span class="bold"> 9.9 The Physical Layer and Ethernet</span></span></p><p class="calibre_24"><span class="calibre_13">One of the key points to understand about the internet is that it’s a </span><span class="italic">software</span><span class="calibre_13"> network. Nothing we’ve discussed so far is hardware specific, and indeed, one reason for the internet’s success is that it works on almost any kind of computer, operating system, and physical network. However, if you actually want to talk to another computer, you still have to put a network layer on top of some kind of hardware. That interface is the physical layer.</span></p><p id="calibre_link-749" class="calibre_27"><span class="calibre_13">In this book, we’ll look at the most common kind of physical layer: an Ethernet network. The IEEE 802 family of standards documentation defines many different kinds of Ethernet networks, from wired to wireless, but they all have a few things in common:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> All devices on an Ethernet network have a <span class="italic">Media Access Control (MAC) address</span>, sometimes called a <span class="italic">hardware address</span>. This address is independent of a host’s IP address, and it is unique to the host’s Ethernet network (but not necessarily a larger software network such as the internet). A sample MAC address is 10:78:d2:eb:76:97.</li><li value="2" class="calibre_8"> Devices on an Ethernet network send messages in <span class="italic">frames</span>, which are wrappers around the data sent. A frame contains the origin and destination MAC addresses.</li></ul><p class="calibre_33"><span class="calibre_13">Ethernet doesn’t really attempt to go beyond hardware on a single network. For example, if you have two different Ethernet networks with one host attached to both networks (and two different network interface devices), you can’t directly transmit a frame from one Ethernet network to the other unless you set up an Ethernet bridge. And this is where higher network layers (such as the internet layer) come in. By convention, each Ethernet network is also usually an internet subnet. Even though a frame can’t leave one physical network, a router can take the data out of a frame, repackage it, and send it to a host on a different physical network, which is exactly what happens on the internet.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-262" class="calibre_23"><span class="calibre1"><span class="bold"> 9.10 Understanding Kernel Network Interfaces</span></span></p><p class="calibre_24"><span class="calibre_13">The physical and the internet layers must be connected such that the internet layer can retain its hardware-independent flexibility. The Linux kernel maintains its own division between the two layers and provides a communication standard for linking them called a </span><span class="italic">(kernel) network interface</span><span class="calibre_13">. When you configure a network interface, you link the IP address settings from the internet side with the hardware identification on the physical device side. Network interfaces usually have names that indicate the kind of hardware underneath, such as </span><span class="italic">enp0s31f6</span><span class="calibre_13"> (an interface in a PCI slot). A name like this is called a </span><span class="italic">predictable network interface device name</span><span class="calibre_13">, because it remains the same after a reboot. At boot time, interfaces have traditional names such as </span><span class="italic">eth0</span><span class="calibre_13"> (the first Ethernet card in the computer) and </span><span class="italic">wlan0</span><span class="calibre_13"> (a wireless interface), but on most machines running systemd, they are quickly renamed.</span></p><p class="calibre_27"><span class="calibre_13"> In </span>Section 9.4.1<span class="calibre_13">, you learned how to view the network interface settings with </span><span class="calibre3">ip address show</span><span class="calibre_13">. The output is organized by interface. Here’s the one we saw before:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">2: enp0s31f6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state 1 UP group default qlen 1000 2 link/ether 40:8d:5c:fc:24:1f brd ff:ff:ff:ff:ff:ff inet 10.23.2.4/24 brd 10.23.2.255 scope global noprefixroute enp0s31f6 valid_lft forever preferred_lft forever&nbsp;&nbsp;&nbsp; inet6 2001:db8:8500:e:52b6:59cc:74e9:8b6e/64 scope global dynamic noprefixroute&nbsp; valid_lft 86054sec preferred_lft 86054sec inet6 fe80::d05c:97f9:7be8:bca/64 scope link noprefixroute&nbsp; valid_lft forever preferred_lft forever</span></blockquote><a id="calibre_link-801"></a></blockquote><p class="calibre_30"><span class="calibre_13"> Each network interface gets a number; this one is 2. Interface 1 is almost always the loopback described in </span>Section 9.16<span class="calibre_13">. The flag </span><span class="calibre3">UP</span><span class="calibre_13"> tells you that the interface is working </span>1<span class="calibre_13">. In addition to the internet layer pieces that we’ve already covered, you also see the MAC address on the physical layer, </span><span class="calibre3">link/ether</span><span class="calibre_13">
</span>2<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Although </span><span class="calibre3">ip</span><span class="calibre_13"> shows some hardware information, it’s designed primarily for viewing and configuring the software layers attached to the interfaces. To dig deeper into the hardware and physical layer behind a network interface, use something like the </span><span class="calibre3">ethtool</span><span class="calibre_13"> command to display or change the settings on Ethernet cards. (We’ll look briefly at wireless networks in </span>Section 9.27<span class="calibre_13">.)</span></p><div class="mbp_pagebreak"></div><p class="calibre_23"><span class="calibre1"><span class="bold"> 9.11 Introduction to Network Interface Configuration</span></span></p><p class="calibre_24"><span class="calibre_13">You’ve now seen all of the basic elements that go into the lower levels of a network stack: the physical layer, the network (internet) layer, and the Linux kernel’s network interfaces. In order to combine these pieces to connect a Linux machine to the internet, you or a piece of software must do the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Connect the network hardware and ensure that the kernel has a driver for it. If the driver is present, <span class="calibre3">ip address show</span> includes an entry for the device, even if it hasn’t been configured.</li><li value="2" class="calibre_8">Perform any additional physical layer setup, such as choosing a network name or password.</li><li value="3" class="calibre_8">Assign IP address(es) and subnets to the kernel network interface so that the kernel’s device drivers (physical layer) and internet subsystems (internet layer) can talk to each other.</li><li value="4" class="calibre_8">Add any additional necessary routes, including the default gateway.</li></ol><p class="calibre_33"><span class="calibre_13"> When all machines were big stationary boxes wired together, this was relatively straightforward: the kernel did step 1, you didn’t need step 2, and you’d do step 3 with the old </span><span class="calibre3">ifconfig</span><span class="calibre_13"> command and step 4 with the old </span><span class="calibre3">route</span><span class="calibre_13"> command. We’ll briefly look at how to do this with the </span><span class="calibre3">ip</span><span class="calibre_13"> command.</span></p><p id="calibre_link-263" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.11.1 Manually Configuring Interfaces</span></span></span></p><p class="calibre_45"><span class="calibre_13">We’re now going to see how to set up interfaces manually, but we won’t go into too much detail because doing so is rarely needed and error-prone. This is typically something you’d only do when experimenting with your system. Even when configuring, you may wish to use a tool such as Netplan to build the configuration in a text file instead of using a series of commands as shown next.</span></p><p id="calibre_link-669" class="calibre_27"><span class="calibre_13">You can bind an interface to the internet layer with the </span><span class="calibre3">ip</span><span class="calibre_13"> command. To add an IP address and subnet for a kernel network interface, you’d do this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip address add</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic">address/subnet</span></span><span class="calibre3"> dev </span><span class="calibre3"><span class="italic">interface</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3"><span class="italic">interface</span></span><span class="calibre_13"> is the name of the interface, such as </span><span class="italic">enp0s31f6</span><span class="calibre_13"> or </span><span class="italic">eth0</span><span class="calibre_13">. This also works for IPv6, except that you need to add parameters (for example, to indicate link-local status). If you’d like to see all of the options, see the ip-address(8) manual page.</span></p><p id="calibre_link-264" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.11.2 Manually Adding and Deleting Routes</span></span></span></p><p class="calibre_45"><span class="calibre_13">With the interface up, you can add routes, which is typically just a matter of setting the default gateway, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip route add default via</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic">gw-address</span></span><span class="calibre3"><span class="bold"> dev </span></span><span class="calibre3"><span class="italic">interface</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3"><span class="italic">gw-address</span></span><span class="calibre_13"> parameter is the IP address of your default gateway; it </span><span class="italic">must</span><span class="calibre_13"> be an address in a locally connected subnet assigned to one of your network interfaces.</span></p><p class="calibre_27"><span class="calibre_13">To remove the default gateway, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip route del default</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You can easily override the default gateway with other routes. For example, say your machine is on subnet 10.23.2.0/24, you want to reach a subnet at 192.168.45.0/24, and you know that the host at 10.23.2.44 can act as a router for that subnet. Run this command to send traffic bound for 192.168.45.0 to that router:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip route add 192.168.45.0/24 via 10.23.2.44</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You don’t need to specify the router in order to delete a route:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip route del 192.168.45.0/24</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Before you go crazy with routes, you should know that configuring routes is often more complicated than it appears. For this particular example, you also have to make sure that the routing for all hosts on 192.163.45.0/24 can lead back to 10.23.2.0/24, or the first route you add is basically useless.</span></p><p class="calibre_27"><span class="calibre_13"> Normally, you should keep things as simple as possible, setting up local networks so that their hosts need only a default route. If you need multiple subnets and the ability to route between them, it’s usually best to configure the routers acting as the default gateways to do all of the work of routing between different local subnets. (You’ll see an example in </span>Section 9.21<span class="calibre_13">.)</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-265" class="calibre_23"><span class="calibre1"><span class="bold">9.12 Boot-Activated Network Configuration</span></span></p><p class="calibre_24"><span class="calibre_13">We’ve discussed ways to manually configure a network, and the traditional way to ensure the correctness of a machine’s network configuration was to have init run a script to run the manual configuration at boot time. This boils down to running a tool like </span><span class="calibre3">ip</span><span class="calibre_13"> somewhere in the chain of boot events.</span></p><p class="calibre_27"><span class="calibre_13"> There have been many attempts in Linux to standardize configuration files for boot-time networking. The tools </span><span class="calibre3">ifup</span><span class="calibre_13"> and </span><span class="calibre3">ifdown</span><span class="calibre_13"> are among them; for example, a boot script can (in theory) run </span><span class="calibre3">ifup eth0</span><span class="calibre_13"> to run the correct </span><span class="calibre3">ip</span><span class="calibre_13"> commands to set up an interface. Unfortunately, different distributions have completely different implementations of </span><span class="calibre3">ifup</span><span class="calibre_13"> and </span><span class="calibre3">ifdown</span><span class="calibre_13">, and as a result, their configuration files are also different.</span></p><p class="calibre_27"><span class="calibre_13">There is a deeper disparity due to the fact that network configuration elements are present in each of the different network layers; a consequence is that the software responsible for making networking happen is in several parts of kernel and user-space tools, written and maintained by different developers. In Linux, there is a general agreement not to share configuration files among separate tool suites or libraries, because changes made for one tool could break another.</span></p><p class="calibre_27"><span class="calibre_13">Dealing with network configuration in several different places makes it difficult to manage systems. As a result, there are several different network management tools that each have their own approach to the configuration problem. However, these tend to be specialized for the particular kind of role that a Linux machine can serve. A tool might work on a desktop but not be appropriate for a server.</span></p><p class="calibre_27"><span class="calibre_13"> A tool called Netplan offers a different approach to the configuration problem. Rather than managing the network, Netplan is nothing more than a unified network configuration standard and a tool to transform that configuration into the files used by existing network managers. Currently, Netplan supports NetworkManager and systemd-networkd, which we’ll talk about later in this chapter. Netplan files are in YAML format, and reside in </span><span class="italic">/etc/netplan</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Before we can talk about network configuration managers, let’s look a little closer at some of the issues they face.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-266" class="calibre_23"><span class="calibre1"><span class="bold"> 9.13 Problems with Manual and Boot-Activated Network Configuration</span></span></p><p class="calibre_24"><span class="calibre_13">Although most systems used to configure the network in their boot mechanisms&mdash;and many servers still do&mdash;the dynamic nature of modern networks means that most machines don’t have static (unchanging) IP addresses. In IPv4, rather than storing the IP address and other network information on your machine, your machine gets this information from somewhere on the local physical network when it first attaches to that network. Most normal network client applications don’t particularly care what IP address your machine uses, as long as it works. Dynamic Host Configuration Protocol (DHCP, described in </span><a id="calibre_link-593"></a>Section 9.19<span class="calibre_13">) tools do the basic network layer configuration on typical IPv4 clients. In IPv6, clients are capable of configuring themselves to a certain extent; we’ll look at that briefly in </span>Section 9.20<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">There’s more to the story, though. For example, wireless networks add further dimensions to interface configuration, such as network names, authentication, and encryption techniques. When you step back to look at the bigger picture, you see that your system needs a way to answer the following questions:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">If the machine has multiple physical network interfaces (such as a notebook with wired and wireless Ethernet), how do you choose which one(s) to use?</li><li value="2" class="calibre_8">How should the machine set up the physical interface? For wireless networks, this includes scanning for network names, choosing a name, and negotiating authentication.</li><li value="3" class="calibre_8">Once the physical network interface is connected, how should the machine set up the software network layers, such as the internet layer?</li><li value="4" class="calibre_8">How can you let a user choose connectivity options? For example, how do you let a user choose a wireless network?</li><li value="5" class="calibre_8">What should the machine do if it loses connectivity on a network interface?</li></ul><p class="calibre_33"><span class="calibre_13">Answering these questions is usually more than simple boot scripts can handle, and it’s a real hassle to do it all by hand. The answer is to use a system service that can monitor physical networks and choose (and automatically configure) the kernel network interfaces based on a set of rules that makes sense to the user. The service should also be able to respond to requests from users, who in turn should be able to change the wireless network they’re on without having to become root.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-267" class="calibre_23"><span class="calibre1"><span class="bold"> 9.14 Network Configuration Managers</span></span></p><p class="calibre_24"><span class="calibre_13">There are several ways to automatically configure networks in Linux-based systems. The most widely used option on desktops and notebooks is NetworkManager. There is an add-on to systemd, called systemd-networkd, that can do basic network configuration and is useful for machines that don’t need much flexibility (such as servers), but it doesn’t have the dynamic capabilities of NetworkManager. Other network configuration management systems are mainly targeted for smaller embedded systems, such as OpenWRT’s </span><span class="calibre3">netifd</span><span class="calibre_13">, Android’s ConnectivityManager service, ConnMan, and Wicd.</span></p><p class="calibre_27"><span class="calibre_13"> We’ll briefly discuss NetworkManager because it’s the one you’re most likely to encounter. We won’t go into a tremendous amount of detail, though, because after you see the basic concepts, NetworkManager and other configuration systems will be much easier to understand. If you’re interested in systemd-networkd, the systemd.network(5) manual page describes the settings, and the configuration directory is </span><span class="italic">/etc/systemd/network</span><span class="calibre_13">.</span></p><p id="calibre_link-268" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.14.1 NetworkManager Operation</span></span></span></p><p class="calibre_45"><span class="calibre_13">NetworkManager is a daemon that the system starts upon boot. Like most daemons, it does not depend on a running desktop component. Its job is to listen to events from the system and users and to change the network configuration based on a set of rules.</span></p><p class="calibre_27"><span class="calibre_13"> When running, NetworkManager maintains two basic levels of configuration. The first is a collection of information about available hardware devices, which it normally collects from the kernel and maintains by monitoring udev over the Desktop Bus (D-Bus). The second configuration level is a more specific list of </span><span class="italic">connections</span><span class="calibre_13">: hardware devices and additional physical and network layer configuration parameters. For example, a wireless network can be represented as a connection.</span></p><p class="calibre_27"><span class="calibre_13"> To activate a connection, NetworkManager often delegates the tasks to other specialized network tools and daemons, such as </span><span class="calibre3">dhclient</span><span class="calibre_13">, to get internet layer configuration from a locally attached physical network. Because network configuration tools and schemes vary among distributions, NetworkManager uses plug-ins to interface with them, rather than imposing its own standard. There are plug-ins for the both the Debian/Ubuntu and Red Hat&ndash;style interface configuration, for example.</span></p><p class="calibre_27"><span class="calibre_13">Upon startup, NetworkManager gathers all available network device information, searches its list of connections, and then decides to try to activate one. Here’s how it makes that decision for Ethernet interfaces:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">If a wired connection is available, try to connect using it. Otherwise, try the wireless connections.</li><li value="2" class="calibre_8">Scan the list of available wireless networks. If a network is available that you’ve previously connected to, NetworkManager will try it again.</li><li value="3" class="calibre_8">If more than one previously connected wireless network is available, select the most recently connected.</li></ol><p class="calibre_33"><span class="calibre_13">After establishing a connection, NetworkManager maintains it until the connection is lost, a better network becomes available (for example, you plug in a network cable while connected over wireless), or the user forces a change.</span></p><p id="calibre_link-269" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.14.2 NetworkManager Interaction</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most users interact with NetworkManager through an applet on the desktop; it’s usually an icon in the upper or lower right that indicates the connection status (wired, wireless, or not connected). When you click the icon, you get a number of connectivity options, such as a choice of wireless networks and an option to disconnect from your current network. Each desktop environment has its own version of this applet, so it looks a little different on each one.</span></p><p class="calibre_27"><span class="calibre_13"> In addition to the applet, there are a few tools that you can use to query and control NetworkManager from your shell. For a very quick summary of your current connection status, use the </span><span class="calibre3">nmcli</span><span class="calibre_13"> command with no arguments. You’ll get a list of interfaces and configuration parameters. In some ways, this is like </span><a id="calibre_link-822"></a><span class="calibre3">ip</span><span class="calibre_13"> except that there’s more detail, especially when you’re viewing wireless connections.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">nmcli</span><span class="calibre_13"> command allows you to control NetworkManager from the command line. This is a somewhat extensive command; in fact, there’s an nmcli-examples(5) manual page in addition to the usual nmcli(1) manual page.</span></p><p class="calibre_27"><span class="calibre_13"> Finally, the utility </span><span class="calibre3">nm-online</span><span class="calibre_13"> will tell you whether the network is up or down. If the network is up, the command returns </span><span class="calibre3">0</span><span class="calibre_13"> as its exit code; it’s nonzero otherwise. (For more on how to use an exit code in a shell script, see </span>Chapter 11<span class="calibre_13">.)</span></p><p id="calibre_link-270" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.14.3 NetworkManager Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">NetworkManager’s general configuration directory is usually </span><span class="italic">/etc/NetworkManager</span><span class="calibre_13">, and there are several different kinds of configuration. The general configuration file is </span><span class="italic">NetworkManager.conf</span><span class="calibre_13">. The format is similar to the XDG-style </span><span class="italic">.desktop</span><span class="calibre_13"> and Microsoft </span><span class="italic">.ini</span><span class="calibre_13"> files, with key-value parameters falling into different sections. You’ll find that nearly every configuration file has a </span><span class="calibre3">[main]</span><span class="calibre_13"> section that defines the plug-ins to use. Here’s a simple example that activates the ifupdown plug-in used by Ubuntu and Debian:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[main]<br class="calibre7" />plugins=ifupdown,keyfile</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Other distribution-specific plug-ins are ifcfg-rh (for Red Hat&ndash;style distributions) and ifcfg-suse (for SuSE). The keyfile plug-in that you also see here supports NetworkManager’s native configuration file support. When using the plug-in, you can see all of the system’s known connections in </span><span class="italic">/etc/NetworkManager/system-connections</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> For the most part, you won’t need to change </span><span class="italic">NetworkManager.conf</span><span class="calibre_13"> because the more specific configuration options are found in other files.</span></p><p class="calibre_46"><span class="bold">Unmanaged Interfaces</span></p><p class="calibre_25"><span class="calibre_13">Although you may want NetworkManager to manage most of your network interfaces, there will be times when you want it to ignore interfaces. For example, most users wouldn’t need any kind of dynamic configuration on the localhost (</span><span class="italic">lo</span><span class="calibre_13">; see </span>Section 9.16<span class="calibre_13">) interface, because its configuration never changes. You also want to configure this interface early in the boot process, because basic system services often depend on it. Most distributions keep NetworkManager away from localhost.</span></p><p class="calibre_27"><span class="calibre_13"> You can tell NetworkManager to disregard an interface by using plug-ins. If you’re using the ifupdown plug-in (for example, in Ubuntu and Debian), add the interface configuration to your </span><span class="italic">/etc/network/interfaces</span><span class="calibre_13"> file and then set the value of </span><span class="calibre3">managed</span><span class="calibre_13"> to </span><span class="calibre3">false</span><span class="calibre_13"> in the </span><span class="calibre3">ifupdown</span><span class="calibre_13"> section of the </span><span class="italic">NetworkManager.conf</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[ifupdown]<br class="calibre7" />managed=false</span></blockquote></blockquote><p id="calibre_link-717" class="calibre_30"><span class="calibre_13">For the ifcfg-rh plug-in that Fedora and Red Hat use, look for a line like this in the </span><span class="italic">/etc/sysconfig/network-scripts</span><span class="calibre_13"> directory that contains the </span><span class="italic">ifcfg-*</span><span class="calibre_13"> configuration files:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">NM_CONTROLLED=yes</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If this line is not present or the value is set to </span><span class="calibre3">no</span><span class="calibre_13">, NetworkManager ignores the interface. In the case of localhost, you’ll find it deactivated in the </span><span class="italic">ifcfg-lo</span><span class="calibre_13"> file. You can also specify a hardware address to ignore, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">HWADDR=10:78:d2:eb:76:97</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you don’t use either of these network configuration schemes, you can still use the keyfile plug-in to specify the unmanaged device directly inside your </span><span class="italic">NetworkManager.conf</span><span class="calibre_13"> file using its MAC address. Here’s an example showing two unmanaged devices:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[keyfile]<br class="calibre7" />unmanaged-devices=mac:10:78:d2:eb:76:97;mac:1c:65:9d:cc:ff:b9</span></blockquote></blockquote><p class="calibre_42"><span class="bold">Dispatching</span></p><p class="calibre_25"><span class="calibre_13">One final detail of NetworkManager configuration relates to specifying additional system actions for when a network interface goes up or down. For example, some network daemons need to know when to start or stop listening on an interface in order to work correctly (such as the secure shell daemon discussed in the next chapter).</span></p><p class="calibre_27"><span class="calibre_13"> When a system’s network interface status changes, NetworkManager runs everything in </span><span class="italic">/etc/NetworkManager/dispatcher.d</span><span class="calibre_13"> with an argument such as </span><span class="calibre3">up</span><span class="calibre_13"> or </span><span class="calibre3">down</span><span class="calibre_13">. This is relatively straightforward, but many distributions have their own network control scripts so they don’t place the individual dispatcher scripts in this directory. Ubuntu, for example, has just one script named </span><span class="calibre3">01ifupdown</span><span class="calibre_13"> that runs everything in an appropriate subdirectory of </span><span class="italic">/etc/network</span><span class="calibre_13">, such as </span><span class="italic">/etc/network/if-up.d</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">As with the rest of the NetworkManager configuration, the details of these scripts are relatively unimportant; all you need to know is how to track down the appropriate location if you need to make an addition or change (or use Netplan and let it figure out the location for you). As ever, don’t be shy about looking at scripts on your system.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-271" class="calibre_23"><span class="calibre1"><span class="bold"> 9.15 Resolving Hostnames</span></span></p><p class="calibre_24"><span class="calibre_13">One of the final basic tasks in any network configuration is hostname resolution with DNS. You’ve already seen the </span><span class="calibre3">host</span><span class="calibre_13"> resolution tool that translates a name such as </span><span class="italic">www.example.com</span><span class="calibre_13"> to an IP address such as 10.23.2.132.</span></p><p class="calibre_27"><span class="calibre_13"> DNS differs from the network elements we’ve looked at so far because it’s in the application layer, entirely in user space. Therefore, it’s technically slightly out of place in this chapter alongside the internet and physical layer discussion. However, without proper DNS configuration, your internet connection is practically worthless. No one in their right mind advertises IP addresses (much less IPv6 addresses) for websites and email addresses, because a host’s IP address is subject to change and it’s not easy to remember a bunch of numbers.</span><a id="calibre_link-737"></a></p><p class="calibre_27"><span class="calibre_13">Practically all network applications on a Linux system perform DNS lookups. The resolution process typically unfolds like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The application calls a function to look up the IP address behind a hostname. This function is in the system’s shared library, so the application doesn’t need to know the details of how it works or whether the implementation will change.</li><li value="2" class="calibre_8">When the function in the shared library runs, it acts according to a set of rules (found in <span class="italic">/etc/nsswitch.conf</span>; see Section 9.15.4) to determine a plan of action on lookups. For example, the rules usually say that even before going to DNS, check for a manual override in the <span class="italic">/etc/hosts</span> file.</li><li value="3" class="calibre_8">When the function decides to use DNS for the name lookup, it consults an additional configuration file to find a DNS name server. The name server is given as an IP address.</li><li value="4" class="calibre_8">The function sends a DNS lookup request (over the network) to the name server.</li><li value="5" class="calibre_8">The name server replies with the IP address for the hostname, and the function returns this IP address to the application.</li></ol><p class="calibre_33"><span class="calibre_13">This is the simplified version. In a typical contemporary system, there are more actors attempting to speed up the transaction or add flexibility. Let’s ignore that for now and look at some of the basic pieces. As with other kinds of network configuration, you probably won’t need to change hostname resolution, but it’s helpful to see how it works.</span></p><p id="calibre_link-272" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.15.1 /etc/hosts</span></span></span></p><p class="calibre_45"><span class="calibre_13">On most systems, you can override hostname lookups with the </span><span class="italic">/etc/hosts</span><span class="calibre_13"> file. It usually looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; localhost<br class="calibre7" />10.23.2.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; atlantic.aem7.net&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; atlantic<br class="calibre7" />10.23.2.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pacific.aem7.net&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pacific<br class="calibre7" />::1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; localhost ip6-localhost</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’ll nearly always see the entry (or entries) for localhost here (see </span>Section 9.16<span class="calibre_13">). The other entries here illustrate a simple way to add hosts on a local subnet.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> In the bad old days, there was one central </span></span>hosts<span class="italic"><span class="calibre_13"> file that everyone copied to their own machine in order to stay up to date (see RFCs 606, 608, 623, and 625), but as the ARPANET/internet grew, this quickly got out of hand.</span></span></blockquote><p id="calibre_link-273" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">9.15.2 resolv.conf</span></span></span></p><p class="calibre_45"><span class="calibre_13">The traditional configuration file for DNS servers is </span><span class="italic">/etc/resolv.conf</span><span class="calibre_13">. When things were simpler, a typical example might have looked like this, where the ISP’s name server addresses are 10.32.45.23 and 10.3.2.3:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">search mydomain.example.com example.com<br class="calibre7" />nameserver 10.32.45.23<br class="calibre7" />nameserver 10.3.2.3</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">search</span><span class="calibre_13"> line defines rules for incomplete hostnames (just the first part of the hostname&mdash;for example, </span><span class="calibre3">myserver</span><span class="calibre_13"> instead of </span><span class="calibre3">myserver.example.com</span><span class="calibre_13">). Here, the resolver library would try to look up </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre3">.mydomain.example.com</span><span class="calibre_13"> and </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre3">.example.com</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Generally, name lookups are no longer this straightforward. Many enhancements and modifications have been made to the DNS configuration.</span></p><p id="calibre_link-274" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.15.3 Caching and Zero-Configuration DNS</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are two main problems with the traditional DNS configuration. First, the local machine does not cache name server replies, so frequent repeated network access may be unnecessarily slow due to name server requests. To solve this problem, many machines (and routers, if acting as name servers) run an intermediate daemon to intercept name server requests and cache the reply, and then use the cached answers if possible. The most common of these daemons is systemd-resolved; you might also see dnsmasq or nscd on your system. You can also set up BIND (the standard Unix name server daemon) as a cache. You can often tell that you’re running a name server caching daemon if you see 127.0.0.53 or 127.0.0.1 either in your </span><span class="italic">/etc/resolv.conf</span><span class="calibre_13"> file or listed as the server when you run </span><span class="calibre3">nslookup -debug </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13">. Take a closer look, though. If you’re running systemd-resolved, you might notice that </span><span class="italic">resolv.conf</span><span class="calibre_13"> isn’t even a file in </span><span class="italic">/etc</span><span class="calibre_13">; it’s a link to an automatically generated file in </span><span class="italic">/run</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">There’s a lot more to systemd-resolved than meets the eye, as it can combine several name lookup services and expose them differently for each interface. This addresses the second problem with the traditional name server setup: it can be particularly inflexible if you want to be able to look up names on your local network without messing around with a lot of configuration. For example, if you set up a network appliance on your network, you’ll want to be able to call it by name immediately. This is part of the idea behind zero-configuration name service systems such as Multicast DNS (mDNS) and Link-Local Multicast Name Resolution (LLMNR). If a process wants to find a host by name on the local network, it just broadcasts a request over the network; if present, the target host replies with its address. These protocols go beyond hostname resolution by also providing information about available services.</span></p><p id="calibre_link-718" class="calibre_27"><span class="calibre_13">You can check the current DNS settings with the </span><span class="calibre3">resolvectl status</span><span class="calibre_13"> command (note that this might be called </span><span class="calibre3">systemd-resolve</span><span class="calibre_13"> on older systems). You’ll get a list of global settings (typically of little use), and then you’ll see the settings for each individual interface. It’ll look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Link 2 (enp0s31f6) Current Scopes: DNS LLMNR setting: yes<br class="calibre7" />MulticastDNS setting: no DNSSEC setting: no DNSSEC supported: no DNS Servers: 8.8.8.8 DNS Domain: ~.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You can see various supported name protocols here, as well as the name server that systemd-resolved consults for a name that it doesn’t know.</span></p><p class="calibre_27"><span class="calibre_13"> We’re not going to go further into DNS or systemd-resolved because it’s such a vast topic. If you want to change your settings, take a look at the resolved.conf(5) manual page and proceed to change </span><span class="italic">/etc/systemd/resolved.conf</span><span class="calibre_13">. However, you’ll probably need to read up on a lot of the systemd-resolved documentation, as well as get familiar with DNS in general from a source such as </span><span class="italic">DNS and BIND</span><span class="calibre_13">, 5th edition, by Cricket Liu and Paul Albitz (O’Reilly, 2006).</span></p><p id="calibre_link-275" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.15.4 /etc/nsswitch.conf</span></span></span></p><p class="calibre_45"><span class="calibre_13">Before we leave the topic of name lookups, there’s one last setting you should be aware of. The </span><span class="italic">/etc/nsswitch.conf</span><span class="calibre_13"> file is the traditional interface for controlling several name-related precedence settings on your system, such as user and password information, and it has a host lookup setting. The file on your system should have a line like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">hosts:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; files dns</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Putting </span><span class="calibre3">files</span><span class="calibre_13"> ahead of </span><span class="calibre3">dns</span><span class="calibre_13"> here ensures that, when looking up hosts, your system checks the </span><span class="italic">/etc/hosts</span><span class="calibre_13"> file for host lookup before asking any DNS server, including systemd-resolved. This is usually a good idea (especially for looking up localhost, as discussed next), but your </span><span class="italic">/etc/hosts</span><span class="calibre_13"> file should be as </span><span class="italic">short</span><span class="calibre_13"> as possible. Don’t put anything in there to boost performance; doing so will burn you later. You can put hosts within a small private LAN in </span><span class="italic">/etc/hosts</span><span class="calibre_13">, but the general rule of thumb is that if a particular host has a DNS entry, it has no place in </span><span class="italic">/etc/hosts</span><span class="calibre_13">. (The </span><span class="italic">/etc/hosts</span><span class="calibre_13"> file is also useful for resolving hostnames in the early stages of booting, when the network may not be available.)</span></p><p class="calibre_27"><span class="calibre_13"> All of this works through standard calls in the system library. It can be complicated to remember all of the places that name lookups can happen, but if you ever need to trace something from the bottom up, start with /</span><span class="italic">etc/nsswitch.conf</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-276" class="calibre_23"><span class="calibre1"><span class="bold">9.16 Localhost</span></span></p><p class="calibre_24"><span class="calibre_13">When running </span><span class="calibre3">ip address show</span><span class="calibre_13">, you’ll notice the </span><span class="italic">lo</span><span class="calibre_13"> interface:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host&nbsp; valid_lft forever preferred_lft forever</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="italic">lo</span><span class="calibre_13"> interface is a virtual network interface called the </span><span class="italic">loopback</span><span class="calibre_13"> because it “loops back” to itself. The effect is that connecting to 127.0.0.1 (or ::1 in IPv6) is connecting to the machine that you’re currently using. When outgoing data to localhost reaches the kernel network interface for </span><span class="italic">lo</span><span class="calibre_13">, the kernel just repackages it as incoming data and sends it back through </span><span class="italic">lo</span><span class="calibre_13">, for use by any server program that’s listening (by default, most do).</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="italic">lo</span><span class="calibre_13"> loopback interface is often the only place you might see static network configuration in boot-time scripts. For example, Ubuntu’s </span><span class="calibre3">ifup</span><span class="calibre_13"> command reads </span><span class="italic">/etc/network/interfaces</span><span class="calibre_13">. However, this is often redundant, because systemd configures the loopback interface upon startup.</span></p><p class="calibre_27"><span class="calibre_13">The loopback interface has one peculiarity, which you might have noticed. The netmask is /8, and anything starting with 127 is assigned to loopback. This allows you to run different servers on different IPv4 addresses in the loopback space without configuring additional interfaces. One server that takes advantage of this is systemd-resolved, which uses 127.0.0.53. This way, it won’t interfere with another name server running on 127.0.0.1. So far, IPv6 defines only one loopback address, but there are proposals to change this.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-277" class="calibre_23"><span class="calibre1"><span class="bold"> 9.17 The Transport Layer: TCP, UDP, and Services</span></span></p><p class="calibre_24"><span class="calibre_13">So far, we’ve only seen how packets move from host to host on the internet&mdash;in other words, the </span><span class="italic">where</span><span class="calibre_13"> question from the beginning of the chapter. Now let’s start to answer the question of </span><span class="italic">what</span><span class="calibre_13"> is transmitted. It’s important to know how your computer presents the packet data it receives from other hosts to its running processes. It would be difficult and inconvenient for user-space programs to deal with a bunch of raw packets the way that the kernel does. Flexibility is especially important: more than one application should be able to talk to the network at the same time (for example, you might have email and several web clients running).</span></p><p class="calibre_27"><span class="italic">Transport layer</span><span class="calibre_13"> protocols bridge the gap between the raw packets of the internet layer and the refined needs of applications. The two most popular transport protocols are the Transmission Control Protocol (TCP) and the User Datagram Protocol (UDP). We’ll concentrate on TCP because it’s by far the most common protocol in use, but we’ll also take a quick look at UDP.</span></p><p id="calibre_link-278" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.17.1 TCP Ports and Connections</span></span></span></p><p class="calibre_45"><span class="calibre_13">TCP provides for multiple network applications on one machine by means of network </span><span class="italic">ports</span><span class="calibre_13">, which are just numbers used in conjunction with an IP address. If an IP address of a host is like the postal address of an apartment building, a port number is like a mailbox number&mdash;it’s a further subdivision.</span></p><p class="calibre_27"><span class="calibre_13"> When using TCP, an application opens a </span><span class="italic">connection</span><span class="calibre_13"> (not to be confused with NetworkManager connections) between one port on its own machine and a port on a remote host. For example, an application such as a web browser could open a connection between port 36406 on its own machine and port 80 on a remote host. From the application’s point of view, port 36406 is the local port and port 80 is the remote port.</span></p><p class="calibre_27"><span class="calibre_13"> You can identify a connection by using the pair of IP addresses and port numbers. To view the connections currently open on your machine, use </span><span class="calibre3">netstat</span><span class="calibre_13">. Here’s an example that shows TCP connections; the </span><span class="calibre3">-n</span><span class="calibre_13"> option disables hostname resolution (DNS), and </span><span class="calibre3">-t</span><span class="calibre_13"> limits the output to TCP:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">netstat -nt</span></span><span class="calibre3"><br class="calibre7" />Active Internet connections (w/o servers)<br class="calibre7" />Proto Recv-Q Send-Q Local Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Foreign Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State <br class="calibre7" />tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 10.23.2.4:47626&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.194.79.125:5222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED<br class="calibre7" />tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 10.23.2.4:41475&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 172.19.52.144:6667&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED<br class="calibre7" />tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 10.23.2.4:57132&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.231.135:22&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The Local Address and Foreign Address fields refer to connections from your machine’s point of view, so the machine here has an interface configured at 10.23.2.4, and ports 47626, 41475, and 57132 on the local side are all connected. The first connection here shows port 47626 connected to port 5222 of 10.194.79.125.</span></p><p class="calibre_27"><span class="calibre_13"> To show only IPv6 connections, add </span><span class="calibre3">-6</span><span class="calibre_13"> to the </span><span class="calibre3">netstat</span><span class="calibre_13"> options.</span></p><p class="calibre_46"><span class="bold">Establishing TCP Connections</span></p><p class="calibre_25"><span class="calibre_13">To establish a transport layer connection, a process on one host initiates the connection from one of its local ports to a port on a second host with a special series of packets. In order to recognize the incoming connection and respond, the second host must have a process </span><span class="italic">listening</span><span class="calibre_13"> on the correct port. Usually, the connecting process is called the </span><span class="italic">client</span><span class="calibre_13">, and the listener is called the </span><span class="italic">server</span><span class="calibre_13"> (more about this in </span>Chapter 10<span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> The important thing to know about the ports is that the client picks a port on its side that isn’t currently in use, and nearly always connects to some well-known port on the server side. Recall this output from the </span><span class="calibre3">netstat</span><span class="calibre_13"> command in the preceding section:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Proto Recv-Q Send-Q Local Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Foreign Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State <br class="calibre7" />tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 10.23.2.4:47626&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.194.79.125:5222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED</span></blockquote></blockquote><p id="calibre_link-747" class="calibre_30"><span class="calibre_13">With a little knowledge about port-numbering conventions, you can see that this connection was probably initiated by a local client to a remote server, because the port on the local side (47626) looks like a dynamically assigned number, whereas the remote port (5222) is a well-known service listed in </span><span class="italic">/etc/services</span><span class="calibre_13"> (the Jabber or XMPP messaging service, to be specific). You’ll see many connections to port 443 (the default for HTTPS) on most desktop machines.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A dynamically assigned port is called an </span></span>ephemeral port<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">However, if the local port in the output is well known, a remote host probably initiated the connection. In this example, remote host 172.24.54.234 has connected to port 443 on the local host:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Proto Recv-Q Send-Q Local Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Foreign Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State <br class="calibre7" />tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 10.23.2.4:443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 172.24.54.234:43035&nbsp;&nbsp;&nbsp;&nbsp; ESTABLISHED</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A remote host connecting to your machine on a well-known port implies that a server on your local machine is listening on this port. To confirm this, list all TCP ports that your machine is listening on with </span><span class="calibre3">netstat</span><span class="calibre_13">, this time with the </span><span class="calibre3">-l</span><span class="calibre_13"> option, which shows ports that processes are listening on:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">netstat -ntl</span></span><span class="calibre3"><br class="calibre7" />Active Internet connections (only servers)<br class="calibre7" />Proto Recv-Q Send-Q Local Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Foreign Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; State 1 tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.0.0.0:80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTEN2 tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.0.0.0:443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTEN 3 tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 127.0.0.53:53&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0.0.0:*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTEN <br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Line </span>1<span class="calibre_13"> with 0.0.0.0:80 as the local address shows that the local machine is listening on port 80 for connections from any remote machine; it’s the same for port 443 (line </span>2<span class="calibre_13">). A server can restrict the access to certain interfaces, as shown in line </span>3<span class="calibre_13">, where something is listening for connections only on the localhost interface. In this case, it’s systemd-resolved; we talked about why it’s listening using 127.0.0.53 instead of 127.0.0.1 back in </span>Section 9.16<span class="calibre_13">. To learn even more, use </span><span class="calibre3">lsof</span><span class="calibre_13"> to identify the specific process that’s listening (as discussed in </span>Section 10.5.1<span class="calibre_13">).</span></p><p class="calibre_46"><span class="bold">Port Numbers and /etc/services</span></p><p class="calibre_25"><span class="calibre_13">How do you know if a port is well known? There’s no single way to tell, but a good place to start is to look in </span><span class="italic">/etc/services</span><span class="calibre_13">, which translates well-known port numbers into names. This is a plaintext file. You should see entries like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">ssh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22/tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # SSH Remote Login Protocol<br class="calibre7" />smtp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 25/tcp<br class="calibre7" />domain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 53/udp</span></blockquote></blockquote><p id="calibre_link-748" class="calibre_30"><span class="calibre_13">The first column is a name, and the second column indicates the port number and the specific transport layer protocol (which can be other than TCP).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> In addition to </span></span>/etc/services<span class="italic"><span class="calibre_13">, an online registry for ports at </span></span><a href="http://www.iana.org/"><span class="italic"><span class="calibre_4">http://www.iana.org/</span></span></a><span class="italic"><span class="calibre_13"> is governed by the RFC 6335 network standards document.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">On Linux, only processes running as the superuser can use ports 1 through 1023, also known as system, well-known, or privileged ports. All user processes may listen on and create connections from ports 1024 and up.</span></p><p class="calibre_46"><span class="bold">Characteristics of TCP</span></p><p class="calibre_25"><span class="calibre_13">TCP is popular as a transport layer protocol because it requires relatively little from the application side. An application process only needs to know how to open (or listen for), read from, write to, and close a connection. To the application, it seems as if there are incoming and outgoing streams of data; the process is nearly as simple as working with a file.</span></p><p class="calibre_27"><span class="calibre_13"> However, there’s a lot of work going on behind the scenes. For one, the TCP implementation needs to know how to break an outgoing data stream from a process into packets. The harder part, though, is knowing how to convert a series of incoming packets into an input data stream for processes to read, especially when incoming packets don’t necessarily arrive in the correct order. In addition, a host using TCP must check for errors: packets can get lost or mangled when sent across the internet, and a TCP implementation must detect and correct these situations. </span><a></a><a href="#calibre_link-530"><span class="italic"><span class="calibre_4">Figure 9-4</span></span></a><span class="calibre_13"> shows a simplification of how a host might use TCP to send a message.</span></p><p class="calibre_27"><span class="calibre_13"> Luckily, you need to know next to nothing about this mess other than that the Linux TCP implementation is primarily in the kernel and that utilities that work with the transport layer tend to manipulate kernel data structures. One example is the iptables packet-filtering system discussed in </span>Section 9.25<span class="calibre_13">.</span></p><p id="calibre_link-279" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.17.2 UDP</span></span></span></p><p class="calibre_45"><span class="calibre_13">UDP is a far simpler transport layer than TCP. It defines a transport only for single messages; there is no data stream. At the same time, unlike TCP, UDP won’t correct for lost or out-of-order packets. In fact, although UDP has ports, it doesn’t even have connections! One host simply sends a message from one of its ports to a port on a server, and the server sends something back if it wants to. However, UDP </span><span class="italic">does</span><span class="calibre_13"> have error detection for data inside a packet; a host can detect if a packet gets mangled, but it doesn’t have to do anything about it.</span></p><p class="calibre_27"><span class="calibre_13">Where TCP is like having a telephone conversation, UDP is like sending a letter, telegram, or instant message (except that instant messages are more reliable). Applications that use UDP are often concerned with speed&mdash;sending a message as quickly as possible. They don’t want the overhead of TCP because they assume the network between two hosts is generally reliable. They don’t need TCP’s error correction because they either have their own error detection systems or simply don’t care about errors.</span></p><p id="calibre_link-843" class="calibre_63">
</p><p class="calibre_34"><img src="images/000042.jpg" class="calibre_95" />
</p><p id="calibre_link-530" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-4</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Sending a message with TCP</span></span></span></p><p class="calibre_37"><span class="calibre_13"> One example of an application that uses UDP is the </span><span class="italic">Network Time Protocol (NTP)</span><span class="calibre_13">. A client sends a short and simple request to a server to get the current time, and the response from the server is equally brief. Because the client wants the response as quickly as possible, UDP suits the application; if the response from the server gets lost somewhere in the network, the client can just resend a request or give up. Another example is video chat. In this case, pictures are sent with UDP, and if some pieces get lost along the way, the client on the receiving end compensates the best it can.</span></p><blockquote id="calibre_link-700" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The rest of this chapter deals with more advanced networking topics, such as network filtering and routers, as they relate to the lower network layers that we’ve already seen: physical, network, and transport. If you like, feel free to skip ahead to the next chapter to see the application layer where everything comes together in user space. You’ll see processes that actually use the network rather than just throwing around a bunch of addresses and packets.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-280" class="calibre_42"><span class="calibre1"><span class="bold"> 9.18 Revisiting a Simple Local Network</span></span></p><p class="calibre_24"><span class="calibre_13">Now we’ll look at additional components of the simple network introduced in </span>Section 9.4<span class="calibre_13">. This network consists of one LAN as a subnet and a router that connects the subnet to the rest of the internet. You’ll learn the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">How a host on the subnet automatically gets its network configuration</li><li value="2" class="calibre_8">How to set up routing</li><li value="3" class="calibre_8">What a router really is</li><li value="4" class="calibre_8">How to know which IP addresses to use for the subnet</li><li value="5" class="calibre_8">How to set up firewalls to filter out unwanted traffic from the internet</li></ul><p class="calibre_33"><span class="calibre_13">For the most part, we’ll concentrate on IPv4 (if for no other reason than that the addresses are easier to read), but when IPv6 differs, you’ll see how.</span></p><p class="calibre_27"><span class="calibre_13">Let’s start by looking at how a host on the subnet automatically gets its network configuration.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-281" class="calibre_23"><span class="calibre1"><span class="bold"> 9.19 Understanding DHCP</span></span></p><p class="calibre_24"><span class="calibre_13">Under IPv4, when you set a network host to get its configuration automatically from the network, you’re telling it to use the Dynamic Host Configuration Protocol (DHCP) to get an IP address, subnet mask, default gateway, and DNS servers. Aside from not having to enter these parameters by hand, network administrators gain other advantages with DHCP, such as preventing IP address clashes and minimizing the impact of network changes. It’s very rare to see a network that doesn’t use DHCP.</span></p><p class="calibre_27"><span class="calibre_13"> For a host to get its configuration with DHCP, it must be able to send messages to a DHCP server on its connected network. Therefore, each physical network should have its own DHCP server, and on a simple network (such as the one in </span>Section 9.1<span class="calibre_13">), the router usually acts as the DHCP server.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> When making an initial DHCP request, a host doesn’t even know the address of a DHCP server, so it broadcasts the request to all hosts (usually all hosts on its physical network).</span></span></blockquote><p id="calibre_link-701" class="calibre_37"><span class="calibre_13">When a machine asks a DHCP server to assign it an IP address, it’s really asking for a </span><span class="italic">lease</span><span class="calibre_13"> on an address for a certain amount of time. When the lease is up, a client can ask to renew the lease.</span></p><p id="calibre_link-282" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.19.1 Linux DHCP Clients</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although there are many different kinds of network manager systems, there are only two DHCP clients that do the actual work of obtaining leases. The traditional standard client is the Internet Software Consortium (ISC) </span><span class="calibre3">dhclient</span><span class="calibre_13"> program. However, systemd-networkd now also includes a built-in DHCP client.</span></p><p class="calibre_27"><span class="calibre_13"> Upon startup, </span><span class="calibre3">dhclient</span><span class="calibre_13"> stores its process ID in </span><span class="italic">/var/run/dhclient.pid</span><span class="calibre_13"> and its lease information in </span><span class="italic">/var/lib/dhcp/dhclient.leases</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You can test </span><span class="calibre3">dhclient</span><span class="calibre_13"> by hand on the command line, but before doing so you </span><span class="italic">must</span><span class="calibre_13"> remove any default gateway route (see </span>Section 9.11.2<span class="calibre_13">). To run the test, simply specify the network interface name (here, it’s enp0s31f6):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dhclient enp0s31f6</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Unlike </span><span class="calibre3">dhclient</span><span class="calibre_13">, the systemd-networkd DHCP client can’t be run by hand on the command line. The configuration, described the systemd.network(5) manual page, is in </span><span class="italic">/etc/systemd/network</span><span class="calibre_13">, but like other kinds of network configuration, can be automatically generated by Netplan.</span></p><p id="calibre_link-283" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.19.2 Linux DHCP Servers</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can task a Linux machine with running a DHCP server, which provides a good amount of control over the addresses it gives out. However, unless you’re administering a large network with many subnets, you’re probably better off using specialized router hardware that includes built-in DHCP servers.</span></p><p class="calibre_27"><span class="calibre_13">Probably the most important thing to know about DHCP servers is that you want only one running on the same subnet in order to avoid problems with clashing IP addresses or incorrect configurations.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-284" class="calibre_23"><span class="calibre1"><span class="bold"> 9.20 Automatic IPv6 Network Configuration</span></span></p><p class="calibre_24"><span class="calibre_13">DHCP works acceptably well in practice, but it relies on certain assumptions, including that there will be a DHCP server available, that the server is correctly implemented and stable, and that it can track and maintain leases. Although there’s a version of DHCP for IPv6 called DHCPv6, there’s an alternative that’s far more common.</span></p><p class="calibre_27"><span class="calibre_13"> The IETF took advantage of the large IPv6 address space to devise a new way of network configuration that does not require a central server. This is called </span><span class="italic">stateless configuration</span><span class="calibre_13">, because clients don’t need to store any data such as lease assignments.</span></p><p id="calibre_link-793" class="calibre_27"><span class="calibre_13">Stateless IPv6 network configuration starts with the link-local network. Recall that this network includes the addresses prefixed fe80::/64. Because there are so many available addresses on the link-local network, a host can generate an address that is unlikely to be duplicated anywhere on the network. Furthermore, the network prefix is already fixed, so the host can broadcast to the network, asking if any other host on the network is using the address.</span></p><p class="calibre_27"><span class="calibre_13">Once the host has a link-local address, it can determine a global address. It does so by listening for a router advertisement (RA) message that routers occasionally send on the link-local network. The RA message includes the global network prefix, the router IP address, and possibly DNS information. With that information, the host can attempt to fill in the interface ID part of the global address, similar to what it did with the link-local address.</span></p><p class="calibre_27"><span class="calibre_13">Stateless configuration relies on a global network prefix at most 64 bits long (in other words, its netmask is /64 or lower).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Routers also send RA messages in response to router solicitation messages from hosts. These, as well as a few other messages, are part of the ICMP protocol for IPv6 (ICMPv6).</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-285" class="calibre_42"><span class="calibre1"><span class="bold"> 9.21 Configuring Linux as a Router</span></span></p><p class="calibre_24"><span class="calibre_13">Routers are just computers with more than one physical network interface. You can easily configure a Linux machine to be a router.</span></p><p class="calibre_27"><span class="calibre_13"> Let’s look at an example. Say you have two LAN subnets, 10.23.2.0/24 and 192.168.45.0/24. To connect them, you have a Linux router machine with three network interfaces: two for the LAN subnets and one for an internet uplink, as shown in </span><a></a><a href="#calibre_link-531"><span class="italic"><span class="calibre_4">Figure 9-5</span></span></a><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">As you can see, this doesn’t look very different from the simple network example used in the rest of this chapter. The router’s IP addresses for the LAN subnets are 10.23.2.1 and 192.168.45.1. When those addresses are configured, the routing table looks something like this (the interface names might vary in practice; ignore the internet uplink for now):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ip route show</span></span><span class="calibre3"><br class="calibre7" />10.23.2.0/24 dev enp0s31f6 proto kernel scope link src 10.23.2.1 metric 100<br class="calibre7" />192.168.45.0/24 dev enp0s1 proto kernel scope link src 192.168.45.1 metric 100</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Now let’s say that the hosts on each subnet have the router as their default gateway (10.23.2.1 for 10.23.2.0/24 and 192.168.45.1 for 192.168.45.0/24). If 10.23.2.4 wants to send a packet to anything outside of 10.23.2.0/24, it passes the packet to 10.23.2.1. For example, to send a packet from 10.23.2.4 (Host A) to 192.168.45.61 (Host E), the packet goes to 10.23.2.1 (the router) via its enp0s31f6 interface, then back out through the router’s enp0s1 interface.</span></p><p id="calibre_link-804" class="calibre_63">
</p><p class="calibre_34"><img src="images/000003.jpg" class="calibre_96" />
</p><p id="calibre_link-531" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-5</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Two subnets joined with a router</span></span></span></p><p class="calibre_37"><span class="calibre_13"> However, in some basic configurations, the Linux kernel does not automatically move packets from one subnet to another. To enable this basic routing function, you need to enable </span><span class="italic">IP forwarding</span><span class="calibre_13"> in the router’s kernel with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">sysctl -w net.ipv4.ip_forward=1</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">As soon as you enter this command, the machine should start routing packets between subnets, assuming that the hosts on those subnets know to send their packets to the router you just created.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You can check the status of IP forwarding with the </span></span><span class="calibre3">sysctl net.ipv4.ip_forward</span><span class="italic"><span class="calibre_13"> command.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> To make this change permanent upon reboot, you can add it to your </span><span class="italic">/etc/sysctl.conf</span><span class="calibre_13"> file. Depending on your distribution, you may have the option to put it into a file in </span><span class="italic">/etc/sysctl.d</span><span class="calibre_13"> so that distribution updates won’t overwrite your changes.</span></p><p class="calibre_27"><span class="calibre_13"> When the router also has the third network interface with an internet uplink, this same setup allows internet access for all hosts on both subnets because they’re configured to use the router as the default gateway. But that’s where things get more complicated. The problem is that certain IPv4 addresses such as 10.23.2.4 are not actually visible to the whole internet; they’re on so-called private networks. To provide for internet connectivity, you must set up a feature called </span><a id="calibre_link-805"></a><span class="italic">Network Address Translation</span><span class="calibre_13">
</span><span class="italic">(NAT)</span><span class="calibre_13"> on the router. The software on nearly all specialized routers does this, so there’s nothing out of the ordinary here, but let’s examine the problem of private networks in a bit more detail.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-286" class="calibre_23"><span class="calibre1"><span class="bold"> 9.22 Private Networks (IPv4)</span></span></p><p class="calibre_24"><span class="calibre_13">Say you decide to build your own network. You have your machines, router, and network hardware ready. Given what you know about a simple network so far, your next question is, “What IP subnet should I use?”</span></p><p class="calibre_27"><span class="calibre_13">If you want a block of internet addresses that every host on the internet can see, you can buy one from your ISP. However, because the range of IPv4 addresses is very limited, this costs a lot and isn’t useful for much more than running a server that the rest of the internet can see. Most people don’t really need this kind of service because they access the internet as a client.</span></p><p class="calibre_27"><span class="calibre_13"> The conventional, inexpensive alternative is to pick a private subnet from the addresses in the RFC 1918/6761 internet standards documents, shown in </span><a></a><a href="#calibre_link-532"><span class="italic"><span class="calibre_4">Table 9-2</span></span></a><span class="calibre_13">.</span></p><p id="calibre_link-532" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 9-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Private Networks Defined by RFC 1918 and 6761</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Network&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Subnet mask&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">CIDR form&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;10.0.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.0.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;10.0.0.0/8&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;192.168.0.0&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.255.0.0&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;192.168.0.0/16&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;172.16.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;255.240.0.0&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;172.16.0.0/12&nbsp;</span></span><span class="calibre_56">
</span></td></tr></table><p class="calibre_37"><span class="calibre_13"> You can carve up private subnets as you wish. Unless you plan to have more than 254 hosts on a single network, pick a small subnet like 10.23.2.0/24, as we’ve been using throughout this chapter. (Networks with this netmask are sometimes called </span><span class="italic">class C</span><span class="calibre_13"> subnets. Although the term is technically obsolete, it’s still useful.)</span></p><p class="calibre_27"><span class="calibre_13">What’s the catch? Hosts on the real internet know nothing about private subnets and won’t send packets to them, so without some help, hosts on private subnets can’t talk to the outside world. A router connected to the internet (with a true, nonprivate address) needs to have some way to fill in the gap between that connection and the hosts on a private network.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-287" class="calibre_23"><span class="calibre1"><span class="bold"> 9.23 Network Address Translation (IP Masquerading)</span></span></p><p class="calibre_24"><span class="calibre_13">NAT is the most commonly used way to share a single IP address with a private network, and it’s nearly universal in home and small office networks. In Linux, the variant of NAT that most people use is known as </span><span class="italic">IP masquerading</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The basic idea behind NAT is that the router doesn’t just move packets from one subnet to another; it transforms them as it moves them. Hosts on the internet know how to connect to the router, but they know nothing about the private network behind it. The hosts on the private network need no special configuration; the router is their default gateway.</span><a id="calibre_link-850"></a></p><p class="calibre_27"><span class="calibre_13">The system works roughly like this:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">A host on the internal private network wants to make a connection to the outside world, so it sends its connection request packets through the router.</li><li value="2" class="calibre_8">The router intercepts the connection request packet rather than passing it out to the internet (where it would get lost because the public internet knows nothing about private networks).</li><li value="3" class="calibre_8">The router determines the destination of the connection request packet and opens its own connection to the destination.</li><li value="4" class="calibre_8">When the router obtains the connection, it fakes a “connection established” message back to the original internal host.</li><li value="5" class="calibre_8">The router is now the middleman between the internal host and the destination. The destination knows nothing about the internal host; the connection on the remote host looks like it came from the router.</li></ol><p class="calibre_33"><span class="calibre_13">This isn’t quite as simple as it sounds. Normal IP routing knows only source and destination IP addresses in the internet layer. However, if the router dealt only with the internet layer, each host on the internal network could establish only one connection to a single destination at a time (among other limitations), because there is no information in the internet layer part of a packet to distinguish among multiple requests from the same host to the same destination. Therefore, NAT must go beyond the internet layer and dissect packets to pull out more identifying information, particularly the UDP and TCP port numbers from the transport layers. UDP is fairly easy because there are ports but no connections, but the TCP transport layer is complex.</span></p><p class="calibre_27"><span class="calibre_13">In order to set up a Linux machine to perform as a NAT router, you must activate all of the following inside the kernel configuration: network packet filtering (“firewall support”), connection tracking, iptables support, full NAT, and MASQUERADE target support. Most distribution kernels come with this support.</span></p><p class="calibre_27"><span class="calibre_13"> Next you need to run some complex-looking </span><span class="calibre3">iptables</span><span class="calibre_13"> commands to make the router perform NAT for its private subnet. Here’s an example that applies to an internal Ethernet network on enp0s2 sharing an external connection at enp0s31f6 (you’ll learn more about the </span><span class="calibre3">iptables</span><span class="calibre_13"> syntax in </span>Section 9.25<span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">sysctl -w net.ipv4.ip_forward=1</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">iptables -P FORWARD DROP</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">iptables -t nat -A POSTROUTING -o enp0s31f6 -j MASQUERADE</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">iptables -A FORWARD -i enp0s31f6 -o enp0s2 -m state --state ESTABLISHED,RELATED -j ACCEPT</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">iptables -A FORWARD -i enp0s2 -o enp0s31f6 -j ACCEPT</span></span></blockquote></blockquote><p id="calibre_link-601" class="calibre_30"><span class="calibre_13">You likely won’t ever need to manually enter these commands unless you’re developing your own software, especially with so much special-purpose router hardware available. However, a variety of virtualization software can set up NAT for use in networking for virtual machines and containers.</span></p><p class="calibre_27"><span class="calibre_13"> Although NAT works well in practice, remember that it’s essentially a hack that extends the lifetime of the IPv4 address space. IPv6 does not need NAT, thanks to its larger and more sophisticated address space described in </span>Section 9.7<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-288" class="calibre_23"><span class="calibre1"><span class="bold"> 9.24 Routers and Linux</span></span></p><p class="calibre_24"><span class="calibre_13">In the early days of broadband, users with less demanding needs simply connected their machine directly to the internet. But it didn’t take long for many users to want to share a single broadband connection with their own networks, and Linux users in particular would often set up an extra machine to use as a router running NAT.</span></p><p class="calibre_27"><span class="calibre_13">Manufacturers responded to this new market by offering specialized router hardware consisting of an efficient processor, some flash memory, and several network ports&mdash;with enough power to manage a typical simple network, run important software such as a DHCP server, and use NAT. When it came to software, many manufacturers turned to Linux to power their routers. They added the necessary kernel features, stripped down the user-space software, and created GUI-based administration interfaces.</span></p><p class="calibre_27"><span class="calibre_13">Almost as soon as the first of these routers appeared, many people became interested in digging deeper into the hardware. One manufacturer, Linksys, was required to release the source code for its software under the terms of the license of one of its components, and soon specialized Linux distributions such as OpenWRT appeared for routers. (The “WRT” in these names came from the Linksys model number.)</span></p><p class="calibre_27"><span class="calibre_13">Aside from the hobbyist aspect, there are good reasons to install these distributions on routers. They’re often more stable than the manufacturer firmware, especially on older router hardware, and they typically offer additional features. For example, to bridge a network with a wireless connection, many manufacturers require you to buy matching hardware, but with OpenWRT installed, the manufacturer and age of the hardware don’t really matter. This is because you’re using a truly open operating system on the router that doesn’t care what hardware you use as long as your hardware is supported.</span></p><p class="calibre_27"><span class="calibre_13"> You can use much of the knowledge in this book to examine the internals of custom Linux firmware, though you’ll encounter differences, especially when logging in. As with many embedded systems, open firmware tends to use BusyBox to provide many shell features. BusyBox is a single executable program that offers limited functionality for many Unix commands such as the shell, </span><span class="calibre3">ls</span><span class="calibre_13">, </span><span class="calibre3">grep</span><span class="calibre_13">, </span><span class="calibre3">cat</span><span class="calibre_13">, and </span><span class="calibre3">more</span><span class="calibre_13">. (This saves a significant amount of memory.) In addition, the boot-time init tends to be very simple on embedded systems. However, you typically won’t find these limitations to be a problem, because custom Linux firmware often includes a web administration interface similar to what you’d see from a manufacturer.</span><a id="calibre_link-596"></a></p><div class="mbp_pagebreak"></div><p id="calibre_link-289" class="calibre_23"><span class="calibre1"><span class="bold"> 9.25 Firewalls</span></span></p><p class="calibre_24"><span class="calibre_13">Routers should always include some kind of firewall to keep undesirable traffic out of your network. A </span><span class="italic">firewall</span><span class="calibre_13"> is a software and/or hardware configuration that usually sits on a router between the internet and a smaller network, attempting to ensure that nothing “bad” from the internet harms the smaller network. You can also set up firewall features on any host to screen all incoming and outgoing data at the packet level (as opposed to at the application layer, where server programs usually try to perform some access control of their own). Firewalling on individual machines is sometimes called </span><span class="italic">IP filtering</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">A system can filter packets when it receives a packet, sends a packet, or forwards (routes) a packet to another host or gateway.</span></p><p class="calibre_27"><span class="calibre_13">With no firewalling in place, a system just processes packets and sends them on their way. Firewalls put checkpoints for packets at the points of data transfer just identified. The checkpoints drop, reject, or accept packets, usually based on some of these criteria:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">The source or destination IP address or subnet</li><li value="2" class="calibre_8">The source or destination port (in the transport layer information)</li><li value="3" class="calibre_8">The firewall’s network interface</li></ul><p class="calibre_33"><span class="calibre_13">Firewalls provide an opportunity to work with the subsystem of the Linux kernel that processes IP packets. Let’s look at that now.</span></p><p id="calibre_link-290" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.25.1 Linux Firewall Basics</span></span></span></p><p class="calibre_45"><span class="calibre_13">In Linux, you create firewall rules in a series known as a </span><span class="italic">chain</span><span class="calibre_13">. A set of chains makes up a </span><span class="italic">table</span><span class="calibre_13">. As a packet moves through the various parts of the Linux networking subsystem, the kernel applies the rules in certain chains to the packets. For example, a new packet arriving from the physical layer is classified by the kernel as “input,” so it activates rules in chains corresponding to input.</span></p><p class="calibre_27"><span class="calibre_13"> All of these data structures are maintained by the kernel. The whole system is called </span><span class="italic">iptables</span><span class="calibre_13">, with an </span><span class="calibre3">iptables</span><span class="calibre_13"> user-space command to create and manipulate the rules.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There’s a newer system called </span></span>nftables<span class="italic"><span class="calibre_13"> that is meant to replace iptables, but as of this writing, iptables is still the most widely used system. The command to administer nftables is </span></span><span class="calibre3">nft</span><span class="italic"><span class="calibre_13">, and there’s an iptables-to-nftables translator called </span></span><span class="calibre3">iptables-translate</span><span class="italic"><span class="calibre_13"> for the iptables commands shown in this book. To make things even more complicated, a system called </span></span>bpfilter<span class="italic"><span class="calibre_13"> has been recently introduced with a different approach. Try not to get bogged down with the specifics of commands&mdash;it’s the effects that matter.</span></span></blockquote><p id="calibre_link-803" class="calibre_37"><span class="calibre_13">Because there can be many tables&mdash;each with its own sets of chains, which in turn can contain many rules&mdash;packet flow can become quite complicated. However, you’ll normally work primarily with a single table named </span><span class="italic">filter</span><span class="calibre_13"> that controls basic packet flow. There are three basic chains in the filter table: INPUT for incoming packets, OUTPUT for outgoing packets, and FORWARD for routed packets.</span></p><p class="calibre_27"><span class="calibre_13"> Figures 9-6 and 9-7 show simplified flowcharts for where rules are applied to packets in the filter table. There are two figures because packets can either come into the system from a network interface (</span><a></a><a href="#calibre_link-533"><span class="italic"><span class="calibre_4">Figure 9-6</span></span></a><span class="calibre_13">) or be generated by a local process (</span><a></a><a href="#calibre_link-534"><span class="italic"><span class="calibre_4">Figure 9-7</span></span></a><span class="calibre_13">).</span></p><p class="calibre_34"><img src="images/000039.jpg" class="calibre_97" />
</p><p id="calibre_link-533" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-6</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Chain-processing sequence for incoming packets from a network</span></span></span></p><p class="calibre_46"><img src="images/000011.jpg" class="calibre_98" />
</p><p id="calibre_link-534" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 9-7</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Chain-processing sequence for incoming packets from a local process</span></span></span></p><p class="calibre_37"><span class="calibre_13">As you can see, an incoming packet from the network can be consumed by a user process and may not reach the FORWARD chain or the OUTPUT chain. Packets generated by user processes won’t reach the INPUT or FORWARD chains.</span></p><p class="calibre_27"><span class="calibre_13">This gets more complicated because there are many steps along the way other than just these three chains. For example, packets are subject to PREROUTING and POSTROUTING chains, and chain processing can also occur at any of the three lower network levels. For a big diagram of everything that’s going on, search the internet for “Linux netfilter packet flow,” but remember that these diagrams try to include every possible scenario for packet input and flow. It often helps to break the diagrams down by packet source, as in Figures 9-6 and 9-7.</span></p><p id="calibre_link-291" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.25.2 Setting Firewall Rules</span></span></span></p><p class="calibre_45"><span class="calibre_13">Let’s look at how the iptables system works in practice. Start by viewing the current configuration with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -L</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output is usually an empty set of chains, as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Chain INPUT (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination<br class="calibre7" />Chain FORWARD (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination<br class="calibre7" />Chain OUTPUT (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Each firewall chain has a default </span><span class="italic">policy</span><span class="calibre_13"> that specifies what to do with a packet if no rule matches the packet. The policy for all three chains in this example is ACCEPT, meaning that the kernel allows the packet to pass through the packet-filtering system. The DROP policy tells the kernel to discard the packet. To set the policy on a chain, use </span><span class="calibre3">iptables -P</span><span class="calibre_13"> like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -P FORWARD DROP</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t do anything rash with the policies on your machine until you’ve read through the rest of this section.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Say that someone at 192.168.34.63 is annoying you. To prevent them from talking to your machine, run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -s 192.168.34.63 -j DROP</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">-A INPUT</span><span class="calibre_13"> parameter appends a rule to the INPUT chain. The </span><span class="calibre3">-s 192.168.34.63</span><span class="calibre_13"> part specifies the source IP address in the rule, and </span><span class="calibre3">-j DROP</span><span class="calibre_13"> tells the kernel to discard any packet matching the rule. Therefore, your machine will throw out any packet coming from 192.168.34.63.</span></p><p class="calibre_27"><span class="calibre_13"> To see the rule in place, run </span><span class="calibre3"><span class="bold">iptables -L</span></span><span class="calibre_13"> again:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Chain INPUT (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination<br class="calibre7" />DROP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all&nbsp; --&nbsp; 192.168.34.63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Unfortunately, your friend at 192.168.34.63 has told everyone on his subnet to open connections to your SMTP port (TCP port 25). To get rid of that traffic as well, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -s 192.168.34.0/24 -p tcp --destination-port 25 -j DROP</span></span></blockquote></blockquote><p id="calibre_link-776" class="calibre_30"><span class="calibre_13">This example adds a netmask qualifier to the source address as well as </span><span class="calibre3">-p tcp</span><span class="calibre_13"> to specify TCP packets only. A further restriction, </span><span class="calibre3">--destination-port 25</span><span class="calibre_13">, says that the rule should apply only to traffic to port 25. The IP table list for INPUT now looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Chain INPUT (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination<br class="calibre7" />DROP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all&nbsp; --&nbsp; 192.168.34.63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere<br class="calibre7" />DROP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; 192.168.34.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:smtp</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">All is well until you hear from someone you know at 192.168.34.37 saying that she can’t send you email because you blocked her machine. Thinking this is a quick fix, you run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -s 192.168.34.37 -j ACCEPT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">However, it doesn’t work. To see why, look at the new chain:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Chain INPUT (policy ACCEPT)<br class="calibre7" />target&nbsp;&nbsp;&nbsp;&nbsp; prot opt source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; destination<br class="calibre7" />DROP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; all&nbsp; --&nbsp; 192.168.34.63&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere<br class="calibre7" />DROP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp&nbsp; --&nbsp; 192.168.34.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tcp dpt:smtp<br class="calibre7" />ACCEPT&nbsp;&nbsp;&nbsp;&nbsp; all&nbsp; --&nbsp; 192.168.34.37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anywhere</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The kernel reads the chain from top to bottom, using the first rule that matches.</span></p><p class="calibre_27"><span class="calibre_13"> The first rule does not match 192.168.34.37, but the second does, because it applies to all hosts from 192.168.34.1 to 192.168.34.254 and this second rule says to drop packets. When a rule matches, the kernel carries out the action and looks no further down in the chain. (You might notice that 192.168.34.37 can send packets to any port on your machine </span><span class="italic">except</span><span class="calibre_13"> port 25 because the second rule applies </span><span class="italic">only</span><span class="calibre_13"> to port 25.)</span></p><p class="calibre_27"><span class="calibre_13">The solution is to move the third rule to the top. First, delete the third rule with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -D INPUT 3</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Then </span><span class="italic">insert</span><span class="calibre_13"> that rule at the top of the chain with </span><span class="calibre3">iptables -I</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -I INPUT -s 192.168.34.37 -j ACCEPT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To insert a rule elsewhere in a chain, put the rule number after the chain name (for example, </span><span class="calibre3">iptables -I INPUT 4 ...</span><span class="calibre_13">).</span></p><p id="calibre_link-292" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.25.3 Firewall Strategies</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although the preceding tutorial showed you how to insert rules and how the kernel processes IP chains, you haven’t seen firewall strategies that actually work. Let’s talk about that now.</span></p><p class="calibre_27"><span class="calibre_13">There are two basic kinds of firewall scenarios: one for protecting individual machines (where you set rules in each machine’s INPUT chain) and one for protecting a network of machines (where you set rules in the router’s FORWARD chain). In both cases, you can’t have serious security if you use a default policy of ACCEPT and continuously insert rules to drop packets from sources that start to send bad stuff. You must allow only the packets that you trust, and deny everything else.</span></p><p class="calibre_27"><span class="calibre_13">For example, say your machine has an SSH server on TCP port 22. There’s no reason for any random host to initiate a connection to any other port on your machine, and you shouldn’t give any such host a chance. To set that up, first set the INPUT chain policy to DROP:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -P INPUT DROP</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To enable ICMP traffic (for </span><span class="calibre3">ping</span><span class="calibre_13"> and other utilities), use this line:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -p icmp -j ACCEPT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Make sure that you can receive packets you send to both your own network IP address and 127.0.0.1 (localhost). Assuming your host’s IP address is </span><span class="calibre3"><span class="italic">my_addr</span></span><span class="calibre_13">, do this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -s 127.0.0.1 -j ACCEPT</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">iptables -A INPUT -s </span></span><span class="calibre3"><span class="italic">my_addr</span></span><span class="calibre3"><span class="bold"> -j ACCEPT</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t run these commands one by one on a machine to which you only have remote access. The very first </span></span><span class="calibre3">DROP</span><span class="italic"><span class="calibre_13"> command will instantly block your access, and you won’t be able to regain access until you intervene (for example, by rebooting the machine).</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> If you control your entire subnet (and trust everything on it), you can replace </span><span class="calibre3"><span class="italic">my_addr</span></span><span class="calibre_13"> with your subnet address and subnet mask&mdash;for example, </span><span class="calibre3">10.23.2.0/24</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Now, although you still want to deny incoming TCP connections, you still need to make sure that your host can make TCP connections to the outside world. Because all TCP connections start with a SYN (connection request) packet, if you let all TCP packets through that aren’t SYN packets, you’re still okay:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -p tcp '!' --syn -j ACCEPT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">!</span><span class="calibre_13"> symbol indicates a negation, so </span><span class="calibre3">! --syn</span><span class="calibre_13"> matches any non-SYN packet.</span></p><p class="calibre_27"><span class="calibre_13"> Next, if you’re using remote UDP-based DNS, you must accept traffic from your name server so that your machine can look up names with DNS. Do this for </span><span class="italic">all</span><span class="calibre_13"> DNS servers in </span><span class="italic">/etc/resolv.conf</span><span class="calibre_13">. Use this command (where the name server’s address is </span><span class="calibre3"><span class="italic">ns_addr</span></span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -p udp --source-port 53 -s </span></span><span class="calibre3"><span class="italic">ns_addr</span></span><span class="calibre3"><span class="bold"> -j ACCEPT</span></span></blockquote></blockquote><p id="calibre_link-567" class="calibre_30"><span class="calibre_13">And finally, allow SSH connections from anywhere:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iptables -A INPUT -p tcp --destination-port 22 -j ACCEPT</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The preceding iptables settings work for many situations, including any direct connection (especially broadband) where an intruder is much more likely to port-scan your machine. You could also adapt these settings for a firewalling router by using the FORWARD chain instead of INPUT and using source and destination subnets where appropriate. For more advanced configurations, you may find a configuration tool such as Shorewall to be helpful.</span></p><p class="calibre_27"><span class="calibre_13">This discussion has only touched on security policy. Remember that the key idea is to permit only the things that you find acceptable, not to try to find and exclude the bad stuff. Furthermore, IP firewalling is only one piece of the security picture. (You’ll see more in the next chapter.)</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-293" class="calibre_23"><span class="calibre1"><span class="bold"> 9.26 Ethernet, IP, ARP, and NDP</span></span></p><p class="calibre_24"><span class="calibre_13">There is one basic detail in the implementation of IP over Ethernet that we have yet to cover. Recall that a host must place an IP packet inside an Ethernet frame in order to transmit the packet across the physical layer to another host. Recall, too, that frames themselves do not include IP address information; they use MAC (hardware) addresses. The question is this: When constructing the Ethernet frame for an IP packet, how does the host know which MAC address corresponds to the destination IP address?</span></p><p class="calibre_27"><span class="calibre_13"> We don’t normally think about this question much because networking software includes an automatic system of looking up MAC addresses. In IPv4, this is called </span><span class="italic">Address Resolution Protocol (ARP)</span><span class="calibre_13">. A host using Ethernet as its physical layer and IP as the network layer maintains a small table called an </span><span class="italic">ARP cache</span><span class="calibre_13"> that maps IP addresses to MAC addresses. In Linux, the ARP cache is in the kernel. To view your machine’s ARP cache, use the </span><span class="calibre3">ip neigh</span><span class="calibre_13"> command. (The “neigh” part will make sense when you see the IPv6 equivalent. The old command for working with the ARP cache is </span><span class="calibre3">arp</span><span class="calibre_13">.)</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ip -4 neigh</span></span><span class="calibre3"><br class="calibre7" />10.1.2.57 dev enp0s31f6 lladdr 1c:f2:9a:1e:88:fb REACHABLE<br class="calibre7" />10.1.2.141 dev enp0s31f6 lladdr 00:11:32:0d:ca:82 STALE<br class="calibre7" />10.1.2.1 dev enp0s31f6 lladdr 24:05:88:00:ca:a5 REACHABLE</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> We’re using the </span><span class="calibre3">-4</span><span class="calibre_13"> option to restrict the output to IPv4. You can see the IP and hardware addresses for the hosts that the kernel knows about. The last field indicates the status of the entry in the cache. REACHABLE means that some communication with the host occurred recently, and STALE means that it’s been a while, and the entry should be refreshed.</span></p><p id="calibre_link-568" class="calibre_27"><span class="calibre_13">When a machine boots, its ARP cache is empty. So how do these MAC addresses get in the cache? It all starts when the machine wants to send a packet to another host. If a target IP address is not in an ARP cache, the following steps occur:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The origin host creates a special Ethernet frame containing an ARP request packet for the MAC address that corresponds to the target IP address.</li><li value="2" class="calibre_8">The origin host broadcasts this frame to the entire physical network for the target’s subnet.</li><li value="3" class="calibre_8">If one of the other hosts on the subnet knows the correct MAC address, it creates a reply packet and frame containing the address and sends it back to the origin. Often, the host that replies <span class="italic">is</span> the target host and is simply replying with its own MAC address.</li><li value="4" class="calibre_8">The origin host adds the IP-MAC address pair to the ARP cache and can proceed.</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Remember that ARP applies only to machines on local subnets. To reach destinations outside your subnet, your host sends the packet to the router, and it’s someone else’s problem after that. Of course, your host still needs to know the MAC address for the router, and it can use ARP to find it.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">The only real problem you can have with ARP is that your system’s cache can get out of date if you’re moving an IP address from one network interface card to another because the cards have different MAC addresses (for example, when testing a machine). Unix systems invalidate ARP cache entries if there’s no activity after a while, so there shouldn’t be any trouble other than a small delay for invalidated data, but you can delete an ARP cache entry immediately with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># ip neigh del </span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold"> dev </span></span><span class="calibre3"><span class="italic"><span class="bold">interface</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The ip-neighbour(8) manual page explains how to manually set ARP cache entries, but you shouldn’t need to do this. Note the spelling.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t confuse ARP with </span></span>Reverse Address Resolution Protocol (RARP)<span class="italic"><span class="calibre_13">. RARP transforms a MAC address back to a hostname or IP address. Before DHCP became popular, some diskless workstations and other devices used RARP to get their configuration, but RARP is rare today.</span></span></blockquote><div class="mbp_pagebreak"></div><blockquote id="calibre_link-750" class="calibre_68"><span class="bold">IPV6: NDP</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">You might be wondering why the commands manipulating the ARP cache don’t contain “arp” (or, if you’ve vaguely seen this stuff before, you might wonder why we aren’t using </span></span><span class="calibre3">arp</span><span class="calibre3"><span class="calibre_13">). In IPv6, there’s a new mechanism called </span></span><span class="calibre3"><span class="italic">Neighbor Discovery Protocol (NDP)</span></span><span class="calibre3"><span class="calibre_13"> used on the link-local network. The </span></span><span class="calibre3">ip</span><span class="calibre3"><span class="calibre_13"> command unifies ARP from IPv4 and NDP from IPv6. NDP includes these two kinds of messages:</span></span></blockquote><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_7"><span class="calibre3"><span class="bold">Neighbor solicitation</span></span><span class="calibre3"> Used to obtain information about a link-local host, including the hardware address of the host.</span></li><li value="2" class="calibre_7"><span class="calibre3"><span class="bold">Neighbor advertisement</span></span><span class="calibre3"> Used to respond to a neighbor solicitation message.</span></li></ol><blockquote class="calibre_99"><span class="calibre3"><span class="calibre_13"> There are several other components of NDP, including the RA messages that you saw in </span></span><span class="calibre3">Section 9.20</span><span class="calibre3"><span class="calibre_13">.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-294" class="calibre_42"><span class="calibre1"><span class="bold"> 9.27 Wireless Ethernet</span></span></p><p class="calibre_24"><span class="calibre_13">In principle, wireless Ethernet (“Wi-Fi”) networks aren’t much different from wired networks. Much like any wired hardware, they have MAC addresses and use Ethernet frames to transmit and receive data, and as a result the Linux kernel can talk to a wireless network interface much as it would a wired network interface. Everything at the network layer and above is the same; the main differences are additional components in the physical layer, such as frequencies, network IDs, and security features.</span></p><p class="calibre_27"><span class="calibre_13">Unlike wired network hardware, which is very good at automatically adjusting to nuances in the physical setup without much fuss, wireless network configuration is much more open-ended. To get a wireless interface working properly, Linux needs additional configuration tools.</span></p><p class="calibre_27"><span class="calibre_13">Let’s take a quick look at the additional components of wireless networks.</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Transmission details</span> These are physical characteristics, such as the radio frequency.</li><li value="2" class="calibre_8"><span class="bold">Network identification</span> Because more than one wireless network can share the same basic medium, you have to be able to distinguish between them. The Service Set Identifier (SSID, also known as the “network name”) is the wireless network identifier.</li><li value="3" class="calibre_8"><span class="bold">Management</span> Although it’s possible to configure wireless networking to have hosts talk directly to each other, most wireless networks are managed by one or more <span class="italic">access points</span> that all traffic goes through. Access points often bridge a wireless network with a wired network, making both appear as one single network.</li><li value="4" class="calibre_8"><span class="bold">Authentication</span> You may want to restrict access to a wireless network. To do so, you can configure access points to require a password or other authentication key before they’ll even talk to a client.</li><a id="calibre_link-806"></a><li value="5" class="calibre_8"><span class="bold">Encryption</span> In addition to restricting the initial access to a wireless network, you normally want to encrypt all traffic that goes out across radio waves.</li></ol><p class="calibre_33"><span class="calibre_13">The Linux configuration and utilities that handle these components are spread out over a number of areas. Some are in the kernel; Linux features a set of wireless extensions that standardize user-space access to hardware. As far as user space goes, wireless configuration can get complicated, so most people prefer to use GUI frontends, such as the desktop applet for NetworkManager, to get things working. Still, it’s worth looking at a few of the things happening behind the scenes.</span></p><p id="calibre_link-295" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.27.1 iw</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can view and change kernel space device and network configuration with a utility called </span><span class="calibre3">iw</span><span class="calibre_13">. To use </span><span class="calibre3">iw</span><span class="calibre_13">, you normally need to know the network interface name for the device, such as </span><span class="italic">wlp1s0</span><span class="calibre_13"> (predictable device name) or </span><span class="italic">wlan0</span><span class="calibre_13"> (traditional name). Here’s an example that dumps a scan of available wireless networks. (Expect a lot of output if you’re in an urban area.)</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iw dev wlp1s0 scan</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The network interface must be up for this command to work (if it’s not, run </span></span><span class="calibre3">ifconfig wlp1s0 up</span><span class="italic"><span class="calibre_13">), but because this is still in the physical layer, you don’t need to configure any network layer parameters, such as an IP address.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">If the network interface has joined a wireless network, you can view the network details like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iw dev wlp1s0 link</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The MAC address in the output of this command is from the access point that you’re currently talking to.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The </span></span><span class="calibre3">iw</span><span class="italic"><span class="calibre_13"> command distinguishes between physical device names (such as phy0) and network interface names (such as wlp1s0) and allows you to change various settings for each. You can even create more than one network interface for a single physical device. However, in nearly all basic cases, you’ll just use the network interface name.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Use </span><span class="calibre3">iw</span><span class="calibre_13"> to connect a network interface to an unsecured wireless network as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">iw wlp1s0 connect </span></span><span class="calibre3"><span class="italic"><span class="bold">network_name</span></span></span></blockquote></blockquote><p id="calibre_link-751" class="calibre_30"><span class="calibre_13">Connecting to secured networks is a different story. For the rather insecure Wired Equivalent Privacy (WEP) system, you can use the </span><span class="calibre3">keys</span><span class="calibre_13"> parameter with the </span><span class="calibre3">iw connect</span><span class="calibre_13"> command. However, you shouldn’t use WEP because it’s not secure, and you won’t find many networks that support it.</span></p><p id="calibre_link-296" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">9.27.2 Wireless Security</span></span></span></p><p class="calibre_45"><span class="calibre_13">For most wireless security setups, Linux relies on the wpa_supplicant daemon to manage both authentication and encryption for a wireless network interface. This daemon can handle the WPA2 and WPA3 (WiFi Protected Access; don’t use the older, insecure WPA) schemes of authentication, as well as nearly any kind of encryption technique used on wireless networks. When the daemon first starts, it reads a configuration file (by default, </span><span class="italic">/etc/wpa_supplicant.conf</span><span class="calibre_13">) and attempts to identify itself to an access point and establish communication based on a given network name. The system is well documented; in particular, the wpa_supplicant(8) manual page is very detailed.</span></p><p class="calibre_27"><span class="calibre_13"> Running the daemon by hand every time you want to establish a connection is a lot of work. In fact, just creating the configuration file is tedious due to the number of possible options. To make matters worse, all of the work of running </span><span class="calibre3">iw</span><span class="calibre_13"> and wpa_supplicant simply allows your system to join a wireless physical network; it doesn’t even set up the network layer. And that’s where automatic network configuration managers such as NetworkManager take a lot of pain out of the process. Although they don’t do any of the work on their own, they know the correct sequence and required configuration for each step toward getting a wireless network operational.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-297" class="calibre_23"><span class="calibre1"><span class="bold"> 9.28 Summary</span></span></p><p class="calibre_24"><span class="calibre_13">As you’ve seen, understanding the positions and roles of the various network layers is critical to understanding how Linux networking operates and how to perform network configuration. Although we’ve covered only the basics, more advanced topics in the physical, network, and transport layers are similar to what you’ve seen here. Layers themselves are often subdivided, as you just saw with the various pieces of the physical layer in a wireless network.</span></p><p class="calibre_27"><span class="calibre_13">A substantial amount of action that you’ve seen in this chapter happens in the kernel, with some basic user-space control utilities to manipulate the kernel’s internal data structures (such as routing tables). This is the traditional way of working with the network. However, as with many of the topics discussed in this book, some tasks aren’t suitable for the kernel due to their complexity and need for flexibility, and that’s where user-space utilities take over. In particular, NetworkManager monitors and queries the kernel and then manipulates the kernel configuration. Another example is support for dynamic routing protocols such as Border Gateway Protocol (BGP), which is used in large internet routers.</span></p><p class="calibre_27"><span class="calibre_13"> But you’re probably a little bit bored with network configuration by now. Let’s turn to </span><span class="italic">using</span><span class="calibre_13"> the network&mdash;the application layer.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-298" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-841" class="calibre_10"><span class="calibre4"><span class="bold">10</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">NETWORK APPLICATIONS AND SERVICES</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter explores basic network applications&mdash;the clients and servers running in user space that reside at the application layer. Because this layer is at the top of the stack, close to end users, you may find this material more accessible than the material in </span></span><span class="calibre1">Chapter 9</span><span class="calibre1"><span class="calibre_13">. Indeed, you interact with network client applications such as web browsers every day.</span></span></p><p class="calibre_33"><span class="calibre_13">To do their work, network clients connect to corresponding network servers. Unix network servers come in many forms. A server program can listen to a port on its own or through a secondary server. We’ll look at some common servers as well as tools that will help you understand and debug server operation.</span></p><p class="calibre_27"><span class="calibre_13">Network clients use the operating system’s transport layer protocols and interfaces, so it’s important to understand the basics of the TCP and UDP transport layers. Let’s start looking at network applications by experimenting with a network client that uses TCP.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-299" class="calibre_23"><span class="calibre1"><span class="bold">10.1 The Basics of Services</span></span></p><p class="calibre_24"><span class="calibre_13">TCP services are among the easiest to understand because they are built upon simple, uninterrupted two-way data streams. Perhaps the best way to see how they work is to talk directly to an unencrypted web server on TCP port 80 to get an idea of how data moves across the connection. For example, run the following command to connect to the IANA documentation example web server:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">telnet example.org 80</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You should get a response like this, indicating a successful connection to the server:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Trying </span><span class="calibre3"><span class="italic">some address</span></span><span class="calibre3">...<br class="calibre7" />Connected to example.org.<br class="calibre7" />Escape character is '^]'.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Now enter these two lines:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold">GET / HTTP/1.1Host: example.org</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> HTTP 1.1, like its predecessor HTTP 1.0, shows its age; there are newer protocols in use such as HTTP/2, QUIC, and the emerging HTTP/3.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Press </span>ENTER<span class="calibre_13"> twice after the last line. The server should send a bunch of HTML text as a response. To terminate the connection, press </span>CTRL<span class="calibre_13">-D.</span></p><p class="calibre_27"><span class="calibre_13">This exercise demonstrates that:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">The remote host has a web server process listening on TCP port 80.</li><li value="2" class="calibre_8"><span class="calibre3">telnet</span> was the client that initiated the connection.</li></ul><p class="calibre_33"><span class="calibre_13"> The reason you have to terminate the connection with </span>CTRL<span class="calibre_13">-D is that, because most web pages need several requests to load, it makes sense to keep the connection open. If you explore web servers at the protocol level, you may find that this behavior varies. For example, many servers disconnect quickly if they do not receive a request soon after a connection opens.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="calibre3">telnet</span><span class="italic"><span class="calibre_13"> was originally meant to enable logins to remote hosts. The client program may not be installed on your distribution by default, but is easily installed as an extra package. Although the </span></span><span class="calibre3">telnet</span><span class="italic"><span class="calibre_13"> remote login server is completely insecure (as you will learn later), the </span></span><span class="calibre3">telnet</span><span class="italic"><span class="calibre_13"> client can be useful for debugging remote services. </span></span><span class="calibre3">telnet</span><span class="italic"><span class="calibre_13"> does not work with UDP or any transport layer other than TCP. If you’re looking for a general-purpose network client, consider </span></span><span class="calibre3">netcat</span><span class="italic"><span class="calibre_13">, described in </span></span><span class="italic">Section 10.5.3</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-300" class="calibre_42"><span class="calibre1"><span class="bold">10.2 A Closer Look</span></span></p><p class="calibre_24"><span class="calibre_13">In the previous example, you manually interacted with a web server on the network with </span><span class="calibre3">telnet</span><span class="calibre_13">, using the HTTP application layer protocol. Although you’d normally use a web browser to make this sort of connection, let’s take just one step up from </span><span class="calibre3">telnet</span><span class="calibre_13"> and use a command-line program that knows how to speak to the HTTP application layer. We’ll use the </span><span class="calibre3">curl</span><span class="calibre_13"> utility with a special option to record details about its communication:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">curl --trace-ascii </span></span><span class="calibre3"><span class="italic"><span class="bold">trace_file</span></span></span><span class="calibre3"><span class="bold"> http://www.example.org/</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Your distribution may not have the </span></span><span class="calibre3">curl</span><span class="italic"><span class="calibre_13"> package preinstalled, but you should have no trouble installing it if necessary.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You’ll get a lot of HTML output. Ignore it (or redirect it to </span><span class="italic">/dev/null</span><span class="calibre_13">) and instead look at the newly created file </span><span class="italic">trace_file</span><span class="calibre_13">. If the connection was successful, the first part of the file should look something like the following, at the point where </span><span class="calibre3">curl</span><span class="calibre_13"> attempts to establish the TCP connection to the server:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">== Info:&nbsp;&nbsp; Trying 93.184.216.34...<br class="calibre7" />== Info: TCP_NODELAY set<br class="calibre7" />== Info: Connected to www.example.org (93.184.216.34) port 80 (#0)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Everything you’ve seen so far happens in the transport layer or below. However, if this connection succeeds, </span><span class="calibre3">curl</span><span class="calibre_13"> then tries to send the request (the “header”); this is where the application layer starts:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">1 =&gt; Send header, 79 bytes (0x4f)2 0000: </span><span class="calibre3"><span class="bold">GET / HTTP/1.1</span></span><span class="calibre3"><br class="calibre7" />0010: </span><span class="calibre3"><span class="bold">Host: www.example.org</span></span><span class="calibre3"><br class="calibre7" />0027: </span><span class="calibre3"><span class="bold">User-Agent: curl/7.58.0</span></span><span class="calibre3"><br class="calibre7" />0040: </span><span class="calibre3"><span class="bold">Accept: */*</span></span><span class="calibre3"><br class="calibre7" />004d: </span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Line </span>1<span class="calibre_13"> is </span><span class="calibre3">curl</span><span class="calibre_13"> debugging output telling you what it will do next. The remaining lines show what </span><span class="calibre3">curl</span><span class="calibre_13"> sends to the server. The text in bold is what goes to the server; the hexadecimal numbers at the beginning are just debugging offsets </span><span class="calibre3">curl</span><span class="calibre_13"> adds to help you keep track of how much data was sent or received.</span></p><p class="calibre_27"><span class="calibre_13"> At </span>2<span class="calibre_13">, you can see that </span><span class="calibre3">curl</span><span class="calibre_13"> starts by issuing a </span><span class="calibre3">GET</span><span class="calibre_13"> command to the server (as you did with </span><span class="calibre3">telnet</span><span class="calibre_13">), followed by some extra information for the server and an empty line. Next, the server sends a reply, first with its own header, shown here in bold:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">&lt;= Recv header, 17 bytes (0x11)<br class="calibre7" />0000: </span><span class="calibre3"><span class="bold">HTTP/1.1 200 OK</span></span><span class="calibre3"><br class="calibre7" />&lt;= Recv header, 22 bytes (0x16)<br class="calibre7" />0000: </span><span class="calibre3"><span class="bold">Accept-Ranges: bytes</span></span><span class="calibre3">&lt;= Recv header, 12 bytes (0xc)<br class="calibre7" />0000: </span><span class="calibre3"><span class="bold">Age: 17629</span></span><span class="calibre3"><br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote><a id="calibre_link-657"></a></blockquote><p class="calibre_30"><span class="calibre_13"> Much like the previous output, the </span><span class="calibre3">&lt;=</span><span class="calibre_13"> lines are debugging output, and </span><span class="calibre3">0000:</span><span class="calibre_13"> precedes the lines of output to tell you the offsets (in </span><span class="calibre3">curl</span><span class="calibre_13">, the header won’t count toward the offset; that’s why all of these lines begin with 0).</span></p><p class="calibre_27"><span class="calibre_13">The header in the server’s reply can be fairly long, but at some point the server transitions from transmitting headers to sending the actual requested document, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">&lt;= Recv header, 22 bytes (0x16)<br class="calibre7" />0000: </span><span class="calibre3"><span class="bold">Content-Length: 1256</span></span><span class="calibre3"><br class="calibre7" />&lt;= Recv header, 2 bytes (0x2)1 0000: <br class="calibre7" />&lt;= Recv data, 1256 bytes (0x4e8)<br class="calibre7" />0000: </span><span class="calibre3"><span class="bold">&lt;!doctype html&gt;.&lt;html&gt;.&lt;head&gt;.&nbsp;&nbsp;&nbsp; &lt;title&gt;Example Domain&lt;/title&gt;.</span></span><span class="calibre3"><br class="calibre7" />0040: </span><span class="calibre3"><span class="bold">.&nbsp;&nbsp;&nbsp; &lt;meta charset="utf-8" /&gt;.&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="Content-type</span></span><span class="calibre3"><br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This output also illustrates an important property of the application layer. Even though the debugging output says </span><span class="calibre3">Recv header</span><span class="calibre_13"> and </span><span class="calibre3">Recv data</span><span class="calibre_13">, implying that those are two different kinds of messages from the server, there’s no difference in how </span><span class="calibre3">curl</span><span class="calibre_13"> talked to the operating system to retrieve the two messages, in how the operating system handled them, or in how the network handled the packets underneath. The difference is entirely within the user-space </span><span class="calibre3">curl</span><span class="calibre_13"> application. </span><span class="calibre3">curl</span><span class="calibre_13"> knew that until this point it had been getting headers, but when it received a blank line </span>1<span class="calibre_13">, which signifies the end of headers in HTTP, it knew to interpret anything that followed as the requested document.</span></p><p class="calibre_27"><span class="calibre_13">The same is true of the server sending this data. When sending the reply, the server’s operating system didn’t differentiate between header and document data; the distinctions happen inside the user-space server program.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-301" class="calibre_23"><span class="calibre1"><span class="bold"> 10.3 Network Servers</span></span></p><p class="calibre_24"><span class="calibre_13">Most network servers are like other server daemons on your system such as cron, except that they interact with network ports. In fact, syslogd, discussed in </span>Chapter 7<span class="calibre_13">, accepts UDP packets on port 514 when started with the </span><span class="calibre3">-r</span><span class="calibre_13"> option.</span></p><p class="calibre_27"><span class="calibre_13">Here are some other common network servers that you might find running on your system:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">httpd, apache, apache2, nginx</span> Web servers</li><li value="2" class="calibre_8"><span class="bold">sshd</span> Secure shell daemon</li><li value="3" class="calibre_8"><span class="bold">postfix, qmail, sendmail</span> Mail servers</li><li value="4" class="calibre_8"><span class="bold">cupsd</span> Print server</li><a id="calibre_link-727"></a><li value="5" class="calibre_8"><span class="bold">nfsd, mountd</span> Network filesystem (file-sharing) daemons</li><li value="6" class="calibre_8"><span class="bold">smbd, nmbd</span> Windows file-sharing daemons (see Chapter 12)</li><li value="7" class="calibre_8"><span class="bold">rpcbind</span> Remote procedure call (RPC) portmap service daemon</li></ol><p class="calibre_33"><span class="calibre_13"> One feature common to most network servers is that they usually operate as multiple processes. At least one process listens on a network port, and upon receiving a new incoming connection, the listening process uses </span><span class="calibre3">fork()</span><span class="calibre_13"> to create a child process, which is then responsible for the new connection. The child, often called a </span><span class="italic">worker</span><span class="calibre_13"> process, terminates when the connection is closed. Meanwhile, the original listening process continues to listen on the network port. This process allows a server to easily handle many connections without much trouble.</span></p><p class="calibre_27"><span class="calibre_13"> There are some exceptions to this model, however. Calling </span><span class="calibre3">fork()</span><span class="calibre_13"> adds a significant amount of system overhead. To avoid this, high-performance TCP servers such as the Apache web server may create a number of worker processes upon startup so they’re available to handle connections as needed. Servers that accept UDP packets don’t need to fork at all, as they don’t have connections to listen for; they simply receive data and react to it.</span></p><p id="calibre_link-302" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.3.1  Secure Shell</span></span></span></p><p class="calibre_45"><span class="calibre_13">Every network server program works a bit differently. To get hands-on experience with a server’s configuration and operation, let’s take a close look at the standalone secure shell (SSH) server. One of the most common network service applications, SSH is the de facto standard for remote access to a Unix machine. SSH is designed to allow secure shell logins, remote program execution, simple file sharing, and more&mdash;replacing the old, insecure </span><span class="calibre3">telnet</span><span class="calibre_13"> and </span><span class="calibre3">rlogin</span><span class="calibre_13"> remote-access systems with public-key cryptography for authentication and simpler ciphers for session data. Most ISPs and cloud providers require SSH for shell access to their services, and many Linux-based network appliances (such as network attached storage, or NAS, devices) provide access via SSH as well. OpenSSH (</span><a href="http://www.openssh.com/"><span class="italic"><span class="calibre_4">http://www.openssh.com/</span></span></a><span class="calibre_13">) is a popular free SSH implementation for Unix, and nearly all Linux distributions come with it preinstalled. The OpenSSH client program is </span><span class="calibre3">ssh</span><span class="calibre_13">, and the server is sshd. There are two main SSH protocol versions: 1 and 2. OpenSSH supports only version 2, having dropped version 1 support due to vulnerabilities and lack of use.</span></p><p class="calibre_27"><span class="calibre_13">Among its many useful capabilities and features, SSH does the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Encrypts your password and all other session data, protecting you from snoopers.</li><li value="2" class="calibre_8"> Tunnels other network connections, including those from X Window System clients. (You’ll learn more about X in Chapter 14.)</li><li value="3" class="calibre_8">Offers clients for nearly any operating system.</li><li value="4" class="calibre_8">Uses keys for host authentication.</li></ul><blockquote id="calibre_link-728" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29">Tunneling<span class="italic"><span class="calibre_13"> is the process of packaging and transporting one network connection within another. The advantages of using SSH to tunnel X Window System connections are that SSH sets up the display environment for you, and it encrypts the X data inside the tunnel.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> SSH does have a few disadvantages. For one, in order to set up an SSH connection, you need the remote host’s public key, and you don’t necessarily get it in a secure way (though you can check it manually to make sure you’re not being spoofed). For an overview of how several methods of cryptography work, get your hands on the book </span><span class="italic">Serious Cryptography: A Practical Introduction to Modern Encryption</span><span class="calibre_13"> (No Starch Press, 2017), by Jean-Philippe Aumasson. Two in-depth books on SSH are </span><span class="italic">SSH Mastery: OpenSSH, PuTTY, Tunnels, and Keys</span><span class="calibre_13">, 2nd edition, by Michael W. Lucas (Tilted Windmill Press, 2018) and </span><span class="italic">SSH, The Secure Shell: The Definitive Guide</span><span class="calibre_13">, 2nd edition, by Daniel J. Barrett, Richard E. Silverman, and Robert G. Byrnes (O’Reilly, 2005).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">PUBLIC-KEY CRYPTOGRAPHY</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">We’ve been using the term </span></span><span class="calibre3"><span class="italic">public key</span></span><span class="calibre3"><span class="calibre_13"> without much context, so let’s step back and briefly discuss it in case you aren’t familiar with it. Until the 1970s, encryption algorithms were </span></span><span class="calibre3"><span class="italic">symmetric</span></span><span class="calibre3"><span class="calibre_13">, requiring a message’s sender and recipient to have the same key. Breaking the code was a matter of stealing the key, and the more people who had it, the more opportunities there were for it to be compromised. But with public key cryptography, there are two keys: public and private. The </span></span><span class="calibre3"><span class="italic">public key</span></span><span class="calibre3"><span class="calibre_13"> can encrypt a message but not decrypt it; therefore, it doesn’t matter who has access to this key. Only the </span></span><span class="calibre3"><span class="italic">private key</span></span><span class="calibre3"><span class="calibre_13"> can decrypt a message from the public key. In most cases, it’s easier to protect the private key because there need only be one copy, and it doesn’t have to be transmitted.</span></span></blockquote><blockquote class="calibre_69"><span class="calibre3"><span class="calibre_13">Another application beyond encryption is authentication; there are ways to verify that someone holds a private key for a given public key without transmitting any keys.</span></span></blockquote><p id="calibre_link-303" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">10.3.2  The sshd Server</span></span></span></p><p class="calibre_45"><span class="calibre_13">Running the sshd server to allow remote connections to your system requires a configuration file and host keys. Most distributions keep configurations in the </span><span class="italic">/etc/ssh</span><span class="calibre_13"> configuration directory and try to configure everything properly for you if you install their sshd package. (The server configuration filename </span><span class="italic">sshd_config</span><span class="calibre_13"> is easy to confuse with the client’s </span><span class="italic">ssh_config</span><span class="calibre_13"> setup file, so be careful.)</span></p><p class="calibre_27"><span class="calibre_13"> You shouldn’t need to change anything in </span><span class="italic">sshd_config</span><span class="calibre_13">, but it never hurts to check. The file consists of key-value pairs, as shown in this fragment.</span></p><p class="calibre_63">
</p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Port 22<br class="calibre7" />#AddressFamily any<br class="calibre7" />#ListenAddress 0.0.0.0<br class="calibre7" />#ListenAddress ::<br class="calibre7" />#HostKey /etc/ssh/ssh_host_rsa_key<br class="calibre7" />#HostKey /etc/ssh/ssh_host_ecdsa_key<br class="calibre7" />#HostKey /etc/ssh/ssh_host_ed25519_key<br class="calibre7" /></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Lines beginning with </span><span class="calibre3">#</span><span class="calibre_13"> are comments, and many comments in your </span><span class="italic">sshd_config</span><span class="calibre_13"> indicate default values for various parameters, as you can see from this excerpt. The sshd_config(5) manual page contains descriptions of the parameters and possible values, but these are among the most important:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">HostKey </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span> Uses <span class="calibre3"><span class="italic">file</span></span> as a host key. (Host keys are described next.)</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">PermitRootLogin </span></span><span class="calibre3"><span class="italic"><span class="bold">value</span></span></span> Permits the superuser to log in with SSH if <span class="calibre3"><span class="italic">value</span></span> is set to <span class="calibre3">yes</span>. Set <span class="calibre3"><span class="italic">value</span></span> to <span class="calibre3">no</span> to prevent this.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">LogLevel </span></span><span class="calibre3"><span class="italic"><span class="bold">level</span></span></span> Logs messages with syslog level <span class="calibre3"><span class="italic">level</span></span> (defaults to <span class="calibre3">INFO</span>).</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">SyslogFacility </span></span><span class="calibre3"><span class="italic"><span class="bold">name</span></span></span> Logs messages with syslog facility <span class="calibre3"><span class="italic">name</span></span> (defaults to <span class="calibre3">AUTH</span>).</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">X11Forwarding </span></span><span class="calibre3"><span class="italic"><span class="bold">value</span></span></span> Enables X Window System client tunneling if <span class="calibre3"><span class="italic">value</span></span> is set to <span class="calibre3">yes</span>.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">XAuthLocation </span></span><span class="calibre3"><span class="italic"><span class="bold">path</span></span></span> Specifies the location of the <span class="calibre3">xauth</span> utility on your system. X tunneling will not work without this path. If <span class="calibre3">xauth</span> isn’t in <span class="italic">/usr/bin</span>, set <span class="calibre3"><span class="italic">path</span></span> to the full pathname for <span class="calibre3">xauth</span>.</li></ol><p class="calibre_46"><span class="bold">Creating Host Keys</span></p><p class="calibre_25"><span class="calibre_13">OpenSSH has several host key sets. Each set has a public key (with a </span><span class="italic">.pub</span><span class="calibre_13"> file extension) and a private key (with no extension).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Do not let anyone see a private key, even on your own system, because if someone obtains it, you’re at risk from intruders.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> SSH version 2 has RSA and DSA keys. RSA and DSA are public key cryptography algorithms. The key filenames are given in </span><a></a><a href="#calibre_link-535"><span class="italic"><span class="calibre_4">Table 10-1</span></span></a><span class="calibre_13">.</span></p><p id="calibre_link-535" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 10-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: OpenSSH Key Files</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Filename&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Key type&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3"><span class="italic">ssh_host_rsa_key&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Private RSA key&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3"><span class="italic">ssh_host_rsa_key.pub&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Public RSA key&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3"><span class="italic">ssh_host_dsa_key&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Private DSA key&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3"><span class="italic">ssh_host_dsa_key.pub&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Public DSA key&nbsp;</span></span>
</td></tr></table><p id="calibre_link-754" class="calibre_37"><span class="calibre_13">Creating a key involves a numerical computation that generates both public and private keys. Normally you won’t need to create the keys because the OpenSSH installation program or your distribution’s installation script will do it for you, but you need to know how to do so if you plan to use programs like </span><span class="calibre3">ssh-agent</span><span class="calibre_13"> that provide authentication services without a password. To create SSH protocol version 2 keys, use the </span><span class="calibre3">ssh-keygen</span><span class="calibre_13"> program that comes with OpenSSH:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ssh-keygen -t rsa -N '' -f /etc/ssh/ssh_host_rsa_key</span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">ssh-keygen -t dsa -N '' -f /etc/ssh/ssh_host_dsa_key</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The SSH server and clients also use a </span><span class="italic">key file</span><span class="calibre_13">, called </span><span class="italic">ssh_known_hosts</span><span class="calibre_13">, to store public keys from other hosts. If you intend to use authentication based on a remote client’s identity, the server’s </span><span class="italic">ssh_known_hosts</span><span class="calibre_13"> file must contain the public host keys of all trusted clients. Knowing about the key files is handy if you’re replacing a machine. When installing a new machine from scratch, you can import the key files from the old machine to ensure that users don’t get key mismatches when connecting to the new one.</span></p><p class="calibre_46"><span class="bold">Starting the SSH Server</span></p><p class="calibre_25"><span class="calibre_13">Although most distributions ship with SSH, they usually don’t start the sshd server by default. On Ubuntu and Debian, the SSH server is not installed on a new system; installing its package creates the keys, starts the server, and adds the server startup to the bootup configuration.</span></p><p class="calibre_27"><span class="calibre_13"> On Fedora, sshd is installed by default but turned off. To start sshd at boot, use </span><span class="calibre3">systemctl</span><span class="calibre_13"> like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl enable sshd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">If you want to start the server immediately without rebooting, use:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">systemctl start sshd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Fedora normally creates any missing host key files upon the first sshd startup.</span></p><p class="calibre_27"><span class="calibre_13"> If you’re running another distribution, you likely won’t need to manually configure the sshd startup. However, you should know that there are two startup modes: standalone and on-demand. The standalone server is by far more common, and it’s just a matter of running sshd as root. The sshd server process writes its PID to </span><span class="italic">/var/run/sshd.pid</span><span class="calibre_13"> (of course, when run by systemd, it’s also tracked by its cgroup, as you saw in </span>Chapter 6<span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13">As an alternative, systemd can start sshd on demand through a socket unit. This usually isn’t a good idea, because the server occasionally needs to generate key files, and that process can take a long time.</span></p><p id="calibre_link-304" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.3.3  fail2ban</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you set up an SSH server on your machine and open it up to the internet, you’ll quickly discover constant intrusion attempts. These brute-force attacks won’t succeed if your system is properly configured and you haven’t chosen stupid passwords. However, they will be annoying, consume CPU time, and unnecessarily clutter your logs.</span><a id="calibre_link-755"></a></p><p class="calibre_27"><span class="calibre_13"> To prevent this, you want to set up a mechanism to block repeated login attempts. As of this writing, the fail2ban package is the most popular way to do this; it’s simply a script that watches log messages. Upon seeing a certain number of failed requests from one host within a certain time frame, fail2ban uses </span><span class="calibre3">iptables</span><span class="calibre_13"> to create a rule to deny traffic from that host. After a specified period, during which the host has probably given up trying to connect, fail2ban removes the rule.</span></p><p class="calibre_27"><span class="calibre_13">Most Linux distributions offer a fail2ban package with preconfigured defaults for SSH.</span></p><p id="calibre_link-305" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.3.4  The SSH Client</span></span></span></p><p class="calibre_45"><span class="calibre_13">To log in to a remote host, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$</span><span class="calibre3"><span class="bold"> ssh </span></span><span class="calibre3"><span class="italic"><span class="bold">remote_username</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">remote_host</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You may omit </span><span class="calibre3"><span class="italic">remote_username</span></span><span class="calibre3">@</span><span class="calibre_13"> if your local username is the same as on </span><span class="calibre3"><span class="italic">remote_host</span></span><span class="calibre_13">. You can also run pipelines to and from an </span><span class="calibre3">ssh</span><span class="calibre_13"> command as shown in the following example, which copies a directory </span><span class="italic">dir</span><span class="calibre_13"> to another host:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">tar zcvf - </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold"> | ssh </span></span><span class="calibre3"><span class="italic"><span class="bold">remote_host</span></span></span><span class="calibre3"><span class="bold"> tar zxvf -</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The global SSH client configuration file </span><span class="italic">ssh_config</span><span class="calibre_13"> should be in </span><span class="italic">/etc/ssh</span><span class="calibre_13">, the same location as your </span><span class="italic">sshd_config</span><span class="calibre_13"> file. As with the server configuration file, the client configuration file has key-value pairs, but you shouldn’t need to change them.</span></p><p class="calibre_27"><span class="calibre_13"> The most frequent problem with using SSH clients occurs when an SSH public key in your local </span><span class="italic">ssh_known_hosts</span><span class="calibre_13"> or </span><span class="italic">.ssh/known_hosts</span><span class="calibre_13"> file does not match the key on the remote host. Bad keys cause errors or warnings like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br class="calibre7" />@&nbsp;&nbsp;&nbsp; WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&nbsp;&nbsp;&nbsp;&nbsp; @<br class="calibre7" />@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br class="calibre7" />IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!<br class="calibre7" />Someone could be eavesdropping on you right now (man-in-the-middle attack)!<br class="calibre7" />It is also possible that the RSA host key has just been changed.<br class="calibre7" />The fingerprint for the RSA key sent by the remote host is<br class="calibre7" />38:c2:f6:0d:0d:49:d4:05:55:68:54:2a:2f:83:06:11.<br class="calibre7" />Please contact your system administrator.<br class="calibre7" />Add correct host key in /home/</span><span class="calibre3"><span class="italic">user</span></span><span class="calibre3">/.ssh/known_hosts to get rid of this message.1 Offending key in /home/</span><span class="calibre3"><span class="italic">user</span></span><span class="calibre3">/.ssh/known_hosts:12<br class="calibre7" />RSA host key for </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre3"> has changed and you have requested<br class="calibre7" />strict checking.<br class="calibre7" />Host key verification failed.</span></blockquote></blockquote><p id="calibre_link-765" class="calibre_30"><span class="calibre_13">This usually just means that the remote host’s administrator changed the keys (which often happens upon a hardware or cloud server upgrade), but it never hurts to check with the administrator if you’re not sure. In any case, the preceding message tells you that the bad key is in line 12 of a user’s </span><span class="italic">known_hosts</span><span class="calibre_13"> file </span>1<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">If you don’t suspect foul play, just remove the offending line or replace it with the correct public key.</span></p><p class="calibre_46"><span class="bold">SSH File Transfer Clients</span></p><p class="calibre_25"><span class="calibre_13">OpenSSH includes the file transfer programs </span><span class="calibre3">scp</span><span class="calibre_13"> and </span><span class="calibre3">sftp</span><span class="calibre_13">, which are intended as replacements for the older, insecure programs </span><span class="calibre3">rcp</span><span class="calibre_13"> and </span><span class="calibre3">ftp</span><span class="calibre_13">. You can use </span><span class="calibre3">scp</span><span class="calibre_13"> to transfer files to or from a remote machine to your machine or from one host to another. It works like the </span><span class="calibre3">cp</span><span class="calibre_13"> command. Here are a few examples.</span></p><p class="calibre_27"><span class="calibre_13">Copy a file from a remote host to the current directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">scp </span></span><span class="calibre3"><span class="italic"><span class="bold">user</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold"> .</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Copy a file from the local machine to a remote host:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">scp </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">user</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Copy a file from one remote host to a second remote host:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">scp </span></span><span class="calibre3"><span class="italic"><span class="bold">user1</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host1</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">user2</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host2</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">sftp</span><span class="calibre_13"> program works like the obsolete command-line </span><span class="calibre3">ftp</span><span class="calibre_13"> client, using </span><span class="calibre3">get</span><span class="calibre_13"> and </span><span class="calibre3">put</span><span class="calibre_13"> commands. The remote host must have an </span><span class="calibre3">sftp-server</span><span class="calibre_13"> program installed, which you can expect if the remote host also uses OpenSSH.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you need more features and flexibility than what </span></span><span class="calibre3">scp</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">sftp</span><span class="italic"><span class="calibre_13"> offer (for example, if you frequently transfer large numbers of files), have a look at </span></span><span class="calibre3">rsync</span><span class="italic"><span class="calibre_13">, described in </span></span><span class="italic">Chapter 12</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_23"><span class="bold">SSH Clients for Non-Unix Platforms</span></p><p class="calibre_25"><span class="calibre_13">There are SSH clients for all popular operating systems. Which one should you choose? PuTTY is a good, basic Windows client that includes a secure file-copy program. macOS is based on Unix and includes OpenSSH.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-306" class="calibre_23"><span class="calibre1"><span class="bold"> 10.4 Pre-systemd Network Connection Servers: inetd/xinetd</span></span></p><p class="calibre_24"><span class="calibre_13">Before the widespread use of systemd and the socket units that you saw in </span>Section 6.3.7<span class="calibre_13">, there were a handful of servers that provided a standard means of building a network service. Many minor network services are very similar in their connection requirements, so implementing standalone servers for every service can be inefficient. Each server must be separately configured to handle port listening, access control, and port configuration. These actions are performed in the same way for most services; only when a server accepts a connection is communication handled any differently.</span><a id="calibre_link-794"></a></p><p class="calibre_27"><span class="calibre_13"> One traditional way to simplify the use of servers is with the inetd daemon, a kind of </span><span class="italic">superserver</span><span class="calibre_13"> designed to standardize network port access and interfaces between server programs and network ports. After you start inetd, it reads its configuration file and then listens on the network ports defined in that file. As new network connections come in, inetd attaches a newly started process to the connection.</span></p><p class="calibre_27"><span class="calibre_13">A newer version of inetd called xinetd offers easier configuration and better access control, but xinetd has almost entirely been phased out in favor of systemd. However, you might see it on an older system or one that does not use systemd.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">TCP WRAPPERS: TCPD, /ETC/HOSTS.ALLOW, AND /ETC/HOSTS.DENY</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">Before lower-level firewalls such as </span></span><span class="calibre3">iptables</span><span class="calibre3"><span class="calibre_13"> became popular, many administrators used the </span></span><span class="calibre3"><span class="italic">TCP wrapper</span></span><span class="calibre3"><span class="calibre_13"> library and daemon to control access to network services. In these implementations, inetd runs the </span></span><span class="calibre3">tcpd</span><span class="calibre3"><span class="calibre_13"> program, which first looks at the incoming connection as well as the access control lists in the </span></span><span class="calibre3"><span class="italic">/etc/hosts.allow</span></span><span class="calibre3"><span class="calibre_13"> and </span></span><span class="calibre3"><span class="italic">/etc/hosts.deny</span></span><span class="calibre3"><span class="calibre_13"> files. The </span></span><span class="calibre3">tcpd</span><span class="calibre3"><span class="calibre_13"> program logs the connection, and if it decides that the incoming connection is okay, it hands it to the final service program. You might encounter systems that still use the TCP wrapper system, but we won’t cover it in detail because it has largely fallen out of use.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-307" class="calibre_42"><span class="calibre1"><span class="bold"> 10.5 Diagnostic Tools</span></span></p><p class="calibre_24"><span class="calibre_13">Let’s look at a few diagnostic tools that are useful for poking around the application layer. Some dig into the transport and network layers, because everything in the application layer eventually maps down to something in those lower layers.</span></p><p class="calibre_27"><span class="calibre_13"> As discussed in </span>Chapter 9<span class="calibre_13">, </span><span class="calibre3">netstat</span><span class="calibre_13"> is a basic network service debugging tool that can display a number of transport and network layer statistics. </span><a></a><a href="#calibre_link-536"><span class="italic"><span class="calibre_4">Table 10-2</span></span></a><span class="calibre_13"> reviews a few useful options for viewing connections.</span></p><p id="calibre_link-536" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 10-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Useful Connection-Reporting Options for netstat</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Option&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Description&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-t&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Prints TCP port information&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-u&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Prints UDP port information&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-l&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Prints listening ports&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-a&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Prints every active port&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-n&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Disables name lookups (speeds things up; also useful if DNS isn’t working)&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-4</span><span class="calibre3"><span class="calibre_13">, </span></span><span class="calibre3">-6&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Limits the output to IP version 4 or 6&nbsp;</span></span>
</td></tr></table><p id="calibre_link-308" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.5.1  lsof</span></span></span></p><p class="calibre_45"><span class="calibre_13">In </span>Chapter 8<span class="calibre_13">, you learned that </span><span class="calibre3">lsof</span><span class="calibre_13"> not only can track open files, but can also list the programs currently using or listening to ports. For a complete list of such programs, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -i</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">When you run this command as a regular user, it shows only that user’s processes. When you run it as root, the output should look something like this, displaying a variety of processes and users:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">COMMAND&nbsp;&nbsp;&nbsp;&nbsp; PID&nbsp;&nbsp;&nbsp;&nbsp; USER&nbsp;&nbsp; FD&nbsp;&nbsp; TYPE&nbsp;&nbsp; DEVICE SIZE/OFF NODE NAME<br class="calibre7" />rpcbind&nbsp;&nbsp;&nbsp;&nbsp; 700&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 6u&nbsp; IPv4&nbsp;&nbsp;&nbsp; 10492&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; UDP *:sunrpc 1<br class="calibre7" />rpcbind&nbsp;&nbsp;&nbsp;&nbsp; 700&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 8u&nbsp; IPv4&nbsp;&nbsp;&nbsp; 10508&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; TCP *:sunrpc (LISTEN)<br class="calibre7" />avahi-dae&nbsp;&nbsp; 872&nbsp;&nbsp;&nbsp; avahi&nbsp;&nbsp; 13u&nbsp; IPv4 21736375&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; UDP *:mdns 2<br class="calibre7" />cupsd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1010&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 9u&nbsp; IPv6 42321174&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; TCP ip6-localhost:ipp (LISTEN) 3<br class="calibre7" />ssh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 14366&nbsp;&nbsp;&nbsp; juser&nbsp;&nbsp;&nbsp; 3u&nbsp; IPv4 38995911&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; TCP thishost.local:55457-&gt; 4 somehost.example.com:ssh (ESTABLISHED)<br class="calibre7" />chromium- 26534&nbsp;&nbsp;&nbsp; juser&nbsp;&nbsp;&nbsp; 8r&nbsp; IPv4 42525253&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp; TCP thishost.local:41551-&gt; 5 anotherhost.example.com:https (ESTABLISHED)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This example output shows users and process IDs for server and client programs, from the old-style RPC services at the top </span>1<span class="calibre_13">, to the multicast DNS service provided by </span><span class="calibre3">avahi</span><span class="calibre_13">
</span>2<span class="calibre_13">, to even an IPv6-ready printer service, cupsd </span>3<span class="calibre_13">. The last two entries show client connections: an SSH connection </span>4<span class="calibre_13"> and a secure web connection from the Chromium web browser </span>5<span class="calibre_13">. Because the output can be extensive, it’s usually best to apply a filter (as discussed in the following section).</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">lsof</span><span class="calibre_13"> program is like </span><span class="calibre3">netstat</span><span class="calibre_13"> in that it tries to reverse-resolve every IP address that it finds into a hostname, which slows down the output. Use the </span><span class="calibre3">-n</span><span class="calibre_13"> option to disable name resolution:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -n -i</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also specify </span><span class="calibre3">-P</span><span class="calibre_13"> to disable </span><span class="italic">/etc/services</span><span class="calibre_13"> port name lookups.</span></p><p class="calibre_46"><span class="bold">Filtering by Protocol and Port</span></p><p class="calibre_25"><span class="calibre_13">If you’re looking for a particular port (say, you know that a process is using a particular port and you want to know what that process is), use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -i:</span></span><span class="calibre3"><span class="italic"><span class="bold">port</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The full syntax is as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -i</span></span><span class="calibre3"><span class="italic"><span class="bold">protocol</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">port</span></span></span></blockquote></blockquote><p id="calibre_link-573" class="calibre_30"><span class="calibre_13">The </span><span class="calibre3"><span class="italic">protocol</span></span><span class="calibre_13">, </span><span class="calibre3">@</span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13">, and </span><span class="calibre3">:</span><span class="calibre3"><span class="italic">port</span></span><span class="calibre_13"> parameters are all optional and will filter the </span><span class="calibre3">lsof</span><span class="calibre_13"> output accordingly. As with most network utilities, </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13"> and </span><span class="calibre3"><span class="italic">port</span></span><span class="calibre_13"> can be either names or numbers. For example, if you want to see connections only on TCP port 443 (the HTTPS port), use:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -iTCP:443</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To filter based on IP version, use </span><span class="calibre3">-i4</span><span class="calibre_13"> (IPv4) or </span><span class="calibre3">-i6</span><span class="calibre_13"> (IPv6). You can add this as a separate option or just add the number in with more complex filters (for example, </span><span class="calibre3">-i6TCP:443</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> You can specify service names from </span><span class="italic">/etc/services</span><span class="calibre_13"> (as in </span><span class="calibre3">-iTCP:ssh</span><span class="calibre_13">) instead of numbers.</span></p><p class="calibre_46"><span class="bold">Filtering by Connection Status</span></p><p class="calibre_25"><span class="calibre_13">One particularly handy </span><span class="calibre3">lsof</span><span class="calibre_13"> filter is connection status. For example, to show only the processes listening on TCP ports, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -iTCP -sTCP:LISTEN</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This command gives you a good overview of the network server processes currently running on your system. However, because UDP servers don’t listen and don’t have connections, you’ll have to use </span><span class="calibre3">-iUDP</span><span class="calibre_13"> to view running clients as well as servers. This usually isn’t a problem, because you probably won’t have many UDP servers on your system.</span></p><p id="calibre_link-309" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.5.2  tcpdump</span></span></span></p><p class="calibre_45"><span class="calibre_13">Your system normally doesn’t bother with network traffic that isn’t addressed to one of its MAC addresses. If you need to see exactly what’s crossing your network, </span><span class="calibre3">tcpdump</span><span class="calibre_13"> puts your network interface card into </span><span class="italic">promiscuous mode</span><span class="calibre_13"> and reports on every packet that comes across. Entering </span><span class="calibre3">tcpdump</span><span class="calibre_13"> with no arguments produces output like the following, which includes an ARP request and web connection:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">tcpdump</span></span><span class="calibre3"><br class="calibre7" />tcpdump: listening on eth0<br class="calibre7" />20:36:25.771304 arp who-has mikado.example.com tell duplex.example.com<br class="calibre7" />20:36:25.774729 arp reply mikado.example.com is-at 0:2:2d:b:ee:4e<br class="calibre7" />20:36:25.774796 duplex.example.com.48455 &gt; mikado.example.com.www: S 3200063165:3200063165(0) win 5840 &lt;mss 1460,sackOK,timestamp 38815804[|tcp]&gt; (DF)<br class="calibre7" />20:36:25.779283 mikado.example.com.www &gt; duplex.example.com.48455: S 3494716463:3494716463(0) ack 3200063166 win 5792 &lt;mss 1460,sackOK,timestamp 4620[|tcp]&gt; (DF)<br class="calibre7" />20:36:25.779409 duplex.example.com.48455 &gt; mikado.example.com.www: . ack 1 win 5840 &lt;nop,nop,timestamp 38815805 4620&gt; (DF)<br class="calibre7" />20:36:25.779787 duplex.example.com.48455 &gt; mikado.example.com.www: P 1:427(426) ack 1 win 5840 &lt;nop,nop,timestamp 38815805 4620&gt; (DF)<br class="calibre7" />20:36:25.784012 mikado.example.com.www &gt; duplex.example.com.48455: . ack 427 win 6432 &lt;nop,nop,timestamp 4620 38815805&gt; (DF)<br class="calibre7" />20:36:25.845645 mikado.example.com.www &gt; duplex.example.com.48455: P 1:773(772) ack 427 win 6432 &lt;nop,nop,timestamp 4626 38815805&gt; (DF)<br class="calibre7" />20:36:25.845732 duplex.example.com.48455 &gt; mikado.example.com.www: . ack 773 win 6948 &lt;nop,nop,timestamp 38815812 4626&gt; (DF)<br class="calibre7" />9 packets received by filter<br class="calibre7" />0 packets dropped by kernel</span></blockquote><a id="calibre_link-837"></a></blockquote><p class="calibre_30"><span class="calibre_13"> You can tell </span><span class="calibre3">tcpdump</span><span class="calibre_13"> to be more specific by adding filters. You can filter based on source and destination hosts, networks, Ethernet addresses, protocols at many different layers in the network model, and much more. Among the many packet protocols that </span><span class="calibre3">tcpdump</span><span class="calibre_13"> recognizes are ARP, RARP, ICMP, TCP, UDP, IP, IPv6, AppleTalk, and IPX packets. For example, to tell </span><span class="calibre3">tcpdump</span><span class="calibre_13"> to output only TCP packets, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">tcpdump tcp</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">To see web packets and UDP packets, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">tcpdump udp or port 80 or port 443</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The keyword </span><span class="calibre3">or</span><span class="calibre_13"> specifies that the condition on either the left or right can be true to pass the filter. Similarly, the </span><span class="calibre3">and</span><span class="calibre_13"> keyword requires both conditions to be true.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you need to do a lot of packet sniffing, consider using a GUI alternative to </span></span><span class="calibre3">tcpdump</span><span class="italic"><span class="calibre_13"> such as Wireshark.</span></span></blockquote><p class="calibre_23"><span class="bold">Primitives</span></p><p class="calibre_25"><span class="calibre_13">In the preceding examples, </span><span class="calibre3">tcp</span><span class="calibre_13">, </span><span class="calibre3">udp</span><span class="calibre_13">, and </span><span class="calibre3">port</span><span class="calibre_13">
</span><span class="calibre3">80</span><span class="calibre_13"> are basic elements of filters called </span><span class="italic">primitives</span><span class="calibre_13">. The most important primitives are listed in </span><a></a><a href="#calibre_link-537"><span class="italic"><span class="calibre_4">Table 10-3</span></span></a><span class="calibre_13">.</span></p><p id="calibre_link-537" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 10-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: tcpdump Primitives</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Primitive&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Packet specification&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">tcp&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;TCP packets&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">udp&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;UDP packets&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">ip&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;IPv4 packets&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">ip6&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;IPv6 packets&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">port </span><span class="calibre3"><span class="italic">port&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; TCP and/or UDP packets to/from port </span></span><span class="calibre3"><span class="italic">port&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">host </span><span class="calibre3"><span class="italic">host&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Packets to or from </span></span><span class="calibre3"><span class="italic">host&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">net </span><span class="calibre3"><span class="italic">network&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Packets to or from </span></span><span class="calibre3"><span class="italic">network&nbsp;</span></span><span class="calibre_56">
</span></td></tr></table><p id="calibre_link-838" class="calibre_46"><span class="bold">Operators</span></p><p class="calibre_25"><span class="calibre_13">The </span><span class="calibre3">or</span><span class="calibre_13"> used earlier is an </span><span class="italic">operator</span><span class="calibre_13">. </span><span class="calibre3">tcpdump</span><span class="calibre_13"> can use multiple operators (such as </span><span class="calibre3">and</span><span class="calibre_13"> and </span><span class="calibre3">!</span><span class="calibre_13">), and you can group operators in parentheses. If you plan to do any serious work with </span><span class="calibre3">tcpdump</span><span class="calibre_13">, make sure to read the pcap-filter(7) manual page, especially the section that describes the primitives.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Be careful when using </span></span><span class="calibre3">tcpdump</span><span class="italic"><span class="calibre_13">. The </span></span><span class="calibre3">tcpdump</span><span class="italic"><span class="calibre_13"> output shown earlier in this section includes only packet TCP (transport layer) and IP (internet layer) header information, but you can also make </span></span><span class="calibre3">tcpdump</span><span class="italic"><span class="calibre_13"> print the entire packet contents. Even though most important network traffic is now encrypted over TLS, you shouldn’t snoop around on networks unless you own them or otherwise have permission.</span></span></blockquote><p id="calibre_link-310" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">10.5.3  netcat</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you need more flexibility in connecting to a remote host than a command like </span><span class="calibre3">telnet </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic">port</span></span><span class="calibre_13"> allows, use </span><span class="calibre3">netcat</span><span class="calibre_13"> (or </span><span class="calibre3">nc</span><span class="calibre_13">). </span><span class="calibre3">netcat</span><span class="calibre_13"> can connect to remote TCP/UDP ports, specify a local port, listen on ports, scan ports, redirect standard I/O to and from network connections, and more. To open a TCP connection to a port with </span><span class="calibre3">netcat</span><span class="calibre_13">, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">netcat host </span></span><span class="calibre3"><span class="italic"><span class="bold">port</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre3">netcat</span><span class="calibre_13"> terminates when the other side ends the connection, which can be confusing if you redirect standard input to </span><span class="calibre3">netcat</span><span class="calibre_13">, because you might not get your prompt back after sending data (as opposed to almost any other command pipeline). You can end the connection at any time by pressing </span>CTRL-C<span class="calibre_13">. (If you’d like the program and network connection to terminate based on the standard input stream, try the </span><span class="calibre3">sock</span><span class="calibre_13"> program instead.)</span></p><p class="calibre_27"><span class="calibre_13">To listen on a particular port, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">netcat -l </span></span><span class="calibre3"><span class="italic"><span class="bold">port_number</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If </span><span class="calibre3">netcat</span><span class="calibre_13"> is successful at listening on the port, it will wait for a connection, and upon establishing a connection, prints the output from that connection, and sends any standard input to the connection.</span></p><p class="calibre_27"><span class="calibre_13"> Here are some additional notes on </span><span class="calibre3">netcat</span><span class="calibre_13">:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> There isn’t much debugging output by default. If something fails, <span class="calibre3">netcat</span> fails silently, but it does set an appropriate exit code. If you’d like some more information, add the <span class="calibre3">-v</span> (“verbose”) option.</li><li value="2" class="calibre_8"> By default, the <span class="calibre3">netcat</span> client tries to connect with IPv4 and IPv6. However, in server mode, <span class="calibre3">netcat</span> defaults to IPv4. To force the protocol, use <span class="calibre3">-4</span> for IPv4 and <span class="calibre3">-6</span> for IPv6.</li><li value="3" class="calibre_8"> The <span class="calibre3">-u</span> option specifies UDP instead of TCP.</li></ul><p id="calibre_link-311" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.5.4  Port Scanning</span></span></span></p><p class="calibre_45"><span class="calibre_13">Sometimes you don’t even know what services the machines on your networks are offering or even which IP addresses are in use. The Network Mapper (Nmap) program scans all ports on a machine or network of machines looking for open ports, and it lists the ports it finds. Most distributions have an Nmap package, or you can get it at </span><a href="http://www.insecure.org/"><span class="italic"><span class="calibre_4">http://www.insecure.org/</span></span></a><span class="calibre_13">. (See the Nmap manual page and online resources for all that Nmap can do.)</span></p><p class="calibre_27"><span class="calibre_13">When listing ports on your own machine, it often helps to run the Nmap scan from at least two points: from your own machine and from another one (possibly outside your local network). Doing so will give you an overview of what your firewall is blocking.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If someone else controls the network that you want to scan with Nmap, ask for permission. Network administrators watch for port scans and usually disable access to machines that run them.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Run </span><span class="calibre3"><span class="bold">nmap</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre_13"> to run a generic scan on a host. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">nmap</span></span><span class="calibre3">
</span><span class="calibre3"><span class="bold">10.1.2.2</span></span><span class="calibre3"><br class="calibre7" />Starting Nmap 5.21 ( http://nmap.org ) at 2015-09-21 16:51 PST<br class="calibre7" />Nmap scan report for 10.1.2.2<br class="calibre7" />Host is up (0.00027s latency).<br class="calibre7" />Not shown: 993 closed ports<br class="calibre7" />PORT&nbsp;&nbsp;&nbsp;&nbsp; STATE SERVICE<br class="calibre7" />22/tcp&nbsp;&nbsp; open&nbsp; ssh<br class="calibre7" />25/tcp&nbsp;&nbsp; open&nbsp; smtp<br class="calibre7" />80/tcp&nbsp;&nbsp; open&nbsp; http<br class="calibre7" />111/tcp&nbsp; open&nbsp; rpcbind<br class="calibre7" />8800/tcp open&nbsp; unknown<br class="calibre7" />9000/tcp open&nbsp; cslistener<br class="calibre7" />9090/tcp open&nbsp; zeus-admin<br class="calibre7" />Nmap done: 1 IP address (1 host up) scanned in 0.12 seconds</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As you can see here, a number of services are open, many of which are not enabled by default on most distributions. In fact, the only one here that’s usually on by default is port 111, the </span><span class="calibre3">rpcbind</span><span class="calibre_13"> port.</span></p><p class="calibre_27"><span class="calibre_13"> Nmap is also capable of scanning ports over IPv6 if you add the </span><span class="calibre3">-6</span><span class="calibre_13"> option. This can be a handy way of identifying services that do not support IPv6.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-312" class="calibre_23"><span class="calibre1"><span class="bold"> 10.6 Remote Procedure Calls</span></span></p><p class="calibre_24"><span class="calibre_13">What about the rpcbind service from the scan in the preceding section? RPC stands for </span><span class="italic">remote procedure call (RPC)</span><span class="calibre_13">, a system residing in the lower parts of the application layer. It’s designed to make it easier for programmers to build client/server network applications, where a client program calls functions that execute on a remote server. Each type of remote server program is identified by an assigned program number.</span></p><p id="calibre_link-842" class="calibre_27"><span class="calibre_13">RPC implementations use transport protocols such as TCP and UDP, and they require a special intermediary service to map program numbers to TCP and UDP ports. The server is called rpcbind, and it must be running on any machine that wants to use RPC services.</span></p><p class="calibre_27"><span class="calibre_13">To see what RPC services your computer has, run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rpcinfo -p localhost</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">RPC is one of those protocols that just doesn’t want to die. The Network File System (NFS) and Network Information Service (NIS) systems use RPC, but they are completely unnecessary on standalone machines. But whenever you think that you’ve eliminated all need for rpcbind, something else comes up, such as File Access Monitor (FAM) support in GNOME.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-313" class="calibre_23"><span class="calibre1"><span class="bold"> 10.7 Network Security</span></span></p><p class="calibre_24"><span class="calibre_13">Because Linux is a very popular Unix flavor on the PC platform, and especially because it is widely used for web servers, it attracts many unpleasant characters who try to break into computer systems. </span>Section 9.25<span class="calibre_13"> discussed firewalls, but that’s not really the whole story on security.</span></p><p class="calibre_27"><span class="calibre_13"> Network security attracts extremists&mdash;those who </span><span class="italic">really</span><span class="calibre_13"> like to break into systems (whether for fun or money) and those who come up with elaborate protection schemes and </span><span class="italic">really</span><span class="calibre_13"> like to swat away people trying to break into their systems. (This, too, can be very profitable.) Fortunately, you don’t need to know very much to keep your system safe. Here are a few basic rules of thumb:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Run as few services as possible</span> Intruders can’t break into services that don’t exist on your system. If you know what a service is and you’re not using it, don’t turn it on for the sole reason that you might want to use it “at some later point.”</li><li value="2" class="calibre_8"><span class="bold">Block as much as possible with a firewall</span> Unix systems have a number of internal services that you may not know about (such as TCP port 111 for the RPC port-mapping server), and no other system in the world <span class="italic">should</span> know about them. It can be very difficult to track and regulate the services on your system because many different kinds of programs listen on various ports. To keep intruders from discovering internal services on your system, use effective firewall rules and install a firewall at your router.</li><li value="3" class="calibre_8"><span class="bold">Track the services that you offer to the internet</span> If you run an SSH server, Postfix, or similar services, keep your software up to date and get appropriate security alerts. (See Section 10.7.2 for some online resources.)</li><li value="4" class="calibre_8"><span class="bold">Use “long-term support” distribution releases for servers</span> Security teams normally concentrate their work on stable, supported distribution releases. Development and testing releases such Debian Unstable and Fedora Rawhide receive much less attention.</li><li value="5" class="calibre_8"><span class="bold">Don’t give an account on your system to anyone who doesn’t need one</span> It’s much easier to gain superuser access from a local account than it is to break in remotely. In fact, given the huge base of software (and the resulting bugs and design flaws) available on most systems, it can be easy to gain superuser access to a system after you get to a shell prompt. Don’t assume that your friends know how to protect their passwords (or choose good passwords in the first place).</li><a></a><li value="6" class="calibre_8"><span class="bold">Avoid installing dubious binary packages</span> They can contain Trojan horses.</li></ol><p class="calibre_33"><span class="calibre_13">That’s the practical end of protecting yourself. But why is it important to do so? There are three basic kinds of network attacks that can be directed at a Linux machine:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Full compromise</span> This means getting superuser access (full control) of a machine. An intruder can accomplish this by trying a service attack, such as a buffer overflow exploit, or by taking over a poorly protected user account and then trying to exploit a poorly written setuid program.</li><li value="2" class="calibre_8"><span class="bold">Denial-of-service (DoS) attack</span> This prevents a machine from carrying out its network services or forces a computer to malfunction in some other way without the use of any special access. Normally, a DoS attack is just a flood of network requests, but it can also be an exploit of a flaw in a server program that causes a crash. These attacks are harder to prevent, but they are easier to respond to.</li><li value="3" class="calibre_8"><span class="bold">Malware</span> Linux users are mostly immune to malware such as email worms and viruses, simply because their email clients aren’t stupid enough to actually run programs sent in message attachments. But Linux malware does exist. Avoid downloading and installing executable software from places that you’ve never heard of.</li></ol><p id="calibre_link-314" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.7.1  Typical Vulnerabilities</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are two basic types of vulnerabilities to worry about: direct attacks and cleartext password sniffing. </span><span class="italic">Direct attacks</span><span class="calibre_13"> try to take over a machine without being terribly subtle. One of the most common is locating an unprotected or otherwise vulnerable service on your system. This can be as simple as a service that isn’t authenticated by default, such as an administrator account without a password. Once an intruder has access to one service on a system, they can use it to try to compromise the whole system. In the past, a common direct attack was the buffer overflow exploit, where a careless programmer doesn’t check the bounds of a buffer array. This has been mitigated somewhat by Address Space Layout Randomization (ASLR) techniques in the kernel and protective measures elsewhere.</span></p><p class="calibre_27"><span class="calibre_13"> A </span><span class="italic">cleartext password sniffing attack</span><span class="calibre_13"> captures passwords sent across the wire as clear text, or uses a password database populated from one of many data breaches. As soon as an attacker gets your password, it’s game over. From there, the assailant will inevitably try to gain superuser access locally (which, as mentioned before, is much easier than making a remote attack), try to use the machine as an intermediary for attacking other hosts, or both.</span></p><blockquote id="calibre_link-777" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you need to run a service that offers no native support for encryption, try Stunnel (</span></span><a href="http://www.stunnel.org/"><span class="italic"><span class="calibre_4">http://www.stunnel.org/</span></span></a><span class="italic"><span class="calibre_13">), an encryption wrapper package much like TCP wrappers. Stunnel is especially good at wrapping services that you’d normally activate with systemd socket units or </span></span><span class="calibre3">inetd</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Some services are chronic attack targets due to poor implementation and design. You should always deactivate the following services (they’re all quite dated at this point, and rarely activated by default on most systems):</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">ftpd</span> For whatever reason, all FTP servers seem plagued with vulnerabilities. In addition, most FTP servers use cleartext passwords. If you have to move files from one machine to another, consider an SSH-based solution or an rsync server.</li><li value="2" class="calibre_8"><span class="bold">telnetd, rlogind, rexecd</span> All of these services pass remote session data (including passwords) in cleartext form. Avoid them unless you have a Kerberos-enabled version.</li></ol><p id="calibre_link-315" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">10.7.2  Security Resources</span></span></span></p><p class="calibre_45"><span class="calibre_13">Here are three good security resources:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> The SANS Institute (<a href="http://www.sans.org/"><span class="italic"><span class="calibre_4">http://www.sans.org/</span></span></a>) offers training, services, a free weekly newsletter listing the top current vulnerabilities, sample security policies, and more.</li><li value="2" class="calibre_8"> The CERT Division of Carnegie Mellon University’s Software Engineering Institute (<a href="http://www.cert.org/"><span class="italic"><span class="calibre_4">http://www.cert.org/</span></span></a>) is a good place to look for the most severe problems.</li><li value="3" class="calibre_8"> Insecure.org, a project from hacker and Nmap creator Gordon “Fyodor” Lyon (<a href="http://www.insecure.org/"><span class="italic"><span class="calibre_4">http://www.insecure.org/</span></span></a>), is the place to go for Nmap and pointers to all sorts of network exploit-testing tools. It’s much more open and specific about exploits than are many other sites.</li></ul><p class="calibre_33"><span class="calibre_13"> If you’re interested in network security, you should learn all about Transport Layer Security (TLS) and its predecessor, Secure Socket Layer (SSL). These user-space network levels are typically added to networking clients and servers to support network transactions through the use of public-key encryption and certificates. A good guide is Davies’ </span><span class="italic">Implementing SSL/TLS Using Cryptography and PKI</span><span class="calibre_13"> (Wiley, 2011) or Jean-Philippe Aumasson’s </span><span class="italic">Serious Cryptography: A Practical Introduction to Modern Encryption</span><span class="calibre_13"> (No Starch Press, 2017).</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-316" class="calibre_23"><span class="calibre1"><span class="bold"> 10.8 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">If you’re interested in getting your hands dirty with some complicated network servers, some very common ones are the Apache or nginx web servers and the Postfix email server. In particular, web servers are easy to install and most distributions supply packages. If your machine is behind a firewall or NAT-enabled router, you can experiment with the configuration as much as you’d like without worrying about security.</span></p><p id="calibre_link-821" class="calibre_27"><span class="calibre_13">Throughout the last few chapters, we’ve been gradually moving from kernel space into user space. Only a few utilities discussed in this chapter, such as </span><span class="calibre3">tcpdump</span><span class="calibre_13">, interact with the kernel. The remainder of this chapter describes how sockets bridge the gap between the kernel’s transport layer and the user-space application layer. It’s more advanced material, of particular interest to programmers, so feel free to skip to the next chapter if you like.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-317" class="calibre_23"><span class="calibre1"><span class="bold"> 10.9 Network Sockets</span></span></p><p class="calibre_24"><span class="calibre_13">We’re now going to shift gears and look at how processes do the work of reading data from and writing data to the network. It’s easy enough for processes to read from and write to network connections that are already set up: all you need are some system calls, which you can read about in the recv(2) and send(2) manual pages. From the point of view of a process, perhaps the most important thing to know is how to access the network when using these system calls. On Unix systems, a process uses a socket to identify when and how it’s talking to the network. </span><span class="italic">Sockets</span><span class="calibre_13"> are the interface that processes use to access the network through the kernel; they represent the boundary between user space and kernel space. They’re often also used for interprocess communication (IPC).</span></p><p class="calibre_27"><span class="calibre_13"> There are different types of sockets because processes need to access the network in different ways. For example, TCP connections are represented by stream sockets (</span><span class="calibre3">SOCK_STREAM</span><span class="calibre_13">, from a programmer’s point of view), and UDP connections are represented by datagram sockets (</span><span class="calibre3">SOCK_DGRAM</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> Setting up a network socket can be somewhat complicated because you need to account for socket type, IP addresses, ports, and transport protocol at particular times. However, after all of the initial details are sorted out, servers use certain standard methods to deal with incoming traffic from the network. The flowchart in </span><a></a><a href="#calibre_link-538"><span class="italic"><span class="calibre_4">Figure 10-1</span></span></a><span class="calibre_13"> shows how many servers handle connections for incoming stream sockets.</span></p><p class="calibre_34"><img src="images/000027.jpg" class="calibre_100" />
</p><p id="calibre_link-538" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 10-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: One method for accepting and processing incoming connections</span></span></span></p><p id="calibre_link-694" class="calibre_37"><span class="calibre_13">Notice that this type of server involves two kinds of sockets: one for listening and one for reading and writing. The master process uses the listening socket to look for connections from the network. When a new connection comes in, the master process uses the </span><span class="calibre3">accept()</span><span class="calibre_13"> system call to accept the connection, which creates the read/write socket dedicated to that connection. Next, the master process uses </span><span class="calibre3">fork()</span><span class="calibre_13"> to create a new child process to deal with the connection. Finally, the original socket remains the listener and continues to look for more connections on behalf of the master process.</span></p><p class="calibre_27"><span class="calibre_13">After a process has set up a socket of a particular type, it can interact with it in a way that fits the socket type. This is what makes sockets flexible: if you need to change the underlying transport layer, you don’t have to rewrite all of the parts that send and receive data; you mostly need to modify the initialization code.</span></p><p class="calibre_27"><span class="calibre_13"> If you’re a programmer and you’d like to learn how to use the socket interface, </span><span class="italic">Unix Network Programming, Volume 1</span><span class="calibre_13">, 3rd edition, by W. Richard Stevens, Bill Fenner, and Andrew M. Rudoff (Addison-Wesley Professional, 2003), is the classic guide. Volume 2 also covers interprocess communication.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-318" class="calibre_23"><span class="calibre1"><span class="bold"> 10.10 Unix Domain Sockets</span></span></p><p class="calibre_24"><span class="calibre_13">Applications that use network facilities don’t have to involve two separate hosts. Many applications are built as client-server or peer-to-peer mechanisms, where processes running on the same machine use interprocess communication to negotiate what work needs to be done and who does it. For example, recall that daemons such as systemd and NetworkManager use D-Bus to monitor and react to system events.</span></p><p class="calibre_27"><span class="calibre_13"> Processes are capable of using regular IP networking over localhost (127.0.0.1 or ::1) to communicate with each other, but they typically use a special kind of socket called a </span><span class="italic">Unix domain socket</span><span class="calibre_13"> as an alternative. When a process connects to a Unix domain socket, it behaves almost exactly like it does with a network socket: it can listen for and accept connections on the socket, and you can even choose between different socket types to make it behave like TCP or UDP.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Keep in mind that a Unix domain socket is not a network socket, and there’s no network behind one. You don’t even need networking to be configured to use one. Unix domain sockets don’t have to be bound to socket files, either. A process can create an unnamed Unix domain socket and share the address with another process.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Developers like Unix domain sockets for IPC for two reasons. First, they allow the option to use special socket files in the filesystem to control access, so any process that doesn’t have access to a socket file can’t use it. And because there’s no interaction with the network, it’s simpler and less prone to conventional network intrusion. For example, you’ll usually find the socket file for D-Bus in </span><span class="italic">/var/run/dbus</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l /var/run/dbus/system_bus_socket</span></span><span class="calibre3"> srwxrwxrwx 1 root root 0 Nov&nbsp; 9 08:52 /var/run/dbus/system_bus_socket</span></blockquote></blockquote><p id="calibre_link-695" class="calibre_30"><span class="calibre_13">Second, because the Linux kernel doesn’t have to go through the many layers of its networking subsystem when working with Unix domain sockets, performance tends to be much better.</span></p><p class="calibre_27"><span class="calibre_13"> Writing code for Unix domain sockets isn’t much different from supporting normal network sockets. Because the benefits can be significant, some network servers offer communication through both network and Unix domain sockets. For example, the MySQL database server mysqld can accept client connections from remote hosts, but it usually also offers a Unix domain socket at </span><span class="italic">/var/run/mysqld/mysqld.sock</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You can view a list of Unix domain sockets currently in use on your system with </span><span class="calibre3">lsof -U</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">lsof -U</span></span><span class="calibre3"><br class="calibre7" />COMMAND&nbsp;&nbsp;&nbsp;&nbsp; PID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USER&nbsp;&nbsp; FD&nbsp;&nbsp; TYPE&nbsp;&nbsp;&nbsp;&nbsp; DEVICE SIZE/OFF&nbsp;&nbsp;&nbsp;&nbsp; NODE NAME<br class="calibre7" />mysqld&nbsp;&nbsp;&nbsp; 19701&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mysql&nbsp;&nbsp; 12u&nbsp; unix 0xe4defcc0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0 35201227 /var/run/mysqld/mysqld.sock<br class="calibre7" />chromium- 26534&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; juser&nbsp;&nbsp;&nbsp; 5u&nbsp; unix 0xeeac9b00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0 42445141 socket<br class="calibre7" />tlsmgr&nbsp;&nbsp;&nbsp; 30480&nbsp;&nbsp;&nbsp; postfix&nbsp;&nbsp;&nbsp; 5u&nbsp; unix 0xc3384240&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0 17009106 socket<br class="calibre7" />tlsmgr&nbsp;&nbsp;&nbsp; 30480&nbsp;&nbsp;&nbsp; postfix&nbsp;&nbsp;&nbsp; 6u&nbsp; unix 0xe20161c0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0t0&nbsp;&nbsp;&nbsp; 10965 private/tlsmgr<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The listing will be quite long because many applications make extensive use of unnamed sockets, which are indicated by </span><span class="calibre3">socket</span><span class="calibre_13"> in the </span><span class="calibre3">NAME</span><span class="calibre_13"> output column.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-319" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-861" class="calibre_10"><span class="calibre4"><span class="bold">11</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">INTRODUCTION TO SHELL SCRIPTS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">If you can enter commands into the shell, you can write shell scripts. A </span></span><span class="calibre1"><span class="italic">shell script</span></span><span class="calibre1"><span class="calibre_13"> (also known as a </span></span><span class="calibre1"><span class="italic">Bourne shell script</span></span><span class="calibre1"><span class="calibre_13">) is a series of commands written in a file; the shell reads the commands from the file just as it would if you typed them into a terminal.</span></span></p><div class="mbp_pagebreak"></div><p id="calibre_link-320" class="calibre_23"><span class="calibre1"><span class="bold"> 11.1 Shell Script Basics</span></span></p><p class="calibre_24"><span class="calibre_13">Bourne shell scripts generally start with the following line, which indicates that the </span><span class="calibre3">/bin/sh</span><span class="calibre_13"> program should execute the commands in the script file. (Make sure that there’s no whitespace at the beginning of the script file.)</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh</span></blockquote></blockquote><p id="calibre_link-729" class="calibre_30"><span class="calibre_13">The </span><span class="calibre3">#!</span><span class="calibre_13"> part is called a </span><span class="italic">shebang</span><span class="calibre_13">; you’ll see it in other scripts in this book. You can list any commands that you want the shell to execute following the </span><span class="calibre3">#!/bin/sh</span><span class="calibre_13"> line. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />#<br class="calibre7" /># Print something, then run ls<br class="calibre7" />echo About to run the ls command.<br class="calibre7" />ls</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> With the exception of the shebang at the top of a script, a </span></span><span class="calibre3">#</span><span class="italic"><span class="calibre_13"> character at the beginning of a line indicates a comment; that is, the shell ignores anything on the line after the </span></span><span class="calibre3">#</span><span class="italic"><span class="calibre_13">. Use comments to explain parts of your scripts that could be difficult to understand for others reading your code or to jog your own memory when you come back to the code later.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">As with any program on Unix systems, you need to set the executable bit for a shell script file, but you must also set the read bit in order for the shell to be able to read the file. The easiest way to do this is as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">chmod +rx</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">script</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This </span><span class="calibre3">chmod</span><span class="calibre_13"> command allows other users to read and execute </span><span class="calibre3"><span class="italic">script</span></span><span class="calibre_13">. If you don’t want that, use the absolute mode </span><span class="calibre3">700</span><span class="calibre_13"> instead (and refer to </span>Section 2.17<span class="calibre_13"> for a refresher on permissions).</span></p><p class="calibre_27"><span class="calibre_13"> After creating a shell script and setting read and execute permissions, you can run it by placing the script file in one of the directories in your command path and then running the script name on the command line. You can also run </span><span class="calibre3">./</span><span class="calibre3"><span class="italic">script</span></span><span class="calibre_13"> if the script is located in your current working directory, or you can use the full pathname.</span></p><p class="calibre_27"><span class="calibre_13"> Running a script with a shebang is almost (but not quite) the same as running a command with your shell; for example, running a script called </span><span class="calibre3">myscript</span><span class="calibre_13"> causes the kernel to run </span><span class="calibre3">/bin/sh myscript</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">With the basics behind us, let’s look at some of the limitations of shell scripts.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The shebang doesn’t have to be </span></span><span class="calibre3">#!/bin/sh</span><span class="italic"><span class="calibre_13">; it can be built to run anything on your system that accepts scripting input, such as </span></span><span class="calibre3">#!/usr/bin/python</span><span class="italic"><span class="calibre_13"> to run Python programs. In addition, you might come across scripts with a different pattern that includes </span></span><span class="calibre3">/usr/bin/env</span><span class="italic"><span class="calibre_13">. For example, you might see something like </span></span><span class="calibre3">#!/usr/bin/env python</span><span class="italic"><span class="calibre_13"> as the first line. This instructs the </span></span><span class="calibre3">env</span><span class="italic"><span class="calibre_13"> utility to run </span></span><span class="calibre3">python</span><span class="italic"><span class="calibre_13">. The reason for this is fairly simple; </span></span><span class="calibre3">env</span><span class="italic"><span class="calibre_13"> looks for the command to run in the current command path, so you don’t need a standardized location for the executable. The disadvantage is that the first matching executable in the command path might not be what you want.</span></span></blockquote><p id="calibre_link-321" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">11.1.1 Limitations of Shell Scripts</span></span></span></p><p class="calibre_45"><span class="calibre_13">The Bourne shell manipulates commands and files with relative ease. In </span>Section 2.14<span class="calibre_13">, you saw the way the shell can redirect output, one of the important elements of shell script programming. However, the shell script is only one tool for Unix programming, and although scripts have considerable power, they also have limitations.</span><a id="calibre_link-782"></a></p><p class="calibre_27"><span class="calibre_13"> One of the main strengths of shell scripts is that they can simplify and automate tasks that you can otherwise perform at the shell prompt, like manipulating batches of files. But if you’re trying to pick apart strings, perform repeated arithmetic computations, or access complex databases, or if you want functions and complex control structures, you’re better off using a scripting language like Python, Perl, or </span><span class="calibre3">awk</span><span class="calibre_13">, or perhaps even a compiled language like C. (This is important, so you’ll see it throughout the chapter.)</span></p><p class="calibre_27"><span class="calibre_13">Finally, be aware of your shell script sizes. Keep your shell scripts short. Bourne shell scripts aren’t meant to be big, though you will undoubtedly encounter some monstrosities.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-322" class="calibre_23"><span class="calibre1"><span class="bold"> 11.2 Quoting and Literals</span></span></p><p class="calibre_24"><span class="calibre_13">One of the most confusing elements of working with the shell and scripts is knowing when and why to use quotation marks (quotes) and other punctuation. Let’s say you want to print the string </span><span class="calibre3">$100</span><span class="calibre_13"> and you do the following:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo $100</span></span><span class="calibre3"><br class="calibre7" />00</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Why did this print </span><span class="calibre3">00</span><span class="calibre_13">? Because </span><span class="calibre3">$1</span><span class="calibre_13"> has a </span><span class="calibre3">$</span><span class="calibre_13"> prefix, which the shell interprets as a shell variable (we’ll cover these soon). You think to yourself that maybe if you surround it with double quotes, the shell will leave the </span><span class="calibre3">$1</span><span class="calibre_13"> alone:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo "$100"</span></span><span class="calibre3"><br class="calibre7" />00</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">That still didn’t work. You ask a friend, who says that you need to use single quotes instead:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo '$100'</span></span><span class="calibre3"><br class="calibre7" />$100</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Why did this particular incantation work?</span></p><p id="calibre_link-323" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.2.1 Literals</span></span></span></p><p class="calibre_45"><span class="calibre_13">When you use quotes, you’re often trying to create a </span><span class="italic">literal</span><span class="calibre_13">, a string that the shell should not analyze (or try to change) before passing it to the command line. In addition to the </span><span class="calibre3">$</span><span class="calibre_13"> in the example that you just saw, this often comes up when you want to pass a </span><span class="calibre3">*</span><span class="calibre_13"> character to a command such as </span><span class="calibre3">grep</span><span class="calibre_13"> instead of having the shell expand it, and when you need to use a semicolon (</span><span class="calibre3">;</span><span class="calibre_13">) in a command.</span></p><p id="calibre_link-783" class="calibre_27"><span class="calibre_13">When writing scripts and working on the command line, remember what happens when the shell runs a command:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Before running the command, the shell looks for variables, globs, and other substitutions and performs the substitutions if they appear.</li><li value="2" class="calibre_8">The shell passes the results of the substitutions to the command.</li></ol><p class="calibre_33"><span class="calibre_13"> Problems involving literals can be subtle. Let’s say you’re looking for all entries in </span><span class="italic">/etc/passwd</span><span class="calibre_13"> that match the regular expression </span><span class="calibre3">r.*t</span><span class="calibre_13"> (that is, a line that contains an </span><span class="calibre3">r</span><span class="calibre_13"> followed by a </span><span class="calibre3">t</span><span class="calibre_13"> later in the line, which would enable you to search for usernames such as </span><span class="calibre3">root</span><span class="calibre_13"> and </span><span class="calibre3">ruth</span><span class="calibre_13"> and </span><span class="calibre3">robot</span><span class="calibre_13">). You can run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep r.*t /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> It works most of the time, but sometimes it mysteriously fails. Why? The answer is probably in your current directory. If that directory contains files with names such as </span><span class="italic">r.input</span><span class="calibre_13"> and </span><span class="italic">r.output</span><span class="calibre_13">, then the shell expands </span><span class="calibre3">r.*t</span><span class="calibre_13"> to </span><span class="calibre3">r.input r.output</span><span class="calibre_13"> and creates this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep r.input r.output /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The key to avoiding problems like this is to first recognize the characters that can get you in trouble and then apply the correct kind of quotes to protect those characters.</span></p><p id="calibre_link-324" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.2.2 Single Quotes</span></span></span></p><p class="calibre_45"><span class="calibre_13">The easiest way to create a literal and make the shell leave a string alone is to enclose the entire string in single quotes (</span><span class="calibre3">'</span><span class="calibre_13">), as in this example with </span><span class="calibre3">grep</span><span class="calibre_13"> and the </span><span class="calibre3">*</span><span class="calibre_13"> character:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep 'r.*t' /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As far as the shell is concerned, all characters between two single quotes, including spaces, make up a single parameter. Therefore, the following command does </span><span class="italic">not</span><span class="calibre_13"> work, because it asks the </span><span class="calibre3">grep</span><span class="calibre_13"> command to search for the string </span><span class="calibre3">r.*t /etc/passwd</span><span class="calibre_13"> in the standard input (because there’s only one parameter to </span><span class="calibre3">grep</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">grep 'r.*t /etc/passwd'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When you need to use a literal, you should always turn to single quotes first, because you’re guaranteed that the shell won’t try </span><span class="italic">any</span><span class="calibre_13"> substitutions. As a result, it’s a generally clean syntax. However, sometimes you need a little more flexibility, so you can turn to double quotes.</span></p><p id="calibre_link-325" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.2.3 Double Quotes</span></span></span></p><p class="calibre_45"><span class="calibre_13">Double quotes (</span><span class="calibre3">"</span><span class="calibre_13">) work just like single quotes, except that the shell expands any variables that appear within double quotes. You can see the difference by running the following command and then replacing the double quotes with single quotes and running it again.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo "There is no * in my path: $PATH"</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When you run the command, notice that the shell substitutes for </span><span class="calibre3">$PATH</span><span class="calibre_13"> but does not substitute for the </span><span class="calibre3">*</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you’re using double quotes when working with large amounts of text, consider using a </span></span>here<span class="italic"><span class="calibre_13"> document, as described in </span></span><span class="italic">Section 11.9</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p id="calibre_link-326" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">11.2.4 Literal Single Quotes</span></span></span></p><p class="calibre_45"><span class="calibre_13">Using literals with the Bourne shell can be tricky when you’re passing a literal single quote to a command. One way to do this is to place a backslash before the single quote character:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo I don\'t like contractions inside shell scripts.</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The backslash and quote </span><span class="italic">must</span><span class="calibre_13"> appear outside any pair of single quotes. A string such as </span><span class="calibre3">'don\'t</span><span class="calibre_13"> results in a syntax error. Oddly enough, you can enclose the single quote inside double quotes, as shown in the following example (the output is identical to that of the preceding command):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo "I don't like contractions inside shell scripts."</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">If you’re in a bind and you need a general rule to quote an entire string with no substitutions, follow this procedure:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Change all instances of <span class="calibre3">'</span> (single quote) to <span class="calibre3">'\''</span> (single quote, backslash, single quote, single quote).</li><li value="2" class="calibre_8">Enclose the entire string in single quotes.</li></ol><p class="calibre_33"><span class="calibre_13"> Therefore, you can quote an awkward string such as </span><span class="calibre3">this isn't a forward slash: \</span><span class="calibre_13"> as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">echo 'this isn'\''t a forward slash: \'</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> It's worth repeating that when you quote a string, the shell treats everything inside the quotes as a single parameter. Therefore, </span></span><span class="calibre3">a b c</span><span class="italic"><span class="calibre_13"> counts as three parameters, but </span></span><span class="calibre3">a "b c"</span><span class="italic"><span class="calibre_13"> is only two.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-327" class="calibre_42"><span class="calibre1"><span class="bold">11.3 Special Variables</span></span></p><p class="calibre_24"><span class="calibre_13">Most shell scripts understand command-line parameters and interact with the commands that they run. To take your scripts from being just a simple list of commands to becoming more flexible shell script programs, you need to know how to use the special Bourne shell variables. These special variables are like any other shell variable as described in </span>Section 2.8<span class="calibre_13">, except that you can’t change the values of certain ones.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> After reading the next few sections, you’ll understand why shell scripts accumulate many special characters as they are written. If you’re trying to understand a shell script and you come across a line that looks completely incomprehensible, pick it apart piece by piece.</span></span></blockquote><p id="calibre_link-328" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">11.3.1 Individual Arguments: $1, $2, and So On</span></span></span></p><p class="calibre_45"><span class="calibre3">$1</span><span class="calibre_13">, </span><span class="calibre3">$2</span><span class="calibre_13">, and all variables named as positive nonzero integers contain the values of the script parameters, or </span><span class="italic">arguments</span><span class="calibre_13">. For example, say the name of the following script is </span><span class="italic">pshow</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />echo First argument: $1<br class="calibre7" />echo Third argument: $3</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Try running the script as follows to see how it prints the arguments:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">./pshow one two three</span></span><span class="calibre3"><br class="calibre7" />First argument: one<br class="calibre7" />Third argument: three</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The built-in shell command </span><span class="calibre3">shift</span><span class="calibre_13"> can be used with argument variables to remove the first argument (</span><span class="calibre3">$1</span><span class="calibre_13">) and advance the rest of the arguments so that </span><span class="calibre3">$2</span><span class="calibre_13"> becomes </span><span class="calibre3">$1</span><span class="calibre_13">, </span><span class="calibre3">$3</span><span class="calibre_13"> becomes </span><span class="calibre3">$2</span><span class="calibre_13">, and so on. For example, assume that the name of the following script is </span><span class="italic">shiftex</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />echo Argument: $1 <br class="calibre7" />shift<br class="calibre7" />echo Argument: $1<br class="calibre7" />shift<br class="calibre7" />echo Argument: $1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Run it like this to see it work:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">./shiftex one two three</span></span><span class="calibre3"> Argument: one<br class="calibre7" />Argument: two<br class="calibre7" />Argument: three</span></blockquote></blockquote><p id="calibre_link-548" class="calibre_30"><span class="calibre_13">As you can see, </span><span class="calibre3">shiftex</span><span class="calibre_13"> prints all three arguments by printing the first, shifting the remaining arguments, and repeating.</span></p><p id="calibre_link-329" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.3.2 Number of Arguments: $#</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">$#</span><span class="calibre_13"> variable holds the number of arguments passed to a script and is especially important when you’re running </span><span class="calibre3">shift</span><span class="calibre_13"> in a loop to pick through arguments. When </span><span class="calibre3">$#</span><span class="calibre_13"> is </span><span class="calibre3">0</span><span class="calibre_13">, no arguments remain, so </span><span class="calibre3">$1</span><span class="calibre_13"> is empty. (See </span>Section 11.6<span class="calibre_13"> for a description of loops.)</span></p><p id="calibre_link-330" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.3.3 All Arguments: $@</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">$@</span><span class="calibre_13"> variable represents all of a script’s arguments and is very useful for passing them to a command inside the script. For example, Ghostscript commands (</span><span class="calibre3">gs</span><span class="calibre_13">) are usually long and complicated. Suppose you want a shortcut for rasterizing a PostScript file at 150 dpi, using the standard output stream, while also leaving the door open for passing other options to </span><span class="calibre3">gs</span><span class="calibre_13">. You could write a script like this to allow for additional command-line options:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />gs -q -dBATCH -dNOPAUSE -dSAFER -sOutputFile=- -sDEVICE=pnmraw $@</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If a line in your shell script gets too long , making it difficult to read and manipulate in your text editor, you can split it up with a backslash ( </span></span><span class="calibre3">\</span><span class="italic"><span class="calibre_13">). For example, you can alter the preceding script as follows:</span></span></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />gs -q -dBATCH -dNOPAUSE -dSAFER </span><span class="calibre3"><span class="bold">\</span></span><span class="calibre3"> -sOutputFile=- -sDEVICE=pnmraw $@</span></blockquote></blockquote><p id="calibre_link-331" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.3.4 Script Name: $0</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">$0</span><span class="calibre_13"> variable holds the name of the script and is useful for generating diagnostic messages. For example, say your script needs to report an invalid argument that is stored in the </span><span class="calibre3">$BADPARM</span><span class="calibre_13"> variable. You can print the diagnostic message with the following line so that the script name appears in the error message:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">echo $0: bad option $BADPARM</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> All diagnostic error messages should go to the standard error. As explained in </span>Section 2.14.1<span class="calibre_13">, </span><span class="calibre3">2&gt;&amp;1</span><span class="calibre_13"> redirects the standard error to the standard output. For writing to the standard error, you can reverse the process with </span><span class="calibre3">1&gt;&amp;2</span><span class="calibre_13">. To do this for the preceding example, use this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">echo $0: bad option $BADPARM 1&gt;&amp;2</span></blockquote></blockquote><p id="calibre_link-332" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.3.5 Process ID: $$</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">$$</span><span class="calibre_13"> variable holds the process ID of the shell.</span></p><p id="calibre_link-333" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.3.6 Exit Code: $?</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">$?</span><span class="calibre_13"> variable holds the exit code of the last command that the shell executed. Exit codes, which are critical to mastering shell scripts, are discussed next.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-334" class="calibre_23"><span class="calibre1"><span class="bold"> 11.4 Exit Codes</span></span></p><p class="calibre_24"><span class="calibre_13">When a Unix program finishes, it leaves an </span><span class="italic">exit code</span><span class="calibre_13">, a numeric value also known as an </span><span class="italic">error code</span><span class="calibre_13"> or </span><span class="italic">exit value</span><span class="calibre_13">, for the parent process that started the program. When the exit code is zero (</span><span class="calibre3">0</span><span class="calibre_13">), it typically means that the program ran without a problem. However, if the program has an error, it usually exits with a number other than </span><span class="calibre3">0</span><span class="calibre_13"> (but not always, as you’ll see next).</span></p><p class="calibre_27"><span class="calibre_13"> The shell holds the exit code of the last command in the </span><span class="calibre3">$?</span><span class="calibre_13"> special variable, so you can check it out at your shell prompt:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls / &gt; /dev/null</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo $?</span></span><span class="calibre3"><br class="calibre7" />0<br class="calibre7" />$ </span><span class="calibre3"><span class="bold">ls /asdfasdf &gt; /dev/null</span></span><span class="calibre3"><br class="calibre7" />ls: /asdfasdf: No such file or directory<br class="calibre7" />$ </span><span class="calibre3"><span class="bold">echo $?</span></span><span class="calibre3"><br class="calibre7" />1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can see that the successful command returned </span><span class="calibre3">0</span><span class="calibre_13"> and the unsuccessful command returned </span><span class="calibre3">1</span><span class="calibre_13"> (assuming, of course, that you don’t have a directory named </span><span class="italic">/asdfasdf</span><span class="calibre_13"> on your system).</span></p><p class="calibre_27"><span class="calibre_13"> If you intend to use a command’s exit code, you </span><span class="italic">must</span><span class="calibre_13"> use or store that code immediately after running the command (because the next command you run overwrites the previous code). For example, if you run </span><span class="calibre3">echo $?</span><span class="calibre_13"> twice in a row, the output of the second command is always </span><span class="calibre3">0</span><span class="calibre_13"> because the first </span><span class="calibre3">echo</span><span class="calibre_13"> command completes successfully.</span></p><p class="calibre_27"><span class="calibre_13"> When writing shell code, you may come across situations where your script needs to halt due to an error (such as a bad filename). Use </span><span class="calibre3">exit 1</span><span class="calibre_13"> in your script to terminate and pass an exit code of </span><span class="calibre3">1</span><span class="calibre_13"> back to whatever parent process ran the script. (You can use different nonzero numbers if your script has various abnormal exit conditions.)</span></p><p class="calibre_27"><span class="calibre_13"> Note that some programs, like </span><span class="calibre3">diff</span><span class="calibre_13"> and </span><span class="calibre3">grep</span><span class="calibre_13">, use nonzero exit codes to indicate normal conditions. For example, </span><span class="calibre3">grep</span><span class="calibre_13"> returns </span><span class="calibre3">0</span><span class="calibre_13"> if it finds something matching a pattern and </span><span class="calibre3">1</span><span class="calibre_13"> if it doesn’t. For these programs, an exit code of </span><span class="calibre3">1</span><span class="calibre_13"> is not an error, so </span><span class="calibre3">grep</span><span class="calibre_13"> and </span><span class="calibre3">diff</span><span class="calibre_13"> use the exit code </span><span class="calibre3">2</span><span class="calibre_13"> if they encounter an actual problem. If you think a program might be using a nonzero exit code to indicate success, read its manual page. The exit codes are usually explained in the EXIT VALUE or DIAGNOSTICS section.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-335" class="calibre_23"><span class="calibre1"><span class="bold">11.5 Conditionals</span></span></p><p class="calibre_24"><span class="calibre_13">The Bourne shell has special constructs for conditionals, including </span><span class="calibre3">if</span><span class="calibre_13">/</span><span class="calibre3">then</span><span class="calibre_13">/</span><span class="calibre3">else</span><span class="calibre_13"> and </span><span class="calibre3">case</span><span class="calibre_13"> statements. For example, this simple script with an </span><span class="calibre3">if</span><span class="calibre_13"> conditional checks to see whether the script’s first argument is </span><span class="calibre3">hi</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if [ $1 = hi ]; then echo 'The first argument was "hi"'<br class="calibre7" />else echo -n 'The first argument was not "hi" -- ' echo It was '"'$1'"'<br class="calibre7" />fi</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The words </span><span class="calibre3">if</span><span class="calibre_13">, </span><span class="calibre3">then</span><span class="calibre_13">, </span><span class="calibre3">else</span><span class="calibre_13">, and </span><span class="calibre3">fi</span><span class="calibre_13"> in the preceding script are shell keywords; everything else is a command. This distinction is extremely important because it’s easy to mistake the conditional, </span><span class="calibre3">[ $1 = "hi" ]</span><span class="calibre_13">, for special shell syntax. In fact, the </span><span class="calibre3">[</span><span class="calibre_13"> character is an actual program on a Unix system. All Unix systems have a command called </span><span class="calibre3">[</span><span class="calibre_13"> that performs tests for shell script conditionals. This program is also known as </span><span class="calibre3">test</span><span class="calibre_13">; the manual pages for </span><span class="calibre3">test</span><span class="calibre_13"> and </span><span class="calibre3">[</span><span class="calibre_13"> are the same. (You’ll soon learn that the shell doesn’t always run </span><span class="calibre3">[</span><span class="calibre_13">, but for now you can think of it as a separate command.)</span></p><p class="calibre_27"><span class="calibre_13"> Here’s where it’s vital to understand the exit codes as explained in </span>Section 11.4<span class="calibre_13">. Let’s look at how the previous script actually works:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The shell runs the command after the <span class="calibre3">if</span> keyword and collects the exit code of that command.</li><li value="2" class="calibre_8">If the exit code is <span class="calibre3">0</span>, the shell executes the commands that follow the <span class="calibre3">then</span> keyword, stopping when it reaches an <span class="calibre3">else</span> or <span class="calibre3">fi</span> keyword.</li><li value="3" class="calibre_8">If the exit code is not <span class="calibre3">0</span> and there’s an <span class="calibre3">else</span> clause, the shell runs the commands after the <span class="calibre3">else</span> keyword.</li><li value="4" class="calibre_8">The conditional ends at <span class="calibre3">fi</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> We’ve established that the test following </span><span class="calibre3">if</span><span class="calibre_13"> is a command, so let’s look at the semicolon (</span><span class="calibre3">;</span><span class="calibre_13">). It’s just the regular shell marker for the end of a command, and it’s there because we put the </span><span class="calibre3">then</span><span class="calibre_13"> keyword on the same line. Without the semicolon, the shell passes </span><span class="calibre3">then</span><span class="calibre_13"> as a parameter to the </span><span class="calibre3">[</span><span class="calibre_13"> command, which often results in an error that isn’t easy to track. You can avoid the semicolon by placing the </span><span class="calibre3">then</span><span class="calibre_13"> keyword on a separate line as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">if [ $1 = hi ]<br class="calibre7" />then echo 'The first argument was "hi"'<br class="calibre7" />fi</span></blockquote></blockquote><p id="calibre_link-336" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.5.1 A Workaround for Empty Parameter Lists</span></span></span></p><p class="calibre_45"><span class="calibre_13">There’s a potential problem with the conditional in the preceding example, due to a commonly overlooked scenario: </span><span class="calibre3">$1</span><span class="calibre_13"> could be empty, because the user might run the script with no parameters. If </span><a id="calibre_link-550"></a><span class="calibre3">$1</span><span class="calibre_13"> is empty, the test reads </span><span class="calibre3">[ = hi ]</span><span class="calibre_13">, and the </span><span class="calibre3">[</span><span class="calibre_13"> command will abort with an error. You can fix this by enclosing the parameter in quotes in one of two common ways:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">if [ "$1" = hi ]; then<br class="calibre7" />if [ x"$1" = x"hi" ]; then</span></blockquote></blockquote><p id="calibre_link-337" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.5.2 Other Commands for Tests</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are many possibilities for using commands other than </span><span class="calibre3">[</span><span class="calibre_13"> for tests. Here’s an example that uses </span><span class="calibre3">grep</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if grep -q daemon /etc/passwd; then echo The daemon user is in the passwd file.<br class="calibre7" />else echo There is a big problem. daemon is not in the passwd file.<br class="calibre7" />fi</span></blockquote></blockquote><p id="calibre_link-338" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.5.3 elif</span></span></span></p><p class="calibre_45"><span class="calibre_13">There is also an </span><span class="calibre3">elif</span><span class="calibre_13"> keyword that lets you string </span><span class="calibre3">if</span><span class="calibre_13"> conditionals together, as shown here:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if [ "$1" = "hi" ]; then echo 'The first argument was "hi"'<br class="calibre7" />elif [ "$2" = "bye" ]; then echo 'The second argument was "bye"'<br class="calibre7" />else echo -n 'The first argument was not "hi" and the second was not "bye"-- ' echo They were '"'$1'"' and '"'$2'"'<br class="calibre7" />fi</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Keep in mind that the control flows only through the first successful conditional, so if you run this script with the arguments </span><span class="calibre3">hi bye</span><span class="calibre_13">, you’ll only get confirmation of the </span><span class="calibre3">hi</span><span class="calibre_13"> argument.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Don’t get too carried away with </span></span><span class="calibre3">elif</span><span class="italic"><span class="calibre_13">, because the </span></span><span class="calibre3">case</span><span class="italic"><span class="calibre_13"> construct (which you’ll see in </span></span><span class="italic">Section 11.5.6</span><span class="italic"><span class="calibre_13">) is often more appropriate.</span></span></blockquote><p id="calibre_link-339" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">11.5.4 Logical Constructs</span></span></span></p><p class="calibre_45"><span class="calibre_13">There are two quick, one-line conditional constructs that you may see from time to time, using the </span><span class="calibre3">&amp;&amp;</span><span class="calibre_13"> (“and”) and </span><span class="calibre3">||</span><span class="calibre_13"> (“or”) syntax. The </span><span class="calibre3">&amp;&amp;</span><span class="calibre_13"> construct works like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="italic">command1</span></span><span class="calibre3">
</span><span class="calibre3">&amp;&amp;</span><span class="calibre3"><span class="italic"> command2</span></span></blockquote></blockquote><p id="calibre_link-551" class="calibre_30"><span class="calibre_13">Here, the shell runs </span><span class="calibre3"><span class="italic">command1</span></span><span class="calibre_13">, and if the exit code is </span><span class="calibre3">0</span><span class="calibre_13">, the shell also runs </span><span class="calibre3"><span class="italic">command2</span></span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">||</span><span class="calibre_13"> construct is similar; if the command before a </span><span class="calibre3">||</span><span class="calibre_13"> returns a nonzero exit code, the shell runs the second command.</span></p><p class="calibre_27"><span class="calibre_13"> The constructs </span><span class="calibre3">&amp;&amp;</span><span class="calibre_13"> and </span><span class="calibre3">||</span><span class="calibre_13"> are often used in </span><span class="calibre3">if</span><span class="calibre_13"> tests, and in both cases, the exit code of the last command run determines how the shell processes the conditional. In the case of the </span><span class="calibre3">&amp;&amp;</span><span class="calibre_13"> construct, if the first command fails, the shell uses its exit code for the </span><span class="calibre3">if</span><span class="calibre_13"> statement, but if the first command succeeds, the shell uses the exit code of the second command for the conditional. In the case of the </span><span class="calibre3">||</span><span class="calibre_13"> construct, the shell uses the exit code of the first command if successful, or the exit code of the second if the first is unsuccessful.</span></p><p class="calibre_27"><span class="calibre_13">For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if [ "$1" = hi ] || [ "$1" = bye ]; then echo 'The first argument was "'$1'"'<br class="calibre7" />fi</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If your conditionals include the test command (</span><span class="calibre3">[</span><span class="calibre_13">), as shown here, you can use </span><span class="calibre3">-a</span><span class="calibre_13"> and </span><span class="calibre3">-o</span><span class="calibre_13"> instead of </span><span class="calibre3">&amp;&amp;</span><span class="calibre_13"> and </span><span class="calibre3">||</span><span class="calibre_13">, for example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if [ "$1" = hi&nbsp; -o "$1" = bye ]; then echo 'The first argument was "'$1'"'<br class="calibre7" />fi</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can invert a test (that is, a logical not) by placing the </span><span class="calibre3">!</span><span class="calibre_13"> operator before a test. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />if [ ! "$1" = hi&nbsp; ]; then echo 'The first argument was not hi'<br class="calibre7" />fi</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this specific case of comparisons, you might see </span><span class="calibre3">!=</span><span class="calibre_13"> used as an alternative, but </span><span class="calibre3">!</span><span class="calibre_13"> can be used with any of the condition tests described in the next section.</span></p><p id="calibre_link-340" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.5.5 Testing Conditions</span></span></span></p><p class="calibre_45"><span class="calibre_13">You’ve seen how </span><span class="calibre3">[</span><span class="calibre_13"> works: the exit code is </span><span class="calibre3">0</span><span class="calibre_13"> if the test is true and nonzero when the test fails. You also know how to test string equality with </span><span class="calibre3">[ </span><span class="calibre3"><span class="italic">str1</span></span><span class="calibre3"> = </span><span class="calibre3"><span class="italic">str2</span></span><span class="calibre3"> ]</span><span class="calibre_13">. However, remember that shell scripts are well suited to operations on entire files because many useful </span><span class="calibre3">[</span><span class="calibre_13"> tests involve file properties. For example, the following line checks whether </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre_13"> is a regular file (not a directory or special file):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[ -f </span><span class="calibre3"><span class="italic">file</span></span><span class="calibre3"> ]</span></blockquote></blockquote><p id="calibre_link-849" class="calibre_30"><span class="calibre_13">In a script, you might see the </span><span class="calibre3">-f</span><span class="calibre_13"> test in a loop similar to this one, which tests all of the items in the current working directory (you’ll learn more about loops in </span>Section 11.6<span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">for filename in *; do if [ -f $filename ]; then ls -l $filename file $filename else echo $filename is not a regular file. fi<br class="calibre7" />done&nbsp; </span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Because the </span></span><span class="calibre3">test</span><span class="italic"><span class="calibre_13"> command is so widely used in scripts, it’s built in to many versions of the Bourne shell (including </span></span><span class="calibre3">bash</span><span class="italic"><span class="calibre_13">). This can speed up scripts because the shell doesn’t have to run a separate command for each test.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">There are dozens of test operations, all of which fall into three general categories: file tests, string tests, and arithmetic tests. The info manual contains complete online documentation, but the test(1) manual page is a fast reference. The following sections outline the main tests. (I’ve omitted some of the less common ones.)</span></p><p class="calibre_46"><span class="bold">File Tests</span></p><p class="calibre_25"><span class="calibre_13">Most file tests, like </span><span class="calibre3">-f</span><span class="calibre_13">, are called </span><span class="italic">unary</span><span class="calibre_13"> operations because they require only one argument: the file to test. For example, here are two important file tests:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">-e</span></span> Returns true if a file exists</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">-s</span></span> Returns true if a file is not empty</li></ol><p class="calibre_33"><span class="calibre_13"> Several operations inspect a file’s type, meaning that they can determine whether something is a regular file, a directory, or some kind of special device, as listed in </span><a></a><a href="#calibre_link-539"><span class="italic"><span class="calibre_4">Table 11-1</span></span></a><span class="calibre_13">. There are also a number of unary operations that check a file’s permissions, as listed in </span><a></a><a href="#calibre_link-540"><span class="italic"><span class="calibre_4">Table 11-2</span></span></a><span class="calibre_13">. (See </span>Section 2.17<span class="calibre_13"> for an overview of permissions.)</span></p><p id="calibre_link-539" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 11-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: File Type Operators</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Operator&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Tests for&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-f&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Regular file&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-d&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Directory&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-h&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Symbolic link&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-b&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Block device&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-c&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Character device&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-p&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Named pipe&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-S&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Socket&nbsp;</span></span><span class="calibre_56">
</span></td></tr></table><blockquote id="calibre_link-760" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If the </span></span><span class="calibre3">test</span><span class="italic"><span class="calibre_13"> command is used on a symbolic link, it tests the actual object being linked to, not the link itself (except for the </span></span><span class="calibre3">-h</span><span class="italic"><span class="calibre_13"> test). That is, if  </span></span><span class="calibre3">link</span><span class="italic"><span class="calibre_13"> is a symbolic link to a regular file, </span></span><span class="calibre3">[ -f link ]</span><span class="italic"><span class="calibre_13"> returns an exit code of true (</span></span><span class="calibre3">0</span><span class="italic"><span class="calibre_13">).</span></span></blockquote><p id="calibre_link-540" class="calibre_23"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 11-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: File Permissions Operators</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Operator&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Permission&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-r&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Readable&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-w&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Writable&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-x&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Executable&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-u&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Setuid&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-g&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Setgid&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-k&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;“Sticky”&nbsp;</span></span>
</td></tr></table><p class="calibre_37"><span class="calibre_13"> Finally, three </span><span class="italic">binary</span><span class="calibre_13"> operators (tests that need two files as arguments) are used in file tests, but they’re not terribly common. Consider this command, which includes </span><span class="calibre3">-nt</span><span class="calibre_13"> (“newer than”):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[ </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre3"> -nt </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre3"> ]</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This exits true if </span><span class="calibre3"><span class="italic">file1</span></span><span class="calibre_13"> has a newer modification date than </span><span class="calibre3"><span class="italic">file2</span></span><span class="calibre_13">. The </span><span class="calibre3">-ot</span><span class="calibre_13"> (“older than”) operator does the opposite. And if you need to detect identical hard links, </span><span class="calibre3">-ef</span><span class="calibre_13"> compares two files and returns true if they share inode numbers and devices.</span></p><p class="calibre_46"><span class="bold">String Tests</span></p><p class="calibre_25"><span class="calibre_13">You’ve seen the binary string operator </span><span class="calibre3">=</span><span class="calibre_13">, which returns true if its operands are equal, and the </span><span class="calibre3">!=</span><span class="calibre_13"> operator that returns true if its operands are not equal. There are two additional unary string operations:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">-z</span></span> Returns true if its argument is empty (<span class="calibre3">[ -z "" ]</span> returns <span class="calibre3">0</span>)</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">-n</span></span> Returns true if its argument is not empty (<span class="calibre3">[ -n "" ]</span> returns <span class="calibre3">1</span>)</li></ol><p class="calibre_46"><span class="bold">Arithmetic Tests</span></p><p class="calibre_25"><span class="calibre_13">Note that the equal sign (</span><span class="calibre3">=</span><span class="calibre_13">) looks for </span><span class="italic">string</span><span class="calibre_13"> equality, not </span><span class="italic">numeric</span><span class="calibre_13"> equality. Therefore, </span><span class="calibre3">[ 1 = 1 ]</span><span class="calibre_13"> returns </span><span class="calibre3">0</span><span class="calibre_13"> (true), but </span><span class="calibre3">[ 01 = 1 ]</span><span class="calibre_13"> returns false. When working with numbers, use </span><span class="calibre3">-eq</span><span class="calibre_13"> instead of the equal sign: </span><span class="calibre3">[ 01 -eq 1 ]</span><span class="calibre_13"> returns true. </span><a></a><a href="#calibre_link-541"><span class="italic"><span class="calibre_4">Table 11-3</span></span></a><span class="calibre_13"> provides the full list of numeric comparison operators.</span></p><p id="calibre_link-541" class="calibre_34"><span class="calibre3"><span class="bold"><span class="calibre_4">Table 11-3</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Arithmetic Comparison Operators</span></span></span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Operator&nbsp;</span></span><span class="bold">
</span></td><td class="calibre_54"><span class="calibre3"><span class="bold"><span class="calibre_13">&nbsp;</span></span></span><span class="calibre3"><span class="bold">Returns true when the first argument is ___________ the second&nbsp;</span></span><span class="bold">
</span></td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-eq&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;equal to&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">&nbsp;-ne</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;not equal to&nbsp;</span></span>
</td></tr><a id="calibre_link-610"></a><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-lt&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;less than&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-gt&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;greater than&nbsp;</span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-le&nbsp;</span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;less than or equal to&nbsp;</span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;</span></span><span class="calibre3">-ge&nbsp;</span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;greater than or equal to&nbsp;</span></span>
</td></tr></table><p id="calibre_link-341" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.5.6 case</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">case</span><span class="calibre_13"> keyword forms another conditional construct that is exceptionally useful for matching strings. It does not execute any test commands and therefore does not evaluate exit codes. However, it can do pattern matching. This example tells most of the story:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />case $1 in bye) echo Fine, bye. ;; hi|hello) echo Nice to see you. ;; what*) echo Whatever. ;; *) echo 'Huh?' ;;<br class="calibre7" />esac</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The shell executes this as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The script matches <span class="calibre3">$1</span> against each case value demarcated with the <span class="calibre3">)</span> character.</li><li value="2" class="calibre_8">If a case value matches <span class="calibre3">$1</span>, the shell executes the commands below the case until it encounters <span class="calibre3">;;</span>, at which point it skips to the <span class="calibre3">esac</span> keyword.</li><li value="3" class="calibre_8">The conditional ends with <span class="calibre3">esac</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> For each case value, you can match a single string (like </span><span class="calibre3">bye</span><span class="calibre_13"> in the preceding example) or multiple strings with </span><span class="calibre3">|</span><span class="calibre_13"> (</span><span class="calibre3">hi|hello</span><span class="calibre_13"> returns true if </span><span class="calibre3">$1</span><span class="calibre_13"> equals </span><span class="calibre3">hi</span><span class="calibre_13"> or </span><span class="calibre3">hello</span><span class="calibre_13">), or you can use the </span><span class="calibre3">*</span><span class="calibre_13"> or </span><span class="calibre3">?</span><span class="calibre_13"> patterns (</span><span class="calibre3">what*</span><span class="calibre_13">). To make a default case that catches all possible values other than the case values specified, use a single </span><span class="calibre3">*</span><span class="calibre_13"> as shown by the final case in the preceding example.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> End each case with a double semicolon (</span></span><span class="calibre3">;;</span><span class="italic"><span class="calibre_13">) to avoid a possible syntax error.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-342" class="calibre_42"><span class="calibre1"><span class="bold">11.6 Loops</span></span></p><p class="calibre_24"><span class="calibre_13">There are two kinds of loops in the Bourne shell: </span><span class="calibre3">for</span><span class="calibre_13"> and </span><span class="calibre3">while</span><span class="calibre_13"> loops.</span></p><p id="calibre_link-343" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.6.1 for Loops</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">for</span><span class="calibre_13"> loop (which is a “for each” loop) is the most common. Here’s an example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />for str in one two three four; do echo $str<br class="calibre7" />done</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this listing, </span><span class="calibre3">for</span><span class="calibre_13">, </span><span class="calibre3">in</span><span class="calibre_13">, </span><span class="calibre3">do</span><span class="calibre_13">, and </span><span class="calibre3">done</span><span class="calibre_13"> are all shell keywords. The shell does the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Sets the variable <span class="calibre3">str</span> to the first of the four space-delimited values following the <span class="calibre3">in</span> keyword (<span class="calibre3">one</span>).</li><li value="2" class="calibre_8">Runs the <span class="calibre3">echo</span> command between the <span class="calibre3">do</span> and <span class="calibre3">done</span>.</li><li value="3" class="calibre_8">Goes back to the <span class="calibre3">for</span> line, setting <span class="calibre3">str</span> to the next value (<span class="calibre3">two</span>), runs the commands between <span class="calibre3">do</span> and <span class="calibre3">done</span>, and repeats the process until it’s through with the values following the <span class="calibre3">in</span> keyword.</li></ol><p class="calibre_33"><span class="calibre_13">The output of this script looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">one<br class="calibre7" />two<br class="calibre7" />three<br class="calibre7" />four</span></blockquote></blockquote><p id="calibre_link-344" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.6.2 while Loops</span></span></span></p><p class="calibre_45"><span class="calibre_13">The Bourne shell’s </span><span class="calibre3">while</span><span class="calibre_13"> loop uses exit codes, like the </span><span class="calibre3">if</span><span class="calibre_13"> conditional. For example, this script does 10 iterations:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />FILE=/tmp/whiletest.$$;<br class="calibre7" />echo firstline &gt; $FILE<br class="calibre7" />while tail -10 $FILE | grep -q firstline; do # add lines to $FILE until tail -10 $FILE no longer prints "firstline" echo -n Number of lines in $FILE:' ' wc -l $FILE | awk '{print $1}' echo newline &gt;&gt; $FILE<br class="calibre7" />done<br class="calibre7" />rm -f $FILE</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, the exit code of </span><span class="calibre3">grep -q firstline</span><span class="calibre_13"> is the test. As soon as the exit code is nonzero (in this case, when the string </span><span class="calibre3">firstline</span><span class="calibre_13"> no longer appears in the last 10 lines in </span><span class="calibre3">$FILE</span><span class="calibre_13">), the loop exits.</span></p><p id="calibre_link-631" class="calibre_27"><span class="calibre_13">You can break out of a </span><span class="calibre3">while</span><span class="calibre_13"> loop with the </span><span class="calibre3">break</span><span class="calibre_13"> statement. The Bourne shell also has an </span><span class="calibre3">until</span><span class="calibre_13"> loop that works just like </span><span class="calibre3">while</span><span class="calibre_13">, except that it breaks the loop when it encounters a zero exit code rather than a nonzero exit code. This said, you shouldn’t need to use the </span><span class="calibre3">while</span><span class="calibre_13"> and </span><span class="calibre3">until</span><span class="calibre_13"> loops very often. In fact, if you find that you need to use </span><span class="calibre3">while</span><span class="calibre_13">, you should probably be using a language more appropriate to your task, such as Python or </span><span class="calibre3">awk</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-345" class="calibre_23"><span class="calibre1"><span class="bold"> 11.7 Command Substitution</span></span></p><p class="calibre_24"><span class="calibre_13">The Bourne shell can redirect a command’s standard output back to the shell’s own command line. That is, you can use a command’s output as an argument to another command, or you can store the command output in a shell variable by enclosing a command in </span><span class="calibre3">$()</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> This example stores a command’s output inside the </span><span class="calibre3">FLAGS</span><span class="calibre_13"> variable. The bold code in the second line shows the command substitution.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />FLAGS=</span><span class="calibre3"><span class="bold">$(grep ^flags /proc/cpuinfo | sed 's/.*://' | head -1)</span></span><span class="calibre3"><br class="calibre7" />echo Your processor supports:<br class="calibre7" />for f in $FLAGS; do case $f in fpu)&nbsp;&nbsp;&nbsp; MSG="floating point unit" ;; 3dnow)&nbsp; MSG="3DNOW graphics extensions" ;; mtrr)&nbsp;&nbsp; MSG="memory type range register" ;; *)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MSG="unknown" ;; esac echo $f: $MSG<br class="calibre7" />done</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This example is somewhat complicated because it demonstrates that you can use both single quotes and pipelines inside the command substitution. The result of the </span><span class="calibre3">grep</span><span class="calibre_13"> command is sent to the </span><span class="calibre3">sed</span><span class="calibre_13"> command (more about </span><span class="calibre3">sed</span><span class="calibre_13"> in </span>Section 11.10.3<span class="calibre_13">), which removes anything matching the expression </span><span class="calibre3">.*:</span><span class="calibre_13">, and the result of </span><span class="calibre3">sed</span><span class="calibre_13"> is passed to </span><span class="calibre3">head</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> It’s easy to go overboard with command substitution. For example, don’t use </span><span class="calibre3">$(ls)</span><span class="calibre_13"> in a script, because using the shell to expand </span><span class="calibre3">*</span><span class="calibre_13"> is faster. Also, if you want to invoke a command on several filenames that you get as a result of a </span><span class="calibre3">find</span><span class="calibre_13"> command, consider using a pipeline to </span><span class="calibre3">xargs</span><span class="calibre_13"> rather than command substitution, or use the </span><span class="calibre3">-exec</span><span class="calibre_13"> option (both are discussed in </span>Section 11.10.4<span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The traditional syntax for command substitution is to enclose the command in backticks (</span></span><span class="calibre3">``</span><span class="italic"><span class="calibre_13">), and you’ll see this in many shell scripts. The </span></span><span class="calibre3">$()</span><span class="italic"><span class="calibre_13"> syntax is a newer form, but it is a POSIX standard and is generally easier (for humans) to read and write.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-346" class="calibre_42"><span class="calibre1"><span class="bold">11.8 Temporary File Management</span></span></p><p class="calibre_24"><span class="calibre_13">It’s sometimes necessary to create a temporary file to collect output for use by a later command. When creating such a file, make sure that the filename is distinct enough that no other programs will accidentally write to it. Sometimes using something as simple as the shell’s PID (</span><span class="calibre3">$$</span><span class="calibre_13">) in a filename works, but when you need to be certain that there will be no conflicts, a utility such as </span><span class="calibre3">mktemp</span><span class="calibre_13"> is often a better option.</span></p><p class="calibre_27"><span class="calibre_13"> Here’s how to use the </span><span class="calibre3">mktemp</span><span class="calibre_13"> command to create temporary filenames. This script shows you the device interrupts that have occurred in the last two seconds:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />TMPFILE1=$(mktemp /tmp/im1.XXXXXX)<br class="calibre7" />TMPFILE2=$(mktemp /tmp/im2.XXXXXX)<br class="calibre7" />cat /proc/interrupts &gt; $TMPFILE1<br class="calibre7" />sleep 2<br class="calibre7" />cat /proc/interrupts &gt; $TMPFILE2<br class="calibre7" />diff $TMPFILE1 $TMPFILE2<br class="calibre7" />rm -f $TMPFILE1 $TMPFILE2</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The argument to </span><span class="calibre3">mktemp</span><span class="calibre_13"> is a template. The </span><span class="calibre3">mktemp</span><span class="calibre_13"> command converts the </span><span class="calibre3">XXXXXX</span><span class="calibre_13"> to a unique set of characters and creates an empty file with that name. Notice that this script uses variable names to store the filenames so that you only have to change one line if you want to change a filename.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Not all Unix flavors come with </span></span><span class="calibre3">mktemp</span><span class="italic"><span class="calibre_13">. If you’re having portability problems, it’s best to install the GNU coreutils package for your operating system.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> A common problem with scripts that employ temporary files is that if the script is aborted, the temporary files could be left behind. In the preceding example, pressing </span>CTRL<span class="calibre_13">-C before the second </span><span class="calibre3">cat</span><span class="calibre_13"> command leaves a temporary file in </span><span class="italic">/tmp</span><span class="calibre_13">. Avoid this if possible. Instead, use the </span><span class="calibre3">trap</span><span class="calibre_13"> command to create a signal handler to catch the signal that </span>CTRL<span class="calibre_13">-C generates and remove the temporary files, as in this handler:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />TMPFILE1=$(mktemp /tmp/im1.XXXXXX)<br class="calibre7" />TMPFILE2=$(mktemp /tmp/im2.XXXXXX)<br class="calibre7" />trap "rm -f $TMPFILE1 $TMPFILE2; exit 1" INT --</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You must use </span><span class="calibre3">exit</span><span class="calibre_13"> in the handler to explicitly end script execution, or the shell will continue running as usual after running the signal handler.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You don’t need to supply an argument to </span></span><span class="calibre3">mktemp</span><span class="italic"><span class="calibre_13">; if you don’t, the template will begin with a </span></span><span class="calibre3">/tmp/tmp.</span><span class="italic"><span class="calibre_13"> prefix.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-347" class="calibre_42"><span class="calibre1"><span class="bold">11.9 Here Documents</span></span></p><p class="calibre_24"><span class="calibre_13">Say you want to print a large section of text or feed a lot of text to another command. Rather than using several </span><span class="calibre3">echo</span><span class="calibre_13"> commands, you can use the shell’s </span><span class="italic">here document</span><span class="calibre_13"> feature, as shown in the following script:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />DATE=$(date)<br class="calibre7" />cat </span><span class="calibre3"><span class="bold">&lt;&lt;EOF</span></span><span class="calibre3"><br class="calibre7" />Date: $DATE<br class="calibre7" />The output above is from the Unix date command.<br class="calibre7" />It's not a very interesting command.</span><span class="calibre3"><span class="bold">EOF</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The items in bold control the here document. </span><span class="calibre3">&lt;&lt;EOF</span><span class="calibre_13"> tells the shell to redirect all subsequent lines to the standard input of the command that precedes </span><span class="calibre3">&lt;&lt;EOF</span><span class="calibre_13">, which in this case is </span><span class="calibre3">cat</span><span class="calibre_13">. The redirection stops as soon as the </span><span class="calibre3">EOF</span><span class="calibre_13"> marker occurs on a line by itself. The marker can actually be any string, but remember to use the same marker at the beginning and end of the here document. Also, convention dictates that the marker be in all uppercase letters.</span></p><p class="calibre_27"><span class="calibre_13"> Notice the shell variable </span><span class="calibre3">$DATE</span><span class="calibre_13"> in the here document. The shell expands shell variables inside here documents, which is especially useful when you’re printing out reports that contain many variables.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-348" class="calibre_23"><span class="calibre1"><span class="bold"> 11.10 Important Shell Script Utilities</span></span></p><p class="calibre_24"><span class="calibre_13">Several programs are particularly useful in shell scripts. Certain utilities, such as </span><span class="calibre3">basename</span><span class="calibre_13">, are really only practical when used with other programs, and therefore don’t often find a place outside shell scripts. However, others, such as </span><span class="calibre3">awk</span><span class="calibre_13">, can be quite useful on the command line, too.</span></p><p id="calibre_link-349" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.10.1  basename</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you need to strip the extension from a filename or get rid of the directories in a full pathname, use the </span><span class="calibre3">basename</span><span class="calibre_13"> command. Try these examples on the command line to see how the command works:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">basename example.html .html</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">basename /usr/local/bin/example</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In both cases, </span><span class="calibre3">basename</span><span class="calibre_13"> returns </span><span class="calibre3">example</span><span class="calibre_13">. The first command strips the </span><span class="italic">.html</span><span class="calibre_13"> suffix from </span><span class="italic">example.html</span><span class="calibre_13">, and the second removes the directories from the full pathname.</span></p><p class="calibre_27"><span class="calibre_13"> This example shows how you can use </span><span class="calibre3">basename</span><span class="calibre_13"> in a script to convert GIF image files to the PNG format:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />for file in *.gif; do # exit if there are no files&nbsp;&nbsp;&nbsp; if [ ! -f $file ]; then exit fi b=$(basename $file .gif) echo Converting $b.gif to $b.png... giftopnm $b.gif | pnmtopng &gt; $b.png<br class="calibre7" />done</span></blockquote><a id="calibre_link-574"></a></blockquote><p id="calibre_link-350" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.10.2  awk</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">awk</span><span class="calibre_13"> command is not a simple single-purpose command; it’s actually a powerful programming language. Unfortunately, </span><span class="calibre3">awk</span><span class="calibre_13"> usage is now something of a lost art, having been replaced by larger languages such as Python.</span></p><p class="calibre_27"><span class="calibre_13"> There are entire books on the subject of </span><span class="calibre3">awk</span><span class="calibre_13">, including </span><span class="italic">The AWK Programming Language </span><span class="calibre_13">by Alfred V. Aho, Brian W. Kernighan, and Peter J. Weinberger (Addison-Wesley, 1988). This said, many, many people use </span><span class="calibre3">awk</span><span class="calibre_13"> only to do one thing&mdash;to pick a single field out of an input stream like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ls -l | awk '{print $5}'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This command prints the fifth field of the </span><span class="calibre3">ls</span><span class="calibre_13"> output (the file size). The result is a list of file sizes.</span></p><p id="calibre_link-351" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.10.3  sed</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">sed</span><span class="calibre_13"> (“stream editor”) program is an automatic text editor that takes an input stream (a file or the standard input), alters it according to some expression, and prints the results to standard output. In many respects, </span><span class="calibre3">sed</span><span class="calibre_13"> is like </span><span class="calibre3">ed</span><span class="calibre_13">, the original Unix text editor. It has dozens of operations, matching tools, and addressing capabilities. As with </span><span class="calibre3">awk</span><span class="calibre_13">, entire books have been written about </span><span class="calibre3">sed</span><span class="calibre_13">, including a quick reference covering both, </span><span class="italic">sed &amp; awk Pocket Reference</span><span class="calibre_13">, 2nd edition, by Arnold Robbins (O’Reilly, 2002).</span></p><p class="calibre_27"><span class="calibre_13"> Although </span><span class="calibre3">sed</span><span class="calibre_13"> is a big program and an in-depth analysis is beyond the scope of this book, it’s easy to see how it works. In general, </span><span class="calibre3">sed</span><span class="calibre_13"> takes an address and an operation as one argument. The address is a set of lines, and the command determines what to do with the lines.</span></p><p class="calibre_27"><span class="calibre_13"> A very common task for </span><span class="calibre3">sed</span><span class="calibre_13"> is to substitute some text for a regular expression (see </span>Section 2.5.1<span class="calibre_13">), like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sed 's/</span></span><span class="calibre3"><span class="italic"><span class="bold">exp</span></span></span><span class="calibre3"><span class="bold">/</span></span><span class="calibre3"><span class="italic"><span class="bold">text</span></span></span><span class="calibre3"><span class="bold">/'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you wanted to replace the first colon in each line of </span><span class="italic">/etc/passwd</span><span class="calibre_13"> with a </span><span class="calibre3">%</span><span class="calibre_13"> and send the result to the standard output, then, you’d do it like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sed 's/:/%/' /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To substitute </span><span class="italic">all</span><span class="calibre_13"> colons in </span><span class="italic">/etc/passwd</span><span class="calibre_13">, add the </span><span class="calibre3">g</span><span class="calibre_13"> (global) modifier to the end of the operation, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sed 's</span></span><span class="calibre3"><span class="italic"><span class="bold">/:/</span></span></span><span class="calibre3"><span class="bold">%/g' /etc/passwd</span></span></blockquote></blockquote><p id="calibre_link-775" class="calibre_30"><span class="calibre_13">Here’s a command that operates on a per-line basis; it reads </span><span class="italic">/etc/passwd</span><span class="calibre_13">, deletes lines three through six, and sends the result to the standard output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sed</span></span><span class="calibre3">
</span><span class="calibre3"><span class="bold">3,6d /etc/passwd</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this example, </span><span class="calibre3">3,6</span><span class="calibre_13"> is the address (a range of lines), and </span><span class="calibre3">d</span><span class="calibre_13"> is the operation (delete). If you omit the address, </span><span class="calibre3">sed</span><span class="calibre_13"> operates on all lines in its input stream. The two most common </span><span class="calibre3">sed</span><span class="calibre_13"> operations are probably </span><span class="calibre3">s</span><span class="calibre_13"> (search and replace) and </span><span class="calibre3">d</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You can also use a regular expression as the address. This command deletes any line that matches the regular expression </span><span class="calibre3"><span class="italic">exp</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sed '/</span></span><span class="calibre3"><span class="italic"><span class="bold">exp</span></span></span><span class="calibre3"><span class="bold">/d'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In all of these examples, </span><span class="calibre3">sed</span><span class="calibre_13"> writes to the standard output, and this is by far the most common usage. With no file arguments, </span><span class="calibre3">sed</span><span class="calibre_13"> reads from the standard input, a pattern that you’ll frequently encounter in shell pipelines.</span></p><p id="calibre_link-352" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.10.4  xargs</span></span></span></p><p class="calibre_45"><span class="calibre_13">When you have to run one command on a huge number of files, the command or shell may respond that it can’t fit all of the arguments in its buffer. Use </span><span class="calibre3">xargs</span><span class="calibre_13"> to get around this problem by running a command on each filename in its standard input stream.</span></p><p class="calibre_27"><span class="calibre_13"> Many people use </span><span class="calibre3">xargs</span><span class="calibre_13"> with the </span><span class="calibre3">find</span><span class="calibre_13"> command. For example, the following script can help you verify that every file in the current directory tree that ends with </span><span class="italic">.gif</span><span class="calibre_13"> is actually a GIF image:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">find . -name '*.gif' -print | xargs file</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3">xargs</span><span class="calibre_13"> runs the </span><span class="calibre3">file</span><span class="calibre_13"> command. However, this invocation can cause errors or leave your system open to security problems, because filenames can include spaces and newlines. When writing a script, use the following form instead, which changes the </span><span class="calibre3">find</span><span class="calibre_13"> output separator and the </span><span class="calibre3">xargs</span><span class="calibre_13"> argument delimiter from a newline to a NULL character:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">find . -name '*.gif' -print0 | xargs -0 file</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre3">xargs</span><span class="calibre_13"> starts a </span><span class="italic">lot</span><span class="calibre_13"> of processes, so don’t expect great performance if you have a large list of files.</span></p><p class="calibre_27"><span class="calibre_13"> You may need to add two dashes (</span><span class="calibre3">--</span><span class="calibre_13">) to the end of your </span><span class="calibre3">xargs</span><span class="calibre_13"> command if there’s a chance that any of the target files start with a single dash (</span><span class="calibre3">-</span><span class="calibre_13">). The double dash (</span><span class="calibre3">--</span><span class="calibre_13">) tells a program that any arguments that follow are filenames, not options. However, keep in mind that not all programs support the use of a double dash.</span></p><p class="calibre_27"><span class="calibre_13"> When you’re using </span><span class="calibre3">find</span><span class="calibre_13">, there’s an alternative to </span><span class="calibre3">xargs</span><span class="calibre_13">: the </span><span class="calibre3">-exec</span><span class="calibre_13"> option. However, the syntax is somewhat tricky because you need to supply braces, </span><span class="calibre3">{}</span><span class="calibre_13">, to substitute the filename and a literal </span><span class="calibre3">;</span><span class="calibre_13"> to indicate the end of the command. Here’s how to perform the preceding task using only </span><span class="calibre3">find</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">find . -name '*.gif' -exec file {} \;</span></span></blockquote></blockquote><p id="calibre_link-353" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">11.10.5  expr</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you need to use arithmetic operations in your shell scripts, the </span><span class="calibre3">expr</span><span class="calibre_13"> command can help (and even do some string operations). For example, the command </span><span class="calibre3">expr 1 + 2</span><span class="calibre_13"> prints </span><span class="calibre3">3</span><span class="calibre_13">. (Run </span><span class="calibre3">expr --help</span><span class="calibre_13"> for a full list of operations.)</span></p><p class="calibre_27"><span class="calibre_13"> The </span><span class="calibre3">expr</span><span class="calibre_13"> command is a clumsy, slow way of doing math. If you find yourself using it frequently, you should probably be using a language like Python instead of a shell script.</span></p><p id="calibre_link-354" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">11.10.6  exec</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">exec</span><span class="calibre_13"> command is a built-in shell feature that replaces the current shell process with the program you name after </span><span class="calibre3">exec</span><span class="calibre_13">. It carries out the </span><span class="calibre3">exec()</span><span class="calibre_13"> system call described in </span>Chapter 1<span class="calibre_13">. This feature is designed for saving system resources, but remember that there’s no return; when you run </span><span class="calibre3">exec</span><span class="calibre_13"> in a shell script, the script and shell running the script are gone, replaced by the new command.</span></p><p class="calibre_27"><span class="calibre_13"> To test this in a shell window, try running </span><span class="calibre3">exec cat</span><span class="calibre_13">. After you press </span>CTRL<span class="calibre_13">-D or </span>CTRL<span class="calibre_13">-C to terminate the </span><span class="calibre3">cat</span><span class="calibre_13"> program, your window should disappear because its child process no longer exists.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-355" class="calibre_23"><span class="calibre1"><span class="bold"> 11.11 Subshells</span></span></p><p class="calibre_24"><span class="calibre_13">Say you need to alter the environment in a shell slightly but don’t want a permanent change. You can change and restore a part of the environment (such as the path or working directory) using shell variables, but that’s a clumsy way to go about things. The simpler option is to use a </span><span class="italic">subshell</span><span class="calibre_13">, an entirely new shell process that you can create just to run a command or two. The new shell has a copy of the original shell’s environment, and when the new shell exits, any changes you made to its shell environment disappear, leaving the initial shell to run as normal.</span></p><p class="calibre_27"><span class="calibre_13"> To use a subshell, put the commands to be executed by the subshell in parentheses. For example, the following line executes the command </span><span class="calibre3">uglyprogram</span><span class="calibre_13"> while in </span><span class="italic">uglydir</span><span class="calibre_13"> and leaves the original shell intact:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">(cd uglydir; uglyprogram)</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This example shows how to add a component to the path that might cause problems as a permanent change:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">(PATH=/usr/confusing:$PATH; uglyprogram)</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Using a subshell to make a single-use alteration to an environment variable is such a common task that there’s even a built-in syntax that avoids the subshell:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">PATH=/usr/confusing:$PATH uglyprogram</span></span></blockquote></blockquote><p id="calibre_link-853" class="calibre_30"><span class="calibre_13">Pipes and background processes work with subshells, too. The following example uses </span><span class="calibre3">tar</span><span class="calibre_13"> to archive the entire directory tree within </span><span class="italic">orig</span><span class="calibre_13"> and then unpacks the archive into the new directory </span><span class="italic">target</span><span class="calibre_13">, which effectively duplicates the files and folders in </span><span class="italic">orig</span><span class="calibre_13"> (this is useful because it preserves ownership and permissions, and it’s generally faster than using a command such as </span><span class="calibre3">cp -r</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">tar cf - </span></span><span class="calibre3"><span class="italic"><span class="bold">orig</span></span></span><span class="calibre3"><span class="bold"> | (cd </span></span><span class="calibre3"><span class="italic"><span class="bold">target</span></span></span><span class="calibre3"><span class="bold">; tar xvf -)</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Double-check this sort of command before you run it to make sure that the </span></span>target<span class="italic"><span class="calibre_13"> directory exists and is completely separate from the </span></span>orig<span class="italic"><span class="calibre_13"> directory (in a script, you can check for this with </span></span><span class="calibre3">[ -d orig -a ! orig -ef target ]</span><span class="italic"><span class="calibre_13">).</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-356" class="calibre_42"><span class="calibre1"><span class="bold"> 11.12 Including Other Files in Scripts</span></span></p><p class="calibre_24"><span class="calibre_13">If you need to include code from another file in your shell script, use the dot (</span><span class="calibre3">.</span><span class="calibre_13">) operator. For example, this runs the commands in the file </span><span class="italic">config.sh</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">. config.sh</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This method of inclusion is also called </span><span class="italic">sourcing</span><span class="calibre_13"> a file and is useful for reading variables (for example, in a shared configuration file) and other kinds of definitions. This is not the same as executing another script; when you run a script (as a command), it starts in a new shell, and you can’t get anything back other than the output and the exit code.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-357" class="calibre_23"><span class="calibre1"><span class="bold"> 11.13 Reading User Input</span></span></p><p class="calibre_24"><span class="calibre_13">The </span><span class="calibre3">read</span><span class="calibre_13"> command reads a line of text from the standard input and stores the text in a variable. For example, the following command stores the input in </span><span class="calibre3">$</span><span class="calibre3"><span class="italic">var</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">read </span></span><span class="calibre3"><span class="italic"><span class="bold">var</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This built-in shell command can be useful in conjunction with other shell features not mentioned in this book. With </span><span class="calibre3">read</span><span class="calibre_13">, you can create simple interactions, such as prompting a user to enter input instead of requiring them to list everything on the command line, and build “Are you sure?” confirmations preceding dangerous operations.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-358" class="calibre_23"><span class="calibre1"><span class="bold"> 11.14 When (Not) to Use Shell Scripts</span></span></p><p class="calibre_24"><span class="calibre_13">The shell is so feature-rich that it’s difficult to condense its important elements into a single chapter. If you’re interested in what else the shell can do, have a look at some of the books on shell programming, such as </span><span class="italic">Unix Shell </span><a id="calibre_link-862"></a><span class="calibre_13">Programming, 3rd edition, by Stephen G. Kochan and Patrick Wood (SAMS Publishing, 2003), or the shell script discussion in </span><span class="italic">The UNIX Programming Environment</span><span class="calibre_13"> by Brian W. Kernighan and Rob Pike (Prentice Hall, 1984).</span></p><p class="calibre_27"><span class="calibre_13"> However, at a certain point (especially when you start to overuse the </span><span class="calibre3">read</span><span class="calibre_13"> built-in), you have to ask yourself if you’re still using the right tool for the job. Remember what shell scripts do best: manipulate simple files and commands. As stated earlier, if you find yourself writing something that looks convoluted, especially if it involves complicated string or arithmetic operations, don’t be afraid to look to a scripting language like Python, Perl, or </span><span class="calibre3">awk</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-359" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-763" class="calibre_10"><span class="calibre4"><span class="bold">12</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">NETWORK FILE TRANSFER AND SHARING</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter surveys options for distributing and sharing files between machines on a network. We’ll start by looking at some ways to copy files other than the </span></span>scp<span class="calibre1"><span class="calibre_13"> and </span></span>sftp<span class="calibre1"><span class="calibre_13"> utilities that you’ve already seen. Then we’ll discuss true file sharing, where you attach a directory on one machine to another machine.</span></span></p><p id="calibre_link-764" class="calibre_33"><span class="calibre_13">Because there are so many ways to distribute and share files, here’s a list of scenarios with corresponding solutions:</span></p><table border="1" valign="top" class="calibre_52"><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Make a file or directory from your Linux machine temporarily available to other machines.&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Python SimpleHTTPServer (</span></span><span class="calibre3">Section 12.1&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Distribute (copy) files across machines, particularly on a regular basis.&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; rsync (</span></span><span class="calibre3">Section 12.2&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Regularly share the files on your Linux machine to Windows machines.&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Samba (</span></span><span class="calibre3">Section 12.4&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Mount Windows shares on your Linux machine.&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; CIFS (</span></span><span class="calibre3">Section 12.4&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Implement small-scale sharing between Linux machines with minimal setup.&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; SSHFS (</span></span><span class="calibre3">Section 12.5&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span><span class="calibre_56">
</span></td></tr><tr valign="top" class="calibre_53"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Mount larger filesystems from an NAS or other server on your trusted local network.&nbsp;</span></span>
</td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; NFS (</span></span><span class="calibre3">Section 12.6&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span>
</td></tr><tr valign="top" class="calibre_55"><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp;Mount cloud storage to your Linux machine.&nbsp;</span></span><span class="calibre_56">
</span></td><td class="calibre_54"><span class="calibre3"><span class="calibre_13">&nbsp; Various FUSE-based filesystems (</span></span><span class="calibre3">Section 12.7&nbsp;</span><span class="calibre3"><span class="calibre_13">) </span></span><span class="calibre_56">
</span></td></tr></table><p class="calibre_27"><span class="calibre_13">Notice that there’s nothing here about large-scale sharing between multiple locations with many users. Though not impossible, such a solution generally requires a fair amount of work, and is not within the scope of this book. We’ll end the chapter by discussing why this is the case.</span></p><p class="calibre_27"><span class="calibre_13"> Unlike many other chapters in this book, the last part of this chapter is not advanced material. In fact, the sections that you might get the most value from are the most “theoretical” ones. Sections </span>12.3<span class="calibre_13"> and </span>12.8<span class="calibre_13"> will help you understand </span><span class="italic">why</span><span class="calibre_13"> there are so many options listed here in the first place.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-360" class="calibre_23"><span class="calibre1"><span class="bold"> 12.1 Quick Copy</span></span></p><p class="calibre_24"><span class="calibre_13">Let’s say you want to copy a file (or files) from your Linux machine to another one on your personal network, and you don’t care about copying it back or anything fancy&mdash;you just want to get your files there quickly. There’s a convenient way to do this with Python. Just go to the directory containing the file(s) and run:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">python -m SimpleHTTPServer</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This starts a basic web server that makes the current directory available to any browser on the network. By default, it runs on port 8000, so if the machine you run this on is at address 10.1.2.4, point your browser on the destination system to </span><span class="italic">http://10.1.2.4:8000</span><span class="calibre_13"> and you’ll be able to grab what you need.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> This method assumes that your local network is secure. Don’t do this on a public network or any other network environment that you do not trust.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-361" class="calibre_42"><span class="calibre1"><span class="bold">12.2 rsync</span></span></p><p class="calibre_24"><span class="calibre_13">When you want to start copying more than just a file or two, you can turn to tools that require server support on the destination. For example, you can copy an entire directory structure to another place with </span><span class="calibre3">scp -r</span><span class="calibre_13">, provided that the remote destination has SSH and SCP server support (this is available for Windows and macOS). We’ve already seen this option in </span>Chapter 10<span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">scp -r </span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">user</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">remote_host[</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir]</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This method gets the job done but is not very flexible. In particular, after the transfer completes, the remote host may not have an exact copy of the directory. If </span><span class="calibre3"><span class="italic">directory</span></span><span class="calibre_13"> already exists on the remote machine and contains some extraneous files, those files persist after the transfer.</span></p><p class="calibre_27"><span class="calibre_13"> If you expect to do this sort of thing regularly (and especially if you plan to automate the process), you should use a dedicated synchronizer system that can also perform analysis and verification. On Linux, </span><span class="calibre3">rsync</span><span class="calibre_13"> is the standard synchronizer, offering good performance and many useful ways to perform transfers. In this section we’ll cover some of the essential </span><span class="calibre3">rsync</span><span class="calibre_13"> operation modes and look at some of its peculiarities.</span></p><p id="calibre_link-362" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.2.1  Getting Started with rsync</span></span></span></p><p class="calibre_45"><span class="calibre_13">To get </span><span class="calibre3">rsync</span><span class="calibre_13"> working between two hosts, you must install the </span><span class="calibre3">rsync</span><span class="calibre_13"> program on both the source and destination, and you’ll need a way to access one machine from the other. The easiest way to transfer files is to use a remote shell account, and let’s assume that you want to transfer files using SSH access. However, remember that </span><span class="calibre3">rsync</span><span class="calibre_13"> can be handy even for copying files and directories between locations on a single machine, such as from one filesystem to another.</span></p><p class="calibre_27"><span class="calibre_13"> On the surface, the </span><span class="calibre3">rsync</span><span class="calibre_13"> command is not much different from </span><span class="calibre3">scp</span><span class="calibre_13">. In fact, you can run </span><span class="calibre3">rsync</span><span class="calibre_13"> with the same arguments. For example, to copy a group of files to your home directory on </span><span class="italic">host</span><span class="calibre_13">, enter:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync </span></span><span class="calibre3"><span class="italic"><span class="bold">file1</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">file2</span></span></span><span class="calibre3"><span class="bold"> ... </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> On any contemporary system, </span><span class="calibre3">rsync</span><span class="calibre_13"> assumes that you’re using SSH to connect to the remote host.</span></p><p class="calibre_27"><span class="calibre_13">Beware of this error message:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">rsync not found<br class="calibre7" />rsync: connection unexpectedly closed (0 bytes read so far)<br class="calibre7" />rsync error: error in rsync protocol data stream (code 12) at io.c(165)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This notice says that your remote shell can’t find </span><span class="calibre3">rsync</span><span class="calibre_13"> on its system. If </span><span class="calibre3">rsync</span><span class="calibre_13"> is on the remote system but isn’t in the command path for the user on that system, use </span><span class="calibre3">--rsync-path=</span><span class="calibre3"><span class="italic">path</span></span><span class="calibre_13"> to manually specify its location.</span></p><p id="calibre_link-855" class="calibre_27"><span class="calibre_13">If the username is different on the two hosts, add </span><span class="calibre3"><span class="italic">user@</span></span><span class="calibre_13"> to the remote hostname in the command arguments, where </span><span class="calibre3"><span class="italic">user</span></span><span class="calibre_13"> is your username on </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync </span></span><span class="calibre3"><span class="italic"><span class="bold">file1 file2</span></span></span><span class="calibre3"><span class="bold"> ... </span></span><span class="calibre3"><span class="italic"><span class="bold">user</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Unless you supply extra options, </span><span class="calibre3">rsync</span><span class="calibre_13"> copies only files. In fact, if you specify just the options described so far and you supply a directory </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> as an argument, you’ll see this message:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">skipping directory </span><span class="calibre3"><span class="italic">dir</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To transfer entire directory hierarchies&mdash;complete with symbolic links, permissions, modes, and devices&mdash;use the </span><span class="calibre3">-a</span><span class="calibre_13"> option. Furthermore, if you want to copy to a directory other than your home directory on the remote host, place its name after the remote host, like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Copying directories can be tricky, so if you’re not exactly sure what will happen when you transfer the files, use the </span><span class="calibre3">-nv</span><span class="calibre_13"> option combination. The </span><span class="calibre3">-n</span><span class="calibre_13"> option tells </span><span class="calibre3">rsync</span><span class="calibre_13"> to operate in “dry run” mode&mdash;that is, to run a trial without actually copying any files. The </span><span class="calibre3">-v</span><span class="calibre_13"> option is for verbose mode, which shows details about the transfer and the files involved:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -nva </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">building file list ... done<br class="calibre7" />ml/nftrans/nftrans.html<br class="calibre7" />[more files]<br class="calibre7" />wrote 2183 bytes read 24 bytes 401.27 bytes/sec</span></blockquote></blockquote><p id="calibre_link-363" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">12.2.2  Making Exact Copies of a Directory Structure</span></span></span></p><p class="calibre_45"><span class="calibre_13">By default, </span><span class="calibre3">rsync</span><span class="calibre_13"> copies files and directories without considering the previous contents of the destination directory. For example, if you transferred directory </span><span class="italic">d</span><span class="calibre_13"> containing the files </span><span class="italic">a</span><span class="calibre_13"> and </span><span class="italic">b</span><span class="calibre_13"> to a machine that already had a file named </span><span class="italic">d/c</span><span class="calibre_13">, the destination would contain </span><span class="italic">d/a</span><span class="calibre_13">, </span><span class="italic">d/b</span><span class="calibre_13">, and </span><span class="italic">d/c</span><span class="calibre_13"> after the </span><span class="calibre3">rsync</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> To make an exact replica of the source directory, you must delete files in the destination directory that do not exist in the source directory, such as </span><span class="italic">d/c</span><span class="calibre_13"> in this example. Use the </span><span class="calibre3">--delete</span><span class="calibre_13"> option to do that:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a --delete </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> This operation can be dangerous, so take the time to inspect the destination directory to see if there’s anything that you’ll inadvertently delete. Remember, if you’re not certain about your transfer, use the </span></span><span class="calibre3">-nv</span><span class="italic"><span class="calibre_13"> option to perform a dry run so that you’ll know exactly when </span></span><span class="calibre3">rsync</span><span class="italic"><span class="calibre_13"> wants to delete a file.</span></span></blockquote><p id="calibre_link-364" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">12.2.3  Using the Trailing Slash</span></span></span></p><p class="calibre_45"><span class="calibre_13">Be particularly careful when specifying a directory as the source in an </span><span class="calibre3">rsync</span><span class="calibre_13"> command line. Consider the basic command that we’ve been working with so far:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Upon completion, you’ll have the directory </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> inside </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> on </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13">. </span><a></a><a href="#calibre_link-542"><span class="italic"><span class="calibre_4">Figure 12-1</span></span></a><span class="calibre_13"> shows an example of how </span><span class="calibre3">rsync</span><span class="calibre_13"> normally handles a directory with files named </span><span class="italic">a</span><span class="calibre_13"> and </span><span class="italic">b</span><span class="calibre_13">.</span></p><p class="calibre_34"><img src="images/000013.jpg" class="calibre_101" />
</p><p id="calibre_link-542" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 12-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Normal </span></span></span><span class="calibre3">rsync</span><span class="calibre3"><span class="italic"><span class="calibre_13"> copy</span></span></span></p><p class="calibre_37"><span class="calibre_13"> However, adding a slash (</span><span class="calibre3">/</span><span class="calibre_13">) to the source name significantly changes the behavior:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">/ </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3">rsync</span><span class="calibre_13"> copies everything </span><span class="italic">inside</span><span class="calibre_13">
</span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> to </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> on </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13"> without actually creating </span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> on the destination host. Therefore, you can think of a transfer of </span><span class="calibre3"><span class="italic">dir/</span></span><span class="calibre_13"> as an operation similar to </span><span class="calibre3">cp </span><span class="calibre3"><span class="italic">dir/* dest_dir</span></span><span class="calibre_13"> on the local filesystem.</span></p><p class="calibre_27"><span class="calibre_13"> For example, say you have a directory </span><span class="italic">dir</span><span class="calibre_13"> containing the files </span><span class="italic">a</span><span class="calibre_13"> and </span><span class="italic">b</span><span class="calibre_13"> (</span><span class="italic">dir/a</span><span class="calibre_13"> and </span><span class="italic">dir/b</span><span class="calibre_13">). You run the trailing-slash version of the command to transfer them to the </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> directory on </span><span class="calibre3"><span class="italic">host</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a dir/ </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> When the transfer completes, </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> contains copies of </span><span class="italic">a</span><span class="calibre_13"> and </span><span class="italic">b</span><span class="calibre_13"> but </span><span class="italic">not</span><span class="calibre_13">
</span><span class="italic">dir</span><span class="calibre_13">. If, however, you had omitted the trailing </span><span class="calibre3">/ </span><span class="calibre_13">on </span><span class="italic">dir</span><span class="calibre_13">, </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> would have gotten a copy of </span><span class="italic">dir</span><span class="calibre_13"> with </span><span class="italic">a</span><span class="calibre_13"> and </span><span class="italic">b</span><span class="calibre_13"> inside. Then, as a result of the transfer, you’d have files and directories named </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="italic">/dir/a</span><span class="calibre_13"> and </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="italic">/dir/b</span><span class="calibre_13"> on the remote host. </span><a></a><a href="#calibre_link-543"><span class="italic"><span class="calibre_4">Figure 12-2</span></span></a><span class="calibre_13"> illustrates how </span><span class="calibre3">rsync</span><span class="calibre_13"> handles the directory structure from </span><a href="#calibre_link-542"><span class="italic"><span class="calibre_4">Figure 12-1</span></span></a><span class="calibre_13"> when using a trailing slash.</span></p><p class="calibre_27"><span class="calibre_13"> When transferring files and directories to a remote host, accidentally adding a </span><span class="calibre3">/</span><span class="calibre_13"> after a path would normally be nothing more than a nuisance; you could go to the remote host, add the </span><span class="italic">dir</span><span class="calibre_13"> directory, and put all of the transferred items back in </span><a id="calibre_link-856"></a><span class="italic">dir</span><span class="calibre_13">. Unfortunately, there’s a greater potential for disaster when you combine the trailing </span><span class="calibre3">/</span><span class="calibre_13"> with the </span><span class="calibre3">--delete</span><span class="calibre_13"> option; be extremely careful because you can easily remove unrelated files this way.</span></p><p class="calibre_34"><img src="images/000040.jpg" class="calibre_102" />
</p><p id="calibre_link-543" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 12-2</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Effect of trailing slash in </span></span></span><span class="calibre3">rsync</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;WARNING&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Because of this potential, be wary of your shell’s automatic filename completion feature. Many shells tack trailing slashes onto completed directory names after you press </span></span><span class="italic">TAB</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p id="calibre_link-365" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">12.2.4  Excluding Files and Directories</span></span></span></p><p class="calibre_45"><span class="calibre_13">One important feature of </span><span class="calibre3">rsync</span><span class="calibre_13"> is its ability to exclude files and directories from a transfer operation. For example, say you’d like to transfer a local directory called </span><span class="italic">src</span><span class="calibre_13"> to </span><span class="italic">host</span><span class="calibre_13">, but you want to exclude anything named </span><span class="italic">.git</span><span class="calibre_13">. You can do it like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a --exclude=.git src </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Note that this command excludes </span><span class="italic">all</span><span class="calibre_13"> files and directories named </span><span class="italic">.git</span><span class="calibre_13"> because </span><span class="calibre3">--exclude</span><span class="calibre_13"> takes a pattern, not an absolute filename. To exclude one specific item, specify an absolute path that starts with </span><span class="italic">/</span><span class="calibre_13">, as shown here:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a --exclude=/src/.git src </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The first </span></span><span class="calibre3">/</span><span class="italic"><span class="calibre_13"> in </span></span><span class="calibre3">/src/.git</span><span class="italic"><span class="calibre_13"> in this command is </span></span>not<span class="italic"><span class="calibre_13"> the root directory of your system but rather the base directory of the transfer.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Here are a few more tips on how to exclude patterns:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> You can have as many <span class="calibre3">--exclude</span> parameters as you like.</li><li value="2" class="calibre_8"> If you use the same patterns repeatedly, place them in a plaintext file (one pattern per line) and use <span class="calibre3">--exclude-from=</span><span class="calibre3"><span class="italic">file</span></span>.</li><li value="3" class="calibre_8"> To exclude directories named <span class="italic">item</span> but include files with this name, use a trailing slash: <span class="calibre3">--exclude=</span><span class="calibre3"><span class="italic">item</span></span><span class="calibre3">/</span>.</li><li value="4" class="calibre_8"> The exclude pattern is based on a full file or directory name component and may contain simple globs (wildcards). For example, <span class="calibre3">t*s</span> matches <span class="italic">this</span>, but it does not match <span class="italic">ethers</span>.</li><li value="5" class="calibre_8"> If you exclude a directory or filename but find that your pattern is too restrictive, use <span class="calibre3">--include</span> to specifically include another file or directory.</li></ul><p id="calibre_link-366" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.2.5  Checking Transfers, Adding Safeguards, and Using Verbose Mode</span></span></span></p><p class="calibre_45"><span class="calibre_13">To speed operation, </span><span class="calibre3">rsync</span><span class="calibre_13"> uses a quick check to determine whether any files on the transfer source are already on the destination. The check uses a combination of the file size and its last-modified date. The first time you transfer an entire directory hierarchy to a remote host, </span><span class="calibre3">rsync</span><span class="calibre_13"> sees that none of the files already exist at the destination, and it transfers everything. Testing your transfer with </span><span class="calibre3">rsync -n</span><span class="calibre_13"> verifies this for you.</span></p><p class="calibre_27"><span class="calibre_13"> After running </span><span class="calibre3">rsync</span><span class="calibre_13"> once, run it again using </span><span class="calibre3">rsync -v</span><span class="calibre_13">. This time you should see that no files show up in the transfer list because the file set exists on both ends, with the same modification dates.</span></p><p class="calibre_27"><span class="calibre_13"> When the files on the source side are not identical to the files on the destination side, </span><span class="calibre3">rsync</span><span class="calibre_13"> transfers the source files and overwrites any files that exist on the remote side. The default behavior may be inadequate, though, because you may need additional reassurance that files are indeed the same before skipping over them in transfers, or you might want to add some extra safeguards. Here are some options that come in handy:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">--checksum</span></span><span class="bold"> (abbreviation: </span><span class="calibre3"><span class="bold">-c</span></span><span class="bold">)</span> Computes checksums (mostly unique signatures) of the files to see if they’re the same. This option consumes a small amount of I/O and CPU resources during transfers, but if you’re dealing with sensitive data or files that often have uniform sizes, this is a must.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">--ignore-existing</span></span> Doesn’t clobber files already on the target side.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">--backup</span></span><span class="bold"> (abbreviation: </span><span class="calibre3"><span class="bold">-b</span></span><span class="bold">)</span> Doesn’t clobber files already on the target but rather renames these existing files by adding a <span class="calibre3">~</span> suffix to their names before transferring the new files.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">--suffix=s</span></span> Changes the suffix used with <span class="calibre3">--backup</span> from <span class="calibre3">~</span> to <span class="calibre3"><span class="italic">s</span></span>.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">--update</span></span><span class="bold"> (abbreviation: </span><span class="calibre3"><span class="bold">-u</span></span><span class="bold">)</span> Doesn’t clobber any file on the target that has a later date than the corresponding file on the source.</li></ol><p class="calibre_33"><span class="calibre_13"> With no special options, </span><span class="calibre3">rsync</span><span class="calibre_13"> operates quietly, producing output only when there’s a problem. However, you can use </span><span class="calibre3">rsync -v</span><span class="calibre_13"> for verbose mode or </span><span class="calibre3">rsync -vv</span><span class="calibre_13"> for even more details. (You can tack on as many </span><span class="calibre3">v</span><span class="calibre_13"> options as you like, but two is probably more than you need.) For a comprehensive summary after the transfer, use </span><span class="calibre3">rsync --stats</span><span class="calibre_13">.</span></p><p id="calibre_link-367" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.2.6  Compressing Data</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many users like the </span><span class="calibre3">-z</span><span class="calibre_13"> option in conjunction with </span><span class="calibre3">-a</span><span class="calibre_13"> to compress the data before transmission:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -az </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Compression can improve performance in certain situations, such as when you’re uploading a large amount of data across a slow connection (like a slow upstream link) or when the latency between the two hosts is high. However, across a fast local area network, the two endpoint machines can be constrained by the CPU time that it takes to compress and decompress data, so uncompressed transfer may be faster.</span><a id="calibre_link-759"></a></p><p id="calibre_link-368" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.2.7  Limiting Bandwidth</span></span></span></p><p class="calibre_45"><span class="calibre_13">It’s easy to clog the uplink of internet connections when you’re uploading a large amount of data to a remote host. Even though you won’t be using your (normally large) downlink capacity during such a transfer, your connection will still seem quite slow if you let </span><span class="calibre3">rsync</span><span class="calibre_13"> go as fast as it can, because outgoing TCP packets such as HTTP requests will have to compete with your transfers for bandwidth on your uplink.</span></p><p class="calibre_27"><span class="calibre_13"> To get around this, use </span><span class="calibre3">--bwlimit</span><span class="calibre_13"> to give your uplink a little breathing room. For example, to limit the bandwidth to 100,000Kbps, you might do something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync --bwlimit=100000 -a </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><p id="calibre_link-369" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">12.2.8  Transferring Files to Your Computer</span></span></span></p><p class="calibre_45"><span class="calibre_13">The </span><span class="calibre3">rsync</span><span class="calibre_13"> command isn’t just for copying files from your local machine to a remote host. You can also transfer files from a remote machine to your local host by placing the remote host and remote source path as the first argument on the command line. For example, to transfer </span><span class="calibre3"><span class="italic">src_dir</span></span><span class="calibre_13"> on the remote system to </span><span class="calibre3"><span class="italic">dest_dir</span></span><span class="calibre_13"> on the local host, run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">rsync -a </span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">src_dir</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">dest_dir</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> As mentioned before, you can use </span></span><span class="calibre3">rsync</span><span class="italic"><span class="calibre_13"> to duplicate directories on your local machine; just omit </span></span><span class="calibre3">host:</span><span class="italic"><span class="calibre_13"> on both arguments.</span></span></blockquote><p id="calibre_link-370" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">12.2.9  Further rsync Topics</span></span></span></p><p class="calibre_45"><span class="calibre_13">Whenever you need to copy numerous files, </span><span class="calibre3">rsync</span><span class="calibre_13"> should be one of the first utilities that comes to mind. Running </span><span class="calibre3">rsync</span><span class="calibre_13"> in batch mode is particularly useful for copying the same set of files to multiple hosts, because it speeds up long transfers and makes it possible to resume when interrupted.</span></p><p class="calibre_27"><span class="calibre_13"> You’ll also find </span><span class="calibre3">rsync</span><span class="calibre_13"> useful for making backups. For example, you can attach internet storage, such as Amazon’s S3, to your Linux system and then use </span><span class="calibre3">rsync --delete</span><span class="calibre_13"> to periodically synchronize a filesystem with the network storage to implement a very effective backup system.</span></p><p class="calibre_27"><span class="calibre_13"> There are many more command-line options than those described here. For a rough overview, run </span><span class="calibre3">rsync --help</span><span class="calibre_13">. You’ll find more detailed information in the rsync(1) manual page as well as at the </span><span class="calibre3">rsync</span><span class="calibre_13"> home page (</span><a href="https://rsync.samba.org/"><span class="italic"><span class="calibre_4">https://rsync.samba.org/</span></span></a><span class="calibre_13">).</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-761" class="calibre_23"><span class="calibre1"><span class="bold">12.3 Introduction to File Sharing</span></span></p><p class="calibre_24"><span class="calibre_13">Your Linux machine probably doesn’t live alone on your network, and when you have multiple machines on a network, there’s nearly always a reason to share files among them. For the remainder of this chapter, we’ll first look at file sharing between Windows and macOS machines, and you’ll learn more about how Linux adapts to interacting with completely foreign environments. For the purpose of sharing files between Linux machines or accessing files from a Network Area Storage (NAS) device, we’ll wrap up by talking about using SSHFS and the Network File System (NFS) as a client.</span></p><p id="calibre_link-371" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.3.1  File Sharing Usage and Performance</span></span></span></p><p class="calibre_45"><span class="calibre_13">One thing you need to ask yourself when working with any kind of file sharing system is why you’re doing it in the first place. In traditional Unix-based networks, there were two major reasons: convenience and lack of local storage. One user could log in to one of several machines on a network, each with access to the user’s home directory. It was far more economical to concentrate storage on a small number of centralized servers than to buy and maintain a lot of local storage for every machine on the network.</span></p><p class="calibre_27"><span class="calibre_13">This model’s advantages are overshadowed by one major disadvantage that has remained constant over the years: network storage performance is often poor compared to local storage. Some kinds of data access are okay; for example, contemporary hardware and networks have no problems streaming video and audio data from a server to a media player in part because the data access pattern is very predictable. A server sending the data from a large file or stream can pre-load and buffer the data efficiently, because it knows that the client will likely access data sequentially.</span></p><p class="calibre_27"><span class="calibre_13">However, if you’re doing more complex manipulation or accessing many different files at once, you’ll find your CPU waiting on the network more often than not. Latency is one of the primary culprits. This is the time it takes to receive data from any random (arbitrary) network file access. Before sending any data to the client, the server must accept and decipher the request, and then locate and load the data. The first steps are often the slowest, and are done for almost every new file access.</span></p><p class="calibre_27"><span class="calibre_13">The moral of the story is that when you start thinking about network file sharing, ask yourself why you’re doing it. If it’s for large amounts of data not requiring frequent random access, you likely won’t have a problem. But if, for example, you’re editing video or developing a software system of any substantial size, you’ll want to keep all of your files on local storage.</span></p><p id="calibre_link-372" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.3.2  File Sharing Security</span></span></span></p><p class="calibre_45"><span class="calibre_13">Traditionally, security in file sharing protocols has not been treated as a high priority. This has consequences for how and where you want to implement file sharing. If you have any reason to doubt the security of the network(s) between the machines sharing files, you’ll want to consider both authorization/authentication and encryption in your configuration. Good authorization and authentication means that only parties with the correct credentials have access to files (and that the server is who it claims to be), and encryption ensures that no one will be able steal file data as it transits to its destination.</span><a id="calibre_link-858"></a></p><p class="calibre_27"><span class="calibre_13">The file sharing options that are the easiest to configure are typically the least secure, and unfortunately, there are no standardized ways to secure these types of access. However, if you’re willing to put in the work of connecting the correct pieces, tools such as stunnel, IPSec, and VPNs can secure the layers below basic file sharing protocols.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-373" class="calibre_23"><span class="calibre1"><span class="bold"> 12.4 Sharing Files with Samba</span></span></p><p class="calibre_24"><span class="calibre_13">If you have machines running Windows, you’ll probably want to permit access to your Linux system’s files and printers from those Windows machines using the standard Windows network protocol, </span><span class="italic">Server Message Block (SMB)</span><span class="calibre_13">. macOS supports SMB file sharing too, but you can also use SSHFS, described in </span>Section 12.5<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> The standard file sharing software suite for Unix is called </span><span class="italic">Samba</span><span class="calibre_13">. Not only does Samba allow your network’s Windows computers to get to your Linux system, but it also works the other way around: you can print and access files on Windows servers from your Linux machine via its Samba client software.</span></p><p class="calibre_27"><span class="calibre_13">To set up a Samba server, do the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Create an <span class="italic">smb.conf</span> file.</li><li value="2" class="calibre_8">Add file sharing sections to <span class="italic">smb.conf</span>.</li><li value="3" class="calibre_8">Add printer sharing sections to <span class="italic">smb.conf</span>.</li><li value="4" class="calibre_8">Start the Samba daemons <span class="calibre3">nmbd</span> and <span class="calibre3">smbd</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> When you install Samba from a distribution package, your system should perform these steps using some reasonable defaults for the server. However, it probably won’t be able to determine which particular </span><span class="italic">shares</span><span class="calibre_13"> (resources) on your Linux machine you want to offer to clients.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The discussion of Samba in this chapter is not intended to be comprehensive; it’s limited to getting Windows machines on a single subnet to see a standalone Linux machine through the Windows Network Places browser. There are countless ways to configure Samba, because there are many possibilities for access control and network topology. For the gory details on how to configure a large-scale server, see </span></span>Using Samba<span class="italic"><span class="calibre_13">, 3rd edition, by Gerald Carter, Jay Ts, and Robert Eckstein (O’Reilly, 2007), which is a much more extensive guide, and visit the Samba website (</span></span><a href="https://samba.org/"><span class="italic"><span class="calibre_4">https://samba.org/</span></span></a><span class="italic"><span class="calibre_13">).</span></span></blockquote><p id="calibre_link-374" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">12.4.1  Server Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">The central Samba configuration file is </span><span class="italic">smb.conf</span><span class="calibre_13">, which most distributions place in an </span><span class="italic">etc</span><span class="calibre_13"> directory, such as </span><span class="italic">/etc/samba</span><span class="calibre_13">. However, you might have to hunt around to find this file, as it could also be in a </span><span class="italic">lib</span><span class="calibre_13"> directory, such as </span><span class="italic">/usr/local/samba/lib</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">The </span><span class="italic">smb.conf</span><span class="calibre_13"> file format is similar to the XDG style that you’ve seen elsewhere (such as the systemd configuration format) and breaks down into several sections denoted with square brackets such as </span><span class="calibre3">[global]</span><span class="calibre_13"> and </span><span class="calibre3">[printers]</span><span class="calibre_13">. The </span><span class="calibre3">[global]</span><span class="calibre_13"> section in </span><span class="italic">smb.conf</span><span class="calibre_13"> contains general options that apply to the entire server and all shares. These options primarily pertain to network configuration and access control. This sample </span><span class="calibre3">[global]</span><span class="calibre_13"> section shows how to set the server name, description, and workgroup:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[global]<br class="calibre7" /># server name<br class="calibre7" />netbios name = </span><span class="calibre3"><span class="italic">name</span></span><span class="calibre3"><br class="calibre7" /># server description<br class="calibre7" />server string = My server via Samba<br class="calibre7" /># workgroup<br class="calibre7" />workgroup = MYNETWORK</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">These parameters work as follows:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">netbios name</span></span> The server name. If you omit this parameter, Samba uses the Unix hostname. NetBIOS is an API that SMB hosts often employ to talk to one another.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">server string</span></span> A short description of the server. The default is the Samba version number.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">workgroup</span></span> The Windows workgroup name. If you’re on a Windows domain, set this parameter to the name of your domain.</li></ol><p id="calibre_link-375" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.2  Server Access Control</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can add options to your </span><span class="italic">smb.conf</span><span class="calibre_13"> file to limit which machines and users can access your Samba server. Here are a few of the many options that you can set in your </span><span class="calibre3">[global]</span><span class="calibre_13"> section and in the sections that control individual shares (as described later in the chapter):</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">interfaces</span></span> Set this to have Samba listen (accept connections) on the given networks or interfaces. For example: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">interfaces = 10.23.2.0/255.255.255.0<br class="calibre7" />interfaces = enp0s31f6</span></blockquote></blockquote></blockquote></li><li value="2" class="calibre_81"><span class="calibre3"><span class="bold">bind interfaces only</span></span> Set this to <span class="calibre3">yes</span> when using the <span class="calibre3">interfaces</span> parameter in order to limit access to only the machines that you can directly reach on those interfaces.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">valid users</span></span> Set this to allow the given users access. For example: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">valid users = jruser, bill</span></blockquote></blockquote></blockquote></li><li value="4" class="calibre_81"><span class="calibre3"><span class="bold">guest ok</span></span> Set this parameter to <span class="calibre3">true</span> to make a share available to anonymous users on the network. Do this only if you’re sure that the network is private.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">browseable</span></span> Set this to make shares viewable by network browsers. If you set this parameter to <span class="calibre3">no</span> for any shares, you’ll still be able to access the shares on the Samba server, but you’ll need to know their exact names in order to be able to access them.</li><a id="calibre_link-876"></a></ol><p id="calibre_link-376" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.3  Passwords</span></span></span></p><p class="calibre_45"><span class="calibre_13">In general, you should allow access to your Samba server only with password authentication. Unfortunately, the basic password system on Unix is different from that on Windows, so unless you specify cleartext network passwords or authenticate passwords with a Windows domain server, you must set up an alternative password system. This section shows you how to set up an alternative password system using Samba’s </span><span class="italic">Trivial Database (TDB)</span><span class="calibre_13"> backend, which is appropriate for small networks.</span></p><p class="calibre_27"><span class="calibre_13"> First, use these entries in your </span><span class="italic">smb.conf</span><span class="calibre_13">
</span><span class="calibre3">[global]</span><span class="calibre_13"> section to define the Samba password database characteristics:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># use the tdb for Samba to enable encrypted passwords<br class="calibre7" />security = user<br class="calibre7" />passdb backend = tdbsam<br class="calibre7" />obey pam restrictions = yes<br class="calibre7" />smb passwd file = /etc/samba/passwd_smb</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> These lines allow you to manipulate the Samba password database with the </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> command. The </span><span class="calibre3">obey pam restrictions</span><span class="calibre_13"> parameter ensures that any user changing their password with the </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> command must obey any rules that PAM (Pluggable Authentication Modules, covered in </span>Chapter 7<span class="calibre_13">) enforces for normal password changes. For the </span><span class="calibre3">passdb backend</span><span class="calibre_13"> parameter, you can optionally specify a pathname for the TDB file after a colon&mdash;for example, </span><span class="calibre3">tdbsam:/etc/samba/private/passwd.tdb</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you have access to a Windows domain, you can set </span></span><span class="calibre3">security = domain</span><span class="italic"><span class="calibre_13"> to make Samba use the domain’s authentication system and eliminate the need for a password database. However, in order for domain users to access the machine running Samba, each domain user must have a local account with the same username on that machine.</span></span></blockquote><p class="calibre_23"><span class="bold">Adding and Deleting Users</span></p><p class="calibre_25"><span class="calibre_13">The first thing you need to do to give a Windows user access to your Samba server is to add the user to the password database with the </span><span class="calibre3">smbpasswd -a</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">smbpasswd -a </span></span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3"><span class="italic">username</span></span><span class="calibre_13"> parameter to the </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> command must be a valid username on your Linux system.</span></p><p id="calibre_link-877" class="calibre_27"><span class="calibre_13">Like the regular system’s </span><span class="calibre3">passwd</span><span class="calibre_13"> program, </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> asks you to enter the new SMB user’s password twice. After the password passes any necessary security checks, </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> confirms that it has created the new user.</span></p><p class="calibre_27"><span class="calibre_13"> To remove a user, use the </span><span class="calibre3">-x</span><span class="calibre_13"> option to </span><span class="calibre3">smbpasswd</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">smbpasswd -x </span></span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To just temporarily deactivate the user, use the </span><span class="calibre3">-d</span><span class="calibre_13"> option; the </span><span class="calibre3">-e</span><span class="calibre_13"> option can be used later to reenable the user:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">smbpasswd -d</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">smbpasswd -e</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span></blockquote></blockquote><p class="calibre_42"><span class="bold">Changing Passwords</span></p><p class="calibre_25"><span class="calibre_13">You can change a Samba password as the superuser by using </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> with no options or keywords other than the username:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">smbpasswd </span></span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> However, if the Samba server is running, any user can change their own Samba password by entering </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> by itself on the command line.</span></p><p class="calibre_27"><span class="calibre_13"> Finally, here’s one place in your configuration to beware of. If you see a line like this in your </span><span class="italic">smb.conf</span><span class="calibre_13"> file, be careful:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">unix password sync = yes</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This line causes </span><span class="calibre3">smbpasswd</span><span class="calibre_13"> to change a user’s normal password </span><span class="italic">in addition</span><span class="calibre_13"> to the Samba password. The result can be very confusing, especially when a user changes their Samba password to something that’s not their Linux password and discovers that they can no longer log in to their Linux system. Some distributions set this parameter by default in their Samba server packages!</span></p><p id="calibre_link-377" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.4  Manual Server Startup</span></span></span></p><p class="calibre_45"><span class="calibre_13">Typically, you shouldn’t need to worry about starting the server if you installed Samba from a distribution package. Check the list from </span><span class="calibre3">systemctl --type=service</span><span class="calibre_13"> to verify. However, if you installed it from source code, run </span><span class="calibre3">nmbd</span><span class="calibre_13"> and </span><span class="calibre3">smbd</span><span class="calibre_13"> with the following arguments, where </span><span class="calibre3"><span class="italic">smb_config_file</span></span><span class="calibre_13"> is the full path of your </span><span class="italic">smb.conf</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">nmbd -D -s </span></span><span class="calibre3"><span class="italic"><span class="bold">smb_config_file</span></span></span><span class="calibre3"><br class="calibre7" /># </span><span class="calibre3"><span class="bold">smbd -D -s </span></span><span class="calibre3"><span class="italic"><span class="bold">smb_config_file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">nmbd</span><span class="calibre_13"> daemon is a NetBIOS name server, and </span><span class="calibre3">smbd</span><span class="calibre_13"> does the actual work of handling share requests. The </span><span class="calibre3">-D</span><span class="calibre_13"> option specifies daemon mode. If you alter the </span><span class="italic">smb.conf</span><span class="calibre_13"> file while </span><span class="calibre3">smbd</span><span class="calibre_13"> is running, you can notify the daemon of the changes with a HUP signal, though it’s almost always for the better if you let systemd supervise the server, in which case you can get </span><a id="calibre_link-824"></a><span class="calibre3">systemctl</span><span class="calibre_13"> to do the work for you.</span></p><p id="calibre_link-378" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.5  Diagnostics and Logfiles</span></span></span></p><p class="calibre_45"><span class="calibre_13">If something goes wrong when a Samba server starts up, an error message appears on the command line. However, runtime diagnostic messages go to the </span><span class="italic">log.nmbd</span><span class="calibre_13"> and </span><span class="italic">log.smbd</span><span class="calibre_13"> logfiles, which are usually in a </span><span class="italic">/var/log</span><span class="calibre_13"> directory, such as </span><span class="italic">/var/log/samba</span><span class="calibre_13">. You’ll also find other logfiles there, such as individual logs for each individual client.</span></p><p id="calibre_link-379" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.6  File Share Configuration</span></span></span></p><p class="calibre_45"><span class="calibre_13">To export a directory to SMB clients (that is, to share a directory with a client), add a section like this to your </span><span class="italic">smb.conf</span><span class="calibre_13"> file, where </span><span class="calibre3"><span class="italic">label</span></span><span class="calibre_13"> is what you would like to call the share (such as </span><span class="calibre3">mydocuments</span><span class="calibre_13">) and </span><span class="calibre3"><span class="italic">path</span></span><span class="calibre_13"> is the full directory path:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[</span><span class="calibre3"><span class="italic">label</span></span><span class="calibre3">]<br class="calibre7" />path = </span><span class="calibre3"><span class="italic">path</span></span><span class="calibre3"><br class="calibre7" />comment = </span><span class="calibre3"><span class="italic">share description</span></span><span class="calibre3"><br class="calibre7" />guest ok = no<br class="calibre7" />writable = yes<br class="calibre7" />printable = no</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">These parameters are useful in directory shares:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">guest ok</span></span> A <span class="calibre3">yes</span> setting here allows guest access to the share. The <span class="calibre3">public</span> parameter is a synonym.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">writable</span></span> A <span class="calibre3">yes</span> or <span class="calibre3">true</span> setting here marks the share as read-write. Do not allow guest access to a read-write share.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">printable</span></span> Obviously, on a directory share, this parameter must be set to <span class="calibre3">no</span> or <span class="calibre3">false</span>.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">veto files</span></span> This parameter prevents the export of any files that match the given patterns. You must enclose each pattern between forward slashes (so that it looks like <span class="calibre3"><span class="italic">/pattern/</span></span>). This example bars object files, as well as any file or directory named <span class="italic">bin</span>: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">veto files = /*.o/bin/</span></blockquote></blockquote></blockquote></li></ol><p id="calibre_link-380" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">12.4.7  Home Directories</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can add a section called </span><span class="calibre3">[homes]</span><span class="calibre_13"> to your </span><span class="italic">smb.conf</span><span class="calibre_13"> file if you want to export home directories to users. The section should look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[homes]<br class="calibre7" />comment = home directoriesbrowseable = no<br class="calibre7" />writable = yes</span></blockquote><a id="calibre_link-860"></a></blockquote><p class="calibre_30"><span class="calibre_13"> By default, Samba reads the logged-in user’s </span><span class="italic">/etc/passwd</span><span class="calibre_13"> entry to determine their home directory for </span><span class="calibre3">[homes]</span><span class="calibre_13">. However, if you don’t want Samba to follow this behavior (that is, you want to keep the Windows home directories in a different place than the regular Linux home directories), you can use the </span><span class="calibre3">%S</span><span class="calibre_13"> substitution in a </span><span class="calibre3">path</span><span class="calibre_13"> parameter. For example, here’s how you would switch a user’s </span><span class="calibre3">[homes]</span><span class="calibre_13"> directory to </span><span class="italic">/u/user</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">path = /u/%S</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Samba substitutes the current username for the </span><span class="calibre3">%S</span><span class="calibre_13">.</span></p><p id="calibre_link-381" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">12.4.8  Printer Sharing</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can export your printers to Windows clients by adding a </span><span class="calibre3">[printers]</span><span class="calibre_13"> section to your </span><span class="italic">smb.conf</span><span class="calibre_13"> file. Here’s how the section looks when you’re using CUPS, the standard Unix printing system:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">[printers]<br class="calibre7" />comment = Printers<br class="calibre7" />browseable = yes<br class="calibre7" />printing = CUPS<br class="calibre7" />path = cups<br class="calibre7" />printable = yes<br class="calibre7" />writable = no</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To use the </span><span class="calibre3">printing = CUPS</span><span class="calibre_13"> parameter, your Samba installation must be configured and linked against the CUPS library.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Depending on your configuration, you may also want to allow guest access to your printers with the </span></span><span class="calibre3">guest ok = yes</span><span class="italic"><span class="calibre_13"> option rather than give a Samba password or account to everyone who needs to access the printers. For example, it’s easy to limit printer access to a single subnet with firewall rules.</span></span></blockquote><p id="calibre_link-382" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">12.4.9  The Samba Client</span></span></span></p><p class="calibre_45"><span class="calibre_13">The Samba client program </span><span class="calibre3">smbclient</span><span class="calibre_13"> can print to and access remote Windows shares. This program comes in handy when you’re in an environment where you must interact with Windows servers that don’t offer a Unix-friendly means of communication.</span></p><p class="calibre_27"><span class="calibre_13"> To get started with </span><span class="calibre3">smbclient</span><span class="calibre_13">, use the </span><span class="calibre3">-L</span><span class="calibre_13"> option to get a list of shares from a remote server named </span><span class="calibre3"><span class="italic">SERVER</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">smbclient -L -U </span></span><span class="calibre3"><span class="italic"><span class="bold">username SERVER</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You don’t need </span><span class="calibre3">-U</span><span class="calibre_13">
</span><span class="calibre3"><span class="italic">username</span></span><span class="calibre_13"> if your Linux username is the same as your username on </span><span class="calibre3"><span class="italic">SERVER</span></span><span class="calibre_13">.</span></p><p id="calibre_link-859" class="calibre_27"><span class="calibre_13">After you run this command, </span><span class="calibre3">smbclient</span><span class="calibre_13"> asks for a password. To try to access a share as a guest, press </span>ENTER<span class="calibre_13">; otherwise, enter your password on </span><span class="calibre3"><span class="italic">SERVER</span></span><span class="calibre_13">. Upon success, you should get a share list like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Sharename&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Comment<br class="calibre7" />---------&nbsp;&nbsp; ----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -------<br class="calibre7" />Software&nbsp;&nbsp;&nbsp; Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Software distribution<br class="calibre7" />Scratch&nbsp;&nbsp;&nbsp;&nbsp; Disk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scratch space<br class="calibre7" />IPC$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPC Service<br class="calibre7" />ADMIN$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPC Service<br class="calibre7" />Printer1&nbsp;&nbsp;&nbsp; Printer&nbsp;&nbsp;&nbsp;&nbsp; Printer in room 231A<br class="calibre7" />Printer2&nbsp;&nbsp;&nbsp; Printer&nbsp;&nbsp;&nbsp;&nbsp; Printer in basement</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Use the </span><span class="calibre3">Type</span><span class="calibre_13"> field to help you make sense of each share, and pay attention only to the </span><span class="calibre3">Disk</span><span class="calibre_13"> and </span><span class="calibre3">Printer</span><span class="calibre_13"> shares (the </span><span class="calibre3">IPC</span><span class="calibre_13"> shares are for remote management). This list has two disk shares and two printer shares. Use the name in the </span><span class="calibre3">Sharename</span><span class="calibre_13"> column to access each share.</span></p><p class="calibre_46"><span class="bold">Accessing Files as a Client</span></p><p class="calibre_25"><span class="calibre_13">If you need only casual access to files in a disk share, use the following command (again, you can omit the </span><span class="calibre3">-U</span><span class="calibre_13">
</span><span class="calibre3"><span class="italic">username</span></span><span class="calibre_13"> if your Linux username matches your username on the server):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">smbclient -U </span></span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span><span class="calibre3"><span class="bold"> '\\</span></span><span class="calibre3"><span class="italic"><span class="bold">SERVER</span></span></span><span class="calibre3"><span class="bold">\</span></span><span class="calibre3"><span class="italic"><span class="bold">sharename</span></span></span><span class="calibre3"><span class="bold">'</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Upon success, you will get a prompt like this, indicating that you can now transfer files:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">smb: \&gt;</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In this file transfer mode, </span><span class="calibre3">smbclient</span><span class="calibre_13"> is similar to the Unix </span><span class="calibre3">ftp</span><span class="calibre_13">, and you can run these commands:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">get </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span> Copies <span class="calibre3"><span class="italic">file</span></span> from the remote server to the current local directory.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">put </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span> Copies <span class="calibre3"><span class="italic">file</span></span> from the local machine to the remote server.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">cd </span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span> Changes the directory on the remote server to <span class="calibre3"><span class="italic">dir</span></span>.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">lcd </span></span><span class="calibre3"><span class="italic"><span class="bold">localdir</span></span></span> Changes the current local directory to <span class="calibre3"><span class="italic">localdir</span></span>.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">pwd</span></span> Prints the current directory on the remote server, including the server and share names.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">!</span></span><span class="calibre3"><span class="italic"><span class="bold">command</span></span></span> Runs <span class="calibre3"><span class="italic">command</span></span> on the local host. Two particularly handy commands are <span class="calibre3">!pwd</span> and <span class="calibre3">!ls</span> to determine directory and file status on the local side.</li><li value="7" class="calibre_8"><span class="calibre3"><span class="bold">help</span></span> Shows a full list of commands.</li></ol><p id="calibre_link-767" class="calibre_46"><span class="bold">Using the CIFS Filesystem</span></p><p class="calibre_25"><span class="calibre_13">If you’d like to have more convenient access to files on a Windows server, you can attach a share directly to your system with </span><span class="calibre3">mount</span><span class="calibre_13">. The command syntax is as follows (notice the use of </span><span class="calibre3"><span class="italic">SERVER</span></span><span class="calibre3">:</span><span class="calibre3"><span class="italic">sharename</span></span><span class="calibre_13"> rather than the normal </span><span class="calibre3">\\</span><span class="calibre3"><span class="italic">SERVER</span></span><span class="calibre3">\</span><span class="calibre3"><span class="italic">sharename</span></span><span class="calibre_13"> format):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -t cifs </span></span><span class="calibre3"><span class="italic"><span class="bold">SERVER</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">sharename</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">mountpoint</span></span></span><span class="calibre3"><span class="bold"> -o user=</span></span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span><span class="calibre3"><span class="bold">,pass=</span></span><span class="calibre3"><span class="italic"><span class="bold">password</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> In order to use </span><span class="calibre3">mount</span><span class="calibre_13"> like this, you must have the Common Internet File System (CIFS) utilities installed on your system. Most distributions offer these as a separate package.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-383" class="calibre_23"><span class="calibre1"><span class="bold"> 12.5 SSHFS</span></span></p><p class="calibre_24"><span class="calibre_13">With Windows file sharing systems out of the way, in this section we’ll discuss file sharing between Linux systems. For scenarios that aren’t particularly complicated, a convenient option to consider is SSHFS. This is nothing more than a user-space filesystem that opens an SSH connection and presents the files on the other side at a mount point on your machine. Most distributions don’t install it by default, so you might need to install your distribution’s SSHFS package.</span></p><p class="calibre_27"><span class="calibre_13">The syntax for using SSHFS on the command line looks superficially similar to SSH commands that you’ve seen before. Of course, you need to supply the shared directory (on the remote host) and the desired mount point:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">sshfs</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">username</span></span></span><span class="calibre3"><span class="bold">@</span></span><span class="calibre3"><span class="italic"><span class="bold">host</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">dir</span></span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">mountpoint</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Just like in SSH, you can drop the </span><span class="calibre3"><span class="italic">username</span></span><span class="calibre3">@</span><span class="calibre_13"> if the username is the same on the remote host, and you can also omit </span><span class="calibre3">:</span><span class="calibre3"><span class="italic">dir</span></span><span class="calibre_13"> if you just want to mount the home directory on the other side. This command asks for the password on the other side if necessary.</span></p><p class="calibre_27"><span class="calibre_13"> Because this is a user-space filesystem, you have to unmount it with </span><span class="calibre3">fusermount</span><span class="calibre_13"> if you’re running this as a regular user:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">fusermount -u </span></span><span class="calibre3"><span class="italic"><span class="bold">mountpoint</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The superuser can also unmount these filesystems with </span><span class="calibre3">umount</span><span class="calibre_13">. To ensure consistency of ownership and security, this type of filesystem is usually best mounted as a regular user.</span></p><p class="calibre_27"><span class="calibre_13">SSHFS has these advantages:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">It has minimal setup. The only requirement on the remote host is that SFTP is enabled, and most SSH servers enable it by default.</li><li value="2" class="calibre_8">It’s not dependent on any kind of specific network configuration. If you can open an SSH connection, SSHFS will work, regardless if it’s on a secure local network or over an insecure remote network.</li></ul><p id="calibre_link-771" class="calibre_33"><span class="calibre_13">The disadvantages of SSHFS are:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Performance suffers. There is a lot of overhead in encryption, translation, and transport (but it may not be as bad as you expect).</li><li value="2" class="calibre_8">Multiuser setups are limited.</li></ul><p class="calibre_33"><span class="calibre_13">It’s definitely worth trying SSHFS if you think it might work for you, because it’s so easy to set up.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-384" class="calibre_23"><span class="calibre1"><span class="bold"> 12.6 NFS</span></span></p><p class="calibre_24"><span class="calibre_13">One of the most commonly used traditional systems for file sharing among Unix systems is NFS, and there are many different versions of NFS for different scenarios. You can serve NFS over TCP and UDP, with a large number of authentication and encryption options (very few of which are enabled by default, unfortunately). Because there are so many options, NFS can be a big topic, so we’ll just stick to the bare minimum of coverage.</span></p><p class="calibre_27"><span class="calibre_13">To mount a remote directory on a server with NFS, use the same basic syntax as for mounting a CIFS directory:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">mount -t nfs </span></span><span class="calibre3"><span class="italic"><span class="bold">server</span></span></span><span class="calibre3"><span class="bold">:</span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span><span class="calibre3"><span class="bold">
</span></span><span class="calibre3"><span class="italic"><span class="bold">mountpoint</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Technically, you don’t need the </span><span class="calibre3">-t nfs</span><span class="calibre_13"> option because </span><span class="calibre3">mount</span><span class="calibre_13"> should figure this out for you, but you may want to investigate the options in the nfs(5) manual page. You’ll find several different options for security using the </span><span class="calibre3">sec</span><span class="calibre_13"> option. Many administrators on small, closed networks use host-based access control. More sophisticated methods, such as Kerberos-based authentication, require additional configuration on other parts of your system.</span></p><p class="calibre_27"><span class="calibre_13">When you find that you’re making greater use of filesystems over a network, set up the automounter so that your system will mount the filesystems only when you actually try to use them in order to prevent problems with dependencies on boot. The traditional automounting tool was called automount, and there’s a newer version called amd, but much of this functionality has now been supplanted by the automount unit type in systemd.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_66"><span class="bold">NFS SERVERS</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">Setting up an NFS server to share files to other Linux machines is more complicated than configuring the client side. You need to run the server daemons (</span></span><span class="calibre3">mountd</span><span class="calibre3"><span class="calibre_13"> and </span></span><span class="calibre3">nfsd</span><span class="calibre3"><span class="calibre_13">) and set up the </span></span><span class="calibre3"><span class="italic">/etc/exports</span></span><span class="calibre3"><span class="calibre_13"> file to reflect the directories that you’re sharing. However, we won’t cover NFS servers, primarily because it’s often much more convenient to share storage over a network by simply purchasing an NAS device to handle it for you. Many of these devices are Linux based, so they’ll naturally have NFS server support. Vendors add value to their NAS devices by offering their own administration tools to take the pain out of tedious tasks such as setting up RAID configurations and cloud backups.</span></span><a id="calibre_link-558"></a></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-385" class="calibre_42"><span class="calibre1"><span class="bold"> 12.7 Cloud Storage</span></span></p><p class="calibre_24"><span class="calibre_13">Speaking of cloud backups, another network file storage option is cloud storage, such as AWS S3 or Google Cloud Storage. These systems don’t have the performance of storage on a local network, but they do offer two significant advantages: you never have to maintain them, and you shouldn’t have to worry about backups.</span></p><p class="calibre_27"><span class="calibre_13">Aside from the web (and programmatic) interfaces that all cloud storage providers offer, there are ways to mount most kinds of cloud storage on a Linux system. Unlike most of the filesystems that we’ve seen so far, these are nearly all implemented as FUSE (File System in User Space) interfaces. For some popular cloud storage providers such as S3, there are even multiple options. This makes sense, because a FUSE handler is nothing more than a user-space daemon that acts as an intermediary between the data source and the kernel.</span></p><p class="calibre_27"><span class="calibre_13">This book doesn’t cover the specifics of setting up a cloud storage client, because every one is different.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-386" class="calibre_23"><span class="calibre1"><span class="bold"> 12.8 The State of Network File Sharing</span></span></p><p class="calibre_24"><span class="calibre_13">At this point, you might feel that this discussion of the NFS and file sharing in general seems somewhat incomplete&mdash;and it might be, but only as much as the file sharing systems themselves. We discussed performance and security concerns in Sections </span>12.3.1<span class="calibre_13"> and </span>12.3.2<span class="calibre_13">. In particular, the base security level of NFS is quite low, requiring significant extra work to improve. CIFS systems are somewhat better in this regard, as the necessary encryption layers are built into contemporary software. However, performance limitations aren’t easy to overcome, not to mention how badly a system can perform when it is temporarily unable to access its network storage.</span></p><p class="calibre_27"><span class="calibre_13">There have been several attempts to deal with this issue. Perhaps the most extensive is the Andrew File System (AFS), first designed in the 1980s, which was built around solutions to these problems. So why doesn’t everyone use AFS or something like it?</span></p><p class="calibre_27"><span class="calibre_13">There is no one answer to this question, but much of it comes down to a certain lack of flexibility in some parts of the design. For example, the security mechanism requires a Kerberos authentication system. Though universally available, it has never been standard on Unix systems, and requires a nontrivial amount of work to set up and maintain (you have to set up a server for it).</span></p><p id="calibre_link-559" class="calibre_27"><span class="calibre_13">For a large institution, fulfilling requirements such as Kerberos isn’t a problem. This is exactly the setting in which AFS has thrived; universities and financial institutions are big AFS sites. But for the small user, it’s simply easier not to do it, preferring simpler options like NFS or CIFS shares. This sort of limitation even extends to Windows; starting with Windows 2000, Microsoft switched to Kerberos as the default authentication on its server product, but small networks don’t tend to be Windows domains with this kind of server.</span></p><p class="calibre_27"><span class="calibre_13">Aside from the authentication prerequisite, there’s a problem that stems from more technical reasons. Many network filesystem clients have traditionally been kernel code, NFS in particular. Unfortunately, the requirements of network filesystems are complex enough that problems start to occur. The authentication alone has no place in the kernel. A kernel client implementation also severely limits the potential developer base for a network filesystem, hampering the system as a whole. In some cases, client code was in user space, but there was always some sort of kernel customization underneath.</span></p><p class="calibre_27"><span class="calibre_13">At the moment, we find ourselves without a truly standard means of network file sharing in the Linux/Unix world (at least if you’re not a large site or you aren’t willing to put in a fair amount of work). However, this won’t necessarily always be the case.</span></p><p class="calibre_27"><span class="calibre_13">When providers started to offer cloud storage, it was clear that the traditional forms of network file sharing wouldn’t be suitable. In the cloud, access methods are built on top of security mechanisms such as TLS that make it possible to access storage without setting up a large system such as Kerberos. As mentioned in the preceding section, there are many options available via FUSE to access cloud storage. We’re no longer dependent on the kernel for any part of the client; any kind of authentication, encryption, or handling can easily be done in user space.</span></p><p class="calibre_27"><span class="calibre_13">All of this means that the future could very well see some file-sharing designs incorporating more flexibility in security and other areas such as filename translation.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-387" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-863" class="calibre_10"><span class="calibre4"><span class="bold">13</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">USER ENVIRONMENTS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This book’s primary focus is on the parts of the Linux system that normally underlie server processes and interactive user sessions. But eventually, the system and the user have to meet somewhere. Startup files play an important role at this point, because they set defaults for the shell and other interactive programs. They determine how the system behaves when a user logs in.</span></span></p><p class="calibre_33"><span class="calibre_13">Most users don’t pay close attention to their startup files, touching them only when they want to add something for convenience, such as an alias. Over time, the files become cluttered with unnecessary environment variables and tests that can lead to annoying (or quite serious) problems.</span></p><p id="calibre_link-720" class="calibre_27"><span class="calibre_13">If you’ve had your Linux machine for a while, you might have noticed that your home directory accumulates a bafflingly large array of startup files over time. These are sometimes called </span><span class="italic">dot files</span><span class="calibre_13"> because they nearly always start with a dot (</span><span class="italic">.</span><span class="calibre_13">), excluding them from the default display of </span><span class="calibre3">ls</span><span class="calibre_13"> and most file managers. Many of these are automatically created when you first run a program, and you’ll never need to change them. This chapter primarily covers shell startup files, which are the ones you’re most likely to modify or rewrite from scratch. Let’s first look at how much care you need to take when working on these files.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-388" class="calibre_23"><span class="calibre1"><span class="bold"> 13.1 Guidelines for Creating Startup Files</span></span></p><p class="calibre_24"><span class="calibre_13">When designing startup files, keep the user in mind. If you’re the only user on a machine, you don’t have much to worry about, because any errors affect only you and they’re easy enough to fix. However, if you’re creating startup files meant to be the defaults for all new users on a machine or network, or if you think that someone might copy your files for use on a different machine, this process becomes considerably more critical. If you make an error in a startup file and distribute it to 10 users, you might end up fixing this error 10 times.</span></p><p class="calibre_27"><span class="calibre_13">Keep two essential goals in mind when creating startup files for other users:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Simplicity</span> Keep the number of startup files small, and keep the files as short and simple as possible so that they’re easy to modify but hard to break. Each item in a startup file is just one more thing that can break.</li><li value="2" class="calibre_8"><span class="bold">Readability</span> Use extensive comments in files so that the users get a good picture of what each part of a file does.</li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-389" class="calibre_23"><span class="calibre1"><span class="bold"> 13.2 When to Alter Startup Files</span></span></p><p class="calibre_24"><span class="calibre_13">Before making a change to a startup file, ask yourself whether you really should be making it. Here are some good reasons for changing startup files:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">You want to change the default prompt.</li><li value="2" class="calibre_8">You need to accommodate some critical locally installed software. (Consider using wrapper scripts first, though.)</li><li value="3" class="calibre_8">Your existing startup files are broken.</li></ul><p class="calibre_33"><span class="calibre_13"> If everything in your Linux distribution works, be careful. Sometimes the default startup files interact with other files in </span><span class="italic">/etc</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">That said, you probably wouldn’t be reading this chapter if you weren’t interested in changing the defaults, so let’s examine what’s important.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-390" class="calibre_23"><span class="calibre1"><span class="bold">13.3 Shell Startup File Elements</span></span></p><p class="calibre_24"><span class="calibre_13">What goes into a shell startup file? Some things might seem obvious, such as the command path and a prompt setting. But what exactly </span><span class="italic">should</span><span class="calibre_13"> be in the path, and what does a reasonable prompt look like? And how much is too much to put in a startup file?</span></p><p class="calibre_27"><span class="calibre_13">This section discusses the essentials of a shell startup file&mdash;from the command path, prompt, and aliases through the permissions mask.</span></p><p id="calibre_link-391" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.3.1  The Command Path</span></span></span></p><p class="calibre_45"><span class="calibre_13">The most important part of any shell startup file is the command path. The path should cover the directories that contain every application of interest to a regular user. At the very least, the path should contain these components, in order:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/usr/local/bin<br class="calibre7" />/usr/bin<br class="calibre7" />/bin</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This order ensures that you can override standard default programs with site-specific variants located in </span><span class="italic">/usr/local</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Most Linux distributions install executables for nearly all packaged user software in </span><span class="italic">/usr/bin</span><span class="calibre_13">. Some are occasional differences that have crept in over the years, such as putting games in </span><span class="italic">/usr/games</span><span class="calibre_13"> and graphical applications in a separate location, so check your system’s defaults first. And make sure that every general-use program on the system is available through one of the directories just listed. If not, your system is probably getting out of control. Don’t change the default path in your user environment to accommodate every new software installation directory. A cheap way to accommodate separate installation directories is to use symbolic links in </span><span class="italic">/usr/local/bin</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Many users create a </span><span class="italic">bin</span><span class="calibre_13"> directory of their own to store shell scripts and programs, so you may want to add this to the front of the path:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$HOME/bin</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> A newer convention is to place binaries in </span></span>$HOME/.local/bin<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> If you’re interested in systems utilities (such as </span><span class="calibre3">sysctl</span><span class="calibre_13">, </span><span class="calibre3">fdisk</span><span class="calibre_13">, and </span><span class="calibre3">lsmod</span><span class="calibre_13">), add the </span><span class="italic">sbin</span><span class="calibre_13"> directories to your path:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/usr/local/sbin<br class="calibre7" />/usr/sbin<br class="calibre7" />/sbin</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote id="calibre_link-833" class="calibre_68"><span class="bold">ADDING A DOT TO THE PATH</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">There is one small but controversial command path component to discuss: the dot. Placing a dot (</span></span><span class="calibre3">.</span><span class="calibre3"><span class="calibre_13">) in your path allows you to run programs in the current directory without using </span></span><span class="calibre3">./</span><span class="calibre3"><span class="calibre_13"> in front of the program name. This may seem convenient when writing scripts or compiling programs, but it’s a bad idea for two reasons:</span></span></blockquote><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_7"><span class="calibre3"> It can be a security problem. You should </span><span class="calibre3"><span class="italic">never</span></span><span class="calibre3"> put a dot at the </span><span class="calibre3"><span class="italic">front</span></span><span class="calibre3"> of the path. As just one example of what might happen, an attacker could put a Trojan horse named ls in an archive distributed on the internet. Even if the dot is placed at the end of the path, you’d still be vulnerable to an attacker anticipating typos such as sl or ks.</span></li><li value="2" class="calibre_7"><span class="calibre3">It is inconsistent and can be confusing. A dot in a path can mean that a command’s behavior will change according to the current directory.</span></li></ul><p id="calibre_link-392" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">13.3.2  The Manual Page Path</span></span></span></p><p class="calibre_45"><span class="calibre_13">The traditional manual page path was determined by the </span><span class="calibre3">MANPATH</span><span class="calibre_13"> environment variable, but you shouldn’t set it because doing so overrides the system defaults in </span><span class="italic">/etc/manpath.config</span><span class="calibre_13">.</span></p><p id="calibre_link-393" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.3.3  The Prompt</span></span></span></p><p class="calibre_45"><span class="calibre_13">Experienced users tend to avoid long, complicated, useless prompts. In comparison, many administrators and distributions drag everything into a default prompt. Even many shell default prompts are cluttered or otherwise mostly useless. For example, the default </span><span class="calibre3">bash</span><span class="calibre_13"> prompt contains the shell name and version number. Your choice should reflect your users’ needs; place the current working directory, hostname, and username in the prompt if it really helps.</span></p><p class="calibre_27"><span class="calibre_13">Above all, avoid characters that mean something significant to the shell, such as these:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">{ } = &amp; &lt; &gt;</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Take extra care to avoid the </span></span><span class="calibre3">&gt;</span><span class="italic"><span class="calibre_13"> character, which can cause erratic, empty files to appear in your current directory if you accidentally copy and paste a section of your shell window (</span></span><span class="calibre3">&gt;</span><span class="italic"><span class="calibre_13"> redirects output to a file).</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> This simple prompt setting for </span><span class="calibre3">bash</span><span class="calibre_13"> ends with the customary </span><span class="calibre3">$</span><span class="calibre_13"> (the traditional </span><span class="calibre3">csh</span><span class="calibre_13"> prompt ends with </span><span class="calibre3">%</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">PS1='\u\$ '</span></blockquote></blockquote><p id="calibre_link-560" class="calibre_30"><span class="calibre_13">The </span><span class="calibre3">\u</span><span class="calibre_13"> is an expression that the shell evaluates to the current username (see the PROMPTING section of the bash(1) manual page). Other popular expressions include:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">\h</span></span> The hostname (the short form, without domain names).</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">\!</span></span> The history number.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">\w</span></span> The current directory. Because this can become long, you can limit the display to just the final component by using <span class="calibre3">\W</span> instead.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">\$</span></span>
<span class="calibre3">$</span> if running as a user account; <span class="calibre3">#</span> if root.</li></ol><p id="calibre_link-394" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.3.4  Aliases</span></span></span></p><p class="calibre_45"><span class="calibre_13">Among the stickier points of contemporary user environments is the role of </span><span class="italic">aliases</span><span class="calibre_13">, a shell feature that substitutes one string for another before executing a command. Aliases can be efficient shortcuts that save some typing. However, they have several drawbacks:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">It can be tricky to manipulate arguments.</li><li value="2" class="calibre_8"> They are confusing; a shell’s built-in <span class="calibre3">which</span> command can tell you if something is an alias, but it won’t tell you where it was defined.</li><li value="3" class="calibre_8">They are frowned upon in subshells and noninteractive shells; they aren’t passed onto child shells.</li></ul><p class="calibre_33"><span class="calibre_13"> One classic mistake when defining an alias is to add extra arguments to an existing command&mdash;for example, aliasing </span><span class="calibre3">ls</span><span class="calibre_13"> to </span><span class="calibre3">ls -F</span><span class="calibre_13">. At best, this can make it difficult to remove the </span><span class="calibre3">-F</span><span class="calibre_13"> argument when you don’t want it. At worst, it can have severe consequences for the user who does not understand that they’re not using the default arguments.</span></p><p class="calibre_27"><span class="calibre_13">Given these disadvantages, you should probably avoid aliases whenever possible; it’s easier to write a shell function or an entirely new shell script. A computer can start and execute shells so quickly that the difference between an alias and an entirely new command should be unnoticeable.</span></p><p class="calibre_27"><span class="calibre_13">That said, aliases do come in handy when you wish to alter a part of the shell’s environment. You can’t change an environment variable with a shell script, because scripts run as subshells. (But you can instead define shell functions to perform this task.)</span></p><p id="calibre_link-395" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.3.5  The Permissions Mask</span></span></span></p><p class="calibre_45"><span class="calibre_13">As described in </span>Chapter 2<span class="calibre_13">, a shell’s built-in </span><span class="calibre3">umask</span><span class="calibre_13"> (permissions mask) facility sets your default permissions. Include the </span><span class="calibre3">umask</span><span class="calibre_13"> command in one of your startup files to make certain that any program you run creates files with your desired permissions. There are two reasonable choices:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">077</span></span> This mask is the most restrictive permissions mask; it doesn’t give any other users access to new files and directories. This is often appropriate on a multi-user system where you don’t want other users to look at any of your files. However, when set as the default, this mask can sometimes lead to problems when your users want to share files but don’t understand how to set permissions correctly. (Inexperienced users have a tendency to set files to a world-writable mode.)</li><a id="calibre_link-575"></a><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">022</span></span> This mask gives other users read access to new files and directories. This can be a good choice on a single-user system because many daemons that run as pseudo-users won’t be able to see files and directories created with the more restrictive <span class="calibre3">077</span> umask.</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Certain applications (especially mail programs) override the umask, changing it to </span></span><span class="calibre3">077</span><span class="italic"><span class="calibre_13"> because they feel that their files are the business of no one but the file owner.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-396" class="calibre_42"><span class="calibre1"><span class="bold"> 13.4 Startup File Order and Examples</span></span></p><p class="calibre_24"><span class="calibre_13">Now that you know what to put into shell startup files, it’s time to see some specific examples. Surprisingly, one of the most difficult and confusing parts of creating startup files is determining which of several possible startup files to use. This section covers the two most popular Unix shells: </span><span class="calibre3">bash</span><span class="calibre_13"> and </span><span class="calibre3">tcsh</span><span class="calibre_13">.</span></p><p id="calibre_link-397" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.4.1  The bash Shell</span></span></span></p><p class="calibre_45"><span class="calibre_13">In </span><span class="calibre3">bash</span><span class="calibre_13">, you can choose from the startup filenames </span><span class="italic">.bash_profile</span><span class="calibre_13">, </span><span class="italic">.profile</span><span class="calibre_13">, </span><span class="italic">.bash_login</span><span class="calibre_13">, and </span><span class="italic">.bashrc</span><span class="calibre_13">. Which one is appropriate for your command path, manual page path, prompt, aliases, and permissions mask? The answer is that you should have a </span><span class="italic">.bashrc</span><span class="calibre_13"> file accompanied by a </span><span class="italic">.bash_profile</span><span class="calibre_13"> symbolic link pointing to </span><span class="italic">.bashrc </span><span class="calibre_13">because there are a few different kinds of </span><span class="calibre3">bash</span><span class="calibre_13"> shell instance types.</span></p><p class="calibre_27"><span class="calibre_13"> The two main shell instance types are interactive and noninteractive, but we’re interested only in interactive shells, because noninteractive shells (such as those that run shell scripts) usually don’t read any startup files. Interactive shells are those you use to run commands from a terminal, such as the ones you’ve seen in this book, and they can be classified as </span><span class="italic">login</span><span class="calibre_13"> or </span><span class="italic">non-login</span><span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">Login Shells</span></p><p class="calibre_25"><span class="calibre_13">Traditionally, a login shell is what you get when you first log in to a system with the terminal using a program such as </span><span class="italic">/bin/login</span><span class="calibre_13">. Logging in remotely with SSH also gives you a login shell. The basic idea is that the login shell is an initial shell. You can tell if a shell is a login shell by running </span><span class="calibre3">echo $0</span><span class="calibre_13">; if the first character is a </span><span class="calibre3">-</span><span class="calibre_13">, the shell’s a login shell.</span></p><p class="calibre_27"><span class="calibre_13"> When </span><span class="calibre3">bash</span><span class="calibre_13"> runs as a login shell, it runs </span><span class="italic">/etc/profile</span><span class="calibre_13">. Then it looks for a user’s </span><span class="italic">.bash_profile</span><span class="calibre_13">, </span><span class="italic">.bash_login</span><span class="calibre_13">, and </span><span class="italic">.profile</span><span class="calibre_13"> files, running only the first one that it sees.</span></p><p class="calibre_27"><span class="calibre_13"> As strange as it sounds, it’s possible to run a noninteractive shell as a login shell to force it to run startup files. To do so, start the shell with the </span><span class="calibre3">-l</span><span class="calibre_13"> or </span><span class="calibre3">--login</span><span class="calibre_13"> option.</span></p><p id="calibre_link-818" class="calibre_46"><span class="bold">Non-Login Shells</span></p><p class="calibre_25"><span class="calibre_13">A non-login shell is an additional shell that you run after you log in. It’s simply any interactive shell that’s not a login shell. Windowing system terminal programs (</span><span class="calibre3">xterm</span><span class="calibre_13">, GNOME Terminal, and so on) start non-login shells unless you specifically ask for a login shell.</span></p><p class="calibre_27"><span class="calibre_13"> Upon starting up as a non-login shell, </span><span class="calibre3">bash</span><span class="calibre_13"> runs </span><span class="italic">/etc/bash.bashrc</span><span class="calibre_13"> and then runs the user’s </span><span class="italic">.bashrc</span><span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">The Consequences of Two Kinds of Shells</span></p><p class="calibre_25"><span class="calibre_13">The reasoning behind the two different startup files is that in the old days, users logged in through a traditional terminal with a login shell, and then started non-login subshells with windowing systems or the </span><span class="calibre3">screen</span><span class="calibre_13"> program. For the non-login subshells, it was deemed a waste to repeatedly set the user environment and run a bunch of programs that had already been run. With login shells, you could run fancy startup commands in a file such as </span><span class="italic">.bash_profile</span><span class="calibre_13">, leaving only aliases and other “lightweight” things to your </span><span class="italic">.bashrc</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> Nowadays, most desktop users log in through a graphical display manager (you’ll learn more about these in the next chapter). Most of these start with one noninteractive login shell in order to preserve the login versus non-login model. When they do not, you need to set up your entire environment (path, manual path, and so on) in your </span><span class="italic">.bashrc</span><span class="calibre_13">, or you’ll never see any of your environment in your terminal window shells. However, you </span><span class="italic">also</span><span class="calibre_13"> need a </span><span class="italic">.bash_profile</span><span class="calibre_13"> if you ever want to log in on the console or remotely, because those login shells don’t ever bother with </span><span class="italic">.bashrc</span><span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">Example .bashrc</span></p><p class="calibre_25"><span class="calibre_13">In order to satisfy both non-login and login shells, how would you create a </span><span class="italic">.bashrc</span><span class="calibre_13"> that can also be used as your </span><span class="italic">.bash_profile</span><span class="calibre_13">? Here’s one very elementary (yet perfectly sufficient) example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># Command path.<br class="calibre7" />PATH=/usr/local/bin:/usr/bin:/bin:/usr/games<br class="calibre7" />PATH=$HOME/bin:$PATH<br class="calibre7" /># PS1 is the regular prompt. <br class="calibre7" /># Substitutions include:<br class="calibre7" /># \u username \h hostname \w current directory<br class="calibre7" /># \! history number \s shell name \$ $ if regular user<br class="calibre7" />PS1='\u\$ '<br class="calibre7" /># EDITOR and VISUAL determine the editor that programs such as less<br class="calibre7" /># and mail clients invoke when asked to edit a file.<br class="calibre7" />EDITOR=vi<br class="calibre7" />VISUAL=vi<br class="calibre7" /># PAGER is the default text file viewer for programs such as man.<br class="calibre7" />PAGER=less<br class="calibre7" /># These are some handy options for less.# A different style is LESS=FRX<br class="calibre7" /># (F=quit at end, R=show raw characters, X=don't use alt screen)<br class="calibre7" />LESS=meiX<br class="calibre7" /># You must export environment variables.<br class="calibre7" />export PATH EDITOR VISUAL PAGER LESS<br class="calibre7" /># By default, give other users read-only access to most new files.<br class="calibre7" />umask 022</span></blockquote><a id="calibre_link-576"></a></blockquote><p class="calibre_30"><span class="calibre_13"> In this startup file, the path has </span><span class="calibre3">$HOME/bin</span><span class="calibre_13"> at the front so that executables there take precedence over the system versions. If you need the system executables, add </span><span class="calibre3">/sbin</span><span class="calibre_13"> and </span><span class="calibre3">/usr/sbin</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> As described earlier, you can share this </span><span class="italic">.bashrc</span><span class="calibre_13"> file with </span><span class="italic">.bash_profile</span><span class="calibre_13"> via a symbolic link, or you can make the relationship even clearer by creating </span><span class="italic">.bash_profile</span><span class="calibre_13"> as this one-liner:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">. $HOME/.bashrc</span></blockquote></blockquote><p class="calibre_42"><span class="bold">Checking for Login and Interactive Shells</span></p><p class="calibre_25"><span class="calibre_13">With a </span><span class="italic">.bashrc</span><span class="calibre_13"> matching your </span><span class="italic">.bash_profile</span><span class="calibre_13">, you don’t normally run extra commands for login shells. However, if you want to define different actions for login and non-login shells, you can add the following test to your </span><span class="italic">.bashrc</span><span class="calibre_13">, which checks the shell’s </span><span class="calibre3">$-</span><span class="calibre_13"> variable for an </span><span class="calibre3">i</span><span class="calibre_13"> character:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">case $- in *i*) # interactive commands go here</span><span class="calibre3"><span class="italic">&nbsp;&nbsp;&nbsp; command&nbsp;&nbsp;&nbsp; --snip--</span></span><span class="calibre3"> ;; *)&nbsp;&nbsp; # non-interactive commands go here </span><span class="calibre3"><span class="italic">command</span></span><span class="calibre3"> --</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">-- ;;<br class="calibre7" />esac</span></blockquote></blockquote><p id="calibre_link-398" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">13.4.2  The tcsh Shell</span></span></span></p><p class="calibre_45"><span class="calibre_13">The standard </span><span class="calibre3">csh</span><span class="calibre_13"> on virtually all Linux systems is </span><span class="calibre3">tcsh</span><span class="calibre_13">, an enhanced C shell that popularized features such as command-line editing and multimode filename and command completion. Even if you don’t use </span><span class="calibre3">tcsh</span><span class="calibre_13"> as the default new user shell (</span><span class="calibre3">bash</span><span class="calibre_13"> should be the default), you should still provide </span><span class="calibre3">tcsh</span><span class="calibre_13"> startup files in case your users happen to come across </span><span class="calibre3">tcsh</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You don’t have to worry about the difference between login shells and non-login shells in </span><span class="calibre3">tcsh</span><span class="calibre_13">. Upon startup, </span><span class="calibre3">tcsh</span><span class="calibre_13"> looks for a </span><span class="italic">.tcshrc</span><span class="calibre_13"> file. Failing this, it looks for the </span><span class="calibre3">csh</span><span class="calibre_13"> shell’s </span><span class="italic">.cshrc</span><span class="calibre_13"> startup file. The reason for this order is that you can use the </span><span class="italic">.tcshrc</span><span class="calibre_13"> file for </span><span class="calibre3">tcsh</span><span class="calibre_13"> extensions that don’t work in </span><span class="calibre3">csh</span><span class="calibre_13">. You should probably stick to using the traditional </span><span class="italic">.cshrc</span><span class="calibre_13"> instead of </span><span class="italic">.tcshrc</span><span class="calibre_13">; it’s highly unlikely that anyone will ever use your startup files with </span><span class="calibre3">csh</span><span class="calibre_13">. And if a user actually does come across </span><span class="calibre3">csh</span><span class="calibre_13"> on some other system, your </span><span class="italic">.cshrc</span><span class="calibre_13"> will work.</span></p><p id="calibre_link-671" class="calibre_46"><span class="bold">Example .cshrc</span></p><p class="calibre_25"><span class="calibre_13">Here is a sample </span><span class="italic">.cshrc</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># Command path.<br class="calibre7" />setenv PATH $HOME/bin:/usr/local/bin:/usr/bin:/bin<br class="calibre7" /># EDITOR and VISUAL determine the editor that programs such as less<br class="calibre7" /># and mail clients invoke when asked to edit a file.<br class="calibre7" />setenv EDITOR vi<br class="calibre7" />setenv VISUAL vi<br class="calibre7" /># PAGER is the default text file viewer for programs such as man.<br class="calibre7" />setenv PAGER less<br class="calibre7" /># These are some handy options for less.<br class="calibre7" />setenv LESS meiX<br class="calibre7" /># By default, give other users read-only access to most new files.<br class="calibre7" />umask 022<br class="calibre7" /># Customize the prompt.<br class="calibre7" /># Substitutions include:<br class="calibre7" /># %n username %m hostname %/ current directory<br class="calibre7" /># %h history number %l current terminal %% %<br class="calibre7" />set prompt="%m%% "</span></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-399" class="calibre_42"><span class="calibre1"><span class="bold"> 13.5 Default User Settings</span></span></p><p class="calibre_24"><span class="calibre_13">The best way to write startup files and choose defaults for new users is to experiment with a new test user on the system. Create the test user with an empty home directory and refrain from copying your own startup files to the test user’s directory. Write the new startup files from scratch.</span></p><p class="calibre_27"><span class="calibre_13">When you think you have a working setup, log in as the new test user in all possible ways (on the console, remotely, and so on). Make sure that you test as many things as possible, including the windowing system operation and manual pages. When you’re happy with the test user, create a second test user, copying the startup files from the first test user. If everything still works, you now have a new set of startup files that you can distribute to new users.</span></p><p class="calibre_27"><span class="calibre_13">This section outlines reasonable defaults for new users.</span></p><p id="calibre_link-400" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.5.1  Shell Defaults</span></span></span></p><p class="calibre_45"><span class="calibre_13">The default shell for any new user on a Linux system should be </span><span class="calibre3">bash</span><span class="calibre_13"> because:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Users interact with the same shell that they use to write shell scripts. (For many reasons, which I won’t expand upon here, <span class="calibre3">csh</span> is a notoriously bad scripting tool&mdash;don’t even think about it.)</li><li value="2" class="calibre_8"><span class="calibre3">bash</span> is the default on Linux distributions.</li><li value="3" class="calibre_8"><span class="calibre3">bash</span> uses the GNU readline library to accept input, and therefore its interface is identical to that of many other tools.</li><a id="calibre_link-672"></a><li value="4" class="calibre_8"><span class="calibre3">bash</span> gives you fine, easy-to-understand control over I/O redirection and file handles.</li></ul><p class="calibre_33"><span class="calibre_13"> However, many seasoned Unix wizards use a shell such as </span><span class="calibre3">csh</span><span class="calibre_13"> or </span><span class="calibre3">tcsh</span><span class="calibre_13"> simply because it’s what they’re most familiar with, and they can’t bear to switch. Of course, you can choose any shell you like, but choose </span><span class="calibre3">bash</span><span class="calibre_13"> if you don’t have any preference, and use </span><span class="calibre3">bash</span><span class="calibre_13"> as the default shell for any new user on the system. (Users can change their shell with the </span><span class="calibre3">chsh</span><span class="calibre_13"> command to suit their individual preference.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There are plenty of other shells out there (</span></span><span class="calibre3">rc</span><span class="italic"><span class="calibre_13">, </span></span><span class="calibre3">ksh</span><span class="italic"><span class="calibre_13">, </span></span><span class="calibre3">zsh</span><span class="italic"><span class="calibre_13">, </span></span><span class="calibre3">es</span><span class="italic"><span class="calibre_13">, and so on). Some are not appropriate as beginner shells, but </span></span><span class="calibre3">zsh</span><span class="italic"><span class="calibre_13"> and </span></span><span class="calibre3">fish</span><span class="italic"><span class="calibre_13"> are sometimes popular with new users looking for an alternative shell.</span></span></blockquote><p id="calibre_link-401" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">13.5.2  Editor</span></span></span></p><p class="calibre_45"><span class="calibre_13">On traditional systems, the default editor is </span><span class="calibre3">vi</span><span class="calibre_13"> or </span><span class="calibre3">emacs</span><span class="calibre_13">. These are the only editors virtually guaranteed to exist (or at least be available) on nearly any Unix system, which means they’ll cause the least trouble in the long run for a new user. However, Linux distributions often configure </span><span class="calibre3">nano</span><span class="calibre_13"> to be the default editor, because it’s easier for beginners to use.</span></p><p class="calibre_27"><span class="calibre_13"> As with shell startup files, avoid large default editor startup files. A little </span><span class="calibre3">set</span><span class="calibre_13">
</span><span class="calibre3">showmatch</span><span class="calibre_13"> in the </span><span class="italic">.exrc</span><span class="calibre_13"> startup file (to have </span><span class="calibre3">vi</span><span class="calibre_13"> show matching parentheses) never hurt anyone, but steer clear of anything that significantly changes the editor’s behavior or appearance, such as the </span><span class="calibre3">showmode</span><span class="calibre_13"> feature, auto-indentation, and wrap margins.</span></p><p id="calibre_link-402" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">13.5.3  Pager</span></span></span></p><p class="calibre_45"><span class="calibre_13">The pager is a program, such as </span><span class="calibre3">less</span><span class="calibre_13">, that shows text one page at a time. It’s perfectly reasonable to set the default </span><span class="calibre3">PAGER</span><span class="calibre_13"> environment variable to </span><span class="calibre3">less</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-403" class="calibre_23"><span class="calibre1"><span class="bold"> 13.6 Startup File Pitfalls</span></span></p><p class="calibre_24"><span class="calibre_13">Avoid these pitfalls in startup files:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Don’t put any kind of graphical command in a shell startup file. Not all shells run in graphical environments.</li><li value="2" class="calibre_8"> Don’t set the <span class="calibre3">DISPLAY</span> environment variable in a shell startup file. We haven’t looked at graphical environments yet, but this can cause your graphical session to misbehave.</li><li value="3" class="calibre_8">Don’t set the terminal type in a shell startup file.</li><li value="4" class="calibre_8">Don’t skimp on descriptive comments in default startup files.</li><li value="5" class="calibre_8">Don’t run commands in a startup file that print to the standard output.</li><li value="6" class="calibre_8"> Never set <span class="calibre3">LD_LIBRARY_PATH</span> in a shell startup file (see Section 15.1.3).</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-404" class="calibre_23"><span class="calibre1"><span class="bold">13.7 Further Startup Topics</span></span></p><p class="calibre_24"><span class="calibre_13">Because this book deals only with the underlying Linux system, we won’t cover windowing environment startup files. This is a large issue indeed, because the display manager that logs you in to a modern Linux system has its own set of startup files, such as </span><span class="italic">.xsession</span><span class="calibre_13">, </span><span class="italic">.xinitrc</span><span class="calibre_13">, and the endless combinations of GNOME- and KDE-related items.</span></p><p class="calibre_27"><span class="calibre_13">The windowing choices may seem bewildering, and there is no one common way to start a windowing environment in Linux. The next chapter describes some of the many possibilities. However, when you determine what your system does, you might get a little carried away with the files that relate to your graphical environment. That’s fine, but don’t carry it over to new users. The same tenet of keeping things simple in shell startup files works wonders for GUI startup files, too. In fact, you probably don’t need to change your GUI startup files at all.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-405" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-673" class="calibre_10"><span class="calibre4"><span class="bold">14</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">A BRIEF SURVEY OF THE LINUX DESKTOP AND PRINTING</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">This chapter is a quick introduction to the components found in a typical Linux desktop system. Of all of the different kinds of software on Linux systems, the desktop arena is one of the wildest and most colorful, because there are so many environments and applications from which to choose, and most distributions make it relatively easy for you to try them out.</span></span></p><p class="calibre_33"><span class="calibre_13">Unlike other parts of a Linux system, such as storage and networking, creating a desktop structure doesn’t involve an extensive hierarchy of layers. Instead, each component performs a specific task, communicating with other components as necessary. Some components do share common building blocks (in particular, libraries for graphical toolkits), and you can think of those as simple abstraction layers, but that’s about as deep as it goes.</span></p><p class="calibre_27"><span class="calibre_13"> This chapter offers a high-level discussion of desktop components in general, but we’ll look at two pieces in a little more detail: the core infrastructure behind most desktops, and </span><span class="italic">D-Bus</span><span class="calibre_13">, an interprocess communication service used in many parts of the system. We’ll limit the hands-on discussion and examples to a few diagnostic utilities that, although not terribly useful day to day (most GUIs don’t require you to enter shell commands in order to interact with them), will help you understand the underlying mechanics of the system and perhaps provide some entertainment along the way. We’ll also take a quick look at printing, as desktop workstations often share a common printer.</span><a id="calibre_link-674"></a></p><div class="mbp_pagebreak"></div><p id="calibre_link-406" class="calibre_23"><span class="calibre1"><span class="bold"> 14.1 Desktop Components</span></span></p><p class="calibre_24"><span class="calibre_13">Linux desktop configurations offer a great deal of flexibility. Most of what the Linux user experiences (the “look and feel” of the desktop) comes from applications or building blocks of applications. If you don’t like a particular application, you can usually find an alternative. And if what you’re looking for doesn’t exist, you can write it yourself. Linux developers tend to have a wide variety of preferences for how a desktop should act, which makes for a lot of choices.</span></p><p class="calibre_27"><span class="calibre_13"> In order to work together, all applications need to have something in common. At the time of this writing, the core of the Linux desktop is in a transitional state. From the beginning until recently, Linux desktops used X (</span><span class="italic">X Window System</span><span class="calibre_13">, also known as </span><span class="italic">Xorg</span><span class="calibre_13">, after its maintaining organization). However, this is now changing; many distributions have transitioned to a software set based on the </span><span class="italic">Wayland</span><span class="calibre_13"> protocol to build a windowing system.</span></p><p class="calibre_27"><span class="calibre_13">To understand what’s driving this change in the underlying technology, let’s take a step back and look at a few graphics basics.</span></p><p id="calibre_link-407" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.1  Framebuffers</span></span></span></p><p class="calibre_45"><span class="calibre_13">At the bottom of any graphical display mechanism is the </span><span class="italic">framebuffer</span><span class="calibre_13">, a chunk of memory that the graphics hardware reads and transmits to the screen for display. A few individual bytes in the framebuffer represent each pixel of the display, so the idea is that if you want to change the way something looks, you need to write new values to the framebuffer memory.</span></p><p class="calibre_27"><span class="calibre_13">One problem that a windowing system must solve is how to manage writing to the framebuffer. On any contemporary system, windows (or sets of windows) belong to individual processes, doing all of their graphics updates independently. So if the user is allowed to move windows around and overlap some on top of others, how does an application know where to draw its graphics, and how do you make sure that one application isn’t allowed to overwrite the graphics of other windows?</span></p><p id="calibre_link-408" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.2  The X Window System</span></span></span></p><p class="calibre_45"><span class="calibre_13">The approach that the X Window System takes is to have a server (called the </span><span class="italic">X server</span><span class="calibre_13">) that acts as a sort of “kernel” of the desktop to manage everything from rendering windows to configuring displays to handling input from devices, such as keyboards and mice. The X server doesn’t dictate the way anything should act or appear. Instead, X </span><span class="italic">client</span><span class="calibre_13"> programs handle the user interface. Basic X client applications, such as terminal windows and web browsers, make connections to the X server and ask to draw windows. In response, the X server figures out where to place the windows and where to render client graphics, and it takes a certain amount of responsibility for rendering graphics to the framebuffer. The X server also channels input to a client when appropriate.</span><a id="calibre_link-874"></a></p><p class="calibre_27"><span class="calibre_13">Because it acts as an intermediary for everything, the X server can be a significant bottleneck. In addition, it includes a lot of functionality that’s no longer used, and it’s also quite old, dating back to the 1980s. Somehow, it has been flexible enough to accommodate many new features that have extended its lifespan. We’ll describe the basics of how to interact with the X Window System later in this chapter.</span></p><p id="calibre_link-409" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.3  Wayland</span></span></span></p><p class="calibre_45"><span class="calibre_13">Unlike X, Wayland is significantly decentralized by design. There’s no large display server managing the framebuffer for a number of graphical clients, and there’s no centralized authority for rendering graphics. Instead, each client gets its own memory buffer (think of this as sort of a sub-framebuffer) for its own window, and a piece of software called a </span><span class="italic">compositor</span><span class="calibre_13"> combines all of the clients’ buffers into the necessary form for copying to the screen’s framebuffer. Because there is normally hardware support for this task, the compositor can be quite efficient.</span></p><p class="calibre_27"><span class="calibre_13">In some ways, the graphics model in Wayland isn’t too different from the practice that most X clients have been performing for years. Instead of getting any assistance from the X server, most clients render all of their own data as a bitmap and then send the bitmap to the X server. To acknowledge this somewhat, X has a compositing extension that has been in use for several years now.</span></p><p class="calibre_27"><span class="calibre_13"> For the task of channeling input to the correct application, most Wayland setups and many X servers use a library called </span><span class="italic">libinput</span><span class="calibre_13"> to standardize events to clients. This library is not required by the Wayland protocol, but on desktop systems, it’s nearly universal. We’ll discuss libinput in </span>Section 14.3.2<span class="calibre_13">.</span></p><p id="calibre_link-410" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.4  Window Managers</span></span></span></p><p class="calibre_45"><span class="calibre_13">A major difference between X and Wayland systems is in the </span><span class="italic">window manager</span><span class="calibre_13">, the piece of software that determines how to arrange windows on the screen and is central to the user experience. In X, the window manager is a client that acts as a helper to the server; it draws the windows’ decorations (such as title bars and close buttons), handles input events to those decorations, and tells the server where to move windows.</span></p><p class="calibre_27"><span class="calibre_13"> However, in Wayland, the window manager </span><span class="italic">is</span><span class="calibre_13"> the server, more or less. It is responsible for compositing all of the client window buffers into the display framebuffer, and it handles the channeling of input device events. As a result, it is required to do more work than a window manager in X, but much of that code can be common between window manager implementations.</span></p><p id="calibre_link-675" class="calibre_27"><span class="calibre_13">Many window manager implementations exist in both systems, but X has far more by virtue of its longevity. However, most of the popular window managers, such as Mutter (in GNOME) and Kwin (from KDE) have also been extended to include Wayland compositing support. Regardless of the underlying technology, it’s not likely that there will ever be a standard Linux window manager; because user tastes and requirements are diverse and constantly changing, new window managers appear all the time.</span></p><p id="calibre_link-411" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.5  Toolkits</span></span></span></p><p class="calibre_45"><span class="calibre_13">Desktop applications include certain common elements, such as buttons and menus, called </span><span class="italic">widgets</span><span class="calibre_13">. To speed up development and provide a common look, programmers use graphical </span><span class="italic">toolkits</span><span class="calibre_13"> to provide those elements. On operating systems like Windows or macOS, the vendor provides a common toolkit, and most programmers use that. On Linux, the GTK+ toolkit is one of the most common, but you’ll also frequently see widgets built on the Qt framework and others.</span></p><p class="calibre_27"><span class="calibre_13">Toolkits usually consist of shared libraries and support files, such as images and theme information.</span></p><p id="calibre_link-412" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.6  Desktop Environments</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although toolkits provide the user with a uniform outward appearance, some details of a desktop require a degree of cooperation between different applications. For example, one application may wish to share data with another or update a common notification bar on a desktop. To provide for those needs, toolkits and other libraries are bundled into larger packages called </span><span class="italic">desktop environments</span><span class="calibre_13">. GNOME, KDE, and Xfce are some common Linux desktop environments.</span></p><p class="calibre_27"><span class="calibre_13">Toolkits are at the core of most desktop environments, but to create a unified desktop, environments must also include numerous support files, such as icons and configurations, that make up themes. All of this is bound together with documents that describe design conventions, such as how application menus and titles should appear and how applications should react to certain system events.</span></p><p id="calibre_link-413" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.1.7  Applications</span></span></span></p><p class="calibre_45"><span class="calibre_13">At the top of the desktop are applications, such as web browsers and the terminal window. X applications can range from crude (such as the ancient </span><span class="calibre3">xclock</span><span class="calibre_13"> program) to complex (such as the Chrome web browser and LibreOffice suite). These applications normally stand alone, but they often use interprocess communication to become aware of pertinent events. For example, an application can express interest when you attach a new storage device or when you receive new email or an instant message. This communication usually occurs over D-Bus, described in </span>Section 14.5<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-414" class="calibre_23"><span class="calibre1"><span class="bold">14.2 Are You Running Wayland or X?</span></span></p><p class="calibre_24"><span class="calibre_13">As we start with our hands-on discussion, you need to determine which graphical system you have. Just open a shell and check the value of the </span><span class="calibre3">$WAYLAND_DISPLAY</span><span class="calibre_13"> environment variable. If the value is something like </span><span class="calibre3">wayland-0</span><span class="calibre_13">, you’re running Wayland. If it’s not set, you’re running X (probably; there are exceptions, but you’re not likely to come across them with this test).</span></p><p class="calibre_27"><span class="calibre_13">These two systems are not mutually exclusive. If your system uses Wayland, it is also probably running an X compatibility server. It’s also possible to start a Wayland compositor inside X, but that can get a little strange (more on this later).</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-415" class="calibre_23"><span class="calibre1"><span class="bold"> 14.3 A Closer Look at Wayland</span></span></p><p class="calibre_24"><span class="calibre_13">We’ll start with Wayland because it’s the emerging standard, currently used by default on many distributions. Unfortunately, in part due to its design and young age, there aren’t as many tools for prodding into Wayland as there are for X. We’ll do what we can.</span></p><p class="calibre_27"><span class="calibre_13"> But first, let’s talk about what Wayland </span><span class="italic">is</span><span class="calibre_13"> and </span><span class="italic">isn’t</span><span class="calibre_13">. The name </span><span class="italic">Wayland</span><span class="calibre_13"> refers to a communications protocol between a compositing window manager and graphical client program. If you go looking for a big Wayland core package, you won’t find one, but you will find the Wayland library that most clients use to speak to the protocol (at least for now).</span></p><p class="calibre_27"><span class="calibre_13"> There’s also a reference compositing window manager called Weston and a few associated clients and utilities. What </span><span class="italic">reference</span><span class="calibre_13"> means here is that Weston contains the necessary functionality of a compositor, but it’s not meant for use by the general public because it has a bare-bones interface. The idea is that developers of compositing window managers can look at the Weston source code to see how to implement critical functions correctly.</span></p><p id="calibre_link-416" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.3.1  The Compositing Window Manager</span></span></span></p><p class="calibre_45"><span class="calibre_13">Odd as it might sound, you might not know which Wayland compositing window manager you’re actually running. You might be able to find the name from an information option in the interface, but there’s no set place to look. However, you can nearly always find the running compositor process by tracking down the Unix domain socket that it uses to communicate with clients. The socket is the display name in the </span><span class="calibre3">WAYLAND_DISPLAY</span><span class="calibre_13"> environment variable, which is usually </span><span class="calibre3">wayland-0</span><span class="calibre_13"> and typically found in </span><span class="italic">/run/user/&lt;uid&gt;</span><span class="calibre_13">, where </span><span class="italic">&lt;uid&gt;</span><span class="calibre_13"> is your user ID (if not, check the </span><span class="calibre3">$XDG_RUNTIME_DIR</span><span class="calibre_13"> environment variable). Running as root, you can find the process listening on this socket with the </span><span class="calibre3">ss</span><span class="calibre_13"> command, but the output will look a little crazy:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ss -xlp | grep wayland-</span></span><span class="calibre3"><br class="calibre7" />u_str&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LISTEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /run/user/1000/wayland-0 755881&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; users:(("gnome-shell",pid=1522,fd=30),("gnome-shell",pid=1522,fd=28))</span></blockquote></blockquote><p id="calibre_link-784" class="calibre_30"><span class="calibre_13">However, you just need to pick through it; you can see here that the compositor process is </span><span class="calibre3">gnome-shell</span><span class="calibre_13">, PID 1522. Unfortunately, yet another layer of indirection is going on here; the GNOME shell is a plug-in of Mutter, which is the compositing window manager used in the GNOME desktop environment. (Here, calling the GNOME shell a plug-in is just a fancy way of saying that it calls Mutter as a library.)</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> One of the more unusual aspects of Wayland systems is the mechanism for drawing window decorations, such as title bars. In X, the window manager did it all, but in the initial implementations of Wayland, this was left up to the client applications, which sometimes led to windows having many different kinds of decorations on the same screen. Now there’s a part of the protocol called XDG-Decoration that allows the client to negotiate with the window manager to see if the window manager is willing to draw decorations.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> In the context of a Wayland compositor, you can think of the </span><span class="italic">display</span><span class="calibre_13"> as the viewable space, represented by the framebuffer. A display can span more than one monitor if more than one is connected to a computer.</span></p><p class="calibre_27"><span class="calibre_13"> Although it’s rare, you can run more than one compositor at once. One way to do this is to run compositors on separate virtual terminals. In this case, the first compositor would normally have the display name set to </span><span class="calibre3">wayland-0</span><span class="calibre_13">, the second </span><span class="calibre3">wayland-1</span><span class="calibre_13">, and so on.</span></p><p class="calibre_27"><span class="calibre_13"> You can gain a bit of insight into your compositor with the </span><span class="calibre3">weston-info</span><span class="calibre_13"> command, which shows a few characteristics of the interfaces that the compositor has available. However, you shouldn’t expect very much beyond information on your display and some input devices.</span></p><p id="calibre_link-417" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.3.2  libinput</span></span></span></p><p class="calibre_45"><span class="calibre_13">In order to get the input from devices, such as a keyboard, from the kernel to clients, a Wayland compositor needs to collect that input and direct it to an appropriate client in a standardized form. The libinput library includes the support necessary to collect the input from the various </span><span class="italic">/dev/input</span><span class="calibre_13"> kernel devices and massage them. In Wayland, the compositor doesn’t usually just pass an input event as is; it translates the event into the Wayland protocol before sending to a client.</span></p><p class="calibre_27"><span class="calibre_13"> Normally, something like libinput wouldn’t be terribly interesting to talk about, but it comes with a small utility, also called </span><span class="calibre3">libinput</span><span class="calibre_13">, that allows you to inspect input devices and events as they are presented by the kernel.</span></p><p class="calibre_27"><span class="calibre_13">Try the following to look at the available input devices (you’ll probably get a lot of output, so be prepared to page through it):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">libinput list-devices</span></span><span class="calibre3"><span class="italic">--snip--</span></span><span class="calibre3"><br class="calibre7" />Device:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cypress USB Keyboard<br class="calibre7" />Kernel:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /dev/input/event3<br class="calibre7" />Group:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6<br class="calibre7" />Seat:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seat0, default<br class="calibre7" />Capabilities:&nbsp;&nbsp;&nbsp;&nbsp; keyboard <br class="calibre7" />Tap-to-click:&nbsp;&nbsp;&nbsp;&nbsp; n/aTap-and-drag:&nbsp;&nbsp;&nbsp;&nbsp; n/a<br class="calibre7" />Tap drag lock:&nbsp;&nbsp;&nbsp; n/a<br class="calibre7" />Left-handed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n/a</span><span class="calibre3"><span class="italic">--snip--</span></span></blockquote><a id="calibre_link-820"></a></blockquote><p class="calibre_30"><span class="calibre_13"> In this partial view, you can see the type of device (keyboard) and where the kernel </span><span class="calibre3">evdev</span><span class="calibre_13"> device is (</span><span class="italic">/dev/input/event3</span><span class="calibre_13">). That device shows up when you listen for events like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">libinput debug-events --show-keycodes</span></span><span class="calibre3"><br class="calibre7" />-event2&nbsp;&nbsp; DEVICE_ADDED&nbsp;&nbsp;&nbsp;&nbsp; Power Button&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seat0 default group1&nbsp; cap:k</span><span class="calibre3"><span class="italic">--snip--</span></span><span class="calibre3"><br class="calibre7" />-event5&nbsp;&nbsp; DEVICE_ADDED&nbsp;&nbsp;&nbsp;&nbsp; Logitech T400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seat0 default group5&nbsp; cap:kp left scroll-nat scroll-button<br class="calibre7" />-event3&nbsp;&nbsp; DEVICE_ADDED&nbsp;&nbsp;&nbsp;&nbsp; Cypress USB Keyboard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; seat0 default group6&nbsp; cap:k</span><span class="calibre3"><span class="italic">--snip--</span></span><span class="calibre3"> event3&nbsp;&nbsp; KEYBOARD_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +1.04s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KEY_H (35) pressed event3&nbsp;&nbsp; KEYBOARD_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +1.10s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KEY_H (35) released event3&nbsp;&nbsp; KEYBOARD_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +3.06s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KEY_I (23) pressed event3&nbsp;&nbsp; KEYBOARD_KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +3.16s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KEY_I (23) released</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">When you run this command, move the mouse pointer around and press some keys. You’ll get some output describing these events.</span></p><p class="calibre_27"><span class="calibre_13">Remember that the libinput library is just a system for capturing kernel events. As such, it is used not only under Wayland, but also under the X Window System.</span></p><p id="calibre_link-418" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.3.3  X Compatibility in Wayland</span></span></span></p><p class="calibre_45"><span class="calibre_13">Before discussing the X Window System in general, let’s first explore its compatibility with Wayland. There are countless applications for X, and any effort to move from it to Wayland would be greatly hindered by a lack of X support. There are two simultaneous approaches to bridge the gap.</span></p><p class="calibre_27"><span class="calibre_13">The first approach is to add Wayland support to the application, creating a native Wayland application. Most graphical applications that run on X already use toolkits such as the ones found in GNOME and KDE. Because the work of adding Wayland support to these toolkits has already been done, it’s not much of a stretch to make an X application into a native Wayland application. In addition to paying attention to support for window decorations and input device configuration, a developer need only deal with the rare stray X library dependencies in an application. For many major applications, this work is already complete.</span></p><p class="calibre_27"><span class="calibre_13"> The alternative is to run an X application through a compatibility layer in Wayland. This is accomplished with an entire X server running as a Wayland client. Called </span><span class="calibre3">Xwayland</span><span class="calibre_13">, this server is really just another layer jammed underneath X clients, run by default by most compositor startup sequences. The </span><span class="calibre3">Xwayland</span><span class="calibre_13"> server needs to translate input events and maintain its window buffers separately. Introducing another middleman like this always slows things down slightly, but it’s mostly inconsequential.</span></p><p id="calibre_link-875" class="calibre_27"><span class="calibre_13">Going in reverse doesn’t work as well. You can’t run Wayland clients on X in the same way (theoretically, it’s possible to write such a system, but there’s not much point). However, you can run a compositor inside an X window. For example, if you’re running X, you can just run </span><span class="calibre3">weston</span><span class="calibre_13"> on the command line to bring up a compositor. You can open a terminal window and any other Wayland app inside, and you can even run X clients inside the compositor if you’ve started </span><span class="calibre3">Xwayland</span><span class="calibre_13"> properly.</span></p><p class="calibre_27"><span class="calibre_13"> However, if you leave this compositor running and go back to your regular X session, you might find that certain utilities don’t work as you expected, and they might also show up in the compositor window when you expected them to show up as an X window. The reason for this is that many applications on systems such as GNOME and KDE are now built with both X and Wayland support. They will look for a Wayland compositor first, and by default, the code in </span><span class="calibre3">libwayland</span><span class="calibre_13"> that looks for a display defaults to </span><span class="calibre3">wayland-0</span><span class="calibre_13"> if the </span><span class="calibre3">WAYLAND_DISPLAY</span><span class="calibre_13"> environment variable isn’t set. An application that finds a working compositor will use it if it can.</span></p><p class="calibre_27"><span class="calibre_13">The best way to avoid this is simply not to run a compositor inside X or at the same time as an X server.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-419" class="calibre_23"><span class="calibre1"><span class="bold"> 14.4 A Closer Look at the X Window System</span></span></p><p class="calibre_24"><span class="calibre_13">In contrast with Wayland-based systems, the X Window System (</span><a href="http://www.x.org/"><span class="italic"><span class="calibre_4">http://www.x.org/</span></span></a><span class="calibre_13">) has historically been very large, with the base distribution including the X server, client support libraries, and clients. Due to the emergence of desktop environments such as GNOME and KDE, the role of X has changed over time, with the focus now more on the core server that manages rendering and input devices, as well as a simplified client library.</span></p><p class="calibre_27"><span class="calibre_13"> The X server is easy to identify on your system. It’s called </span><span class="calibre3">X</span><span class="calibre_13"> or </span><span class="calibre3">Xorg</span><span class="calibre_13">. Check for it in a process listing; you’ll usually see it running with a number of options like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Xorg -core :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">:0</span><span class="calibre_13"> shown here is called the </span><span class="italic">X display</span><span class="calibre_13">, an identifier representing one or more monitors that you access with a common keyboard and/or mouse. Usually, the display just corresponds to the single monitor attached to your computer, but you can put multiple monitors under the same display. For processes running under an X session, the </span><span class="calibre3">DISPLAY</span><span class="calibre_13"> environment variable is set to the display identifier.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Displays can be further subdivided into </span></span>screens<span class="italic"><span class="calibre_13">, such as :0.0 and :0.1, but this is quite rare because X extensions like RandR can combine multiple monitors into one larger virtual screen.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> On Linux, an X server runs on a virtual terminal. In this example, the </span><span class="calibre3">vt7</span><span class="calibre_13"> argument shows that it’s been told to run on </span><span class="italic">/dev/tty7</span><span class="calibre_13"> (normally, the server starts on the first virtual terminal available). You can run more than one X server at a time on Linux by running them on separate virtual terminals, with each server having a unique display identifier. You can switch between the servers with the </span><a id="calibre_link-624"></a>CTRL-ALT-FN<span class="calibre_13"> keys or the </span><span class="calibre3">chvt</span><span class="calibre_13"> command.</span></p><p id="calibre_link-420" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.4.1  Display Managers</span></span></span></p><p class="calibre_45"><span class="calibre_13">You normally wouldn’t start the X server on the command line, because starting the server doesn’t define any clients that are supposed to run on it. If you start the server by itself, you’ll just get a blank screen. Instead, the most common way to start an X server is with a </span><span class="italic">display manager</span><span class="calibre_13">, a program that starts the server and puts a login box on the screen. When you log in, the display manager starts a set of clients, such as a window manager and file manager, so that you can start to use the machine.</span></p><p class="calibre_27"><span class="calibre_13"> Many different display managers are available, such as </span><span class="calibre3">gdm</span><span class="calibre_13"> (for GNOME) and </span><span class="calibre3">kdm</span><span class="calibre_13"> (for KDE). The </span><span class="calibre3">lightdm</span><span class="calibre_13"> in the argument list for the preceding X server invocation is a cross-platform display manager meant to be able to start GNOME or KDE sessions.</span></p><p class="calibre_27"><span class="calibre_13"> If you insist on starting an X session from a virtual console instead of using a display manager, you can run the </span><span class="calibre3">startx</span><span class="calibre_13"> or </span><span class="calibre3">xinit</span><span class="calibre_13"> command. However, the session you get will likely be a very simple one that looks completely unlike that of a display manager, because the mechanics and startup files are different.</span></p><p id="calibre_link-421" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.4.2  Network Transparency</span></span></span></p><p class="calibre_45"><span class="calibre_13">One feature of X is network transparency. Because clients talk to the server using a protocol, it’s possible to run clients across a network to a server running on a different machine directly over the network, with the X server listening for TCP connections on port 6000. Clients connecting to that port could authenticate and then send windows to the server.</span></p><p class="calibre_27"><span class="calibre_13"> Unfortunately, this method doesn’t normally offer any encryption and is insecure as a result. To close this hole, most distributions now disable the X server’s network listener (with the </span><span class="calibre3">-nolisten tcp</span><span class="calibre_13"> option to the server). However, you can still run X clients from a remote machine with SSH tunneling, as described in </span>Chapter 10<span class="calibre_13">, by connecting the X server’s Unix domain socket to a socket on the remote machine.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> There is no simple way to run remotely with Wayland, because clients have their own screen memory that the compositor must access directly in order to display. However, many emerging systems, such as RDP (Remote Desktop Protocol), can work in conjunction with the compositor to provide remote functionality.</span></span></blockquote><p id="calibre_link-422" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">14.4.3 Ways of Exploring X Clients</span></span></span></p><p class="calibre_45"><span class="calibre_13">Although one doesn’t normally think of working with a graphical user interface from the command line, several utilities allow you to explore the parts of the X Window System. In particular, you can inspect clients as they run.</span></p><p id="calibre_link-878" class="calibre_27"><span class="calibre_13">One of the simplest tools is </span><span class="calibre3">xwininfo</span><span class="calibre_13">. When run without any arguments, it asks you to click on a window:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">xwininfo</span></span><span class="calibre3"> xwininfo: Please select the window about which you would like information by clicking the mouse in that window.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">After you click, it prints a list of information about the window, such as its location and size:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">xwininfo: Window id: 0x5400024 "xterm" Absolute upper-left X:&nbsp; 1075 Absolute upper-left Y:&nbsp; 594<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice the window ID here. The X server and window managers use this identifier to keep track of windows. To get a list of all window IDs and clients, use the </span><span class="calibre3">xlsclients -l</span><span class="calibre_13"> command.</span></p><p id="calibre_link-423" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.4.4  X Events</span></span></span></p><p class="calibre_45"><span class="calibre_13">X clients get their input and other information about the state of the server through a system of events. X events work like other asynchronous interprocess communication events, such as udev events and D-Bus events. The X server receives information from a source, such as an input device, and then redistributes that input as an event to any interested X client.</span></p><p class="calibre_27"><span class="calibre_13"> You can experiment with events via the </span><span class="calibre3">xev</span><span class="calibre_13"> command. Running it opens a new window that you can mouse into, click, and type. As you do so, </span><span class="calibre3">xev</span><span class="calibre_13"> generates output describing the X events that it receives from the server. For example, here’s sample output for mouse movement:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">xev</span></span><span class="calibre3"><span class="italic">--snip--</span></span><span class="calibre3"><br class="calibre7" />MotionNotify event, serial 36, synthetic NO, window 0x6800001, root 0xbb, subw 0x0, time 43937883, (47,174), root:(1692,486), state 0x0, is_hint 0, same_screen YES<br class="calibre7" />MotionNotify event, serial 36, synthetic NO, window 0x6800001, root 0xbb, subw 0x0, time 43937891, (43,177), root:(1688,489), state 0x0, is_hint 0, same_screen YES</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice the coordinates in parentheses. The first pair represents the x- and y-coordinates of the mouse pointer inside the window, and the second (</span><span class="calibre3">root:</span><span class="calibre_13">) is the location of the pointer on the entire display.</span></p><p class="calibre_27"><span class="calibre_13">Other low-level events include keypresses and button clicks, but more advanced ones indicate whether the mouse has entered or exited the window, or whether the window has gained or lost focus from the window manager. For example, here are corresponding exit and unfocus events.</span></p><p id="calibre_link-815" class="calibre_63">
</p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">LeaveNotify event, serial 36, synthetic NO, window 0x6800001, root 0xbb, subw 0x0, time 44348653, (55,185), root:(1679,420), mode NotifyNormal, detail NotifyNonlinear, same_screen YES, focus YES, state 0<br class="calibre7" />FocusOut event, serial 36, synthetic NO, window 0x6800001, mode NotifyNormal, detail NotifyNonlinear</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> One common use of </span><span class="calibre3">xev</span><span class="calibre_13"> is to extract keycodes and key symbols for different keyboards when remapping the keyboard. Here’s the output from pressing the L key; the keycode here is 46:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">KeyPress event, serial 32, synthetic NO, window 0x4c00001, root 0xbb, subw 0x0, time 2084270084, (131,120), root:(197,172), state 0x0, keycode 46 (keysym 0x6c, l), same_screen YES, XLookupString gives 1 bytes: (6c) "l" XmbLookupString gives 1 bytes: (6c) "l" XFilterEvent returns: False</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also attach </span><span class="calibre3">xev</span><span class="calibre_13"> to an existing window ID with the </span><span class="calibre3">-id </span><span class="calibre3"><span class="italic">id</span></span><span class="calibre_13"> option. Replace </span><span class="calibre3"><span class="italic">id</span></span><span class="calibre_13"> with the ID you get from </span><span class="calibre3">xwininfo</span><span class="calibre_13"> (it will be a hexadecimal number starting with </span><span class="calibre3">0x</span><span class="calibre_13">).</span></p><p id="calibre_link-424" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.4.5  X Input and Preference Settings</span></span></span></p><p class="calibre_45"><span class="calibre_13">One of the most potentially baffling characteristics of X is that there’s often more than one way to set preferences, and some methods may not work. For example, one common keyboard preference on Linux systems is to remap the </span>CAPS LOCK<span class="calibre_13"> key to a </span>CTRL<span class="calibre_13"> key. There are a number of ways to do this, from making small adjustments with the old </span><span class="calibre3">xmodmap</span><span class="calibre_13"> command to providing an entirely new keyboard map with the </span><span class="calibre3">setxkbmap</span><span class="calibre_13"> utility. How do you know which one (if any) to use? It’s a matter of knowing which pieces of the system have responsibility, but determining this can be difficult. Keep in mind that a desktop environment may provide its own settings and overrides. With this said, here are a few pointers on the underlying infrastructure.</span></p><p class="calibre_46"><span class="bold">Input Devices (General)</span></p><p class="calibre_25"><span class="calibre_13">The X server uses the </span><span class="italic">X Input Extension</span><span class="calibre_13"> to manage input from many different devices. There are two basic types of input device&mdash;keyboard and pointer (mouse)&mdash;and you can attach as many devices as you like. To handle more than one of the same type of device simultaneously, the X Input Extension creates a </span><span class="italic">virtual core</span><span class="calibre_13"> device that funnels device input to the X server.</span></p><p class="calibre_27"><span class="calibre_13"> To see the device configuration on your machine, run the </span><span class="calibre3">xinput --list</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">xinput --list</span></span><span class="calibre3"><br class="calibre7" />∣ Virtual core pointer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=2&nbsp;&nbsp;&nbsp; [master pointer&nbsp; (3)]<br class="calibre7" />∣&nbsp;&nbsp; ↳Virtual core XTEST pointer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=4&nbsp;&nbsp;&nbsp; [slave&nbsp; pointer&nbsp; (2)]∣&nbsp;&nbsp; ↳ Logitech Unifying Device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=8&nbsp;&nbsp;&nbsp; [slave&nbsp; pointer&nbsp; (2)]<br class="calibre7" />⌊ Virtual core keyboard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=3&nbsp;&nbsp;&nbsp; [master keyboard (2)] ↳ Virtual core XTEST keyboard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=5&nbsp;&nbsp;&nbsp; [slave&nbsp; keyboard (3)] ↳ Power Button&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=6&nbsp;&nbsp;&nbsp; [slave&nbsp; keyboard (3)] ↳ Power Button&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=7&nbsp;&nbsp;&nbsp; [slave&nbsp; keyboard (3)] ↳ Cypress USB Keyboard&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id=9&nbsp;&nbsp;&nbsp; [slave&nbsp; keyboard (3)]</span></blockquote><a id="calibre_link-836"></a></blockquote><p class="calibre_30"><span class="calibre_13"> Each device has an associated ID that you can use with </span><span class="calibre3">xinput</span><span class="calibre_13"> and other commands. In this output, IDs 2 and 3 are the core devices, and IDs 8 and 9 are the real devices. Notice that the power buttons on the machine are also treated as X input devices.</span></p><p class="calibre_27"><span class="calibre_13">Most X clients listen for input from the core devices, because there’s no reason for them to be concerned about which particular device initiates an event. In fact, most clients know nothing about the X Input Extension. However, a client can use the extension to single out a particular device.</span></p><p class="calibre_27"><span class="calibre_13"> Each device has a set of associated </span><span class="italic">properties</span><span class="calibre_13">. To view the properties, use </span><span class="calibre3">xinput</span><span class="calibre_13"> with the device number:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">xinput --list-props 8</span></span><span class="calibre3"><br class="calibre7" />Device 'Logitech Unifying Device. Wireless PID:4026': Device Enabled (126):&nbsp;&nbsp; 1 Coordinate Transformation Matrix (128): 1.000000, 0.000000, 0.000000, 0.000000, 1.000000, 0.000000, 0.000000, 0.000000, 1.000000 Device Accel Profile (256):&nbsp;&nbsp;&nbsp;&nbsp; 0 Device Accel Constant Deceleration (257):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000000 Device Accel Adaptive Deceleration (258):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000000 Device Accel Velocity Scaling (259):&nbsp;&nbsp;&nbsp; 10.000000</span><span class="calibre3"><span class="italic">--snip--</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can change a number of properties with the </span><span class="calibre3">--set-prop</span><span class="calibre_13"> option. See the xinput(1) manual page for more information.</span></p><p class="calibre_46"><span class="bold">Mouse</span></p><p class="calibre_25"><span class="calibre_13">You can manipulate device-related settings with the </span><span class="calibre3">xinput</span><span class="calibre_13"> command, and many of the most useful options pertain to the mouse (pointer). You can change many settings directly as properties, but it’s usually easier with the specialized </span><span class="calibre3">--set-ptr-feedback</span><span class="calibre_13"> and </span><span class="calibre3">--set-button-map</span><span class="calibre_13"> options to </span><span class="calibre3">xinput</span><span class="calibre_13">. For example, if you have a three-button mouse at </span><span class="calibre3"><span class="italic">dev</span></span><span class="calibre_13"> on which you’d like to reverse the order of buttons (this is handy for left-handed users), try this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">xinput --set-button-map </span></span><span class="calibre3"><span class="italic"><span class="bold">dev</span></span></span><span class="calibre3"><span class="bold"> 3 2 1</span></span></blockquote></blockquote><p class="calibre_42"><span class="bold">Keyboard</span></p><p class="calibre_25"><span class="calibre_13">The many different keyboard layouts available internationally present particular difficulties for integration into any windowing system. X has always had an internal keyboard-mapping capability in its core protocol that you can manipulate with the </span><span class="calibre3">xmodmap</span><span class="calibre_13"> command, but any halfway recent system uses XKB (the X keyboard extension) to gain finer control.</span></p><p id="calibre_link-661" class="calibre_27"><span class="calibre_13">XKB is complicated, so much so that many people still use </span><span class="calibre3">xmodmap</span><span class="calibre_13"> when they need to make quick changes. The basic idea behind XKB is that you can define a keyboard map, compile it with the </span><span class="calibre3">xkbcomp</span><span class="calibre_13"> command, and then load and activate that map in the X server with the </span><span class="calibre3">setxkbmap</span><span class="calibre_13"> command. This system has two especially interesting features:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> You can define partial maps to supplement existing maps. This is particularly handy for tasks such as changing your CAPS LOCK key into a CTRL key, and it is used by many graphical keyboard preference utilities in desktop environments.</li><li value="2" class="calibre_8">You can define individual maps for each attached keyboard.</li></ul><p class="calibre_46"><span class="bold">Desktop Background</span></p><p class="calibre_25"><span class="calibre_13">The </span><span class="italic">root window</span><span class="calibre_13"> of your X server is the background of the display. The old X command </span><span class="calibre3">xsetroot</span><span class="calibre_13"> allows you to set the background color and other characteristics of the root window, but it has no effect on most machines because the root window is never visible. Instead, most desktop environments place a big window in the back of all of your other windows in order to enable features such as “active wallpaper” and desktop file browsing. There are ways to change the background from the command line (for example, with the </span><span class="calibre3">gsettings</span><span class="calibre_13"> command in some GNOME installations), but if you actually </span><span class="italic">want</span><span class="calibre_13"> to do this, you probably have too much time on your hands.</span></p><p class="calibre_46"><span class="bold">xset</span></p><p class="calibre_25"><span class="calibre_13">Probably the oldest preference command is </span><span class="calibre3">xset</span><span class="calibre_13">. It’s not used much anymore, but you can run a quick </span><span class="calibre3">xset q</span><span class="calibre_13"> to get the status of a few features. Perhaps the most useful are the screensaver and </span><span class="italic">Display Power Management Signaling (DPMS)</span><span class="calibre_13"> settings.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-425" class="calibre_23"><span class="calibre1"><span class="bold"> 14.5 D-Bus</span></span></p><p class="calibre_24"><span class="calibre_13">One of the most important developments to come out of the Linux desktop is the</span><span class="italic"> Desktop Bus (D-Bus)</span><span class="calibre_13">, a message-passing system. D-Bus is important because it serves as an interprocess communication mechanism that allows desktop applications to talk to each other, and because most Linux systems use it to notify processes of system events, such as inserting a USB drive.</span></p><p class="calibre_27"><span class="calibre_13"> D-Bus itself consists of a library that standardizes interprocess communication with a protocol and supporting functions for any two processes to talk to each other. By itself, this library doesn’t offer much more than a fancy version of normal IPC facilities, such as Unix domain sockets. What makes D-Bus useful is a central “hub” called </span><span class="calibre3">dbus-daemon</span><span class="calibre_13">. Processes that need to react to events can connect to </span><span class="calibre3">dbus-daemon</span><span class="calibre_13"> and register to receive certain kinds of events. Connecting processes also create the events. For example, the process </span><span class="calibre3">udisks-daemon</span><span class="calibre_13"> monitors udev for disk events and sends them to </span><span class="calibre3">dbus-daemon</span><span class="calibre_13">, which then retransmits the events to applications interested in disk events.</span></p><p id="calibre_link-426" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.5.1  System and Session Instances</span></span></span></p><p class="calibre_45"><span class="calibre_13">D-Bus has become an integral part of the Linux system, and it now reaches beyond the desktop. For example, both systemd and Upstart have D-Bus channels of communication. However, adding dependencies to desktop tools inside the core system goes against a design rule of Linux.</span></p><p class="calibre_27"><span class="calibre_13"> To address this problem, there are actually two kinds of </span><span class="calibre3">dbus-daemon</span><span class="calibre_13"> instances (processes) that can run. The first is the </span><span class="italic">system instance</span><span class="calibre_13">, which is started by init at boot time with the </span><span class="calibre3">--system</span><span class="calibre_13"> option. The system instance usually runs as a D-Bus user, and its configuration file is </span><span class="italic">/etc/dbus-1/system.conf</span><span class="calibre_13"> (though you probably shouldn’t change the configuration). Processes can connect to the system instance through the </span><span class="italic">/var/run/dbus/system_bus_socket</span><span class="calibre_13"> Unix domain socket.</span></p><p class="calibre_27"><span class="calibre_13"> Independent of the system D-Bus instance is an optional </span><span class="italic">session instance</span><span class="calibre_13"> that runs only when you start a desktop session. Desktop applications that you run connect to this instance.</span></p><p id="calibre_link-427" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.5.2  D-Bus Message Monitoring</span></span></span></p><p class="calibre_45"><span class="calibre_13">One of the best ways to see the difference between system and session </span><span class="calibre3">dbus-daemon</span><span class="calibre_13"> instances is to monitor the events that go over the bus. Try using the </span><span class="calibre3">dbus-monitor</span><span class="calibre_13"> utility in system mode like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">dbus-monitor --system</span></span><span class="calibre3"><br class="calibre7" />signal sender=org.freedesktop.DBus -&gt; dest=:1.952 serial=2 path=/org/freedesktop/DBus; interface=org.freedesktop.DBus; member=NameAcquired string ":1.952"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The startup message here indicates that the monitor connected and acquired a name. You shouldn’t see much activity when you run it like this, because the system instance usually isn’t very busy. To see something happen, try plugging in a USB storage device.</span></p><p class="calibre_27"><span class="calibre_13">By comparison, session instances have much more to do. Assuming you’ve logged in to a desktop session, try this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">dbus-monitor --session</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Now try using a desktop application, such as a file manager; if your desktop is D-Bus&ndash;aware, you should get a flurry of messages indicating various changes. Keep in mind that not all applications will produce messages.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-428" class="calibre_23"><span class="calibre1"><span class="bold"> 14.6 Printing</span></span></p><p class="calibre_24"><span class="calibre_13">Printing a document on Linux is a multistage process:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">The program doing the printing usually converts the document into PostScript form. This step is optional.</li><li value="2" class="calibre_8">The program sends the document to a print server.</li><li value="3" class="calibre_8">The print server receives the document and places it on a print queue.</li><li value="4" class="calibre_8">When the document’s turn in the queue arrives, the print server sends the document to a print filter.</li><a id="calibre_link-781"></a><li value="5" class="calibre_8">If the document is not in PostScript form, a print filter might perform a conversion.</li><li value="6" class="calibre_8">If the destination printer does not understand PostScript, a printer driver converts the document to a printer-compatible format.</li><li value="7" class="calibre_8">The printer driver adds optional instructions to the document, such as paper tray and duplexing options.</li><li value="8" class="calibre_8">The print server uses a backend to send the document to the printer.</li></ol><p class="calibre_33"><span class="calibre_13"> The most confusing part of this process is why so much revolves around PostScript. PostScript is actually a programming language, so when you print a file using it, you’re sending a program to the printer. PostScript serves as a standard for printing in Unix-like systems, much as the </span><span class="italic">.tar</span><span class="calibre_13"> format serves as an archiving standard. (Some applications now use PDF output, but this is relatively easy to convert.)</span></p><p class="calibre_27"><span class="calibre_13">We’ll talk more about the print format shortly, but first let’s look at the queuing system.</span></p><p id="calibre_link-429" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.6.1  CUPS</span></span></span></p><p class="calibre_45"><span class="calibre_13">The standard printing system in Linux is </span><span class="italic">CUPS</span><span class="calibre_13"> (</span><a href="http://www.cups.org/"><span class="italic"><span class="calibre_4">http://www.cups.org/</span></span></a><span class="calibre_13">), which is the same system used on macOS. The CUPS server daemon is called </span><span class="calibre3">cupsd</span><span class="calibre_13">, and you can use the </span><span class="calibre3">lpr</span><span class="calibre_13"> command as a simple client to send files to the daemon.</span></p><p class="calibre_27"><span class="calibre_13"> One significant feature of CUPS is that it implements the </span><span class="italic">Internet Print Protocol (IPP)</span><span class="calibre_13">, a system that allows for HTTP-like transactions among clients and servers on TCP port 631. In fact, if you have CUPS running on your system, you can probably connect to </span><span class="italic">http://localhost:631/</span><span class="calibre_13"> to see your current configuration and check on any printer jobs. Most network printers and print servers support IPP, as does Windows, which can make setting up remote printers a relatively simple task.</span></p><p class="calibre_27"><span class="calibre_13"> You probably won’t be able to administer the system from the web interface, because the default setup isn’t very secure. Instead, your distribution likely has a graphical settings interface to add and modify printers. These tools manipulate the configuration files, normally found in </span><span class="italic">/etc/cups</span><span class="calibre_13">. It’s usually best to let those tools do the work for you, because configuration can be complicated. Even if you do run into a problem and need to configure manually, it’s usually best to create a printer using the graphical tools so that you have somewhere to start.</span></p><p id="calibre_link-430" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">14.6.2  Format Conversion and Print Filters</span></span></span></p><p class="calibre_45"><span class="calibre_13">Many printers, including nearly all low-end models, do not understand PostScript or PDF. To support one of these printers, a Linux printing system must convert documents to a format specific to the printer. CUPS sends the document to a </span><span class="italic">Raster Image Processor (RIP)</span><span class="calibre_13"> to produce a bitmap. The RIP almost always uses the Ghostscript (</span><span class="calibre3">gs</span><span class="calibre_13">) program to do most of the real work, but it’s somewhat complicated, because the bitmap must fit the format of the printer. Therefore, the printer drivers that CUPS uses consult the </span><a id="calibre_link-621"></a><span class="italic">PostScript Printer Definition (PPD)</span><span class="calibre_13"> file for the specific printer to figure out settings such as resolution and paper sizes.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-431" class="calibre_23"><span class="calibre1"><span class="bold"> 14.7 Other Desktop Topics</span></span></p><p class="calibre_24"><span class="calibre_13">One interesting characteristic of the Linux desktop environment is that you can generally choose which pieces you want to use and stop using the ones that you dislike. For a survey of the many various desktop projects, have a look at the mailing lists and project links at </span><span class="italic">https://www.freedesktop.org/</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">Another major development in the Linux desktop is the Chromium OS open source project and its Google Chrome OS counterpart found on Chromebook PCs. This is a Linux system that uses much of the desktop technology described in this chapter but is centered on the Chromium/Chrome web browsers. Much of what’s found on a traditional desktop has been stripped away in Chrome OS.</span></p><p class="calibre_27"><span class="calibre_13">Though desktop environments can be fun to look at and experiment on, we’ll need to leave the discussion here. However, if this chapter piqued your interest and you think you might like to work on them, you’ll need to know how developer tools work, which is where we’re headed next.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-432" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_10"><span class="calibre4"><span class="bold">15</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">DEVELOPMENT TOOLS</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">Linux is very popular with programmers, not just due to the overwhelming array of tools and environments available but also because the system is exceptionally well documented and transparent. On a Linux machine, you don’t have to be a programmer to take advantage of development tools, which is good news, because they play a larger role in managing Linux systems than in other operating systems. At the very least, you should be able to identify development utilities and have some idea of how to run them.</span></span></p><p id="calibre_link-602" class="calibre_33"><span class="calibre_13">This chapter packs a lot of information into a small space, but you don’t need to master everything here. The examples will be very simple; you don’t need to know how to write code to follow along. You can also easily skim the material and come back later. The discussion of shared libraries is likely the most important thing that you need to know, but to understand where shared libraries come from, you first need some background on how to build programs.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-433" class="calibre_23"><span class="calibre1"><span class="bold"> 15.1 The C Compiler</span></span></p><p class="calibre_24"><span class="calibre_13">Knowing how to use the C programming language compiler can give you a great deal of insight into the origin of the programs that you see on your Linux system. Most Linux utilities and many applications on Linux systems are written in C or C++. This chapter will primarily use examples in C, but you’ll be able to carry the information over to C++.</span></p><p class="calibre_27"><span class="calibre_13"> C programs follow a traditional development process: you write programs, you compile them, and they run. That is, when you write C program code and want to run it, you must </span><span class="italic">compile</span><span class="calibre_13"> human-readable code into a binary low-level form that the computer’s processor understands. The code that you write is called </span><span class="italic">source code</span><span class="calibre_13">, and can encompass many files. You can compare this to the scripting languages that we’ll discuss later, where you don’t need to compile anything.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Most distributions do not include the tools necessary to compile C code by default. If you don’t see some of the tools described here, you can install the build-essential package for Debian/Ubuntu or the “Development Tools” </span></span><span class="calibre3">yum</span><span class="italic"><span class="calibre_13"> groupinstall for Fedora/CentOS. Failing that, try a package search for “gcc” or “C compiler.”</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The C compiler executable on most Unix systems is the GNU C compiler, </span><span class="calibre3">gcc</span><span class="calibre_13"> (often referred to by the traditional name </span><span class="calibre3">cc</span><span class="calibre_13">), though the newer </span><span class="calibre3">clang</span><span class="calibre_13"> compiler from the LLVM project is gaining popularity. C source code files end with </span><span class="italic">.c</span><span class="calibre_13">. Take a look at this single, self-contained C source code file, </span><span class="italic">hello.c</span><span class="calibre_13">, from </span><span class="italic">The C Programming Language</span><span class="calibre_13">, 2nd edition, by Brian W. Kernighan and Dennis M. Ritchie (Prentice Hall, 1988):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#include &lt;stdio.h&gt;<br class="calibre7" />int main() { printf("Hello, World.\n");<br class="calibre7" />}</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Save this source code in a file called </span><span class="italic">hello.c</span><span class="calibre_13"> and then run the compiler with this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc hello.c</span></span></blockquote></blockquote><p id="calibre_link-603" class="calibre_30"><span class="calibre_13">The result is an executable named </span><span class="italic">a.out</span><span class="calibre_13">, which you can run like any other executable on the system. However, you should probably give the executable another name (such as </span><span class="italic">hello</span><span class="calibre_13">). To do this, use the compiler’s </span><span class="calibre3">-o</span><span class="calibre_13"> option:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -o hello hello.c</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">For small programs, there isn’t much more to compiling than that. You might need to add an extra library or include directory, but let’s look at slightly larger programs before getting into those topics.</span></p><p id="calibre_link-434" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.1.1  Compiling Multiple Source Files</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most C programs are too large to reasonably fit within a single source code file. Mammoth files become too disorganized for the programmer to manage, and compilers sometimes even have trouble processing large files. Therefore, developers typically separate the source code into component pieces, giving each piece its own file.</span></p><p class="calibre_27"><span class="calibre_13"> When compiling most </span><span class="italic">.c</span><span class="calibre_13"> files, you don’t create an executable right away. Instead, use the compiler’s </span><span class="calibre3">-c</span><span class="calibre_13"> option on each file to create </span><span class="italic">object files</span><span class="calibre_13"> containing binary </span><span class="italic">object code</span><span class="calibre_13"> that will eventually go into the final executable. To see how this works, let’s say you have two files, </span><span class="italic">main.c</span><span class="calibre_13"> (which gets the program started) and </span><span class="italic">aux.c </span><span class="calibre_13">(which does the actual work), that appear as follows:</span></p><p class="calibre_27"><span class="italic">main.c</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">void hello_call();<br class="calibre7" />int main() { hello_call();<br class="calibre7" />}</span></blockquote></blockquote><p class="calibre_30"><span class="italic">aux.c</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#include &lt;stdio.h&gt;<br class="calibre7" />void hello_call() { printf("Hello, World.\n");<br class="calibre7" />}</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The following two compiler commands do most of the work of building the program: creating the object files.</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -c main.c</span></span><span class="calibre3"><br class="calibre7" />$ </span><span class="calibre3"><span class="bold">cc -c aux.c</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> After these commands complete, you’ll have two object files: </span><span class="italic">main.o</span><span class="calibre_13"> and </span><span class="italic">aux.o</span><span class="calibre_13">.</span></p><p id="calibre_link-632" class="calibre_27"><span class="calibre_13">An object file is a binary file that a processor can almost understand, except that there are still a few loose ends. First, the operating system doesn’t know how to start up an object file, and second, you likely need to combine several object files and some system libraries to make a complete program.</span></p><p class="calibre_27"><span class="calibre_13"> To build a fully functioning executable program from one or more object files, you must run the </span><span class="italic">linker</span><span class="calibre_13">, the </span><span class="calibre3">ld</span><span class="calibre_13"> command in Unix. Programmers rarely use </span><span class="calibre3">ld</span><span class="calibre_13"> on the command line, however, because the C compiler knows how to run the linker program. To create an executable called </span><span class="calibre3">myprog</span><span class="calibre_13"> from these two object files, run this command to link them:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -o myprog main.o aux.o</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Although you can compile each source file with a separate command, the preceding example already hints that it can be hard to keep track of them all during the compiling process; this challenge gets much worse as the number of source files multiplies. The </span></span><span class="calibre3">make</span><span class="italic"><span class="calibre_13"> system described in </span></span><span class="italic">Section 15.2</span><span class="italic"><span class="calibre_13"> is the traditional Unix standard for managing and automating compiles. You’ll see how important having a system like </span></span><span class="calibre3">make</span><span class="italic"><span class="calibre_13"> is as we deal with managing the files described in the next two sections.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Turn your attention back to the file </span><span class="italic">aux.c</span><span class="calibre_13">. As mentioned, its code does the actual work of the program, and there can be many files like its resultant </span><span class="italic">aux.o</span><span class="calibre_13"> object file that are necessary to build the program. Now imagine that other programs might be able to make use of the routines we wrote. Could we reuse these object files? That’s where we’re headed next.</span></p><p id="calibre_link-435" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.1.2  Linking with Libraries</span></span></span></p><p class="calibre_45"><span class="calibre_13">Running the compiler on source code usually doesn’t result in enough object code to create a useful executable program all by itself. You need </span><span class="italic">libraries</span><span class="calibre_13"> to build complete programs. A C library is a collection of common precompiled components that you can build into your program, and it’s really not much more than a bundle of object files (along with some header files, which we’ll talk about in </span>Section 15.1.4<span class="calibre_13">). For example, there’s a standard math library that many executables draw from because it provides trigonometric functions and the like.</span></p><p class="calibre_27"><span class="calibre_13"> Libraries come into play primarily at link time, when the linker program (</span><span class="calibre3">ld</span><span class="calibre_13">) creates an executable from object files. Linking using a library is often called </span><span class="italic">linking against</span><span class="calibre_13"> a library. This is where you’re most likely to have a problem. For example, if you have a program that uses the curses library but you forget to tell the compiler to link against that library, you’ll see linker errors like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold">badobject.o</span></span><span class="calibre3">(.text+0x28): undefined reference to '</span><span class="calibre3"><span class="bold">initscr</span></span><span class="calibre3">'</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The most important parts of these error messages are in bold. When the linker program examined the </span><span class="italic">badobject.o</span><span class="calibre_13"> object file, it couldn’t find the function that appears in bold, and thus it couldn’t create the executable. In this particular case, you might suspect that you forgot the curses library because the missing function is </span><a id="calibre_link-753"></a><span class="calibre3">initscr()</span><span class="calibre_13">; if you do a web search for the function name, you’ll nearly always find a manual page or some other reference to the library.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Undefined references don’t always mean that you’re missing a library. One of the program’s object files could be missing in the link command. It’s usually easy to differentiate between library functions and functions in your object files, because you’ll likely recognize the ones you wrote, or at least be able to search for them.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> To fix this problem, you must first find the curses library and then use the compiler’s </span><span class="calibre3">-l</span><span class="calibre_13"> option to link against the library. Libraries are scattered throughout the system, though most libraries reside in a subdirectory named </span><span class="italic">lib </span><span class="calibre_13">(</span><span class="italic">/usr/lib </span><span class="calibre_13">is the system default location). For the preceding example, the basic curses library file is </span><span class="italic">libcurses.a</span><span class="calibre_13">, so the library name is </span><span class="calibre3">curses</span><span class="calibre_13">. Putting it all together, you would link the program like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -o badobject badobject.o -lcurses</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You must tell the linker about nonstandard library locations; the parameter for this is </span><span class="calibre3">-L</span><span class="calibre_13">. Let’s say that the </span><span class="calibre3">badobject</span><span class="calibre_13"> program requires </span><span class="italic">libcrud.a</span><span class="calibre_13"> in </span><span class="italic">/usr/junk/lib</span><span class="calibre_13">. To compile and create the executable, use a command like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -o badobject badobject.o -lcurses -L/usr/junk/lib -lcrud</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you want to search a library for a particular function, use the </span></span><span class="calibre3">nm</span><span class="italic"><span class="calibre_13"> command with the </span></span><span class="calibre3">--defined-only</span><span class="italic"><span class="calibre_13"> symbol filter. Be prepared for a lot of output. For example, try this: </span></span><span class="calibre3">nm --defined-only libcurses.a</span><span class="italic"><span class="calibre_13">. On many distributions, you can also use the </span></span><span class="calibre3">less</span><span class="italic"><span class="calibre_13"> command to view the contents of a library. (You might need to use the </span></span><span class="calibre3">locate</span><span class="italic"><span class="calibre_13"> command to find </span></span>libcurses.a<span class="italic"><span class="calibre_13">; many distributions now put libraries in architecture-specific subdirectories in </span></span>/usr/lib<span class="italic"><span class="calibre_13">, such as </span></span>/usr/lib/x86_64-linux-gnu/<span class="italic"><span class="calibre_13">.)</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> There’s a library on your system called the C standard library, containing fundamental components considered a part of the C programming language. Its basic file is </span><span class="italic">libc.a</span><span class="calibre_13">. When you compile a program, this library is always included unless you specifically exclude it. Most programs on your system use the shared version, so let’s talk about how that works.</span></p><p id="calibre_link-436" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.1.3 Working with Shared Libraries</span></span></span></p><p class="calibre_45"><span class="calibre_13">A library file ending with </span><span class="italic">.a</span><span class="calibre_13"> (such as </span><span class="italic">libcurses.a</span><span class="calibre_13">) is called a </span><span class="italic">static library</span><span class="calibre_13">. When you link a program against a static library, the linker copies the necessary machine code from the library file into your executable. Once it does this, the final executable no longer needs the original library file when it runs, and because your executable has its own copy of the library code, the executable’s behavior is not subject to change if the </span><span class="italic">.a</span><span class="calibre_13"> file changes.</span></p><p class="calibre_27"><span class="calibre_13"> However, library sizes are always increasing, as is the number of libraries in use, and this makes static libraries wasteful in terms of disk space and memory. In addition, if a static library is later found to be inadequate or insecure, there’s no way to change the executables that had been linked against it, short of finding and recompiling every executable.</span><a id="calibre_link-817"></a></p><p class="calibre_27"><span class="italic">Shared libraries</span><span class="calibre_13"> counter these problems. Linking a program against a shared library doesn’t copy the code into the final executable; it just adds </span><span class="italic">references</span><span class="calibre_13"> to names in the code of the library file. When you run the program, the system loads the library’s code into the process memory space only when necessary. Many processes can share the same shared library code in memory. And if you need to slightly modify the library code, you can generally do so without recompiling any programs. When updating software on your Linux distribution, the packages that you’re updating can include shared libraries. When your update manager asks you to reboot your machine, sometimes it’s doing so to be sure that every part of your system is using new versions of shared libraries.</span></p><p class="calibre_27"><span class="calibre_13">Shared libraries do have their own costs: difficult management and a somewhat complicated linking procedure. However, you can bring shared libraries under control if you know four things:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">How to list the shared libraries that an executable needs</li><li value="2" class="calibre_8">How an executable looks for shared libraries</li><li value="3" class="calibre_8">How to link a program against a shared library</li><li value="4" class="calibre_8">How to avoid the common shared library pitfalls</li></ul><p class="calibre_33"><span class="calibre_13"> The following sections tell you how to use and maintain your system’s shared libraries. If you’re interested in how shared libraries work or if you want to know about linkers in general, you can check out </span><span class="italic">Linkers and Loaders</span><span class="calibre_13"> by John R. Levine (Morgan Kaufmann, 1999); “The Inside Story on Shared Libraries and Dynamic Loading” by David M. Beazley, Brian D. Ward, and Ian R. Cooke (</span><span class="italic">Computing in Science &amp; Engineering</span><span class="calibre_13">, September/October 2001); or online resources such as the Program Library HOWTO (</span><span class="italic">https://bit.ly/3q3MbS6</span><span class="calibre_13">). The ld.so(8) manual page is also worth a read.</span></p><p class="calibre_46"><span class="bold">How to List Shared Library Dependencies</span></p><p class="calibre_25"><span class="calibre_13">Shared library files usually reside in the same places as static libraries. The two standard library directories on a Linux system are </span><span class="italic">/lib</span><span class="calibre_13"> and </span><span class="italic">/usr/lib</span><span class="calibre_13">, though many more can be scattered throughout your system. The </span><span class="italic">/lib</span><span class="calibre_13"> directory should not contain static libraries.</span></p><p class="calibre_27"><span class="calibre_13"> A shared library has a suffix that contains </span><span class="italic">.so</span><span class="calibre_13"> (shared object), as in </span><span class="italic">libc-2.15.so</span><span class="calibre_13"> and </span><span class="italic">libc.so.6</span><span class="calibre_13">. To see what shared libraries a program uses, run </span><span class="calibre3">ldd </span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13">, where </span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13"> is the executable name. Here’s an example for the shell:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">ldd /bin/bash</span></span><span class="calibre3"> linux-vdso.so.1 (0x00007ffff31cc000) libgtk3-nocsd.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgtk3-nocsd.so.0 (0x00007f72bf3a4000) libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007f72bf17a000) libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f72bef76000)&nbsp;&nbsp;&nbsp; libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f72beb85000) libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f72be966000) /lib64/ld-linux-x86-64.so.2 (0x00007f72bf8c5000)</span></blockquote><a id="calibre_link-741"></a></blockquote><p class="calibre_30"><span class="calibre_13"> In the interest of optimal performance and flexibility, executables alone don’t usually know the locations of their shared libraries; they know only the names of the libraries, and perhaps a little hint about where to find them. A small program named </span><span class="calibre3">ld.so</span><span class="calibre_13"> (the </span><span class="italic">runtime dynamic linker/loader</span><span class="calibre_13">) finds and loads shared libraries for a program at runtime. The preceding </span><span class="calibre3">ldd</span><span class="calibre_13"> output shows the library names on the left side of the </span><span class="calibre3">=&gt;</span><span class="calibre_13">; that’s what the executable knows. The right side of the </span><span class="calibre3">=&gt;</span><span class="calibre_13"> shows where </span><span class="calibre3">ld.so</span><span class="calibre_13"> finds the library.</span></p><p class="calibre_27"><span class="calibre_13"> The final line of output shows the actual location of </span><span class="calibre3">ld.so</span><span class="calibre_13">: </span><span class="italic">/lib/ld-linux.so.2</span><span class="calibre_13">.</span></p><p class="calibre_46"><span class="bold">How ld.so Finds Shared Libraries</span></p><p class="calibre_25"><span class="calibre_13">One of the common trouble points for shared libraries is the dynamic linker being unable to find a library. The first place the dynamic linker </span><span class="italic">should</span><span class="calibre_13"> normally look for shared libraries is an executable’s preconfigured </span><span class="italic">runtime library search path</span><span class="calibre_13">
</span><span class="italic">(rpath)</span><span class="calibre_13">, if it exists. You’ll see how to create this path shortly.</span></p><p class="calibre_27"><span class="calibre_13"> Next, the dynamic linker looks in a system cache, </span><span class="italic">/etc/ld.so.cache</span><span class="calibre_13">, to see if the library is in a standard location. This is a fast cache of the names of library files found in directories listed in the cache configuration file </span><span class="italic">/etc/ld.so.conf</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> As is typical of many of the Linux configuration files that you’ve seen, </span></span>ld.so.conf<span class="italic"><span class="calibre_13"> may in turn include a number of files from a directory such as </span></span>/etc/ld.so.conf.d<span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Each line in </span><span class="italic">ld.so.conf</span><span class="calibre_13"> (or in the files it includes) is the name of a directory that you want to include in the cache. The list of directories is usually short, containing something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/lib/i686-linux-gnu<br class="calibre7" />/usr/lib/i686-linux-gnu</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The standard library directories </span><span class="italic">/lib</span><span class="calibre_13"> and </span><span class="italic">/usr/lib</span><span class="calibre_13"> are implicit, which means that you don’t need to include them in </span><span class="italic">/etc/ld.so.conf</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> If you alter </span><span class="italic">ld.so.conf</span><span class="calibre_13"> or make a change to one of the shared library directories, you must rebuild the </span><span class="italic">/etc/ld.so.cache</span><span class="calibre_13"> file by hand with the following command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ldconfig -v</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">-v</span><span class="calibre_13"> option provides detailed information on libraries that </span><span class="calibre3">ldconfig</span><span class="calibre_13"> adds to the cache and any changes that it detects.</span></p><p class="calibre_27"><span class="calibre_13"> There is one more place that </span><span class="calibre3">ld.so</span><span class="calibre_13"> looks for shared libraries: the environment variable </span><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13">. We’ll talk about this soon.</span></p><p class="calibre_27"><span class="calibre_13"> Don’t get into the habit of adding stuff to </span><span class="italic">/etc/ld.so.conf</span><span class="calibre_13">. You should know what shared libraries are in the system cache, and if you put every bizarre little shared library directory into the cache, you risk conflicts and an extremely disorganized system. When you compile software that needs an obscure library path, give your executable a built-in runtime library search path. Let’s see how to do that.</span><a id="calibre_link-816"></a></p><p class="calibre_46"><span class="bold">How to Link Programs Against Shared Libraries</span></p><p class="calibre_25"><span class="calibre_13">Say you have a shared library named </span><span class="italic">libweird.so.1</span><span class="calibre_13"> in </span><span class="italic">/opt/obscure/lib</span><span class="calibre_13"> that you need to link </span><span class="calibre3">myprog</span><span class="calibre_13"> against. You shouldn’t have this strange path in </span><span class="italic">/etc/ld.so.conf</span><span class="calibre_13">, so you need to convey that path to the linker. Link the program as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -o myprog myprog.o -Wl,-rpath=/opt/obscure/lib -L/opt/obscure/lib -lweird</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">-Wl,-rpath</span><span class="calibre_13"> option tells the linker to include the specified directory into the executable’s runtime library search path. However, even if you use </span><span class="calibre3">-Wl,-rpath</span><span class="calibre_13">, you still need the </span><span class="calibre3">-L</span><span class="calibre_13"> flag.</span></p><p class="calibre_27"><span class="calibre_13"> If you need to change the runtime library search path of an existing binary, you can use the </span><span class="calibre3">patchelf</span><span class="calibre_13"> program, but it’s generally better to do this at compile time. (ELF, the Executable and Linkable Format, is the standard format used for executables and libraries on Linux systems.)</span></p><p class="calibre_46"><span class="bold">How to Avoid Problems with Shared Libraries</span></p><p class="calibre_25"><span class="calibre_13">Shared libraries provide remarkable flexibility, not to mention some really incredible hacks, but you can abuse them to the point where your system becomes an utter and complete mess. Three particularly bad things can happen:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Missing libraries</li><li value="2" class="calibre_8">Terrible performance</li><li value="3" class="calibre_8">Mismatched libraries</li></ul><p class="calibre_33"><span class="calibre_13"> The number one cause of all shared library problems is the environment variable </span><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13">. Setting this variable to a colon-delimited set of directory names makes </span><span class="calibre3">ld.so</span><span class="calibre_13"> search the given directories </span><span class="italic">before</span><span class="calibre_13"> anything else when looking for a shared library. This is a cheap way to make programs work when you move a library around, if you don’t have the program’s source code and can’t use </span><span class="calibre3">patchelf</span><span class="calibre_13">, or if you’re just too lazy to recompile the executables. Unfortunately, you get what you pay for.</span></p><p class="calibre_27"><span class="italic">Never</span><span class="calibre_13"> set </span><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13"> in shell startup files or when compiling software. When the dynamic runtime linker encounters this variable, it often must search through the entire contents of each specified directory more times than you’d care to know. This causes a big performance hit, but more importantly, you can get conflicts and mismatched libraries because the runtime linker looks in these directories for </span><span class="italic">every</span><span class="calibre_13"> program.</span></p><p class="calibre_27"><span class="calibre_13"> If you </span><span class="italic">must</span><span class="calibre_13"> use </span><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13"> to run some crummy program for which you don’t have the source (or an application that you’d rather not recompile, like Firefox or some other beast), use a wrapper script. Let’s say your executable is </span><a id="calibre_link-790"></a><span class="italic">/opt/crummy/bin/crummy.bin</span><span class="calibre_13"> and needs some shared libraries in </span><span class="italic">/opt/crummy/lib</span><span class="calibre_13">. Write a wrapper script called </span><span class="calibre3">crummy</span><span class="calibre_13"> that looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/bin/sh<br class="calibre7" />LD_LIBRARY_PATH=/opt/crummy/lib<br class="calibre7" />export LD_LIBRARY_PATH<br class="calibre7" />exec /opt/crummy/bin/crummy.bin $@</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Avoiding </span><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13"> prevents most shared library problems. But one other significant problem that occasionally comes up with developers is that a library’s API may change slightly from one minor version to another, breaking installed software. The best solutions here are preventive: either use a consistent methodology to install shared libraries with </span><span class="calibre3">-Wl,-rpath</span><span class="calibre_13"> to create a runtime link path, or simply use the static versions of obscure libraries.</span></p><p id="calibre_link-437" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.1.4  Working with Header (Include) Files and Directories</span></span></span></p><p class="calibre_45"><span class="calibre_13">C </span><span class="italic">header files</span><span class="calibre_13"> are additional source code files that usually contain type and library function declarations, often for the libraries that you just saw. For example, </span><span class="italic">stdio.h</span><span class="calibre_13"> is a header file (see the simple program in </span>Section 15.1<span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> A great number of compilation problems are related to header files. Most such glitches occur when the compiler can’t find header files and libraries. There are even some cases where a programmer forgets to add the </span><span class="calibre3">#include</span><span class="calibre_13"> directive to code that includes a required header file, causing a failure to compile some of the source code.</span></p><p class="calibre_46"><span class="bold">Include File Problems</span></p><p class="calibre_25"><span class="calibre_13">Tracking down the correct header files isn’t always easy. Sometimes you’ll get lucky and find them with </span><span class="calibre3">locate</span><span class="calibre_13">, but in other instances, there are several include files with the same names in different directories, and it’s not clear which is the correct one. When the compiler can’t find an include file, the error message looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">badinclude.c:1:22: fatal error: notfound.h: No such file or directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This message reports that the compiler can’t find the </span><span class="italic">notfound.h</span><span class="calibre_13"> header file that the </span><span class="italic">badinclude.c</span><span class="calibre_13"> file references. If we look at </span><span class="italic">badinclude.c</span><span class="calibre_13"> (on line 1, as the error indicates), we’ll find a line that looks like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#include &lt;notfound.h&gt;</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Include directives like this do not specify where a header file should reside, only that it should be either in the default location or in one specified on the compiler command line. Most of these locations have </span><span class="italic">include</span><span class="calibre_13"> in their names. The default include directory in Unix is </span><span class="italic">/usr/include</span><span class="calibre_13">; the compiler always looks there unless you explicitly tell it not to. Of course, you’re unlikely to see the preceding error if the include file is in the default location, so let’s see how to make the compiler look in other include directories.</span><a id="calibre_link-606"></a></p><p class="calibre_27"><span class="calibre_13"> For example, say that you find </span><span class="italic">notfound.h</span><span class="calibre_13"> in </span><span class="italic">/usr/junk/include</span><span class="calibre_13">. To tell the compiler to add this directory to its search path, use the </span><span class="calibre3">-I</span><span class="calibre_13"> option:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">cc -c -I/usr/junk/include badinclude.c</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Now the compiler should no longer stumble on the line of code in </span><span class="italic">badinclude.c</span><span class="calibre_13"> that references the header file.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You’ll learn more about how to find missing include files in </span></span><span class="italic">Chapter 16</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> You should also beware of includes that use double quotes (</span><span class="calibre3">"</span><span class="calibre3"><span class="italic">
</span></span><span class="calibre3">"</span><span class="calibre_13">) instead of angle brackets (</span><span class="calibre3">&lt; &gt;</span><span class="calibre_13">), like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#include "myheader.h"</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Double quotes mean that the header file is not in a system include directory, and usually indicate that the include file is in the same directory as the source file. If you encounter a problem with double quotes, you’re probably trying to compile incomplete source code.</span></p><p class="calibre_46"><span class="bold">The C Preprocessor</span></p><p class="calibre_25"><span class="calibre_13">It turns out that the C compiler doesn’t actually do the work of looking for these include files. That task falls to the </span><span class="italic">C preprocessor</span><span class="calibre_13">, a program that the compiler runs on your source code before parsing the actual program. The preprocessor rewrites source code into a form that the compiler understands; it’s a tool for making source code easier to read (and for providing shortcuts).</span></p><p class="calibre_27"><span class="calibre_13"> Preprocessor commands in the source code are called </span><span class="italic">directives</span><span class="calibre_13">, and they start with the </span><span class="calibre3"># </span><span class="calibre_13">character. There are three basic types of directives:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Include files</span> An <span class="calibre3">#include</span> directive instructs the preprocessor to include an entire file. Note that the compiler’s <span class="calibre3">-I</span> flag is actually an option that causes the preprocessor to search a specified directory for include files, as you saw in the previous section.</li><li value="2" class="calibre_8"><span class="bold">Macro definitions</span> A line such as <span class="calibre3">#define BLAH something</span> tells the preprocessor to substitute <span class="calibre3">something</span> for all occurrences of <span class="calibre3">BLAH</span> in the source code. Convention dictates that macros appear in all uppercase, but it should come as no shock that programmers sometimes use macros whose names look like functions and variables. (Every now and then, this causes a world of headaches. Many programmers make a sport out of abusing the preprocessor.) <blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Instead of defining macros within your source code, you can also define them by passing parameters to the compiler: </span></span><span class="calibre3">-DBLAH=something</span><span class="italic"><span class="calibre_13"> works like the preceding </span></span><span class="calibre3">#define</span><span class="italic"><span class="calibre_13"> directive.</span></span></blockquote></blockquote></li><li value="3" class="calibre_3"><span class="bold">Conditionals</span> You can mark out certain pieces of code with <span class="calibre3">#ifdef</span>, <span class="calibre3">#if</span>, and <span class="calibre3">#endif</span>. The <span class="calibre3">#ifdef </span><span class="calibre3"><span class="italic">MACRO</span></span> directive checks to see whether the preprocessor macro <span class="calibre3"><span class="italic">MACRO</span></span> is defined, and <span class="calibre3">#if </span><span class="calibre3"><span class="italic">condition</span></span> tests to see whether <span class="calibre3"><span class="italic">condition</span></span> is nonzero. For both directives, if the condition following the “if” statement is false, the preprocessor does not pass any of the program text between the <span class="calibre3">#if</span> and the next <span class="calibre3">#endif</span> to the compiler. If you plan to look at any C code, you’d better get used to this. <blockquote class="calibre_70"><blockquote class="calibre_29"><span class="calibre_13">Let’s look at an example of a conditional directive. When the preprocessor sees the following code, it checks to see whether the macro </span><span class="calibre3">DEBUG</span><span class="calibre_13"> is defined and, if so, passes the line containing </span><span class="calibre3">fprintf()</span><span class="calibre_13"> on to the compiler. Otherwise, the preprocessor skips this line and continues to process the file after the </span><span class="calibre3">#endif</span><span class="calibre_13">:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">#ifdef DEBUG fprintf(stderr, "This is a debugging message.\n");<br class="calibre7" />#endif</span></blockquote></blockquote></blockquote><blockquote class="calibre_11"><blockquote class="calibre_29"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The C preprocessor doesn’t know anything about C syntax, variables, functions, and other elements. It understands only its own macros and directives.</span></span></blockquote></blockquote></li></ol><div class="mbp_pagebreak"></div><p class="calibre_30" id="calibre_link-607"><span class="calibre_13"> On Unix, the C preprocessor’s name is </span><span class="calibre3">cpp</span><span class="calibre_13">, but you can also run it with </span><span class="calibre3">gcc -E</span><span class="calibre_13">. However, you’ll rarely need to run the preprocessor by itself.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-438" class="calibre_23"><span class="calibre1"><span class="bold"> 15.2 make</span></span></p><p class="calibre_24"><span class="calibre_13">A program that has more than one source code file or requires strange compiler options is too cumbersome to compile by hand. This problem has been around for years, and the traditional Unix compile management utility that addresses it is called </span><span class="calibre3">make</span><span class="calibre_13">. You should know a little about </span><span class="calibre3">make</span><span class="calibre_13"> if you’re running a Unix system, because system utilities sometimes rely on </span><span class="calibre3">make</span><span class="calibre_13"> to operate. However, this chapter is only the tip of the iceberg. There are entire books on </span><span class="calibre3">make</span><span class="calibre_13">, such as </span><span class="italic">Managing Projects with GNU Make</span><span class="calibre_13">, 3rd edition, by Robert Mecklenburg (O’Reilly, 2005). In addition, most Linux packages are built using an additional layer around </span><span class="calibre3">make</span><span class="calibre_13"> or a similar tool. There are many build systems out there; we’ll look at one named autotools in </span>Chapter 16<span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre3">make</span><span class="calibre_13"> is a big system, but it’s not very difficult to get an idea of how it works. When you see a file named </span><span class="italic">Makefile</span><span class="calibre_13"> or </span><span class="italic">makefile</span><span class="calibre_13">, you know that you’re dealing with </span><span class="calibre3">make</span><span class="calibre_13">. (Try running </span><span class="calibre3">make</span><span class="calibre_13"> to see if you can build anything.)</span></p><p class="calibre_27"><span class="calibre_13"> The basic idea behind </span><span class="calibre3">make</span><span class="calibre_13"> is the </span><span class="italic">target</span><span class="calibre_13">, a goal that you want to achieve. A target can be a file (a </span><span class="italic">.o</span><span class="calibre_13"> file, an executable, and so on) or a label. In addition, some targets depend on other targets; for instance, you need a complete set of </span><span class="italic">.o</span><span class="calibre_13"> files before you can link your executable. These requirements are called </span><span class="italic">dependencies</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> To build a target, </span><span class="calibre3">make</span><span class="calibre_13"> follows a </span><span class="italic">rule</span><span class="calibre_13">, such as one specifying how to go from a </span><span class="italic">.c</span><span class="calibre_13"> source file to a </span><span class="italic">.o</span><span class="calibre_13"> object file. </span><span class="calibre3">make</span><span class="calibre_13"> already knows several rules, but you can customize them to create your own.</span></p><p id="calibre_link-439" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.1  A Sample Makefile</span></span></span></p><p class="calibre_45"><span class="calibre_13">Building on the example files in </span>Section 15.1.1<span class="calibre_13">, the following very simple Makefile builds a program called </span><span class="calibre3">myprog</span><span class="calibre_13"> from </span><span class="italic">aux.c</span><span class="calibre_13"> and </span><span class="italic">main.c</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">1 # object files2 OBJS=aux.o main.o3 all: 4myprog<br class="calibre7" />myprog: 5$(OBJS) 6$(CC) -o myprog $(OBJS)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The </span><span class="calibre3">#</span><span class="calibre_13"> in the first line of this Makefile </span>1<span class="calibre_13"> denotes a comment.</span></p><p class="calibre_27"><span class="calibre_13"> The next line is just a macro definition that sets the </span><span class="calibre3">OBJS</span><span class="calibre_13"> variable to two object filenames </span>2<span class="calibre_13">. This will be important later. For now, take note of how you define the macro and also how you reference it later (</span><span class="calibre3">$(OBJS)</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> The next item in the Makefile contains its first target, </span><span class="calibre3">all</span><span class="calibre_13">
</span>3<span class="calibre_13">. The first target is always the default, the target that </span><span class="calibre3">make</span><span class="calibre_13"> wants to build when you run </span><span class="calibre3">make</span><span class="calibre_13"> by itself on the command line.</span></p><p class="calibre_27"><span class="calibre_13"> The rule for building a target comes after the colon. For </span><span class="calibre3">all</span><span class="calibre_13">, this Makefile says that you need to satisfy something called </span><span class="calibre3">myprog</span><span class="calibre_13">
</span>4<span class="calibre_13">. This is the first dependency in the file; </span><span class="calibre3">all</span><span class="calibre_13"> depends on </span><span class="calibre3">myprog</span><span class="calibre_13">. Note that </span><span class="calibre3">myprog</span><span class="calibre_13"> can be an actual file or the target of another rule. In this case, it’s both (the rule for </span><span class="calibre3">all</span><span class="calibre_13"> and the target of </span><span class="calibre3">OBJS</span><span class="calibre_13">).</span></p><p class="calibre_27"><span class="calibre_13"> To build </span><span class="calibre3">myprog</span><span class="calibre_13">, this Makefile uses the macro </span><span class="calibre3">$(OBJS)</span><span class="calibre_13"> in the dependencies </span>5<span class="calibre_13">. The macro expands to </span><span class="italic">aux.o</span><span class="calibre_13"> and </span><span class="italic">main.o</span><span class="calibre_13">, indicating that </span><span class="calibre3">myprog</span><span class="calibre_13"> depends on these two files (they must be actual files, because there aren’t any targets with those names anywhere in the Makefile).</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The whitespace before </span></span><span class="calibre3">$(CC)</span><span class="italic"><span class="calibre_13">
</span></span><span class="italic">6</span><span class="italic"><span class="calibre_13"> is a tab. </span></span><span class="calibre3">make</span><span class="italic"><span class="calibre_13"> is very strict about tabs.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> This Makefile assumes that you have two C source files named </span><span class="italic">aux.c</span><span class="calibre_13"> and </span><span class="italic">main.c</span><span class="calibre_13"> in the same directory. Running </span><span class="calibre3">make</span><span class="calibre_13"> on the Makefile yields the following output, showing the commands that </span><span class="calibre3">make</span><span class="calibre_13"> is running:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make</span></span><span class="calibre3"><br class="calibre7" />cc&nbsp;&nbsp;&nbsp; -c -o aux.o aux.c<br class="calibre7" />cc&nbsp;&nbsp;&nbsp; -c -o main.o main.c<br class="calibre7" />cc -o myprog aux.o main.o</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> A diagram of the dependencies is shown in </span><a></a><a href="#calibre_link-544"><span class="italic"><span class="calibre_4">Figure 15-1</span></span></a><span class="calibre_13">.</span></p><p id="calibre_link-440" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.2  Built-in Rules</span></span></span></p><p class="calibre_45"><span class="calibre_13">How did </span><span class="calibre3">make</span><span class="calibre_13"> know how to go from </span><span class="italic">aux.c</span><span class="calibre_13"> to </span><span class="italic">aux.o</span><span class="calibre_13">? After all, </span><span class="italic">aux.c</span><span class="calibre_13"> is not in the Makefile. The answer is that </span><span class="calibre3">make</span><span class="calibre_13"> has some built-in rules to follow. It knows to look for a </span><span class="italic">.c</span><span class="calibre_13"> file when you want a </span><span class="italic">.o</span><span class="calibre_13"> file, and furthermore, it knows how to run </span><span class="calibre3">cc -c</span><span class="calibre_13"> on that </span><span class="italic">.c</span><span class="calibre_13"> file to get to its goal of creating a </span><span class="italic">.o </span><span class="calibre_13">file.</span></p><p id="calibre_link-832" class="calibre_63">
</p><p class="calibre_34"><img src="images/000022.jpg" class="calibre_103" />
</p><p id="calibre_link-544" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 15-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Makefile dependencies</span></span></span></p><p id="calibre_link-441" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.3  Final Program Build</span></span></span></p><p class="calibre_45"><span class="calibre_13">The final step in getting to </span><span class="calibre3">myprog</span><span class="calibre_13"> is a little tricky, but the idea is clear enough. After you have the two object files in </span><span class="calibre3">$(OBJS)</span><span class="calibre_13">, you can run the C compiler according to the following line (where </span><span class="calibre3">$(CC)</span><span class="calibre_13"> expands to the compiler name):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $(CC) -o myprog $(OBJS)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As mentioned earlier, the whitespace before </span><span class="calibre3">$(CC)</span><span class="calibre_13"> is a tab. You </span><span class="italic">must</span><span class="calibre_13"> insert a tab before any system command, on its own line.</span></p><p class="calibre_27"><span class="calibre_13">Watch out for this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Makefile:7: *** missing separator.&nbsp; Stop.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">An error like this means that the Makefile is broken. The tab is the separator, and if there is no separator or there’s some other interference, you’ll see this error.</span></p><p id="calibre_link-442" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.4  Dependency Updates</span></span></span></p><p class="calibre_45"><span class="calibre_13">One last </span><span class="calibre3">make</span><span class="calibre_13"> fundamental concept to know is that, in general, the goal is to bring targets up to date with their dependencies. Furthermore, it’s designed to take only the minimum steps necessary to do that, which can lead to considerable time savings. If you type </span><span class="calibre3">make</span><span class="calibre_13"> twice in a row for the preceding example, the first command builds </span><span class="calibre3">myprog</span><span class="calibre_13">, but the second yields this output:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">make: Nothing to be done for 'all'.</span></blockquote></blockquote><p id="calibre_link-604" class="calibre_30"><span class="calibre_13">This second time through, </span><span class="calibre3">make</span><span class="calibre_13"> looked at its rules and noticed that </span><span class="calibre3">myprog</span><span class="calibre_13"> already exists, so it didn’t build </span><span class="calibre3">myprog</span><span class="calibre_13"> again because none of the dependencies had changed since the last time you built it. To experiment with this, do the following:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Run <span class="calibre3"><span class="bold">touch aux.c</span></span>.</li><li value="2" class="calibre_8">Run <span class="calibre3"><span class="bold">make</span></span> again. This time, <span class="calibre3">make</span> determines that <span class="italic">aux.c</span> is newer than the <span class="italic">aux.o</span> already in the directory, so it compiles <span class="italic">aux.o</span> again.</li><li value="3" class="calibre_8"><span class="calibre3">myprog</span> depends on <span class="italic">aux.o</span>, and now <span class="italic">aux.o</span> is newer than the preexisting <span class="calibre3">myprog</span>, so <span class="calibre3">make</span> must create <span class="calibre3">myprog</span> again.</li></ol><p class="calibre_33"><span class="calibre_13">This type of chain reaction is very typical.</span></p><p id="calibre_link-443" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.5  Command-Line Arguments and Options</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can get a great deal of mileage out of </span><span class="calibre3">make</span><span class="calibre_13"> if you know how its command-line arguments and options work.</span></p><p class="calibre_27"><span class="calibre_13"> One of the most useful options is to specify a single target on the command line. For the preceding Makefile, you can run </span><span class="calibre3">make aux.o</span><span class="calibre_13"> if you want only the </span><span class="italic">aux.o</span><span class="calibre_13"> file.</span></p><p class="calibre_27"><span class="calibre_13"> You can also define a macro on the command line. For example, to use the </span><span class="calibre3">clang</span><span class="calibre_13"> compiler, try:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make CC=clang</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Here, </span><span class="calibre3">make</span><span class="calibre_13"> uses your definition of </span><span class="calibre3">CC</span><span class="calibre_13"> instead of its default compiler, </span><span class="calibre3">cc</span><span class="calibre_13">. Command-line macros come in handy for testing preprocessor definitions and libraries, especially with the </span><span class="calibre3">CFLAGS</span><span class="calibre_13"> and </span><span class="calibre3">LDFLAGS</span><span class="calibre_13"> macros that we’ll discuss shortly.</span></p><p class="calibre_27"><span class="calibre_13"> In fact, you don’t even need a Makefile to run </span><span class="calibre3">make</span><span class="calibre_13">. If built-in </span><span class="calibre3">make</span><span class="calibre_13"> rules match a target, you can just ask </span><span class="calibre3">make</span><span class="calibre_13"> to try to create the target. For example, if you have the source to a very simple program called </span><span class="italic">blah.c</span><span class="calibre_13">, try </span><span class="calibre3">make blah</span><span class="calibre_13">. The </span><span class="calibre3">make</span><span class="calibre_13"> run proceeds like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make blah</span></span><span class="calibre3"><br class="calibre7" />cc&nbsp;&nbsp; blah.o&nbsp;&nbsp; -o blah</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This use of </span><span class="calibre3">make</span><span class="calibre_13"> works only for the most elementary C programs; if your program needs a library or special include directory, you should probably write a Makefile. Running </span><span class="calibre3">make</span><span class="calibre_13"> without a Makefile is actually most useful when you’re dealing with something like Fortran, Lex, or Yacc and don’t know how the compiler or utility works. Why not let </span><span class="calibre3">make</span><span class="calibre_13"> try to figure it out for you? Even if </span><span class="calibre3">make</span><span class="calibre_13"> fails to create the target, it will probably still give you a pretty good hint as to how to use the tool.</span></p><p class="calibre_27"><span class="calibre_13"> Two </span><span class="calibre3">make</span><span class="calibre_13"> options stand out from the rest:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">-n</span></span> Prints the commands necessary for a build but prevents <span class="calibre3">make</span> from actually running any commands</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">-f</span></span><span class="calibre3"><span class="italic"><span class="bold"> file</span></span></span> Tells <span class="calibre3">make</span> to read from <span class="calibre3"><span class="italic">file</span></span><span class="italic">
</span>instead of <span class="calibre3"><span class="italic">Makefile</span></span> or <span class="calibre3"><span class="italic">makefile</span></span></li></ol><p id="calibre_link-444" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.6  Standard Macros and Variables</span></span></span></p><p class="calibre_45"><span class="calibre3">make</span><span class="calibre_13"> has many special macros and variables. It’s difficult to tell the difference between a macro and a variable, but here the term </span><span class="italic">macro</span><span class="calibre_13"> is used to mean something that usually doesn’t change after </span><span class="calibre3">make</span><span class="calibre_13"> starts building targets.</span></p><p class="calibre_27"><span class="calibre_13">As you saw earlier, you can set macros at the start of your Makefile. These are the most common macros:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">CFLAGS</span></span> C compiler options. When creating object code from a <span class="italic">.c</span> file, <span class="calibre3">make</span> passes this as an argument to the compiler.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">LDFLAGS</span></span> Like <span class="calibre3">CFLAGS</span>, but these options are for the linker when creating an executable from object code.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">LDLIBS</span></span> If you use <span class="calibre3">LDFLAGS</span> but don’t want to combine the library name options with the search path, put the library name options in this file.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">CC</span></span> The C compiler. The default is <span class="calibre3">cc</span>.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">CPPFLAGS</span></span> C <span class="italic">preprocessor</span> options. When <span class="calibre3">make</span> runs the C preprocessor in some way, it passes this macro’s expansion on as an argument.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">CXXFLAGS</span></span> GNU <span class="calibre3">make</span> uses this for C++ compiler flags.</li></ol><p class="calibre_33"><span class="calibre_13"> A </span><span class="calibre3">make</span><span class="calibre_13">
</span><span class="italic">variable</span><span class="calibre_13"> changes as you build targets. Variables begin with a dollar sign (</span><span class="calibre3">$</span><span class="calibre_13">). There are several ways to set variables, but some of the most common variables are automatically set inside target rules. Here’s what you might see:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">$@</span></span> When inside a rule, this variable expands to the current target.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">$&lt;</span></span> When inside a rule, this variable expands to the first dependency of the target.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">$*</span></span> This variable expands to the <span class="italic">basename</span> or stem of the current target. For example, if you’re building <span class="italic">blah.o</span>, this expands to <span class="italic">blah</span>.</li></ol><p class="calibre_33"><span class="calibre_13"> Here’s an example illustrating a common pattern&mdash;a rule using </span><span class="calibre3">myprog</span><span class="calibre_13"> to generate a </span><span class="italic">.out</span><span class="calibre_13"> file from a </span><span class="italic">.in</span><span class="calibre_13"> file:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">.SUFFIXES: .in<br class="calibre7" />.in.out: $&lt;<br class="calibre7" />	myprog $&lt; -o $*.out</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You’ll encounter a rule such as </span><span class="calibre3">.c.o:</span><span class="calibre_13"> in many Makefiles defining a customized way of running the C compiler to create an object file.</span></p><p class="calibre_27"><span class="calibre_13"> The most comprehensive list of </span><span class="calibre3">make</span><span class="calibre_13"> variables on Linux is the </span><span class="calibre3">make</span><span class="calibre_13"> info manual.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Keep in mind that GNU </span></span><span class="calibre3">make</span><span class="italic"><span class="calibre_13"> has many extensions, built-in rules, and features that other variants do not have. This is fine as long as you’re running Linux, but if you step off onto a Solaris or BSD machine and expect the same options to work, you might be in for a surprise. However, that’s the problem that a multiplatform build system such as GNU autotools is designed to solve.</span></span></blockquote><p id="calibre_link-445" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">15.2.7  Conventional Targets</span></span></span></p><p class="calibre_45"><span class="calibre_13">Most developers include several additional common targets in their Makefiles that perform auxiliary tasks related to compiles:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">clean</span></span> The <span class="calibre3">clean</span> target is ubiquitous; a <span class="calibre3">make</span>
<span class="calibre3">clean</span> usually instructs <span class="calibre3">make</span> to remove all of the object files and executables so that you can make a fresh start or pack up the software. Here’s an example rule for the <span class="calibre3">myprog</span> Makefile: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">clean: rm -f $(OBJS) myprog</span></blockquote></blockquote></blockquote></li><li value="2" class="calibre_81"><span class="calibre3"><span class="bold">distclean</span></span> A Makefile created by way of the GNU autotools system always has a <span class="calibre3">distclean</span> target to remove everything that wasn’t part of the original distribution, including the Makefile. You’ll see more of this in Chapter 16. On very rare occasions, you might find that a developer opts not to remove the executable with this target, preferring something like <span class="calibre3">realclean</span> instead.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">install</span></span> This target copies files and compiled programs to what the Makefile thinks is the proper place on the system. This can be dangerous, so always run a <span class="calibre3">make -n install</span> to see what will happen before you actually run any commands.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">test</span></span><span class="bold"> or </span><span class="calibre3"><span class="bold">check</span></span> Some developers provide <span class="calibre3">test</span> or <span class="calibre3">check</span> targets to make sure that everything works after performing a build.</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">depend</span></span> This target creates dependencies by calling the compiler with <span class="calibre3">-M</span> to examine the source code. This is an unusual-looking target because it often changes the Makefile itself. This is no longer common practice, but if you come across some instructions telling you to use this rule, make sure to do so.</li><li value="6" class="calibre_8"><span class="calibre3"><span class="bold">all</span></span> As mentioned earlier, this is commonly the first target in the Makefile. You’ll often see references to this target instead of an actual executable.</li></ol><p id="calibre_link-446" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.2.8  Makefile Organization</span></span></span></p><p class="calibre_45"><span class="calibre_13">Even though there are many different Makefile styles, most programmers adhere to some general rules of thumb. For one, in the first part of the Makefile (inside the macro definitions), you should see libraries and includes grouped according to package:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">MYPACKAGE_INCLUDES=-I/usr/local/include/mypackage<br class="calibre7" />MYPACKAGE_LIB=-L/usr/local/lib/mypackage -lmypackage<br class="calibre7" />PNG_INCLUDES=-I/usr/local/include<br class="calibre7" />PNG_LIB=-L/usr/local/lib -lpng</span></blockquote></blockquote><p id="calibre_link-581" class="calibre_30"><span class="calibre_13">Each type of compiler and linker flag often gets a macro like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">CFLAGS=$(CFLAGS) $(MYPACKAGE_INCLUDES) $(PNG_INCLUDES)<br class="calibre7" />LDFLAGS=$(LDFLAGS) $(MYPACKAGE_LIB) $(PNG_LIB)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Object files are usually grouped according to executables. For example, say you have a package that creates executables called </span><span class="calibre3">boring</span><span class="calibre_13"> and </span><span class="calibre3">trite</span><span class="calibre_13">. Each has its own </span><span class="italic">.c</span><span class="calibre_13"> source file and requires the code in </span><span class="italic">util.c</span><span class="calibre_13">. You might see something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">UTIL_OBJS=util.o<br class="calibre7" />BORING_OBJS=$(UTIL_OBJS) boring.o<br class="calibre7" />TRITE_OBJS=$(UTIL_OBJS) trite.o<br class="calibre7" />PROGS=boring trite</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The rest of the Makefile might look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">all: $(PROGS)<br class="calibre7" />boring: $(BORING_OBJS) $(CC) -o $@ $(BORING_OBJS) $(LDFLAGS)<br class="calibre7" />trite: $(TRITE_OBJS) $(CC) -o $@ $(TRITE_OBJS) $(LDFLAGS)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You could combine the two executable targets into one rule, but it’s usually not a good idea to do so because you wouldn’t easily be able to move a rule to another Makefile, delete an executable, or group executables differently. Furthermore, the dependencies would be incorrect: if you had just one rule for </span><span class="calibre3">boring</span><span class="calibre_13"> and </span><span class="calibre3">trite</span><span class="calibre_13">, </span><span class="calibre3">trite</span><span class="calibre_13"> would depend on </span><span class="italic">boring.c</span><span class="calibre_13">, </span><span class="calibre3">boring</span><span class="calibre_13"> would depend on </span><span class="italic">trite.c</span><span class="calibre_13">, and </span><span class="calibre3">make</span><span class="calibre_13"> would always try to rebuild both programs whenever you changed one of the two source files.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you need to define a special rule for an object file, put the rule for the object file just above the rule that builds the executable. If several executables use the same object file, put the object rule above all of the executable rules.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-447" class="calibre_42"><span class="calibre1"><span class="bold"> 15.3 Lex and Yacc</span></span></p><p class="calibre_24"><span class="calibre_13">You might encounter Lex and Yacc in the course of compiling programs that read configuration files or commands. These tools are building blocks for programming languages.</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Lex is a <span class="italic">tokenizer</span> that transforms text into numbered tags with labels. The GNU/Linux version is named <span class="calibre3">flex</span>. You may need a <span class="calibre3">-ll</span> or <span class="calibre3">-lfl</span> linker flag in conjunction with Lex.</li><li value="2" class="calibre_8"> Yacc is a <span class="italic">parser</span> that attempts to read tokens according to a <span class="italic">grammar</span>. The GNU parser is <span class="calibre3">bison</span>; to get Yacc compatibility, run <span class="calibre3">bison -y</span>. You may need the <span class="calibre3">-ly</span> linker flag.</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-448" class="calibre_23"><span class="calibre1"><span class="bold">15.4 Scripting Languages</span></span></p><p class="calibre_24"><span class="calibre_13">A long time ago, the average Unix systems manager didn’t have to worry much about scripting languages other than the Bourne shell and awk. Shell scripts (discussed in </span>Chapter 11<span class="calibre_13">) continue to be an important part of Unix, but awk has faded somewhat from the scripting arena. However, many powerful successors have emerged, and many systems programs have actually switched from C to scripting languages (such as the sensible version of the </span><span class="calibre3">whois</span><span class="calibre_13"> program). Let’s look at some scripting basics.</span></p><p class="calibre_27"><span class="calibre_13">The first thing you need to know about any scripting language is that the first line of a script looks like the shebang of a Bourne shell script. For example, a Python script starts out like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/usr/bin/python</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Or this version, which runs the first version of Python in the command path instead of always going to </span><span class="italic">/usr/bin</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/usr/bin/env python</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As you saw in </span>Chapter 11<span class="calibre_13">, an executable text file that starts with a </span><span class="calibre3">#!</span><span class="calibre_13"> shebang is a script. The pathname following this prefix is the scripting language interpreter executable. When Unix tries to run an executable file that starts with </span><span class="calibre3">#!</span><span class="calibre_13">, it runs the program following the </span><span class="calibre3">#!</span><span class="calibre_13"> with the rest of the file as the standard input. Therefore, even this is a script:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">#!/usr/bin/tail -2<br class="calibre7" />This program won't print this line,<br class="calibre7" />but it will print this line...<br class="calibre7" />and this line, too.</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The first line of a shell script often contains one of the most common basic script problems: an invalid path to the scripting language interpreter. For example, say you named the previous script </span><span class="calibre3">myscript</span><span class="calibre_13">. What if </span><span class="calibre3">tail</span><span class="calibre_13"> were actually in </span><span class="italic">/bin</span><span class="calibre_13"> instead of </span><span class="italic">/usr/bin</span><span class="calibre_13"> on your system? In that case, running </span><span class="calibre3">myscript</span><span class="calibre_13"> would produce this error:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">bash: ./myscript: /usr/bin/tail: bad interpreter: No such file or directory</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Don’t expect more than one argument in the script’s first line to work. That is, the </span><span class="calibre3">-2</span><span class="calibre_13"> in the preceding example might work, but if you add another argument, the system could decide to treat the </span><span class="calibre3">-2</span><span class="calibre_13">
</span><span class="italic">and</span><span class="calibre_13"> the new argument as one big argument, spaces and all. This can vary from system to system; don’t test your patience on something this insignificant.</span></p><p class="calibre_27"><span class="calibre_13">Now, let’s look at a few of the languages out there.</span></p><p id="calibre_link-449" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.4.1  Python</span></span></span></p><p class="calibre_45"><span class="calibre_13">Python is a scripting language with a strong following and an array of powerful features, such as text processing, database access, networking, and multithreading. It has a powerful interactive mode and a very organized object model.</span></p><p class="calibre_27"><span class="calibre_13"> Python’s executable is </span><span class="calibre3">python</span><span class="calibre_13">, and it’s usually in </span><span class="italic">/usr/bin</span><span class="calibre_13">. However, Python isn’t used just from the command line for scripts. It’s found everywhere from data analysis to web applications. </span><span class="italic">Python Distilled</span><span class="calibre_13">, by David M. Beazley (Addison-Wesley, 2021), is a great way to get started.</span></p><p id="calibre_link-450" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.4.2  Perl</span></span></span></p><p class="calibre_45"><span class="calibre_13">One of the older third-party Unix scripting languages is Perl. It’s the original “Swiss army chainsaw” of programming tools. Although Perl has lost a fair amount of ground to Python in recent years, it excels in particular at text processing, conversion, and file manipulation, and you may find many tools built with it. </span><span class="italic">Learning Perl</span><span class="calibre_13">, 7th edition, by Randal L. Schwartz, brian d foy, and Tom Phoenix (O’Reilly, 2016) is a tutorial-style introduction; a larger reference is </span><span class="italic">Modern Perl</span><span class="calibre_13">, 4th edition, by chromatic (Onyx Neon Press, 2016).</span></p><p id="calibre_link-451" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">15.4.3  Other Scripting Languages</span></span></span></p><p class="calibre_45"><span class="calibre_13">You might also encounter these scripting languages:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">PHP</span> This is a hypertext-processing language often found in dynamic web scripts. Some people use PHP for standalone scripts. The PHP website is at <a href="http://www.php.net/"><span class="italic"><span class="calibre_4">http://www.php.net/</span></span></a>.</li><li value="2" class="calibre_8"><span class="bold">Ruby</span> Object-oriented fanatics and many web developers enjoy programming in this language (<a href="http://www.ruby-lang.org/"><span class="italic"><span class="calibre_4">http://www.ruby-lang.org/</span></span></a>).</li><li value="3" class="calibre_8"><span class="bold">JavaScript</span> This language is used inside web browsers primarily to manipulate dynamic content. Most experienced programmers shun it as a standalone scripting language due to its many flaws, but it’s nearly impossible to avoid when you’re doing web programming. In recent years, an implementation called Node.js has become more prevalent in server-side programming and scripting; its executable name is <span class="calibre3">node</span>.</li><li value="4" class="calibre_8"><span class="bold">Emacs Lisp</span> This is a variety of the Lisp programming language used by the Emacs text editor.</li><li value="5" class="calibre_8"><span class="bold">MATLAB, Octave</span> MATLAB is a commercial matrix and mathematical programming language and library. Octave is a very similar free software project.</li><li value="6" class="calibre_8"><span class="bold">R</span> This is a popular free statistical analysis language. See <a href="http://www.r-project.org/"><span class="italic"><span class="calibre_4">http://www.r-project.org/</span></span></a> and <span class="italic">The Art of R Programming</span> by Norman Matloff (No Starch Press, 2011) for more information.</li><li value="7" class="calibre_8"><span class="bold">Mathematica</span> This is another commercial mathematical programming language with libraries.</li><li value="8" class="calibre_8"><span class="bold">m4</span> This is a macro-processing language, usually found only in the GNU autotools.</li><a id="calibre_link-627"></a><li value="9" class="calibre_8"><span class="bold">Tcl</span> Tcl (tool command language) is a simple scripting language usually associated with the Tk graphical user interface toolkit and Expect, an automation utility. Although Tcl does not enjoy the widespread use that it once did, don’t discount its power. Many veteran developers prefer Tk, especially for its embedded capabilities. See <a href="http://www.tcl.tk/"><span class="italic"><span class="calibre_4">http://www.tcl.tk/</span></span></a> for more.</li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-452" class="calibre_23"><span class="calibre1"><span class="bold"> 15.5 Java</span></span></p><p class="calibre_24"><span class="calibre_13">Java is a compiled language like C, with a simpler syntax and powerful support for object-oriented programming. It has a few niches in Unix systems. For example, it’s often used as a web application environment, and it’s popular for specialized applications. Android applications are usually written in Java. Even though it’s not often seen on a typical Linux desktop, you should know how Java works, at least for standalone applications.</span></p><p class="calibre_27"><span class="calibre_13"> There are two kinds of Java compilers: native compilers for producing machine code for your system (like a C compiler) and bytecode compilers for use by a bytecode interpreter (sometimes called a </span><span class="italic">virtual machine</span><span class="calibre_13">, which is different from the virtual machine offered by a hypervisor, as described in </span>Chapter 17<span class="calibre_13">). You’ll practically always encounter bytecode on Linux.</span></p><p class="calibre_27"><span class="calibre_13"> Java bytecode files end in </span><span class="italic">.class</span><span class="calibre_13">. The Java Runtime Environment (JRE) contains all of the programs you need to run Java bytecode. To run a bytecode file, use:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">java </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.class</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You might also encounter bytecode files that end in </span><span class="italic">.jar</span><span class="calibre_13">, which are collections of archived </span><span class="italic">.class</span><span class="calibre_13"> files. To run a </span><span class="italic">.jar</span><span class="calibre_13"> file, use this syntax:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">java -jar </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.jar</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Sometimes you need to set the </span><span class="calibre3">JAVA_HOME</span><span class="calibre_13"> environment variable to your Java installation prefix. If you’re really unlucky, you might need to use </span><span class="calibre3">CLASSPATH</span><span class="calibre_13"> to include any directories containing classes that your program expects. This is a colon-delimited set of directories like the regular </span><span class="calibre3">PATH</span><span class="calibre_13"> variable for executables.</span></p><p class="calibre_27"><span class="calibre_13"> If you need to compile a </span><span class="italic">.java</span><span class="calibre_13"> file into bytecode, you need the Java Development Kit (JDK). You can run the </span><span class="calibre3">javac</span><span class="calibre_13"> compiler from JDK to create some </span><span class="italic">.class</span><span class="calibre_13"> files:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">javac </span></span><span class="calibre3"><span class="italic"><span class="bold">file</span></span></span><span class="calibre3"><span class="bold">.java</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> JDK also comes with </span><span class="calibre3">jar</span><span class="calibre_13">, a program that can create and pick apart </span><span class="italic">.jar</span><span class="calibre_13"> files. It works like </span><span class="calibre3">tar</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-453" class="calibre_23"><span class="calibre1"><span class="bold">15.6 Looking Forward: Compiling Packages</span></span></p><p class="calibre_24"><span class="calibre_13">The world of compilers and scripting languages is vast and constantly expanding. As of this writing, new compiled languages such as Go (golang) and Rust are gaining popularity in application and system programming.</span></p><p class="calibre_27"><span class="calibre_13"> The LLVM compiler infrastructure set (</span><a href="http://llvm.org/"><span class="italic"><span class="calibre_4">http://llvm.org/</span></span></a><span class="calibre_13">) has significantly eased compiler development. If you’re interested in how to design and implement a compiler, two good books are </span><span class="italic">Compilers: Principles, Techniques, and Tools</span><span class="calibre_13">, 2nd edition, by Alfred V. Aho et al. (Addison-Wesley, 2006) and </span><span class="italic">Modern Compiler Design</span><span class="calibre_13">, 2nd edition, by Dick Grune et al. (Springer, 2012). For scripting language development, it’s usually best to look for online resources, as the implementations vary widely.</span></p><p class="calibre_27"><span class="calibre_13">Now that you know the basics of the programming tools on the system, you’re ready to see what they can do. The next chapter is all about how you can build packages on Linux from source code.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-454" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-799" class="calibre_10"><span class="calibre4"><span class="bold">16</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">INTRODUCTION TO COMPILING SOFTWARE FROM C SOURCE CODE</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">Most nonproprietary third-party Unix software packages come as source code that you can build and install. One reason for this is that Unix (and Linux itself) has so many different flavors and architectures, it would be difficult to distribute binary packages for all possible platform combinations. The other reason, which is at least as important, is that widespread source code distribution throughout the Unix community encourages users to contribute bug fixes and new features to software, giving meaning to the term </span></span><span class="calibre1"><span class="italic">open source</span></span><span class="calibre1"><span class="calibre_13">.</span></span></p><p id="calibre_link-597" class="calibre_33"><span class="calibre_13">You can get nearly everything you see on a Linux system as source code&mdash;from the kernel and C library to the web browsers. It’s even possible to update and augment your entire system by (re-)installing parts of your system from the source code. However, you probably </span><span class="italic">shouldn’t</span><span class="calibre_13"> update your machine by installing </span><span class="italic">everything</span><span class="calibre_13"> from source code, unless you really enjoy the process or have some other reason.</span></p><p class="calibre_27"><span class="calibre_13"> Linux distributions typically provide easy ways to update core parts of the system, such as the programs in </span><span class="italic">/bin</span><span class="calibre_13">, and one particularly important property of distributions is that they usually fix security problems very quickly. But don’t expect your distribution to provide everything for you. Here are some reasons why you might want to install certain packages yourself:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">To control configuration options.</li><li value="2" class="calibre_8">To install the software anywhere you like. You can even install several different versions of the same package.</li><li value="3" class="calibre_8">To control the version that you install. Distributions don’t always stay up to date with the latest versions of all packages, particularly add-ons to software packages (such as Python libraries).</li><li value="4" class="calibre_8">To better understand how a package works.</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-455" class="calibre_23"><span class="calibre1"><span class="bold"> 16.1 Software Build Systems</span></span></p><p class="calibre_24"><span class="calibre_13">Many programming environments exist on Linux, from traditional C to interpreted scripting languages such as Python. Each typically has at least one distinct system for building and installing packages in addition to the tools that a Linux distribution provides.</span></p><p class="calibre_27"><span class="calibre_13"> We’re going to look at compiling and installing C source code in this chapter with only one of these build systems&mdash;the configuration scripts generated from the GNU autotools suite. This system is generally considered stable, and many of the basic Linux utilities use it. Because it’s based on existing tools such as </span><span class="calibre3">make</span><span class="calibre_13">, after you see it in action, you’ll be able to transfer your knowledge to other build systems.</span></p><p class="calibre_27"><span class="calibre_13">Installing a package from C source code usually involves the following steps:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8">Unpack the source code archive.</li><li value="2" class="calibre_8">Configure the package.</li><li value="3" class="calibre_8">Run <span class="calibre3">make</span> or another build command to build the programs.</li><li value="4" class="calibre_8">Run <span class="calibre3">make install</span> or a distribution-specific install command to install the package.</li></ol><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You should understand the basics in </span></span><span class="italic">Chapter 15</span><span class="italic"><span class="calibre_13"> before proceeding with this chapter.</span></span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-456" class="calibre_42"><span class="calibre1"><span class="bold">16.2 Unpacking C Source Packages</span></span></p><p class="calibre_24"><span class="calibre_13">A package’s source code distribution usually comes as a </span><span class="italic">.tar.gz</span><span class="calibre_13">, </span><span class="italic">.tar.bz2</span><span class="calibre_13">, or </span><span class="italic">.tar.xz</span><span class="calibre_13"> file, and you should unpack the file as described in </span>Section 2.18<span class="calibre_13">. Before you unpack, though, verify the contents of the archive with </span><span class="calibre3">tar tvf</span><span class="calibre_13"> or </span><span class="calibre3">tar ztvf</span><span class="calibre_13">, because some packages don’t create their own subdirectories in the directory where you extract the archive.</span></p><p class="calibre_27"><span class="calibre_13">Output like this means that the package is probably okay to unpack:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">package-1.23/Makefile.in<br class="calibre7" />package-1.23/README<br class="calibre7" />package-1.23/main.c<br class="calibre7" />package-1.23/bar.c<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> However, you might find that not all files are in a common directory (like </span><span class="italic">package-1.23</span><span class="calibre_13"> in the preceding example):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Makefile<br class="calibre7" />README<br class="calibre7" />main.c<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Extracting an archive like this one can leave a big mess in your current directory. To avoid that, create a new directory and </span><span class="calibre3">cd</span><span class="calibre_13"> there before extracting the contents of the archive.</span></p><p class="calibre_27"><span class="calibre_13">Finally, beware of packages that contain files with absolute pathnames like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">/etc/passwd<br class="calibre7" />/etc/inetd.conf</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You likely won’t come across anything like this, but if you do, remove the archive from your system. It probably contains a Trojan horse or some other malicious code.</span></p><p class="calibre_27"><span class="calibre_13"> Once you’ve extracted the contents of a source archive and have a bunch of files in front of you, try to get a feel for the package. In particular, look for the files named something like </span><span class="italic">README</span><span class="calibre_13"> and </span><span class="italic">INSTALL</span><span class="calibre_13">. Always look at any </span><span class="italic">README</span><span class="calibre_13"> files first because they often contain a description of the package, a short manual, installation hints, and other useful information. Many packages also come with </span><span class="italic">INSTALL</span><span class="calibre_13"> files containing instructions on how to compile and install the package. Pay particular attention to special compiler options and definitions.</span></p><p class="calibre_27"><span class="calibre_13"> In addition to </span><span class="italic">README</span><span class="calibre_13"> and </span><span class="italic">INSTALL</span><span class="calibre_13"> files, you’ll find other package files that roughly fall into three categories:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Files relating to the <span class="calibre3">make</span> system, such as <span class="italic">Makefile</span>, <span class="italic">Makefile.in</span>, <span class="italic">configure</span>, and <span class="italic">CMakeLists.txt</span>. Some very old packages come with a Makefile that you might need to modify, but most use a configuration utility, such as GNU autoconf or CMake. They come with a script or configuration file (such as <span class="italic">configure</span> or <span class="italic">CMakeLists.txt</span>) to help generate a Makefile from <span class="italic">Makefile.in</span> based on your system settings and configuration options.</li><a id="calibre_link-566"></a><li value="2" class="calibre_8"> Source code files ending in <span class="italic">.c</span>, <span class="italic">.h</span>, or <span class="italic">.cc</span>. C source code files may appear just about anywhere in a package directory. C++ source code files usually have <span class="italic">.cc</span>, <span class="italic">.C</span>, or <span class="italic">.cxx</span> suffixes.</li><li value="3" class="calibre_8"> Object files ending in <span class="italic">.o</span> or binaries. Normally, there aren’t any object files in source code distributions, but you might find some in rare cases when the package maintainer is not permitted to release certain source code and you need to do something special in order to use the object files. In most cases, object (or binary executable) files in a source distribution mean that the package wasn’t put together well, so you should run <span class="calibre3">make clean</span> to make sure that you get a fresh compile.</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-457" class="calibre_23"><span class="calibre1"><span class="bold"> 16.3 GNU Autoconf</span></span></p><p class="calibre_24"><span class="calibre_13">Even though C source code is usually fairly portable, differences on each platform make it impossible to compile most packages with a single Makefile. Early solutions to this problem were to provide individual Makefiles for every operating system or to provide a Makefile that was easy to modify. This approach evolved into scripts that generate Makefiles based on an analysis of the system used to build the package.</span></p><p class="calibre_27"><span class="calibre_13"> GNU autoconf is a popular system for automatic Makefile generation. Packages using this system come with files named </span><span class="italic">configure</span><span class="calibre_13">, </span><span class="italic">Makefile.in</span><span class="calibre_13">, and </span><span class="italic">config.h.in</span><span class="calibre_13">. The </span><span class="italic">.in</span><span class="calibre_13"> files are templates; the idea is to run the </span><span class="calibre3">configure</span><span class="calibre_13"> script in order to discover the characteristics of your system, and then make substitutions in the </span><span class="italic">.in</span><span class="calibre_13"> files to create the real build files. For the end user, it’s easy; to generate a Makefile from </span><span class="italic">Makefile.in</span><span class="calibre_13">, run </span><span class="calibre3">configure</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">./configure</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You should get a lot of diagnostic output as the script checks your system for prerequisites. If all goes well, </span><span class="calibre3">configure</span><span class="calibre_13"> creates one or more Makefiles and a </span><span class="italic">config.h</span><span class="calibre_13"> file, as well as a cache file (</span><span class="italic">config.cache</span><span class="calibre_13">), so that it doesn’t need to run certain tests again.</span></p><p class="calibre_27"><span class="calibre_13"> Now you can run </span><span class="calibre3">make</span><span class="calibre_13"> to compile the package. A successful </span><span class="calibre3">configure</span><span class="calibre_13"> step doesn’t necessarily mean that the </span><span class="calibre3">make</span><span class="calibre_13"> step will work, but the chances are pretty good. (See </span>Section 16.6<span class="calibre_13"> for tips on troubleshooting failed configures and compiles.)</span></p><p class="calibre_27"><span class="calibre_13">Let’s get some firsthand experience with the process.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> At this point, you must have all of the required build tools available on your system. For Debian and Ubuntu, the easiest way to ensure this is to install the </span></span><span class="calibre3">build-essential</span><span class="italic"><span class="calibre_13"> package; in Fedora-like systems, use the “Development Tools” </span></span><span class="calibre3">groupinstall</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p id="calibre_link-458" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">16.3.1  An Autoconf Example</span></span></span></p><p class="calibre_45"><span class="calibre_13">Before discussing how you can change the behavior of autoconf, let’s look at a simple example so that you know what to expect. You’ll install the GNU coreutils package in your own home directory (to make sure that you don’t mess up your system). Get the package from </span><a href="http://ftp.gnu.org/gnu/coreutils/"><span class="italic"><span class="calibre_4">http://ftp.gnu.org/gnu/coreutils/</span></span></a><span class="calibre_13"> (the latest version is usually the best), unpack it, change to its directory, and configure it like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ ./</span><span class="calibre3"><span class="bold">configure --prefix=$HOME/mycoreutils</span></span><span class="calibre3"><br class="calibre7" />checking for a BSD-compatible install... /usr/bin/install -c<br class="calibre7" />checking whether build environment is sane... yes<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />config.status: executing po-directories commands<br class="calibre7" />config.status: creating po/POTFILES<br class="calibre7" />config.status: creating po/Makefile</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Now run </span><span class="calibre3"><span class="bold">make</span></span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make</span></span><span class="calibre3"> GEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/alloca.h GEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/c++defs.h<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />make[2]: Leaving directory '/home/juser/coreutils-8.32/gnulib-tests'<br class="calibre7" />make[1]: Leaving directory '/home/juser/coreutils-8.32'</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Next, try to run one of the executables you just created, such as </span><span class="italic">./src/ls</span><span class="calibre_13">, and try running </span><span class="calibre3"><span class="bold">make check</span></span><span class="calibre_13"> to run a series of tests on the package. (This might take a while, but it’s interesting to see.)</span></p><p class="calibre_27"><span class="calibre_13"> Finally, you’re ready to install the package. Do a dry run with </span><span class="calibre3"><span class="bold">make -n</span></span><span class="calibre_13"> first to see what </span><span class="calibre3">make install</span><span class="calibre_13"> does without actually doing the install:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make -n install</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Browse through the output, and if nothing seems strange (such as the package installing anywhere other than your </span><span class="italic">mycoreutils</span><span class="calibre_13"> directory), do the install for real:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">make install</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You should now have a subdirectory named </span><span class="italic">mycoreutils</span><span class="calibre_13"> in your home directory that contains </span><span class="italic">bin</span><span class="calibre_13">, </span><span class="italic">share</span><span class="calibre_13">, and other subdirectories. Check out some of the programs in </span><span class="italic">bin </span><span class="calibre_13">(you just built many of the basic tools that you learned about in </span>Chapter 2<span class="calibre_13">). Finally, because you configured the </span><span class="italic">mycoreutils</span><span class="calibre_13"> directory to be independent of the rest of your system, you can remove it completely without worrying about causing damage.</span></p><p id="calibre_link-459" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.3.2  Installation Using a Packaging Tool</span></span></span></p><p class="calibre_45"><span class="calibre_13">On most distributions, it’s possible to install new software as a package that you can maintain later with your distribution’s packaging tools. Debian-based distributions, such as Ubuntu, are perhaps the easiest; rather than running a plain </span><span class="calibre3">make install</span><span class="calibre_13">, you install the package with the </span><span class="calibre3">checkinstall</span><span class="calibre_13"> utility, as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">checkinstall make install</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Running this command shows the settings pertaining to the package that you’re about to build, and gives you the opportunity to change them. When you proceed with the installation, </span><span class="calibre3">checkinstall</span><span class="calibre_13"> keeps track of all of the files to be installed on the system and puts them into a </span><span class="italic">.deb</span><span class="calibre_13"> file. You can then use </span><span class="calibre3">dpkg</span><span class="calibre_13"> to install (and remove) the new package.</span></p><p class="calibre_27"><span class="calibre_13"> Creating an RPM package is a little more involved, because you must first create a directory tree for your package(s). You can do this with the </span><span class="calibre3">rpmdev-setuptree</span><span class="calibre_13"> command; when complete, you can use the </span><span class="calibre3">rpmbuild</span><span class="calibre_13"> utility to work through the rest of the steps. It’s best to follow an online tutorial for this process.</span></p><p id="calibre_link-460" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.3.3  configure Script Options</span></span></span></p><p class="calibre_45"><span class="calibre_13">You’ve just seen one of the most useful options for the </span><span class="calibre3">configure</span><span class="calibre_13"> script: using </span><span class="calibre3">--prefix</span><span class="calibre_13"> to specify the installation directory. By default, the </span><span class="calibre3">install</span><span class="calibre_13"> target from an autoconf-generated Makefile uses a </span><span class="italic">prefix</span><span class="calibre_13"> of </span><span class="italic">/usr/local</span><span class="calibre_13">&mdash;that is, binary programs go in </span><span class="italic">/usr/local/bin</span><span class="calibre_13">, libraries go in </span><span class="italic">/usr/local/lib</span><span class="calibre_13">, and so on. You will often want to change that prefix like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">./configure --prefix=</span></span><span class="calibre3"><span class="italic"><span class="bold">new_prefix</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Most versions of </span><span class="calibre3">configure</span><span class="calibre_13"> have a </span><span class="calibre3">--help</span><span class="calibre_13"> option that lists other configuration options. Unfortunately, the list is usually so long that it’s sometimes hard to figure out what might be important, so here are some essential options:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">--bindir=</span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span> Installs executables in <span class="calibre3"><span class="italic">directory</span></span>.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">--sbindir=</span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span> Installs system executables in <span class="calibre3"><span class="italic">directory</span></span>.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">--libdir=</span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span> Installs libraries in <span class="calibre3"><span class="italic">directory</span></span>.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">--disable-shared</span></span> Prevents the package from building shared libraries. Depending on the library, this can save hassles later on (see Section 15.1.3).</li><li value="5" class="calibre_8"><span class="calibre3"><span class="bold">--with-</span></span><span class="calibre3"><span class="italic"><span class="bold">package</span></span></span><span class="calibre3"><span class="bold">=</span></span><span class="calibre3"><span class="italic"><span class="bold">directory</span></span></span> Tells <span class="calibre3">configure</span> that <span class="calibre3"><span class="italic">package</span></span> is in <span class="calibre3"><span class="italic">directory</span></span>. This is handy when a necessary library is in a nonstandard location. Unfortunately, not all <span class="calibre3">configure</span> scripts recognize this type of option, and it can be difficult to determine the exact syntax.</li></ol><div class="mbp_pagebreak"></div><blockquote id="calibre_link-608" class="calibre_66"><span class="bold">USING SEPARATE BUILD DIRECTORIES</span></blockquote><blockquote class="calibre_49"><span class="calibre3"><span class="calibre_13">You can create separate build directories if you want to experiment with some of these options. To do so, create a new directory anywhere on the system and, from that directory, run the </span></span><span class="calibre3">configure</span><span class="calibre3"><span class="calibre_13"> script in the original package source code directory. You’ll find that </span></span><span class="calibre3">configure</span><span class="calibre3"><span class="calibre_13"> then makes a symbolic link farm in your new build directory, where all of the links point back to the source tree in the original package directory. (Some developers prefer that you build packages this way, because the original source tree is never modified. This is also useful if you want to build for more than one platform or configuration option set using the same source package.)</span></span></blockquote><p id="calibre_link-461" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">16.3.4  Environment Variables</span></span></span></p><p class="calibre_45"><span class="calibre_13">You can influence </span><span class="calibre3">configure</span><span class="calibre_13"> with environment variables that the </span><span class="calibre3">configure</span><span class="calibre_13"> script puts into </span><span class="calibre3">make</span><span class="calibre_13"> variables. The most important ones are </span><span class="calibre3">CPPFLAGS</span><span class="calibre_13">, </span><span class="calibre3">CFLAGS</span><span class="calibre_13">, and </span><span class="calibre3">LDFLAGS</span><span class="calibre_13">. But be aware that </span><span class="calibre3">configure</span><span class="calibre_13"> can be very picky about environment variables. For example, you should normally use </span><span class="calibre3">CPPFLAGS</span><span class="calibre_13"> instead of </span><span class="calibre3">CFLAGS</span><span class="calibre_13"> for header file directories, because </span><span class="calibre3">configure</span><span class="calibre_13"> often runs the preprocessor independently of the compiler.</span></p><p class="calibre_27"><span class="calibre_13"> In </span><span class="calibre3">bash</span><span class="calibre_13">, the easiest way to send an environment variable to </span><span class="calibre3">configure</span><span class="calibre_13"> is by placing the variable assignment in front of .</span><span class="calibre3">/configure</span><span class="calibre_13"> on the command line. For example, to define a </span><span class="calibre3">DEBUG</span><span class="calibre_13"> macro for the preprocessor, use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold">$ CPPFLAGS=-DDEBUG ./configure</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> You can also pass a variable as an option to </span><span class="calibre3">configure</span><span class="calibre_13">; for example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="bold">$ ./configure CPPFLAGS=-DDEBUG</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Environment variables are especially handy when </span><span class="calibre3">configure</span><span class="calibre_13"> doesn’t know where to look for third-party include files and libraries. For example, to make the preprocessor search in </span><span class="calibre3"><span class="italic">include_dir</span></span><span class="calibre_13">, run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">CPPFLAGS=-I</span></span><span class="calibre3"><span class="italic"><span class="bold">include_dir</span></span></span><span class="calibre3"><span class="bold"> ./configure</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As shown in </span>Section 15.2.6<span class="calibre_13">, to make the linker look in </span><span class="calibre3"><span class="italic">lib_dir</span></span><span class="calibre_13">, use this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">LDFLAGS=-L</span></span><span class="calibre3"><span class="italic"><span class="bold">lib_dir</span></span></span><span class="calibre3"><span class="bold"> ./configure</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If </span><span class="calibre3"><span class="italic">lib_dir </span></span><span class="calibre_13">has shared libraries (see </span>Section 15.1.3<span class="calibre_13">), the previous command probably won’t set the runtime dynamic linker path. In that case, use the </span><span class="calibre3">-rpath</span><span class="calibre_13"> linker option in addition to </span><span class="calibre3">-L</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">LDFLAGS="-L</span></span><span class="calibre3"><span class="italic"><span class="bold">lib_dir</span></span></span><span class="calibre3"><span class="bold"> -Wl,-rpath=</span></span><span class="calibre3"><span class="italic"><span class="bold">lib_dir</span></span></span><span class="calibre3"><span class="bold">" ./configure</span></span></blockquote></blockquote><p id="calibre_link-605" class="calibre_30"><span class="calibre_13">Be careful when setting variables. A small slip can trip up the compiler and cause </span><span class="calibre3">configure</span><span class="calibre_13"> to fail. For example, say you forget the </span><span class="calibre3">-</span><span class="calibre_13"> in </span><span class="calibre3">-I</span><span class="calibre_13">, as shown here:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">CPPFLAGS=I</span></span><span class="calibre3"><span class="italic"><span class="bold">include_dir</span></span></span><span class="calibre3"><span class="bold"> ./configure</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This yields an error like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">configure: error: C compiler cannot create executables<br class="calibre7" />See 'config.log' for more details</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Digging through the </span><span class="italic">config.log</span><span class="calibre_13"> generated from this failed attempt yields this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">configure:5037: checking whether the C compiler works<br class="calibre7" />configure:5059: gcc&nbsp; Iinclude_dir&nbsp; conftest.c&nbsp; &gt;&amp;5<br class="calibre7" />gcc: error: Iinclude_dir: No such file or directory<br class="calibre7" />configure:5063: $? = 1<br class="calibre7" />configure:5101: result: no</span></blockquote></blockquote><p id="calibre_link-462" class="calibre_42"><span class="calibre6"><span class="italic"><span class="bold">16.3.5  Autoconf Targets</span></span></span></p><p class="calibre_45"><span class="calibre_13">Once you get </span><span class="calibre3">configure</span><span class="calibre_13"> working, you’ll find that the Makefile it generates has a number of useful targets in addition to the standard </span><span class="calibre3">all</span><span class="calibre_13"> and </span><span class="calibre3">install</span><span class="calibre_13">:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="calibre3"><span class="bold">make clean</span></span> As described in Chapter 15, this removes all object files, executables, and libraries.</li><li value="2" class="calibre_8"><span class="calibre3"><span class="bold">make distclean</span></span> This is similar to <span class="calibre3">make clean</span> except it removes all automatically generated files, including Makefiles, <span class="italic">config.h</span>, <span class="italic">config.log</span>, and so on. The idea is that the source tree should look like a newly unpacked distribution after running <span class="calibre3">make distclean</span>.</li><li value="3" class="calibre_8"><span class="calibre3"><span class="bold">make check</span></span> Some packages come with a battery of tests to verify that the compiled programs work properly; the command <span class="calibre3">make check</span> runs those tests.</li><li value="4" class="calibre_8"><span class="calibre3"><span class="bold">make install-strip</span></span> This is like <span class="calibre3">make install</span> except it strips the symbol table and other debugging information from executables and libraries when installing. Stripped binaries require much less space.</li></ol><p id="calibre_link-463" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.3.6  Autoconf Logfiles</span></span></span></p><p class="calibre_45"><span class="calibre_13">If something goes wrong during the configure process and the cause isn’t obvious, you can examine </span><span class="italic">config.log</span><span class="calibre_13"> to find the problem. Unfortunately, </span><span class="italic">config.log</span><span class="calibre_13"> is often a gigantic file, which can make it difficult to locate the exact source of the issue.</span></p><p class="calibre_27"><span class="calibre_13"> The general approach in this situation is to go to the very end of </span><span class="italic">config.log</span><span class="calibre_13"> (for example, by typing a capital </span>G<span class="calibre_13"> in </span><span class="calibre3">less</span><span class="calibre_13">) and then page back up until you see the problem. However, there’s still a lot of stuff at the end because </span><span class="calibre3">configure</span><span class="calibre_13"> dumps its entire environment there, including output variables, cache variables, and other definitions. So, rather than going to the end and paging up, go to the end and search backward for a string, such as </span><a id="calibre_link-572"></a><span class="calibre3">for more details</span><span class="calibre_13"> or some other fragment of text near the end of the failed </span><span class="calibre3">configure</span><span class="calibre_13"> output. (Remember, you can initiate a reverse search in </span><span class="calibre3">less</span><span class="calibre_13"> with the </span><span class="calibre3">?</span><span class="calibre_13"> command.) There’s a good chance the error will be right above what your search finds.</span></p><p id="calibre_link-464" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.3.7  pkg-config</span></span></span></p><p class="calibre_45"><span class="calibre_13">The multitude of third-party libraries on a system means that keeping all of them in a common location can be messy. However, installing each with a separate prefix can lead to problems with building packages that require those third-party libraries. For example, if you want to compile OpenSSH, you need the OpenSSL library. How do you tell the OpenSSH configuration process the location of the OpenSSL libraries and which ones are required?</span></p><p class="calibre_27"><span class="calibre_13"> Many libraries now use the </span><span class="calibre3">pkg-config</span><span class="calibre_13"> program not only to advertise the locations of their include files and libraries but also to specify the exact flags you need to compile and link a program. The syntax is as follows:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">pkg-config </span></span><span class="calibre3"><span class="italic"><span class="bold">options package1 package2 ...</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">For example, to find the libraries required for a popular compression library, you can run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">pkg-config --libs zlib</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">The output should look something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">-lz</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> To see all libraries that </span><span class="calibre3">pkg-config</span><span class="calibre_13"> knows about, including a brief description of each, run this command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">pkg-config --list-all</span></span></blockquote></blockquote><p class="calibre_42"><span class="bold">How pkg-config Works</span></p><p class="calibre_25"><span class="calibre_13">If you look behind the scenes, you’ll find that </span><span class="calibre3">pkg-config</span><span class="calibre_13"> finds package information by reading configuration files that end with </span><span class="italic">.pc</span><span class="calibre_13">. For example, here’s </span><span class="italic">openssl.pc</span><span class="calibre_13"> for the OpenSSL socket library, as seen on an Ubuntu system (located in </span><span class="italic">/usr/lib/x86_64-linux-gnu/pkgconfig</span><span class="calibre_13">):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">prefix=/usr<br class="calibre7" />exec_prefix=${prefix}<br class="calibre7" />libdir=${exec_prefix}/lib/x86_64-linux-gnu<br class="calibre7" />includedir=${prefix}/include<br class="calibre7" />Name: OpenSSL<br class="calibre7" />Description: Secure Sockets Layer and cryptography libraries and tools<br class="calibre7" />Version: 1.1.1fRequires: <br class="calibre7" />Libs: -L${libdir} -lssl -lcrypto<br class="calibre7" />Libs.private: -ldl -lz<br class="calibre7" />Cflags: -I${includedir} exec_prefix=${prefix}</span></blockquote><a id="calibre_link-791"></a></blockquote><p class="calibre_30"><span class="calibre_13"> You can change this file, for example, by adding </span><span class="calibre3">-Wl,-rpath=${libdir}</span><span class="calibre_13"> to the library flags to set a runtime library search path. However, the bigger question is how </span><span class="calibre3">pkg-config</span><span class="calibre_13"> finds the </span><span class="italic">.pc</span><span class="calibre_13"> files in the first place. By default, </span><span class="calibre3">pkg-config</span><span class="calibre_13"> looks in the </span><span class="italic">lib/pkgconfig</span><span class="calibre_13"> directory of its installation prefix. For example, a </span><span class="calibre3">pkg-config</span><span class="calibre_13"> installed with a </span><span class="italic">/usr/local</span><span class="calibre_13"> prefix looks in </span><span class="italic">/usr/local/lib/pkgconfig</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You won’t see </span></span>.pc<span class="italic"><span class="calibre_13"> files for many packages unless you install the development packages. For example, to get </span></span>openssl.pc<span class="italic"><span class="calibre_13"> on an Ubuntu system, you must install the </span></span><span class="calibre3">libssl-dev</span><span class="italic"><span class="calibre_13"> package.</span></span></blockquote><p class="calibre_23"><span class="bold">How to Install pkg-config Files in Nonstandard Locations</span></p><p class="calibre_25"><span class="calibre_13">Unfortunately, by default, </span><span class="calibre3">pkg-config</span><span class="calibre_13"> doesn’t read any </span><span class="italic">.pc</span><span class="calibre_13"> files outside its installation prefix. This means that a </span><span class="italic">.pc</span><span class="calibre_13"> file that’s in a nonstandard location, such as </span><span class="italic">/opt/openssl/lib/pkgconfig/openssl.pc</span><span class="calibre_13">, will be out of the reach of any stock </span><span class="calibre3">pkg-config</span><span class="calibre_13"> installation. There are two basic ways to make </span><span class="italic">.pc</span><span class="calibre_13"> files available outside the </span><span class="calibre3">pkg-config</span><span class="calibre_13"> installation prefix:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> Make symbolic links (or copies) from the actual <span class="italic">.pc</span> files to the central <span class="italic">pkgconfig</span> directory.</li><li value="2" class="calibre_8"> Set your <span class="calibre3">PKG_CONFIG_PATH</span> environment variable to include any extra <span class="italic">pkgconfig</span> directories. This strategy does not work well on a systemwide basis.</li></ul><div class="mbp_pagebreak"></div><p id="calibre_link-465" class="calibre_23"><span class="calibre1"><span class="bold"> 16.4 Installation Practice</span></span></p><p class="calibre_24"><span class="calibre_13">Knowing </span><span class="italic">how</span><span class="calibre_13"> to build and install software is good, but knowing </span><span class="italic">when</span><span class="calibre_13"> and </span><span class="italic">where</span><span class="calibre_13"> to install your own packages is even more useful. Linux distributions try to cram in as much software as possible at installation, so you should always check whether it would be better to install a package yourself instead. Here are the advantages of doing installs on your own:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">You can customize package defaults.</li><li value="2" class="calibre_8">When installing a package, you often get a clearer picture of how to use it.</li><li value="3" class="calibre_8">You control the release that you run.</li><li value="4" class="calibre_8">It’s easier to back up a custom package.</li><li value="5" class="calibre_8">It’s easier to distribute self-installed packages across a network (as long as the architecture is consistent and the installation location is relatively isolated).</li></ul><p id="calibre_link-647" class="calibre_33"><span class="calibre_13">Here are the disadvantages:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"> If the package you want to install is already installed on your system, you might overwrite important files, causing problems. Avoid this by using the <span class="italic">/usr/local</span> install prefix, described shortly. Even if the package isn’t installed on your system, you should check to see if the distribution has a package available. If it does, you need to remember this in case you accidentally install the distribution package later.</li><li value="2" class="calibre_8">It takes time.</li><li value="3" class="calibre_8">Custom packages do not automatically upgrade themselves. Distributions keep most packages up to date without requiring much work from you. This is a particular concern for packages that interact with the network, because you want to ensure that you always have the latest security updates.</li><li value="4" class="calibre_8">If you don’t actually use the package, you’re wasting your time.</li><li value="5" class="calibre_8">There is a potential for misconfiguring packages.</li></ul><p class="calibre_33"><span class="calibre_13"> There’s not much point in installing packages such as those in the coreutils package you built earlier in the chapter (</span><span class="calibre3">ls</span><span class="calibre_13">, </span><span class="calibre3">cat</span><span class="calibre_13">, and so on) unless you’re building a very custom system. On the other hand, if you have a vital interest in network servers such as Apache, the best way to get complete control is to install the servers yourself.</span></p><p id="calibre_link-466" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.4.1  Where to Install</span></span></span></p><p class="calibre_45"><span class="calibre_13">The default prefix in GNU autoconf and many other packages is </span><span class="italic">/usr/local</span><span class="calibre_13">, the traditional directory for locally installed software. Operating system upgrades ignore </span><span class="italic">/usr/local</span><span class="calibre_13">, so you won’t lose anything installed there during an operating system upgrade, and for small local software installations, </span><span class="italic">/usr/local</span><span class="calibre_13"> is fine. The only problem is that if you have a lot of custom software installed, this can turn into a terrible mess. Thousands of odd little files can make their way into the </span><span class="italic">/usr/local</span><span class="calibre_13"> hierarchy, and you may have no idea where the files came from.</span></p><p class="calibre_27"><span class="calibre_13"> If things really start to get unruly, you should create your own packages as described in </span>Section 16.3.2<span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-467" class="calibre_23"><span class="calibre1"><span class="bold"> 16.5 Applying a Patch</span></span></p><p class="calibre_24"><span class="calibre_13">Most changes to software source code are available as branches of the developer’s online version of the source code (such as a Git repository). However, every now and then, you might get a </span><span class="italic">patch</span><span class="calibre_13"> that you need to apply against source code to fix bugs or add features. You may also see the term </span><span class="italic">diff</span><span class="calibre_13"> used as a synonym for patch, because the </span><span class="calibre3">diff</span><span class="calibre_13"> program produces the patch.</span></p><p class="calibre_27"><span class="calibre_13">The beginning of a patch looks something like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">--- src/file.c.orig&nbsp;&nbsp;&nbsp;&nbsp; 2015-07-17 14:29:12.000000000 +0100<br class="calibre7" />+++ src/file.c&nbsp;&nbsp; 2015-09-18 10:22:17.000000000 +0100<br class="calibre7" />@@ -2,16 +2,12 @@</span></blockquote></blockquote><p id="calibre_link-846" class="calibre_30"><span class="calibre_13">Patches usually contain alterations to more than one file. Search the patch for three dashes in a row (</span><span class="calibre3">---</span><span class="calibre_13">) to see the files that have alterations and always look at the beginning of a patch to determine the required working directory. Notice that the preceding example refers to </span><span class="italic">src/file.c</span><span class="calibre_13">. Therefore, you should change to the directory that contains </span><span class="italic">src</span><span class="calibre_13"> before applying the patch, </span><span class="italic">not</span><span class="calibre_13"> to the </span><span class="italic">src</span><span class="calibre_13"> directory itself.</span></p><p class="calibre_27"><span class="calibre_13"> To apply the patch, run the </span><span class="calibre3">patch</span><span class="calibre_13"> command:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">patch -p0 &lt; </span></span><span class="calibre3"><span class="italic"><span class="bold">patch_file</span></span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If everything goes well, </span><span class="calibre3">patch</span><span class="calibre_13"> exits without a fuss, leaving you with an updated set of files. However, </span><span class="calibre3">patch</span><span class="calibre_13"> might ask you this question:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">File to patch: </span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This usually means you’re not in the correct directory, but it could also indicate that your source code doesn’t match the source code in the patch. In this case, you’re probably out of luck. Even if you could identify some of the files to patch, others would not be properly updated, leaving you with source code that you could not compile.</span></p><p class="calibre_27"><span class="calibre_13">In some cases, you might come across a patch that refers to a package version like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">--- package-3.42/src/file.c.orig&nbsp;&nbsp;&nbsp;&nbsp; 2015-07-17 14:29:12.000000000 +0100<br class="calibre7" />+++ package-3.42/src/file.c&nbsp;&nbsp; 2015-09-18 10:22:17.000000000 +0100</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> If you have a slightly different version number (or you just renamed the directory), you can tell </span><span class="calibre3">patch</span><span class="calibre_13"> to strip leading path components. For example, say you were in the directory that contains </span><span class="italic">src</span><span class="calibre_13"> (as before). To tell </span><span class="calibre3">patch</span><span class="calibre_13"> to ignore the </span><span class="italic">package-3.42/</span><span class="calibre_13"> part of the path (that is, strip one leading path component), use </span><span class="calibre3">-p1</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">patch -p1 &lt; </span></span><span class="calibre3"><span class="italic"><span class="bold">patch_file</span></span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-468" class="calibre_42"><span class="calibre1"><span class="bold"> 16.6 Troubleshooting Compiles and Installations</span></span></p><p class="calibre_24"><span class="calibre_13">If you understand the difference between compiler errors, compiler warnings, linker errors, and shared library problems as described in </span>Chapter 15<span class="calibre_13">, you shouldn’t have too much trouble fixing many of the glitches that arise when you’re building software. This section covers some common problems. Although you’re unlikely to run into any of these issues when building using autoconf, it never hurts to know what they look like.</span></p><p class="calibre_27"><span class="calibre_13"> Before covering specifics, make sure that you can read certain kinds of </span><span class="calibre3">make</span><span class="calibre_13"> output. It’s important to know the difference between an error and an ignored error. The following is a real error that you need to investigate:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">make: *** [</span><span class="calibre3"><span class="italic">target</span></span><span class="calibre3">] Error 1</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">However, some Makefiles suspect that an error condition might occur but know that these errors are harmless. You can usually disregard any messages like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">make: *** [</span><span class="calibre3"><span class="italic">target</span></span><span class="calibre3">] Error 1 (ignored)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Furthermore, GNU </span><span class="calibre3">make</span><span class="calibre_13"> often calls itself many times in large packages, with each instance of </span><span class="calibre3">make</span><span class="calibre_13"> in the error message marked with </span><span class="calibre3">[</span><span class="calibre3"><span class="italic">N</span></span><span class="calibre3">]</span><span class="calibre_13">, where </span><span class="calibre3"><span class="italic">N</span></span><span class="calibre_13"> is a number. You can often quickly find the error by looking at the </span><span class="calibre3">make</span><span class="calibre_13"> error that comes </span><span class="italic">directly</span><span class="calibre_13"> after the compiler error message. For example:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"><span class="italic">compiler error message involving </span></span><span class="calibre3">file.c<br class="calibre7" />make[3]: *** [file.o] Error 1<br class="calibre7" />make[3]: Leaving directory '/home/src/package-5.0/src'<br class="calibre7" />make[2]: *** [all] Error 2<br class="calibre7" />make[2]: Leaving directory '/home/src/package-5.0/src'<br class="calibre7" />make[1]: *** [all-recursive] Error 1<br class="calibre7" />make[1]: Leaving directory '/home/src/package-5.0/'<br class="calibre7" />make: *** [all] Error 2</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> The first three lines here give you the information you need. The trouble centers around </span><span class="italic">file.c</span><span class="calibre_13">, located in </span><span class="italic">/home/src/package-5.0/src</span><span class="calibre_13">. Unfortunately, there’s so much extra output that it can be difficult to spot the important details. Learning how to filter out the subsequent </span><span class="calibre3">make</span><span class="calibre_13"> errors goes a long way toward helping you dig out the real cause.</span></p><p id="calibre_link-469" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">16.6.1  Specific Errors</span></span></span></p><p class="calibre_45"><span class="calibre_13">Here are some common build errors that you might encounter.</span></p><p class="calibre_23"><span class="bold">Problem</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> Compiler error message: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">src.c:22: conflicting types for '</span><span class="calibre3"><span class="italic">item</span></span><span class="calibre3">'<br class="calibre7" />/usr/include/</span><span class="calibre3"><span class="italic">file</span></span><span class="calibre3">.h:47: previous declaration of '</span><span class="calibre3"><span class="italic">item</span></span><span class="calibre3">'</span></blockquote></blockquote></blockquote></li></ol><p class="calibre_42"><span class="bold">Explanation and fix</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The programmer made an erroneous redeclaration of <span class="calibre3"><span class="italic">item</span></span> on line 22 of <span class="italic">src.c</span>. You can usually fix this by removing the offending line (with a comment, an <span class="calibre3">#ifdef</span>, or whatever works).</li></ol><p class="calibre_23"><span class="bold">Problem</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> Compiler error message: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">src.c:37: 'time_t' undeclared (first use this function)<br class="calibre7" />--</span><span class="calibre3"><span class="italic">snip</span></span><span class="calibre3">--<br class="calibre7" />src.c:37: parse error before '...'</span></blockquote></blockquote></blockquote></li></ol><p id="calibre_link-609" class="calibre_42"><span class="bold">Explanation and fix</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The programmer forgot a critical header file. The manual pages are the best way to find the missing header file. First, look at the offending line (in this case, line 37 in <span class="italic">src.c</span>). It’s probably a variable declaration like the following: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">time_t v1;</span></blockquote></blockquote></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre_13">Search forward for </span><span class="calibre3">v1</span><span class="calibre_13"> in the program for its use around a function call. For example:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">v1 = time(NULL);</span></blockquote></blockquote></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre_13">Now run </span><span class="calibre3">man 2 time</span><span class="calibre_13"> or </span><span class="calibre3">man 3 time</span><span class="calibre_13"> to look for system and library calls named </span><span class="calibre3">time()</span><span class="calibre_13">. In this case, the section 2 manual page has what you need:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">SYNOPSIS #include &lt;time.h&gt; time_t time(time_t *t);</span></blockquote></blockquote></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre_13">This means that </span><span class="calibre3">time()</span><span class="calibre_13"> requires </span><span class="italic">time.h</span><span class="calibre_13">. Place </span><span class="calibre3">#include &lt;time.h&gt;</span><span class="calibre_13"> at the beginning of </span><span class="italic">src.c</span><span class="calibre_13"> and try again.</span></blockquote></blockquote></li></ol><p class="calibre_23"><span class="bold">Problem</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> Compiler (preprocessor) error message: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">src.c:4: </span><span class="calibre3"><span class="italic">pkg</span></span><span class="calibre3">.h: No such file or directory<br class="calibre7" />(long list of errors follows)</span></blockquote></blockquote></blockquote></li></ol><p class="calibre_42"><span class="bold">Explanation and fix</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The compiler ran the C preprocessor on <span class="italic">src.c</span> but could not find the <span class="italic">pkg.h</span> include file. The source code likely depends on a library that you need to install, or you may just need to provide the compiler with the nonstandard include path. Usually, you’ll just need to add a <span class="calibre3">-I</span> include path option to the C preprocessor flags (<span class="calibre3">CPPFLAGS</span>). (Keep in mind that you might also need a <span class="calibre3">-L</span> linker flag to go along with the include files.) <blockquote class="calibre_70"><blockquote class="calibre_29"><span class="calibre_13">If it doesn’t look as though you’re missing a library, there’s an outside chance you’re attempting a compile for an operating system that this source code does not support. Check the Makefile and </span><span class="italic">README</span><span class="calibre_13"> files for details about platforms.</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_29"><span class="calibre_13">If you’re running a Debian-based distribution, try the </span><span class="calibre3">apt-file</span><span class="calibre_13"> command on the header filename:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">apt-file search</span></span><span class="calibre3">
</span><span class="calibre3"><span class="italic"><span class="bold">pkg.h</span></span></span></blockquote></blockquote></blockquote><blockquote class="calibre_82"><blockquote class="calibre_29"><span class="calibre_13">This might find the development package that you need. For distributions that use </span><span class="calibre3">yum</span><span class="calibre_13">, you can try this instead:</span></blockquote></blockquote><blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">yum provides */</span></span><span class="calibre3"><span class="italic"><span class="bold">pkg.h</span></span></span><span class="calibre3">
</span></blockquote></blockquote></blockquote></li><a id="calibre_link-598"></a></ol><p class="calibre_42"><span class="bold">Problem</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> The <span class="calibre3">make</span> error message: <blockquote class="calibre_28"><blockquote class="calibre2"><blockquote class="calibre_29"><span class="calibre3">make: </span><span class="calibre3"><span class="italic">prog:</span></span><span class="calibre3"> Command not found</span></blockquote></blockquote></blockquote></li></ol><p class="calibre_42"><span class="bold">Explanation and fix</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"> To build the package, you need <span class="calibre3"><span class="italic">prog</span></span> on your system. If <span class="calibre3"><span class="italic">prog</span></span> is something like <span class="calibre3">cc</span>, <span class="calibre3">gcc</span>, or <span class="calibre3">ld</span>, you don’t have the development utilities installed on your system. On the other hand, if you think <span class="calibre3"><span class="italic">prog</span></span> is already installed on your system, try altering the Makefile to specify the full pathname of <span class="calibre3"><span class="italic">prog</span></span>. <blockquote class="calibre_70"><blockquote class="calibre_29"><span class="calibre_13">In rare cases with poorly configured source code, </span><span class="calibre3">make</span><span class="calibre_13"> builds </span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13"> and then uses </span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13"> immediately, assuming that the current directory (</span><span class="calibre3">.</span><span class="calibre_13">) is in your command path. If your </span><span class="calibre3">$PATH</span><span class="calibre_13"> does not include the current directory, you can edit the Makefile and change </span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13"> to </span><span class="calibre3">./</span><span class="calibre3"><span class="italic">prog</span></span><span class="calibre_13">. Alternatively, you could append </span><span class="calibre3">.</span><span class="calibre_13"> to your path temporarily.</span></blockquote></blockquote></li></ol><div class="mbp_pagebreak"></div><p id="calibre_link-470" class="calibre_23"><span class="calibre1"><span class="bold"> 16.7 Looking Forward</span></span></p><p class="calibre_24"><span class="calibre_13">We’ve touched only on the basics of building software. After you get the hang of your own builds, try the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Learn how to use build systems other than autoconf, such as CMake and SCons.</li><li value="2" class="calibre_8"> Set up builds for your own software. If you’re writing your own software, you want to choose a build system and learn to use it. For GNU autoconf packaging, <span class="italic">Autotools</span>, 2nd edition, by John Calcote (No Starch Press, 2019) can help you out.</li><li value="3" class="calibre_8">Compile the Linux kernel. The kernel’s build system is completely different from that of other tools. It has its own configuration system tailored to customizing your own kernel and modules. The procedure is straightforward, though, and if you understand how the bootloader works, you won’t have any trouble with it. However, you should be careful when doing so; make sure that you always keep your old kernel handy in case you can’t boot with a new one.</li><li value="4" class="calibre_8"> Explore distribution-specific source packages. Linux distributions maintain their own versions of software source code as special source packages. Sometimes you can find useful patches that expand functionality or fix problems in otherwise unmaintained packages. The source package management systems include tools for automatic builds, such as Debian’s <span class="calibre3">debuild</span> and the RPM-based <span class="calibre3">mock</span>.</li></ul><p id="calibre_link-844" class="calibre_33"><span class="calibre_13">Building software is often a stepping stone to learning about programming and software development. The tools you’ve seen in this chapter and the previous chapter take the mystery out of where your system software came from. It’s not difficult to take the next steps of looking inside the source code, making changes, and creating your own software.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-471" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p id="calibre_link-873" class="calibre_10"><span class="calibre4"><span class="bold">17</span></span><br class="calibre7" /><span class="calibre5"><span class="bold">VIRTUALIZATION</span></span></p><p class="calibre_31">&nbsp;&nbsp; <img src="images/000019.jpg" class="calibre_32" />&nbsp;&nbsp;&nbsp;  </p><p class="calibre_24"><span class="calibre1"><span class="calibre_13">The word </span></span><span class="calibre1"><span class="italic">virtual</span></span><span class="calibre1"><span class="calibre_13"> can be vague in computing systems. It’s used primarily to indicate an intermediary that translates a complex or fragmented underlying layer to a simplified interface that can be used by multiple consumers. Consider an example that we’ve already seen, virtual memory, which allows multiple processes to access a large bank of memory as if each had its own insulated bank of memory.</span></span></p><p class="calibre_33"><span class="calibre_13">That definition is still a bit daunting, so it might be better to explain the typical purpose of virtualization: creating isolated environments so that you can get multiple systems to run without clashing.</span></p><p class="calibre_27"><span class="calibre_13">Because virtual machines are relatively easy to understand at a higher level, that’s where we’ll start our tour of virtualization. However, the discussion will remain on that higher level, aiming to explain some of the many terms you may encounter when working with virtual machines, without getting into the vast sea of implementation specifics.</span></p><p id="calibre_link-724" class="calibre_27"><span class="calibre_13">We’ll go into a bit more technical detail on containers. They’re built with the technology you’ve already seen in this book, so you can see how these components can be combined. In addition, it’s relatively easy to interactively explore containers.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-472" class="calibre_23"><span class="calibre1"><span class="bold"> 17.1 Virtual Machines</span></span></p><p class="calibre_24"><span class="calibre_13">Virtual machines are based on the same concept as virtual memory, except with </span><span class="italic">all</span><span class="calibre_13"> of the machine’s hardware instead of just memory. In this model, you create an entirely new machine (processor, memory, I/O interfaces, and so on) with the help of software, and run a whole operating system in it&mdash;including a kernel. This type of virtual machine is more specifically called a </span><span class="italic">system virtual machine</span><span class="calibre_13">, and it’s been around for decades. For example, IBM mainframes traditionally use system virtual machines to create a multiuser environment; in turn, users get their own virtual machine running CMS, a simple single-user operating system.</span></p><p class="calibre_27"><span class="calibre_13"> You can construct a virtual machine entirely in software (usually called an </span><span class="italic">emulator</span><span class="calibre_13">) or by utilizing the underlying hardware as much as possible, as is done in virtual memory. For our purposes in Linux, we’ll look at the latter kind due to its superior performance, but note that a number of popular emulators support old computer and gaming systems, such as the Commodore 64 and Atari 2600.</span></p><p class="calibre_27"><span class="calibre_13">The world of virtual machines is diverse, with a tremendous amount of terminology to wade through. Our exploration of virtual machines will focus primarily on how that terminology relates to what you might experience as a typical Linux user. We’ll also discuss some of the differences you might encounter in virtual hardware.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Fortunately, using virtual machines is far simpler than describing them. For example, in VirtualBox, you can use the GUI to create and run a virtual machine or even use the command-line </span></span><span class="calibre3">VBoxManage</span><span class="italic"><span class="calibre_13"> tool if you need to automate that process in a script. The web interfaces of cloud services also facilitate administration. Due to this ease of use, we’ll concentrate more on making sense of the technology and terminology of virtual machines than the operational details.</span></span></blockquote><p id="calibre_link-473" class="calibre_23"><span class="calibre6"><span class="italic"><span class="bold">17.1.1  Hypervisors</span></span></span></p><p class="calibre_45"><span class="calibre_13">Overseeing one or more virtual machines on a computer is a piece of software called a </span><span class="italic">hypervisor</span><span class="calibre_13"> or </span><span class="italic">virtual machine monitor (VMM)</span><span class="calibre_13">, which works similarly to how an operating system manages processes. There are two types of hypervisors, and the way you use a virtual machine depends on the type. To most users, the </span><span class="italic">type 2 hypervisor</span><span class="calibre_13"> is the most familiar, because it runs on a normal operating system such as Linux. For example, VirtualBox is a type 2 hypervisor, and you can run it on your system without extensive modifications. You might have already used it while reading this book to test and explore different kinds of Linux systems.</span></p><p class="calibre_27"><span class="calibre_13"> On the other hand, a </span><span class="italic">type 1 hypervisor</span><span class="calibre_13"> is more like its own operating system (especially the kernel), built specifically to run virtual machines quickly and efficiently. This kind of hypervisor might occasionally employ a conventional companion system such as Linux to help with management tasks. Even though you might never run one on your own hardware, you interact with type 1 hypervisors all the time. All cloud computing services run as virtual machines under type 1 hypervisors such as Xen. When you access a website, you’re almost certainly hitting software running on such a virtual machine. Creating an instance of an operating system on a cloud service such as AWS is creating a virtual machine on a type 1 hypervisor.</span><a id="calibre_link-628"></a></p><p class="calibre_27"><span class="calibre_13"> In general, a virtual machine with its operating system is called a </span><span class="italic">guest</span><span class="calibre_13">. The </span><span class="italic">host</span><span class="calibre_13"> is whatever runs the hypervisor. For type 2 hypervisors, the host is just your native system. For type 1 hypervisors, the host is the hypervisor itself, possibly combined with a specialized companion system.</span></p><p id="calibre_link-474" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.1.2  Hardware in a Virtual Machine</span></span></span></p><p class="calibre_45"><span class="calibre_13">In theory, it should be straightforward for the hypervisor to provide hardware interfaces for a guest system. For example, to provide a virtual disk device, you could create a big file somewhere on the host and provide access as a disk with standard device I/O emulation. This approach is a strict hardware virtual machine; however, it is inefficient. Making virtual machines practical for a variety of needs requires some changes.</span></p><p class="calibre_27"><span class="calibre_13"> Most of the differences you might encounter between real and virtual hardware are a result of a bridging that allows guests to access host resources more directly. Bypassing virtual hardware between the host and guest is known as </span><span class="italic">paravirtualization</span><span class="calibre_13">. Network interfaces and block devices are among the most likely to receive this treatment; for example, a </span><span class="italic">/dev/xvd</span><span class="calibre_13"> device on a cloud computing instance is a Xen virtual disk, using a Linux kernel driver to talk directly to the hypervisor. Sometimes paravirtualization is used for the sake of convenience; for example, on a desktop-capable system such as VirtualBox, drivers are available to coordinate the mouse movement between the virtual machine window and the host environment.</span></p><p class="calibre_27"><span class="calibre_13">Whatever the mechanism, the goal of virtualization is always to reduce the problem just enough so that the guest operating system can treat the virtual hardware as it would any other device. This ensures that all of the layers on top of the device function properly. For example, on a Linux guest system, you want a kernel to be able to access virtual disks as block devices so that you can partition and create filesystems on them with the usual tools.</span></p><p class="calibre_46"><span class="bold">Virtual Machine CPU Modes</span></p><p class="calibre_25"><span class="calibre_13">Most of the details about how virtual machines work are beyond the scope of this book, but the CPU deserves a mention because we’ve already talked about the difference between kernel mode and user mode. The specific names of these modes vary depending on the processor (for example, the x86 processors use a system called </span><span class="italic">privilege rings</span><span class="calibre_13">), but the idea is always the same. In kernel mode, the processor can do almost anything; in user mode, some instructions are not allowed, and memory access is limited.</span></p><p id="calibre_link-629" class="calibre_27"><span class="calibre_13">The first virtual machines for the x86 architecture ran in user mode. This presented a problem, because the kernel running inside the virtual machine wants to be in kernel mode. To counter this, the hypervisor can detect and react to (“trap”) any restricted instructions coming from a virtual machine. With a little work, the hypervisor emulates the restricted instructions, enabling virtual machines to run in kernel mode on an architecture not designed for it. Because most of the instructions a kernel executes aren’t restricted, those run normally, and the performance impact is fairly minimal.</span></p><p class="calibre_27"><span class="calibre_13">Soon after the introduction of this kind of hypervisor, processor manufacturers realized that there was a market for processors that could assist the hypervisor by eliminating the need for the instruction trap and emulation. Intel and AMD released these feature sets as VT-x and AMD-V, respectively, and most hypervisors now support them. In some cases, they are required.</span></p><p class="calibre_27"><span class="calibre_13"> If you want to learn more about virtual machines, start with Jim Smith and Ravi Nair’s </span><span class="italic">Virtual Machines: Versatile Platforms for Systems and Processes</span><span class="calibre_13"> (Elsevier, 2005). This also includes coverage of </span><span class="italic">process virtual machines</span><span class="calibre_13">, such as the Java virtual machine (JVM), which we won’t discuss here.</span></p><p id="calibre_link-475" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.1.3  Common Uses of Virtual Machines</span></span></span></p><p class="calibre_45"><span class="calibre_13">In the Linux world, virtual machine use often falls into one of a few categories:</span></p><div class="calibre_44">&nbsp;</div><ol class="calibre_2"><li value="1" class="calibre_8"><span class="bold">Testing and trials</span> There are many use cases for virtual machines when you need to try something outside of a normal or production operating environment. For example, when you’re developing production software, it’s essential to test software in a machine separate from the developer’s. Another use is to experiment with new software, such as a new distribution, in a safe and “disposable” environment. Virtual machines allow you to do this without having to purchase new hardware.</li><li value="2" class="calibre_8"><span class="bold">Application compatibility</span> When you need to run something under an operating system that differs from your normal one, virtual machines are essential.</li><li value="3" class="calibre_8"><span class="bold">Servers and cloud services</span> As mentioned earlier, all cloud services are built on virtual machine technology. If you need to run an internet server, such as a web server, the quickest way to do so is to pay a cloud provider for a virtual machine instance. Cloud providers also offer specialized servers, such as databases, which are just preconfigured software sets running on virtual machines.</li></ol><p id="calibre_link-476" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.1.4  Drawbacks of Virtual Machines</span></span></span></p><p class="calibre_45"><span class="calibre_13">For many years, virtual machines have been the go-to method of isolating and scaling services. Because you can create virtual machines through a few clicks or an API, it’s very convenient to create servers without having to install and maintain hardware. That said, some aspects remain troublesome in day-to-day operation:</span><a id="calibre_link-642"></a></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"><span class="italic">It can be cumbersome and time-consuming to install and/or configure the system and application</span>. Tools such as Ansible can automate this process, but it still takes a significant amount of time to bring up a system from scratch. If you’re using virtual machines to test software, you can expect this time to accumulate quickly.</li><li value="2" class="calibre_8"><span class="italic">Even when configured properly, virtual machines start and reboot relatively slowly</span>. There are a few ways around this, but you’re still booting a full Linux system.</li><li value="3" class="calibre_8"><span class="italic">You have to maintain a full Linux system, keeping current with updates and security on each virtual machine</span>. These systems have systemd and sshd, as well as any tools on which your application depends.</li><li value="4" class="calibre_8"><span class="italic">Your application might have some conflicts with the standard software set on a virtual machine</span>. Some applications have strange dependencies, and they don’t always get along well with the software found on a production machine. In addition, dependencies like libraries can change with an upgrade in the machine, breaking things that once worked.</li><li value="5" class="calibre_8"><span class="italic">Isolating your services on separate virtual machines can be wasteful and costly</span>. The standard industry practice is to run no more than one application service on a system, which is robust and easier to maintain. In addition, some services can be further segmented; if you run multiple websites, it’s preferable to keep them on different servers. However, this is at odds with keeping costs down, especially when you’re using cloud services, which charge per virtual machine instance.</li></ul><p class="calibre_33"><span class="calibre_13">These problems are really no different from the ones you’d encounter running services on real hardware, and they aren’t necessarily impediments in small operations. However, once you start running more services, they’ll become more noticeable, costing time and money. This is when you might consider containers for your services.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-477" class="calibre_23"><span class="calibre1"><span class="bold"> 17.2 Containers</span></span></p><p class="calibre_24"><span class="calibre_13">Virtual machines are great for insulating an entire operating system and its set of running applications, but sometimes you need a lighter-weight alternative. Container technology is now a popular way to fulfill this need. Before we go into the details, let’s take a step back to see its evolution.</span></p><p class="calibre_27"><span class="calibre_13">The traditional way of operating computer networks was to run multiple services on the same physical machine; for example, a name server could also act as an email server and perform other tasks. However, you shouldn’t really trust any software, including servers, to be secure or stable. To enhance the security of the system and to keep services from interfering with one another, there are some basic ways to put up barriers around server daemons, especially when you don’t trust one of them very much.</span></p><p id="calibre_link-615" class="calibre_27"><span class="calibre_13">One method of service isolation is using the </span><span class="calibre3">chroot()</span><span class="calibre_13"> system call to change the root directory to something other than the actual system root. A program can change its root to something like </span><span class="italic">/var/spool/my_service</span><span class="calibre_13"> and no longer be able to access anything outside that directory. In fact, there is a </span><span class="calibre3">chroot</span><span class="calibre_13"> program that allows you to run a program with a new root directory. This type of isolation is sometimes called a </span><span class="italic">chroot jail</span><span class="calibre_13"> because processes can’t (normally) escape it.</span></p><p class="calibre_27"><span class="calibre_13">Another type of restriction is the resource limit (rlimit) feature of the kernel, which restricts how much CPU time a process can consume or how big its files can be.</span></p><p class="calibre_27"><span class="calibre_13"> These are the ideas that containers are built on: you’re altering the environment and restricting the resources with which processes run. Although there’s no single defining feature, a </span><span class="italic">container</span><span class="calibre_13"> can be loosely defined as a restricted runtime environment for a set of processes, the implication being that those processes can’t touch anything on the system outside that environment. In general, this is called </span><span class="italic">operating system&ndash;level virtualization</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13">It’s important to keep in mind that a machine running one or more containers still has only one underlying Linux kernel. However, the processes inside a container can use the user-space environment from a Linux distribution different than the underlying system.</span></p><p class="calibre_27"><span class="calibre_13">The restrictions in containers are built with a number of kernel features. Some of the important aspects of processes running in a container are:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">They have their own cgroups.</li><li value="2" class="calibre_8">They have their own devices and filesystem.</li><li value="3" class="calibre_8">They cannot see or interact with any other processes on the system.</li><li value="4" class="calibre_8">They have their own network interfaces.</li></ul><p class="calibre_33"><span class="calibre_13">Pulling all of those things together is a complicated task. It’s possible to alter everything manually, but it can be challenging; just getting a handle on the cgroups for a process is tricky. To help you along, many tools can perform the necessary subtasks of creating and managing effective containers. Two of the most popular are Docker and LXC. This chapter focuses on Docker, but we’ll also touch on LXC to see how it differs.</span></p><p id="calibre_link-478" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.2.1  Docker, Podman, and Privileges</span></span></span></p><p class="calibre_45"><span class="calibre_13">To run the examples in this book, you need a container tool. The examples here are built with Docker, which you can normally install with a distribution package without any trouble.</span></p><p class="calibre_27"><span class="calibre_13"> There is an alternative to Docker called Podman. The primary difference between the two tools is that Docker requires a server to be running when using containers, while Podman does not. This affects the way the two systems set up containers. Most Docker configurations require superuser privileges to access the kernel features used by its containers, and the dockerd daemon does the relevant work. In contrast, you can run Podman as a normal user, called </span><a id="calibre_link-633"></a><span class="italic">rootless</span><span class="calibre_13"> operation. When run this way, it uses different techniques to achieve isolation.</span></p><p class="calibre_27"><span class="calibre_13">You can also run Podman as the superuser, causing it to switch over to some of the isolation techniques that Docker uses. Conversely, newer versions of dockerd support a rootless mode.</span></p><p class="calibre_27"><span class="calibre_13"> Fortunately, Podman is command line&ndash;compatible with Docker. This means you can substitute </span><span class="calibre3">podman</span><span class="calibre_13"> for </span><span class="calibre3">docker</span><span class="calibre_13"> in the examples here, and they’ll still work. However, there are differences in the implementations, especially when you’re running Podman in rootless mode, so those will be noted where applicable.</span></p><p id="calibre_link-479" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.2.2  A Docker Example</span></span></span></p><p class="calibre_45"><span class="calibre_13">The easiest way to familiarize yourself with containers is to get hands-on. The Docker example here illustrates the principal features that make containers work, but providing an in-depth user manual is beyond the scope of this book. You should have no trouble understanding the online documentation after reading this, and if you’re looking for an extensive guide, try Nigel Poulton’s </span><span class="italic">Docker Deep Dive </span><span class="calibre_13">(author, 2016).</span></p><p class="calibre_27"><span class="calibre_13"> First you need to create an </span><span class="italic">image</span><span class="calibre_13">, which comprises the filesystem and a few other defining features for a container to run with. Your images will nearly always be based on prebuilt ones downloaded from a repository on the internet.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> It’s easy to confuse images and containers. You can think of an image as the container’s filesystem; processes don’t run in an image, but they do run in containers. This is not quite accurate (in particular, when you change the files in a Docker container, you aren’t making changes to the image), but it’s close enough for now.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Install Docker on your system (your distribution’s add-on package is probably fine), make a new directory somewhere, change to that directory, and create a file called </span><span class="italic">Dockerfile</span><span class="calibre_13"> containing these lines:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">FROM alpine:latest<br class="calibre7" />RUN apk add bash<br class="calibre7" />CMD ["/bin/bash"]</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">This configuration uses the lightweight Alpine distribution. The only change we’re making is adding the bash shell, which we’re doing not just for an added measure of interactive usability but also to create a unique image and see how that procedure works. It’s possible (and common) to use public images and make no changes to them whatsoever. In that case, you don’t need a Dockerfile.</span></p><p class="calibre_27"><span class="calibre_13"> Build the image with the following command, which reads the Dockerfile in the current directory and applies the identifier </span><span class="calibre3">hlw_test</span><span class="calibre_13"> to the image:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">docker build -t hlw_test .</span></span></blockquote></blockquote><blockquote class="calibre_66">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You might need to add yourself to the </span></span>docker<span class="italic"><span class="calibre_13"> group on your system to be able to run Docker commands as a regular user.</span></span></blockquote><p class="calibre_37"><span class="calibre_13">Be prepared for a lot of output. Don’t ignore it; reading through it this first time will help you understand how Docker works. Let’s break it up into the steps that correspond to the lines of the Dockerfile. The first task is to retrieve the latest version of the Alpine distribution container from the Docker registry:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Sending build context to Docker daemon&nbsp; 2.048kB<br class="calibre7" />Step 1/3 : FROM alpine:latest<br class="calibre7" />latest: Pulling from library/alpine<br class="calibre7" />cbdbe7a5bc2a: Pull complete <br class="calibre7" />Digest: sha256:9a839e63dad54c3a6d1834e29692c8492d93f90c59c978c1ed79109ea4b9a54<br class="calibre7" />Status: Downloaded newer image for alpine:latest ---&gt; f70734b6a266</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Notice the heavy use of SHA256 digests and shorter identifiers. Get used to them; Docker needs to track many little pieces. In this step, Docker has created a new image with the identifier </span><span class="calibre3">f70734b6a266</span><span class="calibre_13"> for the basic Alpine distribution image. You can refer to that specific image later, but you probably won’t need to, because it’s not the final image. Docker will build more on top of it later. An image that isn’t intended to be a final product is called an </span><span class="italic">intermediate image</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> The output is different when you’re using Podman, but the steps are the same.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> The next part of our configuration is the bash shell package installation in Alpine. As you read the following, you’ll probably recognize output that results from the </span><span class="calibre3">apk add bash</span><span class="calibre_13"> command (shown in bold):</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Step 2/3 : RUN apk add bash ---&gt; Running in 4f0fb4632b31</span><span class="calibre3"><span class="bold">fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gzfetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz(1/4) Installing ncurses-terminfo-base (6.1_p20200118-r4)(2/4) Installing ncurses-libs (6.1_p20200118-r4)(3/4) Installing readline (8.0.1-r0)</span></span><span class="calibre3"><span class="bold">(4/4) Installing bash (5.0.11-r1)Executing bash-5.0.11-r1.post-installExecuting busybox-1.31.1-r9.triggerOK: 8 MiB in 18 packages</span></span><span class="calibre3"><br class="calibre7" />Removing intermediate container 4f0fb4632b31 ---&gt; 12ef4043c80a</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> What’s not so obvious is </span><span class="italic">how</span><span class="calibre_13"> that’s happening. When you think about it, you probably aren’t running Alpine on your own machine here. So how can you run the </span><span class="calibre3">apk</span><span class="calibre_13"> command that belongs to Alpine already?</span></p><p id="calibre_link-634" class="calibre_27"><span class="calibre_13">The key is the line that says </span><span class="calibre3">Running in 4f0fb4632b31</span><span class="calibre_13">. You haven’t asked for a container yet, but Docker has set up a new container with the intermediate Alpine image from the previous step. Containers have identifiers as well; unfortunately, they look no different from image identifiers. To add to the confusion, Docker calls the temporary container an </span><span class="italic">intermediate container</span><span class="calibre_13">, which differs from an intermediate image. Intermediate images stay around after a build; intermediate containers do not.</span></p><p class="calibre_27"><span class="calibre_13"> After setting up the (temporary) container with ID </span><span class="calibre3">4f0fb4632b31</span><span class="calibre_13">, Docker ran the </span><span class="calibre3">apk</span><span class="calibre_13"> command inside that container to install bash, and then saved the resulting changes to the filesystem into a new intermediate image with the ID </span><span class="calibre3">12ef4043c80a</span><span class="calibre_13">. Notice that Docker also removes the container after completion.</span></p><p class="calibre_27"><span class="calibre_13">Finally, Docker makes the final changes required to run a bash shell when starting a container from the new image:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">Step 3/3 : CMD ["/bin/bash"] ---&gt; Running in fb082e6a0728<br class="calibre7" />Removing intermediate container fb082e6a0728 ---&gt; 1b64f94e5a54<br class="calibre7" />Successfully built 1b64f94e5a54<br class="calibre7" />Successfully tagged hlw_test:latest</span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> Anything done with the </span></span><span class="calibre3">RUN</span><span class="italic"><span class="calibre_13"> command in a Dockerfile happens during the image build, not afterward, when you start a container with the image. The </span></span><span class="calibre3">CMD</span><span class="italic"><span class="calibre_13"> command is for the container runtime; this is why it occurs at the end.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> In this example, you now have a final image with the ID </span><span class="calibre3">1b64f94e5a54</span><span class="calibre_13">, but because you tagged it (in two separate steps), you can also refer to it as </span><span class="calibre3">hlw_test</span><span class="calibre_13"> or </span><span class="calibre3">hlw_test:latest</span><span class="calibre_13">. Run </span><span class="calibre3">docker images</span><span class="calibre_13"> to verify that your image and the Alpine image are present:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">docker images</span></span><span class="calibre3"><br class="calibre7" />REPOSITORY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMAGE ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SIZE<br class="calibre7" />hlw_test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; latest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1b64f94e5a54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 minute ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9.19MB<br class="calibre7" />alpine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; latest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f70734b6a266&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.61MB</span></blockquote></blockquote><p class="calibre_42"><span class="bold">Running Docker Containers</span></p><p class="calibre_25"><span class="calibre_13">You’re now ready to start a container. There are two basic ways to run something in a container with Docker: you can either create the container and then run something inside it (in two separate steps), or you can simply create and run in one step. Let’s jump right into it and start one with the image that you just built:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">docker run -it hlw_test</span></span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">You should get a bash shell prompt where you can run commands in the container. That shell will run as the root user.</span></p><blockquote id="calibre_link-635" class="calibre_38">
</blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_39"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> If you forget the </span></span><span class="calibre3">-it</span><span class="italic"><span class="calibre_13"> options (interactive, connect a terminal), you won’t get a prompt, and the container will terminate almost immediately. These options are somewhat unusual in everyday use (especially </span></span><span class="calibre3">-t</span><span class="italic"><span class="calibre_13">).</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> If you’re the curious type, you’ll probably want to take a look around the container. Run some commands, such as </span><span class="calibre3">mount</span><span class="calibre_13"> and </span><span class="calibre3">ps</span><span class="calibre_13">, and explore the filesystem in general. You’ll quickly notice that although most things look like a typical Linux system, others do not. For example, if you run a complete process listing, you’ll get just two entries:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3"># </span><span class="calibre3"><span class="bold">ps aux</span></span><span class="calibre3"><br class="calibre7" />PID&nbsp;&nbsp; USER&nbsp;&nbsp;&nbsp;&nbsp; TIME&nbsp; COMMAND 1 root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:00 /bin/bash 6 root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0:00 ps aux</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13">Somehow, in the container, the shell is process ID 1 (remember, on a normal system, this is init), and nothing else is running except for the process listing that you’re executing.</span></p><p class="calibre_27"><span class="calibre_13">At this point, it’s important to remember that these processes are simply ones that you can see on your normal (host) system. If you open another shell window on your host system, you can find a container process in a listing, though it will require a little searching. It should look like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">root&nbsp;&nbsp;&nbsp;&nbsp; 20189&nbsp; 0.2&nbsp; 0.0&nbsp;&nbsp; 2408&nbsp; 2104 pts/0&nbsp;&nbsp;&nbsp; Ss+&nbsp; 08:36&nbsp;&nbsp; 0:00 /bin/bash</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This is our first encounter with one of the kernel features used for containers: Linux kernel </span><span class="italic">namespaces</span><span class="calibre_13"> specifically for process IDs. A process can create a whole new set of process IDs for itself and its children, starting at PID 1, and then they are able to see only those.</span></p><p class="calibre_46"><span class="bold">Overlay Filesystems</span></p><p class="calibre_25"><span class="calibre_13">Next, explore the filesystem in your container. You’ll find it’s somewhat minimal; this is because it’s based on the Alpine distribution. We’re using Alpine not just because it’s small, but also because it’s likely to be different from what you’re used to. However, when you take a look at the way the root filesystem is mounted, you’ll see it’s very different from a normal device-based mount:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">overlay on / type overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/<br class="calibre7" />C3D66CQYRP4SCXWFFY6HHF6X5Z:/var/lib/docker/overlay2/l/K4BLIOMNRROX3SS5GFPB<br class="calibre7" />7SFISL:/var/lib/docker/overlay2/l/2MKIOXW5SUB2YDOUBNH4G4Y7KF1,upperdir=/<br class="calibre7" />var/lib/docker/overlay2/d064be6692c0c6ff4a45ba9a7a02f70e2cf5810a15bcb2b728b00<br class="calibre7" />dc5b7d0888c/diff,workdir=/var/lib/docker/overlay2/d064be6692c0c6ff4a45ba9a7a02<br class="calibre7" />f70e2cf5810a15bcb2b728b00dc5b7d0888c/work)</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> This is an </span><span class="italic">overlay filesystem</span><span class="calibre_13">, a kernel feature that allows you to create a filesystem by combining existing directories as layers, with changes stored in a single spot. If you look on your host system, you’ll see it (and have access to the component directories), and you’ll also find where Docker attached the original mount.</span><a id="calibre_link-636"></a></p><div class="mbp_pagebreak"></div><blockquote class="calibre_43"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> In rootless mode, Podman uses the FUSE version of the overlay filesystem. In this case, you won’t see this detailed information from the filesystem mounts, but you can get similar information by examining the fuse-overlayfs processes on the host system.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> In the mount output, you’ll see the </span><span class="calibre3">lowerdir</span><span class="calibre_13">, </span><span class="calibre3">upperdir</span><span class="calibre_13">, and </span><span class="calibre3">workdir</span><span class="calibre_13"> directory parameters. The lower directory is actually a colon-separated series of directories, and if you look them up on your host system, you’ll find that the last one </span>1<span class="calibre_13"> is the base Alpine distribution that was set up in the first step of the image build (just look inside; you’ll see the distribution root directory). If you follow the two preceding directories, you’ll see they correspond to the other two build steps. Therefore, these directories “stack” on top of each other in order from right to left.</span></p><p class="calibre_27"><span class="calibre_13">The upper directory goes on top of those, and it’s also where any changes to the mounted filesystem appear. It doesn’t have to be empty when you mount it, but for containers, it doesn’t make much sense to put anything there to start. The work directory is a place for the filesystem driver to do its work before writing changes to the upper directory, and it must be empty upon mount.</span></p><p class="calibre_27"><span class="calibre_13"> As you can imagine, container images with many build steps have quite a few layers. This is sometimes a problem, and there are various strategies to minimize the number of layers, such as combining </span><span class="calibre3">RUN</span><span class="calibre_13"> commands and multistage builds. We won’t go into details about those here.</span></p><p class="calibre_46"><span class="bold">Networking</span></p><p class="calibre_25"><span class="calibre_13">Although you can choose to have a container run in the same network as the host machine, you normally want some kind of isolation in the network stack for safety. There are several ways to achieve this in Docker, but the default (and most common) is called a bridge network, using another kind of namespace&mdash;the network namespace (netns). Before running anything, Docker creates a new network interface (usually </span><span class="italic">docker0</span><span class="calibre_13">) on the host system, typically assigned to a private network such as 172.17.0.0/16, so the interface in this case would be assigned to 172.17.0.1. This network is for communication between the host machine and its containers.</span></p><p class="calibre_27"><span class="calibre_13"> Then, when creating a container, Docker creates a new network namespace, which is almost completely empty. At first, the new namespace (which will be the one in the container) contains only a new, private loopback (</span><span class="italic">lo</span><span class="calibre_13">) interface. To prepare the namespace for actual use, Docker creates a </span><span class="italic">virtual interface</span><span class="calibre_13"> on the host, which simulates a link between two actual network interfaces (each with its own device) and places one of those devices in the new namespace. With a network configuration using an address on the Docker network (172.17.0.0/16 in our case) on the device in the new namespace, processes can send packets on that network and be received on the host. This can be confusing, because different interfaces in different namespaces can have the same name (for example, the container’s can be </span><a id="calibre_link-640"></a><span class="italic">eth0</span><span class="calibre_13">, as well as the host machine).</span></p><p class="calibre_27"><span class="calibre_13">Because this uses a private network (and a network administrator probably wouldn’t want to route anything to and from these containers blindly), if left this way, the container processes using that namespace couldn’t reach the outside world. To make it possible to reach outside hosts, the Docker network on the host configures NAT.</span></p><p class="calibre_27"><a href="#calibre_link-545"><span class="italic"><span class="calibre_4">Figure 17-1</span></span></a><span class="calibre_13"> shows a typical setup. It includes the physical layer with the interfaces, as well as the internet layer of the Docker subnet and the NAT linking this subnet to the rest of the host machine and its outside connections.</span></p><p class="calibre_34"><img src="images/000012.jpg" class="calibre_104" />
</p><p id="calibre_link-545" class="calibre_36"><span class="calibre3"><span class="italic"><span class="calibre_4">Figure 17-1</span></span></span><span class="calibre3"><span class="italic"><span class="calibre_13">: Bridge network in Docker. The thick link represents the virtual interface pair bond.</span></span></span></p><div class="mbp_pagebreak"></div><blockquote class="calibre_49"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> You might need to examine the subnet of your Docker interface network. There can sometimes be clashes between it and the NAT-based network assigned by router hardware from telecommunications companies.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Rootless operation networking in Podman is different because setting up virtual interfaces requires superuser access. Podman still uses a new network namespace, but it needs an interface that can be set up to operate in user space. This is a TAP interface (usually at </span><span class="italic">tap0</span><span class="calibre_13">), and in conjunction with a forwarding daemon called slirp4netns, container processes can reach the outside world. This is less capable; for example, containers cannot connect to one another.</span></p><p class="calibre_27"><span class="calibre_13">There’s a lot more to networking, including how to expose ports in the container’s network stack for external services to use, but the network topology is the most important thing to understand.</span></p><p class="calibre_46"><span class="bold">Docker Operation</span></p><p class="calibre_25"><span class="calibre_13">At this point, we could continue with a discussion of the various other kinds of isolation and restrictions that Docker enables, but it would take a long time and you probably get the point by now. Containers don’t come from one particular feature, but rather a collection of them. A consequence is that Docker must keep track of all of the things we do when creating a container and must also be able to clean them up.</span><a id="calibre_link-637"></a></p><p class="calibre_27"><span class="calibre_13"> Docker defines a container as “running” as long as it has a process running. You can show the currently running containers with </span><span class="calibre3">docker ps</span><span class="calibre_13">:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">docker ps</span></span><span class="calibre3"><br class="calibre7" />CONTAINER ID&nbsp;&nbsp; IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PORTS&nbsp;&nbsp;&nbsp; NAMES<br class="calibre7" />bda6204cecf7&nbsp;&nbsp; hlw_test&nbsp;&nbsp;&nbsp; "/bin/bash"&nbsp;&nbsp; 8 hours ago&nbsp;&nbsp; Up 8 hours&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boring_lovelace<br class="calibre7" />8a48d6e85efe&nbsp;&nbsp; hlw_test&nbsp;&nbsp;&nbsp; "/bin/bash"&nbsp;&nbsp; 20 hours ago&nbsp; Up 20 hours&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; awesome_elion</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> As soon as all of its processes terminate, Docker puts them in an exit state, but it still keeps the containers (unless you start with the </span><span class="calibre3">--rm</span><span class="calibre_13"> option). This includes the changes made to the filesystem. You can easily access the filesystem with </span><span class="calibre3">docker export</span><span class="calibre_13">.</span></p><p class="calibre_27"><span class="calibre_13"> You need to be aware of this, because </span><span class="calibre3">docker ps</span><span class="calibre_13"> doesn’t show exited containers by default; you have to use the </span><span class="calibre3">-a</span><span class="calibre_13"> option to see everything. It’s really easy to accumulate a large pile of exited containers, and if the application running in the container creates a lot of data, you can run out of disk space and not know why. Use </span><span class="calibre3">docker rm</span><span class="calibre_13"> to remove a terminated container.</span></p><p class="calibre_27"><span class="calibre_13"> This also applies to old images. Developing an image tends to be a repetitive process, and when you tag an image with the same tag as an existing image, Docker doesn’t remove the original image. The old image simply loses that tag. If you run </span><span class="calibre3">docker images</span><span class="calibre_13"> to show all the images on your system, you can see all of the images. Here’s an example showing a previous version of an image without a tag:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">docker images</span></span><span class="calibre3"><br class="calibre7" />REPOSITORY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TAG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IMAGE ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SIZE<br class="calibre7" />hlw_test&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; latest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1b64f94e5a54&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 43 hours ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9.19MB<br class="calibre7" />&lt;none&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;none&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d0461f65b379&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 46 hours ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9.19MB<br class="calibre7" />alpine&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; latest&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f70734b6a266&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 weeks ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.61MB</span></blockquote></blockquote><p class="calibre_30"><span class="calibre_13"> Use </span><span class="calibre3">docker rmi</span><span class="calibre_13"> to remove an image. This also removes any unnecessary intermediate images that the image builds on. If you don’t remove images, they can add up over time. Depending on what’s in the images and how they are built, this can consume a significant amount of storage space on your system.</span></p><p class="calibre_27"><span class="calibre_13">In general, Docker does a lot of meticulous versioning and checkpointing. This layer of management reflects a particular philosophy compared to tools like LXC, which you’ll see soon.</span></p><p class="calibre_46"><span class="bold">Docker Service Process Models</span></p><p class="calibre_25"><span class="calibre_13">One potentially confusing aspect of Docker containers is the lifecycle of the processes inside them. Before a process can completely terminate, its parent is supposed to collect (“reap”) its exit code with the </span><span class="calibre3">wait()</span><span class="calibre_13"> system call. However, in a container, there are some situations in which dead processes can remain because their parents don’t know how to react. Along with the way that many images are configured, this might lead you to conclude that you’re not supposed to run multiple processes or services inside a Docker container. This is not correct.</span><a id="calibre_link-641"></a></p><p class="calibre_27"><span class="calibre_13">You can have many processes in a container. The shell we ran in our example starts a new child process when you run a command. The only thing that really matters is that when you have child processes, the parent cleans up upon their exit. Most parents do this, but in certain circumstances, you might run into a situation where one does not, especially if it doesn’t know that it has children. This can happen when there are multiple levels of process spawning, and the PID 1 inside the container ends up being the parent of a child that it doesn’t know about.</span></p><p class="calibre_27"><span class="calibre_13"> To remedy this, if you have a simple single-minded service that just spawns some processes and seems to leave lingering processes even when a container is supposed to terminate, you can add the </span><span class="calibre3">--init</span><span class="calibre_13"> option to </span><span class="calibre3">docker run</span><span class="calibre_13">. This creates a very simple init process to run as PID 1 in the container and act as a parent that knows what to do when a child process terminates.</span></p><p class="calibre_27"><span class="calibre_13">However, if you’re running multiple services or tasks inside a container (such as multiple workers for some job server), instead of starting them with a script, you might consider using a process management daemon such as Supervisor (supervisord) to start and monitor them. This not only provides the necessary system functionality, but also gives you more control over service processes.</span></p><p class="calibre_27"><span class="calibre_13">On that note, if you’re thinking about this kind of model for a container, there’s a different option that you might consider, and it doesn’t involve Docker.</span></p><p id="calibre_link-480" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.2.3  LXC</span></span></span></p><p class="calibre_45"><span class="calibre_13">Our discussion has revolved around Docker not only because it’s the most popular system for building container images, but also because it makes it very easy to get started and jump into the layers of isolation that containers normally provide. However, there are other packages for creating containers, and they take different approaches. Of these, LXC is one of the oldest. In fact, the first versions of Docker were built on LXC. If you understood the discussion of how Docker does its work, you won’t have trouble with LXC technical concepts, so we won’t go over any examples. Instead, we’ll just explore some of the practical differences.</span></p><p class="calibre_27"><span class="calibre_13"> The term </span><span class="italic">LXC</span><span class="calibre_13"> is sometimes used to refer to the set of kernel features that make containers possible, but most people use it to refer specifically to a library and package containing a number of utilities for creating and manipulating Linux containers. Unlike Docker, LXC involves a fair amount of manual setup. For example, you have to create your own container network interface, and you need to provide user ID mappings.</span></p><p class="calibre_27"><span class="calibre_13">Originally, LXC was intended to be as much of an entire Linux system as possible inside the container&mdash;init and all. After installing a special version of a distribution, you could install everything you needed for whatever you were running inside the container. That part isn’t too different from what you’ve seen with Docker, but there is more setup to do; with Docker, you just download a bunch of files and you’re ready to go.</span></p><p id="calibre_link-638" class="calibre_27"><span class="calibre_13">Therefore, you might find LXC more flexible in adapting to different needs. For example, by default, LXC doesn’t use the overlay filesystem that you saw with Docker, although you can add one. Because LXC is built on a C API, you can use this granularity in your own software application if necessary.</span></p><p class="calibre_27"><span class="calibre_13">An accompanying management package called LXD can help you work through some of LXC’s finer, manual points (such as network creation and image management) and offers a REST API that you can use to access LXC instead of the C API.</span></p><p id="calibre_link-481" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.2.4  Kubernetes</span></span></span></p><p class="calibre_45"><span class="calibre_13">Speaking of management, containers have become popular for many kinds of web servers, because you can start a bunch of containers from a single image across multiple machines, providing excellent redundancy. Unfortunately, this can be difficult to manage. You need to perform tasks such as the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8">Track which machines are able to run containers.</li><li value="2" class="calibre_8">Start, monitor, and restart containers on those machines.</li><li value="3" class="calibre_8">Configure container startup.</li><li value="4" class="calibre_8">Configure the container networking as required.</li><li value="5" class="calibre_8">Load new versions of container images and update all running containers gracefully.</li></ul><p class="calibre_33"><span class="calibre_13">That isn’t a complete list, nor does it properly convey the complexity of each task. Software was begging to be developed for it, and among the solutions that appeared, Google’s Kubernetes has become dominant. Perhaps one of the largest contributing factors for this is its ability to run Docker container images.</span></p><p class="calibre_27"><span class="calibre_13">Kubernetes has two basic sides, much like any client-server application. The server involves the machine(s) available to run containers, and the client is primarily a set of command-line utilities that launch and manipulate sets of containers. The configuration files for containers (and the groups they form) can be extensive, and you’ll quickly find that most of the work involved on the client side is creating the appropriate configuration.</span></p><p class="calibre_27"><span class="calibre_13">You can explore the configuration on your own. If you don’t want to deal with setting up the servers yourself, use the Minikube tool to install a virtual machine running a Kubernetes cluster on your own machine.</span></p><p id="calibre_link-482" class="calibre_46"><span class="calibre6"><span class="italic"><span class="bold">17.2.5  Pitfalls of Containers</span></span></span></p><p class="calibre_45"><span class="calibre_13">If you think about how a service like Kubernetes works, you’ll also realize that a system utilizing containers is not without its costs. At minimum, you still need one or more machines on which to run your containers, and this has to be a full-fledged Linux machine, whether it’s on real hardware or a virtual machine. There’s still a maintenance cost here, although it might be simpler to maintain this core infrastructure than a configuration that requires many custom software installations.</span></p><p id="calibre_link-643" class="calibre_27"><span class="calibre_13">That cost can take several forms. If you choose to administer your own infrastructure, that’s a significant investment of time, and still has hardware, hosting, and maintenance costs. If you instead opt to use a container service like a Kubernetes cluster, you’ll be paying the monetary cost of having someone else do the work for you.</span></p><p class="calibre_27"><span class="calibre_13">When thinking of the containers themselves, keep in mind the following:</span></p><div class="calibre_44">&nbsp;</div><ul class="calibre_47"><li value="1" class="calibre_8"><span class="italic">Containers can be wasteful in terms of storage</span>. In order for any application to function inside a container, the container must include all the necessary support of a Linux operating system, such as shared libraries. This can become quite large, especially if you don’t pay particular attention to the base distribution that you choose for your containers. Then, consider your application itself: how big is it? This situation is mitigated somewhat when you’re using an overlay filesystem with several copies of the same container, because they share the same base files. However, if your application creates a lot of runtime data, the upper layers of all of those overlays can grow large.</li><li value="2" class="calibre_8"><span class="italic">You still have to think about other system resources, such as CPU time</span>. You can configure limits on how much containers can consume, but you’re still constrained by how much the underlying system can handle. There’s still a kernel and block devices. If you overload stuff, then your containers, the system underneath, or both will suffer.</li><li value="3" class="calibre_8"><span class="italic">You might need to think differently about where you store your data</span>. In container systems such as Docker that use overlay filesystems, the changes made to the filesystem during runtime are thrown away after the processes terminate. In many applications, all of the user data goes into a database, and then that problem is reduced to database administration. But what about your logs? Those are necessary for a well-functioning server application, and you still need a way to store them. A separate log service is a must for any substantial scale of production.</li><li value="4" class="calibre_8"><span class="italic">Most container tools and operation models are geared toward web servers</span>. If you’re running a typical web server, you’ll find a great deal of support and information about running web servers in containers. Kubernetes, in particular, has a lot of safety features for preventing runaway server code. This can be an advantage, because it compensates for how (frankly) poorly written most web applications are. However, when you’re trying to run another kind of service, it can sometimes feel like you’re trying to drive a square peg into a round hole.</li><li value="5" class="calibre_8"><span class="italic">Careless container builds can lead to bloat, configuration problems, and malfunction</span>. The fact that you’re creating an isolated environment doesn’t shield you from making mistakes in that environment. You might not have to worry so much about the intricacies of systemd, but plenty of other things still can go wrong. When problems arise in any kind of system, inexperienced users tend to add things in an attempt to make the problem go away, often haphazardly. This can continue (often blindly) until at last there’s a somewhat functional system&mdash;with many additional issues. You need to understand the changes you make.</li><li value="6" class="calibre_8"><span class="italic">Versioning can be problematic</span>. We used the <span class="calibre3">latest</span> tag for the examples in this book. This is supposed to be the latest (stable) release of a container, but it also means that when you build a container based on the latest release of a distribution or package, something underneath can change and break your application. One standard practice is to use a specific version tag of a base container.</li><a id="calibre_link-639"></a><li value="7" class="calibre_8"><span class="italic">Trust can be an issue</span>. This applies particularly to images built with Docker. When you base your containers on those in the Docker image repository, you’re placing trust in an additional layer of management that they haven’t been altered to introduce even more security problems than usual, and that they’ll be there when you need them. This contrasts with LXC, where you’re encouraged to build your own to a certain degree.</li></ul><p class="calibre_33"><span class="calibre_13">When considering these issues, you might think that containers have a lot of disadvantages compared to other ways of managing system environments. However, that’s not the case. No matter what approach you choose, these problems are present in some degree and form&mdash;and some of them are easier to manage in containers. Just remember that containers won’t solve every problem. For example, if your application takes a long time to start on a normal system (after booting), it will also start slowly in a container.</span></p><div class="mbp_pagebreak"></div><p id="calibre_link-483" class="calibre_23"><span class="calibre1"><span class="bold"> 17.3 Runtime-Based Virtualization</span></span></p><p class="calibre_24"><span class="calibre_13">A final kind of virtualization to mention is based on the type of environment used to develop an application. This differs from the system virtual machines and containers that we’ve seen so far, because it doesn’t use the idea of placing applications onto different machines. Instead, it’s a separation that applies only to a particular application.</span></p><p class="calibre_27"><span class="calibre_13">The reason for these kinds of environments is that multiple applications on the same system can use the same programming language, causing potential conflicts. For example, Python is used in several places on a typical distribution and can include many add-on packages. If you want to use the system’s version of Python in your own package, you can run into trouble if you want a different version of one of the add-ons.</span></p><p class="calibre_27"><span class="calibre_13">Let’s look at how Python’s virtual environment feature creates a version of Python with only the packages that you want. The way to start is by creating a new directory for the environment like this:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">python3 -m venv test-venv</span></span></blockquote></blockquote><div class="mbp_pagebreak"></div><blockquote class="calibre_51"><span class="calibre3"><span class="bold"><span class="calibre_40"><span class="calibre_41">&nbsp;NOTE&nbsp;</span></span></span></span></blockquote><blockquote class="calibre_29"><span class="italic"><span class="calibre_13"> By the time you read this, you might simply be able to type </span></span><span class="calibre3">python</span><span class="italic"><span class="calibre_13"> instead of </span></span><span class="calibre3">python3</span><span class="italic"><span class="calibre_13">.</span></span></blockquote><p class="calibre_37"><span class="calibre_13"> Now, look inside the new </span><span class="italic">test-venv</span><span class="calibre_13"> directory. You’ll see a number of system-like directories such as </span><span class="italic">bin</span><span class="calibre_13">, </span><span class="italic">include</span><span class="calibre_13">, and </span><span class="italic">lib</span><span class="calibre_13">. To activate the virtual environment, you need to source (not execute) the </span><span class="calibre3">test-venv/bin/activate</span><span class="calibre_13"> script:</span></p><blockquote class="calibre_28"><blockquote class="calibre_29"><span class="calibre3">$ </span><span class="calibre3"><span class="bold">. test-env/bin/activate</span></span></blockquote></blockquote><p id="calibre_link-852" class="calibre_30"><span class="calibre_13">The reason for sourcing the execution is that activation is essentially setting an environment variable, which you can’t do by running an executable. At this point, when you run Python, you get the version in </span><span class="italic">test-venv/bin</span><span class="calibre_13"> directory (which is itself only a symbolic link), and the </span><span class="calibre3">VIRTUAL_ENV</span><span class="calibre_13"> environment variable is set to the environment base directory. You can run </span><span class="calibre3">deactivate</span><span class="calibre_13"> to exit to the virtual environment.</span></p><p class="calibre_27"><span class="calibre_13"> It isn’t any more complicated than that. With this environment variable set, you get a new, empty packages library in </span><span class="italic">test-venv/lib</span><span class="calibre_13">, and anything new you install when in the environment goes there instead of in the main system’s library.</span></p><p class="calibre_27"><span class="calibre_13"> Not all programming languages allow virtual environments in the way Python does, but it’s worth knowing about it, if for no other reason than to clear up some confusion about the word </span><span class="italic">virtual</span><span class="calibre_13">.</span></p><div class="mbp_pagebreak"></div><p class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_10"><span class="calibre4"><span class="bold">Bibliography</span></span></p><blockquote class="calibre_105"><span class="calibre_13">Abrahams, Paul W., and Bruce Larson, </span><span class="italic">UNIX for the Impatient</span><span class="calibre_13">, 2nd ed. Boston: Addison-Wesley Professional, 1995.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Aho, Alfred V., Brian W. Kernighan, and Peter J. Weinberger, </span><span class="italic">The AWK Programming Language</span><span class="calibre_13">. Boston: Addison-Wesley, 1988.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Aho, Alfred V., Monica S. Lam, Ravi Sethi, and Jeffery D. Ullman, </span><span class="italic">Compilers: Principles, Techniques, and Tools</span><span class="calibre_13">, 2nd ed. Boston: Addison-Wesley, 2006.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Aumasson, Jean-Philippe, </span><span class="italic">Serious Cryptography: A Practical Introduction to Modern Encryption</span><span class="calibre_13">. San Francisco: No Starch Press, 2017.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Barrett, Daniel J., Richard E. Silverman, and Robert G. Byrnes, </span><span class="italic">SSH, The Secure Shell: The Definitive Guide</span><span class="calibre_13">, 2nd ed. Sebastopol, CA: O’Reilly, 2005.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Beazley, David M., </span><span class="italic">Python Distilled</span><span class="calibre_13">. Addison-Wesley, 2021.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Beazley, David M., Brian D. Ward, and Ian R. Cooke, “The Inside Story on Shared Libraries and Dynamic Loading.” </span><span class="italic">Computing in Science &amp; Engineering </span><span class="calibre_13">3, no. 5 (September/October 2001): 90&ndash;97.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Calcote, John, </span><span class="italic">Autotools: A Practitioner’s Guide to GNU Autoconf, Automake, and Libtool</span><span class="calibre_13">, 2nd ed. San Francisco: No Starch Press, 2019.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Carter, Gerald, Jay Ts, and Robert Eckstein, </span><span class="italic">Using Samba: A File and Print Server for Linux, Unix, and Mac OS X</span><span class="calibre_13">, 3rd ed. Sebastopol, CA: O’Reilly, 2007.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Christiansen, Tom, brian d foy, Larry Wall, and Jon Orwant, </span><span class="italic">Programming Perl: Unmatched Power for Processing and Scripting</span><span class="calibre_13">, 4th ed. Sebastopol, CA: O’Reilly, 2012.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">chromatic, </span><span class="italic">Modern Perl</span><span class="calibre_13">, 4th ed. Hillsboro, OR: Onyx Neon Press, 2016.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Davies, Joshua. </span><span class="italic">Implementing SSL/TLS Using Cryptography and PKI</span><span class="calibre_13">. Hoboken, NJ: Wiley, 2011.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Friedl, Jeffrey E. F., </span><span class="italic">Mastering Regular Expressions</span><span class="calibre_13">, 3rd ed. Sebastopol, CA: O’Reilly, 2006.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Gregg, Brendan, </span><span class="italic">Systems Performance: Enterprise and the Cloud</span><span class="calibre_13">, 2nd ed. Boston: Addison-Wesley, 2020.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Grune, Dick, Kees van Reeuwijk, Henri E. Bal, Ceriel J. H. Jacobs, and Koen Langendoen, </span><span class="italic">Modern Compiler Design</span><span class="calibre_13">, 2nd ed. New York: Springer, 2012.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Hopcroft, John E., Rajeev Motwani, and Jeffrey D. Ullman, </span><span class="italic">Introduction to Automata Theory, Languages, and Computation</span><span class="calibre_13">, 3rd ed. Upper Saddle River, NJ: Prentice Hall, 2006.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Kernighan, Brian W., and Rob Pike, </span><span class="italic">The UNIX Programming Environment</span><span class="calibre_13">. Upper Saddle River, NJ: Prentice Hall, 1984.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Kernighan, Brian W., and Dennis M. Ritchie, </span><span class="italic">The C Programming Language</span><span class="calibre_13">, 2nd ed. Upper Saddle River, NJ: Prentice Hall, 1988.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Kochan, Stephen G., and Patrick Wood, </span><span class="italic">Unix Shell Programming</span><span class="calibre_13">, 3rd ed. Indianapolis: SAMS Publishing, 2003.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Levine, John R., </span><span class="italic">Linkers and Loaders</span><span class="calibre_13">. San Francisco: Morgan Kaufmann, 1999.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Lucas, Michael W., </span><span class="italic">SSH Mastery: OpenSSH, PuTTY, Tunnels, and Keys</span><span class="calibre_13">, 2nd ed. Detroit: Tilted Windmill Press, 2018.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Matloff, Norman, </span><span class="italic">The Art of R Programming: A Tour of Statistical Software Design</span><span class="calibre_13">. San Francisco: No Starch Press, 2011.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Mecklenburg, Robert, </span><span class="italic">Managing Projects with GNU Make</span><span class="calibre_13">, 3rd ed. Sebastopol, CA: O’Reilly, 2005.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Peek, Jerry, Grace Todino-Gonguet, and John Strang, </span><span class="italic">Learning the UNIX Operating System: A Concise Guide for the New User</span><span class="calibre_13">, 5th ed. Sebastopol, CA: O’Reilly, 2001.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Pike, Rob, Dave Presotto, Sean Dorward, Bob Flandrena, Ken Thompson, Howard Trickey, and Phil Winterbottom, “Plan 9 from Bell Labs.” Accessed February 1, 2020, </span><a href="https://9p.io/sys/doc/"><span class="italic"><span class="calibre_4">https://9p.io/sys/doc/.</span></span></a></blockquote><blockquote class="calibre_106"><span class="calibre_13">Poulton, Nigel, </span><span class="italic">Docker Deep Dive</span><span class="calibre_13">. Author, 2016.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Quinlan, Daniel, Rusty Russell, and Christopher Yeoh, eds., “Filesystem Hierarchy Standard, Version 3.0.” Linux Foundation, 2015, </span><a href="https://refspecs.linuxfoundation.org/fhs.shtml"><span class="italic"><span class="calibre_4">https://refspecs.linuxfoundation.org/fhs.shtml</span></span></a><span class="calibre_13">.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Raymond, Eric S., ed., </span><span class="italic">The New Hacker’s Dictionary</span><span class="calibre_13">. 3rd ed. Cambridge, MA: MIT Press, 1996.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Robbins, Arnold, </span><span class="italic">sed &amp; awk Pocket Reference</span><span class="calibre_13">, 2nd ed. Sebastopol, CA: O’Reilly, 2002.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Robbins, Arnold, Elbert Hannah, and Linda Lamb, </span><span class="italic">Learning the vi and Vim Editors: Unix Text Processing</span><span class="calibre_13">, 7th ed. Sebastopol, CA: O’Reilly, 2008.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Salus, Peter H., </span><span class="italic">The Daemon, the Gnu, and the Penguin</span><span class="calibre_13">. Tacoma, WA: Reed Media Services, 2008.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Samar, Vipin, and Roland J. Schemers III. “Unified Login with Pluggable Authentication Modules (PAM),” October 1995, Open Software Foundation (RFC 86.0), </span><a href="http://www.opengroup.org/rfc/rfc86.0.html"><span class="italic"><span class="calibre_4">http://www.opengroup.org/rfc/rfc86.0.html</span></span></a><span class="calibre_13">.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Schwartz, Randal L., brian d foy, and Tom Phoenix, </span><span class="italic">Learning Perl: Making Easy Things Easy and Hard Things Possible</span><span class="calibre_13">, 7th ed. Sebastopol, CA: O’Reilly, 2016.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Shotts, William, </span><span class="italic">The Linux Command Line</span><span class="calibre_13">, 2nd ed. San Francisco: No Starch Press, 2019.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Silberschatz, Abraham, Peter B. Galvin, and Greg Gagne, </span><span class="italic">Operating System Concepts</span><span class="calibre_13">, 10th ed. Hoboken, NJ: Wiley, 2018.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Smith, Jim, and Ravi Nair, </span><span class="italic">Virtual Machines: Versatile Platforms for Systems and Processes</span><span class="calibre_13">. Cambridge, MA: Elsevier, 2005.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Stallman, Richard M., </span><span class="italic">GNU Emacs Manual</span><span class="calibre_13">, 18th ed. Boston: Free Software Foundation, 2018.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Stevens, W. Richard, Bill Fenner, and Andrew M. Rudoff, </span><span class="italic">Unix Network Programming, Volume 1: The Sockets Networking API</span><span class="calibre_13">, 3rd ed. Boston: Addison-Wesley Professional, 2003.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Tanenbaum, Andrew S., and Herbert Bos, </span><span class="italic">Modern Operating Systems</span><span class="calibre_13">, 4th ed. Upper Saddle River, NJ: Prentice Hall, 2014.</span></blockquote><blockquote class="calibre_106"><span class="calibre_13">Tanenbaum, Andrew S., and David J. Wetherall, </span><span class="italic">Computer Networks</span><span class="calibre_13">, 5th ed. Upper Saddle River, NJ: Prentice Hall, 2010.</span></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-484" class="calibre_17">
</p><div class="mbp_pagebreak"></div><p class="calibre_10"><span class="calibre4"><span class="bold">Index</span></span></p><p class="calibre_107"><span class="calibre_13">Please note that index links to approximate location of each term.</span></p><p class="calibre_9"><span class="calibre6"><span class="bold">Numbers and Symbols</span></span></p><blockquote class="calibre_108"><span class="calibre3">.</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> directory, current</span></blockquote><blockquote class="calibre_109"><span class="calibre3">/</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> directory, root</span></blockquote><blockquote class="calibre_109"><span class="calibre3">..</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> directory, parent</span></blockquote><blockquote class="calibre_109"><span class="calibre3">#</span><span class="calibre_13">, </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">#!</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> shebang</span></blockquote><blockquote class="calibre_109"><span class="calibre3">$</span><span class="calibre_13">, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> shell, prompt</span></blockquote><blockquote class="calibre_109"><span class="calibre3">$#</span><span class="calibre_13">, </span><a href="#calibre_link-548"><span class="italic"><span class="calibre_4">297</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">$$</span><span class="calibre_13">, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">$0</span><span class="calibre_13">, </span><a href="#calibre_link-548"><span class="italic"><span class="calibre_4">297</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">$1</span><span class="calibre_13">, </span><a href="#calibre_link-327"><span class="italic"><span class="calibre_4">296</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">$?</span><span class="calibre_13">, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> exit code</span></blockquote><blockquote class="calibre_109"><span class="calibre3">$@</span><span class="calibre_13">, </span><a href="#calibre_link-548"><span class="italic"><span class="calibre_4">297</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">&amp;&amp;</span><span class="calibre_13">, </span><a href="#calibre_link-550"><span class="italic"><span class="calibre_4">300</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-551"><span class="italic"><span class="calibre_4">301</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">*</span><span class="calibre_13">, </span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> glob</span></blockquote><blockquote class="calibre_109"><span class="calibre3">|</span><span class="calibre_13">, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> pipe</span></blockquote><blockquote class="calibre_109"><span class="calibre3">||</span><span class="calibre_13">, </span><a href="#calibre_link-550"><span class="italic"><span class="calibre_4">300</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-551"><span class="italic"><span class="calibre_4">301</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">&lt;</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> file, redirect command input from</span></blockquote><blockquote class="calibre_109"><span class="calibre3">&lt;&lt;</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> here document</span></blockquote><blockquote class="calibre_109"><span class="calibre3">&gt;</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> file, redirect command output to</span></blockquote><blockquote class="calibre_109"><span class="calibre3">&gt;&gt;</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> file, redirect command output to</span></blockquote><blockquote class="calibre_109"><span class="calibre3">?</span><span class="calibre_13">, </span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> glob</span></blockquote><blockquote class="calibre_109"><span class="calibre3">[</span><span class="calibre_13">, </span><a href="#calibre_link-335"><span class="italic"><span class="calibre_4">299</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13">
</span><span class="calibre3">test</span></blockquote><blockquote class="calibre_109"><span class="calibre3">~</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">A</span></span></p><blockquote class="calibre_108"><span class="calibre_13">abstraction, </span><a href="#calibre_link-556"><span class="italic"><span class="calibre_4">1</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-557"><span class="italic"><span class="calibre_4">2</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">administrator. </span><span class="italic">See</span><span class="calibre_13"> root</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">AFS (Andrew File System), </span><a href="#calibre_link-558"><span class="italic"><span class="calibre_4">333</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-559"><span class="italic"><span class="calibre_4">334</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">alias, </span><a href="#calibre_link-560"><span class="italic"><span class="calibre_4">339</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ALSA (Advanced Linux Sound Architecture), </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Apple partition. </span><span class="italic">See</span><span class="calibre_13"> filesystem, HFS+</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">application layer. </span><span class="italic">See</span><span class="calibre_13"> network, application layer</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">archive, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">table of contents, </span><a href="#calibre_link-565"><span class="italic"><span class="calibre_4">40</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">testing, </span><a href="#calibre_link-565"><span class="italic"><span class="calibre_4">40</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-456"><span class="italic"><span class="calibre_4">387</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-566"><span class="italic"><span class="calibre_4">388</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">ARP (Address Resolution Protocol), </span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-568"><span class="italic"><span class="calibre_4">265</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">at</span><span class="calibre_13">, </span><a href="#calibre_link-569"><span class="italic"><span class="calibre_4">187</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-570"><span class="italic"><span class="calibre_4">188</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ATA, </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">64</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">autoconf, </span><a href="#calibre_link-566"><span class="italic"><span class="calibre_4">388</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Autotools. </span><span class="italic">See</span><span class="calibre_13"> GNU Autotools</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Avahi, </span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">awk</span><span class="calibre_13">, </span><a href="#calibre_link-574"><span class="italic"><span class="calibre_4">309</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">B</span></span></p><blockquote class="calibre_108"><span class="calibre3">basename</span><span class="calibre_13">, </span><a href="#calibre_link-347"><span class="italic"><span class="calibre_4">308</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-574"><span class="italic"><span class="calibre_4">309</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">bash</span><span class="calibre_13">, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> Bourne Shell</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">startup file (</span><span class="italic">see</span><span class="calibre_13"> startup file, bash)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="italic">.bash_profile</span><span class="calibre_13">, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">.bashrc</span><span class="calibre_13">, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">bg</span><span class="calibre_13">, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/bin</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/bin/bash</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13">
</span><span class="calibre3">bash</span></blockquote><blockquote class="calibre_109"><span class="italic">/bin/sh</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> Bourne Shell</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">BIOS, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot partition, </span><a href="#calibre_link-580"><span class="italic"><span class="calibre_4">133</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">bison</span><span class="calibre_13">, </span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">blkid</span><span class="calibre_13">, </span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">block bitmap, </span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">block device. </span><span class="italic">See</span><span class="calibre_13"> device, block</span></blockquote><blockquote class="calibre_109"><span class="calibre3">blockdev</span><span class="calibre_13">, </span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/boot</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-587"><span class="italic"><span class="calibre_4">131</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">boot, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> init</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">init (</span><span class="italic">see</span><span class="calibre_13"> init)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">loader (</span><span class="italic">see</span><span class="calibre_13"> boot loader)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">messages, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-591"><span class="italic"><span class="calibre_4">171</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-592"><span class="italic"><span class="calibre_4">172</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network configuration, </span><a href="#calibre_link-265"><span class="italic"><span class="calibre_4">239</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-593"><span class="italic"><span class="calibre_4">240</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">boot loader, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">chainloading, </span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filesystem access, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> GRUB, filesystem access)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">GRUB (</span><span class="italic">see</span><span class="calibre_13"> GRUB)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">internals, </span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-595"><span class="italic"><span class="calibre_4">135</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">multi-stage, </span><a href="#calibre_link-580"><span class="italic"><span class="calibre_4">133</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">system other than Linux, </span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Bourne Shell, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">basic use, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Bourne-again (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="calibre3">bash</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">script (</span><span class="italic">see</span><span class="calibre_13"> shell script)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">bpfilter, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Btrfs. </span><span class="italic">See</span><span class="calibre_13"> filesystem, Btrfs</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">building software, </span><a href="#calibre_link-597"><span class="italic"><span class="calibre_4">386</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">bunzip2</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">bus error, </span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">BusyBox, </span><a href="#calibre_link-601"><span class="italic"><span class="calibre_4">258</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">bzip2</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">C</span></span></p><blockquote class="calibre_108"><span class="calibre_13">C, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-603"><span class="italic"><span class="calibre_4">365</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compiler, </span><a href="#calibre_link-604"><span class="italic"><span class="calibre_4">376</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-444"><span class="italic"><span class="calibre_4">377</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-605"><span class="italic"><span class="calibre_4">392</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">preprocessor, </span><a href="#calibre_link-606"><span class="italic"><span class="calibre_4">372</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-607"><span class="italic"><span class="calibre_4">373</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-444"><span class="italic"><span class="calibre_4">377</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-608"><span class="italic"><span class="calibre_4">391</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-609"><span class="italic"><span class="calibre_4">398</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">case</span><span class="calibre_13">, </span><a href="#calibre_link-610"><span class="italic"><span class="calibre_4">304</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">cat</span><span class="calibre_13">, </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">cd</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">cgroup, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-614"><span class="italic"><span class="calibre_4">220</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">container, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">controller, </span><a href="#calibre_link-616"><span class="italic"><span class="calibre_4">219</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-617"><span class="italic"><span class="calibre_4">221</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating, </span><a href="#calibre_link-614"><span class="italic"><span class="calibre_4">220</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-617"><span class="italic"><span class="calibre_4">221</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing, </span><a href="#calibre_link-618"><span class="italic"><span class="calibre_4">218</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-616"><span class="italic"><span class="calibre_4">219</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">version 1, </span><a href="#calibre_link-618"><span class="italic"><span class="calibre_4">218</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-616"><span class="italic"><span class="calibre_4">219</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">chainloading. </span><span class="italic">See</span><span class="calibre_13"> boot loader, chainloading</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">character device. </span><span class="italic">See</span><span class="calibre_13"> device, character</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">child process. </span><span class="italic">See</span><span class="calibre_13"> process, child</span></blockquote><blockquote class="calibre_109"><span class="calibre3">chmod</span><span class="calibre_13">, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> permissions</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Chrome OS, </span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">chroot</span><span class="calibre_13">, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">chsh</span><span class="calibre_13">, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-622"><span class="italic"><span class="calibre_4">193</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-623"><span class="italic"><span class="calibre_4">195</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">chvt</span><span class="calibre_13">, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CIDR (Classless Inter-Domain Routing), </span><a href="#calibre_link-625"><span class="italic"><span class="calibre_4">229</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-626"><span class="italic"><span class="calibre_4">232</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CIFS. </span><span class="italic">See</span><span class="calibre_13"> filesystem, CIFS</span></blockquote><blockquote class="calibre_109"><span class="calibre3">clang</span><span class="calibre_13">, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">CLASSPATH</span><span class="calibre_13">, </span><a href="#calibre_link-627"><span class="italic"><span class="calibre_4">382</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">clobber, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">clock. </span><span class="italic">See</span><span class="calibre_13"> real-time clock; system clock</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">cloud services, </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-629"><span class="italic"><span class="calibre_4">404</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">cloud storage, </span><a href="#calibre_link-558"><span class="italic"><span class="calibre_4">333</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CMake, </span><a href="#calibre_link-566"><span class="italic"><span class="calibre_4">388</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">command-line editing, </span><a href="#calibre_link-630"><span class="italic"><span class="calibre_4">25</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">command substitution, </span><a href="#calibre_link-631"><span class="italic"><span class="calibre_4">306</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">compiler, </span><a href="#calibre_link-453"><span class="italic"><span class="calibre_4">383</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">compiling, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-632"><span class="italic"><span class="calibre_4">366</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">compositor. </span><span class="italic">See</span><span class="calibre_13"> Wayland, compositor</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">compress. </span><span class="italic">See</span><span class="calibre_13"> file, compress</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">concatenate (files), </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">configuration file, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">configure</span><span class="calibre_13">, </span><a href="#calibre_link-566"><span class="italic"><span class="calibre_4">388</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">container</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">building, </span><a href="#calibre_link-633"><span class="italic"><span class="calibre_4">407</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-634"><span class="italic"><span class="calibre_4">409</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">definition, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filesystem, </span><a href="#calibre_link-635"><span class="italic"><span class="calibre_4">410</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">image, </span><a href="#calibre_link-633"><span class="italic"><span class="calibre_4">407</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-634"><span class="italic"><span class="calibre_4">409</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-637"><span class="italic"><span class="calibre_4">413</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">limitations, </span><a href="#calibre_link-638"><span class="italic"><span class="calibre_4">415</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-639"><span class="italic"><span class="calibre_4">417</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">networking, </span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">operation, </span><a href="#calibre_link-640"><span class="italic"><span class="calibre_4">412</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">privilege requirements, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-633"><span class="italic"><span class="calibre_4">407</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">purpose, </span><a href="#calibre_link-642"><span class="italic"><span class="calibre_4">405</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">rootless, </span><a href="#calibre_link-633"><span class="italic"><span class="calibre_4">407</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">running, </span><a href="#calibre_link-634"><span class="italic"><span class="calibre_4">409</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-635"><span class="italic"><span class="calibre_4">410</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">storing data, </span><a href="#calibre_link-643"><span class="italic"><span class="calibre_4">416</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">context switch, </span><a href="#calibre_link-644"><span class="italic"><span class="calibre_4">5</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">control group. </span><span class="italic">See</span><span class="calibre_13"> cgroup</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">controlling terminal, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">coreboot, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">coreutils, </span><a href="#calibre_link-458"><span class="italic"><span class="calibre_4">389</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">cp</span><span class="calibre_13">, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">cpio</span><span class="calibre_13">, </span><a href="#calibre_link-648"><span class="italic"><span class="calibre_4">164</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">cpp</span><span class="calibre_13">, </span><a href="#calibre_link-607"><span class="italic"><span class="calibre_4">373</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> C, preprocessor</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">CPU, </span><a href="#calibre_link-557"><span class="italic"><span class="calibre_4">2</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">load (</span><span class="italic">see</span><span class="calibre_13"> load average)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">multiple, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">performance, </span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">time, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-617"><span class="italic"><span class="calibre_4">221</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">virtual machine, </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-629"><span class="italic"><span class="calibre_4">404</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">cron, </span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-656"><span class="italic"><span class="calibre_4">185</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-569"><span class="italic"><span class="calibre_4">187</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">csh</span><span class="calibre_13">, </span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CTRL-C, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CTRL-D, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">CUPS, </span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">curl</span><span class="calibre_13">, </span><a href="#calibre_link-300"><span class="italic"><span class="calibre_4">271</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">current working directory. </span><span class="italic">See</span><span class="calibre_13"> directory, current</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">cylinder (disk), </span><a href="#calibre_link-658"><span class="italic"><span class="calibre_4">78</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-659"><span class="italic"><span class="calibre_4">79</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">D</span></span></p><blockquote class="calibre_108"><span class="calibre_13">D-Bus, </span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-268"><span class="italic"><span class="calibre_4">241</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">instance, </span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitoring, </span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">systemd unit, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">date</span><span class="calibre_13">, </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">dd</span><span class="calibre_13">, </span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">debugfs</span><span class="calibre_13">, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">default gateway, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-668"><span class="italic"><span class="calibre_4">231</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">default route, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">default.target</span><span class="calibre_13">, </span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">default user settings, </span><a href="#calibre_link-671"><span class="italic"><span class="calibre_4">343</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">demand paging, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">desktop, </span><a href="#calibre_link-673"><span class="italic"><span class="calibre_4">347</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-674"><span class="italic"><span class="calibre_4">348</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">desktop background, </span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Desktop Bus. </span><span class="italic">See</span><span class="calibre_13"> D&ndash;Bus</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">desktop environment, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/dm&ndash;*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/hd*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/lp*</span><span class="calibre_13">, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/mapper</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/null</span><span class="calibre_13">, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/nvme*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/parport*</span><span class="calibre_13">, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/pts</span><span class="calibre_13">, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/sd*</span><span class="calibre_13">, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/sg*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/snd</span><span class="calibre_13">, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/sr*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/tty*</span><span class="calibre_13">, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/vd*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/xvd*</span><span class="calibre_13">, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/dev/zero</span><span class="calibre_13">, </span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">device, </span><a href="#calibre_link-682"><span class="italic"><span class="calibre_4">47</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">audio, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">block, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">64</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-683"><span class="italic"><span class="calibre_4">69</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-658"><span class="italic"><span class="calibre_4">78</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">character, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating file, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">disk, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">driver, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-687"><span class="italic"><span class="calibre_4">7</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">file, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">finding, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">information, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-690"><span class="italic"><span class="calibre_4">60</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">initialization, </span><a href="#calibre_link-691"><span class="italic"><span class="calibre_4">57</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">major and minor numbers, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitor, </span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">name, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">node (</span><span class="italic">see</span><span class="calibre_13"> device, file)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">optical, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">parallel, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">pipe (</span><span class="italic">see</span><span class="calibre_13"> pipe, named)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">SCSI (</span><span class="italic">see</span><span class="calibre_13"> SCSI)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">serial, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">socket, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-694"><span class="italic"><span class="calibre_4">289</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-695"><span class="italic"><span class="calibre_4">290</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">terminal, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">types, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">device mapper, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-696"><span class="italic"><span class="calibre_4">108</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-697"><span class="italic"><span class="calibre_4">110</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">devtmpfs, </span><a href="#calibre_link-691"><span class="italic"><span class="calibre_4">57</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">df</span><span class="calibre_13">, </span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">DHCP (Dynamic Host Configuration Protocol), </span><a href="#calibre_link-700"><span class="italic"><span class="calibre_4">252</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-701"><span class="italic"><span class="calibre_4">253</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">diff</span><span class="calibre_13">, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">directory, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">change, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">create, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">current, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-224"><span class="italic"><span class="calibre_4">201</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">errors, </span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">hierarchy, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">home (</span><span class="italic">see</span><span class="calibre_13"> home directory)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">internal structure, </span><a href="#calibre_link-703"><span class="italic"><span class="calibre_4">112</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing contents, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">parent, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-703"><span class="italic"><span class="calibre_4">112</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">permissions (</span><span class="italic">see</span><span class="calibre_13"> permissions, directory)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">remove, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">root, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> inode, root)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">disk</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">buffer and cache, </span><a href="#calibre_link-127"><span class="italic"><span class="calibre_4">86</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">capacity, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-708"><span class="italic"><span class="calibre_4">74</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> filesystem, capacity)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-683"><span class="italic"><span class="calibre_4">69</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-658"><span class="italic"><span class="calibre_4">78</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device file (</span><span class="italic">see</span><span class="calibre_13"> device, disk)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">format (</span><span class="italic">see</span><span class="calibre_13"> filesystem, creating; partition, creating table)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">geometry, </span><a href="#calibre_link-709"><span class="italic"><span class="calibre_4">77</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-121"><span class="italic"><span class="calibre_4">80</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitoring usage, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">partition (</span><span class="italic">see</span><span class="calibre_13"> partition)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">PATA, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">quota, </span><a href="#calibre_link-710"><span class="italic"><span class="calibre_4">222</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">raw access, </span><a href="#calibre_link-711"><span class="italic"><span class="calibre_4">71</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">SATA, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-690"><span class="italic"><span class="calibre_4">60</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">64</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">scheduling priority, </span><a href="#calibre_link-712"><span class="italic"><span class="calibre_4">215</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">schematic, </span><a href="#calibre_link-713"><span class="italic"><span class="calibre_4">70</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-711"><span class="italic"><span class="calibre_4">71</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">SCSI, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-714"><span class="italic"><span class="calibre_4">63</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">solid state, </span><a href="#calibre_link-121"><span class="italic"><span class="calibre_4">80</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">disk (continued)</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">swap (</span><span class="italic">see</span><span class="calibre_13"> swap)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">usage (</span><span class="italic">see</span><span class="calibre_13"> filesystem, usage)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">virtual, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">display manager, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">display modes, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">dmesg, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> kernel, log</span></blockquote><blockquote class="calibre_109"><span class="calibre3">dmsetup</span><span class="calibre_13">, </span><a href="#calibre_link-715"><span class="italic"><span class="calibre_4">109</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> device mapper</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">DNS (Domain Name Service), </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-717"><span class="italic"><span class="calibre_4">243</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-718"><span class="italic"><span class="calibre_4">246</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">dnsmasq, </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Docker, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">documentation, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Domain Name Service. </span><span class="italic">See</span><span class="calibre_13"> DNS</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">dot file, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-720"><span class="italic"><span class="calibre_4">336</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">DPMS (Display Power Management Signaling), </span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">du</span><span class="calibre_13">, </span><a href="#calibre_link-721"><span class="italic"><span class="calibre_4">90</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">dual-stack network, </span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Dynamic Host Configuration Protocol (DHCP), </span><a href="#calibre_link-700"><span class="italic"><span class="calibre_4">252</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-701"><span class="italic"><span class="calibre_4">253</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">E</span></span></p><blockquote class="calibre_108"><span class="calibre3">echo</span><span class="calibre_13">, </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">EDITOR</span><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">effective user ID, </span><a href="#calibre_link-211"><span class="italic"><span class="calibre_4">189</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">EFI. </span><span class="italic">See</span><span class="calibre_13"> UEFI</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">efilinux, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">egrep</span><span class="calibre_13">, </span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">elapsed time, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Emacs, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">emulator, </span><a href="#calibre_link-724"><span class="italic"><span class="calibre_4">402</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">encryption, </span><a href="#calibre_link-725"><span class="italic"><span class="calibre_4">197</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-727"><span class="italic"><span class="calibre_4">273</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-728"><span class="italic"><span class="calibre_4">274</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">env</span><span class="calibre_13">, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-448"><span class="italic"><span class="calibre_4">380</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">environment variable, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-730"><span class="italic"><span class="calibre_4">23</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">EOF (end-of-file) message, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">error message, </span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-64"><span class="italic"><span class="calibre_4">30</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ESP (EFI System Partition). </span><span class="italic">See</span><span class="calibre_13"> UEFI, ESP</span></blockquote><blockquote class="calibre_109"><span class="italic">/etc</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-732"><span class="italic"><span class="calibre_4">141</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-733"><span class="italic"><span class="calibre_4">167</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-734"><span class="italic"><span class="calibre_4">176</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/fstab</span><span class="calibre_13">, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/group</span><span class="calibre_13">, </span><a href="#calibre_link-198"><span class="italic"><span class="calibre_4">180</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/hosts</span><span class="calibre_13">, </span><a href="#calibre_link-737"><span class="italic"><span class="calibre_4">244</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/init.d</span><span class="calibre_13">, </span><a href="#calibre_link-738"><span class="italic"><span class="calibre_4">159</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/inittab</span><span class="calibre_13">, </span><a href="#calibre_link-739"><span class="italic"><span class="calibre_4">157</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-740"><span class="italic"><span class="calibre_4">158</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/ld.so.cache</span><span class="calibre_13">, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/ld.so.conf</span><span class="calibre_13">, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/localtime</span><span class="calibre_13">, </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/login.defs</span><span class="calibre_13">, </span><a href="#calibre_link-725"><span class="italic"><span class="calibre_4">197</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/mtab</span><span class="calibre_13">, </span><a href="#calibre_link-127"><span class="italic"><span class="calibre_4">86</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-742"><span class="italic"><span class="calibre_4">87</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/nologin</span><span class="calibre_13">, </span><a href="#calibre_link-181"><span class="italic"><span class="calibre_4">162</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/nsswitch.conf</span><span class="calibre_13">, </span><a href="#calibre_link-718"><span class="italic"><span class="calibre_4">246</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/passwd</span><span class="calibre_13">, </span><a href="#calibre_link-743"><span class="italic"><span class="calibre_4">27</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-622"><span class="italic"><span class="calibre_4">193</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/profile</span><span class="calibre_13">, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/rc.d</span><span class="calibre_13">, </span><a href="#calibre_link-739"><span class="italic"><span class="calibre_4">157</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-746"><span class="italic"><span class="calibre_4">161</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/resolv.conf</span><span class="calibre_13">, </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/services</span><span class="calibre_13">, </span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-748"><span class="italic"><span class="calibre_4">250</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/shadow</span><span class="calibre_13">, </span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-725"><span class="italic"><span class="calibre_4">197</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/shells</span><span class="calibre_13">, </span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-622"><span class="italic"><span class="calibre_4">193</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-623"><span class="italic"><span class="calibre_4">195</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/etc/sudoers</span><span class="calibre_13">, </span><a href="#calibre_link-85"><span class="italic"><span class="calibre_4">45</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">eth0</span><span class="calibre_13">, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Ethernet, </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-568"><span class="italic"><span class="calibre_4">265</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">bridge, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">wireless, </span><a href="#calibre_link-750"><span class="italic"><span class="calibre_4">266</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">euid. </span><span class="italic">See</span><span class="calibre_13"> effective user ID</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">exec, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">exec()</span><span class="calibre_13">, </span><a href="#calibre_link-687"><span class="italic"><span class="calibre_4">7</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-752"><span class="italic"><span class="calibre_4">203</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">executable, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-742"><span class="italic"><span class="calibre_4">87</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-603"><span class="italic"><span class="calibre_4">365</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-753"><span class="italic"><span class="calibre_4">367</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-448"><span class="italic"><span class="calibre_4">380</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">exit</span><span class="calibre_13">, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">exit code, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">export</span><span class="calibre_13">, </span><a href="#calibre_link-730"><span class="italic"><span class="calibre_4">23</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">expr</span><span class="calibre_13">, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ext4. </span><span class="italic">See</span><span class="calibre_13"> filesystem, ext2/ext3/ext4</span></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">F</span></span></p><blockquote class="calibre_108"><span class="calibre_13">fail2ban, </span><a href="#calibre_link-754"><span class="italic"><span class="calibre_4">276</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-755"><span class="italic"><span class="calibre_4">277</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">fdisk</span><span class="calibre_13">, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-757"><span class="italic"><span class="calibre_4">75</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-658"><span class="italic"><span class="calibre_4">78</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">fg</span><span class="calibre_13">, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">FHS (Filesystem Hierarchy Standard), </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">file</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compare with another file, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compress, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-366"><span class="italic"><span class="calibre_4">321</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-759"><span class="italic"><span class="calibre_4">322</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">copy, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> file transfer)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">create empty, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">delete, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">descriptor (</span><span class="italic">see</span><span class="calibre_13"> file descriptor)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">details, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device (</span><span class="italic">see</span><span class="calibre_13"> device, file)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">dot (</span><span class="italic">see</span><span class="calibre_13"> dot file)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">errors, </span><a href="#calibre_link-64"><span class="italic"><span class="calibre_4">30</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">find, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">find text in, </span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">format, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">group, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">link, </span><a href="#calibre_link-73"><span class="italic"><span class="calibre_4">38</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a></blockquote><a></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">link count, </span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mode, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> permissions)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">move, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">open, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-225"><span class="italic"><span class="calibre_4">202</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">owner, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">permissions (</span><span class="italic">see</span><span class="calibre_13"> permissions)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">redirect command input from, </span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">redirect command output to, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">regular, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">rename, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">sharing across a network, </span><a href="#calibre_link-761"><span class="italic"><span class="calibre_4">323</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-559"><span class="italic"><span class="calibre_4">334</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">sharing with other users, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">socket (</span><span class="italic">see</span><span class="calibre_13"> device, socket)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">swap, </span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">temporary, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-346"><span class="italic"><span class="calibre_4">307</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">test, </span><a href="#calibre_link-551"><span class="italic"><span class="calibre_4">301</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">type, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-73"><span class="italic"><span class="calibre_4">38</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-224"><span class="italic"><span class="calibre_4">201</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">update timestamp, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">file</span><span class="calibre_13"> (command), </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">file descriptor, </span><a href="#calibre_link-224"><span class="italic"><span class="calibre_4">201</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-752"><span class="italic"><span class="calibre_4">203</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">file transfer, </span><a href="#calibre_link-763"><span class="italic"><span class="calibre_4">315</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-764"><span class="italic"><span class="calibre_4">316</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">choosing method, </span><a href="#calibre_link-764"><span class="italic"><span class="calibre_4">316</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">rsync</span><span class="calibre_13"> (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="calibre3">rsync</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">SSH (secure shell), </span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">with Python, </span><a href="#calibre_link-764"><span class="italic"><span class="calibre_4">316</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">filesystem, </span><a href="#calibre_link-713"><span class="italic"><span class="calibre_4">70</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-711"><span class="italic"><span class="calibre_4">71</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-121"><span class="italic"><span class="calibre_4">80</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot loader access (</span><span class="italic">see</span><span class="calibre_13"> boot loader, filesystem access)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Btrfs, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">capacity, </span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">cgroup, </span><a href="#calibre_link-616"><span class="italic"><span class="calibre_4">219</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> cgroup)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">checking, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">CIFS, </span><a href="#calibre_link-767"><span class="italic"><span class="calibre_4">331</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-768"><span class="italic"><span class="calibre_4">83</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">currently attached, </span><a href="#calibre_link-769"><span class="italic"><span class="calibre_4">84</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ext2/ext3/ext4, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">FAT, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">HFS+, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">hierarchy, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">internal structure, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ISO 9660, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">journal, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mount, </span><a href="#calibre_link-768"><span class="italic"><span class="calibre_4">83</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mounting, </span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mount options, </span><a href="#calibre_link-127"><span class="italic"><span class="calibre_4">86</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-742"><span class="italic"><span class="calibre_4">87</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">NFS (Network File System), </span><a href="#calibre_link-771"><span class="italic"><span class="calibre_4">332</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-558"><span class="italic"><span class="calibre_4">333</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">overlay, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-635"><span class="italic"><span class="calibre_4">410</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">proc (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="italic">/proc</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">read-only, </span><a href="#calibre_link-127"><span class="italic"><span class="calibre_4">86</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">remount, </span><a href="#calibre_link-742"><span class="italic"><span class="calibre_4">87</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">repairing, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">resizing, </span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">squashfs, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">tmpfs, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">types, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">usage, </span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">user space, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-558"><span class="italic"><span class="calibre_4">333</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-559"><span class="italic"><span class="calibre_4">334</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">UUID (universally unique identifier), </span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">XFS, </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Filesystem Hierarchy Standard (FHS), </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">find</span><span class="calibre_13">, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-775"><span class="italic"><span class="calibre_4">310</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">finding appropriate command, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-743"><span class="italic"><span class="calibre_4">27</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">firewall, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">rule, </span><a href="#calibre_link-291"><span class="italic"><span class="calibre_4">261</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-776"><span class="italic"><span class="calibre_4">262</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">strategy, </span><a href="#calibre_link-776"><span class="italic"><span class="calibre_4">262</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">flex</span><span class="calibre_13">, </span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">folder. </span><span class="italic">See</span><span class="calibre_13"> directory</span></blockquote><blockquote class="calibre_109"><span class="calibre3">for</span><span class="calibre_13">, </span><a href="#calibre_link-342"><span class="italic"><span class="calibre_4">305</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">fork()</span><span class="calibre_13">, </span><a href="#calibre_link-687"><span class="italic"><span class="calibre_4">7</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-752"><span class="italic"><span class="calibre_4">203</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">frame (Ethernet), </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">free</span><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">fsadm</span><span class="calibre_13">, </span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">fsck</span><span class="calibre_13">, </span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">fsuid, </span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">FTP, </span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-777"><span class="italic"><span class="calibre_4">287</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">FUSE (File System in User Space). </span><span class="italic">See</span><span class="calibre_13"> filesystem, user space</span></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">G</span></span></p><blockquote class="calibre_108"><span class="calibre_13">gateway, </span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-668"><span class="italic"><span class="calibre_4">231</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">gcc</span><span class="calibre_13">, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GECOS, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">geteuid()</span><span class="calibre_13">, </span><a href="#calibre_link-780"><span class="italic"><span class="calibre_4">191</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">getty</span><span class="calibre_13">, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-740"><span class="italic"><span class="calibre_4">158</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Ghostscript, </span><a href="#calibre_link-781"><span class="italic"><span class="calibre_4">361</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">glob, </span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-782"><span class="italic"><span class="calibre_4">293</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-783"><span class="italic"><span class="calibre_4">294</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> regular expression</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">global unicast address, </span><a href="#calibre_link-626"><span class="italic"><span class="calibre_4">232</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GNOME, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">gnome&ndash;shell</span><span class="calibre_13">, </span><a href="#calibre_link-414"><span class="italic"><span class="calibre_4">351</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-784"><span class="italic"><span class="calibre_4">352</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GNU Autotools, </span><a href="#calibre_link-597"><span class="italic"><span class="calibre_4">386</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> autoconf</span></blockquote><blockquote class="calibre_109"><span class="calibre3">gparted</span><span class="calibre_13">, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GPT (Globally Unique Identifier Partition Table), </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">grep</span><span class="calibre_13">, </span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-550"><span class="italic"><span class="calibre_4">300</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">group, </span><a href="#calibre_link-785"><span class="italic"><span class="calibre_4">10</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-198"><span class="italic"><span class="calibre_4">180</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">permissions (</span><span class="italic">see</span><span class="calibre_13"> permissions, group)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">groups</span><span class="calibre_13">, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GRUB, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-595"><span class="italic"><span class="calibre_4">135</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot command, </span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">command line, </span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">configuration, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-786"><span class="italic"><span class="calibre_4">129</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">devices, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filesystem access, </span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">insmod, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">installing, </span><a href="#calibre_link-156"><span class="italic"><span class="calibre_4">130</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-587"><span class="italic"><span class="calibre_4">131</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">internals, </span><a href="#calibre_link-787"><span class="italic"><span class="calibre_4">134</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-595"><span class="italic"><span class="calibre_4">135</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">menu, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-788"><span class="italic"><span class="calibre_4">128</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-786"><span class="italic"><span class="calibre_4">129</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">on removable media, </span><a href="#calibre_link-587"><span class="italic"><span class="calibre_4">131</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">root, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-788"><span class="italic"><span class="calibre_4">128</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">grub-mkconfig</span><span class="calibre_13">, </span><a href="#calibre_link-586"><span class="italic"><span class="calibre_4">127</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-786"><span class="italic"><span class="calibre_4">129</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">GTK+, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">guest (operating system), </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">gunzip</span><span class="calibre_13">, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">gzip</span><span class="calibre_13">, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">H</span></span></p><blockquote class="calibre_108"><span class="calibre3">halt</span><span class="calibre_13">, </span><a href="#calibre_link-181"><span class="italic"><span class="calibre_4">162</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-789"><span class="italic"><span class="calibre_4">163</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">hard link. </span><span class="italic">See</span><span class="calibre_13"> file, link</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">hardware operation, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">head</span><span class="calibre_13">, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">header file, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-790"><span class="italic"><span class="calibre_4">371</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-606"><span class="italic"><span class="calibre_4">372</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-608"><span class="italic"><span class="calibre_4">391</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">locating, </span><a href="#calibre_link-609"><span class="italic"><span class="calibre_4">398</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">help, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">here document, </span><a href="#calibre_link-347"><span class="italic"><span class="calibre_4">308</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/home</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">home directory, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">host, </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">host key, </span><a href="#calibre_link-728"><span class="italic"><span class="calibre_4">274</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-754"><span class="italic"><span class="calibre_4">276</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">HTTP, </span><a href="#calibre_link-299"><span class="italic"><span class="calibre_4">270</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">hypervisor, </span><a href="#calibre_link-724"><span class="italic"><span class="calibre_4">402</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">I</span></span></p><blockquote class="calibre_108"><span class="calibre_13">I/O monitoring, </span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ICMP, </span><a href="#calibre_link-258"><span class="italic"><span class="calibre_4">234</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">if</span><span class="calibre_13">/then/else, </span><a href="#calibre_link-335"><span class="italic"><span class="calibre_4">299</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-550"><span class="italic"><span class="calibre_4">300</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ifconfig</span><span class="calibre_13">, </span><a href="#calibre_link-250"><span class="italic"><span class="calibre_4">228</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13">
</span><span class="calibre3">ip</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">image, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> container, image</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">include file. </span><span class="italic">See</span><span class="calibre_13"> header file</span></blockquote><blockquote class="calibre_109"><span class="calibre3">inetd</span><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">info (GNU), </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">init, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-795"><span class="italic"><span class="calibre_4">138</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> systemd</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">container, </span><a href="#calibre_link-637"><span class="italic"><span class="calibre_4">413</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">identifying, </span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">process tracking, </span><a href="#calibre_link-740"><span class="italic"><span class="calibre_4">158</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> systemd, process tracking)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">runlevel (</span><span class="italic">see</span><span class="calibre_13"> runlevel)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">System V, </span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-746"><span class="italic"><span class="calibre_4">161</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">System V sequence, </span><a href="#calibre_link-740"><span class="italic"><span class="calibre_4">158</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-738"><span class="italic"><span class="calibre_4">159</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Upstart, </span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">initramfs, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-595"><span class="italic"><span class="calibre_4">135</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-789"><span class="italic"><span class="calibre_4">163</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-648"><span class="italic"><span class="calibre_4">164</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">initrd, </span><a href="#calibre_link-648"><span class="italic"><span class="calibre_4">164</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> initramfs</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">inode, </span><a href="#calibre_link-699"><span class="italic"><span class="calibre_4">91</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-798"><span class="italic"><span class="calibre_4">92</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">root, </span><a href="#calibre_link-703"><span class="italic"><span class="calibre_4">112</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">installing software, </span><a href="#calibre_link-799"><span class="italic"><span class="calibre_4">385</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-597"><span class="italic"><span class="calibre_4">386</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">interactive shell, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">interface ID (IPv6), </span><a href="#calibre_link-626"><span class="italic"><span class="calibre_4">232</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">internet layer. </span><span class="italic">See</span><span class="calibre_13"> network, internet layer</span></blockquote><blockquote class="calibre_109"><span class="calibre3">iostat</span><span class="calibre_13">, </span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-712"><span class="italic"><span class="calibre_4">215</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">iotop</span><span class="calibre_13">, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-800"><span class="italic"><span class="calibre_4">217</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ip</span><span class="calibre_13"> (command), </span><a href="#calibre_link-250"><span class="italic"><span class="calibre_4">228</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-626"><span class="italic"><span class="calibre_4">232</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-801"><span class="italic"><span class="calibre_4">237</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-568"><span class="italic"><span class="calibre_4">265</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">IP (internet protocol), </span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">address, </span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-250"><span class="italic"><span class="calibre_4">228</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-801"><span class="italic"><span class="calibre_4">237</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">chain, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-803"><span class="italic"><span class="calibre_4">260</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filter, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-776"><span class="italic"><span class="calibre_4">262</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">forwarding, </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">masquerading, </span><a href="#calibre_link-805"><span class="italic"><span class="calibre_4">256</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">subnet (</span><span class="italic">see</span><span class="calibre_13"> subnet)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">table, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-803"><span class="italic"><span class="calibre_4">260</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">IPP (Internet Print Protocol), </span><a href="#calibre_link-781"><span class="italic"><span class="calibre_4">361</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">iptables</span><span class="calibre_13">, </span><a href="#calibre_link-291"><span class="italic"><span class="calibre_4">261</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">IPv4, </span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-668"><span class="italic"><span class="calibre_4">231</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> IP</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">IPv6, </span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-668"><span class="italic"><span class="calibre_4">231</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-276"><span class="italic"><span class="calibre_4">247</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-701"><span class="italic"><span class="calibre_4">253</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-750"><span class="italic"><span class="calibre_4">266</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">iw</span><span class="calibre_13">, </span><a href="#calibre_link-806"><span class="italic"><span class="calibre_4">267</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">J</span></span></p><blockquote class="calibre_108"><span class="calibre3">jar</span><span class="calibre_13">, </span><a href="#calibre_link-627"><span class="italic"><span class="calibre_4">382</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Java, </span><a href="#calibre_link-627"><span class="italic"><span class="calibre_4">382</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-629"><span class="italic"><span class="calibre_4">404</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">job control, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">jobs</span><span class="calibre_13">, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">journalctl</span><span class="calibre_13">, </span><a href="#calibre_link-87"><span class="italic"><span class="calibre_4">46</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-807"><span class="italic"><span class="calibre_4">145</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-592"><span class="italic"><span class="calibre_4">172</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-808"><span class="italic"><span class="calibre_4">175</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-809"><span class="italic"><span class="calibre_4">186</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-569"><span class="italic"><span class="calibre_4">187</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">journald, </span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-811"><span class="italic"><span class="calibre_4">168</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-812"><span class="italic"><span class="calibre_4">173</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-808"><span class="italic"><span class="calibre_4">175</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-809"><span class="italic"><span class="calibre_4">186</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-569"><span class="italic"><span class="calibre_4">187</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">K</span></span></p><blockquote class="calibre_108"><span class="calibre_13">KDE, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Kerberos, </span><a href="#calibre_link-558"><span class="italic"><span class="calibre_4">333</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-559"><span class="italic"><span class="calibre_4">334</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">kernel, </span><a href="#calibre_link-557"><span class="italic"><span class="calibre_4">2</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-644"><span class="italic"><span class="calibre_4">5</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">as a resource, </span><a href="#calibre_link-813"><span class="italic"><span class="calibre_4">199</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot messages, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compiling, </span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">disk buffer and cache (</span><span class="italic">see</span><span class="calibre_13"> disk, buffer and cache)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">disk I/O system, </span><a href="#calibre_link-711"><span class="italic"><span class="calibre_4">71</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">image location, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">load, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">log, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-592"><span class="italic"><span class="calibre_4">172</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mode, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">modules, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network interface (</span><span class="italic">see</span><span class="calibre_13"> network, interface)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">parameters, </span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-706"><span class="italic"><span class="calibre_4">124</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-707"><span class="italic"><span class="calibre_4">125</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">reading partition table (</span><span class="italic">see</span><span class="calibre_13"> partition, reading table)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ring buffer, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">routing table, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">SCSI subsystem, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">space, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">thread, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">keyboard, </span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">kill</span><span class="calibre_13">, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Kubernetes, </span><a href="#calibre_link-638"><span class="italic"><span class="calibre_4">415</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">L</span></span></p><blockquote class="calibre_108"><span class="calibre_13">LAN (local area network), </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">lastlog</span><span class="calibre_13">, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">layer, </span><a href="#calibre_link-557"><span class="italic"><span class="calibre_4">2</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network (</span><span class="italic">see</span><span class="calibre_13"> network, layer)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">LBA (Logical Block Addressing), </span><a href="#calibre_link-659"><span class="italic"><span class="calibre_4">79</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LDAP (Lightweight Directory Access Protocol), </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ldconfig</span><span class="calibre_13">, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">LD_LIBRARY_PATH</span><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-790"><span class="italic"><span class="calibre_4">371</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ld.so</span><span class="calibre_13">, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-816"><span class="italic"><span class="calibre_4">370</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ldd</span><span class="calibre_13">, </span><a href="#calibre_link-817"><span class="italic"><span class="calibre_4">368</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">less</span><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-818"><span class="italic"><span class="calibre_4">341</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">level, </span><a href="#calibre_link-557"><span class="italic"><span class="calibre_4">2</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">in user space, </span><a href="#calibre_link-819"><span class="italic"><span class="calibre_4">8</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Lex, </span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/lib</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">libata, </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">64</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">libinput, </span><a href="#calibre_link-784"><span class="italic"><span class="calibre_4">352</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-820"><span class="italic"><span class="calibre_4">353</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">library, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">C, </span><a href="#calibre_link-632"><span class="italic"><span class="calibre_4">366</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">linking against, </span><a href="#calibre_link-632"><span class="italic"><span class="calibre_4">366</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-753"><span class="italic"><span class="calibre_4">367</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-816"><span class="italic"><span class="calibre_4">370</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-444"><span class="italic"><span class="calibre_4">377</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-459"><span class="italic"><span class="calibre_4">390</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-608"><span class="italic"><span class="calibre_4">391</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">shared (</span><span class="italic">see</span><span class="calibre_13"> shared library)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">static, </span><a href="#calibre_link-753"><span class="italic"><span class="calibre_4">367</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-817"><span class="italic"><span class="calibre_4">368</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Lightweight Directory Access Protocol (LDAP), </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LILO, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">link</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">count (</span><span class="italic">see</span><span class="calibre_13"> file, link count)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">farm, </span><a href="#calibre_link-738"><span class="italic"><span class="calibre_4">159</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">hard (</span><span class="italic">see</span><span class="calibre_13"> file, link)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">symbolic (</span><span class="italic">see</span><span class="calibre_13"> symbolic link)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">link-local address, </span><a href="#calibre_link-626"><span class="italic"><span class="calibre_4">232</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">listening (on network port), </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-308"><span class="italic"><span class="calibre_4">280</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-821"><span class="italic"><span class="calibre_4">288</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-694"><span class="italic"><span class="calibre_4">289</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">literal, </span><a href="#calibre_link-782"><span class="italic"><span class="calibre_4">293</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-325"><span class="italic"><span class="calibre_4">295</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LLMNR (Link-Local Multicast Name Resolution), </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LLVM project, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-453"><span class="italic"><span class="calibre_4">383</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ln</span><span class="calibre_13">, </span><a href="#calibre_link-73"><span class="italic"><span class="calibre_4">38</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> link, hard; link, symbolic</span></blockquote><blockquote class="calibre_109"><span class="italic">lo</span><span class="calibre_13">, </span><a href="#calibre_link-276"><span class="italic"><span class="calibre_4">247</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">loadable kernel modules. </span><span class="italic">See</span><span class="calibre_13"> kernel, modules</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">load average, </span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LOADLIN, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">local area network (LAN), </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">localhost, </span><a href="#calibre_link-822"><span class="italic"><span class="calibre_4">242</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-276"><span class="italic"><span class="calibre_4">247</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">locate</span><span class="calibre_13">, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">log, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-733"><span class="italic"><span class="calibre_4">167</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-811"><span class="italic"><span class="calibre_4">168</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> kernel, log; journald; </span><span class="calibre3">journalctl</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">autoconf, </span><a href="#calibre_link-605"><span class="italic"><span class="calibre_4">392</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">facility/severity/priority, </span><a href="#calibre_link-823"><span class="italic"><span class="calibre_4">174</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-808"><span class="italic"><span class="calibre_4">175</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">message, </span><a href="#calibre_link-811"><span class="italic"><span class="calibre_4">168</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitoring, </span><a href="#calibre_link-592"><span class="italic"><span class="calibre_4">172</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Samba, </span><a href="#calibre_link-824"><span class="italic"><span class="calibre_4">328</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">structured data, </span><a href="#calibre_link-808"><span class="italic"><span class="calibre_4">175</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">sudo, </span><a href="#calibre_link-87"><span class="italic"><span class="calibre_4">46</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">systemd unit (</span><span class="italic">see</span><span class="calibre_13"> systemd, unit log)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">logger</span><span class="calibre_13">, </span><a href="#calibre_link-809"><span class="italic"><span class="calibre_4">186</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">logical volume. </span><span class="italic">See</span><span class="calibre_13"> LVM</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Logical Volume Manager (LVM). </span><span class="italic">See</span><span class="calibre_13"> LVM</span></blockquote><blockquote class="calibre_109"><span class="calibre3">login</span><span class="calibre_13">, </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">loginctl</span><span class="calibre_13">, </span><a href="#calibre_link-570"><span class="italic"><span class="calibre_4">188</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">login shell, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">logrotate</span><span class="calibre_13">, </span><a href="#calibre_link-592"><span class="italic"><span class="calibre_4">172</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-812"><span class="italic"><span class="calibre_4">173</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">loop. </span><span class="italic">See</span><span class="calibre_13"> shell script, loop</span></blockquote><blockquote class="calibre_109"><span class="calibre3">lost+found</span><span class="calibre_13">, </span><a href="#calibre_link-798"><span class="italic"><span class="calibre_4">92</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ls</span><span class="calibre_13">, </span><a href="#calibre_link-31"><span class="italic"><span class="calibre_4">15</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">lsof</span><span class="calibre_13">, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-225"><span class="italic"><span class="calibre_4">202</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network, </span><a href="#calibre_link-308"><span class="italic"><span class="calibre_4">280</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Unix domain socket, </span><a href="#calibre_link-695"><span class="italic"><span class="calibre_4">290</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">lsscsi</span><span class="calibre_13">, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-714"><span class="italic"><span class="calibre_4">63</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">lsusb</span><span class="calibre_13">, </span><a href="#calibre_link-825"><span class="italic"><span class="calibre_4">65</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ltrace</span><span class="calibre_13">, </span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">LV (logical volume). </span><span class="italic">See</span><span class="calibre_13"> LVM, logical volume</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">LVM (Logical Volume Manager), </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-697"><span class="italic"><span class="calibre_4">110</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">advantages, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">constructing system, </span><a href="#calibre_link-826"><span class="italic"><span class="calibre_4">102</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating filesystem, </span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device names, </span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">devices, </span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-708"><span class="italic"><span class="calibre_4">74</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">implementation, </span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-697"><span class="italic"><span class="calibre_4">110</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing, </span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">logical volume, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-678"><span class="italic"><span class="calibre_4">100</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">logical volume, arrangement, </span><a href="#calibre_link-715"><span class="italic"><span class="calibre_4">109</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-697"><span class="italic"><span class="calibre_4">110</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">logical volume, creating, </span><a href="#calibre_link-827"><span class="italic"><span class="calibre_4">104</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-679"><span class="italic"><span class="calibre_4">105</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">logical volume, removing, </span><a href="#calibre_link-828"><span class="italic"><span class="calibre_4">106</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">physical extent, </span><a href="#calibre_link-829"><span class="italic"><span class="calibre_4">99</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">physical volume, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-829"><span class="italic"><span class="calibre_4">99</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-830"><span class="italic"><span class="calibre_4">101</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-831"><span class="italic"><span class="calibre_4">103</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">physical volume, creating, </span><a href="#calibre_link-831"><span class="italic"><span class="calibre_4">103</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">physical volume, metadata, </span><a href="#calibre_link-830"><span class="italic"><span class="calibre_4">101</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-696"><span class="italic"><span class="calibre_4">108</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">resizing, </span><a href="#calibre_link-828"><span class="italic"><span class="calibre_4">106</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-697"><span class="italic"><span class="calibre_4">110</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">scanning volumes, </span><a href="#calibre_link-696"><span class="italic"><span class="calibre_4">108</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">schematic, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">volume group, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-829"><span class="italic"><span class="calibre_4">99</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-830"><span class="italic"><span class="calibre_4">101</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-831"><span class="italic"><span class="calibre_4">103</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">volume group, creating, </span><a href="#calibre_link-831"><span class="italic"><span class="calibre_4">103</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">LXC, </span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-638"><span class="italic"><span class="calibre_4">415</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">M</span></span></p><blockquote class="calibre_108"><span class="calibre_13">MAC address, </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-801"><span class="italic"><span class="calibre_4">237</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-717"><span class="italic"><span class="calibre_4">243</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-568"><span class="italic"><span class="calibre_4">265</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">main memory. </span><span class="italic">See</span><span class="calibre_13"> memory</span></blockquote><blockquote class="calibre_109"><span class="calibre3">make</span><span class="calibre_13">, </span><a href="#calibre_link-607"><span class="italic"><span class="calibre_4">373</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Makefile</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">dependency, </span><a href="#calibre_link-607"><span class="italic"><span class="calibre_4">373</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-832"><span class="italic"><span class="calibre_4">375</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-444"><span class="italic"><span class="calibre_4">377</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">organization, </span><a href="#calibre_link-445"><span class="italic"><span class="calibre_4">378</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">rule, </span><a href="#calibre_link-439"><span class="italic"><span class="calibre_4">374</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-444"><span class="italic"><span class="calibre_4">377</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">separator, </span><a href="#calibre_link-832"><span class="italic"><span class="calibre_4">375</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">standard target, </span><a href="#calibre_link-445"><span class="italic"><span class="calibre_4">378</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-605"><span class="italic"><span class="calibre_4">392</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">staying up-to-date, </span><a href="#calibre_link-832"><span class="italic"><span class="calibre_4">375</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-604"><span class="italic"><span class="calibre_4">376</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">target, </span><a href="#calibre_link-439"><span class="italic"><span class="calibre_4">374</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">man</span><span class="calibre_13">, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">manual page, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-833"><span class="italic"><span class="calibre_4">338</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13">
</span><span class="calibre3">man</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">MBR (Master Boot Record), </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-774"><span class="italic"><span class="calibre_4">126</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot, </span><a href="#calibre_link-156"><span class="italic"><span class="calibre_4">130</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-587"><span class="italic"><span class="calibre_4">131</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-580"><span class="italic"><span class="calibre_4">133</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">mDNS, </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/media</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">memory, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">capacity, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-834"><span class="italic"><span class="calibre_4">209</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">insufficient, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-834"><span class="italic"><span class="calibre_4">209</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">management, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-590"><span class="italic"><span class="calibre_4">119</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitoring usage, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">page (</span><span class="italic">see</span><span class="calibre_13"> page)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">problems, </span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">protection, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">swap (</span><span class="italic">see</span><span class="calibre_13"> swap)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">test, </span><a href="#calibre_link-786"><span class="italic"><span class="calibre_4">129</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">virtual (</span><span class="italic">see</span><span class="calibre_13"> virtual memory)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">mkdir</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">mkfs</span><span class="calibre_13">, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-768"><span class="italic"><span class="calibre_4">83</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">mknod</span><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">mkswap</span><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-685"><span class="italic"><span class="calibre_4">97</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">MMU (memory management unit), </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-835"><span class="italic"><span class="calibre_4">211</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">modules. </span><span class="italic">See</span><span class="calibre_13"> kernel, modules</span></blockquote><blockquote class="calibre_109"><span class="calibre3">mount</span><span class="calibre_13">, </span><a href="#calibre_link-768"><span class="italic"><span class="calibre_4">83</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> filesystem, mount</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">mouse, </span><a href="#calibre_link-836"><span class="italic"><span class="calibre_4">358</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">multitasking, </span><a href="#calibre_link-644"><span class="italic"><span class="calibre_4">5</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">mv</span><span class="calibre_13">, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">N</span></span></p><blockquote class="calibre_108"><span class="calibre_13">namespace. </span><span class="italic">See</span><span class="calibre_13"> network, namespace; process, namespace</span></blockquote><blockquote class="calibre_109"><span class="calibre3">nano</span><span class="calibre_13">, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NAT (Network Address Translation), </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-601"><span class="italic"><span class="calibre_4">258</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NDP (Neighbor Discovery Protocol), </span><a href="#calibre_link-750"><span class="italic"><span class="calibre_4">266</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">netcat</span><span class="calibre_13">, </span><a href="#calibre_link-837"><span class="italic"><span class="calibre_4">282</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-838"><span class="italic"><span class="calibre_4">283</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Netplan, </span><a href="#calibre_link-265"><span class="italic"><span class="calibre_4">239</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">netstat</span><span class="calibre_13">, </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">network, </span><a href="#calibre_link-839"><span class="italic"><span class="calibre_4">223</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">application layer, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-841"><span class="italic"><span class="calibre_4">269</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">client, </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">configuration, </span><a href="#calibre_link-801"><span class="italic"><span class="calibre_4">237</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-717"><span class="italic"><span class="calibre_4">243</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-700"><span class="italic"><span class="calibre_4">252</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> network configuration manager)</span></blockquote><a></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">connection, </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-299"><span class="italic"><span class="calibre_4">270</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-300"><span class="italic"><span class="calibre_4">271</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">container (</span><span class="italic">see</span><span class="calibre_13"> container, networking)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">firewall (</span><span class="italic">see</span><span class="calibre_13"> firewall)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">host (</span><span class="italic">see</span><span class="calibre_13"> host)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">interface, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-640"><span class="italic"><span class="calibre_4">412</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">internet layer, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> IP)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">layer, </span><a href="#calibre_link-839"><span class="italic"><span class="calibre_4">223</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">localhost (</span><span class="italic">see</span><span class="calibre_13"> localhost)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">namespace, </span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-640"><span class="italic"><span class="calibre_4">412</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">packet (</span><span class="italic">see</span><span class="calibre_13"> packet)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">physical layer, </span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">port, </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-748"><span class="italic"><span class="calibre_4">250</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-299"><span class="italic"><span class="calibre_4">270</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">prefix, </span><a href="#calibre_link-250"><span class="italic"><span class="calibre_4">228</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">private (</span><span class="italic">see</span><span class="calibre_13"> private network)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">promiscuous mode, </span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">route, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-668"><span class="italic"><span class="calibre_4">231</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">router (</span><span class="italic">see</span><span class="calibre_13"> router)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">security, </span><a href="#calibre_link-842"><span class="italic"><span class="calibre_4">285</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-777"><span class="italic"><span class="calibre_4">287</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">server, </span><a href="#calibre_link-278"><span class="italic"><span class="calibre_4">248</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-747"><span class="italic"><span class="calibre_4">249</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">simple, </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-700"><span class="italic"><span class="calibre_4">252</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">stack, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">transport layer, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-276"><span class="italic"><span class="calibre_4">247</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">troubleshooting, </span><a href="#calibre_link-258"><span class="italic"><span class="calibre_4">234</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-311"><span class="italic"><span class="calibre_4">284</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">wireless (</span><span class="italic">see</span><span class="calibre_13"> wireless network)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Network Address Translation (NAT), </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-601"><span class="italic"><span class="calibre_4">258</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">network configuration manager, </span><a href="#calibre_link-593"><span class="italic"><span class="calibre_4">240</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-717"><span class="italic"><span class="calibre_4">243</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Network Information Service (NIS), </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">network layer, </span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> network, internet layer</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">NetworkManager, </span><a href="#calibre_link-593"><span class="italic"><span class="calibre_4">240</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-717"><span class="italic"><span class="calibre_4">243</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-806"><span class="italic"><span class="calibre_4">267</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">network mask. </span><span class="italic">See</span><span class="calibre_13"> subnet, mask</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Network Time Protocol (NTP), </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-843"><span class="italic"><span class="calibre_4">251</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NFS (Network File System). </span><span class="italic">See</span><span class="calibre_13"> filesystem, NFS</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">nftables, </span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">nice value, </span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NIS (Network Information Service), </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">nmap</span><span class="calibre_13">, </span><a href="#calibre_link-311"><span class="italic"><span class="calibre_4">284</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">nobody (user), </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">nslookup</span><span class="calibre_13">, </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NTP (Network Time Protocol), </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-843"><span class="italic"><span class="calibre_4">251</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">NVMe (Non-Volatile Memory Express), </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-714"><span class="italic"><span class="calibre_4">63</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">O</span></span></p><blockquote class="calibre_108"><span class="calibre_13">object file, </span><a href="#calibre_link-603"><span class="italic"><span class="calibre_4">365</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-632"><span class="italic"><span class="calibre_4">366</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">OOM killer, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">open()</span><span class="calibre_13">, </span><a href="#calibre_link-752"><span class="italic"><span class="calibre_4">203</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">open source, </span><a href="#calibre_link-799"><span class="italic"><span class="calibre_4">385</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-597"><span class="italic"><span class="calibre_4">386</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">OpenWRT, </span><a href="#calibre_link-601"><span class="italic"><span class="calibre_4">258</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">operating system&ndash;level virtualization, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/opt</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">OSS (Open Sound System), </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">P</span></span></p><blockquote class="calibre_108"><span class="calibre_13">package, </span><a href="#calibre_link-459"><span class="italic"><span class="calibre_4">390</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-844"><span class="italic"><span class="calibre_4">400</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">packet, </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-840"><span class="italic"><span class="calibre_4">225</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">page, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-845"><span class="italic"><span class="calibre_4">213</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">page fault, </span><a href="#calibre_link-835"><span class="italic"><span class="calibre_4">211</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">PAGER</span><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pager, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">page table, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">PAM (Pluggable Authentication Modules), </span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">parallel port, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">paravirtualization, </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">parted</span><span class="calibre_13">, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-757"><span class="italic"><span class="calibre_4">75</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">partition, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-691"><span class="italic"><span class="calibre_4">57</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-713"><span class="italic"><span class="calibre_4">70</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">alignment, </span><a href="#calibre_link-659"><span class="italic"><span class="calibre_4">79</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-121"><span class="italic"><span class="calibre_4">80</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">altering table, </span><a href="#calibre_link-757"><span class="italic"><span class="calibre_4">75</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Apple (</span><span class="italic">see</span><span class="calibre_13"> filesystem, HFS+)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">capacity, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-708"><span class="italic"><span class="calibre_4">74</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> filesystem, capacity)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating table, </span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-658"><span class="italic"><span class="calibre_4">78</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">extended, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">logical, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">primary, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">reading table, </span><a href="#calibre_link-708"><span class="italic"><span class="calibre_4">74</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">swap, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-756"><span class="italic"><span class="calibre_4">73</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> swap)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">system ID, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-708"><span class="italic"><span class="calibre_4">74</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">table, </span><a href="#calibre_link-713"><span class="italic"><span class="calibre_4">70</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-659"><span class="italic"><span class="calibre_4">79</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">viewing, </span><a href="#calibre_link-116"><span class="italic"><span class="calibre_4">72</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-757"><span class="italic"><span class="calibre_4">75</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Windows (</span><span class="italic">see</span><span class="calibre_13"> filesystem, FAT)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">passwd</span><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">password</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">change, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">file (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="italic">/etc/passwd</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">password change, </span><a href="#calibre_link-725"><span class="italic"><span class="calibre_4">197</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">password file. </span><span class="italic">See</span><span class="calibre_13">
</span><span class="italic">/etc/passwd</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">patch, </span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-846"><span class="italic"><span class="calibre_4">396</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">patchelf</span><span class="calibre_13">, </span><a href="#calibre_link-816"><span class="italic"><span class="calibre_4">370</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">PATH</span><span class="calibre_13">. </span><span class="italic">See</span><span class="calibre_13"> path, command</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">path</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">absolute, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">command, </span><a href="#calibre_link-730"><span class="italic"><span class="calibre_4">23</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-847"><span class="italic"><span class="calibre_4">24</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-390"><span class="italic"><span class="calibre_4">337</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-833"><span class="italic"><span class="calibre_4">338</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">relative, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">pathname. </span><span class="italic">See</span><span class="calibre_13"> path</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">pattern matching, </span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">PE. </span><span class="italic">See</span><span class="calibre_13"> LVM, physical extent</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">performance, </span><a href="#calibre_link-813"><span class="italic"><span class="calibre_4">199</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">memory, </span><a href="#calibre_link-848"><span class="italic"><span class="calibre_4">95</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Perl, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-449"><span class="italic"><span class="calibre_4">381</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">permissions, </span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">bits, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">changing, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">default, </span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-560"><span class="italic"><span class="calibre_4">339</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">directory, </span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">execute, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">group, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">other, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">preserving, </span><a href="#calibre_link-565"><span class="italic"><span class="calibre_4">40</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">read, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">testing, </span><a href="#calibre_link-849"><span class="italic"><span class="calibre_4">302</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">user, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">world (</span><span class="italic">see</span><span class="calibre_13"> permissions, other)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">write, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">physical layer. </span><span class="italic">See</span><span class="calibre_13"> network, physical layer</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">physical volume (PV). </span><span class="italic">See</span><span class="calibre_13"> LVM, physical volume</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Pico, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">PID. </span><span class="italic">See</span><span class="calibre_13"> process, ID</span></blockquote><blockquote class="calibre_109"><span class="calibre3">pidstat</span><span class="calibre_13">, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">ping</span><span class="calibre_13">, </span><a href="#calibre_link-258"><span class="italic"><span class="calibre_4">234</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-716"><span class="italic"><span class="calibre_4">235</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pipe, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">named, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">pkg&ndash;config</span><span class="calibre_13">, </span><a href="#calibre_link-572"><span class="italic"><span class="calibre_4">393</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Pluggable Authentication Modules (PAM), </span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">plymouth, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Podman, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-633"><span class="italic"><span class="calibre_4">407</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">port. </span><span class="italic">See</span><span class="calibre_13"> network, port</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">port scan, </span><a href="#calibre_link-311"><span class="italic"><span class="calibre_4">284</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">PostScript, </span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">predictable network interface device name, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">printing, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-426"><span class="italic"><span class="calibre_4">360</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">private network, </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-850"><span class="italic"><span class="calibre_4">257</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/proc</span><span class="calibre_13">, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/proc/devices</span><span class="calibre_13">, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">process, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">accounting, </span><a href="#calibre_link-710"><span class="italic"><span class="calibre_4">222</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">background, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">blocked, </span><a href="#calibre_link-845"><span class="italic"><span class="calibre_4">213</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">child, </span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-637"><span class="italic"><span class="calibre_4">413</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">continue, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">grouping (</span><span class="italic">see</span><span class="calibre_13"> cgroup)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ID, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-224"><span class="italic"><span class="calibre_4">201</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-851"><span class="italic"><span class="calibre_4">206</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-614"><span class="italic"><span class="calibre_4">220</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">interface, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">log messages, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">management, </span><a href="#calibre_link-644"><span class="italic"><span class="calibre_4">5</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">memory, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">monitoring, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">namespace, </span><a href="#calibre_link-635"><span class="italic"><span class="calibre_4">410</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">open files, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-225"><span class="italic"><span class="calibre_4">202</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">owner, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-211"><span class="italic"><span class="calibre_4">189</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">parent, </span><a href="#calibre_link-637"><span class="italic"><span class="calibre_4">413</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-641"><span class="italic"><span class="calibre_4">414</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">priority, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ready to run, </span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-651"><span class="italic"><span class="calibre_4">210</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">starting new, </span><a href="#calibre_link-687"><span class="italic"><span class="calibre_4">7</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">status, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">stop, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">terminate, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">tracking, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unexpected termination, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="italic">.profile</span><span class="calibre_13">, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">prompt. </span><span class="italic">See</span><span class="calibre_13"> shell, prompt</span></blockquote><blockquote class="calibre_109"><span class="calibre3">ps</span><span class="calibre_13">, </span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pseudodevice, </span><a href="#calibre_link-819"><span class="italic"><span class="calibre_4">8</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pseudoterminal, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pseudo-user, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">public key encryption, </span><a href="#calibre_link-728"><span class="italic"><span class="calibre_4">274</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">pulseaudio, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">PV (physical volume). </span><span class="italic">See</span><span class="calibre_13"> LVM, physical volume</span></blockquote><blockquote class="calibre_109"><span class="calibre3">pwd</span><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Python, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-448"><span class="italic"><span class="calibre_4">380</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-449"><span class="italic"><span class="calibre_4">381</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-639"><span class="italic"><span class="calibre_4">417</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-852"><span class="italic"><span class="calibre_4">418</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">Q</span></span></p><blockquote class="calibre_108"><span class="calibre_13">Qt, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">R</span></span></p><blockquote class="calibre_108"><span class="calibre3">read</span><span class="calibre_13">, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">real-time clock, </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">real user ID, </span><a href="#calibre_link-211"><span class="italic"><span class="calibre_4">189</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">reboot</span><span class="calibre_13">, </span><a href="#calibre_link-181"><span class="italic"><span class="calibre_4">162</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-789"><span class="italic"><span class="calibre_4">163</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">redraw display, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">regular expression, </span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">regular file. </span><span class="italic">See</span><span class="calibre_13"> file, regular</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">remote login, </span><a href="#calibre_link-727"><span class="italic"><span class="calibre_4">273</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">renice</span><span class="calibre_13">, </span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">rescue image or CD, </span><a href="#calibre_link-648"><span class="italic"><span class="calibre_4">164</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-854"><span class="italic"><span class="calibre_4">165</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">resolvectl</span><span class="calibre_13">, </span><a href="#calibre_link-718"><span class="italic"><span class="calibre_4">246</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">resolved. </span><span class="italic">See</span><span class="calibre_13"> system-resolved</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">resource</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">limiting, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-710"><span class="italic"><span class="calibre_4">222</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-615"><span class="italic"><span class="calibre_4">406</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">utilization, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-613"><span class="italic"><span class="calibre_4">216</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-617"><span class="italic"><span class="calibre_4">221</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">resource monitoring, </span><a href="#calibre_link-851"><span class="italic"><span class="calibre_4">206</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">reverse isearch, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">RIP (Raster Image Processor), </span><a href="#calibre_link-781"><span class="italic"><span class="calibre_4">361</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-621"><span class="italic"><span class="calibre_4">362</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">rm</span><span class="calibre_13">, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">rmdir</span><span class="calibre_13">, </span><a href="#calibre_link-546"><span class="italic"><span class="calibre_4">17</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-552"><span class="italic"><span class="calibre_4">18</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">root, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> directory, root</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">running programs as, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-87"><span class="italic"><span class="calibre_4">46</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">root directory. </span><span class="italic">See</span><span class="calibre_13"> directory, root</span></blockquote><blockquote class="calibre_109"><span class="calibre3">route</span><span class="calibre_13">, </span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> network, route</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">router, </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-722"><span class="italic"><span class="calibre_4">233</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-596"><span class="italic"><span class="calibre_4">259</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">RPC (remote procedure call), </span><a href="#calibre_link-311"><span class="italic"><span class="calibre_4">284</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-842"><span class="italic"><span class="calibre_4">285</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">rsync</span><span class="calibre_13">, </span><a href="#calibre_link-361"><span class="italic"><span class="calibre_4">317</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">bandwidth, </span><a href="#calibre_link-759"><span class="italic"><span class="calibre_4">322</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compression, </span><a href="#calibre_link-366"><span class="italic"><span class="calibre_4">321</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-759"><span class="italic"><span class="calibre_4">322</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">copying from remote host, </span><a href="#calibre_link-759"><span class="italic"><span class="calibre_4">322</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">copying to remote host, </span><a href="#calibre_link-361"><span class="italic"><span class="calibre_4">317</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-759"><span class="italic"><span class="calibre_4">322</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">exact copy, </span><a href="#calibre_link-855"><span class="italic"><span class="calibre_4">318</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-364"><span class="italic"><span class="calibre_4">319</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">excluding files, </span><a href="#calibre_link-856"><span class="italic"><span class="calibre_4">320</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">verifying transfer, </span><a href="#calibre_link-366"><span class="italic"><span class="calibre_4">321</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">rsyslogd</span><span class="calibre_13">, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-808"><span class="italic"><span class="calibre_4">175</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">ruid. </span><span class="italic">See</span><span class="calibre_13"> real user ID</span></blockquote><blockquote class="calibre_109"><span class="italic">/run</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">runlevel, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-739"><span class="italic"><span class="calibre_4">157</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">run-parts</span><span class="calibre_13">, </span><a href="#calibre_link-857"><span class="italic"><span class="calibre_4">160</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-746"><span class="italic"><span class="calibre_4">161</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">runtime-based virtualization, </span><a href="#calibre_link-639"><span class="italic"><span class="calibre_4">417</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-852"><span class="italic"><span class="calibre_4">418</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">runtime information, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">runtime library search path, </span><a href="#calibre_link-741"><span class="italic"><span class="calibre_4">369</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-791"><span class="italic"><span class="calibre_4">394</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">S</span></span></p><blockquote class="calibre_108"><span class="calibre_13">Samba, </span><a href="#calibre_link-858"><span class="italic"><span class="calibre_4">324</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-859"><span class="italic"><span class="calibre_4">330</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">client, </span><a href="#calibre_link-860"><span class="italic"><span class="calibre_4">329</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-859"><span class="italic"><span class="calibre_4">330</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">sar</span><span class="calibre_13">, </span><a href="#calibre_link-710"><span class="italic"><span class="calibre_4">222</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">saved user ID, </span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/sbin</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">scheduling class, </span><a href="#calibre_link-712"><span class="italic"><span class="calibre_4">215</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">scheduling tasks, </span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-570"><span class="italic"><span class="calibre_4">188</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">SCons, </span><a href="#calibre_link-598"><span class="italic"><span class="calibre_4">399</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">scp</span><span class="calibre_13">, </span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">screen</span><span class="calibre_13">, </span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">scripting language, </span><a href="#calibre_link-448"><span class="italic"><span class="calibre_4">380</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-627"><span class="italic"><span class="calibre_4">382</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">SCSI (Small Computer System Interface), </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">disk (</span><span class="italic">see</span><span class="calibre_13"> disk, SCSI)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">generic, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-114"><span class="italic"><span class="calibre_4">67</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ID, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-714"><span class="italic"><span class="calibre_4">63</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing device information, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-714"><span class="italic"><span class="calibre_4">63</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-571"><span class="italic"><span class="calibre_4">66</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">sector, </span><a href="#calibre_link-659"><span class="italic"><span class="calibre_4">79</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">secure shell. </span><span class="italic">See</span><span class="calibre_13"> SSH</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">security, </span><a href="#calibre_link-780"><span class="italic"><span class="calibre_4">191</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">application, </span><a href="#calibre_link-642"><span class="italic"><span class="calibre_4">405</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">in command path, </span><a href="#calibre_link-833"><span class="italic"><span class="calibre_4">338</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">file sharing, </span><a href="#calibre_link-761"><span class="italic"><span class="calibre_4">323</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-858"><span class="italic"><span class="calibre_4">324</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-767"><span class="italic"><span class="calibre_4">331</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-559"><span class="italic"><span class="calibre_4">334</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network (</span><span class="italic">see</span><span class="calibre_13"> network, security)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">sed</span><span class="calibre_13">, </span><a href="#calibre_link-574"><span class="italic"><span class="calibre_4">309</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-775"><span class="italic"><span class="calibre_4">310</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">segmentation fault, </span><a href="#calibre_link-599"><span class="italic"><span class="calibre_4">31</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-600"><span class="italic"><span class="calibre_4">32</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">serial port, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">server role, </span><a href="#calibre_link-819"><span class="italic"><span class="calibre_4">8</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">setuid, </span><a href="#calibre_link-619"><span class="italic"><span class="calibre_4">36</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-742"><span class="italic"><span class="calibre_4">87</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-211"><span class="italic"><span class="calibre_4">189</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-780"><span class="italic"><span class="calibre_4">191</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">sftp</span><span class="calibre_13">, </span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">shadow password. </span><span class="italic">See</span><span class="calibre_13">
</span><span class="italic">/etc/shadow</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">shared library, </span><a href="#calibre_link-80"><span class="italic"><span class="calibre_4">42</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-753"><span class="italic"><span class="calibre_4">367</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-790"><span class="italic"><span class="calibre_4">371</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-459"><span class="italic"><span class="calibre_4">390</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-608"><span class="italic"><span class="calibre_4">391</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">system calls, </span><a href="#calibre_link-752"><span class="italic"><span class="calibre_4">203</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">trace, </span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">shebang, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-448"><span class="italic"><span class="calibre_4">380</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">shell, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> Bourne Shell</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">change, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">default, </span><a href="#calibre_link-671"><span class="italic"><span class="calibre_4">343</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">editing commands, </span><a href="#calibre_link-630"><span class="italic"><span class="calibre_4">25</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">process ID, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">prompt, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-833"><span class="italic"><span class="calibre_4">338</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-560"><span class="italic"><span class="calibre_4">339</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">quoting, </span><a href="#calibre_link-782"><span class="italic"><span class="calibre_4">293</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-325"><span class="italic"><span class="calibre_4">295</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">special variable, </span><a href="#calibre_link-325"><span class="italic"><span class="calibre_4">295</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-332"><span class="italic"><span class="calibre_4">298</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">user, </span><a href="#calibre_link-779"><span class="italic"><span class="calibre_4">178</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">variable, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-730"><span class="italic"><span class="calibre_4">23</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-325"><span class="italic"><span class="calibre_4">295</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">window, </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">shell script, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-861"><span class="italic"><span class="calibre_4">291</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">arguments, </span><a href="#calibre_link-327"><span class="italic"><span class="calibre_4">296</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-548"><span class="italic"><span class="calibre_4">297</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">arithmetic, </span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-610"><span class="italic"><span class="calibre_4">304</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-862"><span class="italic"><span class="calibre_4">313</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">conditional, </span><a href="#calibre_link-335"><span class="italic"><span class="calibre_4">299</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-610"><span class="italic"><span class="calibre_4">304</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">shell script (continued)</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">include, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">limitations, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-782"><span class="italic"><span class="calibre_4">293</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-862"><span class="italic"><span class="calibre_4">313</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">loop, </span><a href="#calibre_link-342"><span class="italic"><span class="calibre_4">305</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-631"><span class="italic"><span class="calibre_4">306</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">name, </span><a href="#calibre_link-548"><span class="italic"><span class="calibre_4">297</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">permission, </span><a href="#calibre_link-729"><span class="italic"><span class="calibre_4">292</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">reading user input, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">string test, </span><a href="#calibre_link-760"><span class="italic"><span class="calibre_4">303</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">shift</span><span class="calibre_13">, </span><a href="#calibre_link-327"><span class="italic"><span class="calibre_4">296</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">shortcut. </span><span class="italic">See</span><span class="calibre_13"> symbolic link</span></blockquote><blockquote class="calibre_109"><span class="calibre3">shutdown</span><span class="calibre_13">, </span><a href="#calibre_link-738"><span class="italic"><span class="calibre_4">159</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-181"><span class="italic"><span class="calibre_4">162</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-789"><span class="italic"><span class="calibre_4">163</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">signal, </span><a href="#calibre_link-549"><span class="italic"><span class="calibre_4">33</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-577"><span class="italic"><span class="calibre_4">34</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">in shell script, </span><a href="#calibre_link-346"><span class="italic"><span class="calibre_4">307</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">single-user mode, </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-648"><span class="italic"><span class="calibre_4">164</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-854"><span class="italic"><span class="calibre_4">165</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Small Computer System Interface. </span><span class="italic">See</span><span class="calibre_13"> SCSI</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">socket, </span><a href="#calibre_link-821"><span class="italic"><span class="calibre_4">288</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-695"><span class="italic"><span class="calibre_4">290</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device (</span><span class="italic">see</span><span class="calibre_13"> device, socket)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Unix domain (</span><span class="italic">see</span><span class="calibre_13"> Unix domain socket)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">socket unit. </span><span class="italic">See</span><span class="calibre_13"> systemd, socket unit</span></blockquote><blockquote class="calibre_109"><span class="calibre3">sort</span><span class="calibre_13">, </span><a href="#calibre_link-51"><span class="italic"><span class="calibre_4">22</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">sound, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">source code, </span><a href="#calibre_link-602"><span class="italic"><span class="calibre_4">364</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">sourcing, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">special characters, </span><a href="#calibre_link-847"><span class="italic"><span class="calibre_4">24</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-630"><span class="italic"><span class="calibre_4">25</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">splash screen, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">SSD (solid-state disk). </span><span class="italic">See</span><span class="calibre_13"> disk, solid state</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">SSH (secure shell), </span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-765"><span class="italic"><span class="calibre_4">278</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">systemd unit, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">SSHFS, </span><a href="#calibre_link-767"><span class="italic"><span class="calibre_4">331</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-771"><span class="italic"><span class="calibre_4">332</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">SSID, </span><a href="#calibre_link-750"><span class="italic"><span class="calibre_4">266</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">standard error, </span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">standard I/O, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">redirection, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">standard input, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">standard output, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-758"><span class="italic"><span class="calibre_4">35</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">startup. </span><span class="italic">See</span><span class="calibre_13"> boot</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">startup file, </span><a href="#calibre_link-863"><span class="italic"><span class="calibre_4">335</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-720"><span class="italic"><span class="calibre_4">336</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">bash, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">command path, </span><a href="#calibre_link-390"><span class="italic"><span class="calibre_4">337</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-833"><span class="italic"><span class="calibre_4">338</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">example, </span><a href="#calibre_link-818"><span class="italic"><span class="calibre_4">341</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-671"><span class="italic"><span class="calibre_4">343</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">order, </span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">problems, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">tcsh</span><span class="calibre_13">, </span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-671"><span class="italic"><span class="calibre_4">343</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">stat</span><span class="calibre_13"> command, </span><a href="#calibre_link-704"><span class="italic"><span class="calibre_4">113</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">stat()</span><span class="calibre_13"> system call, </span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">state, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">stateless (network) configuration, </span><a href="#calibre_link-701"><span class="italic"><span class="calibre_4">253</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">static library. </span><span class="italic">See</span><span class="calibre_13"> library, static</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">stderr. </span><span class="italic">See</span><span class="calibre_13"> standard error</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">stdin. </span><span class="italic">See</span><span class="calibre_13"> standard input</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">stdio. </span><span class="italic">See</span><span class="calibre_13"> standard I/O</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">stdout. </span><span class="italic">See</span><span class="calibre_13"> standard output</span></blockquote><blockquote class="calibre_109"><span class="calibre3">strace</span><span class="calibre_13">, </span><a href="#calibre_link-225"><span class="italic"><span class="calibre_4">202</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">stream, </span><a href="#calibre_link-611"><span class="italic"><span class="calibre_4">14</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-554"><span class="italic"><span class="calibre_4">28</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">edit (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="calibre3">sed</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ID (in shell), </span><a href="#calibre_link-555"><span class="italic"><span class="calibre_4">29</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">search (</span><span class="italic">see</span><span class="calibre_13">
</span><span class="calibre3">grep</span><span class="calibre_13">)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">subnet, </span><a href="#calibre_link-778"><span class="italic"><span class="calibre_4">227</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-625"><span class="italic"><span class="calibre_4">229</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">choosing, </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-805"><span class="italic"><span class="calibre_4">256</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mask, </span><a href="#calibre_link-250"><span class="italic"><span class="calibre_4">228</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-667"><span class="italic"><span class="calibre_4">230</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-669"><span class="italic"><span class="calibre_4">238</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">routing between, </span><a href="#calibre_link-793"><span class="italic"><span class="calibre_4">254</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-805"><span class="italic"><span class="calibre_4">256</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">subshell, </span><a href="#calibre_link-353"><span class="italic"><span class="calibre_4">311</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">sudo</span><span class="calibre_13">, </span><a href="#calibre_link-28"><span class="italic"><span class="calibre_4">13</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-85"><span class="italic"><span class="calibre_4">45</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-87"><span class="italic"><span class="calibre_4">46</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">superblock, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-798"><span class="italic"><span class="calibre_4">92</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">superserver, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">superuser. </span><span class="italic">See</span><span class="calibre_13"> root</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">swap, </span><a href="#calibre_link-736"><span class="italic"><span class="calibre_4">88</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">partition (</span><span class="italic">see</span><span class="calibre_13"> partition, swap)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">swapoff</span><span class="calibre_13">, </span><a href="#calibre_link-848"><span class="italic"><span class="calibre_4">95</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">swapon</span><span class="calibre_13">, </span><a href="#calibre_link-772"><span class="italic"><span class="calibre_4">94</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-848"><span class="italic"><span class="calibre_4">95</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">symbolic link, </span><a href="#calibre_link-73"><span class="italic"><span class="calibre_4">38</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-849"><span class="italic"><span class="calibre_4">302</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">sync</span><span class="calibre_13">, </span><a href="#calibre_link-127"><span class="italic"><span class="calibre_4">86</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/sys</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> sysfs</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">syscall. </span><span class="italic">See</span><span class="calibre_13"> system call</span></blockquote><blockquote class="calibre_109"><span class="calibre3">sysctl</span><span class="calibre_13">, </span><a href="#calibre_link-804"><span class="italic"><span class="calibre_4">255</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">sysfs, </span><a href="#calibre_link-680"><span class="italic"><span class="calibre_4">49</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-666"><span class="italic"><span class="calibre_4">93</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">SYSLINUX, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">syslog, </span><a href="#calibre_link-811"><span class="italic"><span class="calibre_4">168</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-823"><span class="italic"><span class="calibre_4">174</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-734"><span class="italic"><span class="calibre_4">176</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">system call, </span><a href="#calibre_link-686"><span class="italic"><span class="calibre_4">4</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-687"><span class="italic"><span class="calibre_4">7</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">trace, </span><a href="#calibre_link-225"><span class="italic"><span class="calibre_4">202</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">system clock, </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">systemctl</span><span class="calibre_13">, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-864"><span class="italic"><span class="calibre_4">149</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">systemd, </span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">activating unit, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">conditional dependencies, </span><a href="#calibre_link-866"><span class="italic"><span class="calibre_4">150</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">configuration, </span><a href="#calibre_link-732"><span class="italic"><span class="calibre_4">141</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">Conflicts</span><span class="calibre_13"> dependency, </span><a href="#calibre_link-864"><span class="italic"><span class="calibre_4">149</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating (adding) unit, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">deactivating unit, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">dependency, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-732"><span class="italic"><span class="calibre_4">141</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-867"><span class="italic"><span class="calibre_4">155</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">enabling unit, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-866"><span class="italic"><span class="calibre_4">150</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">instance, </span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a></blockquote><a></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">job, </span><a href="#calibre_link-807"><span class="italic"><span class="calibre_4">145</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">mount unit, </span><a href="#calibre_link-698"><span class="italic"><span class="calibre_4">89</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">on-demand resource, </span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">operation, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">parallel unit activation, </span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">process tracking, </span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">reload unit configuration, </span><a href="#calibre_link-807"><span class="italic"><span class="calibre_4">145</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">Requires</span><span class="calibre_13"> dependency, </span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">Requisite</span><span class="calibre_13"> dependency, </span><a href="#calibre_link-864"><span class="italic"><span class="calibre_4">149</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">service unit, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-809"><span class="italic"><span class="calibre_4">186</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">socket unit, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-869"><span class="italic"><span class="calibre_4">152</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">specifier, </span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-870"><span class="italic"><span class="calibre_4">153</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-810"><span class="italic"><span class="calibre_4">154</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">System V compatibility, </span><a href="#calibre_link-746"><span class="italic"><span class="calibre_4">161</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">target unit, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-866"><span class="italic"><span class="calibre_4">150</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">timer unit, </span><a href="#calibre_link-656"><span class="italic"><span class="calibre_4">185</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-570"><span class="italic"><span class="calibre_4">188</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit cgroup, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit file, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-612"><span class="italic"><span class="calibre_4">147</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-866"><span class="italic"><span class="calibre_4">150</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-656"><span class="italic"><span class="calibre_4">185</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-809"><span class="italic"><span class="calibre_4">186</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit listing, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-807"><span class="italic"><span class="calibre_4">145</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit log, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-807"><span class="italic"><span class="calibre_4">145</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit startup order, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-732"><span class="italic"><span class="calibre_4">141</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-864"><span class="italic"><span class="calibre_4">149</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">unit status, </span><a href="#calibre_link-169"><span class="italic"><span class="calibre_4">144</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">variable, </span><a href="#calibre_link-670"><span class="italic"><span class="calibre_4">143</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre3">Wants</span><span class="calibre_13"> dependency, </span><a href="#calibre_link-865"><span class="italic"><span class="calibre_4">146</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-660"><span class="italic"><span class="calibre_4">148</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-868"><span class="italic"><span class="calibre_4">151</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">systemd-</span><span class="calibre_13"> (prefix), </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">systemd&ndash;analyze</span><span class="calibre_13">, </span><a href="#calibre_link-770"><span class="italic"><span class="calibre_4">140</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-732"><span class="italic"><span class="calibre_4">141</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-864"><span class="italic"><span class="calibre_4">149</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">systemd-boot, </span><a href="#calibre_link-153"><span class="italic"><span class="calibre_4">123</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">systemd-resolved, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-273"><span class="italic"><span class="calibre_4">245</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">systemd-run</span><span class="calibre_13">, </span><a href="#calibre_link-570"><span class="italic"><span class="calibre_4">188</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">system time, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">System V init. See init, System V</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">system virtual machine, </span><a href="#calibre_link-724"><span class="italic"><span class="calibre_4">402</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">T</span></span></p><blockquote class="calibre_108"><span class="calibre3">tail</span><span class="calibre_13">, </span><a href="#calibre_link-47"><span class="italic"><span class="calibre_4">21</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">TAP interface, </span><a href="#calibre_link-640"><span class="italic"><span class="calibre_4">412</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">tar</span><span class="calibre_13">, </span><a href="#calibre_link-563"><span class="italic"><span class="calibre_4">39</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-853"><span class="italic"><span class="calibre_4">312</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">TCP (Transmission Control Protocol), </span><a href="#calibre_link-276"><span class="italic"><span class="calibre_4">247</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-843"><span class="italic"><span class="calibre_4">251</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filtering, </span><a href="#calibre_link-776"><span class="italic"><span class="calibre_4">262</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-567"><span class="italic"><span class="calibre_4">264</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">interacting with service, </span><a href="#calibre_link-299"><span class="italic"><span class="calibre_4">270</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">wrapper, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">tcpdump</span><span class="calibre_13">, </span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-838"><span class="italic"><span class="calibre_4">283</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">tcsh</span><span class="calibre_13">, </span><a href="#calibre_link-576"><span class="italic"><span class="calibre_4">342</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-671"><span class="italic"><span class="calibre_4">343</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">telinit</span><span class="calibre_13">, </span><a href="#calibre_link-746"><span class="italic"><span class="calibre_4">161</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">telnet</span><span class="calibre_13">, </span><a href="#calibre_link-299"><span class="italic"><span class="calibre_4">270</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-727"><span class="italic"><span class="calibre_4">273</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-777"><span class="italic"><span class="calibre_4">287</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">tempfs. </span><span class="italic">See</span><span class="calibre_13"> filesystem, tmpfs</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">temporary file. </span><span class="italic">See</span><span class="calibre_13"> file, temporary</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">terminal, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> shell, window</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">controlling (</span><span class="italic">see</span><span class="calibre_13"> controlling terminal)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">device (</span><span class="italic">see</span><span class="calibre_13"> device, terminal)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">virtual (</span><span class="italic">see</span><span class="calibre_13"> virtual console)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">test</span><span class="calibre_13">, </span><a href="#calibre_link-335"><span class="italic"><span class="calibre_4">299</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-610"><span class="italic"><span class="calibre_4">304</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">text editor, </span><a href="#calibre_link-630"><span class="italic"><span class="calibre_4">25</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-672"><span class="italic"><span class="calibre_4">344</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">text search, </span><a href="#calibre_link-553"><span class="italic"><span class="calibre_4">19</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-702"><span class="italic"><span class="calibre_4">20</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">thrash, </span><a href="#calibre_link-834"><span class="italic"><span class="calibre_4">209</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-835"><span class="italic"><span class="calibre_4">211</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> memory, insufficient</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">thread, </span><a href="#calibre_link-731"><span class="italic"><span class="calibre_4">204</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-851"><span class="italic"><span class="calibre_4">206</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">time</span><span class="calibre_13">, </span><a href="#calibre_link-232"><span class="italic"><span class="calibre_4">207</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-835"><span class="italic"><span class="calibre_4">211</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> CPU, time; system time; elapsed time</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">time (of day), </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">timer unit. </span><span class="italic">See</span><span class="calibre_13"> systemd, timer unit</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">time slice, </span><a href="#calibre_link-644"><span class="italic"><span class="calibre_4">5</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">timesyncd, </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">time zone, </span><a href="#calibre_link-663"><span class="italic"><span class="calibre_4">182</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">TLS (Transport Layer Security), </span><a href="#calibre_link-802"><span class="italic"><span class="calibre_4">226</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-777"><span class="italic"><span class="calibre_4">287</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/tmp</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">toolkit, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">top</span><span class="calibre_13">, </span><a href="#calibre_link-654"><span class="italic"><span class="calibre_4">200</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-649"><span class="italic"><span class="calibre_4">205</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-650"><span class="italic"><span class="calibre_4">208</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">touch</span><span class="calibre_13">, </span><a href="#calibre_link-34"><span class="italic"><span class="calibre_4">16</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Transmission Control Protocol. </span><span class="italic">See</span><span class="calibre_13"> TCP</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">transport layer. </span><span class="italic">See</span><span class="calibre_13"> network, application layer</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Transport Layer Security. </span><span class="italic">See</span><span class="calibre_13"> TLS</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">troubleshooting, </span><a href="#calibre_link-811"><span class="italic"><span class="calibre_4">168</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">tune2fs</span><span class="calibre_13">, </span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">U</span></span></p><blockquote class="calibre_108"><span class="calibre_13">udev, </span><a href="#calibre_link-676"><span class="italic"><span class="calibre_4">48</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-715"><span class="italic"><span class="calibre_4">109</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">configuration and rules, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-690"><span class="italic"><span class="calibre_4">60</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">event (</span><span class="italic">see</span><span class="calibre_13"> uevent)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">udevadm</span><span class="calibre_13">, </span><a href="#calibre_link-664"><span class="italic"><span class="calibre_4">50</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-665"><span class="italic"><span class="calibre_4">51</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-690"><span class="italic"><span class="calibre_4">60</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-584"><span class="italic"><span class="calibre_4">76</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">udevd, </span><a href="#calibre_link-562"><span class="italic"><span class="calibre_4">56</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-582"><span class="italic"><span class="calibre_4">85</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-789"><span class="italic"><span class="calibre_4">163</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">udisksd, </span><a href="#calibre_link-692"><span class="italic"><span class="calibre_4">62</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">UDP (User Datagram Protocol), </span><a href="#calibre_link-748"><span class="italic"><span class="calibre_4">250</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-843"><span class="italic"><span class="calibre_4">251</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">UEFI (Unified Extensible Firmware Interface), </span><a href="#calibre_link-578"><span class="italic"><span class="calibre_4">121</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-579"><span class="italic"><span class="calibre_4">122</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-156"><span class="italic"><span class="calibre_4">130</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">ESP (EFI System Partition), </span><a href="#calibre_link-580"><span class="italic"><span class="calibre_4">133</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-595"><span class="italic"><span class="calibre_4">135</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">secure boot, </span><a href="#calibre_link-587"><span class="italic"><span class="calibre_4">131</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">uevent, </span><a href="#calibre_link-689"><span class="italic"><span class="calibre_4">58</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-688"><span class="italic"><span class="calibre_4">61</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">umask</span><span class="calibre_13">, </span><a href="#calibre_link-620"><span class="italic"><span class="calibre_4">37</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-560"><span class="italic"><span class="calibre_4">339</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-575"><span class="italic"><span class="calibre_4">340</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">umount</span><span class="calibre_13">, </span><a href="#calibre_link-769"><span class="italic"><span class="calibre_4">84</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Unified Extensible Firmware Interface. </span><span class="italic">See</span><span class="calibre_13"> UEFI</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Universal Coordinated Time (UTC), </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Universally Unique Identifier (UUID), </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Unix, </span><a href="#calibre_link-871"><span class="italic"><span class="calibre_4">11</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Unix domain socket, </span><a href="#calibre_link-694"><span class="italic"><span class="calibre_4">289</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-695"><span class="italic"><span class="calibre_4">290</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">unlink, </span><a href="#calibre_link-583"><span class="italic"><span class="calibre_4">114</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> file, delete</span></blockquote><blockquote class="calibre_109"><span class="calibre3">unxz</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">unzip</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">uplink, </span><a href="#calibre_link-792"><span class="italic"><span class="calibre_4">224</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> default gateway</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">Upstart, </span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">uptime</span><span class="calibre_13">, </span><a href="#calibre_link-834"><span class="italic"><span class="calibre_4">209</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">USB</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">listing device information, </span><a href="#calibre_link-825"><span class="italic"><span class="calibre_4">65</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">relationship to SCSI, </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-495"><span class="italic"><span class="calibre_4">64</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-825"><span class="italic"><span class="calibre_4">65</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">serial port, </span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">user, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">change, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-87"><span class="italic"><span class="calibre_4">46</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">id (</span><span class="italic">see</span><span class="calibre_13"> user ID)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">management, </span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-198"><span class="italic"><span class="calibre_4">180</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">name (</span><span class="italic">see</span><span class="calibre_13"> username)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">regular, </span><a href="#calibre_link-547"><span class="italic"><span class="calibre_4">12</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">root (</span><span class="italic">see</span><span class="calibre_13"> root)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">user authentication, </span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-726"><span class="italic"><span class="calibre_4">198</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> PAM; </span><span class="italic">/etc/passwd</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">user authorization, </span><a href="#calibre_link-622"><span class="italic"><span class="calibre_4">193</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> PAM</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">User Datagram Protocol (UDP), </span><a href="#calibre_link-748"><span class="italic"><span class="calibre_4">250</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-843"><span class="italic"><span class="calibre_4">251</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-573"><span class="italic"><span class="calibre_4">281</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">user environment, </span><a href="#calibre_link-863"><span class="italic"><span class="calibre_4">335</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-720"><span class="italic"><span class="calibre_4">336</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">user ID, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-211"><span class="italic"><span class="calibre_4">189</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-723"><span class="italic"><span class="calibre_4">190</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">user identification, </span><a href="#calibre_link-780"><span class="italic"><span class="calibre_4">191</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">userland. </span><span class="italic">See</span><span class="calibre_13"> user space</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">user mode, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">username, </span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-735"><span class="italic"><span class="calibre_4">177</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">user process. </span><span class="italic">See</span><span class="calibre_13"> process</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">user space, </span><a href="#calibre_link-814"><span class="italic"><span class="calibre_4">3</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">and filesystems, </span><a href="#calibre_link-142"><span class="italic"><span class="calibre_4">111</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">and LVM, </span><a href="#calibre_link-773"><span class="italic"><span class="calibre_4">107</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">and user IDs, </span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-780"><span class="italic"><span class="calibre_4">191</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-745"><span class="italic"><span class="calibre_4">192</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">creating filesystems in, </span><a href="#calibre_link-766"><span class="italic"><span class="calibre_4">82</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filesystem (</span><span class="italic">see</span><span class="calibre_13"> filesystem, user space)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">organization, </span><a href="#calibre_link-819"><span class="italic"><span class="calibre_4">8</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-762"><span class="italic"><span class="calibre_4">9</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">start, </span><a href="#calibre_link-588"><span class="italic"><span class="calibre_4">117</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-589"><span class="italic"><span class="calibre_4">118</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-705"><span class="italic"><span class="calibre_4">120</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-872"><span class="italic"><span class="calibre_4">137</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-796"><span class="italic"><span class="calibre_4">139</span></span></a><span class="calibre_13"> (</span><span class="italic">see also</span><span class="calibre_13"> init)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="italic">/usr</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/usr/lib</span><span class="calibre_13">, </span><a href="#calibre_link-753"><span class="italic"><span class="calibre_4">367</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/usr/local</span><span class="calibre_13">, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-459"><span class="italic"><span class="calibre_4">390</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-647"><span class="italic"><span class="calibre_4">395</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/usr/share</span><span class="calibre_13">, </span><a href="#calibre_link-82"><span class="italic"><span class="calibre_4">44</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">UTC (Universal Coordinated Time), </span><a href="#calibre_link-199"><span class="italic"><span class="calibre_4">181</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-655"><span class="italic"><span class="calibre_4">183</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">UUID (Universally Unique Identifier), </span><a href="#calibre_link-681"><span class="italic"><span class="calibre_4">52</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">filesystem (</span><span class="italic">see also</span><span class="calibre_13"> filesystem, UUID)</span></blockquote></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">V</span></span></p><blockquote class="calibre_108"><span class="italic">/var</span><span class="calibre_13">, </span><a href="#calibre_link-585"><span class="italic"><span class="calibre_4">43</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">/var/log</span><span class="calibre_13">, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">VFS (Virtual File System), </span><a href="#calibre_link-693"><span class="italic"><span class="calibre_4">81</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-146"><span class="italic"><span class="calibre_4">115</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">vi</span><span class="calibre_13">, </span><a href="#calibre_link-719"><span class="italic"><span class="calibre_4">26</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">vipw</span><span class="calibre_13">, </span><a href="#calibre_link-744"><span class="italic"><span class="calibre_4">179</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual, </span><a href="#calibre_link-873"><span class="italic"><span class="calibre_4">401</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">VirtualBox, </span><a href="#calibre_link-724"><span class="italic"><span class="calibre_4">402</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual console, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-561"><span class="italic"><span class="calibre_4">55</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-740"><span class="italic"><span class="calibre_4">158</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual disk. </span><span class="italic">See</span><span class="calibre_13"> disk, virtual</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual interface (network), </span><a href="#calibre_link-636"><span class="italic"><span class="calibre_4">411</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-640"><span class="italic"><span class="calibre_4">412</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual machine, </span><a href="#calibre_link-677"><span class="italic"><span class="calibre_4">53</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-627"><span class="italic"><span class="calibre_4">382</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-724"><span class="italic"><span class="calibre_4">402</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-642"><span class="italic"><span class="calibre_4">405</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">virtual memory, </span><a href="#calibre_link-645"><span class="italic"><span class="calibre_4">6</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-684"><span class="italic"><span class="calibre_4">96</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-873"><span class="italic"><span class="calibre_4">401</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> memory, management</span></blockquote><blockquote class="calibre_109"><span class="calibre3">vmstat</span><span class="calibre_13">, </span><a href="#calibre_link-652"><span class="italic"><span class="calibre_4">212</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-653"><span class="italic"><span class="calibre_4">214</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">volume group. </span><span class="italic">See</span><span class="calibre_13"> LVM, </span><a href="#calibre_link-4"><span class="italic"><span class="calibre_4">v</span></span></a><span class="calibre_13">olume group</span></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">W</span></span></p><blockquote class="calibre_108"><span class="calibre3">wait()</span><span class="calibre_13">, </span><a href="#calibre_link-637"><span class="italic"><span class="calibre_4">413</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">wallpaper. </span><span class="italic">See</span><span class="calibre_13"> desktop background</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">warning messages, </span><a href="#calibre_link-64"><span class="italic"><span class="calibre_4">30</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Wayland, </span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">compositor, </span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-784"><span class="italic"><span class="calibre_4">352</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">input, </span><a href="#calibre_link-784"><span class="italic"><span class="calibre_4">352</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-820"><span class="italic"><span class="calibre_4">353</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">window manager, </span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">X compatibility, </span><a href="#calibre_link-820"><span class="italic"><span class="calibre_4">353</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-875"><span class="italic"><span class="calibre_4">354</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">web server, </span><a href="#calibre_link-764"><span class="italic"><span class="calibre_4">316</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">WEP (Wired Equivalent Privacy), </span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Weston, </span><a href="#calibre_link-414"><span class="italic"><span class="calibre_4">351</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-784"><span class="italic"><span class="calibre_4">352</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-875"><span class="italic"><span class="calibre_4">354</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">while</span><span class="calibre_13">, </span><a href="#calibre_link-342"><span class="italic"><span class="calibre_4">305</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-631"><span class="italic"><span class="calibre_4">306</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">who</span><span class="calibre_13">, </span><a href="#calibre_link-797"><span class="italic"><span class="calibre_4">156</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">widget, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">WiFi Protected Access (WPA), </span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">wildcard. </span><span class="italic">See</span><span class="calibre_13"> glob</span></blockquote><blockquote class="calibre_109"><span class="calibre_13">windowing system (determining), </span><a href="#calibre_link-414"><span class="italic"><span class="calibre_4">351</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">window manager, </span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Windows</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">boot, </span><a href="#calibre_link-594"><span class="italic"><span class="calibre_4">132</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">file sharing, </span><a href="#calibre_link-858"><span class="italic"><span class="calibre_4">324</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-859"><span class="italic"><span class="calibre_4">330</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">partition (</span><span class="italic">see</span><span class="calibre_13"> filesystem, FAT)</span></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">password, </span><a href="#calibre_link-876"><span class="italic"><span class="calibre_4">326</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-877"><span class="italic"><span class="calibre_4">327</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">printer sharing, </span><a href="#calibre_link-860"><span class="italic"><span class="calibre_4">329</span></span></a></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre_13">Wired Equivalent Privacy (WEP), </span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">wireless network, </span><a href="#calibre_link-593"><span class="italic"><span class="calibre_4">240</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-268"><span class="italic"><span class="calibre_4">241</span></span></a><span class="calibre_13">. </span><span class="italic">See also</span><span class="calibre_13"> Ethernet, wireless</span></blockquote><blockquote class="calibre_109"><span class="italic">wlan0</span><span class="calibre_13">, </span><a href="#calibre_link-749"><span class="italic"><span class="calibre_4">236</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-806"><span class="italic"><span class="calibre_4">267</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">worker process, </span><a href="#calibre_link-657"><span class="italic"><span class="calibre_4">272</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">WPA (WiFi Protected Access), </span><a href="#calibre_link-751"><span class="italic"><span class="calibre_4">268</span></span></a></blockquote><blockquote class="calibre_109"><span class="italic">wtmp</span><span class="calibre_13">, </span><a href="#calibre_link-187"><span class="italic"><span class="calibre_4">169</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">X</span></span></p><blockquote class="calibre_108"><span class="calibre3">xargs</span><span class="calibre_13">, </span><a href="#calibre_link-775"><span class="italic"><span class="calibre_4">310</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">XDG Desktop Entry, </span><a href="#calibre_link-662"><span class="italic"><span class="calibre_4">142</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">Xen, </span><a href="#calibre_link-628"><span class="italic"><span class="calibre_4">403</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">xev</span><span class="calibre_13">, </span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">X event. </span><span class="italic">See</span><span class="calibre_13"> X Window System, event</span></blockquote><blockquote class="calibre_109"><span class="calibre3">xinetd</span><span class="calibre_13">, </span><a href="#calibre_link-794"><span class="italic"><span class="calibre_4">279</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">xinput</span><span class="calibre_13">, </span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-836"><span class="italic"><span class="calibre_4">358</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">XKB (X keyboard extension), </span><a href="#calibre_link-836"><span class="italic"><span class="calibre_4">358</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">xlsclients</span><span class="calibre_13">, </span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">xset</span><span class="calibre_13">, </span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre_13">X Window System</span></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">application, </span><a href="#calibre_link-675"><span class="italic"><span class="calibre_4">350</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">client, </span><a href="#calibre_link-674"><span class="italic"><span class="calibre_4">348</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">diagnostics, </span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">display, </span><a href="#calibre_link-875"><span class="italic"><span class="calibre_4">354</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">event, </span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">input, </span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">network transparency, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">preferences, </span><a href="#calibre_link-815"><span class="italic"><span class="calibre_4">357</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-661"><span class="italic"><span class="calibre_4">359</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">server, </span><a href="#calibre_link-646"><span class="italic"><span class="calibre_4">54</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-674"><span class="italic"><span class="calibre_4">348</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-874"><span class="italic"><span class="calibre_4">349</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-875"><span class="italic"><span class="calibre_4">354</span></span></a><span class="calibre_13">&ndash;</span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">tunneling, </span><a href="#calibre_link-727"><span class="italic"><span class="calibre_4">273</span></span></a><span class="calibre_13">, </span><a href="#calibre_link-624"><span class="italic"><span class="calibre_4">355</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">Wayland compatibility, </span><a href="#calibre_link-875"><span class="italic"><span class="calibre_4">354</span></span></a></blockquote></blockquote><blockquote class="calibre_70"><blockquote class="calibre_12"><span class="calibre_13">window manager (</span><span class="italic">see</span><span class="calibre_13"> window manager)</span></blockquote></blockquote><blockquote class="calibre_109"><span class="calibre3">xwininfo</span><span class="calibre_13">, </span><a href="#calibre_link-878"><span class="italic"><span class="calibre_4">356</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">xz</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">Y</span></span></p><blockquote class="calibre_108"><span class="calibre_13">Yacc, </span><a href="#calibre_link-581"><span class="italic"><span class="calibre_4">379</span></span></a></blockquote><p class="calibre_9"><span class="calibre6"><span class="bold">Z</span></span></p><blockquote class="calibre_108"><span class="calibre3">zcat</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><blockquote class="calibre_109"><span class="calibre3">zip</span><span class="calibre_13">, </span><a href="#calibre_link-564"><span class="italic"><span class="calibre_4">41</span></span></a></blockquote><div class="mbp_pagebreak"></div><p id="calibre_link-879" class="calibre_"><span class="calibre1"><span class="bold">Table of Contents</span></span></p><p class="calibre_110"><a href="#calibre_link-1">Reviews for How Linux Works</a></p><p class="calibre_111"><a href="#calibre_link-2">Title Page</a></p><p class="calibre_111"><a href="#calibre_link-3">Copyright</a></p><p class="calibre_111"><a href="#calibre_link-4">About the Author</a></p><p class="calibre_111"><a href="#calibre_link-5">Acknowledgments</a></p><p class="calibre_111"><a href="#calibre_link-6">Preface</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-7">Who Should Read This Book?</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-8">Prerequisites</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-9">How to Read This Book</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-10">A Hands-on Approach</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-11">How This Book Is Organized</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-12">What’s New in the Third Edition?</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-13">A Note on Terminology</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-14">Chapter 1: The Big Picture</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-15">1.1 Levels and Layers of Abstraction in a Linux System</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-16">1.2 Hardware: Understanding Main Memory</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-17">1.3 The Kernel</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-18">1.3.1 Process Management</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-19">1.3.2 Memory Management</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-20">1.3.3 Device Drivers and Management</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-21">1.3.4 System Calls and Support</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-22">1.4 User Space</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-23">1.5 Users</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-24">1.6 Looking Forward</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-25">Chapter 2: Basic Commands and Directory Hierarchy</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-26">2.1 The Bourne Shell: /bin/sh</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-27">2.2 Using the Shell</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-28">2.2.1 The Shell Window</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-29">2.2.2 cat</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-30">2.2.3 Standard Input and Standard Output</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-31">2.3 Basic Commands</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-32">2.3.1 ls</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-33">2.3.2 cp</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-34">2.3.3 mv</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-35">2.3.4 touch</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-36">2.3.5 rm</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-37">2.3.6 echo</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-38">2.4 Navigating Directories</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-39">2.4.1 cd</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-40">2.4.2 mkdir</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-41">2.4.3 rmdir</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-42">2.4.4 Shell Globbing (“Wildcards”)</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-43">2.5 Intermediate Commands</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-44">2.5.1 grep</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-45">2.5.2 less</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-46">2.5.3 pwd</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-47">2.5.4 diff</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-48">2.5.5 file</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-49">2.5.6 find and locate</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-50">2.5.7 head and tail</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-51">2.5.8 sort</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-52">2.6 Changing Your Password and Shell</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-53">2.7 Dot Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-54">2.8 Environment and Shell Variables</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-55">2.9 The Command Path</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-56">2.10 Special Characters</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-57">2.11 Command-Line Editing</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-58">2.12 Text Editors</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-59">2.13 Getting Online Help</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-60">2.14 Shell Input and Output</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-61">2.14.1 Standard Error</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-62">2.14.2 Standard Input Redirection</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-63">2.15 Understanding Error Messages</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-64">2.15.1 Anatomy of a Unix Error Message</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-65">2.15.2 Common Errors</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-66">2.16 Listing and Manipulating Processes</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-67">2.16.1 ps Command Options</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-68">2.16.2 Process Termination</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-69">2.16.3 Job Control</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-70">2.16.4 Background Processes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-71">2.17 File Modes and Permissions</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-72">2.17.1 Modifying Permissions</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-73">2.17.2 Working with Symbolic Links</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-74">2.18 Archiving and Compressing Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-75">2.18.1 gzip</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-76">2.18.2 tar</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-77">2.18.3 Compressed Archives (.tar.gz)</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-78">2.18.4 zcat</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-79">2.18.5 Other Compression Utilities</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-80">2.19 Linux Directory Hierarchy Essentials</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-81">2.19.1 Other Root Subdirectories</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-82">2.19.2 The /usr Directory</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-83">2.19.3 Kernel Location</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-84">2.20 Running Commands as the Superuser</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-85">2.20.1 sudo</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-86">2.20.2 /etc/sudoers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-87">2.20.3 sudo Logs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-88">2.21 Looking Forward</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-89">Chapter 3: Devices</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-90">3.1 Device Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-91">3.2 The sysfs Device Path</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-92">3.3 dd and Devices</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-93">3.4 Device Name Summary</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-94">3.4.1 Hard Disks: /dev/sd*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-95">3.4.2 Virtual Disks: /dev/xvd*, /dev/vd*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-96">3.4.3 Non-Volatile Memory Devices: /dev/nvme*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-97">3.4.4 Device Mapper: /dev/dm-*, /dev/mapper/*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-98">3.4.5 CD and DVD Drives: /dev/sr*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-99">3.4.6 PATA Hard Disks: /dev/hd*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-100">3.4.7 Terminals: /dev/tty*, /dev/pts/*, and /dev/tty</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-101">3.4.8 Serial Ports: /dev/ttyS*, /dev/ttyUSB*, /dev/ttyACM*</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-102">3.4.9 Parallel Ports: /dev/lp0 and /dev/lp1</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-103">3.4.10 Audio Devices: /dev/snd/*, /dev/dsp, /dev/audio, and More</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-104">3.4.11 Device File Creation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-105">3.5 udev</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-106">3.5.1 devtmpfs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-107">3.5.2 udevd Operation and Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-108">3.5.3 udevadm</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-109">3.5.4 Device Monitoring</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-110">3.6 In-Depth: SCSI and the Linux Kernel</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-111">3.6.1 USB Storage and SCSI</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-112">3.6.2 SCSI and ATA</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-113">3.6.3 Generic SCSI Devices</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-114">3.6.4 Multiple Access Methods for a Single Device</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-115">Chapter 4: Disks and Filesystems</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-116">4.1 Partitioning Disk Devices</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-117">4.1.1 Viewing a Partition Table</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-118">4.1.2 Modifying Partition Tables</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-119">4.1.3 Creating a Partition Table</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-120">4.1.4 Navigating Disk and Partition Geometry</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-121">4.1.5 Reading from Solid-State Disks</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-122">4.2 Filesystems</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-123">4.2.1 Filesystem Types</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-124">4.2.2 Creating a Filesystem</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-125">4.2.3 Mounting a Filesystem</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-126">4.2.4 Filesystem UUID</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-127">4.2.5 Disk Buffering, Caching, and Filesystems</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-128">4.2.6 Filesystem Mount Options</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-129">4.2.7 Remounting a Filesystem</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-130">4.2.8 The /etc/fstab Filesystem Table</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-131">4.2.9 Alternatives to /etc/fstab</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-132">4.2.10 Filesystem Capacity</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-133">4.2.11 Checking and Repairing Filesystems</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-134">4.2.12 Special-Purpose Filesystems</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-135">4.3 Swap Space</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-136">4.3.1 Using a Disk Partition as Swap Space</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-137">4.3.2 Using a File as Swap Space</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-138">4.3.3 Determining How Much Swap You Need</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-139">4.4 The Logical Volume Manager</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-140">4.4.1 Working with LVM</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-141">4.4.2 The LVM Implementation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-142">4.5 Looking Forward: Disks and User Space</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-143">4.6 Inside a Traditional Filesystem</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-144">4.6.1 Inode Details and the Link Count</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-145">4.6.2 Block Allocation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-146">4.6.3 Working with Filesystems in User Space</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-147">Chapter 5: How the Linux Kernel Boots</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-148">5.1 Startup Messages</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-149">5.2 Kernel Initialization and Boot Options</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-150">5.3 Kernel Parameters</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-151">5.4 Boot Loaders</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-152">5.4.1 Boot Loader Tasks</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-153">5.4.2 Boot Loader Overview</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-154">5.5.1 Exploring Devices and Partitions with the GRUB Command Line</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-155">5.5.2 GRUB Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-156">5.5.3 GRUB Installation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-157">5.6 UEFI Secure Boot Problems</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-158">5.7 Chainloading Other Operating Systems</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-159">5.8 Boot Loader Details</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-160">5.8.1 MBR Boot</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-161">5.8.2 UEFI Boot</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-162">5.8.3 How GRUB Works</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-163">Chapter 6: How User Space Starts</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-164">6.2 Identifying Your init</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-165">6.3 systemd</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-166">6.3.1 Units and Unit Types</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-167">6.3.2 Booting and Unit Dependency Graphs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-168">6.3.3 systemd Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-169">6.3.4 systemd Operation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-170">6.3.5 systemd Process Tracking and Synchronization</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-171">6.3.6 systemd Dependencies</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-172">6.3.7 systemd On-Demand and Resource-Parallelized Startup</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-173">6.3.8 systemd Auxiliary Components</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-174">6.4 System V Runlevels</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-175">6.5 System V init</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-176">6.5.1 System V init: Startup Command Sequence</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-177">6.5.2 The System V init Link Farm</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-178">6.5.3 run-parts</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-179">6.5.4 System V init Control</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-180">6.5.5 systemd System V Compatibility</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-181">6.6 Shutting Down Your System</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-182">6.7 The Initial RAM Filesystem</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-183">6.8 Emergency Booting and Single-User Mode</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-184">6.9 Looking Forward</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-185">Chapter 7: System Configuration: Logging, System Time, Batch Jobs, and Users</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-186">7.1 System Logging</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-187">7.1.1 Checking Your Log Setup</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-188">7.1.2 Searching and Monitoring Logs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-189">7.1.3 Logfile Rotation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-190">7.1.4 Journal Maintenance</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-191">7.1.5 A Closer Look at System Logging</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-192">7.2 The Structure of /etc</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-193">7.3 User Management Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-194">7.3.1 The /etc/passwd File</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-195">7.3.2 Special Users</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-196">7.3.3 The /etc/shadow File</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-197">7.3.4 Manipulating Users and Passwords</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-198">7.3.5 Working with Groups</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-199">7.4 getty and login</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-200">7.5 Setting the Time</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-201">7.5.1 Kernel Time Representation and Time Zones</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-202">7.5.2 Network Time</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-203">7.6 Scheduling Recurring Tasks with cron and Timer Units</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-204">7.6.1 Installing Crontab Files</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-205">7.6.2 System Crontab Files</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-206">7.6.3 Timer Units</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-207">7.6.4 cron vs. Timer Units</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-208">7.7 Scheduling One-Time Tasks with at</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-209">7.7.1 Timer Unit Equivalents</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-210">7.8 Timer Units Running as Regular Users</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-211">7.9 User Access Topics</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-212">7.9.1 User IDs and User Switching</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-213">7.9.2 Process Ownership, Effective UID, Real UID, and Saved UID</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-214">7.9.3 User Identification, Authentication, and Authorization</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-215">7.9.4 Using Libraries for User Information</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-216">7.10 Pluggable Authentication Modules</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-217">7.10.1 PAM Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-218">7.10.2 Tips on PAM Configuration Syntax</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-219">7.10.3 PAM and Passwords</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-220">7.11 Looking Forward</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-221">Chapter 8: A Closer Look at Processes and Resource Utilization</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-222">8.1 Tracking Processes</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-223">8.2 Finding Open Files with lsof</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-224">8.2.1 Reading the lsof Output</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-225">8.2.2 Using lsof</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-226">8.3 Tracing Program Execution and System Calls</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-227">8.3.1 strace</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-228">8.3.2 ltrace</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-229">8.4 Threads</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-230">8.4.1 Single-Threaded and Multithreaded Processes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-231">8.4.2 Viewing Threads</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-232">8.5.1 Measuring CPU Time</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-233">8.5.2 Adjusting Process Priorities</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-234">8.5.3 Measuring CPU Performance with Load Averages</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-235">8.5.4 Monitoring Memory Status</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-236">8.5.5 Monitoring CPU and Memory Performance with vmstat</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-237">8.5.6 I/O Monitoring</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-238">8.5.7 Per-Process Monitoring with pidstat</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-239">8.6 Control Groups (cgroups)</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-240">8.6.1 Differentiating Between cgroup Versions</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-241">8.6.2 Viewing cgroups</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-242">8.6.3 Manipulating and Creating cgroups</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-243">8.6.4 Viewing Resource Utilization</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-244">8.7 Further Topics</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-245">Chapter 9: Understanding Your Network and Its Configuration</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-246">9.1 Network Basics</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-247">9.2 Packets</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-248">9.3 Network Layers</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-249">9.4 The Internet Layer</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-250">9.4.1 Viewing IP Addresses</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-251">9.4.2 Subnets</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-252">9.4.3 Common Subnet Masks and CIDR Notation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-253">9.5 Routes and the Kernel Routing Table</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-254">9.6 The Default Gateway</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-255">9.7 IPv6 Addresses and Networks</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-256">9.7.1 Viewing IPv6 Configuration on Your System</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-257">9.7.2 Configuring Dual-Stack Networks</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-258">9.8 Basic ICMP and DNS Tools</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-259">9.8.1 ping</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-260">9.8.2 DNS and host</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-261">9.9 The Physical Layer and Ethernet</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-262">9.10 Understanding Kernel Network Interfaces</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-263">9.11.1 Manually Configuring Interfaces</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-264">9.11.2 Manually Adding and Deleting Routes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-265">9.12 Boot-Activated Network Configuration</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-266">9.13 Problems with Manual and Boot-Activated Network Configuration</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-267">9.14 Network Configuration Managers</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-268">9.14.1 NetworkManager Operation</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-269">9.14.2 NetworkManager Interaction</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-270">9.14.3 NetworkManager Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-271">9.15 Resolving Hostnames</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-272">9.15.1 /etc/hosts</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-273">9.15.2 resolv.conf</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-274">9.15.3 Caching and Zero-Configuration DNS</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-275">9.15.4 /etc/nsswitch.conf</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-276">9.16 Localhost</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-277">9.17 The Transport Layer: TCP, UDP, and Services</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-278">9.17.1 TCP Ports and Connections</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-279">9.17.2 UDP</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-280">9.18 Revisiting a Simple Local Network</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-281">9.19 Understanding DHCP</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-282">9.19.1 Linux DHCP Clients</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-283">9.19.2 Linux DHCP Servers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-284">9.20 Automatic IPv6 Network Configuration</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-285">9.21 Configuring Linux as a Router</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-286">9.22 Private Networks (IPv4)</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-287">9.23 Network Address Translation (IP Masquerading)</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-288">9.24 Routers and Linux</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-289">9.25 Firewalls</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-290">9.25.1 Linux Firewall Basics</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-291">9.25.2 Setting Firewall Rules</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-292">9.25.3 Firewall Strategies</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-293">9.26 Ethernet, IP, ARP, and NDP</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-294">9.27 Wireless Ethernet</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-295">9.27.1 iw</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-296">9.27.2 Wireless Security</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-297">9.28 Summary</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-298">Chapter 10: Network Applications and Services</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-299">10.1 The Basics of Services</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-300">10.2 A Closer Look</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-301">10.3 Network Servers</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-302">10.3.1 Secure Shell</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-303">10.3.2 The sshd Server</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-304">10.3.3 fail2ban</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-305">10.3.4 The SSH Client</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-306">10.4 Pre-systemd Network Connection Servers: inetd/xinetd</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-307">10.5 Diagnostic Tools</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-308">10.5.1 lsof</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-309">10.5.2 tcpdump</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-310">10.5.3 netcat</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-311">10.5.4 Port Scanning</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-312">10.6 Remote Procedure Calls</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-313">10.7 Network Security</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-314">10.7.1 Typical Vulnerabilities</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-315">10.7.2 Security Resources</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-316">10.8 Looking Forward</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-317">10.9 Network Sockets</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-318">10.10 Unix Domain Sockets</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-319">Chapter 11: Introduction to Shell Scripts</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-320">11.1 Shell Script Basics</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-321">11.1.1 Limitations of Shell Scripts</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-322">11.2 Quoting and Literals</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-323">11.2.1 Literals</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-324">11.2.2 Single Quotes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-325">11.2.3 Double Quotes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-326">11.2.4 Literal Single Quotes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-327">11.3 Special Variables</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-328">11.3.1 Individual Arguments: $1, $2, and So On</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-329">11.3.2 Number of Arguments: $#</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-330">11.3.3 All Arguments: $@</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-331">11.3.4 Script Name: $0</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-332">11.3.5 Process ID: $$</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-333">11.3.6 Exit Code: $?</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-334">11.4 Exit Codes</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-335">11.5 Conditionals</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-336">11.5.1 A Workaround for Empty Parameter Lists</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-337">11.5.2 Other Commands for Tests</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-338">11.5.3 elif</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-339">11.5.4 Logical Constructs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-340">11.5.5 Testing Conditions</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-341">11.5.6 case</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-342">11.6 Loops</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-343">11.6.1 for Loops</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-344">11.6.2 while Loops</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-345">11.7 Command Substitution</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-346">11.8 Temporary File Management</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-347">11.9 Here Documents</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-348">11.10 Important Shell Script Utilities</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-349">11.10.1 basename</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-350">11.10.2 awk</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-351">11.10.3 sed</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-352">11.10.4 xargs</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-353">11.10.5 expr</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-354">11.10.6 exec</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-355">11.11 Subshells</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-356">11.12 Including Other Files in Scripts</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-357">11.13 Reading User Input</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-358">11.14 When (Not) to Use Shell Scripts</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-359">Chapter 12: Network File Transfer and Sharing</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-360">12.1 Quick Copy</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-361">12.2 rsync</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-362">12.2.1 Getting Started with rsync</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-363">12.2.2 Making Exact Copies of a Directory Structure</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-364">12.2.3 Using the Trailing Slash</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-365">12.2.4 Excluding Files and Directories</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-366">12.2.5 Checking Transfers, Adding Safeguards, and Using Verbose Mode</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-367">12.2.6 Compressing Data</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-368">12.2.7 Limiting Bandwidth</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-369">12.2.8 Transferring Files to Your Computer</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-370">12.2.9 Further rsync Topics</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-371">12.3.1 File Sharing Usage and Performance</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-372">12.3.2 File Sharing Security</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-373">12.4 Sharing Files with Samba</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-374">12.4.1 Server Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-375">12.4.2 Server Access Control</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-376">12.4.3 Passwords</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-377">12.4.4 Manual Server Startup</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-378">12.4.5 Diagnostics and Logfiles</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-379">12.4.6 File Share Configuration</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-380">12.4.7 Home Directories</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-381">12.4.8 Printer Sharing</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-382">12.4.9 The Samba Client</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-383">12.5 SSHFS</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-384">12.6 NFS</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-385">12.7 Cloud Storage</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-386">12.8 The State of Network File Sharing</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-387">Chapter 13: User Environments</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-388">13.1 Guidelines for Creating Startup Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-389">13.2 When to Alter Startup Files</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-390">13.3 Shell Startup File Elements</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-391">13.3.1 The Command Path</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-392">13.3.2 The Manual Page Path</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-393">13.3.3 The Prompt</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-394">13.3.4 Aliases</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-395">13.3.5 The Permissions Mask</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-396">13.4 Startup File Order and Examples</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-397">13.4.1 The bash Shell</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-398">13.4.2 The tcsh Shell</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-399">13.5 Default User Settings</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-400">13.5.1 Shell Defaults</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-401">13.5.2 Editor</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-402">13.5.3 Pager</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-403">13.6 Startup File Pitfalls</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-404">13.7 Further Startup Topics</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-405">Chapter 14: A Brief Survey of the Linux Desktop and Printing</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-406">14.1 Desktop Components</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-407">14.1.1 Framebuffers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-408">14.1.2 The X Window System</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-409">14.1.3 Wayland</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-410">14.1.4 Window Managers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-411">14.1.5 Toolkits</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-412">14.1.6 Desktop Environments</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-413">14.1.7 Applications</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-414">14.2 Are You Running Wayland or X?</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-415">14.3 A Closer Look at Wayland</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-416">14.3.1 The Compositing Window Manager</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-417">14.3.2 libinput</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-418">14.3.3 X Compatibility in Wayland</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-419">14.4 A Closer Look at the X Window System</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-420">14.4.1 Display Managers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-421">14.4.2 Network Transparency</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-422">14.4.3 Ways of Exploring X Clients</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-423">14.4.4 X Events</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-424">14.4.5 X Input and Preference Settings</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-425">14.5 D-Bus</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-426">14.5.1 System and Session Instances</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-427">14.5.2 D-Bus Message Monitoring</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-428">14.6 Printing</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-429">14.6.1 CUPS</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-430">14.6.2 Format Conversion and Print Filters</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-431">14.7 Other Desktop Topics</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-432">Chapter 15: Development Tools</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-433">15.1 The C Compiler</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-434">15.1.1 Compiling Multiple Source Files</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-435">15.1.2 Linking with Libraries</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-436">15.1.3 Working with Shared Libraries</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-437">15.1.4 Working with Header (Include) Files and Directories</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-438">15.2 make</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-439">15.2.1 A Sample Makefile</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-440">15.2.2 Built-in Rules</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-441">15.2.3 Final Program Build</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-442">15.2.4 Dependency Updates</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-443">15.2.5 Command-Line Arguments and Options</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-444">15.2.6 Standard Macros and Variables</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-445">15.2.7 Conventional Targets</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-446">15.2.8 Makefile Organization</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-447">15.3 Lex and Yacc</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-448">15.4 Scripting Languages</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-449">15.4.1 Python</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-450">15.4.2 Perl</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-451">15.4.3 Other Scripting Languages</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-452">15.5 Java</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-453">15.6 Looking Forward: Compiling Packages</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-454">Chapter 16: Introduction to Compiling Software from C Source Code</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-455">16.1 Software Build Systems</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-456">16.2 Unpacking C Source Packages</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-457">16.3 GNU Autoconf</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-458">16.3.1 An Autoconf Example</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-459">16.3.2 Installation Using a Packaging Tool</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-460">16.3.3 configure Script Options</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-461">16.3.4 Environment Variables</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-462">16.3.5 Autoconf Targets</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-463">16.3.6 Autoconf Logfiles</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-464">16.3.7 pkg-config</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-465">16.4 Installation Practice</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-466">16.4.1 Where to Install</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-467">16.5 Applying a Patch</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-468">16.6 Troubleshooting Compiles and Installations</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-469">16.6.1 Specific Errors</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-470">16.7 Looking Forward</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-471">Chapter 17: Virtualization</a></p><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-472">17.1 Virtual Machines</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-473">17.1.1 Hypervisors</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-474">17.1.2 Hardware in a Virtual Machine</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-475">17.1.3 Common Uses of Virtual Machines</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-476">17.1.4 Drawbacks of Virtual Machines</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-477">17.2 Containers</a></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-478">17.2.1 Docker, Podman, and Privileges</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-479">17.2.2 A Docker Example</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-480">17.2.3 LXC</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-481">17.2.4 Kubernetes</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-482">17.2.5 Pitfalls of Containers</a></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="calibre2"><blockquote class="calibre_12"><a href="#calibre_link-483">17.3 Runtime-Based Virtualization</a></blockquote></blockquote><p class="calibre_111"><a href="#calibre_link-484">Index</a></p><div class="mbp_pagebreak"></div><a></a>
<a></a>
<a></a></div>

</body></html>