<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>LinuxÂ® Command Line and Shell Scripting Bible</title></head><body><div type="frontmatter" class="calibre1" id="calibre_link-117">
<nav class="toclist" type="toc" id="calibre_link-1065">
<h1 class="calibre2">Table of Contents</h1>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-118" class="calibre4">Introduction</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-119" class="calibre4">Who Should Read This Book</a></li>
<li class="contentsh"><a href="#calibre_link-120" class="calibre4">How This Book Is Organized</a></li>
<li class="contentsh"><a href="#calibre_link-121" class="calibre4">Minimum Requirements</a></li>
<li class="contentsh"><a href="#calibre_link-122" class="calibre4">Where to Go from Here</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-123" class="calibre4">Part I: The Linux Command Line</a></li>
<li class="contentsh"><a href="#calibre_link-124" class="calibre4">Chapter 1: Starting with Linux Shells</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-125" class="calibre4">What Is Linux?</a></li>
<li class="contentsh"><a href="#calibre_link-126" class="calibre4">Linux Distributions</a></li>
<li class="contentsh"><a href="#calibre_link-127" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-128" class="calibre4">Chapter 2: Getting to the Shell</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-129" class="calibre4">Reaching the Command Line</a></li>
<li class="contentsh"><a href="#calibre_link-130" class="calibre4">Accessing CLI via a Linux Console Terminal</a></li>
<li class="contentsh"><a href="#calibre_link-131" class="calibre4">Accessing CLI via Graphical Terminal Emulation</a></li>
<li class="contentsh"><a href="#calibre_link-132" class="calibre4">Using the GNOME Terminal Emulator</a></li>
<li class="contentsh"><a href="#calibre_link-133" class="calibre4">Using the Konsole Terminal Emulator</a></li>
<li class="contentsh"><a href="#calibre_link-134" class="calibre4">Using the xterm Terminal Emulator</a></li>
<li class="contentsh"><a href="#calibre_link-135" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-136" class="calibre4">Chapter 3: Basic bash Shell Commands</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-137" class="calibre4">Starting the Shell</a></li>
<li class="contentsh"><a href="#calibre_link-138" class="calibre4">Using the Shell Prompt</a></li>
<li class="contentsh"><a href="#calibre_link-139" class="calibre4">Interacting with the bash Manual</a></li>
<li class="contentsh"><a href="#calibre_link-140" class="calibre4">Navigating the Filesystem</a></li>
<li class="contentsh"><a href="#calibre_link-141" class="calibre4">Listing Files and Directories</a></li>
<li class="contentsh"><a href="#calibre_link-142" class="calibre4">Handling Files</a></li>
<li class="contentsh"><a href="#calibre_link-143" class="calibre4">Managing Directories</a></li>
<li class="contentsh"><a href="#calibre_link-144" class="calibre4">Viewing File Contents</a></li>
<li class="contentsh"><a href="#calibre_link-145" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-146" class="calibre4">Chapter 4: More bash Shell Commands</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-147" class="calibre4">Monitoring Programs</a></li>
<li class="contentsh"><a href="#calibre_link-148" class="calibre4">Monitoring Disk Space</a></li>
<li class="contentsh"><a href="#calibre_link-149" class="calibre4">Working with Data Files</a></li>
<li class="contentsh"><a href="#calibre_link-150" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-151" class="calibre4">Chapter 5: Understanding the Shell</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-152" class="calibre4">Exploring Shell Types</a></li>
<li class="contentsh"><a href="#calibre_link-153" class="calibre4">Exploring Parent and Child Shell Relationships</a></li>
<li class="contentsh"><a href="#calibre_link-154" class="calibre4">Understanding Shell Built-In Commands</a></li>
<li class="contentsh"><a href="#calibre_link-155" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-156" class="calibre4">Chapter 6: Using Linux Environment Variables</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-157" class="calibre4">Exploring Environment Variables</a></li>
<li class="contentsh"><a href="#calibre_link-158" class="calibre4">Setting User-Defined Variables</a></li>
<li class="contentsh"><a href="#calibre_link-159" class="calibre4">Removing Environment Variables</a></li>
<li class="contentsh"><a href="#calibre_link-160" class="calibre4">Uncovering Default Shell Environment Variables</a></li>
<li class="contentsh"><a href="#calibre_link-161" class="calibre4">Setting the PATH Environment Variable</a></li>
<li class="contentsh"><a href="#calibre_link-162" class="calibre4">Locating System Environment Variables</a></li>
<li class="contentsh"><a href="#calibre_link-163" class="calibre4">Learning about Variable Arrays</a></li>
<li class="contentsh"><a href="#calibre_link-164" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-165" class="calibre4">Chapter 7: Understanding Linux File Permissions</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-166" class="calibre4">Linux Security</a></li>
<li class="contentsh"><a href="#calibre_link-167" class="calibre4">Using Linux Groups</a></li>
<li class="contentsh"><a href="#calibre_link-168" class="calibre4">Decoding File Permissions</a></li>
<li class="contentsh"><a href="#calibre_link-169" class="calibre4">Changing Security Settings</a></li>
<li class="contentsh"><a href="#calibre_link-170" class="calibre4">Sharing Files</a></li>
<li class="contentsh"><a href="#calibre_link-171" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-172" class="calibre4">Chapter 8: Managing Filesystems</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-173" class="calibre4">Exploring Linux Filesystems</a></li>
<li class="contentsh"><a href="#calibre_link-174" class="calibre4">Working with Filesystems</a></li>
<li class="contentsh"><a href="#calibre_link-175" class="calibre4">Managing Logical Volumes</a></li>
<li class="contentsh"><a href="#calibre_link-176" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-177" class="calibre4">Chapter 9: Installing Software</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-178" class="calibre4">Package Management Primer</a></li>
<li class="contentsh"><a href="#calibre_link-179" class="calibre4">The Debian-Based Systems</a></li>
<li class="contentsh"><a href="#calibre_link-180" class="calibre4">The Red Hat&ndash;Based Systems</a></li>
<li class="contentsh"><a href="#calibre_link-181" class="calibre4">Installing from Source Code</a></li>
<li class="contentsh"><a href="#calibre_link-182" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-183" class="calibre4">Chapter 10: Working with Editors</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-184" class="calibre4">Visiting the vim Editor</a></li>
<li class="contentsh"><a href="#calibre_link-185" class="calibre4">Navigating the nano Editor</a></li>
<li class="contentsh"><a href="#calibre_link-186" class="calibre4">Exploring the emacs Editor</a></li>
<li class="contentsh"><a href="#calibre_link-187" class="calibre4">Exploring the KDE Family of Editors</a></li>
<li class="contentsh"><a href="#calibre_link-188" class="calibre4">Exploring the GNOME Editor</a></li>
<li class="contentsh"><a href="#calibre_link-189" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-190" class="calibre4">Part II: Shell Scripting Basics</a></li>
<li class="contentsh"><a href="#calibre_link-191" class="calibre4">Chapter 11: Basic Script Building</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-192" class="calibre4">Using Multiple Commands</a></li>
<li class="contentsh"><a href="#calibre_link-193" class="calibre4">Creating a Script File</a></li>
<li class="contentsh"><a href="#calibre_link-194" class="calibre4">Displaying Messages</a></li>
<li class="contentsh"><a href="#calibre_link-195" class="calibre4">Using Variables</a></li>
<li class="contentsh"><a href="#calibre_link-196" class="calibre4">Redirecting Input and Output</a></li>
<li class="contentsh"><a href="#calibre_link-197" class="calibre4">Pipes</a></li>
<li class="contentsh"><a href="#calibre_link-198" class="calibre4">Performing Math</a></li>
<li class="contentsh"><a href="#calibre_link-199" class="calibre4">Exiting the Script</a></li>
<li class="contentsh"><a href="#calibre_link-200" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-201" class="calibre4">Chapter 12: Using Structured Commands</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-202" class="calibre4">Working with the if-then Statement</a></li>
<li class="contentsh"><a href="#calibre_link-203" class="calibre4">Exploring the if-then-else Statement</a></li>
<li class="contentsh"><a href="#calibre_link-204" class="calibre4">Nesting ifs</a></li>
<li class="contentsh"><a href="#calibre_link-205" class="calibre4">Trying the test Command</a></li>
<li class="contentsh"><a href="#calibre_link-206" class="calibre4">Considering Compound Testing</a></li>
<li class="contentsh"><a href="#calibre_link-207" class="calibre4">Working with Advanced if-then Features</a></li>
<li class="contentsh"><a href="#calibre_link-208" class="calibre4">Considering the case Command</a></li>
<li class="contentsh"><a href="#calibre_link-209" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-210" class="calibre4">Chapter 13: More Structured Commands</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-211" class="calibre4">The for Command</a></li>
<li class="contentsh"><a href="#calibre_link-212" class="calibre4">The C-Style for Command</a></li>
<li class="contentsh"><a href="#calibre_link-213" class="calibre4">The while Command</a></li>
<li class="contentsh"><a href="#calibre_link-214" class="calibre4">The until Command</a></li>
<li class="contentsh"><a href="#calibre_link-215" class="calibre4">Nesting Loops</a></li>
<li class="contentsh"><a href="#calibre_link-216" class="calibre4">Looping on File Data</a></li>
<li class="contentsh"><a href="#calibre_link-217" class="calibre4">Controlling the Loop</a></li>
<li class="contentsh"><a href="#calibre_link-218" class="calibre4">Processing the Output of a Loop</a></li>
<li class="contentsh"><a href="#calibre_link-219" class="calibre4">Practical Examples</a></li>
<li class="contentsh"><a href="#calibre_link-220" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-221" class="calibre4">Chapter 14: Handling User Input</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-222" class="calibre4">Passing Parameters</a></li>
<li class="contentsh"><a href="#calibre_link-223" class="calibre4">Using Special Parameter Variables</a></li>
<li class="contentsh"><a href="#calibre_link-224" class="calibre4">Being Shifty</a></li>
<li class="contentsh"><a href="#calibre_link-225" class="calibre4">Working with Options</a></li>
<li class="contentsh"><a href="#calibre_link-226" class="calibre4">Standardizing Options</a></li>
<li class="contentsh"><a href="#calibre_link-227" class="calibre4">Getting User Input</a></li>
<li class="contentsh"><a href="#calibre_link-228" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-229" class="calibre4">Chapter 15: Presenting Data</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-230" class="calibre4">Understanding Input and Output</a></li>
<li class="contentsh"><a href="#calibre_link-231" class="calibre4">Redirecting Output in Scripts</a></li>
<li class="contentsh"><a href="#calibre_link-232" class="calibre4">Redirecting Input in Scripts</a></li>
<li class="contentsh"><a href="#calibre_link-233" class="calibre4">Creating Your Own Redirection</a></li>
<li class="contentsh"><a href="#calibre_link-234" class="calibre4">Listing Open File Descriptors</a></li>
<li class="contentsh"><a href="#calibre_link-235" class="calibre4">Suppressing Command Output</a></li>
<li class="contentsh"><a href="#calibre_link-236" class="calibre4">Using Temporary Files</a></li>
<li class="contentsh"><a href="#calibre_link-237" class="calibre4">Logging Messages</a></li>
<li class="contentsh"><a href="#calibre_link-238" class="calibre4">Practical Example</a></li>
<li class="contentsh"><a href="#calibre_link-239" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-240" class="calibre4">Chapter 16: Script Control</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-241" class="calibre4">Handling Signals</a></li>
<li class="contentsh"><a href="#calibre_link-242" class="calibre4">Running Scripts in Background Mode</a></li>
<li class="contentsh"><a href="#calibre_link-243" class="calibre4">Running Scripts without a Hang-Up</a></li>
<li class="contentsh"><a href="#calibre_link-244" class="calibre4">Controlling the Job</a></li>
<li class="contentsh"><a href="#calibre_link-245" class="calibre4">Being Nice</a></li>
<li class="contentsh"><a href="#calibre_link-246" class="calibre4">Running Like Clockwork</a></li>
<li class="contentsh"><a href="#calibre_link-247" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-87" class="calibre4">Part III: Advanced Shell Scripting</a></li>
<li class="contentsh"><a href="#calibre_link-248" class="calibre4">Chapter 17: Creating Functions</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-249" class="calibre4">Basic Script Functions</a></li>
<li class="contentsh"><a href="#calibre_link-250" class="calibre4">Returning a Value</a></li>
<li class="contentsh"><a href="#calibre_link-251" class="calibre4">Using Variables in Functions</a></li>
<li class="contentsh"><a href="#calibre_link-252" class="calibre4">Array Variables and Functions</a></li>
<li class="contentsh"><a href="#calibre_link-253" class="calibre4">Function Recursion</a></li>
<li class="contentsh"><a href="#calibre_link-254" class="calibre4">Creating a Library</a></li>
<li class="contentsh"><a href="#calibre_link-255" class="calibre4">Using Functions on the Command Line</a></li>
<li class="contentsh"><a href="#calibre_link-256" class="calibre4">Following a Practical Example</a></li>
<li class="contentsh"><a href="#calibre_link-257" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-258" class="calibre4">Chapter 18: Writing Scripts for Graphical Desktops</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-259" class="calibre4">Creating Text Menus</a></li>
<li class="contentsh"><a href="#calibre_link-260" class="calibre4">Doing Windows</a></li>
<li class="contentsh"><a href="#calibre_link-261" class="calibre4">Getting Graphic</a></li>
<li class="contentsh"><a href="#calibre_link-262" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-263" class="calibre4">Chapter 19: Introducing sed and gawk</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-264" class="calibre4">Manipulating Text</a></li>
<li class="contentsh"><a href="#calibre_link-265" class="calibre4">Commanding at the sed Editor Basics</a></li>
<li class="contentsh"><a href="#calibre_link-266" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-267" class="calibre4">Chapter 20: Regular Expressions</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-268" class="calibre4">What Are Regular Expressions?</a></li>
<li class="contentsh"><a href="#calibre_link-269" class="calibre4">Defining BRE Patterns</a></li>
<li class="contentsh"><a href="#calibre_link-270" class="calibre4">Extended Regular Expressions</a></li>
<li class="contentsh"><a href="#calibre_link-271" class="calibre4">Regular Expressions in Action</a></li>
<li class="contentsh"><a href="#calibre_link-272" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-273" class="calibre4">Chapter 21: Advanced sed</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-274" class="calibre4">Looking at Multiline Commands</a></li>
<li class="contentsh"><a href="#calibre_link-275" class="calibre4">Holding Space</a></li>
<li class="contentsh"><a href="#calibre_link-276" class="calibre4">Negating a Command</a></li>
<li class="contentsh"><a href="#calibre_link-277" class="calibre4">Changing the Flow</a></li>
<li class="contentsh"><a href="#calibre_link-278" class="calibre4">Replacing via a Pattern</a></li>
<li class="contentsh"><a href="#calibre_link-279" class="calibre4">Placing sed Commands in Scripts</a></li>
<li class="contentsh"><a href="#calibre_link-280" class="calibre4">Creating sed Utilities</a></li>
<li class="contentsh"><a href="#calibre_link-281" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-282" class="calibre4">Chapter 22: Advanced gawk</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-283" class="calibre4">Using Variables</a></li>
<li class="contentsh"><a href="#calibre_link-284" class="calibre4">Working with Arrays</a></li>
<li class="contentsh"><a href="#calibre_link-285" class="calibre4">Using Patterns</a></li>
<li class="contentsh"><a href="#calibre_link-286" class="calibre4">Structured Commands</a></li>
<li class="contentsh"><a href="#calibre_link-287" class="calibre4">Formatted Printing</a></li>
<li class="contentsh"><a href="#calibre_link-288" class="calibre4">Built-In Functions</a></li>
<li class="contentsh"><a href="#calibre_link-289" class="calibre4">User-Defined Functions</a></li>
<li class="contentsh"><a href="#calibre_link-290" class="calibre4">Working through a Practical Example</a></li>
<li class="contentsh"><a href="#calibre_link-291" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-292" class="calibre4">Chapter 23: Working with Alternative Shells</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-293" class="calibre4">What Is the dash Shell?</a></li>
<li class="contentsh"><a href="#calibre_link-294" class="calibre4">The dash Shell Features</a></li>
<li class="contentsh"><a href="#calibre_link-295" class="calibre4">Scripting in dash</a></li>
<li class="contentsh"><a href="#calibre_link-296" class="calibre4">The zsh Shell</a></li>
<li class="contentsh"><a href="#calibre_link-297" class="calibre4">Parts of the zsh Shell</a></li>
<li class="contentsh"><a href="#calibre_link-298" class="calibre4">Scripting with zsh</a></li>
<li class="contentsh"><a href="#calibre_link-299" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-300" class="calibre4">Part IV: Creating Practical Scripts</a></li>
<li class="contentsh"><a href="#calibre_link-301" class="calibre4">Chapter 24: Writing Simple Script Utilities</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-302" class="calibre4">Performing Archives</a></li>
<li class="contentsh"><a href="#calibre_link-303" class="calibre4">Managing User Accounts</a></li>
<li class="contentsh"><a href="#calibre_link-304" class="calibre4">Monitoring Disk Space</a></li>
<li class="contentsh"><a href="#calibre_link-305" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-306" class="calibre4">Chapter 25: Producing Scripts for Database, Web, and E-Mail</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-307" class="calibre4">Using a MySQL Database</a></li>
<li class="contentsh"><a href="#calibre_link-308" class="calibre4">Using the Web</a></li>
<li class="contentsh"><a href="#calibre_link-309" class="calibre4">Using E-Mail</a></li>
<li class="contentsh"><a href="#calibre_link-310" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-311" class="calibre4">Chapter 26: Creating Fun Little Shell Scripts</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-312" class="calibre4">Sending a Message</a></li>
<li class="contentsh"><a href="#calibre_link-313" class="calibre4">Obtaining a Quote</a></li>
<li class="contentsh"><a href="#calibre_link-314" class="calibre4">Generating an Excuse</a></li>
<li class="contentsh"><a href="#calibre_link-315" class="calibre4">Summary</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-316" class="calibre4">Appendix A: Quick Guide to bash Commands</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-317" class="calibre4">Reviewing Built-In Commands</a></li>
<li class="contentsh"><a href="#calibre_link-318" class="calibre4">Looking at Common bash Commands</a></li>
<li class="contentsh"><a href="#calibre_link-319" class="calibre4">Assessing Environment Variables</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-320" class="calibre4">Appendix B: Quick Guide to sed and gawk</a>
<ol class="calibre3">
<li class="contentsh"><a href="#calibre_link-321" class="calibre4">The sed Editor</a></li>
<li class="contentsh"><a href="#calibre_link-322" class="calibre4">The gawk Program</a></li>
</ol>
</li>
<li class="contentsh"><a href="#calibre_link-323" class="calibre4">End User License Agreement</a></li>
</ol>
</nav>
<nav class="pagelist" type="page-list" id="calibre_link-1298" hidden="hidden">
<h2 class="calibre5">Pages</h2>
<ol class="calibre6">
<li class="calibre7"><a href="#calibre_link-324" class="calibre4">739</a></li>
<li class="calibre7"><a href="#calibre_link-325" class="calibre4">740</a></li>
<li class="calibre7"><a href="#calibre_link-326" class="calibre4">741</a></li>
<li class="calibre7"><a href="#calibre_link-327" class="calibre4">742</a></li>
<li class="calibre7"><a href="#calibre_link-328" class="calibre4">743</a></li>
<li class="calibre7"><a href="#calibre_link-329" class="calibre4">744</a></li>
<li class="calibre7"><a href="#calibre_link-330" class="calibre4">745</a></li>
<li class="calibre7"><a href="#calibre_link-331" class="calibre4">746</a></li>
<li class="calibre7"><a href="#calibre_link-332" class="calibre4">747</a></li>
<li class="calibre7"><a href="#calibre_link-333" class="calibre4">748</a></li>
<li class="calibre7"><a href="#calibre_link-334" class="calibre4">749</a></li>
<li class="calibre7"><a href="#calibre_link-335" class="calibre4">751</a></li>
<li class="calibre7"><a href="#calibre_link-336" class="calibre4">752</a></li>
<li class="calibre7"><a href="#calibre_link-337" class="calibre4">753</a></li>
<li class="calibre7"><a href="#calibre_link-338" class="calibre4">754</a></li>
<li class="calibre7"><a href="#calibre_link-339" class="calibre4">755</a></li>
<li class="calibre7"><a href="#calibre_link-340" class="calibre4">756</a></li>
<li class="calibre7"><a href="#calibre_link-341" class="calibre4">757</a></li>
<li class="calibre7"><a href="#calibre_link-342" class="calibre4">758</a></li>
<li class="calibre7"><a href="#calibre_link-343" class="calibre4">759</a></li>
<li class="calibre7"><a href="#calibre_link-344" class="calibre4">760</a></li>
<li class="calibre7"><a href="#calibre_link-345" class="calibre4">761</a></li>
<li class="calibre7"><a href="#calibre_link-346" class="calibre4">762</a></li>
<li class="calibre7"><a href="#calibre_link-347" class="calibre4">3</a></li>
<li class="calibre7"><a href="#calibre_link-348" class="calibre4">4</a></li>
<li class="calibre7"><a href="#calibre_link-349" class="calibre4">5</a></li>
<li class="calibre7"><a href="#calibre_link-350" class="calibre4">6</a></li>
<li class="calibre7"><a href="#calibre_link-351" class="calibre4">7</a></li>
<li class="calibre7"><a href="#calibre_link-352" class="calibre4">8</a></li>
<li class="calibre7"><a href="#calibre_link-353" class="calibre4">9</a></li>
<li class="calibre7"><a href="#calibre_link-354" class="calibre4">10</a></li>
<li class="calibre7"><a href="#calibre_link-355" class="calibre4">11</a></li>
<li class="calibre7"><a href="#calibre_link-356" class="calibre4">12</a></li>
<li class="calibre7"><a href="#calibre_link-357" class="calibre4">13</a></li>
<li class="calibre7"><a href="#calibre_link-358" class="calibre4">14</a></li>
<li class="calibre7"><a href="#calibre_link-359" class="calibre4">15</a></li>
<li class="calibre7"><a href="#calibre_link-360" class="calibre4">16</a></li>
<li class="calibre7"><a href="#calibre_link-361" class="calibre4">17</a></li>
<li class="calibre7"><a href="#calibre_link-362" class="calibre4">18</a></li>
<li class="calibre7"><a href="#calibre_link-363" class="calibre4">19</a></li>
<li class="calibre7"><a href="#calibre_link-364" class="calibre4">20</a></li>
<li class="calibre7"><a href="#calibre_link-365" class="calibre4">21</a></li>
<li class="calibre7"><a href="#calibre_link-366" class="calibre4">23</a></li>
<li class="calibre7"><a href="#calibre_link-367" class="calibre4">24</a></li>
<li class="calibre7"><a href="#calibre_link-368" class="calibre4">25</a></li>
<li class="calibre7"><a href="#calibre_link-369" class="calibre4">26</a></li>
<li class="calibre7"><a href="#calibre_link-370" class="calibre4">27</a></li>
<li class="calibre7"><a href="#calibre_link-371" class="calibre4">28</a></li>
<li class="calibre7"><a href="#calibre_link-372" class="calibre4">29</a></li>
<li class="calibre7"><a href="#calibre_link-373" class="calibre4">30</a></li>
<li class="calibre7"><a href="#calibre_link-374" class="calibre4">31</a></li>
<li class="calibre7"><a href="#calibre_link-375" class="calibre4">32</a></li>
<li class="calibre7"><a href="#calibre_link-376" class="calibre4">33</a></li>
<li class="calibre7"><a href="#calibre_link-377" class="calibre4">34</a></li>
<li class="calibre7"><a href="#calibre_link-378" class="calibre4">35</a></li>
<li class="calibre7"><a href="#calibre_link-379" class="calibre4">36</a></li>
<li class="calibre7"><a href="#calibre_link-380" class="calibre4">37</a></li>
<li class="calibre7"><a href="#calibre_link-381" class="calibre4">38</a></li>
<li class="calibre7"><a href="#calibre_link-382" class="calibre4">39</a></li>
<li class="calibre7"><a href="#calibre_link-383" class="calibre4">40</a></li>
<li class="calibre7"><a href="#calibre_link-384" class="calibre4">41</a></li>
<li class="calibre7"><a href="#calibre_link-385" class="calibre4">42</a></li>
<li class="calibre7"><a href="#calibre_link-386" class="calibre4">43</a></li>
<li class="calibre7"><a href="#calibre_link-387" class="calibre4">44</a></li>
<li class="calibre7"><a href="#calibre_link-388" class="calibre4">45</a></li>
<li class="calibre7"><a href="#calibre_link-389" class="calibre4">47</a></li>
<li class="calibre7"><a href="#calibre_link-390" class="calibre4">48</a></li>
<li class="calibre7"><a href="#calibre_link-391" class="calibre4">49</a></li>
<li class="calibre7"><a href="#calibre_link-392" class="calibre4">50</a></li>
<li class="calibre7"><a href="#calibre_link-393" class="calibre4">51</a></li>
<li class="calibre7"><a href="#calibre_link-394" class="calibre4">52</a></li>
<li class="calibre7"><a href="#calibre_link-395" class="calibre4">53</a></li>
<li class="calibre7"><a href="#calibre_link-396" class="calibre4">54</a></li>
<li class="calibre7"><a href="#calibre_link-397" class="calibre4">55</a></li>
<li class="calibre7"><a href="#calibre_link-398" class="calibre4">56</a></li>
<li class="calibre7"><a href="#calibre_link-399" class="calibre4">57</a></li>
<li class="calibre7"><a href="#calibre_link-400" class="calibre4">58</a></li>
<li class="calibre7"><a href="#calibre_link-401" class="calibre4">59</a></li>
<li class="calibre7"><a href="#calibre_link-402" class="calibre4">60</a></li>
<li class="calibre7"><a href="#calibre_link-403" class="calibre4">61</a></li>
<li class="calibre7"><a href="#calibre_link-404" class="calibre4">62</a></li>
<li class="calibre7"><a href="#calibre_link-405" class="calibre4">63</a></li>
<li class="calibre7"><a href="#calibre_link-406" class="calibre4">64</a></li>
<li class="calibre7"><a href="#calibre_link-407" class="calibre4">65</a></li>
<li class="calibre7"><a href="#calibre_link-408" class="calibre4">66</a></li>
<li class="calibre7"><a href="#calibre_link-409" class="calibre4">67</a></li>
<li class="calibre7"><a href="#calibre_link-410" class="calibre4">68</a></li>
<li class="calibre7"><a href="#calibre_link-411" class="calibre4">69</a></li>
<li class="calibre7"><a href="#calibre_link-412" class="calibre4">70</a></li>
<li class="calibre7"><a href="#calibre_link-413" class="calibre4">71</a></li>
<li class="calibre7"><a href="#calibre_link-414" class="calibre4">72</a></li>
<li class="calibre7"><a href="#calibre_link-415" class="calibre4">73</a></li>
<li class="calibre7"><a href="#calibre_link-416" class="calibre4">74</a></li>
<li class="calibre7"><a href="#calibre_link-417" class="calibre4">75</a></li>
<li class="calibre7"><a href="#calibre_link-418" class="calibre4">76</a></li>
<li class="calibre7"><a href="#calibre_link-419" class="calibre4">77</a></li>
<li class="calibre7"><a href="#calibre_link-420" class="calibre4">78</a></li>
<li class="calibre7"><a href="#calibre_link-421" class="calibre4">79</a></li>
<li class="calibre7"><a href="#calibre_link-422" class="calibre4">80</a></li>
<li class="calibre7"><a href="#calibre_link-423" class="calibre4">81</a></li>
<li class="calibre7"><a href="#calibre_link-424" class="calibre4">82</a></li>
<li class="calibre7"><a href="#calibre_link-425" class="calibre4">83</a></li>
<li class="calibre7"><a href="#calibre_link-426" class="calibre4">84</a></li>
<li class="calibre7"><a href="#calibre_link-427" class="calibre4">85</a></li>
<li class="calibre7"><a href="#calibre_link-428" class="calibre4">86</a></li>
<li class="calibre7"><a href="#calibre_link-429" class="calibre4">87</a></li>
<li class="calibre7"><a href="#calibre_link-430" class="calibre4">88</a></li>
<li class="calibre7"><a href="#calibre_link-431" class="calibre4">89</a></li>
<li class="calibre7"><a href="#calibre_link-432" class="calibre4">90</a></li>
<li class="calibre7"><a href="#calibre_link-433" class="calibre4">91</a></li>
<li class="calibre7"><a href="#calibre_link-434" class="calibre4">92</a></li>
<li class="calibre7"><a href="#calibre_link-435" class="calibre4">93</a></li>
<li class="calibre7"><a href="#calibre_link-436" class="calibre4">94</a></li>
<li class="calibre7"><a href="#calibre_link-437" class="calibre4">95</a></li>
<li class="calibre7"><a href="#calibre_link-438" class="calibre4">96</a></li>
<li class="calibre7"><a href="#calibre_link-439" class="calibre4">97</a></li>
<li class="calibre7"><a href="#calibre_link-440" class="calibre4">98</a></li>
<li class="calibre7"><a href="#calibre_link-441" class="calibre4">99</a></li>
<li class="calibre7"><a href="#calibre_link-442" class="calibre4">100</a></li>
<li class="calibre7"><a href="#calibre_link-443" class="calibre4">101</a></li>
<li class="calibre7"><a href="#calibre_link-444" class="calibre4">102</a></li>
<li class="calibre7"><a href="#calibre_link-445" class="calibre4">103</a></li>
<li class="calibre7"><a href="#calibre_link-446" class="calibre4">104</a></li>
<li class="calibre7"><a href="#calibre_link-447" class="calibre4">105</a></li>
<li class="calibre7"><a href="#calibre_link-448" class="calibre4">106</a></li>
<li class="calibre7"><a href="#calibre_link-449" class="calibre4">107</a></li>
<li class="calibre7"><a href="#calibre_link-450" class="calibre4">108</a></li>
<li class="calibre7"><a href="#calibre_link-451" class="calibre4">109</a></li>
<li class="calibre7"><a href="#calibre_link-452" class="calibre4">110</a></li>
<li class="calibre7"><a href="#calibre_link-453" class="calibre4">111</a></li>
<li class="calibre7"><a href="#calibre_link-454" class="calibre4">112</a></li>
<li class="calibre7"><a href="#calibre_link-455" class="calibre4">113</a></li>
<li class="calibre7"><a href="#calibre_link-456" class="calibre4">114</a></li>
<li class="calibre7"><a href="#calibre_link-457" class="calibre4">115</a></li>
<li class="calibre7"><a href="#calibre_link-458" class="calibre4">116</a></li>
<li class="calibre7"><a href="#calibre_link-459" class="calibre4">117</a></li>
<li class="calibre7"><a href="#calibre_link-460" class="calibre4">118</a></li>
<li class="calibre7"><a href="#calibre_link-461" class="calibre4">119</a></li>
<li class="calibre7"><a href="#calibre_link-462" class="calibre4">120</a></li>
<li class="calibre7"><a href="#calibre_link-463" class="calibre4">121</a></li>
<li class="calibre7"><a href="#calibre_link-464" class="calibre4">122</a></li>
<li class="calibre7"><a href="#calibre_link-465" class="calibre4">123</a></li>
<li class="calibre7"><a href="#calibre_link-466" class="calibre4">124</a></li>
<li class="calibre7"><a href="#calibre_link-467" class="calibre4">125</a></li>
<li class="calibre7"><a href="#calibre_link-468" class="calibre4">126</a></li>
<li class="calibre7"><a href="#calibre_link-469" class="calibre4">127</a></li>
<li class="calibre7"><a href="#calibre_link-470" class="calibre4">128</a></li>
<li class="calibre7"><a href="#calibre_link-471" class="calibre4">129</a></li>
<li class="calibre7"><a href="#calibre_link-472" class="calibre4">130</a></li>
<li class="calibre7"><a href="#calibre_link-473" class="calibre4">131</a></li>
<li class="calibre7"><a href="#calibre_link-474" class="calibre4">132</a></li>
<li class="calibre7"><a href="#calibre_link-475" class="calibre4">133</a></li>
<li class="calibre7"><a href="#calibre_link-476" class="calibre4">135</a></li>
<li class="calibre7"><a href="#calibre_link-477" class="calibre4">136</a></li>
<li class="calibre7"><a href="#calibre_link-478" class="calibre4">137</a></li>
<li class="calibre7"><a href="#calibre_link-479" class="calibre4">138</a></li>
<li class="calibre7"><a href="#calibre_link-480" class="calibre4">139</a></li>
<li class="calibre7"><a href="#calibre_link-481" class="calibre4">140</a></li>
<li class="calibre7"><a href="#calibre_link-482" class="calibre4">141</a></li>
<li class="calibre7"><a href="#calibre_link-483" class="calibre4">142</a></li>
<li class="calibre7"><a href="#calibre_link-484" class="calibre4">143</a></li>
<li class="calibre7"><a href="#calibre_link-485" class="calibre4">144</a></li>
<li class="calibre7"><a href="#calibre_link-486" class="calibre4">145</a></li>
<li class="calibre7"><a href="#calibre_link-487" class="calibre4">146</a></li>
<li class="calibre7"><a href="#calibre_link-488" class="calibre4">147</a></li>
<li class="calibre7"><a href="#calibre_link-489" class="calibre4">148</a></li>
<li class="calibre7"><a href="#calibre_link-490" class="calibre4">149</a></li>
<li class="calibre7"><a href="#calibre_link-491" class="calibre4">150</a></li>
<li class="calibre7"><a href="#calibre_link-492" class="calibre4">151</a></li>
<li class="calibre7"><a href="#calibre_link-493" class="calibre4">152</a></li>
<li class="calibre7"><a href="#calibre_link-494" class="calibre4">153</a></li>
<li class="calibre7"><a href="#calibre_link-495" class="calibre4">154</a></li>
<li class="calibre7"><a href="#calibre_link-496" class="calibre4">155</a></li>
<li class="calibre7"><a href="#calibre_link-497" class="calibre4">156</a></li>
<li class="calibre7"><a href="#calibre_link-498" class="calibre4">157</a></li>
<li class="calibre7"><a href="#calibre_link-499" class="calibre4">158</a></li>
<li class="calibre7"><a href="#calibre_link-500" class="calibre4">159</a></li>
<li class="calibre7"><a href="#calibre_link-501" class="calibre4">160</a></li>
<li class="calibre7"><a href="#calibre_link-502" class="calibre4">161</a></li>
<li class="calibre7"><a href="#calibre_link-503" class="calibre4">162</a></li>
<li class="calibre7"><a href="#calibre_link-504" class="calibre4">163</a></li>
<li class="calibre7"><a href="#calibre_link-505" class="calibre4">164</a></li>
<li class="calibre7"><a href="#calibre_link-506" class="calibre4">165</a></li>
<li class="calibre7"><a href="#calibre_link-507" class="calibre4">166</a></li>
<li class="calibre7"><a href="#calibre_link-508" class="calibre4">167</a></li>
<li class="calibre7"><a href="#calibre_link-509" class="calibre4">168</a></li>
<li class="calibre7"><a href="#calibre_link-510" class="calibre4">169</a></li>
<li class="calibre7"><a href="#calibre_link-511" class="calibre4">170</a></li>
<li class="calibre7"><a href="#calibre_link-512" class="calibre4">171</a></li>
<li class="calibre7"><a href="#calibre_link-513" class="calibre4">172</a></li>
<li class="calibre7"><a href="#calibre_link-514" class="calibre4">173</a></li>
<li class="calibre7"><a href="#calibre_link-515" class="calibre4">174</a></li>
<li class="calibre7"><a href="#calibre_link-516" class="calibre4">175</a></li>
<li class="calibre7"><a href="#calibre_link-517" class="calibre4">176</a></li>
<li class="calibre7"><a href="#calibre_link-518" class="calibre4">177</a></li>
<li class="calibre7"><a href="#calibre_link-519" class="calibre4">178</a></li>
<li class="calibre7"><a href="#calibre_link-520" class="calibre4">179</a></li>
<li class="calibre7"><a href="#calibre_link-521" class="calibre4">180</a></li>
<li class="calibre7"><a href="#calibre_link-522" class="calibre4">181</a></li>
<li class="calibre7"><a href="#calibre_link-523" class="calibre4">182</a></li>
<li class="calibre7"><a href="#calibre_link-524" class="calibre4">183</a></li>
<li class="calibre7"><a href="#calibre_link-525" class="calibre4">184</a></li>
<li class="calibre7"><a href="#calibre_link-526" class="calibre4">185</a></li>
<li class="calibre7"><a href="#calibre_link-527" class="calibre4">187</a></li>
<li class="calibre7"><a href="#calibre_link-528" class="calibre4">188</a></li>
<li class="calibre7"><a href="#calibre_link-529" class="calibre4">189</a></li>
<li class="calibre7"><a href="#calibre_link-530" class="calibre4">190</a></li>
<li class="calibre7"><a href="#calibre_link-531" class="calibre4">191</a></li>
<li class="calibre7"><a href="#calibre_link-532" class="calibre4">192</a></li>
<li class="calibre7"><a href="#calibre_link-533" class="calibre4">193</a></li>
<li class="calibre7"><a href="#calibre_link-534" class="calibre4">194</a></li>
<li class="calibre7"><a href="#calibre_link-535" class="calibre4">195</a></li>
<li class="calibre7"><a href="#calibre_link-536" class="calibre4">196</a></li>
<li class="calibre7"><a href="#calibre_link-537" class="calibre4">197</a></li>
<li class="calibre7"><a href="#calibre_link-538" class="calibre4">198</a></li>
<li class="calibre7"><a href="#calibre_link-539" class="calibre4">199</a></li>
<li class="calibre7"><a href="#calibre_link-540" class="calibre4">200</a></li>
<li class="calibre7"><a href="#calibre_link-541" class="calibre4">201</a></li>
<li class="calibre7"><a href="#calibre_link-542" class="calibre4">202</a></li>
<li class="calibre7"><a href="#calibre_link-543" class="calibre4">203</a></li>
<li class="calibre7"><a href="#calibre_link-544" class="calibre4">204</a></li>
<li class="calibre7"><a href="#calibre_link-545" class="calibre4">205</a></li>
<li class="calibre7"><a href="#calibre_link-546" class="calibre4">206</a></li>
<li class="calibre7"><a href="#calibre_link-547" class="calibre4">207</a></li>
<li class="calibre7"><a href="#calibre_link-548" class="calibre4">208</a></li>
<li class="calibre7"><a href="#calibre_link-549" class="calibre4">209</a></li>
<li class="calibre7"><a href="#calibre_link-550" class="calibre4">210</a></li>
<li class="calibre7"><a href="#calibre_link-551" class="calibre4">211</a></li>
<li class="calibre7"><a href="#calibre_link-552" class="calibre4">212</a></li>
<li class="calibre7"><a href="#calibre_link-553" class="calibre4">213</a></li>
<li class="calibre7"><a href="#calibre_link-554" class="calibre4">214</a></li>
<li class="calibre7"><a href="#calibre_link-555" class="calibre4">215</a></li>
<li class="calibre7"><a href="#calibre_link-556" class="calibre4">216</a></li>
<li class="calibre7"><a href="#calibre_link-557" class="calibre4">217</a></li>
<li class="calibre7"><a href="#calibre_link-558" class="calibre4">218</a></li>
<li class="calibre7"><a href="#calibre_link-559" class="calibre4">219</a></li>
<li class="calibre7"><a href="#calibre_link-560" class="calibre4">220</a></li>
<li class="calibre7"><a href="#calibre_link-561" class="calibre4">221</a></li>
<li class="calibre7"><a href="#calibre_link-562" class="calibre4">222</a></li>
<li class="calibre7"><a href="#calibre_link-563" class="calibre4">223</a></li>
<li class="calibre7"><a href="#calibre_link-564" class="calibre4">224</a></li>
<li class="calibre7"><a href="#calibre_link-565" class="calibre4">225</a></li>
<li class="calibre7"><a href="#calibre_link-566" class="calibre4">226</a></li>
<li class="calibre7"><a href="#calibre_link-567" class="calibre4">227</a></li>
<li class="calibre7"><a href="#calibre_link-568" class="calibre4">228</a></li>
<li class="calibre7"><a href="#calibre_link-569" class="calibre4">229</a></li>
<li class="calibre7"><a href="#calibre_link-570" class="calibre4">230</a></li>
<li class="calibre7"><a href="#calibre_link-571" class="calibre4">231</a></li>
<li class="calibre7"><a href="#calibre_link-572" class="calibre4">232</a></li>
<li class="calibre7"><a href="#calibre_link-573" class="calibre4">233</a></li>
<li class="calibre7"><a href="#calibre_link-574" class="calibre4">234</a></li>
<li class="calibre7"><a href="#calibre_link-575" class="calibre4">235</a></li>
<li class="calibre7"><a href="#calibre_link-576" class="calibre4">236</a></li>
<li class="calibre7"><a href="#calibre_link-577" class="calibre4">237</a></li>
<li class="calibre7"><a href="#calibre_link-578" class="calibre4">238</a></li>
<li class="calibre7"><a href="#calibre_link-579" class="calibre4">239</a></li>
<li class="calibre7"><a href="#calibre_link-580" class="calibre4">240</a></li>
<li class="calibre7"><a href="#calibre_link-581" class="calibre4">241</a></li>
<li class="calibre7"><a href="#calibre_link-582" class="calibre4">242</a></li>
<li class="calibre7"><a href="#calibre_link-583" class="calibre4">243</a></li>
<li class="calibre7"><a href="#calibre_link-584" class="calibre4">244</a></li>
<li class="calibre7"><a href="#calibre_link-585" class="calibre4">245</a></li>
<li class="calibre7"><a href="#calibre_link-586" class="calibre4">246</a></li>
<li class="calibre7"><a href="#calibre_link-587" class="calibre4">247</a></li>
<li class="calibre7"><a href="#calibre_link-588" class="calibre4">248</a></li>
<li class="calibre7"><a href="#calibre_link-589" class="calibre4">249</a></li>
<li class="calibre7"><a href="#calibre_link-590" class="calibre4">250</a></li>
<li class="calibre7"><a href="#calibre_link-591" class="calibre4">251</a></li>
<li class="calibre7"><a href="#calibre_link-592" class="calibre4">252</a></li>
<li class="calibre7"><a href="#calibre_link-593" class="calibre4">253</a></li>
<li class="calibre7"><a href="#calibre_link-594" class="calibre4">254</a></li>
<li class="calibre7"><a href="#calibre_link-595" class="calibre4">255</a></li>
<li class="calibre7"><a href="#calibre_link-596" class="calibre4">256</a></li>
<li class="calibre7"><a href="#calibre_link-597" class="calibre4">257</a></li>
<li class="calibre7"><a href="#calibre_link-598" class="calibre4">258</a></li>
<li class="calibre7"><a href="#calibre_link-599" class="calibre4">259</a></li>
<li class="calibre7"><a href="#calibre_link-600" class="calibre4">260</a></li>
<li class="calibre7"><a href="#calibre_link-601" class="calibre4">261</a></li>
<li class="calibre7"><a href="#calibre_link-602" class="calibre4">262</a></li>
<li class="calibre7"><a href="#calibre_link-603" class="calibre4">263</a></li>
<li class="calibre7"><a href="#calibre_link-604" class="calibre4">264</a></li>
<li class="calibre7"><a href="#calibre_link-605" class="calibre4">265</a></li>
<li class="calibre7"><a href="#calibre_link-606" class="calibre4">266</a></li>
<li class="calibre7"><a href="#calibre_link-607" class="calibre4">269</a></li>
<li class="calibre7"><a href="#calibre_link-608" class="calibre4">270</a></li>
<li class="calibre7"><a href="#calibre_link-609" class="calibre4">271</a></li>
<li class="calibre7"><a href="#calibre_link-610" class="calibre4">272</a></li>
<li class="calibre7"><a href="#calibre_link-611" class="calibre4">273</a></li>
<li class="calibre7"><a href="#calibre_link-612" class="calibre4">274</a></li>
<li class="calibre7"><a href="#calibre_link-613" class="calibre4">275</a></li>
<li class="calibre7"><a href="#calibre_link-614" class="calibre4">276</a></li>
<li class="calibre7"><a href="#calibre_link-615" class="calibre4">277</a></li>
<li class="calibre7"><a href="#calibre_link-616" class="calibre4">278</a></li>
<li class="calibre7"><a href="#calibre_link-617" class="calibre4">279</a></li>
<li class="calibre7"><a href="#calibre_link-618" class="calibre4">280</a></li>
<li class="calibre7"><a href="#calibre_link-619" class="calibre4">281</a></li>
<li class="calibre7"><a href="#calibre_link-620" class="calibre4">282</a></li>
<li class="calibre7"><a href="#calibre_link-621" class="calibre4">283</a></li>
<li class="calibre7"><a href="#calibre_link-622" class="calibre4">284</a></li>
<li class="calibre7"><a href="#calibre_link-623" class="calibre4">285</a></li>
<li class="calibre7"><a href="#calibre_link-624" class="calibre4">286</a></li>
<li class="calibre7"><a href="#calibre_link-625" class="calibre4">287</a></li>
<li class="calibre7"><a href="#calibre_link-626" class="calibre4">288</a></li>
<li class="calibre7"><a href="#calibre_link-627" class="calibre4">289</a></li>
<li class="calibre7"><a href="#calibre_link-628" class="calibre4">290</a></li>
<li class="calibre7"><a href="#calibre_link-629" class="calibre4">291</a></li>
<li class="calibre7"><a href="#calibre_link-630" class="calibre4">292</a></li>
<li class="calibre7"><a href="#calibre_link-631" class="calibre4">293</a></li>
<li class="calibre7"><a href="#calibre_link-632" class="calibre4">294</a></li>
<li class="calibre7"><a href="#calibre_link-633" class="calibre4">295</a></li>
<li class="calibre7"><a href="#calibre_link-634" class="calibre4">296</a></li>
<li class="calibre7"><a href="#calibre_link-635" class="calibre4">297</a></li>
<li class="calibre7"><a href="#calibre_link-636" class="calibre4">298</a></li>
<li class="calibre7"><a href="#calibre_link-637" class="calibre4">299</a></li>
<li class="calibre7"><a href="#calibre_link-638" class="calibre4">300</a></li>
<li class="calibre7"><a href="#calibre_link-639" class="calibre4">301</a></li>
<li class="calibre7"><a href="#calibre_link-640" class="calibre4">302</a></li>
<li class="calibre7"><a href="#calibre_link-641" class="calibre4">303</a></li>
<li class="calibre7"><a href="#calibre_link-642" class="calibre4">304</a></li>
<li class="calibre7"><a href="#calibre_link-643" class="calibre4">305</a></li>
<li class="calibre7"><a href="#calibre_link-644" class="calibre4">306</a></li>
<li class="calibre7"><a href="#calibre_link-645" class="calibre4">307</a></li>
<li class="calibre7"><a href="#calibre_link-646" class="calibre4">308</a></li>
<li class="calibre7"><a href="#calibre_link-647" class="calibre4">309</a></li>
<li class="calibre7"><a href="#calibre_link-648" class="calibre4">310</a></li>
<li class="calibre7"><a href="#calibre_link-649" class="calibre4">311</a></li>
<li class="calibre7"><a href="#calibre_link-650" class="calibre4">312</a></li>
<li class="calibre7"><a href="#calibre_link-651" class="calibre4">313</a></li>
<li class="calibre7"><a href="#calibre_link-652" class="calibre4">314</a></li>
<li class="calibre7"><a href="#calibre_link-653" class="calibre4">315</a></li>
<li class="calibre7"><a href="#calibre_link-654" class="calibre4">316</a></li>
<li class="calibre7"><a href="#calibre_link-655" class="calibre4">317</a></li>
<li class="calibre7"><a href="#calibre_link-656" class="calibre4">318</a></li>
<li class="calibre7"><a href="#calibre_link-657" class="calibre4">319</a></li>
<li class="calibre7"><a href="#calibre_link-658" class="calibre4">320</a></li>
<li class="calibre7"><a href="#calibre_link-659" class="calibre4">321</a></li>
<li class="calibre7"><a href="#calibre_link-660" class="calibre4">322</a></li>
<li class="calibre7"><a href="#calibre_link-661" class="calibre4">323</a></li>
<li class="calibre7"><a href="#calibre_link-662" class="calibre4">324</a></li>
<li class="calibre7"><a href="#calibre_link-663" class="calibre4">325</a></li>
<li class="calibre7"><a href="#calibre_link-664" class="calibre4">326</a></li>
<li class="calibre7"><a href="#calibre_link-665" class="calibre4">327</a></li>
<li class="calibre7"><a href="#calibre_link-666" class="calibre4">328</a></li>
<li class="calibre7"><a href="#calibre_link-667" class="calibre4">329</a></li>
<li class="calibre7"><a href="#calibre_link-668" class="calibre4">331</a></li>
<li class="calibre7"><a href="#calibre_link-669" class="calibre4">332</a></li>
<li class="calibre7"><a href="#calibre_link-670" class="calibre4">333</a></li>
<li class="calibre7"><a href="#calibre_link-671" class="calibre4">334</a></li>
<li class="calibre7"><a href="#calibre_link-672" class="calibre4">335</a></li>
<li class="calibre7"><a href="#calibre_link-673" class="calibre4">336</a></li>
<li class="calibre7"><a href="#calibre_link-674" class="calibre4">337</a></li>
<li class="calibre7"><a href="#calibre_link-675" class="calibre4">338</a></li>
<li class="calibre7"><a href="#calibre_link-676" class="calibre4">339</a></li>
<li class="calibre7"><a href="#calibre_link-677" class="calibre4">340</a></li>
<li class="calibre7"><a href="#calibre_link-678" class="calibre4">341</a></li>
<li class="calibre7"><a href="#calibre_link-679" class="calibre4">342</a></li>
<li class="calibre7"><a href="#calibre_link-680" class="calibre4">343</a></li>
<li class="calibre7"><a href="#calibre_link-681" class="calibre4">344</a></li>
<li class="calibre7"><a href="#calibre_link-682" class="calibre4">345</a></li>
<li class="calibre7"><a href="#calibre_link-683" class="calibre4">346</a></li>
<li class="calibre7"><a href="#calibre_link-684" class="calibre4">347</a></li>
<li class="calibre7"><a href="#calibre_link-685" class="calibre4">348</a></li>
<li class="calibre7"><a href="#calibre_link-686" class="calibre4">349</a></li>
<li class="calibre7"><a href="#calibre_link-687" class="calibre4">350</a></li>
<li class="calibre7"><a href="#calibre_link-688" class="calibre4">351</a></li>
<li class="calibre7"><a href="#calibre_link-689" class="calibre4">352</a></li>
<li class="calibre7"><a href="#calibre_link-690" class="calibre4">353</a></li>
<li class="calibre7"><a href="#calibre_link-691" class="calibre4">354</a></li>
<li class="calibre7"><a href="#calibre_link-692" class="calibre4">355</a></li>
<li class="calibre7"><a href="#calibre_link-693" class="calibre4">356</a></li>
<li class="calibre7"><a href="#calibre_link-694" class="calibre4">357</a></li>
<li class="calibre7"><a href="#calibre_link-695" class="calibre4">358</a></li>
<li class="calibre7"><a href="#calibre_link-696" class="calibre4">359</a></li>
<li class="calibre7"><a href="#calibre_link-697" class="calibre4">360</a></li>
<li class="calibre7"><a href="#calibre_link-698" class="calibre4">361</a></li>
<li class="calibre7"><a href="#calibre_link-699" class="calibre4">362</a></li>
<li class="calibre7"><a href="#calibre_link-700" class="calibre4">363</a></li>
<li class="calibre7"><a href="#calibre_link-701" class="calibre4">365</a></li>
<li class="calibre7"><a href="#calibre_link-702" class="calibre4">366</a></li>
<li class="calibre7"><a href="#calibre_link-703" class="calibre4">367</a></li>
<li class="calibre7"><a href="#calibre_link-704" class="calibre4">368</a></li>
<li class="calibre7"><a href="#calibre_link-705" class="calibre4">369</a></li>
<li class="calibre7"><a href="#calibre_link-706" class="calibre4">370</a></li>
<li class="calibre7"><a href="#calibre_link-707" class="calibre4">371</a></li>
<li class="calibre7"><a href="#calibre_link-708" class="calibre4">372</a></li>
<li class="calibre7"><a href="#calibre_link-709" class="calibre4">373</a></li>
<li class="calibre7"><a href="#calibre_link-710" class="calibre4">374</a></li>
<li class="calibre7"><a href="#calibre_link-711" class="calibre4">375</a></li>
<li class="calibre7"><a href="#calibre_link-712" class="calibre4">376</a></li>
<li class="calibre7"><a href="#calibre_link-713" class="calibre4">377</a></li>
<li class="calibre7"><a href="#calibre_link-714" class="calibre4">378</a></li>
<li class="calibre7"><a href="#calibre_link-715" class="calibre4">379</a></li>
<li class="calibre7"><a href="#calibre_link-716" class="calibre4">380</a></li>
<li class="calibre7"><a href="#calibre_link-717" class="calibre4">381</a></li>
<li class="calibre7"><a href="#calibre_link-718" class="calibre4">382</a></li>
<li class="calibre7"><a href="#calibre_link-719" class="calibre4">383</a></li>
<li class="calibre7"><a href="#calibre_link-720" class="calibre4">384</a></li>
<li class="calibre7"><a href="#calibre_link-721" class="calibre4">385</a></li>
<li class="calibre7"><a href="#calibre_link-722" class="calibre4">386</a></li>
<li class="calibre7"><a href="#calibre_link-723" class="calibre4">387</a></li>
<li class="calibre7"><a href="#calibre_link-724" class="calibre4">388</a></li>
<li class="calibre7"><a href="#calibre_link-725" class="calibre4">389</a></li>
<li class="calibre7"><a href="#calibre_link-726" class="calibre4">390</a></li>
<li class="calibre7"><a href="#calibre_link-727" class="calibre4">391</a></li>
<li class="calibre7"><a href="#calibre_link-728" class="calibre4">392</a></li>
<li class="calibre7"><a href="#calibre_link-729" class="calibre4">393</a></li>
<li class="calibre7"><a href="#calibre_link-730" class="calibre4">395</a></li>
<li class="calibre7"><a href="#calibre_link-731" class="calibre4">396</a></li>
<li class="calibre7"><a href="#calibre_link-732" class="calibre4">397</a></li>
<li class="calibre7"><a href="#calibre_link-733" class="calibre4">398</a></li>
<li class="calibre7"><a href="#calibre_link-734" class="calibre4">399</a></li>
<li class="calibre7"><a href="#calibre_link-735" class="calibre4">400</a></li>
<li class="calibre7"><a href="#calibre_link-736" class="calibre4">401</a></li>
<li class="calibre7"><a href="#calibre_link-737" class="calibre4">402</a></li>
<li class="calibre7"><a href="#calibre_link-738" class="calibre4">403</a></li>
<li class="calibre7"><a href="#calibre_link-739" class="calibre4">404</a></li>
<li class="calibre7"><a href="#calibre_link-740" class="calibre4">405</a></li>
<li class="calibre7"><a href="#calibre_link-741" class="calibre4">406</a></li>
<li class="calibre7"><a href="#calibre_link-742" class="calibre4">407</a></li>
<li class="calibre7"><a href="#calibre_link-743" class="calibre4">408</a></li>
<li class="calibre7"><a href="#calibre_link-744" class="calibre4">409</a></li>
<li class="calibre7"><a href="#calibre_link-745" class="calibre4">410</a></li>
<li class="calibre7"><a href="#calibre_link-746" class="calibre4">411</a></li>
<li class="calibre7"><a href="#calibre_link-747" class="calibre4">412</a></li>
<li class="calibre7"><a href="#calibre_link-748" class="calibre4">413</a></li>
<li class="calibre7"><a href="#calibre_link-749" class="calibre4">414</a></li>
<li class="calibre7"><a href="#calibre_link-750" class="calibre4">415</a></li>
<li class="calibre7"><a href="#calibre_link-751" class="calibre4">416</a></li>
<li class="calibre7"><a href="#calibre_link-752" class="calibre4">417</a></li>
<li class="calibre7"><a href="#calibre_link-753" class="calibre4">418</a></li>
<li class="calibre7"><a href="#calibre_link-754" class="calibre4">419</a></li>
<li class="calibre7"><a href="#calibre_link-755" class="calibre4">420</a></li>
<li class="calibre7"><a href="#calibre_link-756" class="calibre4">421</a></li>
<li class="calibre7"><a href="#calibre_link-757" class="calibre4">422</a></li>
<li class="calibre7"><a href="#calibre_link-758" class="calibre4">423</a></li>
<li class="calibre7"><a href="#calibre_link-759" class="calibre4">424</a></li>
<li class="calibre7"><a href="#calibre_link-760" class="calibre4">425</a></li>
<li class="calibre7"><a href="#calibre_link-761" class="calibre4">426</a></li>
<li class="calibre7"><a href="#calibre_link-762" class="calibre4">427</a></li>
<li class="calibre7"><a href="#calibre_link-763" class="calibre4">428</a></li>
<li class="calibre7"><a href="#calibre_link-764" class="calibre4">429</a></li>
<li class="calibre7"><a href="#calibre_link-765" class="calibre4">430</a></li>
<li class="calibre7"><a href="#calibre_link-766" class="calibre4">431</a></li>
<li class="calibre7"><a href="#calibre_link-767" class="calibre4">432</a></li>
<li class="calibre7"><a href="#calibre_link-768" class="calibre4">433</a></li>
<li class="calibre7"><a href="#calibre_link-769" class="calibre4">434</a></li>
<li class="calibre7"><a href="#calibre_link-770" class="calibre4">435</a></li>
<li class="calibre7"><a href="#calibre_link-771" class="calibre4">436</a></li>
<li class="calibre7"><a href="#calibre_link-772" class="calibre4">437</a></li>
<li class="calibre7"><a href="#calibre_link-773" class="calibre4">438</a></li>
<li class="calibre7"><a href="#calibre_link-774" class="calibre4">439</a></li>
<li class="calibre7"><a href="#calibre_link-775" class="calibre4">440</a></li>
<li class="calibre7"><a href="#calibre_link-776" class="calibre4">441</a></li>
<li class="calibre7"><a href="#calibre_link-777" class="calibre4">442</a></li>
<li class="calibre7"><a href="#calibre_link-778" class="calibre4">443</a></li>
<li class="calibre7"><a href="#calibre_link-779" class="calibre4">444</a></li>
<li class="calibre7"><a href="#calibre_link-780" class="calibre4">445</a></li>
<li class="calibre7"><a href="#calibre_link-781" class="calibre4">446</a></li>
<li class="calibre7"><a href="#calibre_link-782" class="calibre4">449</a></li>
<li class="calibre7"><a href="#calibre_link-783" class="calibre4">450</a></li>
<li class="calibre7"><a href="#calibre_link-784" class="calibre4">451</a></li>
<li class="calibre7"><a href="#calibre_link-785" class="calibre4">452</a></li>
<li class="calibre7"><a href="#calibre_link-786" class="calibre4">453</a></li>
<li class="calibre7"><a href="#calibre_link-787" class="calibre4">454</a></li>
<li class="calibre7"><a href="#calibre_link-788" class="calibre4">455</a></li>
<li class="calibre7"><a href="#calibre_link-789" class="calibre4">456</a></li>
<li class="calibre7"><a href="#calibre_link-790" class="calibre4">457</a></li>
<li class="calibre7"><a href="#calibre_link-791" class="calibre4">458</a></li>
<li class="calibre7"><a href="#calibre_link-792" class="calibre4">459</a></li>
<li class="calibre7"><a href="#calibre_link-793" class="calibre4">460</a></li>
<li class="calibre7"><a href="#calibre_link-794" class="calibre4">461</a></li>
<li class="calibre7"><a href="#calibre_link-795" class="calibre4">462</a></li>
<li class="calibre7"><a href="#calibre_link-796" class="calibre4">463</a></li>
<li class="calibre7"><a href="#calibre_link-797" class="calibre4">464</a></li>
<li class="calibre7"><a href="#calibre_link-798" class="calibre4">465</a></li>
<li class="calibre7"><a href="#calibre_link-799" class="calibre4">466</a></li>
<li class="calibre7"><a href="#calibre_link-800" class="calibre4">467</a></li>
<li class="calibre7"><a href="#calibre_link-801" class="calibre4">468</a></li>
<li class="calibre7"><a href="#calibre_link-802" class="calibre4">469</a></li>
<li class="calibre7"><a href="#calibre_link-803" class="calibre4">470</a></li>
<li class="calibre7"><a href="#calibre_link-804" class="calibre4">471</a></li>
<li class="calibre7"><a href="#calibre_link-805" class="calibre4">472</a></li>
<li class="calibre7"><a href="#calibre_link-806" class="calibre4">473</a></li>
<li class="calibre7"><a href="#calibre_link-807" class="calibre4">474</a></li>
<li class="calibre7"><a href="#calibre_link-808" class="calibre4">475</a></li>
<li class="calibre7"><a href="#calibre_link-809" class="calibre4">477</a></li>
<li class="calibre7"><a href="#calibre_link-810" class="calibre4">478</a></li>
<li class="calibre7"><a href="#calibre_link-811" class="calibre4">479</a></li>
<li class="calibre7"><a href="#calibre_link-812" class="calibre4">480</a></li>
<li class="calibre7"><a href="#calibre_link-813" class="calibre4">481</a></li>
<li class="calibre7"><a href="#calibre_link-814" class="calibre4">482</a></li>
<li class="calibre7"><a href="#calibre_link-815" class="calibre4">483</a></li>
<li class="calibre7"><a href="#calibre_link-816" class="calibre4">484</a></li>
<li class="calibre7"><a href="#calibre_link-817" class="calibre4">485</a></li>
<li class="calibre7"><a href="#calibre_link-818" class="calibre4">486</a></li>
<li class="calibre7"><a href="#calibre_link-819" class="calibre4">487</a></li>
<li class="calibre7"><a href="#calibre_link-820" class="calibre4">488</a></li>
<li class="calibre7"><a href="#calibre_link-821" class="calibre4">489</a></li>
<li class="calibre7"><a href="#calibre_link-822" class="calibre4">490</a></li>
<li class="calibre7"><a href="#calibre_link-823" class="calibre4">491</a></li>
<li class="calibre7"><a href="#calibre_link-824" class="calibre4">492</a></li>
<li class="calibre7"><a href="#calibre_link-825" class="calibre4">493</a></li>
<li class="calibre7"><a href="#calibre_link-826" class="calibre4">494</a></li>
<li class="calibre7"><a href="#calibre_link-827" class="calibre4">495</a></li>
<li class="calibre7"><a href="#calibre_link-828" class="calibre4">496</a></li>
<li class="calibre7"><a href="#calibre_link-829" class="calibre4">497</a></li>
<li class="calibre7"><a href="#calibre_link-830" class="calibre4">498</a></li>
<li class="calibre7"><a href="#calibre_link-831" class="calibre4">499</a></li>
<li class="calibre7"><a href="#calibre_link-832" class="calibre4">500</a></li>
<li class="calibre7"><a href="#calibre_link-833" class="calibre4">501</a></li>
<li class="calibre7"><a href="#calibre_link-834" class="calibre4">502</a></li>
<li class="calibre7"><a href="#calibre_link-835" class="calibre4">503</a></li>
<li class="calibre7"><a href="#calibre_link-836" class="calibre4">504</a></li>
<li class="calibre7"><a href="#calibre_link-837" class="calibre4">505</a></li>
<li class="calibre7"><a href="#calibre_link-838" class="calibre4">506</a></li>
<li class="calibre7"><a href="#calibre_link-839" class="calibre4">507</a></li>
<li class="calibre7"><a href="#calibre_link-840" class="calibre4">508</a></li>
<li class="calibre7"><a href="#calibre_link-841" class="calibre4">509</a></li>
<li class="calibre7"><a href="#calibre_link-842" class="calibre4">510</a></li>
<li class="calibre7"><a href="#calibre_link-843" class="calibre4">511</a></li>
<li class="calibre7"><a href="#calibre_link-844" class="calibre4">512</a></li>
<li class="calibre7"><a href="#calibre_link-845" class="calibre4">513</a></li>
<li class="calibre7"><a href="#calibre_link-846" class="calibre4">514</a></li>
<li class="calibre7"><a href="#calibre_link-847" class="calibre4">515</a></li>
<li class="calibre7"><a href="#calibre_link-848" class="calibre4">516</a></li>
<li class="calibre7"><a href="#calibre_link-849" class="calibre4">517</a></li>
<li class="calibre7"><a href="#calibre_link-850" class="calibre4">518</a></li>
<li class="calibre7"><a href="#calibre_link-851" class="calibre4">519</a></li>
<li class="calibre7"><a href="#calibre_link-852" class="calibre4">520</a></li>
<li class="calibre7"><a href="#calibre_link-853" class="calibre4">521</a></li>
<li class="calibre7"><a href="#calibre_link-854" class="calibre4">522</a></li>
<li class="calibre7"><a href="#calibre_link-855" class="calibre4">523</a></li>
<li class="calibre7"><a href="#calibre_link-856" class="calibre4">524</a></li>
<li class="calibre7"><a href="#calibre_link-857" class="calibre4">525</a></li>
<li class="calibre7"><a href="#calibre_link-858" class="calibre4">526</a></li>
<li class="calibre7"><a href="#calibre_link-859" class="calibre4">527</a></li>
<li class="calibre7"><a href="#calibre_link-860" class="calibre4">528</a></li>
<li class="calibre7"><a href="#calibre_link-861" class="calibre4">529</a></li>
<li class="calibre7"><a href="#calibre_link-862" class="calibre4">530</a></li>
<li class="calibre7"><a href="#calibre_link-863" class="calibre4">531</a></li>
<li class="calibre7"><a href="#calibre_link-864" class="calibre4">532</a></li>
<li class="calibre7"><a href="#calibre_link-865" class="calibre4">533</a></li>
<li class="calibre7"><a href="#calibre_link-866" class="calibre4">535</a></li>
<li class="calibre7"><a href="#calibre_link-867" class="calibre4">536</a></li>
<li class="calibre7"><a href="#calibre_link-868" class="calibre4">537</a></li>
<li class="calibre7"><a href="#calibre_link-869" class="calibre4">538</a></li>
<li class="calibre7"><a href="#calibre_link-870" class="calibre4">539</a></li>
<li class="calibre7"><a href="#calibre_link-871" class="calibre4">540</a></li>
<li class="calibre7"><a href="#calibre_link-872" class="calibre4">541</a></li>
<li class="calibre7"><a href="#calibre_link-873" class="calibre4">542</a></li>
<li class="calibre7"><a href="#calibre_link-874" class="calibre4">543</a></li>
<li class="calibre7"><a href="#calibre_link-875" class="calibre4">544</a></li>
<li class="calibre7"><a href="#calibre_link-876" class="calibre4">545</a></li>
<li class="calibre7"><a href="#calibre_link-877" class="calibre4">546</a></li>
<li class="calibre7"><a href="#calibre_link-878" class="calibre4">547</a></li>
<li class="calibre7"><a href="#calibre_link-879" class="calibre4">548</a></li>
<li class="calibre7"><a href="#calibre_link-880" class="calibre4">549</a></li>
<li class="calibre7"><a href="#calibre_link-881" class="calibre4">550</a></li>
<li class="calibre7"><a href="#calibre_link-882" class="calibre4">551</a></li>
<li class="calibre7"><a href="#calibre_link-883" class="calibre4">552</a></li>
<li class="calibre7"><a href="#calibre_link-884" class="calibre4">553</a></li>
<li class="calibre7"><a href="#calibre_link-885" class="calibre4">554</a></li>
<li class="calibre7"><a href="#calibre_link-886" class="calibre4">555</a></li>
<li class="calibre7"><a href="#calibre_link-887" class="calibre4">556</a></li>
<li class="calibre7"><a href="#calibre_link-888" class="calibre4">557</a></li>
<li class="calibre7"><a href="#calibre_link-889" class="calibre4">558</a></li>
<li class="calibre7"><a href="#calibre_link-890" class="calibre4">559</a></li>
<li class="calibre7"><a href="#calibre_link-891" class="calibre4">560</a></li>
<li class="calibre7"><a href="#calibre_link-892" class="calibre4">561</a></li>
<li class="calibre7"><a href="#calibre_link-893" class="calibre4">562</a></li>
<li class="calibre7"><a href="#calibre_link-894" class="calibre4">563</a></li>
<li class="calibre7"><a href="#calibre_link-895" class="calibre4">564</a></li>
<li class="calibre7"><a href="#calibre_link-896" class="calibre4">565</a></li>
<li class="calibre7"><a href="#calibre_link-897" class="calibre4">566</a></li>
<li class="calibre7"><a href="#calibre_link-898" class="calibre4">567</a></li>
<li class="calibre7"><a href="#calibre_link-899" class="calibre4">568</a></li>
<li class="calibre7"><a href="#calibre_link-900" class="calibre4">569</a></li>
<li class="calibre7"><a href="#calibre_link-901" class="calibre4">570</a></li>
<li class="calibre7"><a href="#calibre_link-902" class="calibre4">571</a></li>
<li class="calibre7"><a href="#calibre_link-903" class="calibre4">572</a></li>
<li class="calibre7"><a href="#calibre_link-904" class="calibre4">573</a></li>
<li class="calibre7"><a href="#calibre_link-905" class="calibre4">574</a></li>
<li class="calibre7"><a href="#calibre_link-906" class="calibre4">575</a></li>
<li class="calibre7"><a href="#calibre_link-907" class="calibre4">576</a></li>
<li class="calibre7"><a href="#calibre_link-908" class="calibre4">577</a></li>
<li class="calibre7"><a href="#calibre_link-909" class="calibre4">578</a></li>
<li class="calibre7"><a href="#calibre_link-910" class="calibre4">579</a></li>
<li class="calibre7"><a href="#calibre_link-911" class="calibre4">580</a></li>
<li class="calibre7"><a href="#calibre_link-912" class="calibre4">581</a></li>
<li class="calibre7"><a href="#calibre_link-913" class="calibre4">582</a></li>
<li class="calibre7"><a href="#calibre_link-914" class="calibre4">583</a></li>
<li class="calibre7"><a href="#calibre_link-915" class="calibre4">584</a></li>
<li class="calibre7"><a href="#calibre_link-916" class="calibre4">585</a></li>
<li class="calibre7"><a href="#calibre_link-917" class="calibre4">586</a></li>
<li class="calibre7"><a href="#calibre_link-918" class="calibre4">587</a></li>
<li class="calibre7"><a href="#calibre_link-919" class="calibre4">588</a></li>
<li class="calibre7"><a href="#calibre_link-920" class="calibre4">589</a></li>
<li class="calibre7"><a href="#calibre_link-921" class="calibre4">591</a></li>
<li class="calibre7"><a href="#calibre_link-922" class="calibre4">592</a></li>
<li class="calibre7"><a href="#calibre_link-923" class="calibre4">593</a></li>
<li class="calibre7"><a href="#calibre_link-924" class="calibre4">594</a></li>
<li class="calibre7"><a href="#calibre_link-925" class="calibre4">595</a></li>
<li class="calibre7"><a href="#calibre_link-926" class="calibre4">596</a></li>
<li class="calibre7"><a href="#calibre_link-927" class="calibre4">597</a></li>
<li class="calibre7"><a href="#calibre_link-928" class="calibre4">598</a></li>
<li class="calibre7"><a href="#calibre_link-929" class="calibre4">599</a></li>
<li class="calibre7"><a href="#calibre_link-930" class="calibre4">600</a></li>
<li class="calibre7"><a href="#calibre_link-931" class="calibre4">601</a></li>
<li class="calibre7"><a href="#calibre_link-932" class="calibre4">602</a></li>
<li class="calibre7"><a href="#calibre_link-933" class="calibre4">603</a></li>
<li class="calibre7"><a href="#calibre_link-934" class="calibre4">604</a></li>
<li class="calibre7"><a href="#calibre_link-935" class="calibre4">605</a></li>
<li class="calibre7"><a href="#calibre_link-936" class="calibre4">606</a></li>
<li class="calibre7"><a href="#calibre_link-937" class="calibre4">607</a></li>
<li class="calibre7"><a href="#calibre_link-938" class="calibre4">608</a></li>
<li class="calibre7"><a href="#calibre_link-939" class="calibre4">609</a></li>
<li class="calibre7"><a href="#calibre_link-940" class="calibre4">610</a></li>
<li class="calibre7"><a href="#calibre_link-941" class="calibre4">611</a></li>
<li class="calibre7"><a href="#calibre_link-942" class="calibre4">612</a></li>
<li class="calibre7"><a href="#calibre_link-943" class="calibre4">613</a></li>
<li class="calibre7"><a href="#calibre_link-944" class="calibre4">614</a></li>
<li class="calibre7"><a href="#calibre_link-945" class="calibre4">615</a></li>
<li class="calibre7"><a href="#calibre_link-946" class="calibre4">616</a></li>
<li class="calibre7"><a href="#calibre_link-947" class="calibre4">617</a></li>
<li class="calibre7"><a href="#calibre_link-948" class="calibre4">618</a></li>
<li class="calibre7"><a href="#calibre_link-949" class="calibre4">619</a></li>
<li class="calibre7"><a href="#calibre_link-950" class="calibre4">620</a></li>
<li class="calibre7"><a href="#calibre_link-951" class="calibre4">621</a></li>
<li class="calibre7"><a href="#calibre_link-952" class="calibre4">622</a></li>
<li class="calibre7"><a href="#calibre_link-953" class="calibre4">623</a></li>
<li class="calibre7"><a href="#calibre_link-954" class="calibre4">624</a></li>
<li class="calibre7"><a href="#calibre_link-955" class="calibre4">625</a></li>
<li class="calibre7"><a href="#calibre_link-956" class="calibre4">626</a></li>
<li class="calibre7"><a href="#calibre_link-957" class="calibre4">627</a></li>
<li class="calibre7"><a href="#calibre_link-958" class="calibre4">628</a></li>
<li class="calibre7"><a href="#calibre_link-959" class="calibre4">629</a></li>
<li class="calibre7"><a href="#calibre_link-960" class="calibre4">630</a></li>
<li class="calibre7"><a href="#calibre_link-961" class="calibre4">631</a></li>
<li class="calibre7"><a href="#calibre_link-962" class="calibre4">632</a></li>
<li class="calibre7"><a href="#calibre_link-963" class="calibre4">633</a></li>
<li class="calibre7"><a href="#calibre_link-964" class="calibre4">634</a></li>
<li class="calibre7"><a href="#calibre_link-965" class="calibre4">635</a></li>
<li class="calibre7"><a href="#calibre_link-966" class="calibre4">636</a></li>
<li class="calibre7"><a href="#calibre_link-967" class="calibre4">637</a></li>
<li class="calibre7"><a href="#calibre_link-968" class="calibre4">638</a></li>
<li class="calibre7"><a href="#calibre_link-969" class="calibre4">639</a></li>
<li class="calibre7"><a href="#calibre_link-970" class="calibre4">640</a></li>
<li class="calibre7"><a href="#calibre_link-971" class="calibre4">641</a></li>
<li class="calibre7"><a href="#calibre_link-972" class="calibre4">642</a></li>
<li class="calibre7"><a href="#calibre_link-973" class="calibre4">645</a></li>
<li class="calibre7"><a href="#calibre_link-974" class="calibre4">646</a></li>
<li class="calibre7"><a href="#calibre_link-975" class="calibre4">647</a></li>
<li class="calibre7"><a href="#calibre_link-976" class="calibre4">648</a></li>
<li class="calibre7"><a href="#calibre_link-977" class="calibre4">649</a></li>
<li class="calibre7"><a href="#calibre_link-978" class="calibre4">650</a></li>
<li class="calibre7"><a href="#calibre_link-979" class="calibre4">651</a></li>
<li class="calibre7"><a href="#calibre_link-980" class="calibre4">652</a></li>
<li class="calibre7"><a href="#calibre_link-981" class="calibre4">653</a></li>
<li class="calibre7"><a href="#calibre_link-982" class="calibre4">654</a></li>
<li class="calibre7"><a href="#calibre_link-983" class="calibre4">655</a></li>
<li class="calibre7"><a href="#calibre_link-984" class="calibre4">656</a></li>
<li class="calibre7"><a href="#calibre_link-985" class="calibre4">657</a></li>
<li class="calibre7"><a href="#calibre_link-986" class="calibre4">658</a></li>
<li class="calibre7"><a href="#calibre_link-987" class="calibre4">659</a></li>
<li class="calibre7"><a href="#calibre_link-988" class="calibre4">660</a></li>
<li class="calibre7"><a href="#calibre_link-989" class="calibre4">661</a></li>
<li class="calibre7"><a href="#calibre_link-990" class="calibre4">662</a></li>
<li class="calibre7"><a href="#calibre_link-991" class="calibre4">663</a></li>
<li class="calibre7"><a href="#calibre_link-992" class="calibre4">664</a></li>
<li class="calibre7"><a href="#calibre_link-993" class="calibre4">665</a></li>
<li class="calibre7"><a href="#calibre_link-994" class="calibre4">666</a></li>
<li class="calibre7"><a href="#calibre_link-995" class="calibre4">667</a></li>
<li class="calibre7"><a href="#calibre_link-996" class="calibre4">668</a></li>
<li class="calibre7"><a href="#calibre_link-997" class="calibre4">669</a></li>
<li class="calibre7"><a href="#calibre_link-998" class="calibre4">670</a></li>
<li class="calibre7"><a href="#calibre_link-999" class="calibre4">671</a></li>
<li class="calibre7"><a href="#calibre_link-1000" class="calibre4">672</a></li>
<li class="calibre7"><a href="#calibre_link-1001" class="calibre4">673</a></li>
<li class="calibre7"><a href="#calibre_link-1002" class="calibre4">674</a></li>
<li class="calibre7"><a href="#calibre_link-1003" class="calibre4">675</a></li>
<li class="calibre7"><a href="#calibre_link-1004" class="calibre4">676</a></li>
<li class="calibre7"><a href="#calibre_link-1005" class="calibre4">677</a></li>
<li class="calibre7"><a href="#calibre_link-1006" class="calibre4">678</a></li>
<li class="calibre7"><a href="#calibre_link-1007" class="calibre4">679</a></li>
<li class="calibre7"><a href="#calibre_link-1008" class="calibre4">681</a></li>
<li class="calibre7"><a href="#calibre_link-1009" class="calibre4">682</a></li>
<li class="calibre7"><a href="#calibre_link-1010" class="calibre4">683</a></li>
<li class="calibre7"><a href="#calibre_link-1011" class="calibre4">684</a></li>
<li class="calibre7"><a href="#calibre_link-1012" class="calibre4">685</a></li>
<li class="calibre7"><a href="#calibre_link-1013" class="calibre4">686</a></li>
<li class="calibre7"><a href="#calibre_link-1014" class="calibre4">687</a></li>
<li class="calibre7"><a href="#calibre_link-1015" class="calibre4">688</a></li>
<li class="calibre7"><a href="#calibre_link-1016" class="calibre4">689</a></li>
<li class="calibre7"><a href="#calibre_link-1017" class="calibre4">690</a></li>
<li class="calibre7"><a href="#calibre_link-1018" class="calibre4">691</a></li>
<li class="calibre7"><a href="#calibre_link-1019" class="calibre4">692</a></li>
<li class="calibre7"><a href="#calibre_link-1020" class="calibre4">693</a></li>
<li class="calibre7"><a href="#calibre_link-1021" class="calibre4">694</a></li>
<li class="calibre7"><a href="#calibre_link-1022" class="calibre4">695</a></li>
<li class="calibre7"><a href="#calibre_link-1023" class="calibre4">696</a></li>
<li class="calibre7"><a href="#calibre_link-1024" class="calibre4">697</a></li>
<li class="calibre7"><a href="#calibre_link-1025" class="calibre4">698</a></li>
<li class="calibre7"><a href="#calibre_link-1026" class="calibre4">699</a></li>
<li class="calibre7"><a href="#calibre_link-1027" class="calibre4">700</a></li>
<li class="calibre7"><a href="#calibre_link-1028" class="calibre4">701</a></li>
<li class="calibre7"><a href="#calibre_link-1029" class="calibre4">702</a></li>
<li class="calibre7"><a href="#calibre_link-1030" class="calibre4">703</a></li>
<li class="calibre7"><a href="#calibre_link-1031" class="calibre4">704</a></li>
<li class="calibre7"><a href="#calibre_link-1032" class="calibre4">705</a></li>
<li class="calibre7"><a href="#calibre_link-1033" class="calibre4">706</a></li>
<li class="calibre7"><a href="#calibre_link-1034" class="calibre4">707</a></li>
<li class="calibre7"><a href="#calibre_link-1035" class="calibre4">708</a></li>
<li class="calibre7"><a href="#calibre_link-1036" class="calibre4">709</a></li>
<li class="calibre7"><a href="#calibre_link-1037" class="calibre4">710</a></li>
<li class="calibre7"><a href="#calibre_link-1038" class="calibre4">711</a></li>
<li class="calibre7"><a href="#calibre_link-1039" class="calibre4">712</a></li>
<li class="calibre7"><a href="#calibre_link-1040" class="calibre4">713</a></li>
<li class="calibre7"><a href="#calibre_link-1041" class="calibre4">714</a></li>
<li class="calibre7"><a href="#calibre_link-1042" class="calibre4">715</a></li>
<li class="calibre7"><a href="#calibre_link-1043" class="calibre4">716</a></li>
<li class="calibre7"><a href="#calibre_link-1044" class="calibre4">717</a></li>
<li class="calibre7"><a href="#calibre_link-1045" class="calibre4">718</a></li>
<li class="calibre7"><a href="#calibre_link-1046" class="calibre4">719</a></li>
<li class="calibre7"><a href="#calibre_link-1047" class="calibre4">720</a></li>
<li class="calibre7"><a href="#calibre_link-1048" class="calibre4">721</a></li>
<li class="calibre7"><a href="#calibre_link-1049" class="calibre4">722</a></li>
<li class="calibre7"><a href="#calibre_link-1050" class="calibre4">723</a></li>
<li class="calibre7"><a href="#calibre_link-1051" class="calibre4">724</a></li>
<li class="calibre7"><a href="#calibre_link-1052" class="calibre4">725</a></li>
<li class="calibre7"><a href="#calibre_link-1053" class="calibre4">726</a></li>
<li class="calibre7"><a href="#calibre_link-1054" class="calibre4">727</a></li>
<li class="calibre7"><a href="#calibre_link-1055" class="calibre4">728</a></li>
<li class="calibre7"><a href="#calibre_link-1056" class="calibre4">729</a></li>
<li class="calibre7"><a href="#calibre_link-1057" class="calibre4">730</a></li>
<li class="calibre7"><a href="#calibre_link-1058" class="calibre4">731</a></li>
<li class="calibre7"><a href="#calibre_link-1059" class="calibre4">732</a></li>
<li class="calibre7"><a href="#calibre_link-1060" class="calibre4">733</a></li>
<li class="calibre7"><a href="#calibre_link-1061" class="calibre4">734</a></li>
<li class="calibre7"><a href="#calibre_link-1062" class="calibre4">735</a></li>
<li class="calibre7"><a href="#calibre_link-1063" class="calibre4">736</a></li>
<li class="calibre7"><a href="#calibre_link-1064" class="calibre4">737</a></li>
</ol>
</nav>
<nav class="pagelist" type="landmarks" id="calibre_link-1299">
<h2 class="calibre5">Guide</h2>
<ol class="calibre6">
<li class="calibre7"><a type="cover" href="cover.xhtml" class="calibre4">Cover</a></li>
<li class="calibre7"><a type="toc" href="#calibre_link-1065" class="calibre4">Table of Contents</a></li>
<li class="calibre7"><a type="introduction" href="#calibre_link-118" class="calibre4">Introduction</a></li>
<li class="calibre7"><a type="part" href="#calibre_link-123" class="calibre4">Part I: The Linux Command Line</a></li>
<li class="calibre7"><a type="chapter" href="#calibre_link-1066" class="calibre4">Begin Reading</a></li>
</ol>
</nav>
<nav type="loi" class="toclist">
<h2 class="calibre5">List of Illustrations</h2>
<ol class="calibre6">
<li class="contentsh1"><a href="#calibre_link-1067" class="calibre4">Figure 1.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1068" class="calibre4">Figure 1.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1069" class="calibre4">Figure 1.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1070" class="calibre4">Figure 1.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1071" class="calibre4">Figure 1.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1072" class="calibre4">Figure 1.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1" class="calibre4">Figure 2.1</a></li>
<li class="contentsh1"><a href="#calibre_link-5" class="calibre4">Figure 2.2</a></li>
<li class="contentsh1"><a href="#calibre_link-7" class="calibre4">Figure 2.3</a></li>
<li class="contentsh1"><a href="#calibre_link-25" class="calibre4">Figure 2.4</a></li>
<li class="contentsh1"><a href="#calibre_link-41" class="calibre4">Figure 2.5</a></li>
<li class="contentsh1"><a href="#calibre_link-57" class="calibre4">Figure 3.1</a></li>
<li class="contentsh1"><a href="#calibre_link-63" class="calibre4">Figure 3.2</a></li>
<li class="contentsh1"><a href="#calibre_link-67" class="calibre4">Figure 3.3</a></li>
<li class="contentsh1"><a href="#calibre_link-102" class="calibre4">Figure 4.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1073" class="calibre4">Figure 5.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1074" class="calibre4">Figure 5.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1075" class="calibre4">Figure 5.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1076" class="calibre4">Figure 7.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1077" class="calibre4">Figure 8.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1078" class="calibre4">Figure 9.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1079" class="calibre4">Figure 10.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1080" class="calibre4">Figure 10.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1081" class="calibre4">Figure 10.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1082" class="calibre4">Figure 10.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1083" class="calibre4">Figure 10.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1084" class="calibre4">Figure 10.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1085" class="calibre4">Figure 10.7</a></li>
<li class="contentsh1"><a href="#calibre_link-1086" class="calibre4">Figure 10.8</a></li>
<li class="contentsh1"><a href="#calibre_link-1087" class="calibre4">Figure 10.9</a></li>
<li class="contentsh1"><a href="#calibre_link-1088" class="calibre4">Figure 10.10</a></li>
<li class="contentsh1"><a href="#calibre_link-1089" class="calibre4">Figure 10.11</a></li>
<li class="contentsh1"><a href="#calibre_link-1090" class="calibre4">Figure 10.12</a></li>
<li class="contentsh1"><a href="#calibre_link-1091" class="calibre4">Figure 10.13</a></li>
<li class="contentsh1"><a href="#calibre_link-1092" class="calibre4">Figure 10.14</a></li>
<li class="contentsh1"><a href="#calibre_link-1093" class="calibre4">Figure 11.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1094" class="calibre4">Figure 11.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1095" class="calibre4">Figure 18.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1096" class="calibre4">Figure 18.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1097" class="calibre4">Figure 18.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1098" class="calibre4">Figure 18.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1099" class="calibre4">Figure 18.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1100" class="calibre4">Figure 18.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1101" class="calibre4">Figure 18.7</a></li>
<li class="contentsh1"><a href="#calibre_link-1102" class="calibre4">Figure 18.8</a></li>
<li class="contentsh1"><a href="#calibre_link-1103" class="calibre4">Figure 18.9</a></li>
<li class="contentsh1"><a href="#calibre_link-1104" class="calibre4">Figure 18.10</a></li>
<li class="contentsh1"><a href="#calibre_link-1105" class="calibre4">Figure 18.11</a></li>
<li class="contentsh1"><a href="#calibre_link-1106" class="calibre4">Figure 18.12</a></li>
<li class="contentsh1"><a href="#calibre_link-1107" class="calibre4">Figure 18.13</a></li>
<li class="contentsh1"><a href="#calibre_link-1108" class="calibre4">Figure 20.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1109" class="calibre4">Figure 21.1</a></li>
<li class="contentsh1"><a href="#calibre_link-48" class="calibre4">Figure 24.1</a></li>
<li class="contentsh1"><a href="#calibre_link-70" class="calibre4">Figure 25.1</a></li>
<li class="contentsh1"><a href="#calibre_link-74" class="calibre4">Figure 25.2</a></li>
</ol>
</nav>
<nav type="lot" class="toclist">
<h2 class="calibre5">List of Tables</h2>
<ol class="calibre6">
<li class="contentsh1"><a href="#calibre_link-1110" class="calibre4">Table 1.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1111" class="calibre4">Table 1.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1112" class="calibre4">Table 1.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1113" class="calibre4">Table 1.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1114" class="calibre4">Table 1.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1115" class="calibre4">Table 1.6</a></li>
<li class="contentsh1"><a href="#calibre_link-3" class="calibre4">Table 2.1</a></li>
<li class="contentsh1"><a href="#calibre_link-9" class="calibre4">Table 2.2</a></li>
<li class="contentsh1"><a href="#calibre_link-11" class="calibre4">Table 2.3</a></li>
<li class="contentsh1"><a href="#calibre_link-13" class="calibre4">Table 2.4</a></li>
<li class="contentsh1"><a href="#calibre_link-15" class="calibre4">Table 2.5</a></li>
<li class="contentsh1"><a href="#calibre_link-17" class="calibre4">Table 2.6</a></li>
<li class="contentsh1"><a href="#calibre_link-19" class="calibre4">Table 2.7</a></li>
<li class="contentsh1"><a href="#calibre_link-21" class="calibre4">Table 2.8</a></li>
<li class="contentsh1"><a href="#calibre_link-23" class="calibre4">Table 2.9</a></li>
<li class="contentsh1"><a href="#calibre_link-27" class="calibre4">Table 2.10</a></li>
<li class="contentsh1"><a href="#calibre_link-29" class="calibre4">Table 2.11</a></li>
<li class="contentsh1"><a href="#calibre_link-31" class="calibre4">Table 2.12</a></li>
<li class="contentsh1"><a href="#calibre_link-33" class="calibre4">Table 2.13</a></li>
<li class="contentsh1"><a href="#calibre_link-35" class="calibre4">Table 2.14</a></li>
<li class="contentsh1"><a href="#calibre_link-37" class="calibre4">Table 2.15</a></li>
<li class="contentsh1"><a href="#calibre_link-39" class="calibre4">Table 2.16</a></li>
<li class="contentsh1"><a href="#calibre_link-43" class="calibre4">Table 2.17</a></li>
<li class="contentsh1"><a href="#calibre_link-45" class="calibre4">Table 2.18</a></li>
<li class="contentsh1"><a href="#calibre_link-59" class="calibre4">Table 3.1</a></li>
<li class="contentsh1"><a href="#calibre_link-61" class="calibre4">Table 3.2</a></li>
<li class="contentsh1"><a href="#calibre_link-65" class="calibre4">Table 3.3</a></li>
<li class="contentsh1"><a href="#calibre_link-96" class="calibre4">Table 4.1</a></li>
<li class="contentsh1"><a href="#calibre_link-98" class="calibre4">Table 4.2</a></li>
<li class="contentsh1"><a href="#calibre_link-100" class="calibre4">Table 4.3</a></li>
<li class="contentsh1"><a href="#calibre_link-104" class="calibre4">Table 4.4</a></li>
<li class="contentsh1"><a href="#calibre_link-106" class="calibre4">Table 4.5</a></li>
<li class="contentsh1"><a href="#calibre_link-108" class="calibre4">Table 4.6</a></li>
<li class="contentsh1"><a href="#calibre_link-110" class="calibre4">Table 4.7</a></li>
<li class="contentsh1"><a href="#calibre_link-112" class="calibre4">Table 4.8</a></li>
<li class="contentsh1"><a href="#calibre_link-114" class="calibre4">Table 4.9</a></li>
<li class="contentsh1"><a href="#calibre_link-1116" class="calibre4">Table 5.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1117" class="calibre4">Table 6.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1118" class="calibre4">Table 6.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1119" class="calibre4">Table 7.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1120" class="calibre4">Table 7.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1121" class="calibre4">Table 7.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1122" class="calibre4">Table 7.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1123" class="calibre4">Table 7.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1124" class="calibre4">Table 7.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1125" class="calibre4">Table 8.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1126" class="calibre4">Table 8.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1127" class="calibre4">Table 8.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1128" class="calibre4">Table 8.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1129" class="calibre4">Table 8.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1130" class="calibre4">Table 8.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1131" class="calibre4">Table 9.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1132" class="calibre4">Table 9.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1133" class="calibre4">Table 9.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1134" class="calibre4">Table 9.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1135" class="calibre4">Table 9.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1136" class="calibre4">Table 9.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1137" class="calibre4">Table 9.7</a></li>
<li class="contentsh1"><a href="#calibre_link-1138" class="calibre4">Table 10.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1139" class="calibre4">Table 10.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1140" class="calibre4">Table 10.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1141" class="calibre4">Table 10.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1142" class="calibre4">Table 10.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1143" class="calibre4">Table 11.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1144" class="calibre4">Table 11.2</a></li>
<li class="contentsh1"><a href="#calibre_link-79" class="calibre4">Table 12.1</a></li>
<li class="contentsh1"><a href="#calibre_link-81" class="calibre4">Table 12.2</a></li>
<li class="contentsh1"><a href="#calibre_link-83" class="calibre4">Table 12.3</a></li>
<li class="contentsh1"><a href="#calibre_link-85" class="calibre4">Table 12.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1145" class="calibre4">Table 14.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1146" class="calibre4">Table 15.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1147" class="calibre4">Table 15.2</a></li>
<li class="contentsh1"><a href="#calibre_link-52" class="calibre4">Table 16.1</a></li>
<li class="contentsh1"><a href="#calibre_link-54" class="calibre4">Table 16.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1148" class="calibre4">Table 17.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1149" class="calibre4">Table 18.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1150" class="calibre4">Table 18.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1151" class="calibre4">Table 18.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1152" class="calibre4">Table 18.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1153" class="calibre4">Table 19.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1154" class="calibre4">Table 19.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1155" class="calibre4">Table 20.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1156" class="calibre4">Table 21.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1157" class="calibre4">Table 22.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1158" class="calibre4">Table 22.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1159" class="calibre4">Table 22.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1160" class="calibre4">Table 22.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1161" class="calibre4">Table 22.5</a></li>
<li class="contentsh1"><a href="#calibre_link-1162" class="calibre4">Table 22.6</a></li>
<li class="contentsh1"><a href="#calibre_link-1163" class="calibre4">Table 23.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1164" class="calibre4">Table 23.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1165" class="calibre4">Table 23.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1166" class="calibre4">Table 23.4</a></li>
<li class="contentsh1"><a href="#calibre_link-1167" class="calibre4">Table 23.5</a></li>
<li class="contentsh1"><a href="#calibre_link-72" class="calibre4">Table 25.1</a></li>
<li class="contentsh1"><a href="#calibre_link-76" class="calibre4">Table 25.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1168" class="calibre4">Table A.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1169" class="calibre4">Table A.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1170" class="calibre4">Table A.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1171" class="calibre4">Table B.1</a></li>
<li class="contentsh1"><a href="#calibre_link-1172" class="calibre4">Table B.2</a></li>
<li class="contentsh1"><a href="#calibre_link-1173" class="calibre4">Table B.3</a></li>
<li class="contentsh1"><a href="#calibre_link-1174" class="calibre4">Table B.4</a></li>
</ol>
</nav>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-118">
<section class="toclist" type="introduction">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1300" class="calibre4"></a>Introduction</h1>
</header>
<p class="calibre10"><span type="pagebreak" title="xxxi" id="calibre_link-1301" class="calibre11"></span>Welcome to the third edition of <i class="calibre12">Linux Command Line and Shell Scripting Bible</i>. Like all books in the <i class="calibre12">Bible</i> series, you can expect to find both hands-on tutorials and real-world information, as well as reference and background information that provide a context for what you are learning. This book is a fairly comprehensive resource on the Linux command line and shell commands. By the time you have completed <i class="calibre12">Linux Command Line and Shell Scripting Bible,</i> you will be well prepared to write your own shell scripts that can automate practically any task on your Linux system.</p>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-119" class="calibre4"></a>Who Should Read This Book</h2>
<p class="calibre10">If you're a system administrator in a Linux environment, you'll benefit greatly by knowing how to write shell scripts. The book doesn't walk you through the process of setting up a Linux system, but after you have it running, you'll want to start automating some of the routine administrative tasks. That's where shell scripting comes in, and that's where this book helps you out. This book demonstrates how to automate any administrative task using shell scripts, from monitoring system statistics and data files to generating reports for your boss.</p>
<p class="calibre10">If you're a home Linux enthusiast, you'll also benefit from <i class="calibre12">Linux Command Line and Shell Scripting Bible</i>. Nowadays, it's easy to get lost in the graphical world of pre-built widgets. Most desktop Linux distributions try their best to hide the Linux system from the typical user. However, sometimes you must know what's going on under the hood. This book shows you how to access the Linux command line prompt and what to do when you get there. Often, performing simple tasks, such as file management, can be done more quickly from the command line than from a fancy graphical interface. You can use a wealth of commands from the command line, and this book shows you how to use them.</p>
</section>
<section class="toclist">
<div class="calibre13"></div><h2 class="calibre5"><a id="calibre_link-120" class="calibre4"></a>How This Book Is Organized</h2>
<p class="calibre10">This book leads you through the basics of the Linux command line and into more complicated topics, such as creating your own shell scripts. The book is divided into four parts, each one building on the previous parts.</p>
<p class="calibre10">Part I assumes that you either have a Linux system running or are looking into getting a Linux system. Chapter 1, âStarting with Linux Shells,â describes the parts of a total Linux system and shows how the shell fits in. After describing the basics of the Linux system, this part continues with the following:</p>
<ul class="calibre14">
<li class="calibre7">Using<span type="pagebreak" title="xxxii" id="calibre_link-1302" class="calibre11"></span> a terminal emulation package to access the shell (Chapter 2)</li>
<li class="calibre7">Introducing the basic shell commands (Chapter 3)</li>
<li class="calibre7">Using more advanced shell commands to peek at system information (Chapter 4)</li>
<li class="calibre7">Understanding what the shell is used for (Chapter 5)</li>
<li class="calibre7">Working with shell variables to manipulate data (Chapter 6)</li>
<li class="calibre7">Understanding the Linux filesystem and security (Chapter 7)</li>
<li class="calibre7">Working with Linux filesystems from the command line (Chapter 8)</li>
<li class="calibre7">Installing and updating software from the command line (Chapter 9)</li>
<li class="calibre7">Using the Linux editors to start writing shell scripts (Chapter 10)</li>
</ul>
<p class="calibre10">In Part II, you begin writing shell scripts. As you go through the chapters, you'll do the following:</p>
<ul class="calibre14">
<li class="calibre7">Learn how to create and run shell scripts (Chapter 11)</li>
<li class="calibre7">Alter the program flow in a shell script (Chapter 12)</li>
<li class="calibre7">Iterate through code sections (Chapter 13)</li>
<li class="calibre7">Handle data from the user in your scripts (Chapter 14)</li>
<li class="calibre7">See different methods for storing and displaying data from your Script (Chapter 15)</li>
<li class="calibre7">Control how and when your shell scripts run on the system (Chapter 16)</li>
</ul>
<p class="calibre10">Part III dives into more advanced areas of shell script programming, including these things:</p>
<ul class="calibre14">
<li class="calibre7">Creating your own functions to use in all your scripts (Chapter 17)</li>
<li class="calibre7">Utilizing the Linux graphical desktop for interacting with your script users (Chapter 18)</li>
<li class="calibre7">Using advanced Linux commands to filter and parse data files (Chapter 19)</li>
<li class="calibre7">Using regular expressions to define data (Chapter 20)</li>
<li class="calibre7">Learning advanced methods of manipulating data in your scripts (Chapter 21)</li>
<li class="calibre7">Generating reports from raw data (Chapter 22)</li>
<li class="calibre7">Modifying your shell scripts to run in other Linux shells (Chapter 23)</li>
</ul>
<p class="calibre10">The last section of the book, Part IV, demonstrates how to use shell scripts in real-world environments. In this part, you will learn these things:</p>
<ul class="calibre14">
<li class="calibre7">How to put all the scripting features together to write your own scripts (Chapter 24)</li>
<li class="calibre7">How<span type="pagebreak" title="xxxiii" id="calibre_link-1303" class="calibre11"></span> to store and retrieve data using databases, access data on the Internet, and send e-mail messages (Chapter 25)</li>
<li class="calibre7">Write more advanced shell scripts to interact on your Linux system (Chapter 26)</li>
</ul>
<section class="toclist">
<h3 class="calibre15">Cautions, Tips, and Notes</h3>
<p class="calibre10">You will find many different organizational and typographical features throughout this book designed to help you get the most of the information.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">This information is important and is set off in a separate paragraph with a special icon. Cautions provide information about things to watch out for, whether simply inconvenient or potentially hazardous to your data or systems.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Tips provide helpful advice to make your work easier and more effective. Tips may suggest a solution to a problem or a better way to accomplish a task.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Notes provide additional, ancillary information that is helpful, but somewhat outside of the current presentation of information.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Downloadable code</h3>
<p class="calibre10">You can obtain the book's code files at <a href="http://www.wiley.com/go/linuxcommandline" class="calibre4">www.wiley.com/go/linuxcommandline</a>.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-121" class="calibre4"></a>Minimum Requirements</h2>
<p class="calibre10"><i class="calibre12">Linux Command Line and Shell Scripting Bible</i> doesn't focus on any specific Linux distribution, so you can follow along in the book using any Linux system you have available. The bulk of the book references the bash shell, which is the default shell for most Linux systems.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-122" class="calibre4"></a>Where to Go from Here</h2>
<p class="calibre10"><span type="pagebreak" title="xxxiv" id="calibre_link-1304" class="calibre11"></span>After you've finished reading <i class="calibre12">Linux Command Line and Shell Scripting Bible</i>, you're well on your way to incorporating Linux commands in your daily Linux work. In the ever-changing world of Linux, it's always a good idea to stay in touch with new developments. Often, Linux distributions change, adding new features and removing older ones. To keep your knowledge of Linux fresh, always stay well-informed. Find a good Linux forum site and monitor what's happening in the Linux world. Many popular Linux news sites, such as Slashdot and Distrowatch, provide up-to-the-minute information about new advances in Linux.</p>
</section>
</section>
</div>


<div class="calibre1" id="calibre_link-123">
<header class="calibre8">
<h1 class="calibre9"><span class="chaptertitle">Part I</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5"><span type="pagebreak" title="1" id="calibre_link-1305" class="calibre20"></span>The Linux Command Line</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Part</h1>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1066" class="calibre4"><b class="calibre21">Chapter 1</b> Starting with Linux Shells</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-0" class="calibre4"><b class="calibre21">Chapter 2</b> Getting to the Shell</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-56" class="calibre4"><b class="calibre21">Chapter 3</b> Basic bash Shell Commands</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-95" class="calibre4"><b class="calibre21">Chapter 4</b> More bash Shell Commands</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1180" class="calibre4"><b class="calibre21">Chapter 5</b> Understanding the Shell</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1206" class="calibre4"><b class="calibre21">Chapter 6</b> Using Linux Environment Variables</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1219" class="calibre4"><b class="calibre21">Chapter 7</b> Understanding Linux File Permissions</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1230" class="calibre4"><b class="calibre21">Chapter 8</b> Managing Filesystems</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1241" class="calibre4"><b class="calibre21">Chapter 9</b> Installing Software</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1256" class="calibre4"><b class="calibre21">Chapter 10</b> Working with Editors</a></li>
</ol>
</section>
</aside>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1066">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-124" class="calibre4"></a><span class="chaptertitle">Chapter 1</span><br class="calibre22" /><span class="chaptertitle">Starting with Linux Shells</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">What is Linux?</li>
<li class="calibre7">Parts of the Linux kernel</li>
<li class="calibre7">Exploring the Linux desktop</li>
<li class="calibre7">Visiting Linux distributions</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="3" id="calibre_link-347" class="calibre11"></span>Before you can dive into working with the Linux command line and shells, you should first understand what Linux is, where it came from, and how it works. This chapter walks you through what Linux is and explains where the shell and command line fit in the overall Linux picture.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-125" class="calibre4"></a>What Is Linux?</h2>
<p class="calibre10">If you've never worked with Linux before, you may be confused about why so many different versions are available. I'm sure you have been confused by various terms such as distribution, LiveCD, and GNU when looking at Linux packages. Wading through the world of Linux for the first time can be a tricky experience. This chapter takes some of the mystery out of the Linux system before you start working on commands and scripts.</p>
<p class="calibre10">First, four main parts make up a Linux system:</p>
<ul class="calibre14">
<li class="calibre7">The Linux kernel</li>
<li class="calibre7">The GNU utilities</li>
<li class="calibre7">A graphical desktop environment</li>
<li class="calibre7">Application software</li>
</ul>
<p class="calibre10">Each of these parts has a specific job in the Linux system. No part is very useful by itself. <a id="calibre_link-1286" href="#calibre_link-1067" class="calibre4">Figure 1.1</a> shows a basic diagram of how the parts fit together to create the overall Linux system.</p>
<figure class="calibre23">
<img class="center" src="images/000012.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1067" href="#calibre_link-1286" class="calibre4"><b class="calibre21">Figure 1.1</b></a></span> The Linux system</p>
</figcaption>
</figure>
<p class="calibre10">This section describes these four main parts in detail and gives you an overview of how they work together to create a complete Linux system.</p>
<section class="toclist">
<h3 class="calibre15">Looking into the Linux Kernel</h3>
<p class="calibre10"><span type="pagebreak" title="4" id="calibre_link-348" class="calibre11"></span>The core of the Linux system is the <i class="calibre12">kernel</i>. The kernel controls all the hardware and software on the computer system, allocating hardware when necessary and executing software when required.</p>
<p class="calibre10">If you've been following the Linux world at all, no doubt you've heard the name Linus Torvalds. Linus is the person responsible for creating the first Linux kernel software when he was a student at the University of Helsinki. He intended it to be a copy of the Unix system, at the time a popular operating system used at many universities.</p>
<p class="calibre10">After developing the Linux kernel, Linus released it to the Internet community and solicited suggestions for improving it. This simple process started a revolution in the world of computer operating systems. Soon Linus was receiving suggestions from students as well as professional programmers from around the world.</p>
<p class="calibre10">Allowing anyone to change programming code in the kernel would result in complete chaos. To simplify things, Linus acted as a central point for all improvement suggestions. It was ultimately Linus's decision whether or not to incorporate suggested code in the kernel. This same concept is still in place with the Linux kernel code, except that instead of just Linus controlling the kernel code, a team of developers has taken on the task.</p>
<p class="calibre10"><span type="pagebreak" title="5" id="calibre_link-349" class="calibre11"></span>The kernel is primarily responsible for four main functions:</p>
<ul class="calibre14">
<li class="calibre7">System memory management</li>
<li class="calibre7">Software program management</li>
<li class="calibre7">Hardware management</li>
<li class="calibre7">Filesystem management</li>
</ul>
<p class="calibre10">The following sections explore each of these functions in more detail.</p>
<section class="toclist">
<h4 class="calibre25">System Memory Management</h4>
<p class="calibre10">One of the primary functions of the operating system kernel is memory management. Not only does the kernel manage the physical memory available on the server, but it can also create and manage virtual memory, or memory that does not actually exist.</p>
<p class="calibre10">It does this by using space on the hard disk, called the <i class="calibre12">swap sp</i>ace. The kernel swaps the contents of virtual memory locations back and forth from the swap space to the actual physical memory. This allows the system to think there is more memory available than what physically exists, as shown in <a id="calibre_link-1287" href="#calibre_link-1068" class="calibre4">Figure 1.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000030.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1068" href="#calibre_link-1287" class="calibre4"><b class="calibre21">Figure 1.2</b></a></span> The Linux system memory map</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="6" id="calibre_link-350" class="calibre11"></span>The memory locations are grouped into blocks called <i class="calibre12">pages</i>. The kernel locates each page of memory either in the physical memory or the swap space. The kernel then maintains a table of the memory pages that indicates which pages are in physical memory and which pages are swapped out to disk.</p>
<p class="calibre10">The kernel keeps track of which memory pages are in use and automatically copies memory pages that have not been accessed for a period of time to the swap space area (called <i class="calibre12">swapping out</i>), even if there's other memory available. When a program wants to access a memory page that has been swapped out, the kernel must make room for it in physical memory by swapping out a different memory page and swapping in the required page from the swap space. Obviously, this process takes time and can slow down a running process. The process of swapping out memory pages for running applications continues for as long as the Linux system is running.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Software Program Management</h4>
<p class="calibre10">The Linux operating system calls a running program a <i class="calibre12">process</i>. A process can run in the foreground, displaying output on a display, or it can run in the background, behind the scenes. The kernel controls how the Linux system manages all the processes running on the system.</p>
<p class="calibre10">The kernel creates the first process, called the <i class="calibre12">init process</i>, to start all other processes on the system. When the kernel starts, it loads the init process into virtual memory. As the kernel starts each additional process, it gives it a unique area in virtual memory to store the data and code that the process uses.</p>
<p class="calibre10">Some Linux implementations contain a table of processes to start automatically on bootup. On Linux systems, this table is usually located in the special file <code class="calibre26">/etc/inittabs</code>.</p>
<p class="calibre10">Other systems (such as the popular Ubuntu Linux distribution) utilize the <code class="calibre26">/etc/init.d</code> folder, which contains scripts for starting and stopping individual applications at boot time. The scripts are started via entries under the <code class="calibre26">/etc/rcX.d</code> folders, where <i class="calibre12">X</i> is a <i class="calibre12">run level</i>.</p>
<p class="calibre10">The Linux operating system uses an init system that utilizes run levels. A run level can be used to direct the init process to run only certain types of processes, as defined in the <code class="calibre26">/etc/inittabs</code> file or the <code class="calibre26">/etc/rcX.d</code> folders. There are five init run levels in the Linux operating system.</p>
<p class="calibre10">At run level 1, only the basic system processes are started, along with one console terminal process. This is called <i class="calibre12">single-use</i>r mode. Single-user mode is most often used for emergency filesystem maintenance when something is broken. Obviously, in this mode, only one person (usually the administrator) can log in to the system to manipulate data.</p>
<p class="calibre10">The standard init run level is 3. At this run level, most application software, such as network support software, is started. Another popular run level in Linux is run level 5. This is the run level where the system starts the graphical X Window software and allows you to log in using a graphical desktop window.</p>
<p class="calibre10"><span type="pagebreak" title="7" id="calibre_link-351" class="calibre11"></span>The Linux system can control the overall system functionality by controlling the init run level. By changing the run level from 3 to 5, the system can change from a console-based system to an advanced, graphical X Window system.</p>
<p class="calibre10">In Chapter 4, you'll see how to use the <code class="calibre26">ps</code> command to view the processes currently running on the Linux system.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Hardware Management</h4>
<p class="calibre10">Still another responsibility for the kernel is hardware management. Any device that the Linux system must communicate with needs driver code inserted inside the kernel code. The driver code allows the kernel to pass data back and forth to the device, acting as a middle man between applications and the hardware. Two methods are used for inserting device driver code in the Linux kernel:</p>
<ul class="calibre14">
<li class="calibre7">Drivers compiled in the kernel</li>
<li class="calibre7">Driver modules added to the kernel</li>
</ul>
<p class="calibre10">Previously, the only way to insert device driver code was to recompile the kernel. Each time you added a new device to the system, you had to recompile the kernel code. This process became even more inefficient as Linux kernels supported more hardware. Fortunately, Linux developers devised a better method to insert driver code into the running kernel.</p>
<p class="calibre10">Programmers developed the concept of kernel modules to allow you to insert driver code into a running kernel without having to recompile the kernel. Also, a kernel module could be removed from the kernel when the device was finished being used. This greatly simplified and expanded using hardware with Linux.</p>
<p class="calibre10">The Linux system identifies hardware devices as special files, called <i class="calibre12">device files</i>. There are three classifications of device files:</p>
<ul class="calibre14">
<li class="calibre7">Character</li>
<li class="calibre7">Block</li>
<li class="calibre7">Network</li>
</ul>
<p class="calibre10">Character device files are for devices that can only handle data one character at a time. Most types of modems and terminals are created as character files. Block files are for devices that can handle data in large blocks at a time, such as disk drives.</p>
<p class="calibre10">The network file types are used for devices that use packets to send and receive data. This includes network cards and a special loopback device that allows the Linux system to communicate with itself using common network programming protocols.</p>
<p class="calibre10">Linux creates special files, called <i class="calibre12">nodes</i>, for each device on the system. All communication with the device is performed through the device node. Each node has a unique number pair that identifies it to the Linux kernel. The number pair includes a major and a minor device number. Similar devices are grouped into the same major device number. The minor device number is used to identify a specific device within the major device group.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Filesystem Management</h4>
<p class="calibre10"><span type="pagebreak" title="8" id="calibre_link-352" class="calibre11"></span>Unlike some other operating systems, the Linux kernel can support different types of filesystems to read and write data to and from hard drives. Besides having over a dozen filesystems of its own, Linux can read and write to and from filesystems used by other operating systems, such as Microsoft Windows. The kernel must be compiled with support for all types of filesystems that the system will use. <a id="calibre_link-1288" href="#calibre_link-1110" class="calibre4">Table 1.1</a> lists the standard filesystems that a Linux system can use to read and write data.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1110" href="#calibre_link-1288" class="calibre4"><b class="calibre21">Table 1.1</b></a></span> Linux Filesystems</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Filesystem</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">ext</td>
<td class="left">Linux Extended filesystem &mdash; the original Linux filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">ext2</td>
<td class="left">Second extended filesystem, provided advanced features over ext</td>
</tr>
<tr class="calibre28">
<td class="left">ext3</td>
<td class="left">Third extended filesystem, supports journaling</td>
</tr>
<tr class="calibre28">
<td class="left">ext4</td>
<td class="left">Fourth extended filesystem, supports advanced journaling</td>
</tr>
<tr class="calibre28">
<td class="left">hpfs</td>
<td class="left">OS/2 high-performance filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">jfs</td>
<td class="left">IBM's journaling filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">iso9660</td>
<td class="left">ISO 9660 filesystem (CD-ROMs)</td>
</tr>
<tr class="calibre28">
<td class="left">minix</td>
<td class="left">MINIX filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">msdos</td>
<td class="left">Microsoft FAT16</td>
</tr>
<tr class="calibre28">
<td class="left">ncp</td>
<td class="left">Netware filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">nfs</td>
<td class="left">Network File System</td>
</tr>
<tr class="calibre28">
<td class="left">ntfs</td>
<td class="left">Support for Microsoft NT filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">proc</td>
<td class="left">Access to system information</td>
</tr>
<tr class="calibre28">
<td class="left">ReiserFS</td>
<td class="left">Advanced Linux filesystem for better performance and disk recovery</td>
</tr>
<tr class="calibre28">
<td class="left">smb</td>
<td class="left">Samba SMB filesystem for network access</td>
</tr>
<tr class="calibre28">
<td class="left">sysv</td>
<td class="left">Older Unix filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">ufs</td>
<td class="left">BSD filesystem</td>
</tr>
<tr class="calibre28">
<td class="left">umsdos</td>
<td class="left">Unix-like filesystem that resides on top of msdos</td>
</tr>
<tr class="calibre28">
<td class="left">vfat</td>
<td class="left">Windows 95 filesystem (FAT32)</td>
</tr>
<tr class="calibre28">
<td class="left">XFS</td>
<td class="left">High-performance 64-bit journaling filesystem</td>
</tr>
</table>
</figure>
<p class="calibre10">Any hard drive that a Linux server accesses must be formatted using one of the filesystem types listed in <a href="#calibre_link-1110" class="calibre4">Table 1.1</a>.</p>
<p class="calibre10"><span type="pagebreak" title="9" id="calibre_link-353" class="calibre11"></span>The Linux kernel interfaces with each filesystem using the Virtual File System (VFS). This provides a standard interface for the kernel to communicate with any type of filesystem. VFS caches information in memory as each filesystem is mounted and used.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The GNU Utilities</h3>
<p class="calibre10">Besides having a kernel to control hardware devices, a computer operating system needs utilities to perform standard functions, such as controlling files and programs. While Linus created the Linux system kernel, he had no system utilities to run on it. Fortunately for him, at the same time he was working, a group of people were working together on the Internet trying to develop a standard set of computer system utilities that mimicked the popular Unix operating system.</p>
<p class="calibre10">The GNU organization (GNU stands for GNU's Not Unix) developed a complete set of Unix utilities, but had no kernel system to run them on. These utilities were developed under a software philosophy called open source software (OSS).</p>
<p class="calibre10">The concept of OSS allows programmers to develop software and then release it to the world with no licensing fees attached. Anyone can use the software, modify it, or incorporate it into his or her own system without having to pay a license fee. Uniting Linus's Linux kernel with the GNU operating system utilities created a complete, functional, free operating system.</p>
<p class="calibre10">While the bundling of the Linux kernel and GNU utilities is often just called Linux, you will see some Linux purists on the Internet refer to it as the GNU/Linux system to give credit to the GNU organization for its contributions to the cause.</p>
<section class="toclist">
<h4 class="calibre25">The Core GNU Utilities</h4>
<p class="calibre10">The GNU project was mainly designed for Unix system administrators to have a Unix-like environment available. This focus resulted in the project porting many common Unix system command line utilities. The core bundle of utilities supplied for Linux systems is called the <i class="calibre12">coreutils</i> package.</p>
<p class="calibre10">The GNU coreutils package consists of three parts:</p>
<ul class="calibre14">
<li class="calibre7">Utilities for handling files</li>
<li class="calibre7">Utilities for manipulating text</li>
<li class="calibre7">Utilities for managing processes</li>
</ul>
<p class="calibre10">Each of these three main groups of utilities contains several utility programs that are invaluable to the Linux system administrator and programmer. This book covers each of the utilities contained in the GNU coreutils package in detail.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The Shell</h4>
<p class="calibre10">The GNU/Linux shell is a special interactive utility. It provides a way for users to start programs, manage files on the filesystem, and manage processes running on the Linux system. The core of the shell is the command prompt. The command prompt is the interactive part of the shell. It allows you to enter text commands, and then it interprets the commands and executes them in the kernel.</p>
<p class="calibre10"><span type="pagebreak" title="10" id="calibre_link-354" class="calibre11"></span>The shell contains a set of internal commands that you use to control things such as copying files, moving files, renaming files, displaying the programs currently running on the system, and stopping programs running on the system. Besides the internal commands, the shell also allows you to enter the name of a program at the command prompt. The shell passes the program name off to the kernel to start it.</p>
<p class="calibre10">You can also group shell commands into files to execute as a program. Those files are called <i class="calibre12">shell scripts</i>. Any command that you can execute from the command line can be placed in a shell script and run as a group of commands. This provides great flexibility in creating utilities for commonly run commands, or processes that require several commands grouped together.</p>
<p class="calibre10">There are quite a few Linux shells available to use on a Linux system. Different shells have different characteristics, some being more useful for creating scripts and some being more useful for managing processes. The default shell used in all Linux distributions is the bash shell. The bash shell was developed by the GNU project as a replacement for the standard Unix shell, called the Bourne shell (after its creator). The bash shell name is a play on this wording, referred to as the âBourne again shell.â</p>
<p class="calibre10">In addition to the bash shell, we will cover several other popular shells in this book. <a id="calibre_link-1289" href="#calibre_link-1111" class="calibre4">Table 1.2</a> lists the different shells we will examine.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1111" href="#calibre_link-1289" class="calibre4"><b class="calibre21">Table 1.2</b></a></span> Linux Shells</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Shell</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">ash</td>
<td class="left">A simple, lightweight shell that runs in low-memory environments but has full compatibility with the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left">korn</td>
<td class="left">A programming shell compatible with the Bourne shell but supporting advanced programming features like associative arrays and floating-point arithmetic</td>
</tr>
<tr class="calibre28">
<td class="left">tcsh</td>
<td class="left">A shell that incorporates elements from the C programming language into shell scripts</td>
</tr>
<tr class="calibre28">
<td class="left">zsh</td>
<td class="left">An advanced shell that incorporates features from bash, tcsh, and korn, providing advanced programming features, shared history files, and themed prompts</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="11" id="calibre_link-355" class="calibre11"></span>Most Linux distributions include more than one shell, although usually they pick one of them to be the default. If your Linux distribution includes multiple shells, feel free to experiment with different shells and see which one fits your needs.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The Linux Desktop Environment</h3>
<p class="calibre10">In the early days of Linux (the early 1990s) all that was available was a simple text interface to the Linux operating system. This text interface allowed administrators to start programs, control program operations, and move files around on the system.</p>
<p class="calibre10">With the popularity of Microsoft Windows, computer users expected more than the old text interface to work with. This spurred more development in the OSS community, and the Linux graphical desktops emerged.</p>
<p class="calibre10">Linux is famous for being able to do things in more than one way, and no place is this more relevant than in graphical desktops. There are a plethora of graphical desktops you can choose from in Linux. The following sections describe a few of the more popular ones.</p>
<section class="toclist">
<h4 class="calibre25">The X Window System</h4>
<p class="calibre10">Two basic elements control your video environment: the video card in your PC and your monitor. To display fancy graphics on your computer, the Linux software needs to know how to talk to both of them. The X Window software is the core element in presenting graphics.</p>
<p class="calibre10">The X Window software is a low-level program that works directly with the video card and monitor in the PC, and it controls how Linux applications can present fancy windows and graphics on your computer.</p>
<p class="calibre10">Linux isn't the only operating system that uses X Window; versions are written for many different operating systems. In the Linux world, several different software packages can implement it.</p>
<p class="calibre10">The most popular package is X.org. It provides an open source software implementation of the X Window system and supports many of the newer video cards used today.</p>
<p class="calibre10">Two other X Window packages are gaining in popularity. The Fedora Linux distribution is experimenting with the Wayland software, and the Ubuntu Linux distribution has developed the Mir display server for use with its desktop environment.</p>
<p class="calibre10">When you first install a Linux distribution, it attempts to detect your video card and monitor, and then it creates an X Window configuration file that contains the required information. During installation, you may notice a time when the installation program scans your monitor for supported video modes. Sometimes, this causes your monitor to go blank for a few seconds. Because there are lots of different types of video cards and monitors, this process can take a while to complete.</p>
<p class="calibre10"><span type="pagebreak" title="12" id="calibre_link-356" class="calibre11"></span>The core X Window software produces a graphical display environment, but nothing else. Although this is fine for running individual applications, it is not useful for day-to-day computer use. No desktop environment allows users to manipulate files or launch programs. To do that, you need a desktop environment on top of the X Window system software.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The KDE Desktop</h4>
<p class="calibre10">The K Desktop Environment (KDE) was first released in 1996 as an open source project to produce a graphical desktop similar to the Microsoft Windows environment. The KDE desktop incorporates all the features you are probably familiar with if you are a Windows user. <a id="calibre_link-1290" href="#calibre_link-1069" class="calibre4">Figure 1.3</a> shows a sample KDE 4 desktop running in the openSUSE Linux distribution.</p>
<figure class="calibre23">
<img class="center" src="images/000036.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1069" href="#calibre_link-1290" class="calibre4"><b class="calibre21">Figure 1.3</b></a></span> The KDE 4 desktop on an openSUSE Linux system</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="13" id="calibre_link-357" class="calibre11"></span>The KDE desktop allows you to place both application and file icons in a special area on the desktop. If you click an application icon, the Linux system starts the application. If you click a file icon, the KDE desktop attempts to determine what application to start to handle the file.</p>
<p class="calibre10">The bar at the bottom of the desktop is called the Panel. The Panel consists of four parts:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">The K menu:</b> Much like the Windows Start menu, the K menu contains links to start installed applications.</li>
<li class="calibre7"><b class="calibre21">Program shortcuts:</b> These are quick links to start applications directly from the Panel.</li>
<li class="calibre7"><b class="calibre21">The taskbar:</b> The taskbar shows icons for applications currently running on the desktop.</li>
<li class="calibre7"><b class="calibre21">Applets:</b> These are small applications that have an icon in the Panel that often can change depending on information from the application.</li>
</ul>
<p class="calibre10">The Panel features are similar to what you would find in Windows. In addition to the desktop features, the KDE project has produced a wide assortment of applications that run in the KDE environment.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The GNOME Desktop</h4>
<p class="calibre10">The GNU Network Object Model Environment (GNOME) is another popular Linux desktop environment. First released in 1999, GNOME has become the default desktop environment for many Linux distributions. (However, the most popular is Red Hat Linux.)</p>
<p class="calibre10">Although GNOME chose to depart from the standard Microsoft Windows look-and-feel, it incorporates many features that most Windows users are comfortable with:</p>
<ul class="calibre14">
<li class="calibre7">A desktop area for icons</li>
<li class="calibre7">A panel area for showing running applications</li>
<li class="calibre7">Drag-and-drop capabilities</li>
</ul>
<p class="calibre10"><a id="calibre_link-1291" href="#calibre_link-1070" class="calibre4">Figure 1.4</a> shows the standard GNOME desktop used in the CentOS Linux distribution.</p>
<figure class="calibre23">
<img class="center" src="images/000022.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1070" href="#calibre_link-1291" class="calibre4"><b class="calibre21">Figure 1.4</b></a></span> A GNOME desktop on a CentOS Linux system</p>
</figcaption>
</figure>
<p class="calibre10">Not to be outdone by KDE, the GNOME developers have also produced a host of graphical applications that integrate with the GNOME desktop.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The Unity Desktop</h4>
<p class="calibre10">If you're using the Ubuntu Linux distribution, you'll notice that it's somewhat different from both the KDE and GNOME desktop environments. Canonical, the company responsible for developing Ubuntu, has decided to embark on its own Linux desktop environment, called Unity.</p>
<p class="calibre10"><span type="pagebreak" title="14" id="calibre_link-358" class="calibre11"></span>The Unity desktop gets its name from the goal of the project &mdash; to provide a single desktop experience for workstations, tablet devices, and mobile devices. The Unity desktop works the same whether you're running Ubuntu on a workstation or a mobile phone! <a id="calibre_link-1292" href="#calibre_link-1071" class="calibre4">Figure 1.5</a> shows an example of the Unity desktop in Ubuntu 14.04 LTS.</p>
<figure class="calibre23">
<img class="center" src="images/000013.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1071" href="#calibre_link-1292" class="calibre4"><b class="calibre21">Figure 1.5</b></a></span> The Unity desktop on the Ubuntu Linux distribution</p>
</figcaption>
</figure>
</section>
<section class="toclist">
<h4 class="calibre25">Other Desktops</h4>
<p class="calibre10">The downside to a graphical desktop environment is that it requires a fair amount of system resources to operate properly. In the early days of Linux, a hallmark and selling feature of Linux was its ability to operate on older, less powerful PCs that the newer Microsoft desktop products couldn't run on. However, with the popularity of KDE and GNOME desktops, this has changed, because it takes just as much memory to run a KDE or GNOME desktop as the latest Microsoft desktop environment.</p>
<p class="calibre10"><span type="pagebreak" title="15" id="calibre_link-359" class="calibre11"></span>If you have an older PC, don't be discouraged. The Linux developers have banded together to take Linux back to its roots. They've created several low-memory&ndash;oriented graphical desktop applications that provide basic features that run perfectly fine on older PCs.</p>
<p class="calibre10">Although these graphical desktops don't have a plethora of applications designed around them, they still run many basic graphical applications that support features such as word processing, spreadsheets, databases, drawing, and, of course, multimedia support.</p>
<p class="calibre10"><a id="calibre_link-1293" href="#calibre_link-1112" class="calibre4">Table 1.3</a> shows some of the smaller Linux graphical desktop environments that can be used on lower-powered PCs and laptops.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1112" href="#calibre_link-1293" class="calibre4"><b class="calibre21">Table 1.3</b></a></span> Other Linux Graphical Desktops</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Desktop</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Fluxbox</td>
<td class="left">A bare-bones desktop that doesn't include a Panel, only a pop-up menu to launch applications</td>
</tr>
<tr class="calibre28">
<td class="left">Xfce</td>
<td class="left">A desktop that's similar to the KDE desktop, but with fewer graphics for low-memory environments</td>
</tr>
<tr class="calibre28">
<td class="left">JWM</td>
<td class="left">Joe's Window Manager, a very lightweight desktop ideal for low-memory and low-disk space environments</td>
</tr>
<tr class="calibre28">
<td class="left">Fvwm</td>
<td class="left">Supports some advanced desktop features such as virtual desktops and Panels, but runs in low-memory environments</td>
</tr>
<tr class="calibre28">
<td class="left">fvwm95</td>
<td class="left">Derived from fvwm, but made to look like a Windows 95 desktop</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="16" id="calibre_link-360" class="calibre11"></span>These graphical desktop environments are not as fancy as the KDE and GNOME desktops, but they provide basic graphical functionality just fine. <a id="calibre_link-1294" href="#calibre_link-1072" class="calibre4">Figure 1.6</a> shows what the JWM desktop used in the Puppy Linux antiX distribution looks like.</p>
<figure class="calibre23">
<img class="center" src="images/000043.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1072" href="#calibre_link-1294" class="calibre4"><b class="calibre21">Figure 1.6</b></a></span> The JWM desktop as seen in the Puppy Linux distribution</p>
</figcaption>
</figure>
<p class="calibre10">If you are using an older PC, try a Linux distribution that uses one of these desktops and see what happens. You may be pleasantly surprised.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-126" class="calibre4"></a>Linux Distributions</h2>
<p class="calibre10"><span type="pagebreak" title="17" id="calibre_link-361" class="calibre11"></span>Now that you have seen the four main components required for a complete Linux system, you may be wondering how you are going to get them all put together to make a Linux system. Fortunately, other people have already done that for you.</p>
<p class="calibre10">A complete Linux system package is called a <i class="calibre12">distribution</i>. Many different Linux distributions are available to meet just about any computing requirement you could have. Most distributions are customized for a specific user group, such as business users, multimedia enthusiasts, software developers, or average home users. Each customized distribution includes the software packages required to support specialized functions, such as audio- and video-editing software for multimedia enthusiasts, or compilers and integrated development environments (IDEs) for software developers.</p>
<p class="calibre10">The different Linux distributions are often divided into three categories:</p>
<ul class="calibre14">
<li class="calibre7">Full core Linux distributions</li>
<li class="calibre7">Specialized distributions</li>
<li class="calibre7">LiveCD test distributions</li>
</ul>
<p class="calibre10">The following sections describe these different types of Linux distributions and show some examples of Linux distributions in each category.</p>
<section class="toclist">
<h3 class="calibre15">Core Linux Distributions</h3>
<p class="calibre10">A core Linux distribution contains a kernel, one or more graphical desktop environments, and just about every Linux application that is available, precompiled for the kernel. It provides one-stop shopping for a complete Linux installation. <a id="calibre_link-1295" href="#calibre_link-1113" class="calibre4">Table 1.4</a> shows some of the more popular core Linux distributions.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1113" href="#calibre_link-1295" class="calibre4"><b class="calibre21">Table 1.4</b></a></span> Core Linux Distributions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Distribution</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Slackware</td>
<td class="left">One of the original Linux distribution sets, popular with Linux geeks</td>
</tr>
<tr class="calibre28">
<td class="left">Red Hat</td>
<td class="left">A commercial business distribution used mainly for Internet servers</td>
</tr>
<tr class="calibre28">
<td class="left">Fedora</td>
<td class="left">A spin-off from Red Hat but designed for home use</td>
</tr>
<tr class="calibre28">
<td class="left">Gentoo</td>
<td class="left">A distribution designed for advanced Linux users, containing only Linux source code</td>
</tr>
<tr class="calibre28">
<td class="left">openSUSE</td>
<td class="left">Different distributions for business and home use</td>
</tr>
<tr class="calibre28">
<td class="left">Debian</td>
<td class="left">Popular with Linux experts and commercial Linux products</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="18" id="calibre_link-362" class="calibre11"></span>In the early days of Linux, a distribution was released as a set of floppy disks. You had to download groups of files and then copy them onto disks. It would usually take 20 or more disks to make an entire distribution! Needless to say, this was a painful experience.</p>
<p class="calibre10">Nowadays, with home computers commonly having CD and DVD players built in, Linux distributions are released as either a CD set or a single DVD. This makes installing Linux much easier.</p>
<p class="calibre10">However, beginners still often run into problems when they install one of the core Linux distributions. To cover just about any situation in which someone might want to use Linux, a single distribution must include lots of application software. They include everything from high-end Internet database servers to common games. Because of the quantity of applications available for Linux, a complete distribution often takes four or more CDs.</p>
<p class="calibre10">Although having lots of options available in a distribution is great for Linux geeks, it can become a nightmare for beginning Linux users. Most distributions ask a series of questions during the installation process to determine which applications to load by default, what hardware is connected to the PC, and how to configure the hardware. Beginners often find these questions confusing. As a result, they often either load way too many programs on their computer or don't load enough and later discover that their computer won't do what they want it to.</p>
<p class="calibre10">Fortunately for beginners, there's a much simpler way to install Linux.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Specialized Linux Distributions</h3>
<p class="calibre10">A new subgroup of Linux distributions has started to appear. These are typically based on one of the main distributions but contain only a subset of applications that would make sense for a specific area of use.</p>
<p class="calibre10">In addition to providing specialized software (such as only office products for business users), customized Linux distributions also attempt to help beginning Linux users by autodetecting and autoconfiguring common hardware devices. This makes installing Linux a much more enjoyable process.</p>
<p class="calibre10"><a id="calibre_link-1296" href="#calibre_link-1114" class="calibre4">Table 1.5</a> shows some of the specialized Linux distributions available and what they specialize in.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1114" href="#calibre_link-1296" class="calibre4"><b class="calibre21">Table 1.5</b></a></span> Specialized Linux Distributions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Distribution</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">CentOS</td>
<td class="left">A free distribution built from the Red Hat Enterprise Linux source code</td>
</tr>
<tr class="calibre28">
<td class="left">Ubuntu</td>
<td class="left">A free distribution for school and home use</td>
</tr>
<tr class="calibre28">
<td class="left">PCLinuxOS</td>
<td class="left">A free distribution for home and office use</td>
</tr>
<tr class="calibre28">
<td class="left">Mint</td>
<td class="left">A free distribution for home entertainment use</td>
</tr>
<tr class="calibre28">
<td class="left">dyne:bolic</td>
<td class="left">A free distribution designed for audio and MIDI applications</td>
</tr>
<tr class="calibre28">
<td class="left">Puppy Linux</td>
<td class="left">A free small distribution that runs well on older PCs</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="19" id="calibre_link-363" class="calibre11"></span>That's just a small sampling of specialized Linux distributions. There are literally hundreds of specialized Linux distributions, and more are popping up all the time on the Internet. No matter what your specialty, you'll probably find a Linux distribution made for you.</p>
<p class="calibre10">Many of the specialized Linux distributions are based on the Debian Linux distribution. They use the same installation files as Debian but package only a small fraction of a full-blown Debian system.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The Linux LiveCD</h3>
<p class="calibre10">A relatively new phenomenon in the Linux world is the bootable Linux CD distribution. This lets you see what a Linux system is like without actually installing it. Most modern PCs can boot from a CD instead of the standard hard drive. To take advantage of this, some Linux distributions create a bootable CD that contains a sample Linux system (called a <i class="calibre12">Linux LiveCD</i>). Because of the limitations of the single CD size, the sample can't contain a complete Linux system, but you'd be surprised at all the software they can cram in there. The result is that you can boot your PC from the CD and run a Linux distribution without having to install anything on your hard drive!</p>
<p class="calibre10"><span type="pagebreak" title="20" id="calibre_link-364" class="calibre11"></span>This is an excellent way to test various Linux distributions without having to mess with your PC. Just pop in a CD and boot! All the Linux software will run directly from the CD. You can download lots of Linux LiveCDs from the Internet and burn onto a CD to test drive.</p>
<p class="calibre10"><a id="calibre_link-1297" href="#calibre_link-1115" class="calibre4">Table 1.6</a> shows some popular Linux LiveCDs that are available.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1115" href="#calibre_link-1297" class="calibre4"><b class="calibre21">Table 1.6</b></a></span> Linux LiveCD Distributions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Distribution</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Knoppix</td>
<td class="left">A German Linux, the first Linux LiveCD developed</td>
</tr>
<tr class="calibre28">
<td class="left">PCLinuxOS</td>
<td class="left">Full-blown Linux distribution on a LiveCD</td>
</tr>
<tr class="calibre28">
<td class="left">Ubuntu</td>
<td class="left">A worldwide Linux project, designed for many languages</td>
</tr>
<tr class="calibre28">
<td class="left">Slax</td>
<td class="left">A live Linux CD based on Slackware Linux</td>
</tr>
<tr class="calibre28">
<td class="left">Puppy Linux</td>
<td class="left">A full-featured Linux designed for older PCs</td>
</tr>
</table>
</figure>
<p class="calibre10">You may notice a familiarity in this table. Many specialized Linux distributions also have a Linux LiveCD version. Some Linux LiveCD distributions, such as Ubuntu, allow you to install the Linux distribution directly from the LiveCD. This enables you to boot with the CD, test drive the Linux distribution, and then if you like it, install it on your hard drive. This feature is extremely handy and user-friendly.</p>
<p class="calibre10">As with all good things, Linux LiveCDs have a few drawbacks. Because you access everything from the CD, applications run more slowly, especially if you're using older, slower computers and CD drives. Also, because you can't write to the CD, any changes you make to the Linux system will be gone the next time you reboot.</p>
<p class="calibre10">But advances are being made in the Linux LiveCD world that will help to solve some of these problems. These advances include the ability to:</p>
<ul class="calibre14">
<li class="calibre7">Copy Linux system files from the CD to memory</li>
<li class="calibre7">Copy system files to a file on the hard drive</li>
<li class="calibre7">Store system settings on a USB memory stick</li>
<li class="calibre7">Store user settings on a USB memory stick</li>
</ul>
<p class="calibre10">Some Linux LiveCDs, such as Puppy Linux, are designed with a minimum number of Linux system files. The LiveCD boot scripts copy them directly into memory when the CD boots. This allows you to remove the CD from the computer as soon as Linux boots. Not only does this make your applications run much faster (because applications run faster from memory), but it also gives you a free CD tray to use for ripping audio CDs or playing video DVDs from the software included in Puppy Linux.</p>
<p class="calibre10">Other Linux LiveCDs use an alternative method that allows you to remove the CD from the tray after booting. It involves copying the core Linux files onto the Windows hard drive as a single file. After the CD boots, it looks for that file and reads the system files from it. The dyne:bolic Linux LiveCD uses this technique, which is called docking. Of course, you must copy the system file to your hard drive before you can boot from the CD.</p>
<p class="calibre10"><span type="pagebreak" title="21" id="calibre_link-365" class="calibre11"></span>A very popular technique for storing data from a live Linux CD session is to use a common USB memory stick (also called a flash drive or a thumb drive). Just about every Linux LiveCD can recognize a plugged-in USB memory stick (even if the stick is formatted for Windows) and read and write files to and from it. This allows you to boot a Linux LiveCD, use the Linux applications to create files, store those files on your memory stick, and then access them from your Windows applications later (or from a different computer). How cool is that?</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-127" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed the Linux system and the basics of how it works. The Linux kernel is the core of the system, controlling how memory, programs, and hardware all interact with one another. The GNU utilities are also an important piece in the Linux system. The Linux shell, which is the main focus of this book, is part of the GNU core utilities. The chapter also discussed the final piece of a Linux system, the Linux desktop environment. Things have changed over the years, and Linux now supports several graphical desktop environments.</p>
<p class="calibre10">The chapter also discussed the various Linux distributions. A Linux distribution bundles the various parts of a Linux system into a simple package that you can easily install on your PC. The Linux distribution world consists of full-blown Linux distributions that include just about every application imaginable, as well as specialized Linux distributions that include applications focused only on a special function. The Linux LiveCD craze has created another group of Linux distributions that allow you to easily test-drive Linux without even having to install it on your hard drive.</p>
<p class="calibre10">In the next chapter, you look at what you need to start your command line and shell scripting experience. You'll see what you need to do to get to the Linux shell utility from your fancy graphical desktop environment. These days, that's not always an easy thing.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-0">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-128" class="calibre4"></a><span class="chaptertitle">Chapter 2</span><br class="calibre22" /><span class="chaptertitle">Getting to the Shell</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Accessing the command line</li>
<li class="calibre7">Reaching CLI via a Linux console terminal</li>
<li class="calibre7">Reaching CLI via a graphical terminal emulator</li>
<li class="calibre7">Using the GNOME terminal emulator</li>
<li class="calibre7">Using the Konsole terminal emulator</li>
<li class="calibre7">Using the xterm terminal emulator</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="23" id="calibre_link-366" class="calibre11"></span>In the old days of Linux, all you had to work with was the shell. System administrators, programmers, and system users all sat at something called a Linux console terminal entering shell commands and viewing text output. These days, with graphical desktop environments, it's getting harder to find a shell prompt on the system in order to enter shell commands. This chapter discusses what is required to reach a command line environment. It walks you through the terminal emulation packages that you may run into in the various Linux distributions.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-129" class="calibre4"></a>Reaching the Command Line</h2>
<p class="calibre10">Before the days of graphical desktops, the only way to interact with a Unix system was through a text <i class="calibre12">command line interface</i> (CLI) provided by the shell. The CLI allowed text input only and could display only text and rudimentary graphics output.</p>
<p class="calibre10">Because of these restrictions, output devices were not very fancy. Often, you needed only a simple dumb terminal to interact with the Unix system. A dumb terminal was usually nothing more than a monitor and keyboard connected to the Unix system via a communication cable (usually a multi-wire serial cable). This simple combination provided an easy way to enter text data into the Unix system and view text results.</p>
<p class="calibre10">As you well know, things are significantly different in today's Linux environment. Just about every Linux distribution uses some type of graphical desktop environment. However, to enter shell commands, you still need a text display to access the shell's CLI. The problem now is getting to one. Sometimes finding a way to get a CLI in a Linux distribution is not an easy task.</p>
<section class="toclist">
<h3 class="calibre15">Console Terminals</h3>
<p class="calibre10"><span type="pagebreak" title="24" id="calibre_link-367" class="calibre11"></span>One way to get to a CLI is to take the Linux system out of graphical desktop mode and place it in text mode. This provides nothing more than a simple shell CLI on the monitor, just like the days before graphical desktops. This mode is called the <i class="calibre12">Linux console</i> because it emulates the old days of a hard-wired console terminal and is a direct interface to the Linux system.</p>
<p class="calibre10">When the Linux system starts, it automatically creates several <i class="calibre12">virtual consoles</i>. A virtual console is a terminal session that runs in Linux system memory. Instead of having several dumb terminals connected to the computer, most Linux distributions start five or six (or sometimes even more) virtual consoles that you can access from a single computer keyboard and monitor.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Graphical Terminals</h3>
<p class="calibre10">The alternative to using a virtual console terminal is to use a <i class="calibre12">terminal emulation package</i> from within the Linux graphical desktop environment. A terminal emulation package simulates working on a console terminal, but within a desktop graphical window. <a id="calibre_link-2" href="#calibre_link-1" class="calibre4">Figure 2.1</a> shows an example of a terminal emulator running in a Linux graphical desktop environment.</p>
<figure class="calibre23">
<img class="center" src="images/000024.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1" href="#calibre_link-2" class="calibre4"><b class="calibre21">Figure 2.1</b></a></span> A simple terminal emulator running on a Linux desktop</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="25" id="calibre_link-368" class="calibre11"></span>Graphical terminal emulation is responsible only for a portion of the Linux graphical experience. As a whole, the experience is accomplished via several components, including graphical terminal emulation software (called a <i class="calibre12">client</i>). <a id="calibre_link-4" href="#calibre_link-3" class="calibre4">Table 2.1</a> shows the different components in the Linux graphical desktop environment.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-3" href="#calibre_link-4" class="calibre4"><b class="calibre21">Table 2.1</b></a></span> Graphical Interface Elements</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Examples</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Client</td>
<td class="left">Graphical terminal emulator, desktop environment, network browser</td>
<td class="left">An application that requests graphical services</td>
</tr>
<tr class="calibre28">
<td class="left">Display Server</td>
<td class="left">Mir, Wayland Compositor, Xserver</td>
<td class="left">Element that manages the display (screen) and the input devices (keyboard, mouse, touch screen)</td>
</tr>
<tr class="calibre28">
<td class="left">Window Manager</td>
<td class="left">Compiz, Metacity, Kwin</td>
<td class="left">Element that adds borders to windows and provides features to move and manage windows</td>
</tr>
<tr class="calibre28">
<td class="left">Widgets Library</td>
<td class="left">Athena(Xaw), X Intrinsics</td>
<td class="left">Element that adds menus and appearance items for desktop environment clients</td>
</tr>
</table>
</figure>
<p class="calibre10">For dealing with the command line from the desktop, the focus is on the graphical terminal emulator. You can think of graphical terminal emulators as CLI terminals âin the GUIâ and virtual console terminals as CLI terminals âoutside the GUI.â Understanding the various terminals and their features can enhance your command line experience.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-130" class="calibre4"></a>Accessing CLI via a Linux Console Terminal</h2>
<p class="calibre10">In the early days of Linux, when you booted up your system you would see a login prompt on your monitor, and that's all. As mentioned earlier, this is called the Linux console. It was the only place you could enter commands for the system.</p>
<p class="calibre10">Even though several virtual consoles are created at boot time, many Linux distributions switch to a graphical environment after the boot sequence completes. This provides the user with a graphical login and desktop experience. Therefore, in this case, accessing a virtual console is done manually.</p>
<p class="calibre10">In most Linux distributions, you can access one of the Linux virtual consoles using a simple keystroke combination. Usually, you must hold down the Ctrl+Alt key combination and then press a function key (F1 through F7) for the virtual console you want to use. Function key F2 produces virtual console 2, key F3 produces virtual console 3, key F4 produces virtual console 4, and so on.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Linux distributions typically use the Ctrl+Alt key combination with either F1 or F7 to reach the graphical interface. Ubuntu uses F7, while RHEL uses F1. It is best to test and see where your distribution puts the graphical interface.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="26" id="calibre_link-369" class="calibre11"></span>Text mode virtual consoles use the whole screen and start with the text login screen displayed. An example of a text login screen from a virtual console is shown in <a id="calibre_link-6" href="#calibre_link-5" class="calibre4">Figure 2.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000008.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-5" href="#calibre_link-6" class="calibre4"><b class="calibre21">Figure 2.2</b></a></span> Linux virtual console login screen</p>
</figcaption>
</figure>
<p class="calibre10">Notice in <a href="#calibre_link-5" class="calibre4">Figure 2.2</a> the words <code class="calibre26">tty2</code> at the end of the first text line. The <code class="calibre26">2</code> in <code class="calibre26">tty2</code> indicates that it is virtual console 2 and was reached by pressing the Ctrl+Alt+F2 key sequence. <code class="calibre26">tty</code> stands for teletypewriter. <i class="calibre12">Teletypewriter</i> is an old term, indicating a machine used for sending messages.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Not all Linux distributions show the virtual console's tty number at the login screen.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You log into a console terminal by entering your user ID after the <code class="calibre26">login:</code> prompt and typing your password after the <code class="calibre26">Password:</code> prompt. If you have never logged in this way before, be aware that typing your password is a different experience than in a graphical environment. In a graphical environment, you may see dots or asterisks indicating the password characters as you type. However, at the virtual console, <i class="calibre12">nothing</i> is displayed when you type your password.</p>
<p class="calibre10">After logging into a virtual console, you are taken to the Linux CLI. Keep in mind that, within the Linux virtual console, you do not have the ability to run <i class="calibre12">any</i> graphical programs.</p>
<p class="calibre10"><span type="pagebreak" title="27" id="calibre_link-370" class="calibre11"></span>After you have logged in to a virtual console, you can keep it active and switch to another virtual console without losing your active session. You can switch between all the virtual consoles, with multiple active sessions running. This feature provides a great deal of flexibility while you work at the CLI.</p>
<p class="calibre10">Additional flexibility deals with the virtual console's appearance. Even though it is a text mode console terminal, you can modify the text and background colors.</p>
<p class="calibre10">For example, it may be easier on your eyes to set the background of the terminal to white and the text to black. After you have logged in, you can accomplish this modification in a couple of ways. One way is to type in the command <b class="calibre21">setterm -inversescreen on</b> and press the Enter key, as shown in <a id="calibre_link-8" href="#calibre_link-7" class="calibre4">Figure 2.3</a>. Notice in the figure that the <code class="calibre26">inversescreen</code> feature is being turned on using the option <code class="calibre26">on</code>. You can also turn it off using the <code class="calibre26">off</code> option.</p>
<figure class="calibre23">
<img class="center" src="images/000049.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-7" href="#calibre_link-8" class="calibre4"><b class="calibre21">Figure 2.3</b></a></span> Linux virtual console with inversescreen being turned on</p>
</figcaption>
</figure>
<p class="calibre10">Another way is to type two commands, one after the other. Type <b class="calibre21">setterm -background white</b> and press Enter, and then type <b class="calibre21">setterm -foreground black</b> and press Enter. Be careful because, when you change your terminal background first, it may be hard to see the commands you are typing.</p>
<p class="calibre10">With the commands in the preceding paragraph, you are not turning features on and off, as with <code class="calibre26">inversescreen</code>. Instead, you have a choice of eight colors. The choices are <code class="calibre26">black</code>, <code class="calibre26">red</code>, <code class="calibre26">green</code>, <code class="calibre26">yellow</code>, <code class="calibre26">blue</code>, <code class="calibre26">magenta</code>, <code class="calibre26">cyan</code>, and <code class="calibre26">white</code> (which looks gray on some distributions). You can get rather creative with your plain text mode console terminals. <a id="calibre_link-10" href="#calibre_link-9" class="calibre4">Table 2.2</a> shows some options you can use with the <code class="calibre26">setterm</code> command to help improve your console terminal's readability or appearance.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-9" href="#calibre_link-10" class="calibre4"><b class="calibre21">Table 2.2</b></a></span> setterm Options for Foreground and Background Appearance</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Parameter Choices</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-background</code></td>
<td class="left"><code class="calibre26">black, red, green, yellow, blue, magenta, cyan, </code>or <code class="calibre26">white</code></td>
<td class="left">Changes the terminal's background color to the one specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-foreground</code></td>
<td class="left"><code class="calibre26">black, red, green, yellow, blue, magenta, cyan, </code>or <code class="calibre26">white</code></td>
<td class="left">Changes the terminal's foreground color, specifically text, to the one specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-inversescreen</code></td>
<td class="left"><code class="calibre26">on</code> or <code class="calibre26">off</code></td>
<td class="left">Switches the background color to the foreground color and the foreground color to the background color</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-reset</code></td>
<td class="left">None</td>
<td class="left">Changes the terminal appearance back to its default setting and clears the screen</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-store</code></td>
<td class="left">None</td>
<td class="left">Sets the current terminal's foreground and background colors as the values to be used for <code class="calibre26">-reset</code></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="28" id="calibre_link-371" class="calibre11"></span>Virtual console terminals are great for accessing the CLI outside the GUI. However, sometimes, you need to access the CLI and run graphical programs. Using a terminal emulation package solves this problem and is a popular way to access the shell CLI from within the GUI. The following sections describe common software packages that provide graphical terminal emulation.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-131" class="calibre4"></a>Accessing CLI via Graphical Terminal Emulation</h2>
<p class="calibre10">The graphical desktop environment offers a great deal more variety for CLI access than the virtual console terminal does. Many graphical terminal emulator packages are available for the graphical environment. Each package provides its own unique set of features and options. Some popular graphical terminal emulator packages are shown in <a id="calibre_link-12" href="#calibre_link-11" class="calibre4">Table 2.3</a> along with their websites.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-11" href="#calibre_link-12" class="calibre4"><b class="calibre21">Table 2.3</b></a></span> Popular Graphical Terminal Emulator Packages</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Website</td>
</tr>
<tr class="calibre28">
<td class="left">Eterm</td>
<td class="left"><a href="http://www.eterm.org" class="calibre4">http://www.eterm.org</a></td>
</tr>
<tr class="calibre28">
<td class="left">Final Term</td>
<td class="left"><a href="http://finalterm.org" class="calibre4">http://finalterm.org</a></td>
</tr>
<tr class="calibre28">
<td class="left">GNOME Terminal</td>
<td class="left"><a href="http://https://help.gnome.org/users/gnome-terminal/stable" class="calibre4">https://help.gnome.org/users/gnome-terminal/stable</a></td>
</tr>
<tr class="calibre28">
<td class="left">Guake</td>
<td class="left"><a href="http://https://github.com/Guake/guake" class="calibre4">https://github.com/Guake/guake</a></td>
</tr>
<tr class="calibre28">
<td class="left">Konsole Terminal</td>
<td class="left"><a href="http://konsole.kde.org" class="calibre4">http://konsole.kde.org</a></td>
</tr>
<tr class="calibre28">
<td class="left">LillyTerm</td>
<td class="left"><a href="http://lilyterm.luna.com.tw/index.html" class="calibre4">http://lilyterm.luna.com.tw/index.html</a></td>
</tr>
<tr class="calibre28">
<td class="left">LXTerminal</td>
<td class="left"><a href="http://wiki.lxde.org/en/LXTerminal" class="calibre4">http://wiki.lxde.org/en/LXTerminal</a></td>
</tr>
<tr class="calibre28">
<td class="left">mrxvt</td>
<td class="left"><a href="http://https://code.google.com/p/mrxvt" class="calibre4">https://code.google.com/p/mrxvt</a></td>
</tr>
<tr class="calibre28">
<td class="left">ROXTerm</td>
<td class="left"><a href="http://roxterm.sourceforge.net" class="calibre4">http://roxterm.sourceforge.net</a></td>
</tr>
<tr class="calibre28">
<td class="left">rxvt</td>
<td class="left"><a href="http://sourceforge.net/projects/rxvt" class="calibre4">http://sourceforge.net/projects/rxvt</a></td>
</tr>
<tr class="calibre28">
<td class="left">rxvt-unicode</td>
<td class="left"><a href="http://software.schmorp.de/pkg/rxvt-unicode" class="calibre4">http://software.schmorp.de/pkg/rxvt-unicode</a></td>
</tr>
<tr class="calibre28">
<td class="left">Sakura</td>
<td class="left"><a href="http://https://launchpad.net/sakura" class="calibre4">https://launchpad.net/sakura</a></td>
</tr>
<tr class="calibre28">
<td class="left">st</td>
<td class="left"><a href="http://st.suckless.org" class="calibre4">http://st.suckless.org</a></td>
</tr>
<tr class="calibre28">
<td class="left">Terminator</td>
<td class="left"><a href="http://https://launchpad.net/terminator" class="calibre4">https://launchpad.net/terminator</a></td>
</tr>
<tr class="calibre28">
<td class="left">Terminology</td>
<td class="left"><a href="http://www.enlightenment.org/p.php?p=about/terminology" class="calibre4">http://www.enlightenment.org/p.php?p=about/terminology</a></td>
</tr>
<tr class="calibre28">
<td class="left">tilda</td>
<td class="left"><a href="http://tilda.sourceforge.net/tildaabout.php" class="calibre4">http://tilda.sourceforge.net/tildaabout.php</a></td>
</tr>
<tr class="calibre28">
<td class="left">UXterm</td>
<td class="left"><a href="http://manpages.ubuntu.com/manpages/gutsy/man1/uxterm.1.html" class="calibre4">http://manpages.ubuntu.com/manpages/gutsy/man1/uxterm.1.html</a></td>
</tr>
<tr class="calibre28">
<td class="left">Wterm</td>
<td class="left"><a href="http://sourceforge.net/projects/wterm" class="calibre4">http://sourceforge.net/projects/wterm</a></td>
</tr>
<tr class="calibre28">
<td class="left">xterm</td>
<td class="left"><a href="http://invisible-island.net/xterm" class="calibre4">http://invisible-island.net/xterm</a></td>
</tr>
<tr class="calibre28">
<td class="left">Xfce4 Terminal</td>
<td class="left"><a href="http://docs.xfce.org/apps/terminal/start" class="calibre4">http://docs.xfce.org/apps/terminal/start</a></td>
</tr>
<tr class="calibre28">
<td class="left">Yakuake</td>
<td class="left"><a href="http://extragear.kde.org/apps/yakuake" class="calibre4">http://extragear.kde.org/apps/yakuake</a></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="29" id="calibre_link-372" class="calibre11"></span>Although many graphical terminal emulator packages are available, the focus in this chapter is on three commonly used ones. Often installed in Linux distributions by default, they are GNOME Terminal, Konsole Terminal, and xterm.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-132" class="calibre4"></a>Using the GNOME Terminal Emulator</h2>
<p class="calibre10">GNOME Terminal is the GNOME desktop environment's default terminal emulator. Many distributions, such as RHEL, Fedora, and CentOS, use the GNOME desktop environment by default, and therefore use GNOME Terminal by default. However, other desktop environments, such as Ubuntu Unity, also use the GNOME terminal as their default terminal emulator package. It is fairly easy to use and a good terminal emulator for individuals who are new to Linux. This chapter section walks you through the various parts of accessing, configuring and using the GNOME terminal emulator.</p>
<section class="toclist">
<h3 class="calibre15">Accessing the GNOME Terminal</h3>
<p class="calibre10"><span type="pagebreak" title="30" id="calibre_link-373" class="calibre11"></span>Each graphical desktop environment has different methods for accessing the GNOME terminal emulator. This section looks at accessing the GNOME Terminal in the GNOME, Unity, and KDE desktop environments.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you are using a different desktop environment than the ones listed in <a href="#calibre_link-11" class="calibre4">Table 2.3</a>, you must look through the various menus offered in your environment to find the GNOME terminal emulator. In the menus, it is typically named Terminal</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In the GNOME desktop environment, accessing the GNOME Terminal is fairly straightforward. From the menu system in the upper-left corner of the window, click <code class="calibre26">Applications</code>, then select <code class="calibre26">System Tools</code> from the drop-down menu, and finally click <code class="calibre26">Terminal</code>. Written in shorthand, the directions look like the following: <code class="calibre26">Applications</code>â¨<code class="calibre26">System Tools</code>â¨ <code class="calibre26">Terminal</code>.</p>
<p class="calibre10">Refer to <a href="#calibre_link-1" class="calibre4">Figure 2.1</a> to see a picture of the GNOME Terminal. It was accessed in a GNOME desktop environment on a CentOS distribution.</p>
<p class="calibre10">In the Unity desktop environment, accessing the GNOME terminal takes a little more effort. The simplest access method is <code class="calibre26">Dash</code>â¨<code class="calibre26">Search</code> and type <b class="calibre21">Terminal</b>. The GNOME terminal shows up in the Dash home area as an application named <code class="calibre26">Terminal</code>. Click that icon to open the GNOME terminal emulator.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">In some Linux distribution desktop environments, such as Ubuntu's Unity, you can quickly access the GNOME terminal using the shortcut key combination Ctrl+Alt+T.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In the KDE desktop environment, the Konsole terminal emulator is the default emulator. Therefore, you must dig down through the menus to access GNOME Terminal. Start with the icon labeled <code class="calibre26">Kickoff Application Launcher</code> in the lower-left corner of the screen and then click <code class="calibre26">Applications</code>â¨<code class="calibre26">Utilities</code>â¨<code class="calibre26">Terminal</code>.</p>
<p class="calibre10">In most desktop environments, you can create a <i class="calibre12">launcher</i> for accessing GNOME Terminal. A launcher is an icon you create on your desktop that allows you to start a chosen application. This is a great feature that allows you to quickly access a terminal emulator in the graphical desktop. It is especially helpful if you do not want to use shortcut keys or the shortcut key feature is not available in your desktop environment of choice.</p>
<p class="calibre10"><span type="pagebreak" title="31" id="calibre_link-374" class="calibre11"></span>For example, in the GNOME desktop environment, to create a launcher, right-click your mouse in the middle of the desktop area; a drop-down menu appears. <code class="calibre26">Select Create Launcher...</code> from the menu; the Create Launcher application window opens. In the Type field, select <code class="calibre26">Application</code>. Type a name for your icon in the Name field. In the Command field, type <b class="calibre21">gnome-terminal</b>. Click <code class="calibre26">Ok</code> to save your new launcher. An icon with the name you gave the launcher now appears on your desktop. Double-click it to open the GNOME terminal emulator.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">When you type gnome-terminal in the Command field, you are typing the shell command for starting the GNOME terminal emulator. You learn in Chapter 3 how to add special options to commands, such as gnome-terminal, to provide special configuration options, and how to view all the options available to you.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Several configuration options are provided by menus and short-cut keys in the application, which you can apply after you get the GNOME terminal emulation started. Understanding these options can enhance your GNOME Terminal CLI experience.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The Menu Bar</h3>
<p class="calibre10">The GNOME Terminal menu bar contains the configuration and customization options you need to make your GNOME Terminal just the way you want it. The following tables briefly describe the different configuration options in the menu bar and shortcut keys associated with the options.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">As you read through these GNOME Terminal menu options, keep in mind that your Linux distribution's GNOME Terminal may have slightly different menu options available. This is because several Linux distributions use older versions of GNOME Terminal.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><a id="calibre_link-14" href="#calibre_link-13" class="calibre4">Table 2.4</a> shows the configuration options available within the GNOME Terminal <code class="calibre26">File</code> menu system. The <code class="calibre26">File</code> menu item contains items to create and manage your overall CLI terminal sessions.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-13" href="#calibre_link-14" class="calibre4"><b class="calibre21">Table 2.4</b></a></span> The File Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Open Terminal</code></td>
<td class="left">Shift+Ctrl+N</td>
<td class="left">Starts a new shell session in a new GNOME Terminal window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Open Tab</code></td>
<td class="left">Shift+Ctrl+T</td>
<td class="left">Starts a new shell session in a new tab in the existing GNOME Terminal window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">New Profile</code></td>
<td class="left">None</td>
<td class="left">Customizes a session and saves as a profile, which can be recalled for later use</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Save Contents</code></td>
<td class="left">None</td>
<td class="left">Saves the scrollback buffer contents to a text file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Close Tab</code></td>
<td class="left">Shift+Ctrl+W</td>
<td class="left">Closes the current tab session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Close Window</code></td>
<td class="left">Shift+Ctrl+Q</td>
<td class="left">Closes the current GNOME Terminal session</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="32" id="calibre_link-375" class="calibre11"></span>Notice that, as in a network browser, you can open new tabs within the GNOME Terminal session to start a whole new CLI session. Each tab session is considered to be an independent CLI session.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You do not have to click through the menu to reach options in the File menu. Most of the items are also available by right-clicking in the session area.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">Edit</code> menu contains items, shown in <a id="calibre_link-16" href="#calibre_link-15" class="calibre4">Table 2.5</a>, for handling text within the tabs. You can use your mouse to copy and paste text anywhere within the session window.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-15" href="#calibre_link-16" class="calibre4"><b class="calibre21">Table 2.5</b></a></span> The Edit Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Copy</code></td>
<td class="left">Shift+Ctrl+C</td>
<td class="left">Copies selected text to the GNOME clipboard</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Paste</code></td>
<td class="left">Shift+Ctrl+V</td>
<td class="left">Pastes text from the GNOME clipboard into a session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Paste Filenames</code></td>
<td class="left"></td>
<td class="left">Properly pastes copied filenames and their paths</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Select All</code></td>
<td class="left">None</td>
<td class="left">Selects output in the entire scrollback buffer</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Profiles</code></td>
<td class="left">None</td>
<td class="left">Adds, deletes, or modifies GNOME Terminal profiles</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Keyboard Shortcuts</code></td>
<td class="left">None</td>
<td class="left">Creates key combinations to quickly access GNOME Terminal features</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Profile Preferences</code></td>
<td class="left">None</td>
<td class="left">Edits the current session profile</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="33" id="calibre_link-376" class="calibre11"></span>The <code class="calibre26">Paste Filenames</code> menu option is available only in later versions of GNOME Terminal. Therefore, you may not see that menu option on your system.</p>
<p class="calibre10">The <code class="calibre26">View</code> menu, shown in <a id="calibre_link-18" href="#calibre_link-17" class="calibre4">Table 2.6</a>, contains items for controlling how the CLI session windows appear. These options can be helpful for individuals with visual impairment.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-17" href="#calibre_link-18" class="calibre4"><b class="calibre21">Table 2.6</b></a></span> The View Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Show Menubar</code></td>
<td class="left">None</td>
<td class="left">Toggles on/off the menu bar display</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Full Screen</code></td>
<td class="left">F11</td>
<td class="left">Toggles on/off the terminal window filling the entire desktop</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Zoom In</code></td>
<td class="left">Ctrl++</td>
<td class="left">Enlarges the font size in the window incrementally</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Zoom Out</code></td>
<td class="left">Ctrl+-</td>
<td class="left">Reduces the font size in the window incrementally</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Normal Size</code></td>
<td class="left">Ctrl+0</td>
<td class="left">Returns the font size to default</td>
</tr>
</table>
</figure>
<p class="calibre10">Be aware that if you toggle off the menu bar display, the session's menu bar disappears. However, you can easily get the menu bar to display again by right-clicking in any terminal session window and toggling on the <code class="calibre26">Show Menubar</code> option.</p>
<p class="calibre10">The <code class="calibre26">Search</code> menu, shown in <a id="calibre_link-20" href="#calibre_link-19" class="calibre4">Table 2.7</a>, contains items for conducting simple searches within the terminal session. These searches are similar to ones you may have conducted in a network browser or word processor.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-19" href="#calibre_link-20" class="calibre4"><b class="calibre21">Table 2.7</b></a></span> The Search Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Find</code></td>
<td class="left">Shift+Ctrl+F</td>
<td class="left">Opens Find window to provide designated text search options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Find Next</code></td>
<td class="left">Shift+Ctrl+H</td>
<td class="left">Searches forward from current terminal session location for designated text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Find Previous</code></td>
<td class="left">Shift+Ctrl+G</td>
<td class="left">Searches backward from current terminal session location for designated text</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">Terminal </code>menu, shown in <a id="calibre_link-22" href="#calibre_link-21" class="calibre4">Table 2.8</a>, contains options for controlling the terminal emulation session features. There are no shortcut keys to access these items.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-21" href="#calibre_link-22" class="calibre4"><b class="calibre21">Table 2.8</b></a></span> The Terminal Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Change Profile</code></td>
<td class="left">Switches to a new profile configuration</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Set Title</code></td>
<td class="left">Modifies session tab title bar setting</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Set Character Encoding</code></td>
<td class="left">Selects character set used to send and display characters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Reset</code></td>
<td class="left">Sends reset terminal session control code</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Reset and Clear</code></td>
<td class="left">Sends reset terminal session control code and clears terminal session screen</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Window Size List</code></td>
<td class="left">Lists window sizes for adjusting the current terminal window size</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="34" id="calibre_link-377" class="calibre11"></span>The <code class="calibre26">Reset</code> option is extremely useful. One day, you may accidently cause your terminal session to display random characters and symbols. When this occurs, the text is unreadable. It is typically caused by displaying a non-text file to the screen. You can quickly get the terminal session back to normal by selecting <code class="calibre26">Reset</code> or <code class="calibre26">Reset and Clear</code>.</p>
<p class="calibre10">The <code class="calibre26">Tabs</code> menu, shown in <a id="calibre_link-24" href="#calibre_link-23" class="calibre4">Table 2.9</a>, provides items for controlling the location of the tabs and selecting which tab is active. This menu displays only when you have more than one tab session open.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-23" href="#calibre_link-24" class="calibre4"><b class="calibre21">Table 2.9</b></a></span> The Tabs Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Next Tab</code></td>
<td class="left">Ctrl+Page Down</td>
<td class="left">Makes the next tab in the list active</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Previous Tab</code></td>
<td class="left">Ctrl+Page Up</td>
<td class="left">Makes the previous tab in the list active</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Move Tab Left</code></td>
<td class="left">Shift+Ctrl+Page Up</td>
<td class="left">Shuffles the current tab in front of the previous tab</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Move Tab Right</code></td>
<td class="left">Shift+Ctrl+Page Down</td>
<td class="left">Shuffles the current tab in front of the next tab</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Detach Tab</code></td>
<td class="left">None</td>
<td class="left">Removes the tab and starts a new GNOME Terminal window using this tab session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Tab List</code></td>
<td class="left">None</td>
<td class="left">Lists the currently running tabs (Select a tab to jump to that session.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Terminal List</code></td>
<td class="left">None</td>
<td class="left">Lists the currently running terminals (Select a terminal to jump to that session. This is displayed only if multiple window sessions are open.)</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="35" id="calibre_link-378" class="calibre11"></span>Finally, the <code class="calibre26">Help</code> menu contains two menu options. <code class="calibre26">Contents</code> provides a full GNOME Terminal manual so you can research individual GNOME Terminal items and features. The <code class="calibre26">About</code> option shows you the current GNOME Terminal version that's running.</p>
<p class="calibre10">Besides the GNOME terminal emulator package, another commonly used package is Konsole Terminal. In many ways, Konsole Terminal is similar to GNOME Terminal. However, enough differences exist to warrant its own section.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-133" class="calibre4"></a>Using the Konsole Terminal Emulator</h2>
<p class="calibre10">The KDE Desktop Project created its own terminal emulation package called <i class="calibre12">Konsole Terminal</i>. The Konsole package incorporates basic terminal emulation features, along with more advanced ones expected from a graphical application. This section describes Konsole Terminal features and shows you how to use them.</p>
<section class="toclist">
<h3 class="calibre15">Accessing the Konsole Terminal</h3>
<p class="calibre10">The Konsole Terminal is the default terminal emulator for the KDE desktop environment. You can easily access it via the KDE environment's menu system. In other desktop environments, accessing the Konsole Terminal can be a little more difficult.</p>
<p class="calibre10">In the KDE desktop environment, you can access the Konsole Terminal by clicking the icon labeled <code class="calibre26">Kickoff Application Launcher</code> in the lower-left corner of the screen. Then click <code class="calibre26">Applications</code>â¨<code class="calibre26">System</code>â¨<code class="calibre26">Terminal (Konsole)</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You may see two terminal menu options within the KDE menu environment. If you do, the Terminal menu option with the words Konsole beneath it is the Konsole terminal.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In the GNOME desktop environment, the Konsole terminal is typically not installed by default. If Konsole Terminal has been installed, you can access it via the GNOME menu system. In the upper-left corner of the window, click <code class="calibre26">Applications</code>â¨<code class="calibre26">System Tools</code>â¨<code class="calibre26">Konsole</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You may not have the Konsole terminal emulation package installed on your system. If you would like to install it, read through Chapter 9 to learn how to install software via the command line.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="36" id="calibre_link-379" class="calibre11"></span>In the Unity desktop environment, if Konsole has been installed, you can access it via <code class="calibre26">Dash</code>â¨<code class="calibre26">Search</code> and type <b class="calibre21">Konsole</b>. The Konsole Terminal shows up in the Dash home area as an application named <code class="calibre26">Konsole</code>. Click that icon to open the Konsole terminal emulator.</p>
<p class="calibre10"><a id="calibre_link-26" href="#calibre_link-25" class="calibre4">Figure 2.4</a> shows the Konsole Terminal. It was accessed on a KDE desktop environment in a CentOS Linux distribution.</p>
<figure class="calibre23">
<img class="center" src="images/000052.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-25" href="#calibre_link-26" class="calibre4"><b class="calibre21">Figure 2.4</b></a></span> The Konsole Terminal</p>
</figcaption>
</figure>
<p class="calibre10">Remember that, in most desktop environments, you can create a launcher to access applications such as the Konsole Terminal. The command you need to type for the launcher to start up the Konsole terminal emulator is <b class="calibre21">konsole</b>. Also, if the Konsole Terminal is installed, you can start it from another terminal emulator by typing <b class="calibre21">konsole</b> and pressing Enter.</p>
<p class="calibre10">The Konsole Terminal, similar to GNOME Terminal, has several configuration options provided by menus and shortcut keys. The following section describes these various options.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The Menu Bar</h3>
<p class="calibre10"><span type="pagebreak" title="37" id="calibre_link-380" class="calibre11"></span>The Konsole Terminal menu bar contains the configuration and customization options you need to easily view and change features in your terminal emulation session. The following tables briefly describe the menu options and associated shortcut keys.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">The Konsole Terminal provides a simple menu when you right-click in the active session area. Several menu items are available in this easy-to-access menu.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">File</code> menu, shown in <a id="calibre_link-28" href="#calibre_link-27" class="calibre4">Table 2.10</a>, provides options for starting a new tab in the current window or in a new window.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-27" href="#calibre_link-28" class="calibre4"><b class="calibre21">Table 2.10</b></a></span> The File Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">New Tab</code></td>
<td class="left">Ctrl+Shift+N</td>
<td class="left">Starts a new shell session in a new tab in the existing Konsole Terminal window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">New Window</code></td>
<td class="left">Ctrl+Shift+M</td>
<td class="left">Starts a new shell session in a new Konsole Terminal window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Shell</code></td>
<td class="left">None</td>
<td class="left">Opens the default profile, Shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Open Browser Here</code></td>
<td class="left">None</td>
<td class="left">Opens the default file browser application</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Close Tab</code></td>
<td class="left">Ctrl+Shift+W</td>
<td class="left">Closes the current tab session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Quit</code></td>
<td class="left">Ctrl+Shift+Q</td>
<td class="left">Quits the Konsole Terminal emulation application</td>
</tr>
</table>
</figure>
<p class="calibre10">When you first start the Konsole Terminal, the only profile listed in the menu is <code class="calibre26">Shell</code>. As more profiles are created and saved, their names appear in the menu list.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">As you read through these Konsole Terminal menu options, keep in mind that your Linux distribution's Konsole Terminal may have very different menu options available. This is because some Linux distributions have kept older versions of the Konsole Terminal emulation package.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">Edit</code> menu, shown in <a id="calibre_link-30" href="#calibre_link-29" class="calibre4">Table 2.11</a>, provides options for handling text in the session. Also, managing tab names is in this options list.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-29" href="#calibre_link-30" class="calibre4"><b class="calibre21">Table 2.11</b></a></span> The Edit Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Copy</code></td>
<td class="left">Ctrl+Shift+C</td>
<td class="left">Copies selected text to the Konsole clipboard</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Paste</code></td>
<td class="left">Ctrl+Shift+V</td>
<td class="left">Pastes text from the Konsole clipboard into a session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Rename Tab</code></td>
<td class="left">Ctrl+Alt+S</td>
<td class="left">Modifies session tab title bar setting</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Copy Input To</code></td>
<td class="left">None</td>
<td class="left">Starts/stops session input copies to chosen additional sessions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Clear Display</code></td>
<td class="left">None</td>
<td class="left">Clears the terminal session screen</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Clear &amp; Reset</code></td>
<td class="left">None</td>
<td class="left">Clears the terminal session screen and sends the reset terminal session control code</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="38" id="calibre_link-381" class="calibre11"></span>Konsole provides an excellent method for tracking what function is taking place in each tab session. Using the Rename Tab menu option, you can name a tab to match its current task. This helps in tracking which open tab session is performing what function.</p>
<p class="calibre10">The <code class="calibre26">View</code> menu, shown in <a id="calibre_link-32" href="#calibre_link-31" class="calibre4">Table 2.12</a>, contains items for controlling individual session views in the Konsole Terminal window. In addition, options are available that aid in monitoring terminal session activity.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-31" href="#calibre_link-32" class="calibre4"><b class="calibre21">Table 2.12</b></a></span> The View Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Split View</code></td>
<td class="left">None</td>
<td class="left">Controls the multiple tab session display within the current Konsole Terminal window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Detach View</code></td>
<td class="left">Ctrl+Shift+H</td>
<td class="left">Removes a tab session and starts a new Konsole Terminal window using this tab session</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Show Menu Bar</code></td>
<td class="left">None</td>
<td class="left">Toggles on/off Menu bar display</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Full Screen Mode</code></td>
<td class="left">Ctrl+Shift+F11</td>
<td class="left">Toggles on/off the terminal window filling the entire monitor display area</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Monitor for Silence</code></td>
<td class="left">Ctrl+Shift+I</td>
<td class="left">Toggles on/off a special message for tab silence</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Monitor for Activity</code></td>
<td class="left">Ctrl+Shift+A</td>
<td class="left">Toggles on/off a special message for tab activity</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Character Encoding</code></td>
<td class="left">None</td>
<td class="left">Selects the character set used to send and display characters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Increase Text Size</code></td>
<td class="left">Ctrl++</td>
<td class="left">Enlarges the font size in the window incrementally</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Decrease Text Size</code></td>
<td class="left">Ctrl+-</td>
<td class="left">Reduces the font size in the window incrementally</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="39" id="calibre_link-382" class="calibre11"></span>The <code class="calibre26">Monitor for Silence</code> menu option is used for indicating <i class="calibre12">tab silence</i>. Tab silence occurs when no new text appears in the current tab session for 10 seconds. This allows you to switch to another tab while waiting for application output to stop.</p>
<p class="calibre10"><i class="calibre12">Tab activity</i>, toggled by the <code class="calibre26">Monitor for Activity</code> option, issues a special message when new text appears in the tab session. This option allows you to be notified when output from an application occurs.</p>
<p class="calibre10">Konsole retains a history, formally called a <i class="calibre12">scrollback buffer</i>, for each tab. The history contains output text that has scrolled out of the terminal viewing area. By default, the last 1,000 lines in the scrollback buffer are retained. The <code class="calibre26">Scrollback</code> menu, shown in <a id="calibre_link-34" href="#calibre_link-33" class="calibre4">Table 2.13</a>, contains options for viewing this buffer.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-33" href="#calibre_link-34" class="calibre4"><b class="calibre21">Table 2.13</b></a></span> The Scrollback Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Search Output</code></td>
<td class="left">Ctrl+Shift+F</td>
<td class="left">Opens the Find window at the bottom of the Konsole Terminal window to provide scrollback text search options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Find Next</code></td>
<td class="left">F3</td>
<td class="left">Finds the next text match in more recent scrollback buffer history</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Find Previous</code></td>
<td class="left">Shift+F3</td>
<td class="left">Finds the next text match in older scrollback buffer history</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Save Output</code></td>
<td class="left">None</td>
<td class="left">Saves scrollback buffer contents to a text or HTML file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Scrollback Options</code></td>
<td class="left">None</td>
<td class="left">Opens the Scrollback Options window to configure scrollback buffer options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Clear Scrollback</code></td>
<td class="left">None</td>
<td class="left">Removes scrollback buffer contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Clear Scrollback &amp; Reset</code></td>
<td class="left">Ctrl+Shift+X</td>
<td class="left">Removes scrollback buffer contents and resets the terminal window</td>
</tr>
</table>
</figure>
<p class="calibre10">You can scroll back through the scrollback buffer by simply using the scrollbar in the viewing area. Also, you can scroll back line by line by pressing the Shift+Up Arrow or scroll back a page (24 lines) at a time by pressing Shift+Page Up.</p>
<p class="calibre10"><span type="pagebreak" title="40" id="calibre_link-383" class="calibre11"></span>The <code class="calibre26">Bookmarks</code> menu options, shown in <a id="calibre_link-36" href="#calibre_link-35" class="calibre4">Table 2.14</a>, provide a way to manage <i class="calibre12">bookmarks</i> set in the Konsole Terminal window. A bookmark enables you to save your active session's directory location and then easily return there in either the same session or a new session.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-35" href="#calibre_link-36" class="calibre4"><b class="calibre21">Table 2.14</b></a></span> The Bookmarks Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Add Bookmark</code></td>
<td class="left">Ctrl+Shift+B</td>
<td class="left">Creates a new bookmark at the current directory location</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Bookmark Tabs as Folder</code></td>
<td class="left">None</td>
<td class="left">Creates a new bookmark for all current terminal tab sessions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">New Bookmark Folder</code></td>
<td class="left">None</td>
<td class="left">Creates a new bookmark storage folder</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Edit Bookmarks</code></td>
<td class="left">None</td>
<td class="left">Edits existing bookmarks</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">Settings</code> menu, shown in <a id="calibre_link-38" href="#calibre_link-37" class="calibre4">Table 2.15</a>, allows you to customize and manage your profiles. Also, you can add a little more functionality to your current tab session. There are no shortcut keys to access these items.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-37" href="#calibre_link-38" class="calibre4"><b class="calibre21">Table 2.15</b></a></span> The Settings Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Change Profile</code></td>
<td class="left">Applies to the current tab a selected profile</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Edit Current Profile</code></td>
<td class="left">Opens the Edit Profile window to provide profile configuration options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Manage Profiles</code></td>
<td class="left">Opens the Manage Profile window to provide profile management options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Configure Shortcuts</code></td>
<td class="left">Creates Konsole Terminal command keyboard shortcuts</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Configure Notifications</code></td>
<td class="left">Creates custom Konsole Terminal schemas and sessions</td>
</tr>
</table>
</figure>
<p class="calibre10"><code class="calibre26">Configure Notifications</code> allows you to associate specific events that can occur within a session with different actions. When one of the events occurs, the defined action (or actions) is taken.</p>
<p class="calibre10">The <code class="calibre26">Help</code> menu, shown in <a id="calibre_link-40" href="#calibre_link-39" class="calibre4">Table 2.16</a>, provides the full Konsole handbook (if KDE handbooks were installed in your Linux distribution) and the standard About Konsole dialog box.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-39" href="#calibre_link-40" class="calibre4"><b class="calibre21">Table 2.16</b></a></span> The Help Menu</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Shortcut Key</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Konsole Handbook</code></td>
<td class="left">None</td>
<td class="left">Contains the full Konsole Handbook</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">What's This?</code></td>
<td class="left">Shift+F1</td>
<td class="left">Contains help messages for terminal widgets</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Report Bug</code></td>
<td class="left">None</td>
<td class="left">Opens the Submit Bug Report form</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Switch Application Language</code></td>
<td class="left">None</td>
<td class="left">Opens the Switch Application's Language form</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">About Konsole</code></td>
<td class="left">None</td>
<td class="left">Displays the current Konsole Terminal version</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">About KDE</code></td>
<td class="left"></td>
<td class="left">Displays the current KDE desktop environment version</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="41" id="calibre_link-384" class="calibre11"></span>Rather extensive documentation is provided to help you use the Konsole terminal emulator package. In addition to help items, you are provided with a Bug Report form to submit to the Konsole Terminal developers when you encounter a program bug.</p>
<p class="calibre10">The Konsole terminal emulator package is young compared to another popular package, xterm. In the next section, we explore the âold-timerâ xterm.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-134" class="calibre4"></a>Using the xterm Terminal Emulator</h2>
<p class="calibre10">The oldest and most basic of terminal emulation packages is <i class="calibre12">xterm</i>. The xterm package has been around since before the original days of X Window, a popular display server, and it's often included by default in distributions.</p>
<p class="calibre10">Although xterm is a full terminal emulation package, it doesn't require many resources (such as memory) to operate. Because of this, the xterm package is still popular in Linux distributions designed to run on older hardware. Some graphical desktop environments use it as the default terminal emulation package.</p>
<p class="calibre10">Although it doesn't offer many fancy features, the xterm package does one thing extremely well: It emulates older terminals, such as the Digital Equipment Corporation (DEC) VT102, VT220, and Tektronix 4014 terminals. For the VT102 and VT220 terminals, xterm can even emulate the VT series of color control codes, allowing you to use color in your scripts.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The DEC VT102 and VT220 were dumb text terminals popular for connecting to Unix systems in the 1980s and early 1990s. A VT102/VT220 could display text and display rudimentary graphics using block mode graphics. This style of terminal access is still used in many business environments today, thus keeping VT102/VT220 emulation popular.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><a id="calibre_link-42" href="#calibre_link-41" class="calibre4">Figure 2.5</a> shows what the basic xterm display looks like running on a graphical Linux desktop. You can see it is very basic.</p>
<figure class="calibre23">
<img class="center" src="images/000045.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-41" href="#calibre_link-42" class="calibre4"><b class="calibre21">Figure 2.5</b></a></span> The xterm Terminal</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="42" id="calibre_link-385" class="calibre11"></span>The xterm terminal emulator can be tricky to find these days. Often, it is not included in a desktop environment graphical menu arrangement.</p>
<section class="toclist">
<h3 class="calibre15">Accessing xterm</h3>
<p class="calibre10">In Ubuntu's Unity desktop, xterm is installed by default. You can access it via <code class="calibre26">Dash</code>â¨<code class="calibre26">Search</code> and type <b class="calibre21">xterm.</b> xterm shows up in the Dash home area as an application named <code class="calibre26">XTerm</code>. Click that icon to open the xterm terminal emulator.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You may see another terminal called UXTerm when you search for xterm on Ubuntu. This is simply the xterm emulator package with Unicode support.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="43" id="calibre_link-386" class="calibre11"></span>In the GNOME and KDE desktop environment, xterm is not installed by default. You must install it first (see Chapter 9 for help on installing software packages). After it's installed, you must start xterm from another terminal emulator. Open a terminal emulator for CLI access, type <b class="calibre21">xterm</b>, and press Enter. Also, remember that you can create your own desktop launcher to startup xterm.</p>
<p class="calibre10">The xterm package allows you to set individual features using command line parameters. The following sections discuss these features and how to change them.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Command Line Parameters</h3>
<p class="calibre10">The list of xterm command line parameters is extensive. You can control lots of features to customize the terminal emulation features, such as enabling or disabling individual VT emulations.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">xterm has a huge number of configuration options &mdash; so many that they cannot all be covered here. Extensive documentation is available via the bash manual. Accessing the bash manual is covered in Chapter 3. In addition, the xterm development team provides some excellent help on its website: <code class="calibre26">http://invisible-island.net/xterm/.</code>
</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can invoke certain configuration options by adding a parameter to the <code class="calibre26">xterm</code> command. For example, to have the xterm emulate a DEC VT100 terminal, type the command <b class="calibre21">xterm -ti vt100</b> and press Enter. <a id="calibre_link-44" href="#calibre_link-43" class="calibre4">Table 2.17</a> shows some parameters you can include when invoking the xterm terminal emulator software.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-43" href="#calibre_link-44" class="calibre4"><b class="calibre21">Table 2.17</b></a></span> xterm Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-bg</code> <code class="calibre26"><i class="calibre12">color</i></code></td>
<td class="left">Specifies the color to use for the terminal background</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-fb</code> <code class="calibre26"><i class="calibre12">font</i></code></td>
<td class="left">Specifies the font to use for bold text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-fg</code> <code class="calibre26"><i class="calibre12">color</i></code></td>
<td class="left">Specifies the color to use for the foreground text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-fn</code> <code class="calibre26"><i class="calibre12">font</i></code></td>
<td class="left">Specifies the font to use for text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-fw</code> <code class="calibre26"><i class="calibre12">font</i></code></td>
<td class="left">Specifies the font to use for wide text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-lf</code> <code class="calibre26"><i class="calibre12">filename</i></code></td>
<td class="left">Specifies the filename to use for screen logging</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-ms</code> <code class="calibre26"><i class="calibre12">color</i></code></td>
<td class="left">Specifies the color used for the text cursor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-name</code> <code class="calibre26"><i class="calibre12">name</i></code></td>
<td class="left">Specifies the name of the application that appears in the title bar</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-ti</code> <code class="calibre26"><i class="calibre12">terminal</i></code></td>
<td class="left">Specifies the terminal type to emulate</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="44" id="calibre_link-387" class="calibre11"></span>Some xterm command line parameters use a plus sign (+) or minus sign (-) to signify how a feature is set. A plus sign may turn a feature on, while a minus sign turns it off. However, the opposite can be true as well. A plus sign may disable a feature, while a minus sign enables it, such as when using the <code class="calibre26">bc</code> parameter. <a id="calibre_link-46" href="#calibre_link-45" class="calibre4">Table 2.18</a> lists some of the more common features you can set using the +/- command line parameters.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-45" href="#calibre_link-46" class="calibre4"><b class="calibre21">Table 2.18</b></a></span> xterm +/- Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ah</code></td>
<td class="left">Enables/disables highlighted text cursor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">aw</code></td>
<td class="left">Enables/disables auto-line-wrap</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bc</code></td>
<td class="left">Enables/disables text cursor blinking</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cm</code></td>
<td class="left">Enables/disables recognition of ANSI color change control codes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fullscreen</code></td>
<td class="left">Enables/disables full screen mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">j</code></td>
<td class="left">Enables/disables jump scrolling</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">l</code></td>
<td class="left">Enables/disables logging screen data to a log file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mb</code></td>
<td class="left">Enables/disables margin bell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rv</code></td>
<td class="left">Enables/disables reverse video colors</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">t</code></td>
<td class="left">Enables/disables Tektronix mode</td>
</tr>
</table>
</figure>
<p class="calibre10">It is important to note that not all implementations of xterm support all these command line parameters. You can determine which parameters your xterm implements by using the <code class="calibre26">-help</code> parameter when you start xterm on your system.</p>
<p class="calibre10">Now that you have been introduced to three terminal emulator packages, the big question is which is the best terminal emulator to use? There is no definite answer to that question. Which terminal emulator package you use depends upon your individual needs and desires. But it is great to have so many choices.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-135" class="calibre4"></a>Summary</h2>
<p class="calibre10">To start learning Linux command line commands, you need access to a CLI. In the world of graphical interfaces, this can sometimes be challenging. This chapter discussed different interfaces you should consider to get to the Linux command line.</p>
<p class="calibre10">First, this chapter discussed the difference between accessing the CLI via a virtual console terminal (a terminal outside the GUI) and a graphical terminal emulation package (a terminal inside the GUI). We took a brief look at the basic differences between these two access methods.</p>
<p class="calibre10"><span type="pagebreak" title="45" id="calibre_link-388" class="calibre11"></span>Next, we explored in detail accessing the CLI via a virtual console terminal, including specifics on how to change console terminal configuration options such as background color.</p>
<p class="calibre10">After looking at virtual console terminals, the chapter traveled through accessing the CLI via a graphical terminal emulator. Primarily, we covered three different types of terminal emulators: GNOME Terminal, Konsole Terminal, and xterm.</p>
<p class="calibre10">This chapter also covered the GNOME desktop project's GNOME terminal emulation package. GNOME Terminal is typically installed by default on the GNOME desktop environment. It provides convenient ways to set many terminal features via menu options and shortcut keys.</p>
<p class="calibre10">We also covered the KDE desktop project's Konsole terminal emulation package. The Konsole Terminal is typically installed by default on the KDE desktop environment. It provides several nice features, such as the ability to monitor a terminal for silence.</p>
<p class="calibre10">Finally, we covered the xterm terminal emulator package. xterm was the first terminal emulator available for Linux. It can emulate older terminal hardware such as the VT and Tektronix terminals.</p>
<p class="calibre10">In the next chapter, you start looking at the Linux command line commands. It walks you through the commands necessary to navigate around the Linux filesystem, and to create, delete, and manipulate files.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-56">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-136" class="calibre4"></a><span class="chaptertitle">Chapter 3</span><br class="calibre22" /><span class="chaptertitle">Basic bash Shell Commands</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Interacting with the shell</li>
<li class="calibre7">Using the bash manual</li>
<li class="calibre7">Traversing the filesystem</li>
<li class="calibre7">Listing files and directories</li>
<li class="calibre7">Managing files and directories</li>
<li class="calibre7">Viewing file contents</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="47" id="calibre_link-389" class="calibre11"></span>The default shell used in many Linux distributions is the GNU bash shell. This chapter describes the basic features available in the bash shell, such as the bash manual, tab auto-completion and how to display a file's contents. You will walk through how to work with Linux files and directories using the basic commands provided by the bash shell. If you're already comfortable with the basics in the Linux environment, feel free to skip this chapter and continue with Chapter 4 to see more advanced commands.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-137" class="calibre4"></a>Starting the Shell</h2>
<p class="calibre10">The GNU bash shell is a program that provides interactive access to the Linux system. It runs as a regular program and is normally started whenever a user logs in to a terminal. The shell that the system starts depends on your user ID configuration.</p>
<p class="calibre10">The <code class="calibre26">/etc/passwd</code> file contains a list of all the system user accounts, along with some basic configuration information about each user. Here's a sample entry from a <code class="calibre26">/etc/passwd</code> file:</p>
<pre class="calibre29"><code class="calibre26"><a href="http://christine:x:501:501:Christine Bresnahan:/home/christine:/bin/bash" class="calibre4">christine:x:501:501:Christine Bresnahan:/home/christine:/bin/bash</a></code></pre>
<p class="calibre10">Each entry has seven data fields, with fields separated by colons. The system uses the data in these fields to assign specific features for the user. Most of these entries are discussed in more detail in Chapter 7. For now, just pay attention to the last field, which specifies the user's shell program.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Though the focus is on the GNU bash shell, additional shells are reviewed in this book. Chapter 23 covers working with alternative shells, such as dash and tcsh.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In the earlier <code class="calibre26">/etc/passwd</code> sample entry, the user <code class="calibre26">christine</code> has <code class="calibre26">/bin/bash</code> set as her default shell program. This means when <code class="calibre26">christine</code> logs into the Linux system, the bash shell program is automatically started.</p>
<p class="calibre10"><span type="pagebreak" title="48" id="calibre_link-390" class="calibre11"></span>Although the bash shell program is automatically started at login, whether a shell command line interface (CLI) is presented depends on which login method is used. If a virtual console terminal is used to log in, the CLI prompt is automatically presented, and you can begin to type shell commands. However, if you log into the Linux system via a graphical desktop environment, you need to start a graphical terminal emulator to access the shell CLI prompt.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-138" class="calibre4"></a>Using the Shell Prompt</h2>
<p class="calibre10">After you start a terminal emulation package or log in to a Linux virtual console, you get access to the shell CLI <span class="chaptertitle"><i class="calibre12">prompt.</i></span> The prompt is your gateway to the shell. This is the place where you enter shell commands.</p>
<p class="calibre10">The default prompt symbol for the bash shell is the dollar sign (<code class="calibre26">$</code>). This symbol indicates that the shell is waiting for you to enter text. Different Linux distributions use different formats for the prompt. On this Ubuntu Linux system, the shell prompt looks like this:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:â¼$</code></pre>
<p class="calibre10">On the CentOS Linux system, it looks like this:</p>
<pre class="calibre29"><code class="calibre26">[christine@server01 â¼]$</code></pre>
<p class="calibre10">Besides acting as your access point to the shell, the prompt can provide additional helpful information. In the two preceding examples, the current user ID name, <code class="calibre26">christine</code>, is shown in the prompt. Also, the name of the system is shown, <code class="calibre26">server01</code>. You learn later in this chapter about additional items shown in the prompt.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you are new to the CLI, keep in mind that, after you type in a shell command at the prompt, you need to press the Enter key for the shell to act upon your command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The shell prompt is not static. It can be changed to suit your needs. Chapter 6, âUsing Linux Environment Variables,â covers modifying your shell CLI prompt configuration.</p>
<p class="calibre10">Think of the shell CLI prompt as a helpmate, assisting you with your Linux system, giving you helpful insights, and letting you know when the shell is ready for new commands. Another helpful item in the shell is the bash Manual.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-139" class="calibre4"></a>Interacting with the bash Manual</h2>
<p class="calibre10"><span type="pagebreak" title="49" id="calibre_link-391" class="calibre11"></span>Most Linux distributions include an online manual for looking up information on shell commands, as well as lots of other GNU utilities included in the distribution. You should become familiar with the manual, because it's invaluable for working with commands, especially when you're trying to figure out various command line parameters.</p>
<p class="calibre10">The <code class="calibre26">man</code> command provides access to the manual pages stored on the Linux system. Entering the <code class="calibre26">man</code> command followed by a specific command name provides that utility's manual entry. <a id="calibre_link-58" href="#calibre_link-57" class="calibre4">Figure 3.1</a> shows an example of looking up the <code class="calibre26">xterm</code> command's manual pages. This page was reached by typing the command <b class="calibre21">man xterm</b>.</p>
<figure class="calibre23">
<img class="center" src="images/000032.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-57" href="#calibre_link-58" class="calibre4"><b class="calibre21">Figure 3.1</b></a></span> Manual pages for the xterm command</p>
</figcaption>
</figure>
<p class="calibre10">Notice the <code class="calibre26">xterm</code> command <code class="calibre26">DESCRIPTION</code> paragraphs in <a href="#calibre_link-57" class="calibre4">Figure 3.1</a>. They are rather sparse and full of technical jargon. The bash manual is not a step-by-step guide, but instead a quick reference.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you are new to the bash shell, you may find that the man pages are not very helpful at first. However, get into the habit of using them, especially to read the first paragraph or two of a command's <code class="calibre26">DESCRIPTION</code> section. Eventually, you will learn the technical lingo, and the man pages will become more helpful to you.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="50" id="calibre_link-392" class="calibre11"></span>When you use the <code class="calibre26">man</code> command to view a command's manual pages, they are displayed with something called a <span class="chaptertitle"><i class="calibre12">pager</i></span>. A pager is a utility that allows you to page through displayed text. Thus, you can page through the man pages by pressing the spacebar, or you can go line by line using the Enter key. In addition, you can use the arrow keys to scroll forward and backward through the man page text (assuming that your terminal emulation package supports the arrow key functions).</p>
<p class="calibre10">When you are finished with the man pages, press the q key to quit. When you quit the man pages, you receive a shell CLI prompt, indicating the shell is waiting for your next command.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">The bash manual even has reference information on itself. Type man man to see manual pages concerning the man pages</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The manual page divides information about a command into separate sections. Each section has a conventional naming standard as shown in <a id="calibre_link-60" href="#calibre_link-59" class="calibre4">Table 3.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-59" href="#calibre_link-60" class="calibre4"><b class="calibre21">Table 3.1</b></a></span> The Linux man Page Conventional Section Names</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Section</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Name</td>
<td class="left">Displays command name and a short description</td>
</tr>
<tr class="calibre28">
<td class="left">Synopsis</td>
<td class="left">Shows command syntax</td>
</tr>
<tr class="calibre28">
<td class="left">Configuration</td>
<td class="left">Provides configuration information</td>
</tr>
<tr class="calibre28">
<td class="left">Description</td>
<td class="left">Describes command generally</td>
</tr>
<tr class="calibre28">
<td class="left">Options</td>
<td class="left">Describes command option(s)</td>
</tr>
<tr class="calibre28">
<td class="left">Exit Status</td>
<td class="left">Defines command exit status indicator(s)</td>
</tr>
<tr class="calibre28">
<td class="left">Return Value</td>
<td class="left">Describes command return value(s)</td>
</tr>
<tr class="calibre28">
<td class="left">Errors</td>
<td class="left">Provides command error messages</td>
</tr>
<tr class="calibre28">
<td class="left">Environment</td>
<td class="left">Describes environment variable(s) used</td>
</tr>
<tr class="calibre28">
<td class="left">Files</td>
<td class="left">Defines files used by command</td>
</tr>
<tr class="calibre28">
<td class="left">Versions</td>
<td class="left">Describes command version information</td>
</tr>
<tr class="calibre28">
<td class="left">Conforming To</td>
<td class="left">Provides standards followed</td>
</tr>
<tr class="calibre28">
<td class="left">Notes</td>
<td class="left">Describes additional helpful command material</td>
</tr>
<tr class="calibre28">
<td class="left">Bugs</td>
<td class="left">Provides the location to report found bugs</td>
</tr>
<tr class="calibre28">
<td class="left">Example</td>
<td class="left">Shows command use examples</td>
</tr>
<tr class="calibre28">
<td class="left">Authors</td>
<td class="left">Provides information on command developers</td>
</tr>
<tr class="calibre28">
<td class="left">Copyright</td>
<td class="left">Defines command code copyright status</td>
</tr>
<tr class="calibre28">
<td class="left">See Also</td>
<td class="left">Refers similar available commands</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="51" id="calibre_link-393" class="calibre11"></span>Not every command's man page has all the section names described in <a href="#calibre_link-59" class="calibre4">Table 3.1</a>. Also, some commands have section names that are not listed in the conventional standard.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">What if you can't remember the command name? You can search the man pages using keywords. The syntax is <code class="calibre26">man -k</code> <code class="calibre26"><i class="calibre12">keyword</i></code>. For example, to find commands dealing with the terminals, you type man -k terminal.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In addition to the conventionally named sections for a man page, there are man page section areas. Each section area has an assigned number, starting at 1 and going to 9; they are listed in <a id="calibre_link-62" href="#calibre_link-61" class="calibre4">Table 3.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-61" href="#calibre_link-62" class="calibre4"><b class="calibre21">Table 3.2</b></a></span> The Linux man Page Section Areas</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Section Number</td>
<td class="left">Area Contents</td>
</tr>
<tr class="calibre28">
<td class="left">1</td>
<td class="left">Executable programs or shell commands</td>
</tr>
<tr class="calibre28">
<td class="left">2</td>
<td class="left">System calls</td>
</tr>
<tr class="calibre28">
<td class="left">3</td>
<td class="left">Library calls</td>
</tr>
<tr class="calibre28">
<td class="left">4</td>
<td class="left">Special files</td>
</tr>
<tr class="calibre28">
<td class="left">5</td>
<td class="left">File formats and conventions</td>
</tr>
<tr class="calibre28">
<td class="left">6</td>
<td class="left">Games</td>
</tr>
<tr class="calibre28">
<td class="left">7</td>
<td class="left">Overviews, conventions, and miscellaneous</td>
</tr>
<tr class="calibre28">
<td class="left">8</td>
<td class="left">Super user and system administration commands</td>
</tr>
<tr class="calibre28">
<td class="left">9</td>
<td class="left">Kernel routines</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="52" id="calibre_link-394" class="calibre11"></span>Typically, the man utility provides the lowest numbered content area for the command. For example, looking back to <a href="#calibre_link-57" class="calibre4">Figure 3.1</a> where the command <b class="calibre21">man xterm</b> was entered, notice that in the upper-left and upper-right display corners, the word <code class="calibre26">XTERM</code> is followed by a number in parentheses, <code class="calibre26">(1)</code>. This means the man pages displayed are coming from content area 1 (executable programs or shell commands).</p>
<p class="calibre10">Occasionally, a command has man pages in multiple section content areas. For example, there is a command called <code class="calibre26">hostname</code>. The man pages contain information on the command as well as an overview section on system hostnames. To see the pages desired, you type <b class="calibre21">man</b> <code class="calibre26"><i class="calibre12">section# topic</i></code>. For the command's man pages in section 1, type <b class="calibre21">man 1 hostname</b>. For the overview man pages in section 7, type <b class="calibre21">man 7 hostname</b>.</p>
<p class="calibre10">You can also step through an introduction to the various section content areas by typing <b class="calibre21">man 1 intro</b> to read about section 1, <b class="calibre21">man 2 intro</b> to read about section 2, <b class="calibre21">man 3 intro</b> to read about section 3, and so on.</p>
<p class="calibre10">The man pages are not the only reference. There are also the information pages called info pages. You can learn about the info pages by typing <b class="calibre21">info info</b>.</p>
<p class="calibre10">In addition, most commands accept the <code class="calibre26">-help</code> or <code class="calibre26">--help</code> option. For example, you can type <b class="calibre21">hostname -help</b> to see a help screen. For more information on using help, type <b class="calibre21">help help</b>. (See a pattern here?)</p>
<p class="calibre10">Obviously, several helpful resources are available for reference. However, many basic shell concepts still need detailed explanation. In the next section, we cover navigating through the Linux filesystem.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-140" class="calibre4"></a>Navigating the Filesystem</h2>
<p class="calibre10">When you log into the system and reach the shell command prompt, you are usually placed in your home directory. Often, you want to explore other areas in the Linux system besides just your home directory. This section describes how to do that using shell commands. To start, you need to take a tour of just what the Linux filesystem looks like so you know where you are going.</p>
<section class="toclist">
<h3 class="calibre15">Looking at the Linux filesystem</h3>
<p class="calibre10">If you're new to the Linux system, you may be confused by how it references files and directories, especially if you're used to the way the Microsoft Windows operating system does that. Before exploring the Linux system, it helps to have an understanding of how it's laid out.</p>
<p class="calibre10">The first difference you'll notice is that Linux does not use drive letters in pathnames. In the Windows world, the physical drives installed on the computer determine the pathname of the file. Windows assigns a letter to each physical disk drive, and each drive contains its own directory structure for accessing files stored on it.</p>
<p class="calibre10">For example, in Windows you may be used to seeing the file paths such as:</p>
<pre class="calibre29"><code class="calibre26">c:\Users\Rich\Documents\test.doc</code></pre>
<p class="calibre10"><span type="pagebreak" title="53" id="calibre_link-395" class="calibre11"></span>The Windows file path tells you exactly which physical disk partition contains the file named <code class="calibre26">test.doc</code>. For example, if you saved <code class="calibre26">test.doc</code> on a flash drive, designated by the J drive, the file path would be <code class="calibre26">J:âtest.doc</code>. This path indicates that the file is located at the root of the drive assigned the letter <code class="calibre26">J</code>.</p>
<p class="calibre10">This is not the method used by Linux. Linux stores files within a single directory structure, called a <i class="calibre12">virtual directory</i>. The virtual directory contains file paths from all the storage devices installed on the computer, merged into a single directory structure.</p>
<p class="calibre10">The Linux virtual directory structure contains a single base directory, called the root. Directories and files beneath the root directory are listed based on the directory path used to get to them, similar to the way Windows does it.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You'll notice that Linux uses a forward slash (<code class="calibre26">/</code>) instead of a backward slash (<code class="calibre26">â</code>) to denote directories in file paths. The backslash character in Linux denotes an escape character and causes all sorts of problems when you use it in a file path. This may take some getting used to if you're coming from a Windows environment.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">In Linux, you will see file paths similar to the following:</p>
<pre class="calibre29"><code class="calibre26"><a href="http:///home/Rich/Documents/test.doc" class="calibre4">/home/Rich/Documents/test.doc</a></code></pre>
<p class="calibre10">This indicates the file <code class="calibre26">test.doc</code> is in the directory <code class="calibre26">Documents</code>, under the directory <code class="calibre26">rich</code>, which is contained in the directory <code class="calibre26">home</code>. Notice that the path doesn't provide any information as to which physical disk the file is stored on.</p>
<p class="calibre10">The tricky part about the Linux virtual directory is how it incorporates each storage device. The first hard drive installed in a Linux system is called the <i class="calibre12">root drive</i>. The root drive contains the virtual directory core. Everything else builds from there.</p>
<p class="calibre10">On the root drive, Linux can use special directories as <span class="chaptertitle"><i class="calibre12">mount points</i></span>. Mount points are directories in the virtual directory where you can assign additional storage devices. Linux causes files and directories to appear within these mount point directories, even though they are physically stored on a different drive.</p>
<p class="calibre10">Often system files are physically stored on the root drive. User files are typically stored on a separate drive or drives, as shown in <a id="calibre_link-64" href="#calibre_link-63" class="calibre4">Figure 3.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000025.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-63" href="#calibre_link-64" class="calibre4"><b class="calibre21">Figure 3.2</b></a></span> The Linux file structure</p>
</figcaption>
</figure>
<p class="calibre10"><a href="#calibre_link-63" class="calibre4">Figure 3.2</a> shows two hard drives on the computer. One hard drive is associated with the root of the virtual directory (indicated by a single forward slash). Other hard drives can be mounted anywhere in the virtual directory structure. In this example, the second hard drive is mounted at the location <code class="calibre26">/home</code>, which is where the user directories are located.</p>
<p class="calibre10"><span type="pagebreak" title="54" id="calibre_link-396" class="calibre11"></span>The Linux filesystem structure originally evolved from the Unix file structure. In a Linux filesystem, common directory names are used for common functions. <a id="calibre_link-66" href="#calibre_link-65" class="calibre4">Table 3.3</a> lists some of the more common Linux virtual top-level directory names and their contents.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-65" href="#calibre_link-66" class="calibre4"><b class="calibre21">Table 3.3</b></a></span> Common Linux Directory Names</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Directory</td>
<td class="left">Usage</td>
</tr>
<tr class="calibre28">
<td class="left">/</td>
<td class="left">root of the virtual directory, where normally, no files are placed</td>
</tr>
<tr class="calibre28">
<td class="left">/bin</td>
<td class="left">binary directory, where many GNU user-level utilities are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/boot</td>
<td class="left">boot directory, where boot files are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/dev</td>
<td class="left">device directory, where Linux creates device nodes</td>
</tr>
<tr class="calibre28">
<td class="left">/etc</td>
<td class="left">system configuration files directory</td>
</tr>
<tr class="calibre28">
<td class="left">/home</td>
<td class="left">home directory, where Linux creates user directories</td>
</tr>
<tr class="calibre28">
<td class="left">/lib</td>
<td class="left">library directory, where system and application library files are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/media</td>
<td class="left">media directory, a common place for mount points used for removable media</td>
</tr>
<tr class="calibre28">
<td class="left">/mnt</td>
<td class="left">mount directory, another common place for mount points used for removable media</td>
</tr>
<tr class="calibre28">
<td class="left">/opt</td>
<td class="left">optional directory, often used to store third-party software packages and data files</td>
</tr>
<tr class="calibre28">
<td class="left">/proc</td>
<td class="left">process directory, where current hardware and process information is stored</td>
</tr>
<tr class="calibre28">
<td class="left">/root</td>
<td class="left">root home directory</td>
</tr>
<tr class="calibre28">
<td class="left">/sbin</td>
<td class="left">system binary directory, where many GNU admin-level utilities are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/run</td>
<td class="left">run directory, where runtime data is held during system operation</td>
</tr>
<tr class="calibre28">
<td class="left">/srv</td>
<td class="left">service directory, where local services store their files</td>
</tr>
<tr class="calibre28">
<td class="left">/sys</td>
<td class="left">system directory, where system hardware information files are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/tmp</td>
<td class="left">temporary directory, where temporary work files can be created and destroyed</td>
</tr>
<tr class="calibre28">
<td class="left">/usr</td>
<td class="left">user binary directory, where the bulk of GNU user-level utilities and data files are stored</td>
</tr>
<tr class="calibre28">
<td class="left">/var</td>
<td class="left">variable directory, for files that change frequently, such as log files</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="55" id="calibre_link-397" class="calibre11"></span>The common Linux directory names are based upon the Filesystem Hierarchy Standard (FHS). Many Linux distributions maintain compliance with FHS. Therefore, you should be able to easily find files on any FHS-compliant Linux systems.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The FHS is occasionally updated. You may find that some Linux distributions are still using an older FHS standard, while other distributions only partially implement the current standard. To keep up to date on the FHS standard, visit its official home at <a href="http://www.pathname.com/fhs/" class="calibre4">http://www.pathname.com/fhs/</a>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">When you log in to your system and reach a shell CLI prompt, your session starts in your home directory. Your home directory is a unique directory assigned to your user account. When a user account is created, the system normally assigns a unique directory for the account (see Chapter 7).</p>
<p class="calibre10">You can move around the virtual directory using a graphical interface. However, to move around the virtual directory from a CLI prompt, you need to learn to use the <code class="calibre26">cd</code> command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Traversing directories</h3>
<p class="calibre10">You use the change directory command (<code class="calibre26">cd</code>) to move your shell session to another directory in the Linux filesystem. The <code class="calibre26">cd</code> command syntax is pretty simplistic: <code class="calibre26">cd</code> <code class="calibre26"><i class="calibre12">destination</i></code>.</p>
<p class="calibre10">The <code class="calibre26">cd</code> command may take a single parameter, <code class="calibre26"><i class="calibre12">destination</i></code>, which specifies the directory name you want to go to. If you don't specify a destination on the <code class="calibre26">cd</code> command, it takes you to your home directory.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">destination</i></code> parameter can be expressed using two different methods. One method is using an absolute directory reference. The other method uses a relative directory reference.</p>
<p class="calibre10"><span type="pagebreak" title="56" id="calibre_link-398" class="calibre11"></span>The following sections describe each of these methods. The differences between these two methods are important to understand as you traverse the filesystem.</p>
<section class="toclist">
<h4 class="calibre25">Using absolute directory references</h4>
<p class="calibre10">You can reference a directory name within the virtual directory system using an <span class="chaptertitle"><i class="calibre12">absolute directory reference</i></span>. The absolute directory reference defines exactly where the directory is in the virtual directory structure, starting at the root. Think of the absolute directory reference as the full name for a directory.</p>
<p class="calibre10">An absolute directory reference always begins with a forward slash (<code class="calibre26">/</code>), indicating the virtual directory system's root. Thus, to reference user binaries, contained within the <code class="calibre26">bin</code> directory stored within the <code class="calibre26">usr</code> directory, you would use an absolute directory reference as follows:</p>
<pre class="calibre29"><code class="calibre26"><a href="http:///usr/bin" class="calibre4">/usr/bin</a></code></pre>
<p class="calibre10">With the absolute directory reference, there's no doubt as to exactly where you want to go. To move to a specific location in the filesystem using the absolute directory reference, you just specify the full pathname in the <code class="calibre26">cd</code> command:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:â¼$ <code class="calibre26"><b class="calibre21">cd /usr/bin</b></code></code></pre>
<pre class="calibre29"><code class="calibre26">christine@server01:/usr/bin$</code></pre>
<p class="calibre10">Notice in the preceding example that the prompt originally had a tilde (<code class="calibre26">â¼</code>) in it. After the change to a new directory occurred, the tilde was replaced by <code class="calibre26">/usr/bin</code>. This is where a CLI prompt can help you keep track of where you are in the virtual directory structure. The tilde indicates that your shell session is located in your home directory. After you move out of your home directory, the absolute directory reference is shown in the prompt, if the prompt has been configured to do so.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If your shell CLI prompt does not show your shell session's current location, then it has not been configured to do so. Chapter 6 shows you how to make configuration changes, if you desire modifications to your CLI prompt.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">If your prompt has not been configured to show the shell session's current absolute directory location, then you can display the location via a shell command. The <code class="calibre26">pwd</code> command displays the shell session's current directory location, which is called the <span class="chaptertitle"><i class="calibre12">present working directory</i></span>. An example of using the <code class="calibre26">pwd</code> command is shown here.</p>
<pre class="calibre29"><code class="calibre26">christine@server01:/usr/bin$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/usr/bin
christine@server01:/usr/bin$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">It is a good habit to use the <code class="calibre26">pwd</code> command whenever you change to a new present working directory. Because many shell commands operate on the present working directory, you always want to make sure you are in the correct directory before issuing a command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="57" id="calibre_link-399" class="calibre11"></span>You can move to any level within the entire Linux virtual directory structure from any level using the absolute directory reference:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:/usr/bin$ <code class="calibre26"><b class="calibre21">cd /var/log</b></code>
christine@server01:/var/log$
christine@server01:/var/log$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/var/log
christine@server01:/var/log$</code></pre>
<p class="calibre10">You can also quickly jump to your home directory from any level within the Linux virtual directory structure:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:/var/log$ <code class="calibre26"><b class="calibre21">cd</b></code>
christine@server01:~$
christine@server01:â¼$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/home/christine
christine@server01:â¼$</code></pre>
<p class="calibre10">However, if you're just working within your own home directory structure, often using absolute directory references can get tedious. For example, if you're already in the directory <code class="calibre26">/home/christine</code>, it seems somewhat cumbersome to have to type the command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">cd /home/christine/Documents</b></code></code></pre>
<p class="calibre10">just to get to your <code class="calibre26">Documents</code> directory. Fortunately, there's a simpler solution.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using relative directory references</h4>
<p class="calibre10"><span class="chaptertitle"><i class="calibre12">Relative directory references</i></span> allow you to specify a destination directory reference relative to your current location. A relative directory reference doesn't start with a forward slash (<code class="calibre26">/</code>).</p>
<p class="calibre10">Instead, a relative directory reference starts with either a directory name (if you're traversing to a directory under your current directory) or a special character. For example, if you are in your <code class="calibre26">home</code> directory and want to move to your <code class="calibre26">Documents</code> subdirectory, you can use the <code class="calibre26">cd</code> command along with a relative directory reference:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:â¼$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/home/christine
christine@server01:~$
christine@server01:â¼$ <code class="calibre26"><b class="calibre21">cd Documents</b></code>
christine@server01:â¼/Documents$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/home/christine/Documents
christine@server01:~/Documents$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="58" id="calibre_link-400" class="calibre11"></span>In the preceding example, note that no forward slash (/) was used. Instead a relative directory reference was used and the present work directory was changed from <code class="calibre26">/home/christine</code> to <code class="calibre26">/home/christine/Documents</code>, with much less typing.</p>
<p class="calibre10">Also notice in the example that if the prompt is configured to display the present working directory, it keeps the tilde in the display. This shows that the present working directory is in a directory under the user's <code class="calibre26">home</code> directory.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you are new to the command line and the Linux directory structure, it is recommended that you stick with absolute directory references for a while. After you become more familiar with the directory layout, switch to using relative directory references.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can use a relative directory reference with the <code class="calibre26">cd</code> command in any directory containing subdirectories. You can also use a special character to indicate a relative directory location.</p>
<p class="calibre10">The two special characters used for relative directory references are:</p>
<ul class="calibre14">
<li class="calibre7">The single dot (<code class="calibre26">.</code>) to represent the current directory</li>
<li class="calibre7">The double dot (<code class="calibre26">..</code>) to represent the parent directory</li>
</ul>
<p class="calibre10">You <i class="calibre12">can</i> use the single dot, but it doesn't make sense to use it with the <code class="calibre26">cd </code>command. Later in the chapter, you will see how another command uses the single dot for relative directory references effectively.</p>
<p class="calibre10">The double dot character is extremely handy when trying to traverse a directory hierarchy. For example, if you are in the <code class="calibre26">Documents</code> directory under your home directory and need to go to your <code class="calibre26">Downloads</code> directory, also under your home directory, you can do this:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:â¼/Documents$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/home/christine/Documents
christine@server01:â¼/Documents$ <code class="calibre26"><b class="calibre21">cd ../Downloads</b></code>
christine@server01:â¼/Downloads$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/home/christine/Downloads
christine@server01:â¼/Downloads$</code></pre>
<p class="calibre10">The double dot character takes you back up one level to your home directory; then the <code class="calibre26">/Downloads</code> portion of the command takes you back down into the <code class="calibre26">Downloads</code> directory. You can use as many double dot characters as necessary to move around. For example, if you are in your home directory (<code class="calibre26">/home/christine</code>) and want to go to the <code class="calibre26">/etc</code> directory, you could type the following:</p>
<pre class="calibre29"><code class="calibre26">christine@server01:â¼$ <code class="calibre26"><b class="calibre21">cd ../../etc</b></code>
christine@server01:/etc$ <code class="calibre26"><b class="calibre21">pwd</b></code>
/etc
christine@server01:/etc$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="59" id="calibre_link-401" class="calibre11"></span>Of course, in a case like this, you actually have to do more typing rather than just typing the absolute directory reference, <code class="calibre26">/etc</code>. Thus, use a relative directory reference only if it makes sense to do so.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">It's helpful to have a long informative shell CLI prompt, as used in this chapter section. However, for clarity purposes, a simple <code class="calibre26">$</code> prompt is used in the rest of the book's examples.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Now that you know how to traverse the directory system and confirm your present working directory, you can start to explore what's contained within the various directories. The next section takes you through the process of looking at files within the directory structure.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-141" class="calibre4"></a>Listing Files and Directories</h2>
<p class="calibre10">To see what files are available on the system, use the list command (<code class="calibre26">ls</code>). This section describes the <code class="calibre26">ls</code> command and options available to format the information it can display.</p>
<section class="toclist">
<h3 class="calibre15">Displaying a basic listing</h3>
<p class="calibre10">The <code class="calibre26">ls</code> command at its most basic form displays the files and directories located in your current directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls</b></code>
Desktop    Downloads         Music      Pictures  Templates  Videos
Documents  examples.desktop  my_script  Public    test_file
$</code></pre>
<p class="calibre10">Notice that the <code class="calibre26">ls</code> command produces the listing in alphabetical order (in columns rather than rows). If you're using a terminal emulator that supports color, the <code class="calibre26">ls</code> command may also show different types of entries in different colors. The <code class="calibre26">LS_COLORS</code> environment variable controls this feature. (Environment variables are covered in Chapter 6). Different Linux distributions set this environment variable depending on the capabilities of the terminal emulator.</p>
<p class="calibre10">If you don't have a color terminal emulator, you can use the <code class="calibre26">-F</code> parameter with the <code class="calibre26">ls</code> command to easily distinguish files from directories. Using the <code class="calibre26">-F</code> parameter produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -F</b></code>
Desktop/   Downloads/       Music/     Pictures/ Templates/ Videos/
Documents/ examples.desktop my_script* Public/   test_file
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="60" id="calibre_link-402" class="calibre11"></span>The <code class="calibre26">-F</code> parameter flags the directories with a forward slash (<code class="calibre26">/</code>), to help identify them in the listing. Similarly, it flags executable files (like the <code class="calibre26">my_script</code> file in the preceding code) with an asterisk (<code class="calibre26">*</code>), to help you more easily find files that can be run on the system.</p>
<p class="calibre10">The basic <code class="calibre26">ls</code> command can be somewhat misleading. It shows the files and directories contained in the current directory, but not necessarily all of them. Linux often uses <span class="chaptertitle"><i class="calibre12">hidden files</i></span> to store configuration information. In Linux, hidden files are files with filenames starting with a period (<code class="calibre26">.</code>). These files don't appear in the default <code class="calibre26">ls</code> listing. Thus, they are called hidden files.</p>
<p class="calibre10">To display hidden files along with normal files and directories, use the <code class="calibre26">-a</code> parameter. Here is an example of using the <code class="calibre26">-a</code> parameter with the <code class="calibre26">ls</code> command.</p>
<pre class="calibre29"><code class="calibre26">$ ls -a
.              .compiz    examples.desktop  Music      test_file
..             .config    .gconf            my_script  Videos
.bash_history  Desktop    .gstreamer-0.10   Pictures   .Xauthority
.bash_logout   .dmrc      .ICEauthority     .profile   .xsession-errors
.bashrc        Documents  .local            Public     .xsession-errors.old
.cache         Downloads  .mozilla          Templates
$</code></pre>
<p class="calibre10">All the files beginning with a period, hidden files, are now shown. Notice that three files begin with <code class="calibre26">.bash</code>. These are hidden files that are used by the bash shell environment. These features are covered in detail in Chapter 6.</p>
<p class="calibre10">The <code class="calibre26">-R</code> parameter is another option the <code class="calibre26">ls</code> command can use. Called the recursive option, it shows files that are contained within subdirectories in the current directory. If you have lots of subdirectories, this can be quite a long listing. Here's a simple example of what the <code class="calibre26">-R</code> parameter produces. The <code class="calibre26">-F</code> option was tacked on to help you see the file types:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -F -R</b></code>
.:
Desktop/   Downloads/       Music/     Pictures/ Templates/ Videos/
Documents/ examples.desktop my_script* Public/   test_file
./Desktop:
./Documents:
./Downloads:
./Music:
ILoveLinux.mp3*
./Pictures:
./Public:
./Templates:
./Videos:
$</code></pre>
<p class="calibre10">Notice that the <code class="calibre26">-R</code> parameter shows the contents of the current directory, which are the files from a user's <code class="calibre26">home</code> directory shown in earlier examples. It also shows each subdirectory in the user's <code class="calibre26">home</code> directory and their contents. The only subdirectory containing a file is the <code class="calibre26">Music</code> subdirectory, and it contains the executable file, <code class="calibre26">ILoveLinux.mp3</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Option parameters don't have to be entered separately as shown in the nearby example: <code class="calibre26">ls -F -R</code>. They can often be combined as follows: <code class="calibre26">ls -FR</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="61" id="calibre_link-403" class="calibre11"></span>In the previous example, there were no subdirectories within subdirectories. If there had been further subdirectories, the <code class="calibre26">-R</code> parameter would have continued to traverse those as well. As you can see, for large directory structures, this can become quite a large output listing.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Displaying a long listing</h3>
<p class="calibre10">In the basic listings, the <code class="calibre26">ls</code> command doesn't produce much information about each file. For listing additional information, another popular parameter is <code class="calibre26">-l</code>. The <code class="calibre26">-l</code> parameter produces a long listing format, providing more information about each file in the directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l</b></code>
total 48
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Desktop
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Documents
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Downloads
-rw-r--r-- 1 christine christine 8980 Apr 22 13:36 examples.desktop
-rw-rw-r-- 1 christine christine    0 May 21 13:44 fall
-rw-rw-r-- 1 christine christine    0 May 21 13:44 fell
-rw-rw-r-- 1 christine christine    0 May 21 13:44 fill
-rw-rw-r-- 1 christine christine    0 May 21 13:44 full
drwxr-xr-x 2 christine christine 4096 May 21 11:39 Music
-rw-rw-r-- 1 christine christine    0 May 21 13:25 my_file
-rw-rw-r-- 1 christine christine    0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine   54 May 21 11:26 my_script
-rw-rw-r-- 1 christine christine    0 May 21 13:42 new_file
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Pictures
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Public
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Templates
-rw-rw-r-- 1 christine christine    0 May 21 11:28 test_file
drwxr-xr-x 2 christine christine 4096 Apr 22 20:37 Videos
$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="62" id="calibre_link-404" class="calibre11"></span>The long listing format lists each file and subdirectory on a single line. In addition to the filename, the listing shows additional useful information. The first line in the output shows the total number of blocks contained within the directory. After that, each line contains the following information about each file (or directory):</p>
<ul class="calibre14">
<li class="calibre7">The file type &mdash; such as directory (<code class="calibre26">d</code>), file (<code class="calibre26">-</code>), linked file (<code class="calibre26">l</code>), character device (<code class="calibre26">c</code>), or block device (<code class="calibre26">b</code>)</li>
<li class="calibre7">The file permissions (see Chapter 6)</li>
<li class="calibre7">The number of file hard links (See the section âLinking Filesâ in Chapter 7.)</li>
<li class="calibre7">The file owner username</li>
<li class="calibre7">The file primary group name</li>
<li class="calibre7">The file byte size</li>
<li class="calibre7">The last time the file was modified</li>
<li class="calibre7">The filename or directory name</li>
</ul>
<p class="calibre10">The <code class="calibre26">-l</code> parameter is a powerful tool to have. Armed with this parameter, you can see most of the information you need for any file or directory.</p>
<p class="calibre10">The <code class="calibre26">ls</code> command has lots of parameters that can come in handy as you do file management. If you type at the shell prompt <code class="calibre26"><b class="calibre21">man ls</b></code>, you see several pages of available parameters for you to use to modify the <code class="calibre26">ls</code> command output.</p>
<p class="calibre10">Don't forget that you can also combine many of the parameters. You can often find a parameter combination that not only displays the desired output, but also is easy to remember, such as <code class="calibre26">ls -alF</code>.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Filtering listing output</h3>
<p class="calibre10">As you've seen in the examples, by default the <code class="calibre26">ls</code> command lists all the non-hidden directory files. Sometimes, this can be overkill, especially when you're just looking for information on a few files.</p>
<p class="calibre10">Fortunately, the <code class="calibre26">ls</code> command also provides a way for you to define a filter on the command line. It uses the filter to determine which files or directories it should display in the output.</p>
<p class="calibre10">The filter works as a simple text-matching string. Include the filter after any command line parameters you want to use:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l my_script</b></code>
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
$ </code></pre>
<p class="calibre10">When you specify the name of a specific file as the filter, the <code class="calibre26">ls </code>command only shows that file's information. Sometimes, you might not know the exact filename you're looking for. The <code class="calibre26">ls</code> command also recognizes standard wildcard characters and uses them to match patterns within the filter:</p>
<ul class="calibre14">
<li class="calibre7"><span type="pagebreak" title="63" id="calibre_link-405" class="calibre11"></span>A question mark (<code class="calibre26">?</code>) to represent one character</li>
<li class="calibre7">An asterisk (<code class="calibre26">*</code>) to represent any number of characters</li>
</ul>
<p class="calibre10">The question mark can be used to replace exactly one character anywhere in the filter string. For example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l my_scr?pt</b></code>
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
$ </code></pre>
<p class="calibre10">The filter <code class="calibre26">my_scr?pt</code> matched two files in the directory. Similarly, the asterisk can be used to match zero or more characters:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l my*</b></code>
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_file
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
$ </code></pre>
<p class="calibre10">Using the asterisk finds three different files, starting with the name <code class="calibre26">my</code>. As with the question mark, you can place the asterisks anywhere in the filter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l my_s*t</b></code>
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
$ </code></pre>
<p class="calibre10">Using the asterisk and question mark in the filter is called <span class="chaptertitle"><i class="calibre12">file globbing</i></span>. File globbing is the processing of pattern matching using wildcards. The wildcards are officially called <span class="chaptertitle"><i class="calibre12">metacharacter wildcards</i></span>. You can use more metacharacter wildcards for file globbing than just the asterisk and question mark. You can also use brackets:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l my_scr[ai]pt</b></code>
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
$ </code></pre>
<p class="calibre10">In this example, we used the brackets along with two potential choices for a single character in that position, <code class="calibre26">a</code> or <code class="calibre26">i</code>. The brackets represent a single character position and give you multiple options for file globbing. You can list choices of characters, as shown in the preceding example, and you can specify a range of characters, such as an alphabetic range <code class="calibre26">[a - i]:</code></p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">ls -l f[a-i]ll</b></code>
<code class="calibre26">-rw-rw-r-- 1 christine christine 0 May 21 13:44 fall</code>
<code class="calibre26">-rw-rw-r-- 1 christine christine 0 May 21 13:44 fell</code>
<code class="calibre26">-rw-rw-r-- 1 christine christine 0 May 21 13:44 fill</code>
<code class="calibre26">$ </code></code></pre>
<p class="calibre10"><span type="pagebreak" title="64" id="calibre_link-406" class="calibre11"></span>Also, you can specify what should not be included in the pattern match by using the exclamation point (<code class="calibre26">!</code>):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l f[!a]ll</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fell
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fill
-rw-rw-r-- 1 christine christine 0 May 21 13:44 full
$ </code></pre>
<p class="calibre10">File globbing is a powerful feature when searching for files. It can also be used with other shell commands besides <code class="calibre26">ls</code>. You find out more about this later in the chapter.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-142" class="calibre4"></a>Handling Files</h2>
<p class="calibre10">The shell provides many file manipulation commands on the Linux filesystem. This section walks you through the basic shell commands you need to handle files.</p>
<section class="toclist">
<h3 class="calibre15">Creating files</h3>
<p class="calibre10">Every once in a while you run into a situation where you need to create an empty file. For example, sometimes applications expect a log file to be present before they can write to it. In these situations, you can use the <code class="calibre26">touch</code> command to easily create an empty file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">touch test_one</b></code>
$ <code class="calibre26"><b class="calibre21">ls -l test_one</b></code>
-rw-rw-r-- 1 christine christine <code class="calibre26"><b class="calibre21">0</b></code> May 21 14:17 test_one
$</code></pre>
<p class="calibre10">The <code class="calibre26">touch</code> command creates the new file you specify and assigns your username as the file owner. Notice in the preceding example that the file size is zero because the <code class="calibre26">touch</code> command just created an empty file.</p>
<p class="calibre10">The <code class="calibre26">touch</code> command can also be used to change the modification time. This is done without changing the file contents:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l test_one</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 <code class="calibre26"><b class="calibre21">14:17</b></code> test_one
$ <code class="calibre26"><b class="calibre21">touch test_one</b></code>
$ <code class="calibre26"><b class="calibre21">ls -l test_one</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 <code class="calibre26"><b class="calibre21">14:35</b></code> test_one
$</code></pre>
<p class="calibre10">The modification time of <code class="calibre26">test_one</code> is now updated to <code class="calibre26">14:35</code> from the original time, <code class="calibre26">14:17</code>. To change only the access time, use the <code class="calibre26">-a</code> parameter with the <code class="calibre26">touch</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l test_one</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 14:35 test_one
$ <code class="calibre26"><b class="calibre21">touch -a test_one</b></code>
$ <code class="calibre26"><b class="calibre21">ls -l test_one</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 14:35 test_one
$ <code class="calibre26"><b class="calibre21">ls -l --time=atime test_one</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 <code class="calibre26"><b class="calibre21">14:55</b></code> test_one
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="65" id="calibre_link-407" class="calibre11"></span>In the preceding example, notice that by using only the <code class="calibre26">ls -l</code> command, the access time does not display. This is because the modification time is shown by default. To see a file's access time, you need to add an additional parameter, <code class="calibre26">--time=atime</code>. After we add that parameter in the preceding example, the file's altered access time is displayed.</p>
<p class="calibre10">Creating empty files and altering file timestamps is not something you will do on a Linux system daily. However, copying files is an action you will do often while using the shell.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Copying files</h3>
<p class="calibre10">Copying files and directories from one location in the filesystem to another is a common practice for system administrators. The <code class="calibre26">cp</code> command provides this feature.</p>
<p class="calibre10">In its most basic form, the <code class="calibre26">cp</code> command uses two parameters &mdash; the source object and the destination object: <code class="calibre26">cp</code> <code class="calibre26"><i class="calibre12">source destination</i></code>.</p>
<p class="calibre10">When both the <code class="calibre26">source</code> and <code class="calibre26">destination</code> parameters are filenames, the <code class="calibre26">cp</code> command copies the source file to a new destination file. The new file acts like a brand new file, with an updated modification time:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp test_one  test_two</b></code>
$ <code class="calibre26"><b class="calibre21">ls -l test_*</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 14:35 test_one
-rw-rw-r-- 1 christine christine 0 May 21 15:15 test_two
$</code></pre>
<p class="calibre10">The new file <code class="calibre26">test_two</code> shows a different modification time than the <code class="calibre26">test_one</code> file. If the destination file already exists, the <code class="calibre26">cp</code> command may not prompt you to this fact. It is best to add the <code class="calibre26">-i</code> option to force the shell to ask whether you want to overwrite a file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l test_*</b></code>
-rw-rw-r-- 1 christine christine 0 May 21 14:35 test_one
-rw-rw-r-- 1 christine christine 0 May 21 15:15 test_two
$
$ <code class="calibre26"><b class="calibre21">cp -i test_one  test_two</b></code>
cp: overwrite 'test_two'? <code class="calibre26"><b class="calibre21">n</b></code>
$</code></pre>
<p class="calibre10">If you don't answer <code class="calibre26">y</code>, the file copy does not proceed. You can also copy a file into a pre-existing directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp -i test_one  /home/christine/Documents/</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l /home/christine/Documents</b></code>
total 0
-rw-rw-r-- 1 christine christine 0 May 21 15:25 test_one
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="66" id="calibre_link-408" class="calibre11"></span>The new file is now under the<code class="calibre26"> Documents</code> subdirectory, using the same filename as the original.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The preceding example uses a trailing forward slash (<code class="calibre26">/</code>) on the destination directory name. Using the slash indicates <code class="calibre26">Documents</code> is a directory and not a file. This is helpful for clarity purposes and is important when copying single files. If the forward slash is not used and the subdirectory <code class="calibre26">/home/christine/Documents</code> does not exist, problems can occur. In this case, attempting to copy a single file to the <code class="calibre26">Documents</code> subdirectory creates a file named <code class="calibre26">Documents</code> instead, and no error messages display!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">This last example used an absolute directory reference, but you can just as easily use a relative directory reference:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp -i test_one  Documents/</b></code>
cp: overwrite 'Documents/test_one'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l Documents</b></code>
total 0
-rw-rw-r-- 1 christine christine 0 May 21 15:28 test_one
$</code></pre>
<p class="calibre10">Earlier in this chapter, you read about the special symbols that can be used in relative directory references. One of them, the single dot (.), is great to use with the <code class="calibre26">cp</code> command. Remember that the single dot represents your present working directory. If you need to copy a file with a long source object name to your present working directory, the single dot can simplify the task:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp -i /etc/NetworkManager/NetworkManager.conf  .</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l NetworkManager.conf</b></code>
-rw-r--r-- 1 christine christine 76 May 21 15:55 NetworkManager.conf
$</code></pre>
<p class="calibre10">It's hard to see that single dot! If you look closely, you'll see it at the end of the first example code line. Using the single dot symbol is much easier than typing a full destination object name, when you have long source object names.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">There are many more <code class="calibre26">cp</code> command parameters than those described here. Remember that you can see all the different available parameters available for the <code class="calibre26">cp</code> command, by typing man cp.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="67" id="calibre_link-409" class="calibre11"></span>The <code class="calibre26">-R</code> parameter is a powerful <code class="calibre26">cp</code> command option. It allows you to recursively copy the contents of an entire directory in one command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -Fd *Scripts</b></code>
Scripts/
$ <code class="calibre26"><b class="calibre21">ls -l Scripts/</b></code>
total 25
-rwxrw-r-- 1 christine christine 929 Apr  2 08:23 file_mod.sh
-rwxrw-r-- 1 christine christine 254 Jan  2 14:18 SGID_search.sh
-rwxrw-r-- 1 christine christine 243 Jan  2 13:42 SUID_search.sh
$
$ <code class="calibre26"><b class="calibre21">cp -R Scripts/  Mod_Scripts</b></code>
$ <code class="calibre26"><b class="calibre21">ls -Fd *Scripts</b></code>
Mod_Scripts/  Scripts/
$ <code class="calibre26"><b class="calibre21">ls -l Mod_Scripts</b></code>
total 25
-rwxrw-r-- 1 christine christine 929 May 21 16:16 file_mod.sh
-rwxrw-r-- 1 christine christine 254 May 21 16:16 SGID_search.sh
-rwxrw-r-- 1 christine christine 243 May 21 16:16 SUID_search.sh
$</code></pre>
<p class="calibre10">The directory <code class="calibre26">Mod_Scripts</code> did not exist prior to the <code class="calibre26">cp -R</code> command. It was created with the <code class="calibre26">cp -R</code> command, and the entire <code class="calibre26">Scripts</code> directory's contents were copied into it. Notice that all the files in the new <code class="calibre26">Mod_Scripts </code>directory have new dates associated with them. Now <code class="calibre26">Mod_Scripts</code> is a complete copy of the <code class="calibre26">Scripts</code> directory.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">In the preceding example, the options <code class="calibre26">-Fd</code> were added to the <code class="calibre26">ls</code> command. You read about the <code class="calibre26">-F</code> option earlier in this chapter. However, the <code class="calibre26">-d</code> option may be new to you. The <code class="calibre26">-d</code> option lists a directory's information but not its contents.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can also use wildcard metacharacters in your <code class="calibre26">cp</code> commands:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp *script  Mod_Scripts/</b></code>
$ <code class="calibre26"><b class="calibre21">ls -l Mod_Scripts</b></code>
total 26
-rwxrw-r-- 1 christine christine 929 May 21 16:16 file_mod.sh
-rwxrw-r-- 1 christine christine 54  May 21 16:27 my_script
-rwxrw-r-- 1 christine christine 254 May 21 16:16 SGID_search.sh
-rwxrw-r-- 1 christine christine 243 May 21 16:16 SUID_search.sh
$</code></pre>
<p class="calibre10">This command copied any files that ended with <code class="calibre26">script</code> to <code class="calibre26">Mod_Scripts</code>. In this case, only one file needed to be copied: <code class="calibre26">my_script</code>.</p>
<p class="calibre10">When copying files, another shell feature can help you besides the single dot and wildcard metacharacters. It is called tab auto-complete.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using tab auto-complete</h3>
<p class="calibre10"><span type="pagebreak" title="68" id="calibre_link-410" class="calibre11"></span>When working at the command line, you can easily mistype a command, directory name, or filename. In fact, the longer a directory reference or filename, the greater the chance that you will mistype it.</p>
<p class="calibre10">This is where <span class="chaptertitle"><i class="calibre12">tab auto-complete</i></span> can be a lifesaver. Tab auto-complete allows you to start typing a filename or directory name and then press the tab key to have the shell complete it for you:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls really*</b></code>
really_ridiculously_long_file_name
$
$ <code class="calibre26"><b class="calibre21">cp really_ridiculously_long_file_name  Mod_Scripts/</b></code>
ls -l Mod_Scripts
total 26
-rwxrw-r-- 1 christine christine 929 May 21 16:16 file_mod.sh
-rwxrw-r-- 1 christine christine 54  May 21 16:27 my_script
-rw-rw-r-- 1 christine christine  0  May 21 17:08
really_ridiculously_long_file_name
-rwxrw-r-- 1 christine christine 254 May 21 16:16 SGID_search.sh
-rwxrw-r-- 1 christine christine 243 May 21 16:16 SUID_search.sh
$</code></pre>
<p class="calibre10">In the preceding example, we typed the command <b class="calibre21">cp really</b> and pressed the tab key, and the shell auto-completed the rest of the filename! Of course, the destination directory had to be typed, but still tab auto-complete saved the command from several potential typographical errors.</p>
<p class="calibre10">The trick to using tab auto-complete is to give the shell enough filename characters so it can distinguish the desired file from other files. For example, if another filename started with <code class="calibre26">really</code>, pressing the tab key would not auto-complete the filename. Instead, you would hear a beep. If this happens, you can press the tab key again, and the shell shows you all the filenames starting with <code class="calibre26">really</code>. This feature allows you to see what needs to be typed for tab auto-complete to work properly.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Linking files</h3>
<p class="calibre10">Linking files is a great option available in the Linux filesystem. If you need to maintain two (or more) copies of the same file on the system, instead of having separate physical copies, you can use one physical copy and multiple virtual copies, called <span class="chaptertitle"><i class="calibre12">links</i></span>. A link is a placeholder in a directory that points to the real location of the file. Two types of file links are available in Linux:</p>
<ul class="calibre14">
<li class="calibre7">A symbolic link</li>
<li class="calibre7">A hard link</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="69" id="calibre_link-411" class="calibre11"></span>A <span class="chaptertitle"><i class="calibre12">symbolic link</i></span> is simply a physical file that points to another file somewhere in the virtual directory structure. The two symbolically linked together files do not share the same contents.</p>
<p class="calibre10">To create a symbolic link to a file, the original file must pre-exist. We can then use the <code class="calibre26">ln</code> command with the <code class="calibre26">-s</code> option to create the symbolic link:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l data_file</b></code>
-rw-rw-r-- 1 christine christine 1092 May 21 17:27 data_file
$
$ <code class="calibre26"><b class="calibre21">ln -s data_file  sl_data_file</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l *data_file</b></code>
-rw-rw-r-- 1 christine christine <code class="calibre26"><b class="calibre21">1092</b></code> May 21 17:27 data_file
lrwxrwxrwx 1 christine christine    <code class="calibre26"><b class="calibre21">9</b></code> May 21 17:29 sl_data_file -&gt; data_file
$ </code></pre>
<p class="calibre10">In the preceding example, notice that the name of the symbolic link, <code class="calibre26">sl_data_file</code>, is listed second in the <code class="calibre26">ln</code> command. The <code class="calibre26">&mdash;&gt;</code> symbol displayed after the symbolic link file's long listing shows that it is symbolically linked to the file <code class="calibre26">data_file</code>.</p>
<p class="calibre10">Also note the symbolic link's file size versus the data file's file size. The symbolic link, <code class="calibre26">sl_data_file</code>, is only 9 bytes, whereas the <code class="calibre26">data_file</code> is 1092 bytes. This is because <code class="calibre26">sl_data_file</code> is only pointing to <code class="calibre26">data_file</code>. They do not share contents and are two physically separate files.</p>
<p class="calibre10">Another way to tell that these linked files are separate physical files is by viewing their <span class="chaptertitle"><i class="calibre12">inode</i></span> number. The inode number of a file or directory is a unique identification number that the kernel assigns to each object in the filesystem. To view a file or directory's inode number, add the <code class="calibre26">-i</code> parameter to the <code class="calibre26">ls</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -i *data_file</b></code>
296890 data_file  296891 sl_data_file
$ </code></pre>
<p class="calibre10">The example shows that the data file's inode number is <code class="calibre26">296890</code>, while the <code class="calibre26">sl_data_file</code> inode number is different. It is <code class="calibre26">296891</code>. Thus, they are different files.</p>
<p class="calibre10">A <span class="chaptertitle"><i class="calibre12">hard link</i></span> creates a separate virtual file that contains information about the original file and where to locate it. However, they are physically the same file. When you reference the hard link file, it's just as if you're referencing the original file. To create a hard link, again the original file must pre-exist, except that this time no parameter is needed on the <code class="calibre26">ln</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l code_file</b></code>
-rw-rw-r-- <code class="calibre26"><b class="calibre21">1</b></code> christine christine 189 May 21 17:56 code_file
$
$ <code class="calibre26"><b class="calibre21">ln code_file  hl_code_file</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -li *code_file</b></code>
<code class="calibre26"><b class="calibre21">296892</b></code> -rw-rw-r-- <code class="calibre26"><b class="calibre21">2</b></code> christine christine 189 May 21 17:56
code_file
<code class="calibre26"><b class="calibre21">296892</b></code> -rw-rw-r-- <code class="calibre26"><b class="calibre21">2</b></code> christine christine 189 May 21 17:56
hl_code_file
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="70" id="calibre_link-412" class="calibre11"></span>In the preceding example, we used the <code class="calibre26">ls -li</code> command to show both the inode numbers and a long listing for the <code class="calibre26">*code_files</code>. Notice that both files, which are hard linked together, share the name inode number. This is because they are physically the same file. Also notice that the link count (the third item in the listing) now shows that both files have two links. In addition, their file size is exactly the same size as well.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You can only create a hard link between files on the same physical medium. To create a link between files under separate physical mediums, you must use a symbolic link.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Be careful when copying linked files. If you use the <code class="calibre26">cp</code> command to copy a file that's linked to another source file, all you're doing is making another copy of the source file. This can quickly get confusing. Instead of copying the linked file, you can create another link to the original file. You can have many links to the same file with no problems. However, you also don't want to create soft links to other soft-linked files. This creates a chain of links that can be confusing &mdash; and easily broken &mdash; causing all sorts of problems.</p>
<p class="calibre10">You may find symbolic and hard links difficult concepts. Fortunately, renaming files in the next section is a great deal easier to understand.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Renaming files</h3>
<p class="calibre10">In the Linux world, renaming files is called <i class="calibre12">moving files</i>. The <code class="calibre26">mv</code> command is available to move both files and directories to another location or a new name:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -li f?ll</b></code>
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fall
296717 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fell
294561 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fill
296742 -rw-rw-r-- 1 christine christine 0 May 21 13:44 full
$
$ <code class="calibre26"><b class="calibre21">mv fall  fzll</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -li f?ll</b></code>
296717 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fell
294561 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fill
296742 -rw-rw-r-- 1 christine christine 0 May 21 13:44 full
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fzll
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="71" id="calibre_link-413" class="calibre11"></span>Notice that moving the file changed the name from <code class="calibre26">fall</code> to <code class="calibre26">fzll</code>, but it kept the same inode number and timestamp value. This is because <code class="calibre26">mv</code> affects only a file's name.</p>
<p class="calibre10">You can also use <code class="calibre26">mv</code> to change a file's location:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/fzll</b></code>
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44
/home/christine/fzll
$
$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/Pictures/</b></code>
total 0
$ <code class="calibre26"><b class="calibre21">mv fzll  Pictures/</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/Pictures/</b></code>
total 0
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44 fzll
$
$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/fzll</b></code>
ls: cannot access /home/christine/fzll: No such file or directory
$</code></pre>
<p class="calibre10">In the preceding example, we moved the file <code class="calibre26">fzll</code> from <code class="calibre26">/home/christine</code> to <code class="calibre26">/home/christine/Pictures</code> using the <code class="calibre26">mv</code> command. Again, there were no changes to the file's inode number or timestamp value.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Like the <code class="calibre26">cp</code> command, you can use the <code class="calibre26">-i</code> option on the <code class="calibre26">mv</code> command. Thus, you are asked before the command attempts to overwrite any pre-existing files.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The only change was to the file's location. The <code class="calibre26">fzll</code> file no longer exists in <code class="calibre26">/home/christine</code>, because a copy of it was not left in its original location, as the <code class="calibre26">cp</code> command would have done.</p>
<p class="calibre10">You can use the <code class="calibre26">mv</code> command to move a file's location and rename it, all in one easy step:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -li Pictures/fzll</b></code>
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44
Pictures/fzll
$
$ <code class="calibre26"><b class="calibre21">mv /home/christine/Pictures/fzll  /home/christine/fall</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/fall</b></code>
296730 -rw-rw-r-- 1 christine christine 0 May 21 13:44
/home/christine/fall
$
$ <code class="calibre26"><b class="calibre21">ls -li /home/christine/Pictures/fzll</b></code>
ls: cannot access /home/christine/Pictures/fzll:
No such file or directory</code></pre>
<p class="calibre10"><span type="pagebreak" title="72" id="calibre_link-414" class="calibre11"></span>For this example, we moved the file <code class="calibre26">fzll</code> from a subdirectory, <code class="calibre26">Pictures</code>, to the home directory, <code class="calibre26">/home/christine</code>, and renamed it to <code class="calibre26">fall</code>. Neither the timestamp value nor the inode number changed. Only the location and name were altered.</p>
<p class="calibre10">You can also use the <code class="calibre26">mv</code> command to move entire directories and their contents:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -li Mod_Scripts</b></code>
total 26
296886 -rwxrw-r-- 1 christine christine 929 May 21 16:16
file_mod.sh
296887 -rwxrw-r-- 1 christine christine  54 May 21 16:27
my_script
296885 -rwxrw-r-- 1 christine christine 254 May 21 16:16
SGID_search.sh
296884 -rwxrw-r-- 1 christine christine 243 May 21 16:16
SUID_search.sh
$
$ <code class="calibre26"><b class="calibre21">mv Mod_Scripts  Old_Scripts</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -li Mod_Scripts</b></code>
ls: cannot access Mod_Scripts: No such file or directory
$
$ <code class="calibre26"><b class="calibre21">ls -li Old_Scripts</b></code>
total 26
296886 -rwxrw-r-- 1 christine christine 929 May 21 16:16
file_mod.sh
296887 -rwxrw-r-- 1 christine christine  54 May 21 16:27
my_script
296885 -rwxrw-r-- 1 christine christine 254 May 21 16:16
SGID_search.sh
296884 -rwxrw-r-- 1 christine christine 243 May 21 16:16
SUID_search.sh
$</code></pre>
<p class="calibre10">The directory's entire contents are unchanged. The only thing that changes is the name of the directory.</p>
<p class="calibre10">After you know how to rename...err...<i class="calibre12">move</i> files with the <code class="calibre26">mv</code> command, you realize how simple it is to accomplish. Another easy, but potentially dangerous, task is deleting files.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Deleting files</h3>
<p class="calibre10">Most likely at some point you'll want to be able to delete existing files. Whether it's to clean up a filesystem or to remove a software package, you always have opportunities to delete files.</p>
<p class="calibre10">In the Linux world, deleting is called <i class="calibre12">removing</i>. The command to remove files in the bash shell is <code class="calibre26">rm</code>. The basic form of the <code class="calibre26">rm</code> command is simple:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">rm -i fall</b></code>
rm: remove regular empty file 'fall'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l fall</b></code>
ls: cannot access fall: No such file or directory
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="73" id="calibre_link-415" class="calibre11"></span>Notice that the <code class="calibre26">-i</code> command parameter prompts you to make sure that you're serious about removing the file. The shell has no recycle bin or trashcan. After you remove a file, it's gone forever. Therefore, a good habit is to always tack on the <code class="calibre26">-i</code> parameter to the <code class="calibre26">rm</code> command.</p>
<p class="calibre10">You can also use wildcard metacharacters to remove groups of files. However, again, use that <code class="calibre26">-i</code> option to protect yourself:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">rm -i f?ll</b></code>
rm: remove regular empty file 'fell'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'fill'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'full'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l f?ll</b></code>
ls: cannot access f?ll: No such file or directory
$</code></pre>
<p class="calibre10">One other feature of the <code class="calibre26">rm</code> command, if you're removing lots of files and don't want to be bothered with the prompt, is to use the <code class="calibre26">-f</code> parameter to force the removal. Just be careful!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-143" class="calibre4"></a>Managing Directories</h2>
<p class="calibre10">Linux has a few commands that work for both files and directories (such as the <code class="calibre26">cp</code> command), and some that work only for directories. To create a new directory, you need to use a specific command, which is covered in this section. Removing directories can get interesting, so that is covered in this section as well.</p>
<section class="toclist">
<h3 class="calibre15">Creating directories</h3>
<p class="calibre10">Creating a new directory in Linux is easy &mdash; just use the <code class="calibre26">mkdir</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mkdir New_Dir</b></code>
$ <code class="calibre26"><b class="calibre21">ls -ld New_Dir</b></code>
drwxrwxr-x 2 christine christine 4096 May 22 09:48 New_Dir
$</code></pre>
<p class="calibre10">The system creates a new directory named <code class="calibre26">New_Dir</code>. Notice in the new directory's long listing that the directory's record begins with a <code class="calibre26">d</code>. This indicates that <code class="calibre26">New_Dir</code> is not a file, but a directory.</p>
<p class="calibre10"><span type="pagebreak" title="74" id="calibre_link-416" class="calibre11"></span>You can create directories and subdirectories in âbulkâ if needed. However, if you attempt this with just the <code class="calibre26">mkdir</code> command, you get the following error message:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mkdir New_Dir/Sub_Dir/Under_Dir</b></code>
mkdir: cannot create directory 'New_Dir/Sub_Dir/Under_Dir':
No such file or directory
$</code></pre>
<p class="calibre10">To create several directories and subdirectories at the same time, you need to add the <code class="calibre26">-p</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mkdir -p New_Dir/Sub_Dir/Under_Dir</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -R New_Dir</b></code>
New_Dir:
Sub_Dir
New_Dir/Sub_Dir:
Under_Dir
New_Dir/Sub_Dir/Under_Dir:
$</code></pre>
<p class="calibre10">The <code class="calibre26">-p</code> option on the <code class="calibre26">mkdir</code> command makes any missing <span class="chaptertitle"><i class="calibre12">parent directories</i></span> as needed. A parent directory is a directory that contains other directories at the next level down the directory tree.</p>
<p class="calibre10">Of course, after you make something, you need to know how to delete it. This is especially useful if you created a directory in the wrong location.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Deleting directories</h3>
<p class="calibre10">Removing directories can be tricky, and for good reason. There are lots of opportunities for bad things to happen when you start deleting directories. The shell tries to protect us from accidental catastrophes as much as possible. The basic command for removing a directory is <code class="calibre26">rmdir</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">touch New_Dir/my_file</b></code>
$ <code class="calibre26"><b class="calibre21">ls -li New_Dir/</b></code>
total 0
294561 -rw-rw-r-- 1 christine christine 0 May 22 09:52 my_file
$
$ <code class="calibre26"><b class="calibre21">rmdir New_Dir</b></code>
rmdir: failed to remove 'New_Dir': Directory not empty
$</code></pre>
<p class="calibre10">By default, the <code class="calibre26">rmdir</code> command works only for removing <b class="calibre21">empty</b> directories. Because we created a file, <code class="calibre26">my_file</code>, in the <code class="calibre26">New_Dir</code> directory, the <code class="calibre26">rmdir</code> command refuses to remove it.</p>
<p class="calibre10"><span type="pagebreak" title="75" id="calibre_link-417" class="calibre11"></span>To fix this, we must remove the file first. Then we can use the <code class="calibre26">rmdir</code> command on the now empty directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">rm -i New_Dir/my_file</b></code>
rm: remove regular empty file 'New_Dir/my_file'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">rmdir New_Dir</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -ld New_Dir</b></code>
ls: cannot access New_Dir: No such file or directory</code></pre>
<p class="calibre10">The <code class="calibre26">rmdir</code> has no <code class="calibre26">-i</code> option to ask if you want to remove the directory. This is one reason it is helpful that <code class="calibre26">rmdir</code> removes only empty directories.</p>
<p class="calibre10">You can also use the <code class="calibre26">rm</code> command on entire non-empty directories. Using the <code class="calibre26">-r</code> option allows the command to descend into the directory, remove the files, and then remove the directory itself:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l My_Dir</b></code>
total 0
-rw-rw-r-- 1 christine christine 0 May 22 10:02 another_file
$
$ <code class="calibre26"><b class="calibre21">rm -ri My_Dir</b></code>
rm: descend into directory 'My_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'My_Dir/another_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove directory 'My_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l My_Dir</b></code>
ls: cannot access My_Dir: No such file or directory
$</code></pre>
<p class="calibre10">This also works for descending into multiple subdirectories and is especially useful when you have lots of directories and files to delete:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -FR Small_Dir</b></code>
Small_Dir:
a_file  b_file  c_file  Teeny_Dir/  Tiny_Dir/
Small_Dir/Teeny_Dir:
e_file
Small_Dir/Tiny_Dir:
d_file
$
$ <code class="calibre26"><b class="calibre21">rm -ir Small_Dir</b></code>
rm: descend into directory 'Small_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'Small_Dir/a_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: descend into directory 'Small_Dir/Tiny_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'Small_Dir/Tiny_Dir/d_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove directory 'Small_Dir/Tiny_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: descend into directory 'Small_Dir/Teeny_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'Small_Dir/Teeny_Dir/e_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove directory 'Small_Dir/Teeny_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'Small_Dir/c_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove regular empty file 'Small_Dir/b_file'? <code class="calibre26"><b class="calibre21">y</b></code>
rm: remove directory 'Small_Dir'? <code class="calibre26"><b class="calibre21">y</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -FR Small_Dir</b></code>
ls: cannot access Small_Dir: No such file or directory
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="76" id="calibre_link-418" class="calibre11"></span>Although this works, it's somewhat awkward. Notice that you still must verify each and every file that gets removed. For a directory with lots of files and subdirectories, this can become tedious.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">For the <code class="calibre26">rm</code> command, the <code class="calibre26">-r</code> parameter and the <code class="calibre26">-R</code> parameter work exactly the same. When used with the <code class="calibre26">rm</code> command, the <code class="calibre26">-R</code> parameter also recursively traverses through the directory removing files. It is unusual for a shell command to have different cased parameters with the same function.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The ultimate solution for throwing caution to the wind and removing an entire directory, contents and all, is the <code class="calibre26">rm</code> command with both the <code class="calibre26">-r</code> and <code class="calibre26">-f</code> parameters:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tree Small_Dir</b></code>
Small_Dir
â a_file
â b_file
â c_file
â Teeny_Dir
|    âe_file
âTiny_Dir
    âd_file
2 directories, 5 files
$
$ <code class="calibre26"><b class="calibre21">rm -rf Small_Dir</b></code>
$
$ <code class="calibre26"><b class="calibre21">tree Small_Dir</b></code>
Small_Dir [error opening dir]
0 directories, 0 files
$</code></pre>
<p class="calibre10">The <code class="calibre26">rm -rf</code> command gives no warnings and no fanfare. This, of course, is an extremely dangerous tool to have, especially if have superuser privileges. Use it sparingly, and only after triple checking to make sure that you're doing exactly what you want to do!</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Notice in the preceding example that we used the <code class="calibre26">tree</code> utility. It nicely displays directories, subdirectories, and their files. It's a useful utility when you need to understand a directory structure, especially before removing it. This utility may not be installed by default in your Linux distribution. See Chapter 9 for learning about installing software</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="77" id="calibre_link-419" class="calibre11"></span>In the last few sections, you looked at managing both files and directories. So far we covered everything you need to know about files, except for how to peek inside of them.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-144" class="calibre4"></a>Viewing File Contents</h2>
<p class="calibre10">You can use several commands for looking inside files without having to pull out a text editor utility (see Chapter 10). This section demonstrates a few of the commands you have available to help you examine files.</p>
<section class="toclist">
<h3 class="calibre15">Viewing the file type</h3>
<p class="calibre10">Before you go charging off trying to display a file, try to get a handle on what type of file it is. If you try to display a binary file, you get lots of gibberish on your monitor and may even lock up your terminal emulator.</p>
<p class="calibre10">The <code class="calibre26">file</code> command is a handy little utility to have around. It can peek inside of a file and determine just what kind of file it is:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">file my_file</b></code>
my_file: ASCII text
$</code></pre>
<p class="calibre10">The file in the preceding example is a <code class="calibre26">text</code> file. The <code class="calibre26">file</code> command determined not only that the file contains text but also the character code format of the text file, <code class="calibre26">ASCII</code>.</p>
<p class="calibre10">This following example shows a file that is simply a directory. Thus, the <code class="calibre26">file</code> command gives you another method to distinguish a directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">file New_Dir</b></code>
New_Dir: directory
$</code></pre>
<p class="calibre10">This third <code class="calibre26">file</code> command example shows a file, which is a symbolic link. Note that the <code class="calibre26">file</code> command even tells you to which file it is symbolically linked:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">file sl_data_file</b></code>
sl_data_file: symbolic link to 'data_file'
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="78" id="calibre_link-420" class="calibre11"></span>The following example shows what the <code class="calibre26">file</code> command returns for a script file. Although the file is <code class="calibre26">ASCII text</code>, because it's a script file, you can execute (run) it on the system:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">file my_script</b></code>
my_script: Bourne-Again shell script, ASCII text executable
$</code></pre>
<p class="calibre10">The final example is a binary executable program. The <code class="calibre26">file</code> command determines the platform that the program was compiled for and what types of libraries it requires. This is an especially handy feature if you have a binary executable program from an unknown source:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">file /bin/ls</b></code>
/bin/ls: ELF 64-bit LSB  executable, x86-64, version 1 (SYSV),
dynamically linked (uses shared libs), for GNU/Linux 2.6.24,
[...]
$</code></pre>
<p class="calibre10">Now that you know a quick method for viewing a file's type, you can start displaying and viewing files.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Viewing the whole file</h3>
<p class="calibre10">If you have a large text file on your hands, you may want to be able to see what's inside of it. Linux has three different commands that can help you here.</p>
<section class="toclist">
<h4 class="calibre25">Using the cat command</h4>
<p class="calibre10">The <code class="calibre26">cat</code> command is a handy tool for displaying all the data inside a text file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test1</b></code>
hello
This is a test file.
That we'll use to       test the cat command.
$</code></pre>
<p class="calibre10">Nothing too exciting, just the contents of the text file. However, the <code class="calibre26">cat</code> command has a few parameters that can help you out.</p>
<p class="calibre10">The <code class="calibre26">-n</code> parameter numbers all the lines for you:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat -n test1</b></code>
     1  hello
     2
     3  This is a test file.
     4
     5
     6  That we'll use to       test the cat command.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="79" id="calibre_link-421" class="calibre11"></span>That feature will come in handy when you're examining scripts. If you just want to number the lines that have text in them, the <code class="calibre26">-b</code> parameter is for you:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat -b test1</b></code>
     1  hello
     2  This is a test file.
     3  That we'll use to       test the cat command.
$</code></pre>
<p class="calibre10">Finally, if you don't want tab characters to appear, use the <code class="calibre26">-T</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat -T test1</b></code>
hello
This is a test file.
That we'll use to<code class="calibre26"><b class="calibre21">â§I</b></code>test the cat command.
$</code></pre>
<p class="calibre10">The <code class="calibre26">-T</code> parameter replaces any tabs in the text with the â§I character combination.</p>
<p class="calibre10">For large files, the <code class="calibre26">cat</code> command can be somewhat annoying. The text in the file just quickly scrolls off the display without stopping. Fortunately, we have a simple way to solve this problem.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using the more command</h4>
<p class="calibre10">The main drawback of the <code class="calibre26">cat</code> command is that you can't control what's happening after you start it. To solve that problem, developers created the <code class="calibre26">more</code> command. The <code class="calibre26">more</code> command displays a text file, but stops after it displays each page of data. We typed the command <b class="calibre21">more /etc/bash.bashrc</b> to produce the sample <code class="calibre26">more</code> screen shown in <a id="calibre_link-68" href="#calibre_link-67" class="calibre4">Figure 3.3</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000046.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-67" href="#calibre_link-68" class="calibre4"><b class="calibre21">Figure 3.3</b></a></span> Using the <code class="calibre26">more</code> command to display a text file</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="80" id="calibre_link-422" class="calibre11"></span>Notice at the bottom of the screen in <a href="#calibre_link-67" class="calibre4">Figure 3.3</a> that the <code class="calibre26">more</code> command displays a tag showing that you're still in the <code class="calibre26">more</code> application and how far along (<code class="calibre26">56%</code>) in the text file you are. This is the prompt for the <code class="calibre26">more</code> command.</p>
<p class="calibre10">The <code class="calibre26">more</code> command is a pager utility. Remember from earlier in this chapter a pager utility displays selected bash manual pages when you use the <code class="calibre26">man</code> command. Similarly to navigating through the man pages, you can use <code class="calibre26">more</code> to navigate through a text file by pressing the spacebar or you can go forward line by line using the Enter key. When you are finished navigating through the file using <code class="calibre26">more</code>, press the q key to quit.</p>
<p class="calibre10">The <code class="calibre26">more</code> command allows some rudimentary movement through the text file. For more advanced features, try the <code class="calibre26">less</code> command.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using the less command</h4>
<p class="calibre10">From its name, it sounds like it shouldn't be as advanced as the <code class="calibre26">more</code> command. However, the <code class="calibre26">less</code> command name is actually a play on words and is an advanced version of the <code class="calibre26">more</code> command (the <code class="calibre26">less</code> command name comes from the phrase âless is moreâ). It provides several very handy features for scrolling both forward and backward through a text file, as well as some pretty advanced searching capabilities.</p>
<p class="calibre10">The <code class="calibre26">less</code> command can also display a file's contents before it finishes reading the entire file. The <code class="calibre26">cat</code> and <code class="calibre26">more</code> commands cannot do this.</p>
<p class="calibre10"><span type="pagebreak" title="81" id="calibre_link-423" class="calibre11"></span>The <code class="calibre26">less</code> command operates much the same as the <code class="calibre26">more</code> command, displaying one screen of text from a file at a time. It supports the same command set as the <code class="calibre26">more</code> command, plus many more options.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">To see all the options available for the <code class="calibre26">less</code> command, view its man pages by typing man less. You can do the same for the <code class="calibre26">more</code> command to see the reference material concerning its various options as well.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">One set of features is that the <code class="calibre26">less</code> command recognizes the up and down arrow keys as well as the Page Up and Page Down keys (assuming that you're using a properly defined terminal). This gives you full control when viewing a file.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Viewing parts of a file</h3>
<p class="calibre10">Often the data you want to view is located either right at the top or buried at the bottom of a text file. If the information is at the top of a large file, you still need to wait for the <code class="calibre26">cat</code> or <code class="calibre26">more</code> commands to load the entire file before you can view it. If the information is located at the bottom of a file (such as a log file), you need to wade through thousands of lines of text just to get to the last few entries. Fortunately, Linux has specialized commands to solve both of these problems.</p>
<section class="toclist">
<h4 class="calibre25">Using the tail command</h4>
<p class="calibre10">The <code class="calibre26">tail</code> command displays the last lines in a file (the file's âtailâ). By default, it shows the last 10 lines in the file.</p>
<p class="calibre10">For these examples, we created a text file containing 20 text lines. It is displayed here in its entirety using the <code class="calibre26">cat</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat log_file</b></code>
line1
line2
line3
line4
line5
Hello World - line 6
line7
line8
line9
line10
line11
Hello again - line 12
line13
line14
line15
Sweet - line16
line17
line18
line19
Last line - line20
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="82" id="calibre_link-424" class="calibre11"></span>Now that you have seen the entire text file, you can see the effect of using <code class="calibre26">tail</code> to view the file's last 10 lines:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tail log_file</b></code>
line11
Hello again - line 12
line13
line14
line15
Sweet - line16
line17
line18
line19
Last line - line20
$</code></pre>
<p class="calibre10">You can change the number of lines shown using <code class="calibre26">tail</code> by including the <code class="calibre26">-n</code> parameter. In this example, only the last two lines of the file are displayed, by adding <code class="calibre26">-n 2</code> to the <code class="calibre26">tail</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tail -n 2 log_file</b></code>
line19
Last line - line20
$</code></pre>
<p class="calibre10">The <code class="calibre26">-f</code> parameter is a pretty cool feature of the <code class="calibre26">tail</code> command. It allows you to peek inside a file as the file is being used by other processes. The <code class="calibre26">tail</code> command stays active and continues to display new lines as they appear in the text file. This is a great way to monitor the system log files in real-time mode.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using the head command</h4>
<p class="calibre10">The <code class="calibre26">head</code> command does what you'd expect; it displays a file's first group of lines (the file's âheadâ). By default, it displays the first 10 lines of text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">head log_file</b></code>
line1
line2
line3
line4
line5
Hello World - line 6
line7
line8
line9
line10
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="83" id="calibre_link-425" class="calibre11"></span>Similar to the <code class="calibre26">tail</code> command, the <code class="calibre26">head</code> command supports the <code class="calibre26">-n</code> parameter so you can alter what's displayed. Both commands also allow you to simply type a dash along with the number of lines to display, as shown here:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">head -5 log_file</b></code>
line1
line2
line3
line4
line5
$</code></pre>
<p class="calibre10">Usually the beginning of a file doesn't change, so the <code class="calibre26">head</code> command doesn't support the <code class="calibre26">-f</code> parameter feature as the <code class="calibre26">tail</code> command does. The <code class="calibre26">head</code> command is a handy way to just peek at the beginning of a file.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-145" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter covered the basics of working with the Linux filesystem from a shell prompt. We began with a discussion of the bash shell and showed you how to interact with the shell. The command line interface (CLI) uses a prompt string to indicate when it's ready for you to enter commands.</p>
<p class="calibre10">The shell provides a wealth of utilities you can use to create and manipulate files. Before you start playing with files, you should understand how Linux stores them. This chapter discussed the basics of the Linux virtual directory and showed you how Linux references storage media devices. After describing the Linux filesystem, the chapter walked you through using the <code class="calibre26">cd</code> command to move around the virtual directory.</p>
<p class="calibre10">After showing you how to get to a directory, the chapter demonstrated how to use the <code class="calibre26">ls</code> command to list the files and subdirectories. Lots of parameters can customize the output of the <code class="calibre26">ls</code> command. You can obtain information on files and directories by using the <code class="calibre26">ls</code> command.</p>
<p class="calibre10">The <code class="calibre26">touch</code> command is useful for creating empty files and for changing the access or modification times on an existing file. The chapter also discussed using the <code class="calibre26">cp</code> command to copy existing files from one location to another. It walked you through the process of linking files instead of copying them, providing an easy way to have the same file in two locations without making a separate copy. The <code class="calibre26">ln</code> command provides this linking ability.</p>
<p class="calibre10"><span type="pagebreak" title="84" id="calibre_link-426" class="calibre11"></span>Next, you learned how to rename files (called <i class="calibre12">moving</i>) in Linux using the <code class="calibre26">mv</code> command and saw how to delete files (called <i class="calibre12">removing</i>) using the <code class="calibre26">rm</code> command. This chapter also showed you how to perform the same tasks with directories, using the <code class="calibre26">mkdir</code> and <code class="calibre26">rmdir</code> commands.</p>
<p class="calibre10">Finally, the chapter closed with a discussion on viewing the contents of files. The <code class="calibre26">cat</code>, <code class="calibre26">more</code>, and <code class="calibre26">less</code> commands provide easy methods for viewing the entire contents of a file, while the <code class="calibre26">tail</code> and <code class="calibre26">head</code> commands are great for peeking inside a file to just see a small portion of it.</p>
<p class="calibre10">The next chapter continues the discussion on bash shell commands. We'll look at more advanced administrator commands that come in handy as you administer your Linux system.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-95">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-146" class="calibre4"></a><span class="chaptertitle">Chapter 4</span><br class="calibre22" /><span class="chaptertitle">More bash Shell Commands</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Managing processes</li>
<li class="calibre7">Getting disk statistics</li>
<li class="calibre7">Mounting new disks</li>
<li class="calibre7">Sorting data</li>
<li class="calibre7">Archiving data</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="85" id="calibre_link-427" class="calibre11"></span>Chapter 3 covered the basics of walking through the Linux filesystem and working with files and directories. File and directory management is a major feature of the Linux shell; however, we should look at some other things before we start our script programming. This chapter digs into the Linux system management commands, showing you how to peek inside your Linux system using command line commands. After that, we show you a few handy commands that you can use to work with data files on the system.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-147" class="calibre4"></a>Monitoring Programs</h2>
<p class="calibre10">One of the toughest jobs of being a Linux system administrator is keeping track of what's running on the system &mdash; especially now, when graphical desktops take a handful of programs just to produce a single desktop. You always have lots of programs running on the system.</p>
<p class="calibre10">Fortunately, a few command line tools are available to help make life easier for you. This section covers a few of the basic tools you need to know how to use to manage programs on your Linux system.</p>
<section class="toclist">
<h3 class="calibre15">Peeking at the processes</h3>
<p class="calibre10">When a program runs on the system, it's referred to as a <i class="calibre12">process</i>. To examine these processes, you need to become familiar with the <code class="calibre26">ps</code> command, the Swiss Army knife of utilities. It can produce lots of information about all the programs running on your system.</p>
<p class="calibre10"><span type="pagebreak" title="86" id="calibre_link-428" class="calibre11"></span>Unfortunately, with this robustness comes complexity &mdash; in the form of numerous parameters &mdash; making the <code class="calibre26">ps</code> command probably one of the most difficult commands to master. Most system administrators find a subset of these parameters that provide the information they want, and they stick with using only those.</p>
<p class="calibre10">That said, however, the basic <code class="calibre26">ps</code> command doesn't really provide all that much information:</p>
<pre class="calibre29"><code class="calibre26"> $ ps
   PID TTY          TIME CMD
  3081 pts/0    00:00:00 bash
  3209 pts/0    00:00:00 ps
 $</code></pre>
<p class="calibre10">Not too exciting. By default, the <code class="calibre26">ps</code> command shows only the processes that belong to the current user and that are running on the current terminal. In this case, we had only our bash shell running (remember, the shell is just another program running on the system) and, of course, the <code class="calibre26">ps</code> command itself.</p>
<p class="calibre10">The basic output shows the process ID (PID) of the programs, the terminal (TTY) that they are running from, and the CPU time the process has used.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The tricky feature of the <code class="calibre26">ps</code> command (and the part that makes it so complicated) is that at one time there were two versions of it. Each version had its own set of command line parameters controlling what information it displayed and how. Recently, Linux developers have combined the two <code class="calibre26">ps</code> command formats into a single <code class="calibre26">ps</code> program (and of course added their own touches).</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The GNU <code class="calibre26">ps</code> command that's used in Linux systems supports three different types of command line parameters:</p>
<ul class="calibre14">
<li class="calibre7">Unix-style parameters, which are preceded by a dash</li>
<li class="calibre7">BSD-style parameters, which are not preceded by a dash</li>
<li class="calibre7">GNU long parameters, which are preceded by a double dash</li>
</ul>
<p class="calibre10">The following sections examine the three different parameter types and show examples of how they work.</p>
<section class="toclist">
<h4 class="calibre25">Unix-style parameters</h4>
<p class="calibre10">The Unix-style parameters originated with the original <code class="calibre26">ps</code> command that ran on the AT&amp;T Unix systems invented by Bell Labs. <a id="calibre_link-97" href="#calibre_link-96" class="calibre4">Table 4.1</a> shows these parameters.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-96" href="#calibre_link-97" class="calibre4"><b class="calibre21">Table 4.1</b></a></span> <span type="pagebreak" title="87" id="calibre_link-429" class="calibre11"></span>The ps Command Unix Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-A</code></td>
<td class="left">Shows all processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-N</code></td>
<td class="left">Shows the opposite of the specified parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Shows all processes except session headers and processes without a terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code></td>
<td class="left">Shows all processes except session headers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code></td>
<td class="left">Shows all processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-C</code> <code class="calibre26"><i class="calibre12">cmslist</i></code></td>
<td class="left">Shows processes contained in the list <code class="calibre26"><i class="calibre12">cmdlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-G</code> <code class="calibre26"><i class="calibre12">grplist</i></code></td>
<td class="left">Shows processes with a group ID listed in <code class="calibre26"><i class="calibre12">grplist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-U</code> <code class="calibre26"><i class="calibre12">userlist</i></code></td>
<td class="left">Shows processes owned by a userid listed in <code class="calibre26"><i class="calibre12">userlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-g</code> <code class="calibre26"><i class="calibre12">grplist</i></code></td>
<td class="left">Shows processes by session or by groupid contained in <code class="calibre26"><i class="calibre12">grplist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code> <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
<td class="left">Shows processes with PIDs in the list <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code> <code class="calibre26"><i class="calibre12">sesslist</i></code></td>
<td class="left">Shows processes with session ID in the list <code class="calibre26"><i class="calibre12">sesslist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-t</code> <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
<td class="left">Shows processes with terminal ID in the list <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-u</code> <code class="calibre26"><i class="calibre12">userlist</i></code></td>
<td class="left">Shows processes by effective userid in the list <code class="calibre26"><i class="calibre12">userlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-F</code></td>
<td class="left">Uses extra full output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-O</code> <code class="calibre26"><i class="calibre12">format</i></code></td>
<td class="left">Displays specific columns in the list <code class="calibre26"><i class="calibre12">format</i></code>, along with the default columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-M</code></td>
<td class="left">Displays security information about the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">Shows additional scheduler information about the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code></td>
<td class="left">Displays a full format listing</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-j</code></td>
<td class="left">Shows job information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-l</code></td>
<td class="left">Displays a long listing</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-o</code> <code class="calibre26"><i class="calibre12">format</i></code></td>
<td class="left">Displays only specific columns listed in <code class="calibre26"><i class="calibre12">format</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-y</code></td>
<td class="left">Prevents display of process flags</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-Z</code></td>
<td class="left">Displays the security context information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-H</code></td>
<td class="left">Displays processes in a hierarchical format (showing parent processes)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code> <code class="calibre26"><i class="calibre12">namelist</i></code></td>
<td class="left">Defines the values to display in the <code class="calibre26">WCHAN</code> column</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-w</code></td>
<td class="left">Uses wide output format, for unlimited width displays</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-L</code></td>
<td class="left">Shows process threads</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-V</code></td>
<td class="left">Displays the version of <code class="calibre26">ps</code></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="88" id="calibre_link-430" class="calibre11"></span>That's a lot of parameters, and there are still more! The key to using the <code class="calibre26">ps</code> command is not to memorize all the available parameters &mdash; only those you find most useful. Most Linux system administrators have their own sets of parameters that they use for extracting pertinent information. For example, if you need to see everything running on the system, use the <code class="calibre26">-ef</code> parameter combination (the <code class="calibre26">ps</code> command lets you combine parameters like this):</p>
<pre class="calibre29"><code class="calibre26"> $ ps -ef
 UID        PID  PPID  C STIME TTY          TIME CMD
 root         1     0  0 11:29 ?        00:00:01 init [5]
 root         2     0  0 11:29 ?        00:00:00 [kthreadd]
 root         3     2  0 11:29 ?        00:00:00 [migration/0]
 root         4     2  0 11:29 ?        00:00:00 [ksoftirqd/0]
 root         5     2  0 11:29 ?        00:00:00 [watchdog/0]
 root         6     2  0 11:29 ?        00:00:00 [events/0]
 root         7     2  0 11:29 ?        00:00:00 [khelper]
 root        47     2  0 11:29 ?        00:00:00 [kblockd/0]
 root        48     2  0 11:29 ?        00:00:00 [kacpid]
 68        2349     1  0 11:30 ?        00:00:00 hald
 root      3078  1981  0 12:00 ?        00:00:00 sshd: rich [priv]
 rich      3080  3078  0 12:00 ?        00:00:00 sshd: rich@pts/0
 rich      3081  3080  0 12:00 pts/0    00:00:00 -bash
 rich      4445  3081  3 13:48 pts/0    00:00:00 ps -ef
 $</code></pre>
<p class="calibre10">Quite a few lines have been cut from the output to save space, but you can see that lots of processes are running on a Linux system. This example uses two parameters: the <code class="calibre26">-e</code> parameter, which shows all the processes running on the system, and the <code class="calibre26">-f</code> parameter, which expands the output to show a few useful columns of information:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">UID:</b> The user responsible for launching the process</li>
<li class="calibre7"><b class="calibre21">PID:</b> The process ID of the process</li>
<li class="calibre7"><b class="calibre21">PPID:</b> The PID of the parent process (if a process is started by another process)</li>
<li class="calibre7"><b class="calibre21">C:</b> Processor utilization over the lifetime of the process</li>
<li class="calibre7"><b class="calibre21">STIME:</b> The system time when the process started</li>
<li class="calibre7"><b class="calibre21">TTY:</b> The terminal device from which the process was launched</li>
<li class="calibre7"><b class="calibre21">TIME:</b> The cumulative CPU time required to run the process</li>
<li class="calibre7"><b class="calibre21">CMD:</b> The name of the program that was started</li>
</ul>
<p class="calibre10">This produces a reasonable amount of information, which is what many system administrators want to see. For even more information, you can use the <code class="calibre26">-l</code> parameter, which produces the long format output:</p>
<pre class="calibre29"><code class="calibre26"> $ ps -l
 F S  UID PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY      TIME   CMD
 0 S  500 3081  3080  0  80   0 -  1173 wait pts/0   00:00:00 bash
 0 R  500 4463  3081  1  80   0 -  1116 -    pts/0   00:00:00 ps
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="89" id="calibre_link-431" class="calibre11"></span>Notice the extra columns that appear when you use the <code class="calibre26">-l</code> parameter:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">F:</code> System flags assigned to the process by the kernel</li>
<li class="calibre7"><code class="calibre26">S:</code> The state of the process (<code class="calibre26">O</code> = running on processor; <code class="calibre26">S</code> = sleeping; <code class="calibre26">R</code> = runnable, waiting to run; <code class="calibre26">Z</code> = zombie, process terminated but parent not available; <code class="calibre26">T</code> = process stopped)</li>
<li class="calibre7"><code class="calibre26">PRI</code>: The priority of the process (higher numbers mean lower priority)</li>
<li class="calibre7"><code class="calibre26">NI</code>: The nice value, which is used for determining priorities</li>
<li class="calibre7"><code class="calibre26">ADDR</code>: The memory address of the process</li>
<li class="calibre7"><code class="calibre26">SZ</code>: Approximate amount of swap space required if the process was swapped out</li>
<li class="calibre7"><code class="calibre26">WCHAN</code>: Address of the kernel function where the process is sleeping</li>
</ul>
</section>
<section class="toclist">
<h4 class="calibre25">BSD-style parameters</h4>
<p class="calibre10">Now that you've seen the Unix parameters, let's look at the BSD-style parameters. The Berkeley Software Distribution (BSD) was a version of Unix developed at (of course) the University of California, Berkeley. It had many subtle differences from the AT&amp;T Unix system, thus sparking many Unix wars over the years. <a id="calibre_link-99" href="#calibre_link-98" class="calibre4">Table 4.2</a> shows the BSD version of the <code class="calibre26">ps</code> command parameters.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-98" href="#calibre_link-99" class="calibre4"><b class="calibre21">Table 4.2</b></a></span> The ps Command BSD Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">T</code></td>
<td class="left">Shows all processes associated with this terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">a</code></td>
<td class="left">Shows all processes associated with any terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">g</code></td>
<td class="left">Shows all processes including session headers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">r</code></td>
<td class="left">Shows only running processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">x</code></td>
<td class="left">Shows all processes, even those without a terminal device assigned</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">U</code> <code class="calibre26"><i class="calibre12">userlist</i></code></td>
<td class="left">Shows processes owned by a userid listed in <code class="calibre26"><i class="calibre12">userlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">p</code> <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
<td class="left">Shows processes with a PID listed in <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">t</code> <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
<td class="left">Shows processes associated with a terminal listed in <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">O</code> <code class="calibre26"><i class="calibre12">format</i></code></td>
<td class="left">Lists specific columns in <code class="calibre26"><i class="calibre12">format</i></code> to display along with the standard columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">X</code></td>
<td class="left">Displays data in the register format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Z</code></td>
<td class="left">Includes security information in the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">j</code></td>
<td class="left">Shows job information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">l</code></td>
<td class="left">Uses the long format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">o</code> <code class="calibre26"><i class="calibre12">format</i></code></td>
<td class="left">Displays only columns specified in <code class="calibre26"><i class="calibre12">format</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">s</code></td>
<td class="left">Uses the signal format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">u</code></td>
<td class="left">Uses the user-oriented format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">v</code></td>
<td class="left">Uses the virtual memory format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">N</code> <code class="calibre26"><i class="calibre12">namelist</i></code></td>
<td class="left">Defines the values to use in the <code class="calibre26">WCHAN</code> column</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">O</code> <code class="calibre26"><i class="calibre12">order</i></code></td>
<td class="left">Defines the order in which to display the information columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">S</code></td>
<td class="left">Sums numerical information, such as CPU and memory usage, for child processes into the parent process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">c</code></td>
<td class="left">Displays the true command name (the name of the program used to start the process)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">e</code></td>
<td class="left">Displays any environment variables used by the command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">f</code></td>
<td class="left">Displays processes in a hierarchical format, showing which processes started which processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">h</code></td>
<td class="left">Prevents display of the header information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">k</code> <code class="calibre26"><i class="calibre12">sort</i></code></td>
<td class="left">Defines the column(s) to use for sorting the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n</code></td>
<td class="left">Uses numeric values for user and group IDs, along with WCHAN information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">w</code></td>
<td class="left">Produces wide output for wider terminals</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">H</code></td>
<td class="left">Displays threads as if they were processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">m</code></td>
<td class="left">Displays threads after their processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">L</code></td>
<td class="left">Lists all format specifiers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">V</code></td>
<td class="left">Displays the version of <code class="calibre26">ps</code></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="90" id="calibre_link-432" class="calibre11"></span>As you can see, the Unix and BSD types of parameters have lots of overlap. Most of the information you can get from one you can also get from the other. Most of the time, you choose a parameter type based on which format you're more comfortable with (for example, if you were used to a BSD environment before using Linux).</p>
<p class="calibre10">When you use the BSD-style parameters, the <code class="calibre26">ps</code> command automatically changes the output to simulate the BSD format. Here's an example using the <code class="calibre26">l</code> parameter:</p>
<pre class="calibre29"><code class="calibre26"> $ ps l
 F  UID  PID PPID PRI  NI  VSZ  RSS WCHAN  STAT TTY      TIME COMMAND
 0  500 3081 3080  20   0 4692 1432 wait   Ss   pts/0    0:00 -bash
 0  500 5104 3081  20   0 4468  844 -      R+   pts/0    0:00 ps l
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="91" id="calibre_link-433" class="calibre11"></span>Notice that while many of the output columns are the same as when we used the Unix-style parameters, some different ones appear as well:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">VSZ:</b> The size in kilobytes of the process in memory</li>
<li class="calibre7"><b class="calibre21">RSS:</b> The physical memory that a process has used that isn't swapped out</li>
<li class="calibre7"><b class="calibre21">STAT:</b> A two-character state code representing the current process state</li>
</ul>
<p class="calibre10">Many system administrators like the BSD-style <code class="calibre26">l</code> parameter because it produces a more detailed state code for processes (the STAT column). The two-character code more precisely defines exactly what's happening with the process than the single-character Unix-style output.</p>
<p class="calibre10">The first character uses the same values as the Unix-style <code class="calibre26">S</code> output column, showing when a process is sleeping, running, or waiting. The second character further defines the process's status:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">&lt;</code>: The process is running at high priority.</li>
<li class="calibre7"><code class="calibre26">N</code>: The process is running at low priority.</li>
<li class="calibre7"><code class="calibre26">L</code>: The process has pages locked in memory.</li>
<li class="calibre7"><code class="calibre26">s</code>: The process is a session leader.</li>
<li class="calibre7"><code class="calibre26">l</code>: The process is multi-threaded.</li>
<li class="calibre7"><code class="calibre26">+</code>: The process is running in the foreground.</li>
</ul>
<p class="calibre10">From the simple example shown previously, you can see that the <code class="calibre26">bash</code> command is sleeping, but it is a session leader (it's the main process in my session), whereas the <code class="calibre26">ps</code> command was running in the foreground on the system.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The GNU long parameters</h4>
<p class="calibre10">Finally, the GNU developers put their own touches on the new, improved <code class="calibre26">ps</code> command by adding a few more options to the parameter mix. Some of the GNU long parameters copy existing Unix- or BSD-style parameters, while others provide new features. <a id="calibre_link-101" href="#calibre_link-100" class="calibre4">Table 4.3</a> lists the available GNU long parameters.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-100" href="#calibre_link-101" class="calibre4"><b class="calibre21">Table 4.3</b></a></span> The ps Command GNU Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--deselect</code></td>
<td class="left">Shows all processes except those listed in the command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--Group</code> <code class="calibre26"><i class="calibre12">grplist</i></code></td>
<td class="left">Shows processes whose group ID is listed in <code class="calibre26"><i class="calibre12">grplist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--User</code> <code class="calibre26"><i class="calibre12">userlist</i></code></td>
<td class="left">Shows processes whose user ID is listed in <code class="calibre26"><i class="calibre12">userlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--group</code> <code class="calibre26"><i class="calibre12">grplist</i></code></td>
<td class="left">Shows processes whose effective group ID is listed in <code class="calibre26"><i class="calibre12">grplist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--pid</code> <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
<td class="left">Shows processes whose process ID is listed in <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--ppid</code> <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
<td class="left">Shows processes whose parent process ID is listed in <code class="calibre26"><i class="calibre12">pidlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--sid</code> <code class="calibre26"><i class="calibre12">sidlist</i></code></td>
<td class="left">Shows processes whose session ID is listed in <code class="calibre26"><i class="calibre12">sidlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--tty</code> <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
<td class="left">Shows processes whose terminal device ID is listed in <code class="calibre26"><i class="calibre12">ttylist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--user</code> <code class="calibre26"><i class="calibre12">userlist</i></code></td>
<td class="left">Shows processes whose effective user ID is listed in <code class="calibre26"><i class="calibre12">userlist</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--format</code> <code class="calibre26"><i class="calibre12">format</i></code></td>
<td class="left">Displays only columns specified in the <i class="calibre12">format</i></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--context</code></td>
<td class="left">Displays additional security information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--cols</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Sets screen width to <code class="calibre26"><i class="calibre12">n</i></code> columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--columns</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Sets screen width to <code class="calibre26"><i class="calibre12">n</i> </code>columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--cumulative</code></td>
<td class="left">Includes stopped child process information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--forest</code></td>
<td class="left">Displays processes in a hierarchical listing showing parent processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--headers</code></td>
<td class="left">Repeats column headers on each page of output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--no-headers</code></td>
<td class="left">Prevents display of column headers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--lines</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Sets the screen height to <code class="calibre26"><i class="calibre12">n</i></code> lines</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--rows</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Sets the screen height to <code class="calibre26"><i class="calibre12">n</i></code><code class="calibre26"> </code>rows</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--sort</code> <code class="calibre26"><i class="calibre12">order</i></code></td>
<td class="left">Defines the column(s) to use for sorting the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--width</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Sets the screen width to <code class="calibre26"><i class="calibre12">n</i> </code>columns</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--help</code></td>
<td class="left">Displays the help information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--info</code></td>
<td class="left">Displays debugging information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--version</code></td>
<td class="left">Displays the version of the <code class="calibre26">ps</code> program</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="92" id="calibre_link-434" class="calibre11"></span>You can combine GNU long parameters with either Unix- or BSD-style parameters to really customize your display. One cool feature of GNU long parameters that we really like is the <code class="calibre26">--forest</code> parameter. It displays the hierarchical process information, but using ASCII characters to draw cute charts:</p>
<pre class="calibre29"><code class="calibre26">  1981 ?        00:00:00 sshd
  3078 ?        00:00:00  \_ sshd
  3080 ?        00:00:00      \_ sshd
  3081 pts/0    00:00:00          \_ bash
 16676 pts/0    00:00:00              \_ ps</code></pre>
<p class="calibre10">This format makes tracing child and parent processes a snap!</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Real-time process monitoring</h3>
<p class="calibre10">The <code class="calibre26">ps</code> command is great for gleaning information about processes running on the system, but it has one drawback. The <code class="calibre26">ps</code> command can display information only for a specific point in time. If you're trying to find trends about processes that are frequently swapped in and out of memory, it's hard to do that with the <code class="calibre26">ps</code> command.</p>
<p class="calibre10"><span type="pagebreak" title="93" id="calibre_link-435" class="calibre11"></span>Instead, the <code class="calibre26">top</code> command can solve this problem. The <code class="calibre26">top</code> command displays process information similarly to the <code class="calibre26">ps</code> command, but it does it in real-time mode. <a id="calibre_link-103" href="#calibre_link-102" class="calibre4">Figure 4.1</a> is a snapshot of the <code class="calibre26">top</code> command in action.</p>
<figure class="calibre23">
<img class="center" src="images/000038.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-102" href="#calibre_link-103" class="calibre4"><b class="calibre21">Figure 4.1</b></a></span> The output of the top command while it is running</p>
</figcaption>
</figure>
<p class="calibre10">The first section of the output shows general system information. The first line shows the current time, how long the system has been up, the number of users logged in, and the load average on the system.</p>
<p class="calibre10">The load average appears as three numbers: the 1-minute, 5-minute, and 15-minute load averages. The higher the values, the more load the system is experiencing. It's not uncommon for the 1-minute load value to be high for short bursts of activity. If the 15-minute load value is high, your system may be in trouble.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The trick in Linux system administration is defining what exactly a high load average value is. This value depends on what's normally running on your system and the hardware configuration. What's high for one system might be normal for another. Usually, if your load averages start getting over 2, things are getting busy on your system.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="94" id="calibre_link-436" class="calibre11"></span>The second line shows general process information (called <i class="calibre12">tasks</i> in <code class="calibre26">top</code>): how many processes are running, sleeping, stopped, and zombie (have finished but their parent process hasn't responded).</p>
<p class="calibre10">The next line shows general CPU information. The <code class="calibre26">top</code> display breaks down the CPU utilization into several categories depending on the owner of the process (user versus system processes) and the state of the processes (running, idle, or waiting).</p>
<p class="calibre10">Following that are two lines that detail the status of the system memory. The first line shows the status of the physical memory in the system, how much total memory there is, how much is currently being used, and how much is free. The second memory line shows the status of the swap memory area in the system (if any is installed), with the same information.</p>
<p class="calibre10">Finally, the next section shows a detailed list of the currently running processes, with some information columns that should look familiar from the <code class="calibre26">ps</code> command output:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">PID:</b> The process ID of the process</li>
<li class="calibre7"><b class="calibre21">USER:</b> The user name of the owner of the process</li>
<li class="calibre7"><b class="calibre21">PR:</b> The priority of the process</li>
<li class="calibre7"><b class="calibre21">NI:</b> The nice value of the process</li>
<li class="calibre7"><b class="calibre21">VIRT:</b> The total amount of virtual memory used by the process</li>
<li class="calibre7"><b class="calibre21">RES:</b> The amount of physical memory the process is using</li>
<li class="calibre7"><b class="calibre21">SHR:</b> The amount of memory the process is sharing with other processes</li>
<li class="calibre7"><b class="calibre21">S:</b> The process status (<code class="calibre26">D</code> = interruptible sleep, <code class="calibre26">R</code> = running, <code class="calibre26">S</code> = sleeping, <code class="calibre26">T</code> = traced or stopped, or <code class="calibre26">Z</code> = zombie)</li>
<li class="calibre7"><b class="calibre21">%CPU:</b> The share of CPU time that the process is using</li>
<li class="calibre7"><b class="calibre21">%MEM:</b> The share of available physical memory the process is using</li>
<li class="calibre7"><b class="calibre21">TIME+:</b> The total CPU time the process has used since starting</li>
<li class="calibre7"><b class="calibre21">COMMAND:</b> The command line name of the process (program started)</li>
</ul>
<p class="calibre10">By default, when you start <code class="calibre26">top</code>, it sorts the processes based on the <code class="calibre26">%CPU</code> value. You can change the sort order by using one of several interactive commands while <code class="calibre26">top</code> is running. Each interactive command is a single character that you can press while <code class="calibre26">top </code>is running and changes the behavior of the program. Pressing <code class="calibre26">f</code> allows you to select the field to use to sort the output, and pressing <code class="calibre26">d</code> allows you to change the polling interval. Press <code class="calibre26">q</code> to exit the top display.</p>
<p class="calibre10"><span type="pagebreak" title="95" id="calibre_link-437" class="calibre11"></span>You have lots of control over the output of the <code class="calibre26">top</code> command. Using this tool, you can often find offending processes that have taken over your system. Of course, after you find one, the next job is to stop it, which brings us to the next topic.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Stopping processes</h3>
<p class="calibre10">A crucial part of being a system administrator is knowing when and how to stop a process. Sometimes, a process gets hung up and needs a gentle nudge to either get going again or stop. Other times, a process runs away with the CPU and refuses to give it up. In both cases, you need a command that allows you to control a process. Linux follows the Unix method of interprocess communication.</p>
<p class="calibre10">In Linux, processes communicate with each other using <i class="calibre12">signals</i>. A process signal is a predefined message that processes recognize and may choose to ignore or act on. The developers program how a process handles signals. Most well-written applications have the ability to receive and act on the standard Unix process signals. <a id="calibre_link-105" href="#calibre_link-104" class="calibre4">Table 4.4</a> shows these signals.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-104" href="#calibre_link-105" class="calibre4"><b class="calibre21">Table 4.4</b></a></span> Linux Process Signals</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Signal</td>
<td class="left">Name</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">1</td>
<td class="left">HUP</td>
<td class="left">Hangs up</td>
</tr>
<tr class="calibre28">
<td class="left">2</td>
<td class="left">INT</td>
<td class="left">Interrupts</td>
</tr>
<tr class="calibre28">
<td class="left">3</td>
<td class="left">QUIT</td>
<td class="left">Stops running</td>
</tr>
<tr class="calibre28">
<td class="left">9</td>
<td class="left">KILL</td>
<td class="left">Unconditionally terminates</td>
</tr>
<tr class="calibre28">
<td class="left">11</td>
<td class="left">SEGV</td>
<td class="left">Produces segment violation</td>
</tr>
<tr class="calibre28">
<td class="left">15</td>
<td class="left">TERM</td>
<td class="left">Terminates if possible</td>
</tr>
<tr class="calibre28">
<td class="left">17</td>
<td class="left">STOP</td>
<td class="left">Stops unconditionally, but doesn't terminate</td>
</tr>
<tr class="calibre28">
<td class="left">18</td>
<td class="left">TSTP</td>
<td class="left">Stops or pauses, but continues to run in background</td>
</tr>
<tr class="calibre28">
<td class="left">19</td>
<td class="left">CONT</td>
<td class="left">Resumes execution after STOP or TSTP</td>
</tr>
</table>
</figure>
<p class="calibre10">Two commands available in Linux allow you to send process signals to running processes.</p>
<section class="toclist">
<h4 class="calibre25">The kill command</h4>
<p class="calibre10">The <code class="calibre26">kill</code> command allows you to send signals to processes based on their process ID (PID). By default, the <code class="calibre26">kill</code> command sends a <code class="calibre26">TERM</code> signal to all the PIDs listed on the command line. Unfortunately, you can only use the process PID instead of its command name, making the <code class="calibre26">kill</code> command difficult to use sometimes.</p>
<p class="calibre10"><span type="pagebreak" title="96" id="calibre_link-438" class="calibre11"></span>To send a process signal, you must either be the owner of the process or be logged in as the root user.</p>
<pre class="calibre29"><code class="calibre26"> $ kill 3940
 -bash: kill: (3940) - Operation not permitted
 $</code></pre>
<p class="calibre10">The <code class="calibre26">TERM</code> signal tells the process to kindly stop running. Unfortunately, if you have a runaway process, most likely it ignores the request. When you need to get forceful, the <code class="calibre26">-s</code> parameter allows you to specify other signals (either using their name or signal number).</p>
<p class="calibre10">As you can see from the following example, no output is associated with the <code class="calibre26">kill</code> command.</p>
<pre class="calibre29"><code class="calibre26"> # kill -s HUP 3940
 #</code></pre>
<p class="calibre10">To see if the command was effective, you must perform another <code class="calibre26">ps</code> or <code class="calibre26">top</code> command to see if the offending process stopped.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The killall command</h4>
<p class="calibre10">The <code class="calibre26">killall</code> command is a powerful way to stop processes by using their names rather than the PID numbers. The <code class="calibre26">killall</code> command allows you to use wildcard characters as well, making it a very useful tool when you have a system that's gone awry:</p>
<pre class="calibre29"><code class="calibre26"># killall http*
#</code></pre>
<p class="calibre10">This example kills all the processes that start with http, such as the httpd services for the Apache web server.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Be extremely careful using the killall command when logged in as the root user. It's easy to get carried away with wildcard characters and accidentally stop important system processes. This could lead to a damaged filesystem.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-148" class="calibre4"></a>Monitoring Disk Space</h2>
<p class="calibre10">Another important task of the system administrator is to keep track of the disk usage on the system. Whether you're running a simple Linux desktop or a large Linux server, you need to know how much space you have for your applications.</p>
<p class="calibre10">Some command line commands can help you manage the media environment on your Linux system. This section describes the core commands you'll likely run into during your system administration duties.</p>
<section class="toclist">
<h3 class="calibre15">Mounting media</h3>
<p class="calibre10"><span type="pagebreak" title="97" id="calibre_link-439" class="calibre11"></span>As discussed in Chapter 3, the Linux filesystem combines all media disks into a single virtual directory. Before you can use a new media disk on your system, you must place it in the virtual directory. This task is called <i class="calibre12">mounting</i>.</p>
<p class="calibre10">In today's graphical desktop world, most Linux distributions have the ability to automatically mount specific types of <i class="calibre12">removable media</i>. A removable media device is a medium that (obviously) can be easily removed from the PC, such as CD-ROMs and USB memory sticks.</p>
<p class="calibre10">If you're not using a distribution that automatically mounts and unmounts removable media, you have to do it yourself. This section describes the Linux command line commands to help you manage your removable media devices.</p>
<section class="toclist">
<h4 class="calibre25">The mount command</h4>
<p class="calibre10">Oddly enough, the command used to mount media is called <code class="calibre26">mount</code>. By default, the <code class="calibre26">mount</code> command displays a list of media devices currently mounted on the system:</p>
<pre class="calibre29"><code class="calibre26"> $ mount
 /dev/mapper/VolGroup00-LogVol00 on / type ext3 (rw)
 proc on /proc type proc (rw)
 sysfs on /sys type sysfs (rw)
 devpts on /dev/pts type devpts (rw,gid=5,mode=620)
 /dev/sda1 on /boot type ext3 (rw)
 tmpfs on /dev/shm type tmpfs (rw)
 none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)
 sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)
 /dev/sdb1 on /media/disk type vfat
 (rw,nosuid,nodev,uhelper=hal,shortname=lower,uid=503)
 $</code></pre>
<p class="calibre10">The <code class="calibre26">mount</code> command provides four pieces of information:</p>
<ul class="calibre14">
<li class="calibre7">The device filename of the media</li>
<li class="calibre7">The mount point in the virtual directory where the media is mounted</li>
<li class="calibre7">The filesystem type</li>
<li class="calibre7">The access status of the mounted media</li>
</ul>
<p class="calibre10">The last entry in the preceding example is a USB memory stick that the GNOME desktop automatically mounted at the <code class="calibre26">/media/disk</code> mount point. The vfat filesystem type shows that it was formatted on a Microsoft Windows PC.</p>
<p class="calibre10">To manually mount a media device in the virtual directory, you must be logged in as the root user or use the <code class="calibre26">sudo</code> command to run the command as the root user. The following is the basic command for manually mounting a media device:</p>
<pre class="calibre29"><code class="calibre26"> mount -t type device directory</code></pre>
<p class="calibre10"><span type="pagebreak" title="98" id="calibre_link-440" class="calibre11"></span>The <code class="calibre26">type</code> parameter defines the filesystem type under which the disk was formatted. Linux recognizes lots of different filesystem types. If you share removable media devices with your Windows PCs, you are most likely to run into these types:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">vfat:</b> Windows long filesystem</li>
<li class="calibre7"><b class="calibre21">ntfs:</b> Windows advanced filesystem used in Windows NT, XP, and Vista</li>
<li class="calibre7"><b class="calibre21">iso9660:</b> The standard CD-ROM filesystem</li>
</ul>
<p class="calibre10">Most USB memory sticks and floppies are formatted using the vfat filesystem. If you need to mount a data CD, you must use the iso9660 filesystem type.</p>
<p class="calibre10">The next two parameters define the location of the device file for the media device and the location in the virtual directory for the mount point. For example, to manually mount the USB memory stick at device <code class="calibre26">/dev/sdb1</code> at location <code class="calibre26">/media/disk</code>, you use the following command:</p>
<pre class="calibre29"><code class="calibre26"> mount -t vfat /dev/sdb1 /media/disk</code></pre>
<p class="calibre10">After a media device is mounted in the virtual directory, the root user has full access to the device, but access by other users is restricted. You can control who has access to the device using directory permissions (discussed in Chapter 7).</p>
<p class="calibre10">In case you need to use some of the more exotic features of the <code class="calibre26">mount</code> command, <a id="calibre_link-107" href="#calibre_link-106" class="calibre4">Table 4.5</a> shows the available parameters .</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-106" href="#calibre_link-107" class="calibre4"><b class="calibre21">Table 4.5</b></a></span> The mount Command Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Mounts all filesystems specified in the <code class="calibre26">/etc/fstab</code> file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code></td>
<td class="left">Causes the mount command to simulate mounting a device, but not actually mount it</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-F</code></td>
<td class="left">Mounts all filesystems at the same time when used with the <code class="calibre26">-a</code> parameter</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v</code></td>
<td class="left">Explains all the steps required to mount the device; stands for verbose mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-I</code></td>
<td class="left">Tells you not to use any filesystem helper files under <code class="calibre26">/sbin/mount .filesystem</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-l</code></td>
<td class="left">Adds the filesystem labels automatically for ext2, ext3, or XFS filesystems</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Mounts the device without registering it in the <code class="calibre26">/etc/mstab</code> mounted device file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code> <code class="calibre26"><i class="calibre12">num</i></code></td>
<td class="left">For encrypted mounting, reads the passphrase from the file descriptor <i class="calibre12">num</i></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Ignores mount options not supported by the filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">Mounts the device as read-only</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-w</code></td>
<td class="left">Mounts the device as read-write (the default)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-L label</code></td>
<td class="left">Mounts the device with the specified <code class="calibre26"><i class="calibre12">label</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-U</code> <code class="calibre26"><i class="calibre12">uuid</i></code></td>
<td class="left">Mounts the device with the specified <code class="calibre26"><i class="calibre12">uuid</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-O</code></td>
<td class="left">When used with the <code class="calibre26">-a</code> parameter, limits the set of filesystems applied</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-o</code></td>
<td class="left">Adds specific options to the filesystem</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="99" id="calibre_link-441" class="calibre11"></span>The <code class="calibre26">-o</code> option allows you to mount the filesystem with a comma-separated list of additional options. These are popular options to use:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">ro</code>: Mounts as read-only</li>
<li class="calibre7"><code class="calibre26">rw</code>: Mounts as read-write</li>
<li class="calibre7"><code class="calibre26">user</code>: Allows an ordinary user to mount the filesystem</li>
<li class="calibre7"><code class="calibre26">check=none</code>: Mounts the filesystem without performing an integrity check</li>
<li class="calibre7"><code class="calibre26">loop</code>: Mounts a file</li>
</ul>
</section>
<section class="toclist">
<h4 class="calibre25">The unmount command</h4>
<p class="calibre10">To remove a removable media device, you should never just remove it from the system. Instead, you should always <i class="calibre12">unmount</i> it first.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Linux doesn't allow you to eject a mounted CD. If you ever have trouble removing a CD from the drive, most likely it means the CD is still mounted in the virtual directory. Unmount it first, and then try to eject it.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The command used to unmount devices is <code class="calibre26">umount</code> (yes, there's no ânâ in the command, which gets confusing sometimes). The format for the <code class="calibre26">umount</code> command is pretty simple:</p>
<pre class="calibre29"><code class="calibre26"> umount [directory | device ]</code></pre>
<p class="calibre10">The <code class="calibre26">umount</code> command gives you the choice of defining the media device by either its device location or its mounted directory name. If any program has a file open on a device, the system won't let you unmount it.</p>
<pre class="calibre29"><code class="calibre26"> [root@testbox mnt]# umount /home/rich/mnt
 umount: /home/rich/mnt: device is busy
 umount: /home/rich/mnt: device is busy
 [root@testbox mnt]# cd /home/rich
 [root@testbox rich]# umount /home/rich/mnt
 [root@testbox rich]# ls -l mnt
 total 0
 [root@testbox rich]#</code></pre>
<p class="calibre10"><span type="pagebreak" title="100" id="calibre_link-442" class="calibre11"></span>In this example, the command prompt was still in a directory within the filesystem structure, so the <code class="calibre26">umount</code> command couldn't unmount the image file. After the command prompt was moved out of the image file filesystem, the <code class="calibre26">umount</code> command successfully unmounted the image file.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using the df command</h3>
<p class="calibre10">Sometimes, you need to see how much disk space is available on an individual device. The <code class="calibre26">df</code> command allows you to easily see what's happening on all the mounted disks:</p>
<pre class="calibre29"><code class="calibre26"> $ df
 Filesystem           1K-blocks      Used Available Use% Mounted on
 /dev/sda2             18251068   7703964   9605024  45% /
 /dev/sda1               101086     18680     77187  20% /boot
 tmpfs                   119536         0    119536   0% /dev/shm
 /dev/sdb1               127462    113892     13570  90% /media/disk
 $</code></pre>
<p class="calibre10">The <code class="calibre26">df</code> command shows each mounted filesystem that contains data. As you can see from the <code class="calibre26">mount</code> command earlier, some mounted devices are used for internal system purposes. The command displays the following:</p>
<ul class="calibre14">
<li class="calibre7">The device location of the device</li>
<li class="calibre7">How many 1024-byte blocks of data it can hold</li>
<li class="calibre7">How many 1024-byte blocks are used</li>
<li class="calibre7">How many 1024-byte blocks are available</li>
<li class="calibre7">The amount of used space as a percentage</li>
<li class="calibre7">The mount point where the device is mounted</li>
</ul>
<p class="calibre10">A few different command line parameters are available with the <code class="calibre26">df</code> command, most of which you'll never use. One popular parameter is <code class="calibre26">-h</code>, which shows the disk space in human-readable form, usually as an M for megabytes or a G for gigabytes:</p>
<pre class="calibre29"><code class="calibre26"> $ df -h
 Filesystem            Size  Used Avail Use% Mounted on
 /dev/sdb2              18G  7.4G  9.2G  45% /
 /dev/sda1              99M   19M   76M  20% /boot
 tmpfs                 117M     0  117M   0% /dev/shm
 /dev/sdb1             125M  112M   14M  90% /media/disk
 $</code></pre>
<p class="calibre10">Now instead of having to decode those ugly block numbers, all the disk sizes are shown using ânormalâ sizes. The <code class="calibre26">df</code> command is invaluable in troubleshooting disk space problems on the system.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Remember that the Linux system always has processes running in the background that handle files. The values from the <code class="calibre26">df</code> command reflect what the Linux system thinks are the current values at that point in time. It's possible that you have a process running that has created or deleted a file but has not released the file yet. This value is not included in the free space calculation.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Using the du command</h3>
<p class="calibre10"><span type="pagebreak" title="101" id="calibre_link-443" class="calibre11"></span>With the <code class="calibre26">df</code> command, you can easily see when a disk is running out of space. The next problem for the system administrator is to know what to do when that happens.</p>
<p class="calibre10">Another useful command to help you is the <code class="calibre26">du</code> command. The <code class="calibre26">du</code> command shows the disk usage for a specific directory (by default, the current directory). This is a quick way to determine if you have any obvious disk hogs on the system.</p>
<p class="calibre10">By default, the <code class="calibre26">du</code> command displays all the files, directories, and subdirectories under the current directory, and it shows how many disk blocks each file or directory takes. For a standard-sized directory, this can be quite a listing. Here's a partial listing of using the <code class="calibre26">du</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ du
 484     ./.gstreamer-0.10
 8       ./Templates
 8       ./Download
 8       ./.ccache/7/0
 24      ./.ccache/7
 368     ./.ccache/a/d
 384     ./.ccache/a
 424     ./.ccache
 8       ./Public
 8       ./.gphpedit/plugins
 32      ./.gphpedit
 72      ./.gconfd
 128     ./.nautilus/metafiles
 384     ./.nautilus
 72      ./.bittorrent/data/metainfo
 20      ./.bittorrent/data/resume
 144     ./.bittorrent/data
 152     ./.bittorrent
 8       ./Videos
 8       ./Music
 16      ./.config/gtk-2.0
 40      ./.config
 8       ./Documents</code></pre>
<p class="calibre10"><span type="pagebreak" title="102" id="calibre_link-444" class="calibre11"></span>The number at the left of each line is the number of disk blocks that each file or directory takes. Notice that the listing starts at the bottom of a directory and works its way up through the files and subdirectories contained within the directory.</p>
<p class="calibre10">The <code class="calibre26">du</code> command by itself can be somewhat useless. It's nice to be able to see how much disk space each individual file and directory takes up, but it can be meaningless when you have to wade through pages and pages of information before you find what you're looking for.</p>
<p class="calibre10">You can use a few command line parameters with the <code class="calibre26">du</code> command to make things a little more legible:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">-c</code>: Produces a grand total of all the files listed</li>
<li class="calibre7"><code class="calibre26">-h</code>: Prints sizes in human-readable form, using K for kilobyte, M for megabyte, and G for gigabyte</li>
<li class="calibre7"><code class="calibre26">-s</code>: Summarizes each argument</li>
</ul>
<p class="calibre10">The next step for the system administrator is to use some file-handling commands for manipulating large amounts of data. That's exactly what the next section covers.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-149" class="calibre4"></a>Working with Data Files</h2>
<p class="calibre10">When you have a large amount of data, handling the information and making it useful can be difficult. As you saw with the <code class="calibre26">du</code> command in the previous section, it's easy to get data overload when working with system commands.</p>
<p class="calibre10">The Linux system provides several command line tools to help you manage large amounts of data. This section covers the basic commands that every system administrator &mdash; as well as any everyday Linux user &mdash; should know how to use to make their lives easier.</p>
<section class="toclist">
<h3 class="calibre15">Sorting data</h3>
<p class="calibre10">The <code class="calibre26">sort</code> command is a popular function that comes in handy when working with large amounts of data. The <code class="calibre26">sort</code> command does what it says: It sorts data.</p>
<p class="calibre10">By default, the <code class="calibre26">sort</code> command sorts the data lines in a text file using standard sorting rules for the language you specify as the default for the session.</p>
<pre class="calibre29"><code class="calibre26"> $ cat file1
 one
 two
 three
 four
 five
 $ sort file1
 five
 four
 one
 three
 two
 $</code></pre>
<p class="calibre10">It's pretty simple, but things aren't always as easy as they appear. Look at this example:</p>
<pre class="calibre29"><code class="calibre26"> $ cat file2
 1
 2
 100
 45
 3
 10
 145
 75
 $ sort file2
 1
 10
 100
 145
 2
 3
 45
 75
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="103" id="calibre_link-445" class="calibre11"></span>If you were expecting the numbers to sort in numerical order, you were disappointed. By default, the <code class="calibre26">sort</code> command interprets numbers as characters and performs a standard character sort, producing output that might not be what you want. To solve this problem, use the <code class="calibre26">-n</code> parameter, which tells the <code class="calibre26">sort</code> command to recognize numbers as numbers instead of characters and to sort them based on their numerical values:</p>
<pre class="calibre29"><code class="calibre26"> $ sort -n file2
 1
 2
 3
 10
 45
 75
 100
 145
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="104" id="calibre_link-446" class="calibre11"></span>Now, that's much better! Another common parameter that's used is <code class="calibre26">-M</code>, the month sort. Linux log files usually contain a timestamp at the beginning of the line to indicate when the event occurred:</p>
<pre class="calibre29"><code class="calibre26"> Sep 13 07:10:09 testbox smartd[2718]: Device: /dev/sda, opened</code></pre>
<p class="calibre10">If you sort a file that uses timestamp dates using the default sort, you get something like this:</p>
<pre class="calibre29"><code class="calibre26"> $ sort file3
 Apr
 Aug
 Dec
 Feb
 Jan
 Jul
 Jun
 Mar
 May
 Nov
 Oct
 Sep
 $</code></pre>
<p class="calibre10">It's not exactly what you wanted. If you use the <code class="calibre26">-M</code> parameter, the sort command recognizes the three-character month nomenclature and sorts appropriately:</p>
<pre class="calibre29"><code class="calibre26"> $ sort -M file3
 Jan
 Feb
 Mar
 Apr
 May
 Jun
 Jul
 Aug
 Sep
 Oct
 Nov
 Dec
 $</code></pre>
<p class="calibre10"><a id="calibre_link-109" href="#calibre_link-108" class="calibre4">Table 4.6</a> shows other handy <code class="calibre26">sort</code> parameters you can use.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-108" href="#calibre_link-109" class="calibre4"><b class="calibre21">Table 4.6</b></a></span> <span type="pagebreak" title="105" id="calibre_link-447" class="calibre11"></span>The sort Command Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Single Dash</td>
<td class="left">Double Dash</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-b</code></td>
<td class="left">--ignore-leading-blanks</td>
<td class="left">Ignores leading blanks when sorting</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-C</code></td>
<td class="left">--check = quiet</td>
<td class="left">Doesn't sort, but doesn't report if data is out of sort order</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">--check</td>
<td class="left">Doesn't sort, but checks if the input data is already sorted, and reports if not sorted</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code></td>
<td class="left">--dictionary-order</td>
<td class="left">Considers only blanks and alphanumeric characters; doesn't consider special characters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code></td>
<td class="left">--ignore-case</td>
<td class="left">By default, sort orders capitalized letters first; ignores case</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-g</code></td>
<td class="left">--general-numeric-sort</td>
<td class="left">Uses general numerical value to sort</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left">--ignore-nonprinting</td>
<td class="left">Ignores nonprintable characters in the sort</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-k</code></td>
<td class="left">--key = <code class="calibre26"><i class="calibre12">POS1</i></code>[<i class="calibre12">,</i><code class="calibre26"><i class="calibre12">POS2</i></code>]</td>
<td class="left">Sorts based on position POS1, and ends at POS2 if specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-M</code></td>
<td class="left">--month-sort</td>
<td class="left">Sorts by month order using three-character month names</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-m</code></td>
<td class="left">--merge</td>
<td class="left">Merges two already sorted data files</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">--numeric-sort</td>
<td class="left">Sorts by string numerical value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-o</code></td>
<td class="left">--output = <code class="calibre26"><i class="calibre12">file</i></code></td>
<td class="left">Writes results to file specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-R</code></td>
<td class="left">--random-sort</td>
<td class="left">Sorts by a random hash of keys</td>
</tr>
<tr class="calibre28">
<td class="left"></td>
<td class="left">--random-source = <code class="calibre26"><i class="calibre12">FILE</i></code></td>
<td class="left">Specifies the file for random bytes used by the <code class="calibre26">-R </code>parameter</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">--reverse</td>
<td class="left">Reverses the sort order (descending instead of ascending</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-S</code></td>
<td class="left">--buffer-size = <code class="calibre26"><i class="calibre12">SIZE</i></code></td>
<td class="left">Specifies the amount of memory to use</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">--stable</td>
<td class="left">Disables last-resort comparison</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-T</code></td>
<td class="left">--temporary-direction = <code class="calibre26"><i class="calibre12">DIR</i></code></td>
<td class="left">Specifies a location to store temporary working files</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-t</code></td>
<td class="left"><code class="calibre26">--field-separator</code> <code class="calibre26">=</code> <code class="calibre26"><i class="calibre12">SEP</i></code></td>
<td class="left">Specifies the character used to distinguish key positions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-u</code></td>
<td class="left"><code class="calibre26">--unique</code></td>
<td class="left">With the <code class="calibre26">-c</code> parameter, checks for strict ordering; without the <code class="calibre26">-c</code> parameter, outputs only the first occurrence of two similar lines</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-z</code></td>
<td class="left"><code class="calibre26">--zero-terminated</code></td>
<td class="left">Ends all lines with a NULL character instead of a new line</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="106" id="calibre_link-448" class="calibre11"></span>The <code class="calibre26">-k</code> and <code class="calibre26">-t</code> parameters are handy when sorting data that uses fields, such as the <code class="calibre26">/etc/passwd</code> file. Use the <code class="calibre26">-t</code> parameter to specify the field separator character, and use the <code class="calibre26">-k</code> parameter to specify which field to sort on. For example, to sort the password file based on numerical userid, just do this:</p>
<pre class="calibre29"><code class="calibre26"> $ sort -t ':' -k 3 -n /etc/passwd
 root:x:0:0:root:/root:/bin/bash
 bin:x:1:1:bin:/bin:/sbin/nologin
 daemon:x:2:2:daemon:/sbin:/sbin/nologin
 adm:x:3:4:adm:/var/adm:/sbin/nologin
 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
 sync:x:5:0:sync:/sbin:/bin/sync
 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
 halt:x:7:0:halt:/sbin:/sbin/halt
 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
 news:x:9:13:news:/etc/news:
 uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
 operator:x:11:0:operator:/root:/sbin/nologin
 games:x:12:100:games:/usr/games:/sbin/nologin
 gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
 ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</code></pre>
<p class="calibre10">Now the data is perfectly sorted based on the third field, which is the numerical userid value.</p>
<p class="calibre10">The <code class="calibre26">-n</code> parameter is great for sorting numerical outputs, such as the output of the <code class="calibre26">du</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ du -sh * | sort -nr
 1008k   mrtg-2.9.29.tar.gz
 972k    bldg1
 888k    fbs2.pdf
 760k    Printtest
 680k    rsync-2.6.6.tar.gz
 660k    code
 516k    fig1001.tiff
 496k    test
 496k    php-common-4.0.4pl1-6mdk.i586.rpm
 448k    MesaGLUT-6.5.1.tar.gz
 400k    plp</code></pre>
<p class="calibre10">Notice that the <code class="calibre26">-r</code> option also sorts the values in descending order, so you can easily see what files are taking up the most space in your directory.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The pipe command (|) used in this example redirects the output of the <code class="calibre26">du</code> command to the <code class="calibre26">sort</code> command. That's discussed in more detail in Chapter 11.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Searching for data</h3>
<p class="calibre10"><span type="pagebreak" title="107" id="calibre_link-449" class="calibre11"></span>Often in a large file, you must look for a specific line of data buried somewhere in the middle of the file. Instead of manually scrolling through the entire file, you can let the <code class="calibre26">grep</code> command search for you. The command line format for the <code class="calibre26">grep</code> command is:</p>
<pre class="calibre29"><code class="calibre26"> grep [options] pattern [file]</code></pre>
<p class="calibre10">The <code class="calibre26">grep</code> command searches either the input or the file you specify for lines that contain characters that match the specified pattern. The output from <code class="calibre26">grep</code> is the lines that contain the matching pattern.</p>
<p class="calibre10">Here are two simple examples of using the <code class="calibre26">grep</code> command with the <code class="calibre26">file1</code> file used in the âSorting dataâ section:</p>
<pre class="calibre29"><code class="calibre26"> $ grep three file1
 three
 $ grep t file1
 two
 three
 $</code></pre>
<p class="calibre10">The first example searches the file <code class="calibre26">file1</code> for text matching the pattern <i class="calibre12">three</i>. The <code class="calibre26">grep</code> command produces the line that contains the matching pattern. The next example searches the file <code class="calibre26">file1</code> for the text matching the pattern <i class="calibre12">t</i>. In this case, two lines matched the specified pattern, and both are displayed.</p>
<p class="calibre10">Because of the popularity of the <code class="calibre26">grep</code> command, it has undergone lots of development changes over its lifetime. Lots of features have been added to the <code class="calibre26">grep</code> command. If you look over the man pages for the <code class="calibre26">grep</code> command, you'll see how versatile it really is.</p>
<p class="calibre10">If you want to reverse the search (output lines that don't match the pattern), use the <code class="calibre26">-v</code> parameter:</p>
<pre class="calibre29"><code class="calibre26"> $ grep -v t file1
 one
 four
 five
 $</code></pre>
<p class="calibre10">If you need to find the line numbers where the matching patterns are found, use the <code class="calibre26">-n</code> parameter:</p>
<pre class="calibre29"><code class="calibre26"> $ grep -n t file1
 2:two
 3:three
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="108" id="calibre_link-450" class="calibre11"></span>If you just need to see a count of how many lines contain the matching pattern, use the <code class="calibre26">-c</code> parameter:</p>
<pre class="calibre29"><code class="calibre26"> $ grep -c t file1
 2
 $</code></pre>
<p class="calibre10">If you need to specify more than one matching pattern, use the <code class="calibre26">-e</code> parameter to specify each individual pattern:</p>
<pre class="calibre29"><code class="calibre26"> $ grep -e t -e f file1
 two
 three
 four
 five
 $</code></pre>
<p class="calibre10">This example outputs lines that contain either the string <code class="calibre26">t</code> or the string <code class="calibre26">f</code>.</p>
<p class="calibre10">By default, the <code class="calibre26">grep</code> command uses basic Unix-style regular expressions to match patterns. A Unix-style regular expression uses special characters to define how to look for matching patterns.</p>
<p class="calibre10">For a more detailed explanation of regular expressions, see Chapter 20.</p>
<p class="calibre10">Here's a simple example of using a regular expression in a <code class="calibre26">grep</code> search:</p>
<pre class="calibre29"><code class="calibre26"> $ grep [tf] file1
 two
 three
 four
 five
 $</code></pre>
<p class="calibre10">The square brackets in the regular expression indicate that <code class="calibre26">grep</code> should look for matches that contain either a <i class="calibre12">t</i> or an <i class="calibre12">f</i> character. Without the regular expression, <code class="calibre26">grep</code> would search for text that would match the string <code class="calibre26">tf</code>.</p>
<p class="calibre10">The <code class="calibre26">egrep</code> command is an offshoot of <code class="calibre26">grep</code>, which allows you to specify POSIX extended regular expressions, which contain more characters for specifying the matching pattern (again, see Chapter 20 for more details). The <code class="calibre26">fgrep</code> command is another version that allows you to specify matching patterns as a list of fixed-string values, separated by newline characters. This allows you to place a list of strings in a file and then use that list in the <code class="calibre26">fgrep</code> command to search for the strings in a larger file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Compressing data</h3>
<p class="calibre10">If you've done any work in the Microsoft Windows world, no doubt you've used zip files. It became such a popular feature that Microsoft eventually incorporated it into the Windows operating system starting with XP. The <code class="calibre26">zip</code> utility allows you to easily compress large files (both text and executable) into smaller files that take up less space.</p>
<p class="calibre10"><span type="pagebreak" title="109" id="calibre_link-451" class="calibre11"></span>Linux contains several file compression utilities. Although this may sound great, it often leads to confusion and chaos when trying to download files. <a id="calibre_link-111" href="#calibre_link-110" class="calibre4">Table 4.7</a> lists the file compression utilities available for Linux.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-110" href="#calibre_link-111" class="calibre4"><b class="calibre21">Table 4.7</b></a></span> Linux File Compression Utilities</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Utility</td>
<td class="left">File Extension</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bzip2</code></td>
<td class="left"><code class="calibre26">.bz2</code></td>
<td class="left">Uses the Burrows-Wheeler block sorting text compression algorithm and Huffman coding</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">compress</code></td>
<td class="left"><code class="calibre26">.Z</code></td>
<td class="left">Original Unix file compression utility; starting to fade away into obscurity</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gzip</code></td>
<td class="left"><code class="calibre26">.gz</code></td>
<td class="left">The GNU Project's compression utility; uses Lempel-Ziv coding</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zip</code></td>
<td class="left"><code class="calibre26">.zip</code></td>
<td class="left">The Unix version of the PKZIP program for Windows</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">compress</code> file compression utility is not often found on Linux systems. If you download a file with a <code class="calibre26">.Z</code> extension, you can usually install the compress package (called <code class="calibre26">ncompress</code> in many Linux distributions) using the software installation methods discussed in Chapter 9 and then uncompress the file with the <code class="calibre26">uncompress</code> command. The <code class="calibre26">gzip</code> utility is the most popular compression tool used in Linux.</p>
<p class="calibre10">The <code class="calibre26">gzip</code> package is a creation of the GNU Project, in their attempt to create a free version of the original Unix compress utility. This package includes these files:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">gzip</code> for compressing files</li>
<li class="calibre7"><code class="calibre26">gzcat</code> for displaying the contents of compressed text files</li>
<li class="calibre7"><code class="calibre26">gunzip</code> for uncompressing files</li>
</ul>
<p class="calibre10">These utilities work the same way as the bzip2 utilities:</p>
<pre class="calibre29"><code class="calibre26"> $ gzip myprog
 $ ls -l my*
-rwxrwxr-x 1 rich rich 2197 2007-09-13 11:29 myprog.gz
 $</code></pre>
<p class="calibre10">The <code class="calibre26">gzip</code> command compresses the file you specify on the command line. You can also specify more than one filename or even use wildcard characters to compress multiple files at once:</p>
<pre class="calibre29"><code class="calibre26">$ gzip my*
$ ls -l my*
 -rwxr--r--    1 rich     rich          103 Sep  6 13:43 myprog.c.gz
 -rwxr-xr-x    1 rich     rich         5178 Sep  6 13:43 myprog.gz
 -rwxr--r--    1 rich     rich           59 Sep  6 13:46 myscript.gz
 -rwxr--r--    1 rich     rich           60 Sep  6 13:44 myscript2.gz
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="110" id="calibre_link-452" class="calibre11"></span>The <code class="calibre26">gzip </code>command compresses every file in the directory that matches the wildcard pattern.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Archiving data</h3>
<p class="calibre10">Although the <code class="calibre26">zip</code> command works great for compressing and archiving data into a single file, it's not the standard utility used in the Unix and Linux worlds. By far the most popular archiving tool used in Unix and Linux is the <code class="calibre26">tar</code> command.</p>
<p class="calibre10">The <code class="calibre26">tar</code> command was originally used to write files to a tape device for archiving. However, it can also write the output to a file, which has become a popular way to archive data in Linux.</p>
<p class="calibre10">The following is the format of the <code class="calibre26">tar</code> command:</p>
<pre class="calibre29"><code class="calibre26"> tar function [options] object1 object2 ...</code></pre>
<p class="calibre10">The function parameter defines what the <code class="calibre26">tar</code> command should do, as shown in <a id="calibre_link-113" href="#calibre_link-112" class="calibre4">Table 4.8</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-112" href="#calibre_link-113" class="calibre4"><b class="calibre21">Table 4.8</b></a></span> The tar Command Functions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Function</td>
<td class="left">Long Name</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-A</code></td>
<td class="left"><code class="calibre26">--concatenate</code></td>
<td class="left">Appends an existing tar archive file to another existing tar archive file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left"><code class="calibre26">--create</code></td>
<td class="left">Creates a new tar archive file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code></td>
<td class="left"><code class="calibre26">--diff</code></td>
<td class="left">Checks the differences between a tar archive file and the filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"></td>
<td class="left"><code class="calibre26">--delete</code></td>
<td class="left">Deletes from an existing tar archive file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left"><code class="calibre26">--append</code></td>
<td class="left">Appends files to the end of an existing tar archive file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-t</code></td>
<td class="left"><code class="calibre26">--list</code></td>
<td class="left">Lists the contents of an existing tar archive file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-u</code></td>
<td class="left"><code class="calibre26">--update</code></td>
<td class="left">Appends files to an existing tar archive file that are newer than a file with the same name in the existing archive</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-x</code></td>
<td class="left"><code class="calibre26">--extract</code></td>
<td class="left">Extracts files from an existing archive file</td>
</tr>
</table>
</figure>
<p class="calibre10">Each function uses <i class="calibre12">options</i> to define a specific behavior for the tar archive file. <a id="calibre_link-115" href="#calibre_link-114" class="calibre4">Table 4.9</a> lists the common options that you can use with the <code class="calibre26">tar</code> command.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-114" href="#calibre_link-115" class="calibre4"><b class="calibre21">Table 4.9</b></a></span> The tar Command Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-C</code> <code class="calibre26"><i class="calibre12">dir</i></code></td>
<td class="left">Changes to the specified directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code> <code class="calibre26"><i class="calibre12">file</i></code></td>
<td class="left">Outputs results to file (or device) <code class="calibre26"><i class="calibre12">file</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-j</code></td>
<td class="left">Redirects output to the <code class="calibre26">bzip2</code> command for compression</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code></td>
<td class="left">Preserves all file permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v</code></td>
<td class="left">Lists files as they are processed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-z</code></td>
<td class="left">Redirects the output to the <code class="calibre26">gzip</code> command for compression</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="111" id="calibre_link-453" class="calibre11"></span>These options are usually combined to create the following scenarios. First, you want to create an archive file using this command:</p>
<pre class="calibre29"><code class="calibre26"> tar -cvf test.tar test/ test2/</code></pre>
<p class="calibre10">The above command creates an archive file called <code class="calibre26">test.tar</code> containing the contents of both the <code class="calibre26">test</code> directory and the <code class="calibre26">test2</code> directory. Next, this command:</p>
<pre class="calibre29"><code class="calibre26"> tar -tf test.tar</code></pre>
<p class="calibre10">lists (but doesn't extract) the contents of the tar file <code class="calibre26">test.tar</code>. Finally, this command:</p>
<pre class="calibre29"><code class="calibre26"> tar -xvf test.tar</code></pre>
<p class="calibre10">extracts the contents of the tar file <code class="calibre26">test.tar</code>. If the tar file was created from a directory structure, the entire directory structure is re-created starting at the current directory.</p>
<p class="calibre10">As you can see, using the <code class="calibre26">tar</code> command is a simple way to create archive files of entire directory structures. This is a common method for distributing source code files for open source applications in the Linux world.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you download open source software, often you see filenames that end in .<code class="calibre26">tgz</code>. These are gzipped tar files, which can be extracted using the command <code class="calibre26">tar -zxvf filename.tgz</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-150" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed some of the more advanced bash commands used by Linux system administrators and programmers. The <code class="calibre26">ps</code> and <code class="calibre26">top</code> commands are vital in determining the status of the system, allowing you to see what applications are running and how many resources they are consuming.</p>
<p class="calibre10"><span type="pagebreak" title="112" id="calibre_link-454" class="calibre11"></span>In this day of removable media, another popular topic for system administrators is mounting storage devices. The <code class="calibre26">mount</code> command allows you to mount a physical storage device into the Linux virtual directory structure. To remove the device, use the <code class="calibre26">umount</code> command.</p>
<p class="calibre10">Finally, the chapter discussed various utilities used for handling data. The <code class="calibre26">sort</code> utility easily sorts large data files to help you organize data, and the <code class="calibre26">grep</code> utility allows you to quickly scan through large data files looking for specific information. Several file compression utilities are available in Linux, including <code class="calibre26">gzip</code> and <code class="calibre26">zip</code>. Each one allows you to compress large files to help save space on your filesystem. The Linux <code class="calibre26">tar</code> utility is a popular way to archive directory structures into a single file that can easily be ported to another system.</p>
<p class="calibre10">The next chapter discusses Linux shells and how to interact with them. Linux allows you to communicate between shells, which can come in handy when creating subshells in your scripts.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1180">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-151" class="calibre4"></a><span class="chaptertitle">Chapter 5</span><br class="calibre22" /><span class="chaptertitle">Understanding the Shell</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Investigating Shell Types</li>
<li class="calibre7">Understanding the Parent/Child Shell Relationship</li>
<li class="calibre7">Using Subshells Creatively</li>
<li class="calibre7">Investigating Built-in Shell Commands</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="113" id="calibre_link-455" class="calibre11"></span>Now that you know a few shell basics, such as reaching the shell and rudimentary shell commands, it is time to explore the actual shell process. To understand the shell, you need to understand a few CLI basics.</p>
<p class="calibre19">A shell is not just a CLI. It is a complicated interactive running program. Entering commands and using the shell to run scripts can raise some interesting and confusing issues. Understanding the shell process and its relationships helps you resolve these issues or avoid them altogether.</p>
<p class="calibre19">This chapter takes you through learning about the shell process. You see how subshells are created and their relationship to the parent shell. The varied commands that create child processes are explored as well as built-in commands. You even read about some shell tips and tricks to try.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-152" class="calibre4"></a>Exploring Shell Types</h2>
<p class="calibre10">The shell program that the system starts depends on your user ID configuration. In the <code class="calibre26">/etc/passwd</code> file, the user ID has its default shell program listed in field #7 of its record. The default shell program is started whenever the user logs into a virtual console terminal or starts a terminal emulator in the GUI.</p>
<p class="calibre10">In the following example, user <code class="calibre26">christine</code> has the GNU bash shell as her default shell program:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat /etc/passwd</b></code>
[...]
Christine:x:501:501:Christine B:/home/Christine:/bin/bash
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="114" id="calibre_link-456" class="calibre11"></span>The bash shell program resides in the <code class="calibre26">/bin</code> directory. A long listing reveals <code class="calibre26">/bin/bash</code> (the bash shell) is an executable program:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -lF /bin/bash</b></code>
-rwxr-xr-x. 1 root root 938832 Jul 18  2013 /bin/bash*
$</code></pre>
<p class="calibre10">Several other shell programs are on this particular CentOS distribution. They include <code class="calibre26">tcsh</code>, which is based off the original C shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -lF /bin/tcsh</b></code>
-rwxr-xr-x. 1 root root 387328 Feb 21  2013 /bin/tcsh*
$</code></pre>
<p class="calibre10">Also, the Debian based version of the ash shell, <code class="calibre26">dash</code>, is included:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -lF /bin/dash</b></code>
-rwxr-xr-x. 1 root root 109672 Oct 17  2012 /bin/dash*
$</code></pre>
<p class="calibre10">Finally, a soft link (see Chapter 3) of the C shell points to the <code class="calibre26">tcsh</code> shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -lF /bin/csh</b></code>
lrwxrwxrwx. 1 root root 4 Mar 18 15:16 /bin/csh -&gt; tcsh*
$</code></pre>
<p class="calibre10">Each of these different shell programs could be set as a user's default shell. However, due to the bash shell's popularity, it's rare to use any other shell as a default shell.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">A brief description of various shells was included in Chapter 1. You may be interested in learning even more about shells other than the GNU bash shell. Additional alternative shell information is in Chapter 23.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <i class="calibre12">default interactive shell</i> starts whenever a user logs into a virtual console terminal or starts a terminal emulator in the GUI. However, another default shell, <code class="calibre26">/bin/sh</code>, is the <i class="calibre12">default system shell</i>. The default system shell is used for system shell scripts, such as those needed at startup.</p>
<p class="calibre10">Often, you see a distribution with its default system shell set to the bash shell using a soft link as shown here on this CentOS distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l /bin/sh</b></code>
lrwxrwxrwx. 1 root root 4 Mar 18 15:05 /bin/sh -&gt; bash
$</code></pre>
<p class="calibre10">However, be aware that on some distributions, the default system shell is different than the default interactive shell, such as on this Ubuntu distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat /etc/passwd</b></code>
[...]
christine:x:1000:1000:Christine,,,:/home/christine:/bin/bash
$
$ <code class="calibre26"><b class="calibre21">ls -l /bin/sh</b></code>
lrwxrwxrwx 1 root root 4 Apr 22 12:33 /bin/sh -&gt; dash
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="115" id="calibre_link-457" class="calibre11"></span>Note that the user, <code class="calibre26">christine</code>, has her default interactive shell set to <code class="calibre26">/bin/bash</code>, the bash shell. But the default system shell, <code class="calibre26">/bin/sh</code>, is set to the dash shell.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">For bash shell scripts, these two different shells, default interactive shell and default system shell, can cause problems. Be sure to read about the important syntax needed for a bash shell script's first line in Chapter 11 to avoid these issues.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You are not forced to stick with your default interactive shell. You can start any shell available on your distribution, simply by typing its filename. For example, to start the dash shell, you can run it directly by typing the command <b class="calibre21">/bin/dash</b>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">/bin/dash</b></code>
$</code></pre>
<p class="calibre10">It doesn't look like anything happened, but the dash shell program started. The $ prompt is a CLI prompt for the dash shell. You can leave the dash shell program by typing the command <b class="calibre21">exit</b>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$</code></pre>
<p class="calibre10">Again, it looks like nothing happened. However, the dash shell program was exited. To understand this process, the next section explores the relationship between a login shell program and a newly started shell program.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-153" class="calibre4"></a>Exploring Parent and Child Shell Relationships</h2>
<p class="calibre10">The default interactive shell started when a user logs into a virtual console terminal or starts a terminal emulator in the GUI is a <i class="calibre12">parent shell</i>. As you have read so far in this book, a parent shell process provides a CLI prompt and waits for commands to be entered.</p>
<p class="calibre10">When the <code class="calibre26">/bin/bash</code> command or the equivalent <code class="calibre26">bash</code> command is entered at the CLI prompt, a new shell program is created. This is a <i class="calibre12">child shell</i>. A child shell also has a CLI prompt and waits for commands to be entered.</p>
<p class="calibre10"><span type="pagebreak" title="116" id="calibre_link-458" class="calibre11"></span>Because you do not see any relevant messages when you type <b class="calibre21">bash</b> and spawn a child shell, another command can help bring clarity. The <code class="calibre26">ps</code> command was covered in Chapter 4. Using this with the <code class="calibre26">-f</code> option before and after entering a child shell is useful:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
501       1841  1840  0 11:50 pts/0    00:00:00 -bash
501       2429  1841  4 13:44 pts/0    00:00:00 ps -f
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
501       1841  1840  0 11:50 pts/0    00:00:00 -bash
501       2430  1841  0 13:44 pts/0    00:00:00 bash
501       2444  2430  1 13:44 pts/0    00:00:00 ps -f
$</code></pre>
<p class="calibre10">The first use of <code class="calibre26">ps -f </code>shows two processes. One process has a process ID of 1841 (second column) and is running the bash shell program (last column). The second process (process ID 2429) is the actual <code class="calibre26">ps -f</code> command running.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">A <i class="calibre12">process</i> is a running program. The bash shell is a program, and when it runs, it is a process. A running shell is simply one type of process. Therefore, when reading about running a bash shell, you often see the word âshellâ and the word âprocessâ used interchangeably</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">After the command <code class="calibre26">bash</code> is entered, a child shell is created. The second <code class="calibre26">ps -f</code> is executed from within the child shell. From this display, you can see that <i class="calibre12">two</i> bash shell programs are running. The first bash shell program, the parent shell process, has the original process ID (PID) of 1841. The second bash shell program, the child shell process, has a PID of 2430. Note that the child shell has a parent process ID (PPID) of 1841, denoting that the parent shell process is its parent. <a id="calibre_link-1181" href="#calibre_link-1073" class="calibre4">Figure 5.1</a> diagrams this relationship.</p>
<figure class="calibre23">
<img class="center" src="images/000054.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1073" href="#calibre_link-1181" class="calibre4"><b class="calibre21">Figure 5.1</b></a></span> Parent and child bash shell processes</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="117" id="calibre_link-459" class="calibre11"></span>When a child shell process is spawned, only some of the parent's environment is copied to the child shell environment. This can cause problems with items such as variables, and it is covered in Chapter 6.</p>
<p class="calibre10">A child shell is also called a <i class="calibre12">subshell</i>. A subshell can be created from a parent shell, and a subshell can be created from another subshell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
501       1841  1840  0 11:50 pts/0    00:00:00 -bash
501       2532  1841  1 14:22 pts/0    00:00:00 ps -f
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">ps --forest</b></code>
  PID TTY          TIME CMD
 1841 pts/0    00:00:00 bash
 2533 pts/0    00:00:00  \_ bash
 2546 pts/0    00:00:00      \_ bash
 2562 pts/0    00:00:00          \_ bash
 2576 pts/0    00:00:00              \_ ps
$</code></pre>
<p class="calibre10">In the preceding example, the <code class="calibre26">bash</code> <code class="calibre26">shell</code> command was entered three times. Effectively, this created three subshells. The <code class="calibre26">ps --forest</code> command shows the nesting of these subshells. <a id="calibre_link-1182" href="#calibre_link-1074" class="calibre4">Figure 5.2</a> also shows this subshell nesting.</p>
<figure class="calibre23">
<img class="center" src="images/000055.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1074" href="#calibre_link-1182" class="calibre4"><b class="calibre21">Figure 5.2</b></a></span> Subshell nesting</p>
</figcaption>
</figure>
<p class="calibre10">The <code class="calibre26">ps -f</code> command can be useful in subshell nesting, because it displays who is whose parent via the PPID column:</p>
<pre class="calibre29"><code class="calibre26">$ ps -f
UID        PID  PPID  C STIME TTY          TIME CMD
501       1841  1840  0 11:50 pts/0    00:00:00 -bash
501       2533  1841  0 14:22 pts/0    00:00:00 bash
501       2546  2533  0 14:22 pts/0    00:00:00 bash
501       2562  2546  0 14:24 pts/0    00:00:00 bash
501       2585  2562  1 14:29 pts/0    00:00:00 ps -f
$</code></pre>
<p class="calibre10">The bash shell program can use command line parameters to modify the shell start. <a id="calibre_link-1183" href="#calibre_link-1116" class="calibre4">Table 5.1</a> lists the command line parameters available in bash.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1116" href="#calibre_link-1183" class="calibre4"><b class="calibre21">Table 5.1</b></a></span> The bash Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">-c string</td>
<td class="left">Reads commands from string and processes them</td>
</tr>
<tr class="calibre28">
<td class="left">-i</td>
<td class="left">Starts an interactive shell, allowing input from the user</td>
</tr>
<tr class="calibre28">
<td class="left">-l</td>
<td class="left">Acts as if invoked as a login shell</td>
</tr>
<tr class="calibre28">
<td class="left">-r</td>
<td class="left">Starts a restricted shell, limiting the user to the default directory</td>
</tr>
<tr class="calibre28">
<td class="left">-s</td>
<td class="left">Reads commands from the standard input</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="118" id="calibre_link-460" class="calibre11"></span>You can find more help on the <code class="calibre26">bash</code> command and even more command line parameters by typing <b class="calibre21">man bash</b>. The <code class="calibre26">bash --help</code> command provides additional assistance as well.</p>
<p class="calibre10">You can gracefully exit out of each subshell by entering the <code class="calibre26">exit</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">ps --forest</b></code>
  PID TTY          TIME CMD
 1841 pts/0    00:00:00 bash
 2533 pts/0    00:00:00  \_ bash
 2546 pts/0    00:00:00      \_ bash
 2602 pts/0    00:00:00          \_ ps
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">ps --forest</b></code>
  PID TTY          TIME CMD
 1841 pts/0    00:00:00 bash
 2604 pts/0    00:00:00  \_ ps
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="119" id="calibre_link-461" class="calibre11"></span>Not only does the <code class="calibre26">exit</code> command allow you to leave child subshells, but you can also log out of your current virtual console terminal or terminal emulation software as well. Just type <b class="calibre21">exit</b> in the parent shell, and you gracefully exit the CLI.</p>
<p class="calibre10">Another time a subshell can be created is when you run a shell script. You learn more about that topic in Chapter 11.</p>
<p class="calibre10">Also, you can spawn subshells without using the <code class="calibre26">bash</code> shell command or running a shell script. One way is by using a process list.</p>
<section class="toclist">
<h3 class="calibre15">Looking at process lists</h3>
<p class="calibre10">On a single line, you can designate a list of commands to be run one after another. This is done by entering a command list using a semicolon (;) between commands:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls</b></code>
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
/etc
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
$</code></pre>
<p class="calibre10">In the preceding example, the commands all executed one after another with no problems. However, this is not a process list. For a command list to be considered a process list, the commands must be encased in parentheses:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">(pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls)</b></code>
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
/etc
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="120" id="calibre_link-462" class="calibre11"></span>Though the parentheses addition may not appear to be a big difference, they do cause a very different effect. Adding parentheses and turning the command list into a process list created a subshell to execute the commands.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">A process list is a <i class="calibre12">command grouping</i> type. Another command grouping type puts the commands between curly brackets and ends the command list with a semicolon (;). The syntax is as follows: <code class="calibre26">{<i class="calibre12"> command</i></code><code class="calibre26">;</code><code class="calibre26"> }</code>. Using curly brackets for command grouping does not create a subshell as a process list does.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To indicate if a subshell was spawned, a command using an environment variable is needed here. (Environment variables are covered in detail in Chapter 6). The command needed is <code class="calibre26">echo $BASH_SUBSHELL</code>. If it returns a 0, then there is no subshell. If it returns 1 or more, then there is a subshell.</p>
<p class="calibre10">First, the example using just a command list is executed with the <code class="calibre26">echo $BASH_SUBSHELL</code> tacked onto the end:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL</b></code>
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
/etc
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
<code class="calibre26"><b class="calibre21">0</b></code></code></pre>
<p class="calibre10">At the very end of the commands' output, you can see the number zero (<code class="calibre26">0</code>) is displayed. This indicates a subshell was not created to execute these commands.</p>
<p class="calibre10">The results are different using a process list. The list is executed with <code class="calibre26">echo $BASH_SUBSHELL</code> tacked onto the end:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">(pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</b></code>
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
/etc
/home/Christine
Desktop    Downloads  Music     Public     Videos
Documents  junk.dat   Pictures  Templates
<code class="calibre26"><b class="calibre21">1</b></code></code></pre>
<p class="calibre10"><span type="pagebreak" title="121" id="calibre_link-463" class="calibre11"></span>In this case, the number one (<code class="calibre26">1</code>) displayed at the output's end. This indicates a subshell was indeed created and used for executing these commands.</p>
<p class="calibre10">Thus, a <i class="calibre12">process list</i> is a command grouping enclosed with parentheses, which creates a subshell to execute the command(s). You can even create a grandchild subshell by embedding parentheses within a process list:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">( pwd ; echo $BASH_SUBSHELL)</b></code>
/home/Christine
1
$ <code class="calibre26"><b class="calibre21">( pwd ; (echo $BASH_SUBSHELL))</b></code>
/home/Christine
2</code></pre>
<p class="calibre10">Notice in the first process list, the number one (<code class="calibre26">1</code>) is displayed indicating a child subshell as you would expect. However in the example's second process list, additional parentheses were added around the <code class="calibre26">echo $BASH_SUBSHELL</code> command. These additional parentheses caused a grandchild subshell to be created for the command's execution. Thus, a number two (<code class="calibre26">2</code>) was displayed indicating a subshell within a subshell.</p>
<p class="calibre10">Subshells are often used for multi-processing in shell scripts. However, entering into a subshell is an expensive method and can significantly slow down processing. Subshell issues exist also for an interactive CLI shell session. It is not truly multi-processing, because the terminal gets tied up with the subshell's I/O.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creatively using subshells</h3>
<p class="calibre10">At the interactive shell CLI, you have more productive ways to use subshells. Process lists, co-processes, and pipes (covered in Chapter 11) use subshells. They all can be used effectively within the interactive shell.</p>
<p class="calibre10">One productive subshell method in the interactive shell uses background mode. Before discussing how to use background mode and subshells together, you need to understand background mode itself.</p>
<section class="toclist">
<h4 class="calibre25">Investigating background mode</h4>
<p class="calibre10">Running a command in background mode allows the command to be processed and frees up your CLI for other use. A classic command to demonstrate background mode is the <code class="calibre26">sleep</code> command.</p>
<p class="calibre10"><span type="pagebreak" title="122" id="calibre_link-464" class="calibre11"></span>The <code class="calibre26">sleep</code> command accepts as a parameter the number of seconds you want the process to wait (sleep). This command is often used to introduce pauses in shell scripts. The command <code class="calibre26">sleep 10</code> causes the session to pause for 10 seconds and then return a shell CLI prompt:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 10</b></code>
$</code></pre>
<p class="calibre10">To put a command into background mode, the <code class="calibre26">&amp;</code> character is tacked onto its end. Putting the <code class="calibre26">sleep</code> command into background mode allows a little investigation with the <code class="calibre26">ps</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 3000&amp;</b></code>
[<code class="calibre26"><b class="calibre21">1</b></code>] <code class="calibre26"><b class="calibre21">2396</b></code>
$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
christi+  2338  2337  0 10:13 pts/9    00:00:00 -bash
christi+  <code class="calibre26"><b class="calibre21">2396</b></code>  2338  0 10:17 pts/9    00:00:00 sleep 3000
christi+  2397  2338  0 10:17 pts/9    00:00:00 ps -f
$</code></pre>
<p class="calibre10">The <code class="calibre26">sleep</code> command was told to sleep for <code class="calibre26">3000</code> seconds (50 minutes) in the background (<code class="calibre26">&amp;</code>). When it was put into the background, two informational items were displayed before the shell CLI prompt was returned. The first informational item is the background job's number (<code class="calibre26">1</code>) displayed in brackets. The second item is the background job's process ID (<code class="calibre26">2396</code>).</p>
<p class="calibre10">The <code class="calibre26">ps</code> command was used to display the various processes. Notice that the sleep 3000 command is listed. Also note that its process ID (PID) in the second column is the same PID displayed when the command went into the background, <code class="calibre26">2396</code>.</p>
<p class="calibre10">In addition to the <code class="calibre26">ps</code> command, you can use the <code class="calibre26">jobs</code> command to display background job information. The <code class="calibre26">jobs</code> command displays any user's processes (jobs) currently running in background mode:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Running                 sleep 3000 &amp;
$</code></pre>
<p class="calibre10">The <code class="calibre26">jobs</code> command shows the job number (<code class="calibre26">1</code>) in brackets. It also displays the job's current status (<code class="calibre26">running</code>) as well as the command itself, (<code class="calibre26">sleep 3000 &amp;</code>).</p>
<p class="calibre10">You can see even more information by using the <code class="calibre26">-l</code> (lowercase L) parameter on the <code class="calibre26">jobs</code> command. The <code class="calibre26">-l</code> parameter displays the command's PID in addition to the other information:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">jobs -l</b></code>
[1]+  2396 Running                 sleep 3000 &amp;
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="123" id="calibre_link-465" class="calibre11"></span>When the background job is finished, its completion status is displayed:</p>
<pre class="calibre29"><code class="calibre26">[1]+  Done                 sleep 3000 &amp;
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Be aware that a background job's completion status won't necessarily wait till a convenient time to display itself. Don't let it surprise you when a job's completion status just suddenly appears on your screen.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Background mode is very handy. And it provides a method for creating useful subshells at the CLI.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Putting process lists into the background</h4>
<p class="calibre10">As stated earlier, a process list is a command or series of commands executed within a subshell. Using a process list including <code class="calibre26">sleep</code> commands and displaying the <code class="calibre26">BASH_SUBSHELL</code> variable operates as you would expect:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">(sleep 2 ; echo $BASH_SUBSHELL ; sleep 2)</b></code>
<code class="calibre26"><b class="calibre21">1</b></code>
$</code></pre>
<p class="calibre10">In the preceding example, a two-second pause occurs, the number one (<code class="calibre26">1</code>) is displayed indicating a single subshell level (child subshell), and then another two-second pause occurs before the prompt returns. Nothing too dramatic here.</p>
<p class="calibre10">Putting the same process list into background mode can cause a slightly different effect with command output:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">(sleep 2 ; echo $BASH_SUBSHELL ; sleep 2)&amp;</b></code>
[2] 2401
$ <code class="calibre26"><b class="calibre21">1</b></code>
[2]+  Done                  ( sleep 2; echo $BASH_SUBSHELL; sleep 2 )
$</code></pre>
<p class="calibre10">Putting the process list into the background causes a job number and process ID to appear, and the prompt returns. However, the odd event is that the displayed number one (<code class="calibre26">1</code>), indicating a single-level subshell, is displayed by the prompt! Don't let this confuse you. Simply press the Enter key, and you get another prompt back.</p>
<p class="calibre10">Using a process list in background mode is one creative method for using subshells at the CLI. You can do large amounts of processing within a subshell and not have your terminal tied up with the subshell's I/O.</p>
<p class="calibre10">Of course, the process list of <code class="calibre26">sleep</code> and <code class="calibre26">echo</code> commands are just for example purposes. Creating backup files with <code class="calibre26">tar</code> (see Chapter 4) is a more practical example of using background process lists effectively:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">(tar -cf Rich.tar /home/rich ; tar -cf My.tar /home/christine)&amp;</b></code>
[3] 2423
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="124" id="calibre_link-466" class="calibre11"></span>Putting a process list in background mode is not the only way to use subshells creatively at the CLI. Co-processing is another method.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at co-processing</h4>
<p class="calibre10">Co-processing does two things at the same time. It spawns a subshell in background mode and executes a command within that subshell.</p>
<p class="calibre10">To perform co-processing, the <code class="calibre26">coproc</code> command is used along with the command to be executed in the subshell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">coproc sleep 10</b></code>
[<code class="calibre26"><b class="calibre21">1</b></code>] <code class="calibre26"><b class="calibre21">2544</b></code>
$</code></pre>
<p class="calibre10">Co-processing performs almost identically to putting a command in background mode, except for the fact that it creates a subshell. You'll notice that when the <code class="calibre26">coproc</code> command and its parameters were entered, a background job was started. The background job number (<code class="calibre26">1</code>) and process ID (<code class="calibre26">2544</code>) were displayed on the screen.</p>
<p class="calibre10">The <code class="calibre26">jobs</code> command allows you to display the co-processing status:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Running                 coproc COPROC sleep 10 &amp;
$</code></pre>
<p class="calibre10">From the preceding example, you can see the background command executing in the subshell is <code class="calibre26">coproc COPROC sleep 10</code>. The <code class="calibre26">COPROC</code> is a name given to the process by the <code class="calibre26">coproc</code> command. You can set the name yourself by using extended syntax for the command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">coproc My_Job { sleep 10; }</b></code>
[1] 2570
$
$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Running                 coproc My_Job { sleep 10; } &amp;
$</code></pre>
<p class="calibre10">By using the extended syntax, the co-processing name was set to <code class="calibre26">My_Job</code>. Be careful here, because the extended syntax is a little tricky. You have to make sure that a space appears after the first curly bracket (<code class="calibre26">{</code>) and before the start of your command. Also, you have to make sure the command ends with a semicolon (<code class="calibre26">;</code>). And you have to ensure that a space appears after the semicolon and before the closing curly bracket (<code class="calibre26">}</code>).</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Co-processing allows you to get very fancy and send/receive information to the process running in the subshell. The only time you need to name a co-process is when you have multiple co-processes running, and you need to communicate with them all. Otherwise, just let the <code class="calibre26">coproc</code> command set the name to the default, <code class="calibre26">COPROC</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="125" id="calibre_link-467" class="calibre11"></span>You can be really clever and combine co-processing with process lists creating nested subshells. Just type your process list and put the command <code class="calibre26">coproc</code> in front of it:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">coproc ( sleep 10; sleep 2 )</b></code>
[1] 2574
$
$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Running     coproc COPROC ( sleep 10; sleep 2 ) &amp;
$
$ <code class="calibre26"><b class="calibre21">ps --forest</b></code>
  PID TTY          TIME CMD
 2483 pts/12   00:00:00 bash
 2574 pts/12   00:00:00  \_ bash
 2575 pts/12   00:00:00  |   \_ sleep
 2576 pts/12   00:00:00  \_ ps
$</code></pre>
<p class="calibre10">Just remember that spawning a subshell can be expensive and slow. Creating nested subshells is even more so!</p>
<p class="calibre10">Using subshells can provide flexibility at the command line as well as convenience. Understanding their behavior is important to obtaining this flexibility and convenience. Command behavior is also important to understand. In the next section, the behavior differences between built-in and external commands are explored.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-154" class="calibre4"></a>Understanding Shell Built-In Commands</h2>
<p class="calibre10">While learning about the GNU bash shell, you likely have heard the term built-in command. It is important to understand both shell built-in and non-built-in (external) commands. Built-in commands and non-built-in commands operate very differently.</p>
<section class="toclist">
<h3 class="calibre15">Looking at external commands</h3>
<p class="calibre10">An <i class="calibre12">external command</i>, sometimes called a filesystem command, is a program that exists outside of the bash shell. They are not built into the shell program. An external command program is typically located in <code class="calibre26">/bin</code>, <code class="calibre26">/usr/bin</code>, <code class="calibre26">/sbin</code>, or <code class="calibre26">/usr/sbin</code>.</p>
<p class="calibre10"><span type="pagebreak" title="126" id="calibre_link-468" class="calibre11"></span>The <code class="calibre26">ps</code> command is an external command. You can find its filename by using both the <code class="calibre26">which</code> and the <code class="calibre26">type</code> commands:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">which ps</b></code>
/bin/ps
$
$ <code class="calibre26"><b class="calibre21">type -a ps</b></code>
ps is /bin/ps
$
$ <code class="calibre26"><b class="calibre21">ls -l /bin/ps</b></code>
-rwxr-xr-x 1 root root 93232 Jan  6 18:32 /bin/ps
$</code></pre>
<p class="calibre10">Whenever an external command is executed, a child process is created. This action is termed <i class="calibre12">forking</i>. Conveniently, the external command <code class="calibre26">ps</code> displays its current parent as well as its own forked child processes:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
christi+  <code class="calibre26"><b class="calibre21">2743</b></code>  2742  0 17:09 pts/9    00:00:00 -bash
christi+  2801  <code class="calibre26"><b class="calibre21">2743</b></code>  0 17:16 pts/9    00:00:00 ps -f
$</code></pre>
<p class="calibre10">Because it is an external command, when the <code class="calibre26">ps</code> command executes, a child process is created. In this case, the <code class="calibre26">ps</code> command's PID is <code class="calibre26">2801</code> and the parent PID is <code class="calibre26">2743</code>. The bash shell process, which is the parent, has a PID of <code class="calibre26">2743</code>. <a id="calibre_link-1184" href="#calibre_link-1075" class="calibre4">Figure 5.3</a> illustrates the forking that occurs when an external command is executed.</p>
<figure class="calibre23">
<img class="center" src="images/000015.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1075" href="#calibre_link-1184" class="calibre4"><b class="calibre21">Figure 5.3</b></a></span> External command forking</p>
</figcaption>
</figure>
<p class="calibre10">Whenever a process must fork, it takes time and effort to set up the new child process's environment. Thus, external commands can be a little expensive.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you fork a child process or create a subshell, you can still communicate with it via signaling, which is extremely helpful in both the command line and in writing shell scripts. <i class="calibre12">Signaling</i> allows process communication via signals. Signals and signaling are covered in Chapter 16.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="127" id="calibre_link-469" class="calibre11"></span>When using a built-in command, no forking is required. Therefore, built-in commands are less expensive.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Looking at built-in commands</h3>
<p class="calibre10"><i class="calibre12">Built-in commands</i> are different in that they do not need a child process to execute. They were compiled into the shell and thus are part of the shell's toolkit. No external program file exists to run them.</p>
<p class="calibre10">Both the <code class="calibre26">cd</code> and <code class="calibre26">exit</code> commands are built into the bash shell. You can tell a command is built-in by using the <code class="calibre26">type</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">type cd</b></code>
cd is a shell builtin
$
$ <code class="calibre26"><b class="calibre21">type exit</b></code>
exit is a shell builtin
$</code></pre>
<p class="calibre10">Because they do not need to fork a child process to execute or open a program file, built-in commands are faster and more efficient. A list of GNU bash shell built-in commands is provided in Appendix A.</p>
<p class="calibre10">Be aware that some commands have multiple flavors. For example, both <code class="calibre26">echo</code> and <code class="calibre26">pwd</code> have a built-in command flavor as well as an external command flavor. These flavors are slightly different. To see multiple flavors for commands, use the <code class="calibre26">-a</code> option on the <code class="calibre26">type</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">type -a echo</b></code>
echo is a shell builtin
echo is /bin/echo
$
$ <code class="calibre26"><b class="calibre21">which echo</b></code>
/bin/echo
$
$ <code class="calibre26"><b class="calibre21">type -a pwd</b></code>
pwd is a shell builtin
pwd is /bin/pwd
$
$ <code class="calibre26"><b class="calibre21">which pwd</b></code>
/bin/pwd
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="128" id="calibre_link-470" class="calibre11"></span>Using the <code class="calibre26">type -a</code> command shows both types for each of the two commands. Note that the <code class="calibre26">which</code> command shows only the external command file.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">To use the external command for a command that has multiple flavors, directly reference the file. For example, to use the <code class="calibre26">pwd</code> external command, type <code class="calibre26"><b class="calibre21">/bin/pwd</b>.</code>
</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h4 class="calibre25">Using the history command</h4>
<p class="calibre10">A useful built-in command is the <code class="calibre26">history</code> command. The bash shell keeps track of the commands you have used. You can recall these commands and even reuse them.</p>
<p class="calibre10">To see a recently used commands list, just type the <code class="calibre26">history</code> command with no options:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">history</b></code>
<code class="calibre26">    1  ps -f</code>
<code class="calibre26">    2  pwd</code>
<code class="calibre26">    3  ls</code>
<code class="calibre26">    4  coproc ( sleep 10; sleep 2 )</code>
<code class="calibre26">    5  jobs</code>
<code class="calibre26">    6  ps --forest</code>
<code class="calibre26">    7  ls</code>
<code class="calibre26">    8  ps -f</code>
<code class="calibre26">    9  pwd</code>
<code class="calibre26">   10  ls -l /bin/ps</code>
<code class="calibre26">   11  history</code>
<code class="calibre26">   12  cd /etc</code>
<code class="calibre26">   13  pwd</code>
<code class="calibre26">   14  ls</code>
<code class="calibre26">   15  cd</code>
<code class="calibre26">   16  type pwd</code>
<code class="calibre26">   17  which pwd</code>
<code class="calibre26">   18  type echo</code>
<code class="calibre26">   19  which echo</code>
<code class="calibre26">   20  type -a pwd</code>
<code class="calibre26">   21  type -a echo</code>
<code class="calibre26">   22  pwd</code>
<code class="calibre26">   23  history</code></code></pre>
<p class="calibre10">In this example, only the last 23 commands are shown. Typically, the last 1,000 commands are kept in history. That is lots of commands!</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You can set the number of commands to keep in the bash history. To do so, you need to modify an environment variable called <code class="calibre26">HISTSIZE</code> (see Chapter 6).</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="129" id="calibre_link-471" class="calibre11"></span>You can recall and reuse the last command in your history list. This can save time and typing. To recall and reuse your last command, type <code class="calibre26"><b class="calibre21">!!</b></code> and press the Enter key:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ps --forest</b></code>
  PID TTY          TIME CMD
 2089 pts/0    00:00:00 bash
 2744 pts/0    00:00:00  \_ ps
$
$ <code class="calibre26"><b class="calibre21">!!</b></code>
ps --forest
  PID TTY          TIME CMD
 2089 pts/0    00:00:00 bash
 2745 pts/0    00:00:00  \_ ps
$</code></pre>
<p class="calibre10">When <code class="calibre26">!!</code> was entered, the bash shell first displayed the command it was recalling from the shell's history. After the command was displayed, it was executed.</p>
<p class="calibre10">Command history is kept in the hidden <code class="calibre26">.bash_history</code> file, which is located in the user's home directory. Be careful here. The bash command history is stored in memory and then written out into the history file when the shell is exited:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">history</b></code>
[...]
   25  ps --forest
   26  history
   27  ps --forest
   28  history
$
$ <code class="calibre26"><b class="calibre21">cat .bash_history</b></code>
pwd
ls
history
exit
$</code></pre>
<p class="calibre10">Notice when the <code class="calibre26">history</code> command is run, 28 commands are listed. In the example, the listing is snipped for brevity. However, when the <code class="calibre26">.bash_history</code> file is displayed, only four commands are listed, and they don't match the <code class="calibre26">history</code> command's list.</p>
<p class="calibre10"><span type="pagebreak" title="130" id="calibre_link-472" class="calibre11"></span>You can force the command history to be written to the <code class="calibre26">.bash_history</code> file before leaving a shell session. In order to force this write, use the <code class="calibre26">-a</code> option on the <code class="calibre26">history</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">history -a</b></code>
$
$ <code class="calibre26"><b class="calibre21">history</b></code>
[...]
   25  ps --forest
   26  history
   27  ps --forest
   28  history
   29  ls -a
   30  cat .bash_history
   31  history -a
   32  history
$
$ <code class="calibre26"><b class="calibre21">cat .bash_history</b></code>
[...]
ps --forest
history
ps --forest
history
ls -a
cat .bash_history
history -a</code></pre>
<p class="calibre10">This time both listings need to be snipped because they are so long. Notice that contents from both the <code class="calibre26">history</code> command and the <code class="calibre26">.bash_history</code> file match, except for the very last command listed for the <code class="calibre26">history</code> command, because it came after the <code class="calibre26">history -a</code> command was issued.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you have multiple terminal sessions open, you can still append the <code class="calibre26">.bash_history </code>in each open session using the <code class="calibre26">history -a</code> command. However, the histories are not automatically updated for your other open terminal sessions. This is because the <code class="calibre26">.bash_history </code>file is read only when a terminal session is first started. To force the <code class="calibre26">.bash_history</code> file to be reread and a terminal session's history to be updated, use the <code class="calibre26">history -n</code> command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can recall any command from the history list. Just enter an exclamation point and the command's number from the history list:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">history</b></code>
[...]
   13  pwd
   14  ls
   15  cd
   16  type pwd
   17  which pwd
   18  type echo
   19  which echo
   20  type -a pwd
   21  type -a echo
[...]
   32  history -a
   33  history
   34  cat .bash_history
   35  history
$
$ <code class="calibre26"><b class="calibre21">!20</b></code>
type -a pwd
pwd is a shell builtin
pwd is /bin/pwd
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="131" id="calibre_link-473" class="calibre11"></span>Command number 20 was pulled from command history. Notice that similar to executing the last command in history, the bash shell first displays the command it is recalling from the shell's history. After the command is displayed, it is executed.</p>
<p class="calibre10">Using bash shell command history can be a great timesaver. You can do even more with the built-in <code class="calibre26">history</code> command. Be sure to view the bash manual pages for <code class="calibre26">history</code>, by typing <b class="calibre21">man history</b>.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using command aliases</h4>
<p class="calibre10">The <code class="calibre26">alias</code> command is another shell built-in command. A <i class="calibre12">command alias</i> allows you to create an alias name for common commands (along with their parameters) to help keep your typing to a minimum.</p>
<p class="calibre10">Most likely, your Linux distribution has already set some common command aliases for you. To see a list of the active aliases, use the <code class="calibre26">alias</code> command with the <code class="calibre26">-p</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">alias -p</b></code>
[...]
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l='ls -CF'
alias la='ls -A'
alias ll='ls -alF'
alias ls='ls --color=auto'
$</code></pre>
<p class="calibre10">Notice that, on this Ubuntu Linux distribution, an alias is used to override the standard <code class="calibre26">ls</code> command. It automatically provides the <code class="calibre26">--color</code> parameter, indicating that the terminal supports color mode listings.</p>
<p class="calibre10"><span type="pagebreak" title="132" id="calibre_link-474" class="calibre11"></span>You can create your own aliases using the <code class="calibre26">alias</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">alias li='ls -li'</b></code>
$
$ <code class="calibre26"><b class="calibre21">li</b></code>
total 36
529581 drwxr-xr-x. 2 Christine Christine 4096 May 19 18:17 Desktop
529585 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Documents
529582 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Downloads
529586 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Music
529587 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Pictures
529584 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Public
529583 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Templates
532891 -rwxrw-r--. 1 Christine Christine   36 May 30 07:21 test.sh
529588 drwxr-xr-x. 2 Christine Christine 4096 Apr 25 16:59 Videos
$</code></pre>
<p class="calibre10">After you define an alias value, you can use it at any time in your shell, including in shell scripts. Be aware that because command aliases are built-in commands, an alias is valid only for the shell process in which it is defined:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">alias li='ls -li'</b></code>
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">li</b></code>
bash: li: command not found
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$</code></pre>
<p class="calibre10">Fortunately, you can make an alias value permanent across subshells. The next chapter covers how to do that, along with environment variables.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-155" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed the complicated interactive program, the GNU bash shell. It covered understanding the shell process and its relationships, including how subshells are spawned and their relationship to the parent shell. We also explored commands that create child processes and commands that don't.</p>
<p class="calibre10">The default interactive shell is normally started whenever a user logs in to a terminal. The shell that the system starts depends upon a user ID configuration. Typically, it is <code class="calibre26">/bin/bash</code>. The default system shell, <code class="calibre26">/bin/sh</code>, is used for system shell scripts, such as those needed at startup.</p>
<p class="calibre10"><span type="pagebreak" title="133" id="calibre_link-475" class="calibre11"></span>A subshell or child shell can be spawned using the <code class="calibre26">bash</code> command. They are also created when a process list or the <code class="calibre26">coproc</code> command is used. Using subshells at the command line can allow for creative and productive use of the CLI. Subshells can be nested, spawning grandchild shells and great-grandchild shells. Creating a subshell is an expensive process as a new environment for the shell must be created as well.</p>
<p class="calibre10">Finally, the chapter looked at two different types of shell commands: built-in and external commands. External commands create a child process with a new environment, but a built-in command does not. This causes external commands to be more expensive to use. Because a new environment is not needed, built-in commands are more efficient and not affected by any environment changes.</p>
<p class="calibre10">Shells, subshells, processes, and forked processes are all affected by environment variables. How the variables affect and can be used within these different contexts are explored in the next chapter.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1206">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-156" class="calibre4"></a><span class="chaptertitle">Chapter 6</span><br class="calibre22" /><span class="chaptertitle">Using Linux Environment Variables</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Looking at environment variables</li>
<li class="calibre7">Creating your own local variables</li>
<li class="calibre7">Removing variables</li>
<li class="calibre7">Exploring default shell environment variables</li>
<li class="calibre7">Setting the PATH environment variable</li>
<li class="calibre7">Locating environment files</li>
<li class="calibre7">Using variable arrays</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="135" id="calibre_link-476" class="calibre11"></span>Linux environment variables help define your Linux shell experience. Many programs and scripts use environment variables to obtain system information and store temporary data and configuration information. Environment variables are set in lots of places on the Linux system, and you should know where these places are.</p>
<p class="calibre19">This chapter walks you through the world of Linux environment variables, showing where they are, how to use them, and even how to create your own. The chapter finishes off with how to use variable arrays.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-157" class="calibre4"></a>Exploring Environment Variables</h2>
<p class="calibre10">The bash shell uses a feature called <i class="calibre12">environment variables</i> to store information about the shell session and the working environment (thus the name environment variables). This feature also allows you to store data in memory that can be easily accessed by any program or script running from the shell. It is a handy way to store needed persistent data.</p>
<p class="calibre10">There are two environment variable types in the bash shell:</p>
<ul class="calibre14">
<li class="calibre7">Global variables</li>
<li class="calibre7">Local variables</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="136" id="calibre_link-477" class="calibre11"></span>This section describes each type of environment variable and shows how to see and use them.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Even though the bash shell uses specific environment variables that are consistent, different Linux distributions often add their own environment variables. The environment variable examples you see in this chapter may differ slightly from what's available on your specific distribution. If you run into an environment variable not covered here, check your Linux distribution's documentation</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h3 class="calibre15">Looking at global environment variables</h3>
<p class="calibre10">Global environment variables are visible from the shell session and from any spawned child subshells. Local variables are available only in the shell that creates them. This makes global environment variables useful in applications that create child subshells, which require parent shell information.</p>
<p class="calibre10">The Linux system sets several global environment variables when you start your bash session. (For more details about what variables are started at that time, see the âLocating System Environment Variablesâ section later in this chapter.) The system environment variables almost always use all capital letters to differentiate them from normal user environment variables.</p>
<p class="calibre10">To view global environment variables, use the <code class="calibre26">env</code> or the <code class="calibre26">printenv</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">printenv</b></code>
HOSTNAME=server01.class.edu
SELINUX_ROLE_REQUESTED=
TERM=xterm
SHELL=/bin/bash
HISTSIZE=1000
[...]
HOME=/home/Christine
LOGNAME=Christine
[...]
G_BROKEN_FILENAMES=1
_=/usr/bin/printenv</code></pre>
<p class="calibre10">So many global environment variables get set for the bash shell that the display had to be snipped. Not only are many set during the login process, but how you log in can affect which ones are set as well.</p>
<p class="calibre10">To display an individual environment variable's value, you can use the <code class="calibre26">printenv</code> command, but not the <code class="calibre26">env</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">printenv HOME</b></code>
/home/Christine
$
$ <code class="calibre26"><b class="calibre21">env HOME</b></code>
env: HOME: No such file or directory
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="137" id="calibre_link-478" class="calibre11"></span>You can also use the <code class="calibre26">echo</code> command to display a variable's value. When referencing an environment variable in this case, you must place a dollar sign (<code class="calibre26">$</code>) before the environment variable name:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $HOME</b></code>
/home/Christine
$</code></pre>
<p class="calibre10">Using the dollar sign along with the variable name does more than just display its current definition when used with the <code class="calibre26">echo</code> command. The dollar sign before a variable name allows the variable to be passed as a command parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls $HOME</b></code>
Desktop    Downloads  Music     Public     test.sh
Documents  junk.dat   Pictures  Templates  Videos
$
$ <code class="calibre26"><b class="calibre21">ls /home/Christine</b></code>
Desktop    Downloads  Music     Public     test.sh
Documents  junk.dat   Pictures  Templates  Videos
$</code></pre>
<p class="calibre10">As mentioned earlier, global environment variables are also available to any process's subshells:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">ps -f</b></code>
UID        PID  PPID  C STIME TTY          TIME CMD
501       2017  2016  0 16:00 pts/0    00:00:00 -bash
501       2082  2017  0 16:08 pts/0    00:00:00 bash
501       2095  2082  0 16:08 pts/0    00:00:00 ps -f
$
$ <code class="calibre26"><b class="calibre21">echo $HOME</b></code>
/home/Christine
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$</code></pre>
<p class="calibre10">In this example, after spawning a subshell using the <code class="calibre26">bash</code> command, the <code class="calibre26">HOME</code> environment variable's current value is shown. It is set to the exact same value, <code class="calibre26">/home/Christine</code>, as it was in the parent shell.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Looking at local environment variables</h3>
<p class="calibre10"><span type="pagebreak" title="138" id="calibre_link-479" class="calibre11"></span>Local environment variables, as their name implies, can be seen only in the local process in which they are defined. Even though they are local, they are just as important as global environment variables. In fact, the Linux system also defines standard local environment variables for you by default. However, you can also define your own local variables. These, as you would assume, are called user-defined local variables.</p>
<p class="calibre10">Trying to see the local variables list is a little tricky at the CLI. Unfortunately, there isn't a command that displays only these variables. The <code class="calibre26">set</code> command displays all variables defined for a specific process, including both local and global environment variables and user-defined variables:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">set</b></code>
BASH=/bin/bash
[...]
BASH_ALIASES=()
BASH_ARGC=()
BASH_ARGV=()
BASH_CMDS=()
BASH_LINENO=()
BASH_SOURCE=()
[...]
colors=/etc/DIR_COLORS
my_variable='Hello World'
[...]
$</code></pre>
<p class="calibre10">All global environment variables displayed using the <code class="calibre26">env</code> or <code class="calibre26">printenv</code> commands appear in the <code class="calibre26">set</code> command's output. The additional environment variables are the local environment and user-defined variables.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The differences between the commands <code class="calibre26">env</code>, <code class="calibre26">printenv</code>, and <code class="calibre26">set</code> are subtle. The <code class="calibre26">set</code> command displays both global and local environment variables and user-defined variables. It also sorts the display alphabetically. The <code class="calibre26">env</code> and <code class="calibre26">printenv</code> are different from <code class="calibre26">set</code> in that they do not sort the variables, nor do they include local environment or local user-defined variables. Used in this context, <code class="calibre26">env</code> and <code class="calibre26">printenv</code> produce duplicate listings. However, the <code class="calibre26">env</code> command has additional functionality that <code class="calibre26">printenv</code> does not have, making it the slightly more powerful command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-158" class="calibre4"></a>Setting User-Defined Variables</h2>
<p class="calibre10">You can set your own variables directly from the bash shell. This section shows you how to create your own variables and reference them from an interactive shell or shell script program.</p>
<section class="toclist">
<h3 class="calibre15">Setting local user-defined variables</h3>
<p class="calibre10"><span type="pagebreak" title="139" id="calibre_link-480" class="calibre11"></span>After you start a bash shell (or spawn a shell script), you're allowed to create local user-defined variables that are visible within your shell process. You can assign either a numeric or a string value to an environment variable by assigning the variable to a value using the equal sign:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
$ <code class="calibre26"><b class="calibre21">my_variable=Hello</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
Hello</code></pre>
<p class="calibre10">That was simple! Now, any time you need to reference the <code class="calibre26">my_variable</code> user-defined variable's value, just reference it by the name <code class="calibre26">$my_variable</code>.</p>
<p class="calibre10">If you need to assign a string value that contains spaces, you need to use a single or double quotation mark to delineate the beginning and the end of the string:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable=Hello World</b></code>
-bash: World: command not found
$
$ <code class="calibre26"><b class="calibre21">my_variable="Hello World"</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
Hello World
$</code></pre>
<p class="calibre10">Without the quotation marks, the bash shell assumes that the next word is another command to process. Notice that for the local variable you defined, you used lowercase letters, while the system environment variables you've seen so far have all used uppercase letters.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">The standard bash shell convention is for all environment variables to use uppercase letters. If you are creating a local variable for yourself and your own shell scripts, use lowercase letters. Variables are case sensitive. By keeping your user-defined local variables lowercase, you avoid the potential disaster of redefining a system environment variable.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">It's extremely important that you not use spaces between the variable name, the equal sign, and the value. If you put any spaces in the assignment, the bash shell interprets the value as a separate command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">my_variable = "Hello World"</b></code>
<code class="calibre26">-bash: my_variable: command not found</code>
<code class="calibre26">$</code></code></pre>
<p class="calibre10">After you set a local variable, it's available for use anywhere within your shell process. However, if you spawn another shell, it's not available in the child shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable="Hello World"</b></code>
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
Hello World
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="140" id="calibre_link-481" class="calibre11"></span>In this example, a child shell was spawned. The user-defined <code class="calibre26">my_variable</code> was not available in the child shell. This is demonstrated by the blank line returned after the <code class="calibre26">echo $my_variable</code> command. After the child shell was exited and returned to the original shell, the local variable was still available.</p>
<p class="calibre10">Similarly, if you set a local variable in a child process, after you leave the child process, the local variable is no longer available:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $my_child_variable</b></code>
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">my_child_variable="Hello Little World"</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_child_variable</b></code>
Hello Little World
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_child_variable</b></code>
$</code></pre>
<p class="calibre10">The local variable set within the child shell doesn't exist after a return to the parent shell. You can change this behavior by turning your local user-defined variable into a global environment variable.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Setting global environment variables</h3>
<p class="calibre10">Global environment variables are visible from any child processes created by the parent process that sets the variable. The method used to create a global environment variable is to first create a local variable and then export it to the global environment.</p>
<p class="calibre10"><span type="pagebreak" title="141" id="calibre_link-482" class="calibre11"></span>This is done by using the <code class="calibre26">export</code> command and the variable name minus the dollar sign:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable="I am Global now"</b></code>
$
$ <code class="calibre26"><b class="calibre21">export my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$</code></pre>
<p class="calibre10">After defining and exporting the local variable <code class="calibre26">my_variable</code>, a child shell was started by the <code class="calibre26">bash</code> command. The child shell was able to properly display the <code class="calibre26">my_variable </code>variable's value. The variable kept its value, because the <code class="calibre26">export</code> command made it a global environment variable.</p>
<p class="calibre10">Changing a global environment variable within a child shell does not affect the variable's value in the parent shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable="I am Global now"</b></code>
$ <code class="calibre26"><b class="calibre21">export my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">my_variable="Null"</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
Null
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="142" id="calibre_link-483" class="calibre11"></span>After defining and exporting the variable <code class="calibre26">my_variable</code>, a subshell was started by the <code class="calibre26">bash</code> command. The subshell properly displayed the value of the <code class="calibre26">my_variable </code>global environment variable. The variable's value was then changed by the child shell. However, the variable's value was modified only within the child shell and not in the parent's shell.</p>
<p class="calibre10">A child shell cannot even use the <code class="calibre26">export</code> command to change the parent shell's global environment variable's value:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable="I am Global now"</b></code>
$ <code class="calibre26"><b class="calibre21">export my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">my_variable="Null"</b></code>
$
$ <code class="calibre26"><b class="calibre21">export my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
Null
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$</code></pre>
<p class="calibre10">Even though the child shell redefined and exported the variable <code class="calibre26">my_variable</code>, the parent shell's <code class="calibre26">my_variable</code> variable kept its original value.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-159" class="calibre4"></a>Removing Environment Variables</h2>
<p class="calibre10">Of course, if you can create a new environment variable, it makes sense that you can also remove an existing environment variable. You can do this with the <code class="calibre26">unset</code> command. When referencing the environment variable in the <code class="calibre26">unset</code> command, remember not to use the dollar sign:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">unset my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">It can be confusing to remember when to use and when not to use the dollar sign with environment variables. Just remember this: If you are doing anything <i class="calibre12">with</i> the variable, use the dollar sign. If you are doing anything <i class="calibre12">to</i> the variable, don't use the dollar sign. The exception to this rule is using <code class="calibre26">printenv</code> to display a variable's value.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="143" id="calibre_link-484" class="calibre11"></span>When dealing with global environment variables, things get a little tricky. If you're in a child process and unset a global environment variable, it applies only to the child process. The global environment variable is still available in the parent process:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">my_variable="I am Global now"</b></code>
$
$ <code class="calibre26"><b class="calibre21">export my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$
$ <code class="calibre26"><b class="calibre21">unset my_variable</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$
$ <code class="calibre26"><b class="calibre21">echo $my_variable</b></code>
I am Global now
$</code></pre>
<p class="calibre10">Just as with modifying a variable, you cannot unset it in a child shell and have the variable be unset in the parent's shell.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-160" class="calibre4"></a>Uncovering Default Shell Environment Variables</h2>
<p class="calibre10">The bash shell uses specific environment variables by default to define the system environment. You can always count on these variables being set or available to be set on your Linux system. Because the bash shell is a derivative of the original Unix Bourne shell, it also includes environment variables originally defined in that shell.</p>
<p class="calibre10"><a id="calibre_link-1207" href="#calibre_link-1117" class="calibre4">Table 6.1</a> shows the environment variables that the bash shell provides that are compatible with the original Unix Bourne shell.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1117" href="#calibre_link-1207" class="calibre4"><b class="calibre21">Table 6.1</b></a></span> <span type="pagebreak" title="144" id="calibre_link-485" class="calibre11"></span>The bash Shell Bourne Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">CDPATH</code></td>
<td class="left">A colon-separated list of directories used as a search path for the <code class="calibre26">cd</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOME</code></td>
<td class="left">The current user's home directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">IFS</code></td>
<td class="left">A list of characters that separate fields used by the shell to split text strings</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAIL</code></td>
<td class="left">The filename for the current user's mailbox (The bash shell checks this file for new mail.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAILPATH</code></td>
<td class="left">A colon-separated list of multiple filenames for the current user's mailbox (The bash shell checks each file in this list for new mail.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OPTARG</code></td>
<td class="left">The value of the last option argument processed by the <code class="calibre26">getopt</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OPTIND</code></td>
<td class="left">The index value of the last option argument processed by the <code class="calibre26">getopt</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PATH</code></td>
<td class="left">A colon-separated list of directories where the shell looks for commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS1</code></td>
<td class="left">The primary shell command line interface prompt string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS2</code></td>
<td class="left">The secondary shell command line interface prompt string</td>
</tr>
</table>
</figure>
<p class="calibre10">Besides the default Bourne environment variables, the bash shell also provides a few variables of its own, as shown in <a id="calibre_link-1208" href="#calibre_link-1118" class="calibre4">Table 6.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1118" href="#calibre_link-1208" class="calibre4"><b class="calibre21">Table 6.2</b></a></span> <span type="pagebreak" title="145" id="calibre_link-486" class="calibre11"></span>The bash Shell Environment Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH</code></td>
<td class="left">The full pathname to execute the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ALIASES</code></td>
<td class="left">An associative array of currently set aliases</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ARGC</code></td>
<td class="left">A variable array that contains the number of parameters being passed to a subroutine or shell script</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ARCV</code></td>
<td class="left">A variable array that contains the parameters being passed to a subroutine or shell script</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_CMDS</code></td>
<td class="left">An associative array of locations of commands the shell has executed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_COMMAND</code></td>
<td class="left">The shell command currently being or about to be executed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ENV</code></td>
<td class="left">When set, each bash script attempts to execute a startup file defined by this variable before running.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_EXECUTION_STRING</code></td>
<td class="left">The command(s) passed using the bash <code class="calibre26">-c</code> option</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_LINENO</code></td>
<td class="left">A variable array containing the source code line number of the currently executing shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_REMATCH</code></td>
<td class="left">A read-only variable array containing patterns and their sub-patterns for positive matches using the regular expression comparison operator, <code class="calibre26">=â¼</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_SOURCE</code></td>
<td class="left">A variable array containing the source code filename of the currently executing shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_SUBSHELL</code></td>
<td class="left">The current nesting level of a subshell environment (The initial value is 0.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_VERSINFO</code></td>
<td class="left">A variable array that contains the individual major and minor version numbers of the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_VERSION</code></td>
<td class="left">The version number of the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_XTRACEFD</code></td>
<td class="left">If set to a valid file descriptor (0,1,2), trace output generated from the <code class="calibre26">'set -x'</code> debugging option can be redirected. This is often used to separate trace output into a file.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASHOPTS</code></td>
<td class="left">A list of bash shell options that are currently enabled</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASHPID</code></td>
<td class="left">Process ID of the current bash process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COLUMNS</code></td>
<td class="left">Contains the terminal width of the terminal used for the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_CWORD</code></td>
<td class="left">An index into the variable <code class="calibre26">COMP_WORDS</code>, which contains the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_LINE</code></td>
<td class="left">The current command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_POINT</code></td>
<td class="left">The index of the current cursor position relative to the beginning of the current command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_KEY</code></td>
<td class="left">The final key used to invoke the current completion of a shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_TYPE</code></td>
<td class="left">An integer value representing the type of completion attempted that caused a completion shell function to be invoked</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_WORDBREAKS</code></td>
<td class="left">The Readline library word separator characters for performing word completion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_WORDS</code></td>
<td class="left">An array variable that contains the individual words on the current command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMPREPLY</code></td>
<td class="left">An array variable that contains the possible completion codes generated by a shell function</td>
</tr>
<tr class="calibre28">
<td class="left"></td>
<td class="left"></td>
</tr>
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COPROC</code></td>
<td class="left"><span type="pagebreak" title="146" id="calibre_link-487" class="calibre11"></span>An array variable that holds an unnamed coprocess' I/O file descriptors</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">DIRSTACK</code></td>
<td class="left">An array variable that contains the current contents of the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">EMACS</code></td>
<td class="left">Indicates the emacs shell buffer is executing and line editing is disabled, when set to <code class="calibre26">'t'</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ENV</code></td>
<td class="left">When set, executes the startup file defined before a bash shell script runs (It is used only when the bash shell has been invoked in POSIX mode.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">EUID</code></td>
<td class="left">The numeric effective user ID of the current user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FCEDIT</code></td>
<td class="left">The default editor used by the <code class="calibre26">fc</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FIGNORE</code></td>
<td class="left">A colon-separated list of suffixes to ignore when performing file name completion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FUNCNAME</code></td>
<td class="left">The name of the currently executing shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FUNCNEST</code></td>
<td class="left">Sets the maximum allowed function nesting level, when set to a number greater than zero (If it is exceeded, the current command aborts.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">GLOBIGNORE</code></td>
<td class="left">A colon-separated list of patterns defining the set of filenames to be ignored by file name expansion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">GROUPS</code></td>
<td class="left">A variable array containing the list of groups of which the current user is a member</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">histchars</code></td>
<td class="left">Up to three characters, which control history expansion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTCMD</code></td>
<td class="left">The history number of the current command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTCONTROL</code></td>
<td class="left">Controls what commands are entered in the shell history list</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTFILE</code></td>
<td class="left">The name of the file in which to save the shell history list (<code class="calibre26">.bash_history</code> by default)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTFILESIZE</code></td>
<td class="left">The maximum number of lines to save in the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTTIMEFORMAT</code></td>
<td class="left">Used as a formatting string to print each command's timestamp in bash history, if set and not null</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTIGNORE</code></td>
<td class="left">A colon-separated list of patterns used to decide which commands are ignored for the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTSIZE</code></td>
<td class="left">The maximum number of commands stored in the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTFILE</code></td>
<td class="left">Contains the name of the file that should be read when the shell needs to complete a hostname</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTNAME</code></td>
<td class="left">The name of the current host</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTTYPE</code></td>
<td class="left">A string describing the machine the bash shell is running on</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">IGNOREEOF</code></td>
<td class="left"><span type="pagebreak" title="147" id="calibre_link-488" class="calibre11"></span>The number of consecutive EOF characters the shell must receive before exiting (If this value doesn't exist, the default is 1.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">INPUTRC</code></td>
<td class="left">The name of the Readline initialization file (The default is <code class="calibre26">.inputrc</code>.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LANG</code></td>
<td class="left">The locale category for the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_ALL</code></td>
<td class="left">Overrides the <code class="calibre26">LANG</code> variable, defining a locale category</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_COLLATE</code></td>
<td class="left">Sets the collation order used when sorting string values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_CTYPE</code></td>
<td class="left">Determines the interpretation of characters used in filename expansion and pattern matching</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_MESSAGES</code></td>
<td class="left">Determines the locale setting used when interpreting double-quoted strings preceded by a dollar sign</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_NUMERIC</code></td>
<td class="left">Determines the locale setting used when formatting numbers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LINENO</code></td>
<td class="left">The line number in a script currently executing</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LINES</code></td>
<td class="left">Defines the number of lines available on the terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MACHTYPE</code></td>
<td class="left">A string defining the system type in cpu-company-system format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAPFILE</code></td>
<td class="left">An array variable that holds read-in text from the <code class="calibre26">mapfile</code> command when no array variable name is given</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAILCHECK</code></td>
<td class="left">How often (in seconds) the shell should check for new mail (The default is 60.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OLDPWD</code></td>
<td class="left">The previous working directory used in the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OPTERR</code></td>
<td class="left">If set to 1, the bash shell displays errors generated by the <code class="calibre26">getopts</code> command.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OSTYPE</code></td>
<td class="left">A string defining the operating system the shell is running on</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PIPESTATUS</code></td>
<td class="left">A variable array containing a list of exit status values from the processes in the foreground process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">POSIXLY_CORRECT</code></td>
<td class="left">If set, bash starts in POSIX mode.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PPID</code></td>
<td class="left">The process ID (PID) of the bash shell's parent process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PROMPT_COMMAND</code></td>
<td class="left">If set, the command to execute before displaying the primary prompt</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PROMPT_DIRTRIM</code></td>
<td class="left">An integer used to indicate the number of trailing directory names to display when using the âw and âW prompt string escapes (The directory names removed are replaced with one set of ellipses.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS3</code></td>
<td class="left">The prompt to use for the <code class="calibre26">select</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS4</code></td>
<td class="left">The prompt displayed before the command line is echoed if the bash <code class="calibre26">-x</code> parameter is used</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PWD</code></td>
<td class="left">The current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"></td>
<td class="left"></td>
</tr>
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RANDOM</code></td>
<td class="left">Returns a random number between 0 and 32767 (Assigning a value to this variable seeds the pseudo-random number generator.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">READLINE_LINE</code></td>
<td class="left">Readline buffer contents when using <code class="calibre26">bind -x</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">READLINE_POINT</code></td>
<td class="left">Readline buffer content insertion point's current position when using <code class="calibre26">bind -x</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">REPLY</code></td>
<td class="left">The default variable for the <code class="calibre26">read</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SECONDS</code></td>
<td class="left">The number of seconds since the shell was started (Assigning a value resets the timer to the value.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHELL</code></td>
<td class="left">The full pathname to the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHELLOPTS</code></td>
<td class="left">A colon-separated list of enabled bash shell options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHLVL</code></td>
<td class="left">Indicates the shell level, incremented by one each time a new bash shell is started</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TIMEFORMAT</code></td>
<td class="left">A format specifying how the shell displays time values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TMOUT</code></td>
<td class="left">The value of how long (in seconds) the select and read commands should wait for input (The default of zero indicates to wait indefinitely.)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TMPDIR</code></td>
<td class="left">Directory name where the bash shell creates temporary files for its use</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">UID</code></td>
<td class="left">The numeric real user ID of the current user</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="148" id="calibre_link-489" class="calibre11"></span>You may notice that not all default environment variables are shown when the <code class="calibre26">set</code> command is used. When not in use, the default environment variables are not all required to contain a value.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-161" class="calibre4"></a>Setting the PATH Environment Variable</h2>
<p class="calibre10">When you enter an external command (see Chapter 5) in the shell command line interface (CLI), the shell must search the system to find the program. The <code class="calibre26">PATH</code> environment variable defines the directories it searches looking for commands and programs. On this Ubuntu Linux system, the <code class="calibre26">PATH</code> environment variable looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $PATH</b></code>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:
/sbin:/bin:/usr/games:/usr/local/games
$</code></pre>
<p class="calibre10">This shows that there are eight directories where the shell looks for commands and programs. The directories in the <code class="calibre26">PATH</code> are separated by colons.</p>
<p class="calibre10">If a command's or program's location is not included in the <code class="calibre26">PATH</code> variable, the shell cannot find it without an absolute directory reference. If the shell cannot find the command or program, it produces an error message:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">myprog</b></code>
-bash: myprog: command not found
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="149" id="calibre_link-490" class="calibre11"></span>The problem is that often applications place their executable programs in directories that aren't in the <code class="calibre26">PATH</code> environment variable. The trick is ensuring that your <code class="calibre26">PATH</code> environment variable includes all the directories where your applications reside.</p>
<p class="calibre10">You can add new search directories to the existing <code class="calibre26">PATH</code> environment variable without having to rebuild it from scratch. The individual directories listed in the <code class="calibre26">PATH</code> are separated by colons. All you need to do is reference the original <code class="calibre26">PATH</code> value and add any new directories to the string. This looks something like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $PATH</b></code>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:
/sbin:/bin:/usr/games:/usr/local/games
$
$ <code class="calibre26"><b class="calibre21">PATH=$PATH:/home/christine/Scripts</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo $PATH</b></code>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/
     games:/usr/local/games:/home/christine/Scripts
$
$ <code class="calibre26"><b class="calibre21">myprog</b></code>
The factorial of 5 is 120.
$</code></pre>
<p class="calibre10">By adding the directory to the <code class="calibre26">PATH</code> environment variable, you can now execute your program from anywhere in the virtual directory structure:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cd /etc</b></code>
$
$ <code class="calibre26"><b class="calibre21">myprog</b></code>
The factorial of 5 is 120
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you want your program's location to be available to subshells, be sure to export your modified <code class="calibre26">PATH</code> environment variable.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">A common trick for programmers is to include the single dot symbol in their <code class="calibre26">PATH</code> environment variable. The single dot symbol represents the current directory (see Chapter 3):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">PATH=$PATH:.</b></code>
$
$ <code class="calibre26"><b class="calibre21">cd /home/christine/Old_Scripts</b></code>
$
$ <code class="calibre26"><b class="calibre21">myprog2</b></code>
The factorial of 6 is 720
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="150" id="calibre_link-491" class="calibre11"></span>Changes to the PATH variable last only until you exit the system or the system reboots. The changes are not persistent. In the next section, you see how you can make changes to environment variables permanent.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-162" class="calibre4"></a>Locating System Environment Variables</h2>
<p class="calibre10">The Linux system uses environment variables for many purposes. You know now how to modify system environment variables and create your own variables. The trick is in how these environment variables are made persistent.</p>
<p class="calibre10">When you start a bash shell by logging in to the Linux system, by default bash checks several files for commands. These files are called <i class="calibre12">startup files</i> or <i class="calibre12">environment files</i>. The startup files that bash processes depend on the method you use to start the bash shell. You can start a bash shell in three ways:</p>
<ul class="calibre14">
<li class="calibre7">As a default login shell at login time</li>
<li class="calibre7">As an interactive shell that is started by spawning a subshell</li>
<li class="calibre7">As a non-interactive shell to run a script</li>
</ul>
<p class="calibre10">The following sections describe the startup files the bash shell executes in each of these startup methods.</p>
<section class="toclist">
<h3 class="calibre15">Understanding the login shell process</h3>
<p class="calibre10">When you log in to the Linux system, the bash shell starts as a login shell. The login shell typically looks for five different startup files to process commands from:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">/etc/profile</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bash_profile</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bashrc</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bash_login</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.profile</code></li>
</ul>
<p class="calibre10">The <code class="calibre26">/etc/profile</code> file is the main default startup file for the bash shell on the system. All users on the system execute this startup file when they log in.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Be aware that some Linux distributions use Pluggable Authentication Modules (PAM). In this case, before the bash shell is started, PAM files are processed, including ones that may contain environment variables. PAM file examples include the <code class="calibre26">/etc/environment</code> file and the <code class="calibre26">$HOME/.pam_environment</code> file. Find more information about PAM at <a href="http://linux-pam.org" class="calibre4">http://linux-pam.org</a>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="151" id="calibre_link-492" class="calibre11"></span>The other four startup files are specific for each user and can be customized for an individual user's requirements. Let's look closer at these files.</p>
<section class="toclist">
<h4 class="calibre25">Viewing the /etc/profile file</h4>
<p class="calibre10">The <code class="calibre26">/etc/profile</code> file is the main default startup file for the bash shell. Whenever you log in to the Linux system, bash executes the commands in the <code class="calibre26">/etc/profile</code> startup file first. Different Linux distributions place different commands in this file. On this Ubuntu Linux system, the file looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat /etc/profile</b></code>
# /etc/profile: system-wide .profile file for the Bourne shell (sh(1))
# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).
if [ ''$PS1'' ]; then
  if [ ''$BASH'' ] &amp;&amp; [ ''$BASH'' != ''/bin/sh'' ]; then
    # The file bash.bashrc already sets the default PS1.
    # PS1='\h:\w\$ '
    if [ -f /etc/bash.bashrc ]; then
      . /etc/bash.bashrc
    fi
  else
    if [ ''`id -u`'' -eq 0 ]; then
      PS1='# '
    else
      PS1='$ '
    fi
  fi
fi
# The default umask is now handled by pam_umask.
# See pam_umask(8) and /etc/login.defs.
if [ -d /etc/profile.d ]; then
  for i in /etc/profile.d/*.sh; do
    if [ -r $i ]; then
      . $i
    fi
  done
  unset i
fi
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="152" id="calibre_link-493" class="calibre11"></span>Most of the commands and syntax you see in this file are covered in more detail in Chapter 12 and beyond. Each distribution's <code class="calibre26">/etc/profile</code> file has different settings and commands. For example, notice that a file is mentioned in this Ubuntu distribution's <code class="calibre26">/etc/profile</code> file above, called <code class="calibre26">/etc/bash.bashrc</code>. It contains system environment variables.</p>
<p class="calibre10">However, in this CentOS distribution's <code class="calibre26">/etc/profile</code> file listed below, no <code class="calibre26">/etc/bash.bashrc</code> file is called. Also note that it sets and exports some system environment variables within itself:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat /etc/profile</b></code>
# /etc/profile
# System wide environment and startup programs, for login setup
# Functions and aliases go in /etc/bashrc
# It's NOT a good idea to change this file unless you know what you
# are doing. It's much better to create a custom.sh shell script in
# /etc/profile.d/ to make custom changes to your environment, to
# prevent the need for merging in future updates.
pathmunge () {
    case ":${PATH}:" in
        *:"$1":*)
            ;;
        *)
            if [ "$2" = "after" ] ; then
                PATH=$PATH:$1
            else
                PATH=$1:$PATH
            fi
    esac
}
if [ -x /usr/bin/id ]; then
    if [ -z "$EUID" ]; then
        # ksh workaround
        EUID=`id -u`
        UID=`id -ru`
    fi
    USER="`id -un`"
    LOGNAME=$USER
    MAIL="/var/spool/mail/$USER"
fi
# Path manipulation
if [ "$EUID" = "0" ]; then
    pathmunge /sbin
    pathmunge /usr/sbin
    pathmunge /usr/local/sbin
else
    pathmunge /usr/local/sbin after
    pathmunge /usr/sbin after
    pathmunge /sbin after
fi
HOSTNAME=`/bin/hostname 2&gt;/dev/null`
HISTSIZE=1000
if [ "$HISTCONTROL" = "ignorespace" ] ; then
    export HISTCONTROL=ignoreboth
else
    export HISTCONTROL=ignoredups
fi
export <span type="pagebreak" title="153" id="calibre_link-494" class="calibre11"></span>PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL
# By default, we want umask to get set. This sets it for login shell
# Current threshold for system reserved uid/gids is 200
# You could check uidgid reservation validity in
# /usr/share/doc/setup-*/uidgid file
if [ $UID -gt 199 ] &amp;&amp; [ "`id -gn`" = "`id -un`" ]; then
    umask 002
else
    umask 022
fi
for i in /etc/profile.d/*.sh ; do
    if [ -r "$i" ]; then
        if [ "${-#*i}" != "$-" ]; then
            . "$i"
        else
            . "$i" &gt;/dev/null 2&gt;&amp;1
        fi
    fi
done
unset i
unset -f pathmunge
$</code></pre>
<p class="calibre10">Both distributions' <code class="calibre26">/etc/profile</code> files use a certain feature. It is a <code class="calibre26">for</code> statement that iterates through any files located in the <code class="calibre26">/etc/profile.d</code> directory. (<code class="calibre26">for</code> statements are discussed in detail in Chapter 13.) This provides a place for the Linux system to place application-specific startup files that is executed by the shell when you log in. On this Ubuntu Linux system, the following files are in the <code class="calibre26">profile.d</code> directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l /etc/profile.d</b></code>
total 12
-rw-r--r-- 1 root root   40 Apr 15 06:26 appmenu-qt5.sh
-rw-r--r-- 1 root root  663 Apr  7 10:10 bash_completion.sh
-rw-r--r-- 1 root root 1947 Nov 22  2013 vte.sh
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="154" id="calibre_link-495" class="calibre11"></span>You can see that this CentOs system has quite a few more files in <code class="calibre26">/etc/profile.d</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l /etc/profile.d</b></code>
total 80
-rw-r--r--. 1 root root 1127 Mar  5 07:17 colorls.csh
-rw-r--r--. 1 root root 1143 Mar  5 07:17 colorls.sh
-rw-r--r--. 1 root root   92 Nov 22  2013 cvs.csh
-rw-r--r--. 1 root root   78 Nov 22  2013 cvs.sh
-rw-r--r--. 1 root root  192 Feb 24 09:24 glib2.csh
-rw-r--r--. 1 root root  192 Feb 24 09:24 glib2.sh
-rw-r--r--. 1 root root   58 Nov 22  2013 gnome-ssh-askpass.csh
-rw-r--r--. 1 root root   70 Nov 22  2013 gnome-ssh-askpass.sh
-rwxr-xr-x. 1 root root  373 Sep 23  2009 kde.csh
-rwxr-xr-x. 1 root root  288 Sep 23  2009 kde.sh
-rw-r--r--. 1 root root 1741 Feb 20 05:44 lang.csh
-rw-r--r--. 1 root root 2706 Feb 20 05:44 lang.sh
-rw-r--r--. 1 root root  122 Feb  7  2007 less.csh
-rw-r--r--. 1 root root  108 Feb  7  2007 less.sh
-rw-r--r--. 1 root root  976 Sep 23  2011 qt.csh
-rw-r--r--. 1 root root  912 Sep 23  2011 qt.sh
-rw-r--r--. 1 root root 2142 Mar 13 15:37 udisks-bash-completion.sh
-rw-r--r--. 1 root root   97 Apr  5  2012 vim.csh
-rw-r--r--. 1 root root  269 Apr  5  2012 vim.sh
-rw-r--r--. 1 root root  169 May 20  2009 which2.sh
$</code></pre>
<p class="calibre10">Notice that several files are related to specific applications on the system. Most applications create two startup files &mdash; one for the bash shell (using the <code class="calibre26">.sh</code> extension) and one for the c shell (using the <code class="calibre26">.csh</code> extension).</p>
<p class="calibre10">The <code class="calibre26">lang.csh</code> and <code class="calibre26">lang.sh</code> files attempt to determine the default language character set used on the system and set the <code class="calibre26">LANG</code> environment variable appropriately.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Viewing the $HOME startup files</h4>
<p class="calibre10">The remaining startup files are all used for the same function &mdash; to provide a user-specific startup file for defining user-specific environment variables. Most Linux distributions use only one or two of these four startup files:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">$HOME/.bash_profile</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bashrc</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bash_login</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.profile</code></li>
</ul>
<p class="calibre10"><span type="pagebreak" title="155" id="calibre_link-496" class="calibre11"></span>Notice that all four files start with a dot, making them hidden files (they don't appear in a normal <code class="calibre26">ls</code> command listing). Because they are in the user's <code class="calibre26">HOME</code> directory, each user can edit the files and add his or her own environment variables that are active for every bash shell session they start.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Environment files are one area where Linux distributions vary greatly. Not every <code class="calibre26">$HOME</code> file listed in this section exists for every user. For example, some users may have only the <code class="calibre26">$HOME/.bash_profile</code> file. This is normal.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The first file found in the following ordered list is run, and the rest are ignored:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$HOME/.bash_profile</code>
<code class="calibre26">$HOME/.bash_login</code>
<code class="calibre26">$HOME/.profile</code></code></pre>
<p class="calibre10">Notice that <code class="calibre26">$HOME/.bashrc</code> is not in this list. This is because it is typically run from one of the other files.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Remember that <code class="calibre26">$HOME</code> represents a user's home directory. Also, the tilde (<code class="calibre26">â¼</code>) is used to represent a user's home directory.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">This CentOS Linux system contains the following <code class="calibre26">.bash_profile</code> file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat $HOME/.bash_profile</b></code>
# .bash_profile
# Get the aliases and functions
if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi
# User specific environment and startup programs
PATH=$PATH:$HOME/bin
export PATH
$</code></pre>
<p class="calibre10">The <code class="calibre26">.bash_profile</code> startup file first checks to see if the startup file, <code class="calibre26">.bashrc</code>, is present in the <code class="calibre26">HOME</code> directory. If it's there, the startup file executes the commands in it.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Understanding the interactive shell process</h3>
<p class="calibre10"><span type="pagebreak" title="156" id="calibre_link-497" class="calibre11"></span>If you start a bash shell without logging into a system (if you just type <code class="calibre26">bash</code> at a CLI prompt, for example), you start what's called an <i class="calibre12">interactive shell</i>. The interactive shell doesn't act like the login shell, but it still provides a CLI prompt for you to enter commands.</p>
<p class="calibre10">If bash is started as an interactive shell, it doesn't process the <code class="calibre26">/etc/profile</code> file. Instead, it only checks for the <code class="calibre26">.bashrc</code> file in the user's <code class="calibre26">HOME</code> directory.</p>
<p class="calibre10">On this Linux CentOS distribution, this file looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat .bashrc</b></code>
# .bashrc
# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi
# User specific aliases and functions
$</code></pre>
<p class="calibre10">The <code class="calibre26">.bashrc</code> file does two things. First, it checks for a common <code class="calibre26">bashrc</code> file in the <code class="calibre26">/etc</code> directory. Second, it provides a place for the user to enter personal command aliases (discussed in Chapter 5) and private script functions (described in Chapter 17).</p>
</section>
<section class="toclist">
<h3 class="calibre15">Understanding the non-interactive shell process</h3>
<p class="calibre10">The last type of shell is a non-interactive subshell. This is the shell where the system can start to execute a shell script. This is different in that there isn't a CLI prompt to worry about. However, you may want to run specific startup commands each time you start a script on your system.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Scripts can be executed in different ways. Only some execution methods start a subshell. You learn about the different shell execution methods in Chapter 11.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To accommodate that situation, the bash shell provides the <code class="calibre26">BASH_ENV</code> environment variable. When the shell starts a non-interactive subshell process, it checks this environment variable for the startup file name to execute. If one is present, the shell executes the file's commands, which typically include variables set for the shell scripts.</p>
<p class="calibre10">On this CentOS Linux distribution, this environment value is not set by default. When a variable is not set, the <code class="calibre26">printenv</code> command simply returns the CLI prompt:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">printenv BASH_ENV</b></code>
$</code></pre>
<p class="calibre10">On this Ubuntu distribution, the <code class="calibre26">BASH_ENV</code> variable isn't set either. Remember that, when a variable is not set, the <code class="calibre26">echo</code> command displays a blank line and returns the CLI prompt:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $BASH_ENV</b></code>
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="157" id="calibre_link-498" class="calibre11"></span>So if the <code class="calibre26">BASH_ENV</code> variable isn't set, how do the shell scripts get their environment variables? Remember that some shell script execution methods start a subshell, also called a child shell (see Chapter 5). A child shell inherits its parent shell's exported variables.</p>
<p class="calibre10">For example, if the parent shell was a login shell and had variables set and exported in the <code class="calibre26">/etc/profile </code>file, <code class="calibre26">/etc/profile.d/*.sh </code>files, and the <code class="calibre26">$HOME/.bashrc</code> file, the child shell for the script inherits these variables.</p>
<p class="calibre10">However, remember that any variables set but not exported by the parent shell are local variables. Local variables are not inherited by a subshell.</p>
<p class="calibre10">For scripts that do not start a subshell, the variables are already available in the current shell. Thus, even if <code class="calibre26">BASH_ENV</code> is not set, both the current shell's local and global variables are present to be used.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Making environment variables persistent</h3>
<p class="calibre10">Now that you know you way around the various shell process types and their various environment files, locating the permanent environment variables is much easier. You can also set your own permanent global or local variables using these files.</p>
<p class="calibre10">For global environment variables (those variables needed by all the users on a Linux system), it may be tempting to put new or modified variable settings in the <code class="calibre26">/etc/profile</code>, but this is a bad idea. The file could be changed when your distribution is upgraded, and you would lose all the customized variable settings.</p>
<p class="calibre10">It is a better idea to create a file ending with <code class="calibre26">.sh</code> in the <code class="calibre26">/etc/profile.d</code> directory. In that file, place all your new or modified global environment variable settings.</p>
<p class="calibre10">On most distributions, the best place to store an individual user's persistent bash shell variables is in the <code class="calibre26">$HOME/.bashrc</code> file. This is true for all shell process types. However, if the <code class="calibre26">BASH_ENV</code> variable is set, keep in mind that unless it points to <code class="calibre26">$HOME/.bashrc</code>, you may need to store a user's variables for non-interactive shell types elsewhere.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Keep in mind that user environment variables for graphical interface elements, such as the GUI client, may need to be set in different configuration files than where bash shell environment variables are set</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Recall back in Chapter 5 that command <code class="calibre26">alias</code> settings are also not persistent. You can also store your personal <code class="calibre26">alias</code> settings in the <code class="calibre26">$HOME/.bashrc</code> startup file to make them permanent.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-163" class="calibre4"></a>Learning about Variable Arrays</h2>
<p class="calibre10"><span type="pagebreak" title="158" id="calibre_link-499" class="calibre11"></span>A really cool feature of environment variables is that they can be used as <i class="calibre12">arrays</i>. An array is a variable that can hold multiple values. Values can be referenced either individually or as a whole for the entire array.</p>
<p class="calibre10">To set multiple values for an environment variable, just list them in parentheses, with values separated by spaces:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mytest=(one two three four five)</b></code>
$</code></pre>
<p class="calibre10">Not much excitement there. If you try to display the array as a normal environment variable, you'll be disappointed:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo $mytest</b></code>
one
$</code></pre>
<p class="calibre10">Only the first value in the array appears. To reference an individual array element, you must use a numerical index value, which represents its place in the array. The numeric value is enclosed in square brackets:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo ${mytest[2]}</b></code>
three
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Environment variable arrays start with an index value of zero. This can be confusing.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To display an entire array variable, you use the asterisk wildcard character as the index value:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo ${mytest[*]}</b></code>
one two three four five
$</code></pre>
<p class="calibre10">You can also change the value of an individual index position:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mytest[2]=seven</b></code>
$
$ echo ${mytest[*]}
one two seven four five
$</code></pre>
<p class="calibre10">You can even use the <code class="calibre26">unset</code> command to remove an individual value within the array, but be careful, because this gets tricky. Watch this example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">unset mytest[2]</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo ${mytest[*]}</b></code>
one two four five
$
$ <code class="calibre26"><b class="calibre21">echo ${mytest[2]}</b></code>
$ <code class="calibre26"><b class="calibre21">echo ${mytest[3]}</b></code>
four
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="159" id="calibre_link-500" class="calibre11"></span>This example uses the <code class="calibre26">unset</code> command to remove the value at index value 2. When you display the array, it appears that the other index values just dropped down one. However, if you specifically display the data at index value 2, you see that that location is empty.</p>
<p class="calibre10">Finally, you can remove the entire array just by using the array name in the <code class="calibre26">unset</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">unset mytest</b></code>
$
$ <code class="calibre26"><b class="calibre21">echo ${mytest[*]}</b></code>
$</code></pre>
<p class="calibre10">Sometimes variable arrays just complicate matters, so they're often not used in shell script programming. They're not very portable to other shell environments, which is a downside if you do lots of shell programming for different shells. Some bash system environment variables use arrays (such as <code class="calibre26">BASH_VERSINFO</code>), but overall you probably won't run into them very often.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-164" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter examined the world of Linux environment variables. Global environment variables can be accessed from any child shell spawned by the parent shell in which they're defined. Local environment variables can be accessed only from the process in which they're defined.</p>
<p class="calibre10">The Linux system uses both global and local environment variables to store information about the system environment. You can access this information from the shell command line interface, as well as within shell scripts. The bash shell uses the system environment variables defined in the original Unix Bourne shell, as well as lots of new environment variables. The <code class="calibre26">PATH</code> environment variable defines the search pattern the bash shell takes to find an executable command. You can modify the <code class="calibre26">PATH</code> environment variable to add your own directories, or even the current directory symbol, to make running your programs easier.</p>
<p class="calibre10"><span type="pagebreak" title="160" id="calibre_link-501" class="calibre11"></span>You can also create your own global and local environment variables for your own use. After you create an environment variable, it's accessible for the entire duration of your shell session.</p>
<p class="calibre10">The bash shell executes several startup files when it starts up. These startup files can contain environment variable definitions to set standard environment variables for each bash session. When you log in to the Linux system, the bash shell accesses the <code class="calibre26">/etc/profile</code> startup file and three local startup files for each user, <code class="calibre26">$HOME/.bash_profile</code>, <code class="calibre26">$HOME/.bash_login</code>, and <code class="calibre26">$HOME/.profile</code>. Users can customize these files to include environment variables and startup scripts for their own use.</p>
<p class="calibre10">Finally, this chapter discussed the use of environment variable arrays. These environment variables can contain multiple values in a single variable. You can access the values either individually by referencing an index value or as a whole by referencing the entire environment variable array name.</p>
<p class="calibre10">The next chapter dives into the world of Linux file permissions. This is possibly the most difficult topic for novice Linux users. However, to write good shell scripts, you need to understand how file permissions work and be able to use them on your Linux system.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1219">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-165" class="calibre4"></a><span class="chaptertitle">Chapter 7</span><br class="calibre22" /><span class="chaptertitle">Understanding Linux File Permissions</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Understanding Linux security</li>
<li class="calibre7">Decoding the permissions</li>
<li class="calibre7">Working with Linux groups</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="161" id="calibre_link-502" class="calibre11"></span>No system is complete without some form of security. There must be a mechanism available to protect files from unauthorized viewing or modification. The Linux system follows the Unix method of file permissions, allowing individual users and groups access to files based on a set of security settings for each file and directory. This chapter discusses how to use the Linux file security system to protect data when necessary and share data when desired.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-166" class="calibre4"></a>Linux Security</h2>
<p class="calibre10">The core of the Linux security system is the <i class="calibre12">user account</i>. Each individual who accesses a Linux system should have a unique user account assigned. The users' permissions to objects on the system depend on the user account they log in with.</p>
<p class="calibre10">User permissions are tracked using a <i class="calibre12">user ID</i> (often called a UID), which is assigned to an account when it's created. The UID is a numerical value, unique for each user. However, you don't log in to a Linux system using your UID. Instead, you use a <i class="calibre12">login name</i>. The login name is an alphanumeric text string of eight characters or fewer that the user uses to log in to the system (along with an associated password).</p>
<p class="calibre10">The Linux system uses special files and utilities to track and manage user accounts on the system. Before we can discuss file permissions, we need to discuss how Linux handles user accounts. This section describes the files and utilities required for user accounts so that you can understand how to use them when working with file permissions.</p>
<section class="toclist">
<h3 class="calibre15">The /etc/passwd file</h3>
<p class="calibre10"><span type="pagebreak" title="162" id="calibre_link-503" class="calibre11"></span>The Linux system uses a special file to match the login name to a corresponding UID value. This file is the <code class="calibre26">/etc/passwd</code> file. The <code class="calibre26">/etc/passwd</code> file contains several pieces of information about the user. Here's what a typical <code class="calibre26">/etc/passwd</code> file looks like on a Linux system:</p>
<pre class="calibre29"><code class="calibre26"> $ cat /etc/passwd
 root:x:0:0:root:/root:/bin/bash
 bin:x:1:1:bin:/bin:/sbin/nologin
 daemon:x:2:2:daemon:/sbin:/sbin/nologin
 adm:x:3:4:adm:/var/adm:/sbin/nologin
 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
 sync:x:5:0:sync:/sbin:/bin/sync
 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
 halt:x:7:0:halt:/sbin:/sbin/halt
 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
 news:x:9:13:news:/etc/news:
 uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
 operator:x:11:0:operator:/root:/sbin/nologin
 games:x:12:100:games:/usr/games:/sbin/nologin
 gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
 ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
 nobody:x:99:99:Nobody:/:/sbin/nologin
 rpm:x:37:37::/var/lib/rpm:/sbin/nologin
 vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin
 mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin
 smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin
 apache:x:48:48:Apache:/var/www:/sbin/nologin
 rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
 ntp:x:38:38::/etc/ntp:/sbin/nologin
 nscd:x:28:28:NSCD Daemon:/:/sbin/nologin
 tcpdump:x:72:72::/:/sbin/nologin
 dbus:x:81:81:System message bus:/:/sbin/nologin
 avahi:x:70:70:Avahi daemon:/:/sbin/nologin
 hsqldb:x:96:96::/var/lib/hsqldb:/sbin/nologin
 sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
 rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin
 nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin
 haldaemon:x:68:68:HAL daemon:/:/sbin/nologin
 xfs:x:43:43:X Font Server:/etc/X11/fs:/sbin/nologin
 gdm:x:42:42::/var/gdm:/sbin/nologin
 rich:x:500:500:Rich Blum:/home/rich:/bin/bash
 mama:x:501:501:Mama:/home/mama:/bin/bash
 katie:x:502:502:katie:/home/katie:/bin/bash
 jessica:x:503:503:Jessica:/home/jessica:/bin/bash
 mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="163" id="calibre_link-504" class="calibre11"></span>The <code class="calibre26">root</code> user account is the administrator for the Linux system and is always assigned UID 0. As you can see, the Linux system creates lots of user accounts for various functions that aren't actual users. These are called <i class="calibre12">system accounts</i>. A system account is a special account that services running on the system use to gain access to resources on the system. All services that run in background mode need to be logged in to the Linux system under a system user account.</p>
<p class="calibre10">Before security became a big issue, these services often just logged in using the <code class="calibre26">root</code> user account. Unfortunately, if an unauthorized person broke into one of these services, he instantly gained access to the system as the <code class="calibre26">root</code> user. To prevent this, now just about every service that runs in background on a Linux server has its own user account to log in with. This way, if a troublemaker compromises a service, he still can't necessarily get access to the whole system.</p>
<p class="calibre10">Linux reserves UIDs below 500 for system accounts. Some services even require specific UIDs to work properly. When you create accounts for normal users, most Linux systems assign the first available UID starting at 500 (although this is not necessarily true for all Linux distributions).</p>
<p class="calibre10">You probably noticed that the <code class="calibre26">/etc/passwd</code> file contains much more than just the login name and UID for the user. The fields of the <code class="calibre26">/etc/passwd</code> file contain the following information:</p>
<ul class="calibre14">
<li class="calibre7">The login username</li>
<li class="calibre7">The password for the user</li>
<li class="calibre7">The numerical UID of the user account</li>
<li class="calibre7">The numerical group ID (GID) of the user account</li>
<li class="calibre7">A text description of the user account (called the comment field)</li>
<li class="calibre7">The location of the <code class="calibre26">HOME</code> directory for the user</li>
<li class="calibre7">The default shell for the user</li>
</ul>
<p class="calibre10">The password field in the <code class="calibre26">/etc/passwd</code> file is set to an <code class="calibre26"><i class="calibre12">x</i></code>. This doesn't mean that all the user accounts have the same password. In the old days of Linux, the <code class="calibre26">/etc/passwd</code> file contained an encrypted version of the user's password. However, because lots of programs need to access the <code class="calibre26">/etc/passwd</code> file for user information, this became a security problem. With the advent of software that could easily decrypt encrypted passwords, the bad guys had a field day trying to break user passwords stored in the <code class="calibre26">/etc/passwd</code> file. Linux developers needed to rethink that policy.</p>
<p class="calibre10">Now, most Linux systems hold user passwords in a separate file (called the <i class="calibre12">shadow</i> file, located at <code class="calibre26">/etc/shadow</code>). Only special programs (such as the login program) are allowed access to this file.</p>
<p class="calibre10"><span type="pagebreak" title="164" id="calibre_link-505" class="calibre11"></span>The <code class="calibre26">/etc/passwd</code> file is a standard text file. You can use any text editor to manually perform user management functions (such as adding, modifying, or removing user accounts) directly in the <code class="calibre26">/etc/passwd</code> file. However, this is an extremely dangerous practice. If the <code class="calibre26">/etc/passwd</code> file becomes corrupt, the system can't read it, and it prevents anyone (even the root user) from logging in. Instead, it's safer to use the standard Linux user management utilities to perform all user management functions.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The /etc/shadow file</h3>
<p class="calibre10">The <code class="calibre26">/etc/shadow</code> file provides more control over how the Linux system manages passwords. Only the root user has access to the <code class="calibre26">/etc/shadow</code> file, making it more secure than the <code class="calibre26">/etc/passwd</code> file.</p>
<p class="calibre10">The <code class="calibre26">/etc/shadow</code> file contains one record for each user account on the system. A record looks like this:</p>
<pre class="calibre29"><code class="calibre26"> rich:$1$.FfcK0ns$f1UgiyHQ25wrB/hykCn020:11627:0:99999:7:::</code></pre>
<p class="calibre10">There are nine fields in each <code class="calibre26">/etc/shadow</code> file record:</p>
<ul class="calibre14">
<li class="calibre7">The login name corresponding to the login name in the <code class="calibre26">/etc/passwd</code> file</li>
<li class="calibre7">The encrypted password</li>
<li class="calibre7">The number of days since January 1, 1970, that the password was last changed</li>
<li class="calibre7">The minimum number of days before the password can be changed</li>
<li class="calibre7">The number of days before the password must be changed</li>
<li class="calibre7">The number of days before password expiration that the user is warned to change the password</li>
<li class="calibre7">The number of days after a password expires before the account will be disabled</li>
<li class="calibre7">The date (stored as the number of days since January 1, 1970) since the user account was disabled</li>
<li class="calibre7">A field reserved for future use</li>
</ul>
<p class="calibre10">Using the shadow password system, the Linux system has much finer control over user passwords. It can control how often a user must change his or her password and when to disable the account if the password hasn't been changed.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Adding a new user</h3>
<p class="calibre10">The primary tool used to add new users to your Linux system is <code class="calibre26">useradd</code>. This command provides an easy way to create a new user account and set up the user's <code class="calibre26">HOME</code> directory structure all at once. The <code class="calibre26">useradd</code> command uses a combination of system default values and command line parameters to define a user account. The system defaults are set in the <code class="calibre26">/etc/default/useradd </code>file. To see the system default values used on your Linux distribution, enter the <code class="calibre26">useradd</code> command with the <code class="calibre26">-D</code> parameter:</p>
<pre class="calibre29"><code class="calibre26"> # /usr/sbin/useradd -D
 GROUP=100
 HOME=/home
 INACTIVE=-1
 EXPIRE=
 SHELL=/bin/bash
 SKEL=/etc/skel
 CREATE_MAIL_SPOOL=yes
 #</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Some Linux distributions place the Linux user and group utilities in the <code class="calibre26">/usr/sbin</code> directory, which may not be in your <code class="calibre26">PATH</code> environment variable. If that's the case in your Linux distribution, either add the directory to your <code class="calibre26"><b class="calibre21">PATH</b></code> or use the absolute file path to run it.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="165" id="calibre_link-506" class="calibre11"></span>The <code class="calibre26">-D</code> parameter shows what defaults the <code class="calibre26">useradd</code> command uses if you don't specify them in the command line when creating a new user account. This example shows the following default values:</p>
<ul class="calibre14">
<li class="calibre7">The new user is added to a common group with group ID 100.</li>
<li class="calibre7">The new user has a <code class="calibre26">HOME</code> account created in the directory <code class="calibre26">/home/</code><code class="calibre26"><i class="calibre12">loginname</i></code>.</li>
<li class="calibre7">The account can't be disabled when the password expires.</li>
<li class="calibre7">The new account can't be set to expire at a set date.</li>
<li class="calibre7">The new account uses the bash shell as the default shell.</li>
<li class="calibre7">The system copies the contents of the <code class="calibre26">/etc/skel</code> directory to the user's <code class="calibre26">HOME</code> directory.</li>
<li class="calibre7">The system creates a file in the mail directory for the user account to receive mail.</li>
</ul>
<p class="calibre10">The penultimate value is interesting. The <code class="calibre26">useradd</code> command allows an administrator to create a default <code class="calibre26">HOME</code> directory configuration and then uses that as a template to create the new user's <code class="calibre26">HOME</code> directory. This allows you to place default files for the system in every new user's <code class="calibre26">HOME</code> directory automatically. In the Ubuntu Linux system, the <code class="calibre26">/etc/skel</code> directory has the following files:</p>
<pre class="calibre29"><code class="calibre26">$ ls -al /etc/skel
total 32
drwxr-xr-x   2 root root  4096 2010-04-29 08:26 .
drwxr-xr-x 135 root root 12288 2010-09-23 18:49 ..
-rw-r--r--   1 root root   220 2010-04-18 21:51 .bash_logout
-rw-r--r--   1 root root  3103 2010-04-18 21:51 .bashrc
-rw-r--r--   1 root root   179 2010-03-26 08:31 examples.desktop
-rw-r--r--   1 root root   675 2010-04-18 21:51 .profile
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="166" id="calibre_link-507" class="calibre11"></span>You should recognize these files from Chapter 6. These are the standard startup files for the bash shell environment. The system automatically copies these default files into every user's <code class="calibre26">HOME</code> directory you create.</p>
<p class="calibre10">You can test this by creating a new user account using the default system parameters and then looking at the <code class="calibre26">HOME</code> directory for the new user:</p>
<pre class="calibre29"><code class="calibre26"># useradd -m test
# ls -al /home/test
total 24
drwxr-xr-x 2 test test 4096 2010-09-23 19:01 .
drwxr-xr-x 4 root root 4096 2010-09-23 19:01 ..
-rw-r--r-- 1 test test  220 2010-04-18 21:51 .bash_logout
-rw-r--r-- 1 test test 3103 2010-04-18 21:51 .bashrc
-rw-r--r-- 1 test test  179 2010-03-26 08:31 examples.desktop
-rw-r--r-- 1 test test  675 2010-04-18 21:51 .profile
#</code></pre>
<p class="calibre10">By default, the <code class="calibre26">useradd</code> command doesn't create a <code class="calibre26">HOME</code> directory, but the <code class="calibre26">&ndash;m</code> command line option tells it to create the <code class="calibre26">HOME</code> directory. As you can see in the example, the <code class="calibre26">useradd</code> command created the new <code class="calibre26">HOME</code> directory, using the files contained in the <code class="calibre26">/etc/skel</code> directory.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">To run the user account administration commands in this chapter, you either need to be logged in as the special root user account or use the <code class="calibre26">sudo</code> command to run the commands as the root user account.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">If you want to override a default value or behavior when creating a new user, you can do that with command line parameters. These are shown in <a id="calibre_link-1220" href="#calibre_link-1119" class="calibre4">Table 7.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1119" href="#calibre_link-1220" class="calibre4"><b class="calibre21">Table 7.1</b></a></span> The useradd Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code> <code class="calibre26"><i class="calibre12">comment</i></code></td>
<td class="left">Adds text to the new user's comment field</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code> <code class="calibre26"><i class="calibre12">home_dir</i></code></td>
<td class="left">Specifies a different name for the <code class="calibre26">HOME</code> directory other than the login name</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code> <code class="calibre26"><i class="calibre12">expire_date</i></code></td>
<td class="left">Specifies a date, in YYYY-MM-DD format, when the account will expire</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code> <code class="calibre26"><i class="calibre12">inactive_days</i></code></td>
<td class="left">Specifies the number of days after a password expires when the account will be disabled. A value of <code class="calibre26">0</code> disables the account as soon as the password expires; a value of <code class="calibre26">-1</code> disables this feature.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-g</code> <code class="calibre26"><i class="calibre12">initial_group</i></code></td>
<td class="left">Specifies the group name or GID of the user's login group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-G</code> <code class="calibre26"><i class="calibre12">group . . .</i></code></td>
<td class="left">Specifies one or more supplementary groups the user belongs to</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-k</code></td>
<td class="left">Copies the <code class="calibre26">/etc/skel</code> directory contents into the user's <code class="calibre26">HOME</code> directory (must use <code class="calibre26">-m</code> as well)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-m</code></td>
<td class="left">Creates the user's <code class="calibre26">HOME</code> directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-M</code></td>
<td class="left">Doesn't create a user's <code class="calibre26">HOME</code> directory (used if the default setting is to create one)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Creates a new group using the same name as the user's login name</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">Creates a system account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code> <code class="calibre26"><i class="calibre12">passwd</i></code></td>
<td class="left">Specifies a default password for the user account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code> <code class="calibre26"><i class="calibre12">shell</i></code></td>
<td class="left">Specifies the default login shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-u</code> <code class="calibre26"><i class="calibre12">uid</i></code></td>
<td class="left">Specifies a unique UID for the account</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="167" id="calibre_link-508" class="calibre11"></span>As you can see, you can override all the system default values when creating a new user account just by using command line parameters. However, if you find yourself having to override a value all the time, it's easier to just change the system default value.</p>
<p class="calibre10">You can change the system default new user values by using the <code class="calibre26">-D</code> parameter, along with a parameter representing the value you need to change. These parameters are shown in <a id="calibre_link-1221" href="#calibre_link-1120" class="calibre4">Table 7.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1120" href="#calibre_link-1221" class="calibre4"><b class="calibre21">Table 7.2</b></a></span> The useradd Change Default Values Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-b</code> <code class="calibre26"><i class="calibre12">default_home</i></code></td>
<td class="left">Changes the location where users' <code class="calibre26">HOME</code> directories are created</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code> <code class="calibre26"><i class="calibre12">expiration_date</i></code></td>
<td class="left">Changes the expiration date on new accounts</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code> <code class="calibre26"><i class="calibre12">inactive</i></code></td>
<td class="left">Changes the number of days after a password has expired before the account is disabled</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-g</code> <code class="calibre26"><i class="calibre12">group</i></code></td>
<td class="left">Changes the default group name or GID used</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code> <code class="calibre26"><i class="calibre12">shell</i></code></td>
<td class="left">Changes the default login shell</td>
</tr>
</table>
</figure>
<p class="calibre10">Changing the default values is a snap:</p>
<pre class="calibre29"><code class="calibre26"> # useradd -D -s /bin/tsch
 # useradd -D
 GROUP=100
 HOME=/home
 INACTIVE=-1
 EXPIRE=
 SHELL=/bin/tsch
 SKEL=/etc/skel
 CREATE_MAIL_SPOOL=yes
 #</code></pre>
<p class="calibre10">Now, the <code class="calibre26">useradd</code> command uses the <code class="calibre26">tsch</code> shell as the default login shell for all new user accounts you create.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Removing a user</h3>
<p class="calibre10"><span type="pagebreak" title="168" id="calibre_link-509" class="calibre11"></span>If you want to remove a user from the system, the <code class="calibre26">userdel</code> command is what you need. By default, the <code class="calibre26">userdel</code> command removes only the user information from the <code class="calibre26">/etc/passwd</code> file. It doesn't remove any files the account owns on the system.</p>
<p class="calibre10">If you use the <code class="calibre26">-r</code> parameter, <code class="calibre26">userdel</code> removes the user's <code class="calibre26">HOME</code> directory, along with the user's mail directory. However, other files owned by the deleted user account may still be on the system. This can be a problem in some environments.</p>
<p class="calibre10">Here's an example of using the <code class="calibre26">userdel</code> command to remove an existing user account:</p>
<pre class="calibre29"><code class="calibre26"> # /usr/sbin/userdel -r test
 # ls -al /home/test
 ls: cannot access /home/test: No such file or directory
 #</code></pre>
<p class="calibre10">After using the <code class="calibre26">-r</code> parameter, the user's old <code class="calibre26">/home/test</code> directory no longer exists.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Be careful when using the <code class="calibre26">-r</code> parameter in an environment with lots of users. You never know if a user had important files stored in his or her <code class="calibre26">HOME</code> directory that are used by someone else or another program. Always check before removing a user's <code class="calibre26">HOME</code> directory!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Modifying a user</h3>
<p class="calibre10">Linux provides a few different utilities for modifying the information for existing user accounts. <a id="calibre_link-1222" href="#calibre_link-1121" class="calibre4">Table 7.3</a> shows these utilities.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1121" href="#calibre_link-1222" class="calibre4"><b class="calibre21">Table 7.3</b></a></span> User Account Modification Utilities</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">usermod</code></td>
<td class="left">Edits user account fields, as well as specifying primary and secondary group membership</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">passwd</code></td>
<td class="left">Changes the password for an existing user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chpasswd</code></td>
<td class="left">Reads a file of login name and password pairs, and updates the passwords</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chage</code></td>
<td class="left">Changes the password's expiration date</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chfn</code></td>
<td class="left">Changes the user account's comment information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chsh</code></td>
<td class="left">Changes the user account's default shell</td>
</tr>
</table>
</figure>
<p class="calibre10">Each of these utilities provides a specific function for changing information about user accounts. The following sections describe each of these utilities.</p>
<section class="toclist">
<h4 class="calibre25">usermod</h4>
<p class="calibre10"><span type="pagebreak" title="169" id="calibre_link-510" class="calibre11"></span>The <code class="calibre26">usermod</code> command is the most robust of the user account modification utilities. It provides options for changing most of the fields in the <code class="calibre26">/etc/passwd</code> file. To do that, you just need to use the command line parameter that corresponds to the value you want to change. The parameters are mostly the same as the <code class="calibre26">useradd</code> parameters (such as <code class="calibre26">-c</code> to change the comment field, <code class="calibre26">-e</code> to change the expiration date, and <code class="calibre26">-g</code> to change the default login group). However, a couple of additional parameters might come in handy:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">-l</code> changes the login name of the user account.</li>
<li class="calibre7"><code class="calibre26">-L</code> locks the account so the user can't log in.</li>
<li class="calibre7"><code class="calibre26">-p</code> changes the password for the account.</li>
<li class="calibre7"><code class="calibre26">-U</code> unlocks the account so the user can log in.</li>
</ul>
<p class="calibre10">The <code class="calibre26">-L</code> parameter is especially handy. Use this to lock an account so a user can't log in without having to remove the account and the user's data. To return the account to normal, just use the <code class="calibre26">-U</code> parameter.</p>
</section>
<section class="toclist">
<h4 class="calibre25">passwd and chpasswd</h4>
<p class="calibre10">A quick way to change just the password for a user is the <code class="calibre26">passwd</code> command:</p>
<pre class="calibre29"><code class="calibre26"> # passwd test
 Changing password for user test.
 New UNIX password:
 Retype new UNIX password:
 passwd: all authentication tokens updated successfully.
 #</code></pre>
<p class="calibre10"><span type="pagebreak" title="170" id="calibre_link-511" class="calibre11"></span>If you just use the <code class="calibre26">passwd</code> command by itself, it changes your own password. Any user in the system can change his or her own password, but only the root user can change someone else's password.</p>
<p class="calibre10">The <code class="calibre26">-e</code> option is a handy way to force a user to change the password on the next log in. This allows you to set the user's password to a simple value and forces them to change it to something harder that they can remember.</p>
<p class="calibre10">If you ever need to do a mass password change for lots of users on the system, the <code class="calibre26">chpasswd</code> command can be a lifesaver. The <code class="calibre26">chpasswd</code> command reads a list of login name and password pairs (separated by a colon) from the standard input, automatically encrypts the password, and sets it for the user account. You can also use the redirection command to redirect a file of <code class="calibre26"><i class="calibre12">userid:password</i></code> pairs into the command:</p>
<pre class="calibre29"><code class="calibre26"># chpasswd &lt; users.txt
#</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">chsh, chfn, and chage</h4>
<p class="calibre10">The <code class="calibre26">chsh</code>, <code class="calibre26">chfn</code>, and <code class="calibre26">chage</code> utilities are specialized for specific account modification functions. The <code class="calibre26">chsh</code> command allows you to quickly change the default login shell for a user. You must use the full pathname for the shell, and not just the shell name:</p>
<pre class="calibre29"><code class="calibre26"> #  chsh -s /bin/csh test
 Changing shell for test.
 Shell changed.
 #</code></pre>
<p class="calibre10">The <code class="calibre26">chfn</code> command provides a standard method for storing information in the comments field in the <code class="calibre26">/etc/passwd</code> file. Instead of just inserting random text, such as names or nicknames, or even just leaving the comment field blank, the <code class="calibre26">chfn</code> command uses specific information used in the Unix <code class="calibre26">finger</code> command to store information in the comment field. The <code class="calibre26">finger</code> command allows you to easily find information about people on your Linux system:</p>
<pre class="calibre29"><code class="calibre26"> # finger rich
 Login: rich                             Name: Rich Blum
 Directory: /home/rich                   Shell: /bin/bash
 On since Thu Sep 20 18:03 (EDT) on pts/0 from 192.168.1.2
 No mail.
 No Plan.
 #</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Because of security concerns, many Linux system administrators disable the <code class="calibre26">finger</code> command on their systems, and many Linux distributions don't even install it by default.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="171" id="calibre_link-512" class="calibre11"></span>If you use the <code class="calibre26">chfn</code> command with no parameters, it queries you for the appropriate values to enter in to the comment field:</p>
<pre class="calibre29"><code class="calibre26"> # chfn test
 Changing finger information for test.
 Name []: Ima Test
 Office []: Director of Technology
 Office Phone []: (123)555-1234
 Home Phone []: (123)555-9876
 
 Finger information changed.
 # finger test
 Login: test                             Name: Ima Test
 Directory: /home/test                   Shell: /bin/csh
 Office: Director of Technology          Office Phone: (123)555-1234
 Home Phone: (123)555-9876
 Never logged in.
 No mail.
 No Plan.
 #</code></pre>
<p class="calibre10">If you now look at the entry in the <code class="calibre26">/etc/passwd</code> file, it looks like this:</p>
<pre class="calibre29"><code class="calibre26"> # grep test /etc/passwd
 test:x:504:504:Ima Test,Director of Technology,(123)555-
 1234,(123)555-9876:/home/test:/bin/csh
 #</code></pre>
<p class="calibre10">All the finger information is neatly stored away in the <code class="calibre26">/etc/passwd</code> file entry.</p>
<p class="calibre10">Finally, the <code class="calibre26">chage</code> command helps you manage the password aging process for user accounts. You need to set several parameters to individual values, shown in <a id="calibre_link-1223" href="#calibre_link-1122" class="calibre4">Table 7.4</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1122" href="#calibre_link-1223" class="calibre4"><b class="calibre21">Table 7.4</b></a></span> The chage Command Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code></td>
<td class="left">Sets the number of days since the password was last changed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-E</code></td>
<td class="left">Sets the date the password expires</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-I</code></td>
<td class="left">Sets the number of days of inactivity after the password expires to lock the account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-m</code></td>
<td class="left">Sets the minimum number of days between password changes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-W</code></td>
<td class="left">Sets the number of days before the password expires that a warning message appears</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="172" id="calibre_link-513" class="calibre11"></span>The <code class="calibre26">chage</code> date values can be expressed using one of two methods:</p>
<ul class="calibre14">
<li class="calibre7">A date in YYYY-MM-DD format</li>
<li class="calibre7">A numerical value representing the number of days since January 1, 1970</li>
</ul>
<p class="calibre10">One neat feature of the <code class="calibre26">chage</code> command is that it allows you to set an expiration date for an account. Using this feature, you can create temporary user accounts that automatically expire on a set date, without your having to remember to delete them! Expired accounts are similar to locked accounts. The account still exists, but the user can't log in with it.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-167" class="calibre4"></a>Using Linux Groups</h2>
<p class="calibre10">User accounts are great for controlling security for individual users, but they aren't so good at allowing groups of users to share resources. To accomplish this, the Linux system uses another security concept, called <i class="calibre12">groups</i>.</p>
<p class="calibre10">Group permissions allow multiple users to share a common set of permissions for an object on the system, such as a file, directory, or device (more on that later in the âDecoding File Permissionsâ section).</p>
<p class="calibre10">Linux distributions differ somewhat on how they handle default group memberships. Some Linux distributions create just one group that contains all the user accounts as members. You need to be careful if your Linux distribution does this, because your files may be readable by all other users on the system. Other distributions create a separate group account for each user to provide a little more security.</p>
<p class="calibre10">Each group has a unique GID, which, like UIDs, is a unique numerical value on the system. Along with the GID, each group has a unique group name. You can use some group utilities to create and manage your own groups on the Linux system. This section discusses how group information is stored and how to use the group utilities to create new groups and modify existing groups.</p>
<section class="toclist">
<h3 class="calibre15">The /etc/group file</h3>
<p class="calibre10"><span type="pagebreak" title="173" id="calibre_link-514" class="calibre11"></span>Just like user accounts, group information is stored in a file on the system. The <code class="calibre26">/etc/group</code> file contains information about each group used on the system. These are examples from a typical <code class="calibre26">/etc/group</code> file on a Linux system:</p>
<pre class="calibre29"><code class="calibre26"> root:x:0:root
 bin:x:1:root,bin,daemon
 daemon:x:2:root,bin,daemon
 sys:x:3:root,bin,adm
 adm:x:4:root,adm,daemon
 rich:x:500:
 mama:x:501:
 katie:x:502:
 jessica:x:503:
 mysql:x:27:
 test:x:504:</code></pre>
<p class="calibre10">Like UIDs, GIDs are assigned using a special format. Groups used for system accounts are assigned GIDs below 500, and user groups are assigned GIDs starting at 500. The <code class="calibre26">/etc/group</code> file uses four fields:</p>
<ul class="calibre14">
<li class="calibre7">The group name</li>
<li class="calibre7">The group password</li>
<li class="calibre7">The GID</li>
<li class="calibre7">The list of user accounts that belong to the group</li>
</ul>
<p class="calibre10">The group password allows a non-group member to temporarily become a member of the group by using the password. This feature is not used all that commonly, but it does exist.</p>
<p class="calibre10">You should never add users to groups by editing the <code class="calibre26">/etc/group</code> file. Instead, use the <code class="calibre26">usermod</code> command (discussed earlier in the âLinux Securityâ section) to add a user account to a group. Before you can add users to different groups, you must create the groups.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The list of user accounts is somewhat misleading. You'll notice that there are several groups in the list that don't have any users listed. This isn't because they don't have any members. When a user account uses a group as the default group in the <code class="calibre26">/etc/passwd</code> file, the user account doesn't appear in the <code class="calibre26">/etc/group</code> file as a member. This has caused confusion for more than one system administrator over the years!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Creating new groups</h3>
<p class="calibre10"><span type="pagebreak" title="174" id="calibre_link-515" class="calibre11"></span>The <code class="calibre26">groupadd</code> command allows you to create new groups on your system:</p>
<pre class="calibre29"><code class="calibre26"> # /usr/sbin/groupadd shared
 # tail /etc/group
 haldaemon:x:68:
 xfs:x:43:
 gdm:x:42:
 rich:x:500:
 mama:x:501:
 katie:x:502:
 jessica:x:503:
 mysql:x:27:
 test:x:504:
 shared:x:505:
 #</code></pre>
<p class="calibre10">When you create a new group, no users are assigned to it by default. The <code class="calibre26">groupadd</code> command doesn't provide an option for adding user accounts to the group. Instead, to add new users, use the <code class="calibre26">usermod</code> command:</p>
<pre class="calibre29"><code class="calibre26"> # /usr/sbin/usermod -G shared rich
 # /usr/sbin/usermod -G shared test
 # tail /etc/group
 haldaemon:x:68:
 xfs:x:43:
 gdm:x:42:
 rich:x:500:
 mama:x:501:
 katie:x:502:
 jessica:x:503:
 mysql:x:27:
 test:x:504:
 shared:x:505:rich, test
 #</code></pre>
<p class="calibre10">The <code class="calibre26">shared</code> group now has two members, test and rich. The <code class="calibre26">-G</code> parameter in <code class="calibre26">usermod</code> appends the new group to the list of groups for the user account.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you change the user groups for an account that is currently logged into the system, the user must log out and then log back in for the group changes to take effect.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Be careful when assigning groups for user accounts. If you use the <code class="calibre26">-g</code> parameter, the group name you specify replaces the default group for the user account. The <code class="calibre26">-G</code> parameter adds the group to the list of groups the user belongs to, keeping the default group intact.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Modifying groups</h3>
<p class="calibre10"><span type="pagebreak" title="175" id="calibre_link-516" class="calibre11"></span>As you can see from the <code class="calibre26">/etc/group</code> file, you don't need to modify much information about a group. The <code class="calibre26">groupmod</code> command allows you to change the GID (using the <code class="calibre26">-g</code> parameter) or the group name (using the <code class="calibre26">-n</code> parameter) of an existing group:</p>
<pre class="calibre29"><code class="calibre26"> # /usr/sbin/groupmod -n sharing shared
 # tail /etc/group
 haldaemon:x:68:
 xfs:x:43:
 gdm:x:42:
 rich:x:500:
 mama:x:501:
 katie:x:502:
 jessica:x:503:
 mysql:x:27:
 test:x:504:
 sharing:x:505:test,rich
 #</code></pre>
<p class="calibre10">When changing the name of a group, the GID and group members remain the same, only the group name changes. Because all security permissions are based on the GID, you can change the name of a group as often as you wish without adversely affecting file security.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-168" class="calibre4"></a>Decoding File Permissions</h2>
<p class="calibre10">Now that you know about users and groups, it's time to decode the cryptic file permissions you've seen when using the <code class="calibre26">ls</code> command. This section describes how to decipher the permissions and where they come from.</p>
<section class="toclist">
<h3 class="calibre15">Using file permission symbols</h3>
<p class="calibre10"><span type="pagebreak" title="176" id="calibre_link-517" class="calibre11"></span>If you remember from Chapter 3, the <code class="calibre26">ls</code> command allows you to see the file permissions for files, directories, and devices on the Linux system:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -l
 total 68
 -rw-rw-r-- 1 rich rich   50 2010-09-13 07:49 file1.gz
 -rw-rw-r-- 1 rich rich   23 2010-09-13 07:50 file2
 -rw-rw-r-- 1 rich rich   48 2010-09-13 07:56 file3
 -rw-rw-r-- 1 rich rich   34 2010-09-13 08:59 file4
 -rwxrwxr-x 1 rich rich 4882 2010-09-18 13:58 myprog
 -rw-rw-r-- 1 rich rich  237 2010-09-18 13:58 myprog.c
 drwxrwxr-x 2 rich rich 4096 2010-09-03 15:12 test1
 drwxrwxr-x 2 rich rich 4096 2010-09-03 15:12 test2
 $</code></pre>
<p class="calibre10">The first field in the output listing is a code that describes the permissions for the files and directories. The first character in the field defines the type of the object:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">-</code> for files</li>
<li class="calibre7"><code class="calibre26">d</code> for directories</li>
<li class="calibre7"><code class="calibre26">l</code> for links</li>
<li class="calibre7"><code class="calibre26">c</code> for character devices</li>
<li class="calibre7"><code class="calibre26">b</code> for block devices</li>
<li class="calibre7"><code class="calibre26">n</code> for network devices</li>
</ul>
<p class="calibre10">After that, you see three sets of three characters. Each set of three characters defines an access permission triplet:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">r</code> for read permission for the object</li>
<li class="calibre7"><code class="calibre26">w</code> for write permission for the object</li>
<li class="calibre7"><code class="calibre26">x</code> for execute permission for the object</li>
</ul>
<p class="calibre10">If a permission is denied, a dash appears in the location. The three sets relate the three levels of security for the object:</p>
<ul class="calibre14">
<li class="calibre7">The owner of the object</li>
<li class="calibre7">The group that owns the object</li>
<li class="calibre7">Everyone else on the system</li>
</ul>
<p class="calibre10">This is broken down in <a id="calibre_link-1224" href="#calibre_link-1076" class="calibre4">Figure 7.1</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000019.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1076" href="#calibre_link-1224" class="calibre4"><b class="calibre21">Figure 7.1</b></a></span> The Linux file permissions</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="177" id="calibre_link-518" class="calibre11"></span>The easiest way to discuss this is to take an example and decode the file permissions one by one:</p>
<pre class="calibre29"><code class="calibre26"> -rwxrwxr-x 1 rich rich 4882 2010-09-18 13:58 myprog</code></pre>
<p class="calibre10">The file <code class="calibre26">myprog</code> has the following sets of permissions:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">rwx</code> for the file owner (set to the login name rich)</li>
<li class="calibre7"><code class="calibre26">rwx</code> for the file group owner (set to the group name rich)</li>
<li class="calibre7"><code class="calibre26">r-x</code> for everyone else on the system</li>
</ul>
<p class="calibre10">These permissions indicate that the user login name rich can read, write, and execute the file (considered full permissions). Likewise, members in the group rich can also read, write, and execute the file. However, anyone else not in the rich group can only read and execute the file; the <i class="calibre12">w</i> is replaced with a dash, indicating that write permissions are not assigned to this security level.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Default file permissions</h3>
<p class="calibre10">You may be wondering about where these file permissions come from. The answer is <i class="calibre12">umask</i>. The <code class="calibre26">umask</code> command sets the default permissions for any file or directory you create:</p>
<pre class="calibre29"><code class="calibre26"> $ touch newfile
 $ ls -al newfile
 -rw-r--r--    1 rich     rich            0 Sep 20 19:16 newfile
 $</code></pre>
<p class="calibre10">The <code class="calibre26">touch</code> command created the file using the default permissions assigned to my user account. The <code class="calibre26">umask</code> command shows and sets the default permissions:</p>
<pre class="calibre29"><code class="calibre26"> $ umask
 0022
 $</code></pre>
<p class="calibre10">Unfortunately, the <code class="calibre26">umask</code> command setting isn't overtly clear, and trying to understand exactly how it works makes things even muddier. The first digit represents a special security feature called the <code class="calibre26"><i class="calibre12">sticky bit</i></code>. We'll talk more about that later on in this chapter in the âSharing Filesâ section.</p>
<p class="calibre10"><span type="pagebreak" title="178" id="calibre_link-519" class="calibre11"></span>The next three digits represent the octal values of the <code class="calibre26">umask</code> for a file or directory. To understand how <code class="calibre26">umask</code> works, you first need to understand octal mode security settings.</p>
<p class="calibre10"><code class="calibre26"><i class="calibre12">Octal mode</i></code> security settings take the three <code class="calibre26">rwx</code> permission values and convert them into a 3-bit binary value, represented by a single octal value. In the binary representation, each position is a binary bit. Thus, if the read permission is the only permission set, the value becomes <code class="calibre26">r--</code>, relating to a binary value of 100, indicating the octal value of 4. <a id="calibre_link-1225" href="#calibre_link-1123" class="calibre4">Table 7.5</a> shows the possible combinations you'll run into.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1123" href="#calibre_link-1225" class="calibre4"><b class="calibre21">Table 7.5</b></a></span> Linux File Permission Codes</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Permissions</td>
<td class="left">Binary</td>
<td class="left">Octal</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">---</code></td>
<td class="left">000</td>
<td class="left">0</td>
<td class="left">No permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--x</code></td>
<td class="left">001</td>
<td class="left">1</td>
<td class="left">Execute-only permission</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-w-</code></td>
<td class="left">010</td>
<td class="left">2</td>
<td class="left">Write-only permission</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-wx</code></td>
<td class="left">011</td>
<td class="left">3</td>
<td class="left">Write and execute permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">r--</code></td>
<td class="left">100</td>
<td class="left">4</td>
<td class="left">Read-only permission</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">r-x</code></td>
<td class="left">101</td>
<td class="left">5</td>
<td class="left">Read and execute permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rw-</code></td>
<td class="left">110</td>
<td class="left">6</td>
<td class="left">Read and write permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rwx</code></td>
<td class="left">111</td>
<td class="left">7</td>
<td class="left">Read, write, and execute permissions</td>
</tr>
</table>
</figure>
<p class="calibre10">Octal mode takes the octal permissions and lists three of them in order for the three security levels (user, group, and everyone). Thus, the octal mode value 664 represents read and write permissions for the user and group, but read-only permission for everyone else.</p>
<p class="calibre10">Now that you know about octal mode permissions, the <code class="calibre26">umask</code> value becomes even more confusing. The octal mode shown for the default umask on my Linux system is 0022, but the file I created had an octal mode permission of 644. How did that happen?</p>
<p class="calibre10">The umask value is just that, a mask. It masks out the permissions you don't want to give to the security level. Now we have to dive into some octal arithmetic to figure out the rest of the story.</p>
<p class="calibre10">The umask value is subtracted from the full permission set for an object. The full permission for a file is mode 666 (read/write permission for all), but for a directory it's 777 (read/write/execute permission for all).</p>
<p class="calibre10"><span type="pagebreak" title="179" id="calibre_link-520" class="calibre11"></span>Thus, in the example, the file starts out with permissions 666, and the umask of 022 is applied, leaving a file permission of 644.</p>
<p class="calibre10">The umask value is normally set in the <code class="calibre26">/etc/profile</code> startup file in most Linux distributions (see Chapter 6), but some prefer to set it in the <code class="calibre26">/etc/login.defs</code> file (such as in Ubuntu). You can specify a different default umask setting using the <code class="calibre26">umask</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ umask 026
 $ touch newfile2
 $ ls -l newfile2
 -rw-r-----    1 rich     rich            0 Sep 20 19:46 newfile2
 $</code></pre>
<p class="calibre10">By setting the umask value to 026, the default file permissions become 640, so the new file now is restricted to read-only for the group members, and everyone else on the system has no permissions to the file.</p>
<p class="calibre10">The umask value also applies to making new directories:</p>
<pre class="calibre29"><code class="calibre26"> $ mkdir newdir
 $ ls -l
 drwxr-x--x    2 rich     rich         4096 Sep 20 20:11 newdir/
 $</code></pre>
<p class="calibre10">Because the default permissions for a directory are 777, the resulting permissions from the umask are different from those of a new file. The 026 umask value is subtracted from 777, leaving the 751 directory permission setting.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-169" class="calibre4"></a>Changing Security Settings</h2>
<p class="calibre10">If you've already created a file or directory and need to change the security settings on it, Linux has a few different utilities available for this. This section shows you how to change the existing permissions, the default owner, and the default group settings for a file or directory.</p>
<section class="toclist">
<h3 class="calibre15">Changing permissions</h3>
<p class="calibre10">The <code class="calibre26">chmod</code> command allows you to change the security settings for files and directories. The format of the <code class="calibre26">chmod</code> command is:</p>
<pre class="calibre29"><code class="calibre26"> chmod <code class="calibre26"><i class="calibre12">options mode file</i></code></code></pre>
<p class="calibre10">The <code class="calibre26">mode</code> parameter allows you to set the security settings using either octal or symbolic mode. The octal mode settings are pretty straightforward; just use the standard three-digit octal code you want the file to have:</p>
<pre class="calibre29"><code class="calibre26"> $ chmod 760 newfile
 $ ls -l newfile
 -rwxrw----    1 rich     rich            0 Sep 20 19:16 newfile
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="180" id="calibre_link-521" class="calibre11"></span>The octal file permissions are automatically applied to the file indicated. The symbolic mode permissions are not so easy to implement.</p>
<p class="calibre10">Instead of using the normal string of three sets of three characters, the <code class="calibre26">chmod</code> command takes a different approach. The following is the format for specifying a permission in symbolic mode:</p>
<pre class="calibre29"><code class="calibre26"> [ugoa...][[+-=][rwxXstugo...]</code></pre>
<p class="calibre10">Makes perfectly good sense, doesn't it? The first group of characters defines to whom the new permissions apply:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">u</code> for the user</li>
<li class="calibre7"><code class="calibre26">g</code> for the group</li>
<li class="calibre7"><code class="calibre26">o</code> for others (everyone else)</li>
<li class="calibre7"><code class="calibre26">a</code> for all of the above</li>
</ul>
<p class="calibre10">Next, a symbol is used to indicate whether you want to add the permission to the existing permissions (+), subtract the permission from the existing permission (â), or set the permissions to the value (=).</p>
<p class="calibre10">Finally, the third symbol is the permission used for the setting. You may notice that there are more than the normal <code class="calibre26">rwx</code> values here. These are the additional settings:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">X</code> assigns execute permissions only if the object is a directory or if it already had execute permissions.</li>
<li class="calibre7"><code class="calibre26">s</code> sets the UID or GID on execution.</li>
<li class="calibre7"><code class="calibre26">t</code> saves program text.</li>
<li class="calibre7"><code class="calibre26">u</code> sets the permissions to the owner's permissions.</li>
<li class="calibre7"><code class="calibre26">g</code> sets the permissions to the group's permissions.</li>
<li class="calibre7"><code class="calibre26">o</code> sets the permissions to the other's permissions.</li>
</ul>
<p class="calibre10">Using these permissions looks like this:</p>
<pre class="calibre29"><code class="calibre26"> $ chmod o+r newfile
 $ ls -lF newfile
 -rwxrw-r--    1 rich     rich            0 Sep 20 19:16 newfile*
$</code></pre>
<p class="calibre10">The <code class="calibre26">o+r</code> entry adds the read permission to whatever permissions the everyone security level already had.</p>
<pre class="calibre29"><code class="calibre26"> $ chmod u-x newfile
 $ ls -lF newfile
 -rw-rw-r--    1 rich     rich            0 Sep 20 19:16 newfile
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="181" id="calibre_link-522" class="calibre11"></span>The <code class="calibre26">u-x</code> entry removes the execute permission that the user already had. Note that the <code class="calibre26">&ndash;F</code> option for the <code class="calibre26">ls</code> command indicates whether a file has execution permissions by adding an asterisk to the filename.</p>
<p class="calibre10">The <i class="calibre12">options</i> parameters provide a few additional features to augment the behavior of the <code class="calibre26">chmod</code> command. The <code class="calibre26">-R</code> parameter performs the file and directory changes recursively. You can use wildcard characters for the filename specified, changing the permissions on multiple files with just one command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Changing ownership</h3>
<p class="calibre10">Sometimes, you need to change the owner of a file, such as when someone leaves an organization or a developer creates an application that needs to be owned by a system account when it's in production. Linux provides two commands for doing that. The <code class="calibre26">chown</code> command makes it easy to change the owner of a file, and the <code class="calibre26">chgrp</code> command allows you to change the default group of a file.</p>
<p class="calibre10">The format of the <code class="calibre26">chown</code> command is:</p>
<pre class="calibre29"><code class="calibre26"> chown <code class="calibre26"><i class="calibre12">options owner[.group] file</i></code></code></pre>
<p class="calibre10">You can specify either the login name or the numeric UID for the new owner of the file:</p>
<pre class="calibre29"><code class="calibre26"> # chown dan newfile
 # ls -l newfile
 -rw-rw-r--    1 dan      rich            0 Sep 20 19:16 newfile
#</code></pre>
<p class="calibre10">Simple. The <code class="calibre26">chown</code> command also allows you to change both the user and group of a file:</p>
<pre class="calibre29"><code class="calibre26"> # chown dan.shared newfile
 # ls -l newfile
 -rw-rw-r--    1 dan      shared             0 Sep 20 19:16 newfile
#</code></pre>
<p class="calibre10">If you really want to get tricky, you can just change the default group for a file:</p>
<pre class="calibre29"><code class="calibre26"> # chown .rich newfile
 # ls -l newfile
 -rw-rw-r--    1 dan      rich            0 Sep 20 19:16 newfile
#</code></pre>
<p class="calibre10">Finally, if your Linux system uses individual group names that match user login names, you can change both with just one entry:</p>
<pre class="calibre29"><code class="calibre26"> # chown test. newfile
 # ls -l newfile
 -rw-rw-r--    1 test    test             0 Sep 20 19:16 newfile
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="182" id="calibre_link-523" class="calibre11"></span>The <code class="calibre26">chown</code> command uses a few different option parameters. The <code class="calibre26">-R</code> parameter allows you to make changes recursively through subdirectories and files, using a wildcard character. The <code class="calibre26">-h</code> parameter also changes the ownership of any files that are symbolically linked to the file.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Only the root user can change the owner of a file. Any user can change the default group of a file, but the user must be a member of the groups the file is changed from and to.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">chgrp</code> command provides an easy way to change just the default group for a file or directory:</p>
<pre class="calibre29"><code class="calibre26"> $ chgrp shared newfile
 $ ls -l newfile
 -rw-rw-r--    1 rich     shared          0 Sep 20 19:16 newfile
$</code></pre>
<p class="calibre10">The user account must own the file, and be a member of the new group as well to be able to change the group. Now any member in the shared group can write to the file. This is one way to share files on a Linux system. However, sharing files among a group of people on the system can get tricky. The next section discusses how to do this.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-170" class="calibre4"></a>Sharing Files</h2>
<p class="calibre10">As you've probably already figured out, creating groups is the way to share access to files on the Linux system. However, for a complete file-sharing environment, things are more complicated.</p>
<p class="calibre10">As you've already seen in the âDecoding File Permissionsâ section, when you create a new file, Linux assigns the file permissions of the new file using your default UID and GID. To allow others access to the file, you need to either change the security permissions for the everyone security group or assign the file a different default group that contains other users.</p>
<p class="calibre10">This can be a pain in a large environment if you want to create and share documents among several people. Fortunately, there's a simple solution for how to solve this problem.</p>
<p class="calibre10"><span type="pagebreak" title="183" id="calibre_link-524" class="calibre11"></span>There are three additional bits of information that Linux stores for each file and directory:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">The set user id (SUID):</b> When a file is executed by a user, the program runs under the permissions of the file owner.</li>
<li class="calibre7"><b class="calibre21">The set group id (SGID):</b> For a file, the program runs under the permissions of the file group. For a directory, new files created in the directory use the directory group as the default group.</li>
<li class="calibre7"><b class="calibre21">The sticky bit:</b> The file remains (sticks) in memory after the process ends.</li>
</ul>
<p class="calibre10">The SGID bit is important for sharing files. By enabling the SGID bit, you can force all new files created in a shared directory to be owned by the directory's group and now the individual user's group.</p>
<p class="calibre10">The SGID is set using the <code class="calibre26">chmod</code> command. It's added to the beginning of the standard three-digit octal value (making a four-digit octal value), or you can use the symbol <code class="calibre26">s</code> in symbolic mode.</p>
<p class="calibre10">If you're using octal mode, you'll need to know the arrangement of the bits, shown in <a id="calibre_link-1226" href="#calibre_link-1124" class="calibre4">Table 7.6</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1124" href="#calibre_link-1226" class="calibre4"><b class="calibre21">Table 7.6</b></a></span> The chmod SUID, SGID, and Sticky Bit Octal Values</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Binary</td>
<td class="left">Octal</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">000</td>
<td class="left">0</td>
<td class="left">All bits are cleared.</td>
</tr>
<tr class="calibre28">
<td class="left">001</td>
<td class="left">1</td>
<td class="left">The sticky bit is set.</td>
</tr>
<tr class="calibre28">
<td class="left">010</td>
<td class="left">2</td>
<td class="left">The SGID bit is set.</td>
</tr>
<tr class="calibre28">
<td class="left">011</td>
<td class="left">3</td>
<td class="left">The SGID and sticky bits are set.</td>
</tr>
<tr class="calibre28">
<td class="left">100</td>
<td class="left">4</td>
<td class="left">The SUID bit is set.</td>
</tr>
<tr class="calibre28">
<td class="left">101</td>
<td class="left">5</td>
<td class="left">The SUID and sticky bits are set.</td>
</tr>
<tr class="calibre28">
<td class="left">110</td>
<td class="left">6</td>
<td class="left">The SUID and SGID bits are set.</td>
</tr>
<tr class="calibre28">
<td class="left">111</td>
<td class="left">7</td>
<td class="left">All bits are set.</td>
</tr>
</table>
</figure>
<p class="calibre10">So, to create a shared directory that always sets the directory group for all new files, all you need to do is set the SGID bit for the directory:</p>
<pre class="calibre29"><code class="calibre26"> $ mkdir testdir
 $ ls -l
 drwxrwxr-x    2 rich     rich         4096 Sep 20 23:12 testdir/
 $ chgrp shared testdir
 $ chmod g+s testdir
 $ ls -l
 drwxrwsr-x    2 rich     shared       4096 Sep 20 23:12 testdir/
 $ umask 002
 $ cd testdir
 $ touch testfile
 $ ls -l
 total 0
 -rw-rw-r--    1 rich     shared          0 Sep 20 23:13 testfile
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="184" id="calibre_link-525" class="calibre11"></span>The first step is to create a directory that you want to share using the <code class="calibre26">mkdir</code> command. Next, use the <code class="calibre26">chgrp</code> command to change the default group for the directory to a group that contains the members who need to share files (you must be a member of that group for this to work). Finally, set the SGID bit for the directory to ensure that any files created in the directory use the shared group name as the default group.</p>
<p class="calibre10">For this environment to work properly, all the group members must have their umask values set to make files writable by group members. In the preceding example, the <code class="calibre26">umask</code> is changed to <code class="calibre26">002</code> so the files are writable by the group.</p>
<p class="calibre10">After all that's done, any member of the group can go to the shared directory and create a new file. As expected, the new file uses the default group of the directory, not the user account's default group. Now any user in the shared group can access this file.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-171" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed the command line commands you need to know to manage the Linux security on your system. Linux uses a system of user IDs and group IDs to protect access to files, directories, and devices. Linux stores information about user accounts in the <code class="calibre26">/etc/passwd</code> file and information about groups in the <code class="calibre26">/etc/group</code> file. Each user is assigned a unique numeric user ID, along with a text login name to identify the user in the system. Groups are also assigned unique numerical group IDs and text group names. A group can contain one or more users to allowed shared access to system resources.</p>
<p class="calibre10">Several commands are available for managing user accounts and groups. The <code class="calibre26">useradd</code> command allows you to create new user accounts, and the <code class="calibre26">groupadd</code> command allows you to create new group accounts. To modify an existing user account, use the <code class="calibre26">usermod</code> command. Similarly, use the <code class="calibre26">groupmod</code> command to modify group account information.</p>
<p class="calibre10">Linux uses a complicated system of bits to determine access permissions for files and directories. Each file contains three security levels of protection: the file's owner, a default group that has access to the file, and a level for everyone else on the system. Each security level is defined by three access bits: read, write, and execute. The combination of three bits is often referred to by the symbols <code class="calibre26">rwx</code>, for read, write, and execute. If a permission is denied, its symbol is replaced with a dash (such as <code class="calibre26">r--</code> for read-only permission).</p>
<p class="calibre10"><span type="pagebreak" title="185" id="calibre_link-526" class="calibre11"></span>The symbolic permissions are often referred to as octal values, with the three bits combined into one octal value and three octal values representing the three security levels. Use the <code class="calibre26">umask</code> command to set the default security settings for files and directories created on the system. The system administrator normally sets a default umask value in the <code class="calibre26">/etc/profile</code> file, but you can use the <code class="calibre26">umask</code> command to change your umask value at any time.</p>
<p class="calibre10">Use the <code class="calibre26">chmod</code> command to change security settings for files and directories. Only the file's owner can change permissions for a file or directory. However, the root user can change the security settings for any file or directory on the system. You can use the <code class="calibre26">chown</code> and <code class="calibre26">chgrp</code> commands to change the default owner and group of the file.</p>
<p class="calibre10">The chapter closed with a discussion on how to use the set GID bit to create a shared directory. The SGID bit forces any new files or directories created in a directory to use the default group name of the parent directory, not that of the user who created them. This provides an easy way to share files between users on the system.</p>
<p class="calibre10">Now that you're up to speed with file permissions, it's time to take a closer look at how to work with the actual filesystem in Linux. The next chapter shows you how to create new partitions in Linux from the command line and then how to format the new partitions so that they can be used in the Linux virtual directory.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1230">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-172" class="calibre4"></a><span class="chaptertitle">Chapter 8</span><br class="calibre22" /><span class="chaptertitle">Managing Filesystems</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Understanding filesystem basics</li>
<li class="calibre7">Exploring journaling and copy-on-write filesystems</li>
<li class="calibre7">Managing filesystems</li>
<li class="calibre7">Investigating the logical volume layout</li>
<li class="calibre7">Using the Linux Logical Volume Manager</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="187" id="calibre_link-527" class="calibre11"></span>When you're working with your Linux system, one of the decisions you'll need to make is what filesystem to use for the storage devices. Most Linux distributions kindly provide a default filesystem for you at installation time, and most beginning Linux users just use it without giving the topic another thought.</p>
<p class="calibre19">Although using the default filesystem choice isn't necessarily a bad thing, sometimes it helps to know the other options available to you. This chapter discusses the different filesystem options you have available in the Linux world and shows you how to create and manage them from the Linux command line.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-173" class="calibre4"></a>Exploring Linux Filesystems</h2>
<p class="calibre10">Chapter 3 discussed how Linux uses a <i class="calibre12">filesystem</i> to store files and folders on a storage device. The filesystem provides a way for Linux to bridge the gap between the ones and zeroes stored in the hard drive and the files and folders you work with in your applications.</p>
<p class="calibre10">Linux supports several types of filesystems to manage files and folders. Each filesystem implements the virtual directory structure on storage devices using slightly different features. This section walks you through the strengths and weaknesses of the more common filesystems used in the Linux environment.</p>
<section class="toclist">
<h3 class="calibre15">Understanding the basic Linux filesystems</h3>
<p class="calibre10"><span type="pagebreak" title="188" id="calibre_link-528" class="calibre11"></span>The original Linux system used a simple filesystem that mimicked the functionality of the Unix filesystem. This section discusses the evolution of that filesystem.</p>
<section class="toclist">
<h4 class="calibre25">Looking at the ext Filesystem</h4>
<p class="calibre10">The original filesystem introduced with the Linux operating system is called the <i class="calibre12">extended filesystem</i> (or just ext for short). It provides a basic Unix-like filesystem for Linux, using virtual directories to handle physical devices, and storing data in fixed-length blocks on the physical devices.</p>
<p class="calibre10">The ext filesystem uses a system called <i class="calibre12">inodes</i> to track information about the files stored in the virtual directory. The inode system creates a separate table on each physical device, called the <i class="calibre12">inode table</i>, to store file information. Each stored file in the virtual directory has an entry in the inode table. The <i class="calibre12">extended</i> part of the name comes from the additional data that it tracks on each file, which consists of these items:</p>
<ul class="calibre14">
<li class="calibre7">The filename</li>
<li class="calibre7">The file size</li>
<li class="calibre7">The owner of the file</li>
<li class="calibre7">The group the file belongs to</li>
<li class="calibre7">Access permissions for the file</li>
<li class="calibre7">Pointers to each disk block that contains data from the file</li>
</ul>
<p class="calibre10">Linux references each inode in the inode table using a unique number (called the <i class="calibre12">inode number</i>), assigned by the filesystem as data files are created. The filesystem uses the inode number to identify the file rather than having to use the full filename and path.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the ext2 Filesystem</h4>
<p class="calibre10">The original ext filesystem had quite a few limitations, such as restraining files to only 2GB in size. Not too long after Linux was first introduced, the ext filesystem was upgraded to create the second extended filesystem, called <i class="calibre12">ext2</i>.</p>
<p class="calibre10">As you can guess, the ext2 filesystem is an expansion of the basic abilities of the ext filesystem, but maintains the same structure. The ext2 filesystem expands the inode table format to track additional information about each file on the system.</p>
<p class="calibre10">The ext2 inode table adds the created, modified, and last accessed time values for files to help system administrators track file access on the system. The ext2 filesystem also increases the maximum file size allowed to 2TB (then in later versions of ext2, that was increased to 32TB) to help accommodate large files commonly found in database servers.</p>
<p class="calibre10">In addition to expanding the inode table, the ext2 filesystem also changed the way in which files are stored in the data blocks. A common problem with the ext filesystem was that as a file is written to the physical device, the blocks used to store the data tend to be scattered throughout the device (called <i class="calibre12">fragmentation</i>). Fragmentation of data blocks can reduce the filesystem performance, because it takes longer to search the storage device to access all the blocks for a specific file.</p>
<p class="calibre10"><span type="pagebreak" title="189" id="calibre_link-529" class="calibre11"></span>The ext2 filesystem helps reduce fragmentation by allocating disk blocks in groups when you save a file. By grouping the data blocks for a file, the filesystem doesn't have to search all over the physical device for the data blocks to read the file.</p>
<p class="calibre10">The ext2 filesystem was the default filesystem used in Linux distributions for many years, but it, too, had its limitations. The inode table, although a nice feature that allows the filesystem to track additional information about files, can cause problems that can be fatal to the system. Each time the filesystem stores or updates a file, it must modify the inode table with the new information. The problem is that this isn't always a fluid action.</p>
<p class="calibre10">If something should happen to the computer system between the file being stored and the inode table being updated, the two would become out of sync. The ext2 filesystem is notorious for easily becoming corrupted due to system crashes and power outages. Even if the file data is stored just fine on the physical device, if the inode table entry isn't completed, the ext2 filesystem doesn't even know that the file existed!</p>
<p class="calibre10">It wasn't long before developers were exploring a different avenue of Linux filesystems.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Understanding journaling filesystems</h3>
<p class="calibre10"><i class="calibre12">Journaling filesystems</i> provide a new level of safety to the Linux system. Instead of writing data directly to the storage device and then updating the inode table, journaling filesystems write file changes into a temporary file (called the <i class="calibre12">journal</i>) first. After data is successfully written to the storage device and the inode table, the journal entry is deleted.</p>
<p class="calibre10">If the system should crash or suffer a power outage before the data can be written to the storage device, the journaling filesystem just reads through the journal file and processes any uncommitted data left over.</p>
<p class="calibre10">Linux commonly uses three different methods of journaling, each with different levels of protection. These are shown in <a id="calibre_link-1231" href="#calibre_link-1125" class="calibre4">Table 8.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1125" href="#calibre_link-1231" class="calibre4"><b class="calibre21">Table 8.1</b></a></span> Journaling Filesystem Methods</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Method</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Data mode</td>
<td class="left">Both inode and file data are journaled. Low risk of losing data, but poor performance.</td>
</tr>
<tr class="calibre28">
<td class="left">Ordered mode</td>
<td class="left">Only inode data is written to the journal, but not removed until file data is successfully written. Good compromise between performance and safety.</td>
</tr>
<tr class="calibre28">
<td class="left">Writeback mode</td>
<td class="left">Only inode data is written to the journal, no control over when the file data is written. Higher risk of losing data, but still better than not using journaling.</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="190" id="calibre_link-530" class="calibre11"></span>The data mode journaling method is by far the safest for protecting data, but it is also the slowest. All the data written to a storage device must be written twice, once to the journal and again to the actual storage device. This can cause poor performance, especially for systems that do lots of data writing.</p>
<p class="calibre10">Over the years, a few different journaling filesystems have appeared in Linux. The following sections describe the popular Linux journaling filesystems available.</p>
<section class="toclist">
<h4 class="calibre25">Looking at the ext3 Filesystem</h4>
<p class="calibre10">The <i class="calibre12">ext3</i> filesystem was added to the Linux kernel in 2001, and up until recently was the default filesystem used by just about all Linux distributions. It uses the same inode table structure as the ext2 filesystem, but adds a journal file to each storage device to journal the data written to the storage device.</p>
<p class="calibre10">By default, the ext3 filesystem uses the ordered mode method of journaling, only writing the inode information to the journal file, but not removing it until the data blocks have been successfully written to the storage device. You can change the journaling method used in the ext3 filesystem to either data or writeback modes with a simple command line option when creating the filesystem.</p>
<p class="calibre10">Although the ext3 filesystem added basic journaling to the Linux filesystem, it still lacked a few things. For example, the ext3 filesystem doesn't provide any recovery from accidental deletion of files, no built-in data compression is available (although a patch can be installed separately that provides this feature), and the ext3 filesystem doesn't support encrypting files. For those reasons, developers in the Linux project chose to continue work on improving the ext3 filesystem.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the ext4 Filesystem</h4>
<p class="calibre10">The result of expanding the ext3 filesystem was (as you probably guessed) the <i class="calibre12">ext4</i> filesystem. The ext4 filesystem was officially supported in the Linux kernel in 2008 and is now the default filesystem used in popular Linux distributions, such as Ubuntu.</p>
<p class="calibre10">In addition to supporting compression and encryption, the ext4 filesystem also supports a feature called <i class="calibre12">extents</i>. Extents allocate space on a storage device in blocks and only store the starting block location in the inode table. This helps save space in the inode table by not having to list all the data blocks used to store data from the file.</p>
<p class="calibre10">The ext4 filesystem also incorporates <i class="calibre12">block preallocation</i>. If you want to reserve space on a storage device for a file that you know will grow in size, with the ext4 filesystem it's possible to allocate all the expected blocks for the file, not just the blocks that physically exist. The ext4 filesystem fills in the reserved data blocks with zeroes and knows not to allocate them for any other file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the Reiser Filesystem</h4>
<p class="calibre10">In 2001, Hans Reiser created the first journaling filesystem for Linux, called <i class="calibre12">ReiserFS</i>. The ReiserFS filesystem supports only writeback journaling mode, writing only the inode table data to the journal file. Because it writes only the inode table data to the journal, the ReiserFS filesystem is one of the faster Linux journaling filesystems.</p>
<p class="calibre10"><span type="pagebreak" title="191" id="calibre_link-531" class="calibre11"></span>Two interesting features incorporated into the ReiserFS filesystem are that you can resize an existing filesystem while it's still active and that it uses a technique called <i class="calibre12">tailpacking</i>, which stuffs data from one file into empty space in a data block from another file. The active filesystem resizing feature is great if you have to expand an already created filesystem to accommodate more data.</p>
<p class="calibre10">The ReiserFS development team began working on a new version called <i class="calibre12">Reiser4</i> in 2004. The Reiser4 filesystem has several improvements over ResierFS, including extremely efficient handling of small files. However, most current mainstream Linux distributions don't use the Reiser4 filesystem. Yet, you may still run into a Linux system that employs it.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the Journaled Filesystem</h4>
<p class="calibre10">Possibly one of the oldest journaling filesystems around, the <i class="calibre12">Journaled File System</i> (JFS) was developed by IBM in 1990 for its AIX flavor of Unix. However, it wasn't until its second version that it was ported to the Linux environment.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The official IBM name of the second version of the JFS filesystem is JFS2, but most Linux systems refer to it as just JFS.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The JFS filesystem uses the ordered journaling method, storing only the inode table data in the journal, but not removing it until the actual file data is written to the storage device. This method is a compromise between the speed of the Reiser4 and the integrity of the data mode journaling method.</p>
<p class="calibre10">The JFS filesystem uses extent-based file allocation, allocating a group of blocks for each file written to the storage device. This method provides for less fragmentation on the storage device.</p>
<p class="calibre10">Outside of the IBM Linux offerings, the JFS filesystem isn't popularly used, but you may run into it in your Linux journey.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the XFS Filesystem</h4>
<p class="calibre10">The <i class="calibre12">XFS</i> journaling filesystem is yet another filesystem originally created for a commercial Unix system that made its way into the Linux world. Silicon Graphics Incorporated (SGI) originally created XFS in 1994 for its commercial IRIX Unix system. It was released to the Linux environment for common use in 2002. The XFS filesystem has recently become more popular and is used as the default filesystem in mainstream Linux distributions, such as RHEL.</p>
<p class="calibre10">The XFS filesystem uses the writeback mode of journaling, which provides high performance but does introduce an amount of risk because the actual data isn't stored in the journal file. The XFS filesystem also allows online resizing of the filesystem, similar to the Reiser4 filesystem, except XFS filesystems can only be expanded and not shrunk.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Understanding the copy-on-write filesystems</h3>
<p class="calibre10"><span type="pagebreak" title="192" id="calibre_link-532" class="calibre11"></span>With journaling, you must choose between safety and performance. Although data mode journaling provides the highest safety, performance suffers because both inode and data is journaled. With writeback mode journaling, performance is acceptable, but safety is compromised.</p>
<p class="calibre10">For filesystems, an alternative to journaling is a technique called <i class="calibre12">copy-on-write</i> (COW). COW offers both safety and performance via <i class="calibre12">snapshots</i>. For modifying data, a <i class="calibre12">clone</i> or <i class="calibre12">writable-snapshot</i> is used. Instead of writing modified data over current data, the modified data is put in a new filesystem location. Even when data modification is completed, the old data is never overwritten.</p>
<p class="calibre10">COW filesystems are gaining in popularity. Two of the most popular, Btrfs and ZFS, are briefly reviewed in the following sections.</p>
<section class="toclist">
<h4 class="calibre25">Looking at the ZFS Filesystem</h4>
<p class="calibre10">The COW filesystem <i class="calibre12">ZFS</i> was developed in 2005 by Sun Microsystems for the OpenSolaris operating system. It began being ported to Linux in 2008 and was finally available for Linux production use in 2012.</p>
<p class="calibre10">ZFS is a stable filesystem and competes well against Resier4, Btrfs, and ext4. Its biggest detractor is that ZFS does not have a GPL license. The OpenZFS project was launched in 2013, which may help to change this situation. However, it's possible that until a GPL license is obtained, ZFS will never be a default Linux filesystem.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the Btrfs Filesystem</h4>
<p class="calibre10">The COW newcomer is the <i class="calibre12">Btrfs</i> filesystem, also called the B-tree filesystem. Oracle started development on Btrfs in 2007. It was based on many of Reiser4's features, but offered improvements in reliability. Additional developers eventually joined in and helped Btrfs quickly rise toward the top of the popular filesystems list. This popularity is due to stability, ease of use, as well as the ability to dynamically resize a mounted filesystem. The openSUSE Linux distribution recently established Btrfs as its default filesystem. It is also offered in other Linux distributions, such as RHEL, although not as the default filesystem.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-174" class="calibre4"></a>Working with Filesystems</h2>
<p class="calibre10">Linux provides a few different utilities that make it easier to work with filesystems from the command line. You can add new filesystems or change existing filesystems from the comfort of your own keyboard. This section walks you through the commands for interacting with filesystems from a command line environment.</p>
<section class="toclist">
<h3 class="calibre15">Creating partitions</h3>
<p class="calibre10"><span type="pagebreak" title="193" id="calibre_link-533" class="calibre11"></span>To start out, you need to create a <i class="calibre12">partition</i> on the storage device to contain the filesystem. The partition can be an entire disk or a subset of a disk that contains a portion of the virtual directory.</p>
<p class="calibre10">The <code class="calibre26">fdisk</code> utility is used to help you organize partitions on any storage device installed on the system. The <code class="calibre26">fdisk</code> command is an interactive program that allows you to enter commands to walk through the steps of partitioning a hard drive.</p>
<p class="calibre10">To start the <code class="calibre26">fdisk</code> command, you need to specify the device name of the storage device you want to partition and you need to have superuser privileges. When you don't have superuser privileges and attempt to use <code class="calibre26">fdisk</code>, you'll receive some sort of error message, like this one:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">fdisk /dev/sdb</b></code>
Unable to open /dev/sdb
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Sometimes, the hardest part of creating a new disk partition is trying to find the physical disk on your Linux system. Linux uses a standard format for assigning device names to hard drives, but you need to be familiar with the format. For older IDE drives, Linux uses <code class="calibre26">/dev/hdx</code>, where <code class="calibre26"><i class="calibre12">x</i></code> is a letter based on the order the drive is detected (<i class="calibre12">a</i> for the first drive, <i class="calibre12">b</i> for the second, and so on). For both the newer SATA drives and SCSI drives, Linux uses <code class="calibre26">/dev/sdx</code>, where <code class="calibre26"><i class="calibre12">x</i></code> is a letter based on the order the drive is detected (again, <i class="calibre12">a</i> for the first drive, <i class="calibre12">b</i> for the second, and so on). It's always a good idea to double-check to make sure you are referencing the correct drive before formatting the partition!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">If you do have superuser privileges and the correct device name, the <code class="calibre26">fdisk</code> command allows you entrance into the utility as demonstrated here on a CentOS distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo fdisk /dev/sdb</b></code>
[sudo] password for Christine:
Device contains neither a valid DOS partition table,
nor Sun, SGI or OSF disklabel
Building a new DOS disklabel with disk identifier 0xd3f759b5.
Changes will remain in memory only
until you decide to write them.
After that, of course, the previous content won't be recoverable.
Warning: invalid flag 0x0000 of partition table 4 will
be corrected by w(rite)
[...]
Command (m for help):</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If this is the first time you're partitioning the storage device, <code class="calibre26">fdisk</code> gives you a warning that a partition table is not on the device.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="194" id="calibre_link-534" class="calibre11"></span>The <code class="calibre26">fdisk</code> interactive command prompt uses single letter commands to instruct <code class="calibre26">fdisk</code> what to do. <a id="calibre_link-1232" href="#calibre_link-1126" class="calibre4">Table 8.2</a> shows the commands available at the <code class="calibre26">fdisk</code> command prompt.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1126" href="#calibre_link-1232" class="calibre4"><b class="calibre21">Table 8.2</b></a></span> The fdisk Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">a</code></td>
<td class="left">Toggles a flag indicating if the partition is bootable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">b</code></td>
<td class="left">Edits the disklabel used by BSD Unix systems</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">c</code></td>
<td class="left">Toggles the DOS compatibility flag</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">d</code></td>
<td class="left">Deletes the partition</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">l</code></td>
<td class="left">Lists the available partition types</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">m</code></td>
<td class="left">Displays the command options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n</code></td>
<td class="left">Adds a new partition</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">o</code></td>
<td class="left">Creates a DOS partition table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">p</code></td>
<td class="left">Displays the current partition table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">q</code></td>
<td class="left">Quits without saving changes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">s</code></td>
<td class="left">Creates a new disklabel for Sun Unix systems</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">t</code></td>
<td class="left">Changes the partition system ID</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">u</code></td>
<td class="left">Changes the storage units used</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">v</code></td>
<td class="left">Verifies the partition table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">w</code></td>
<td class="left">Writes the partition table to the disk</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">x</code></td>
<td class="left">Advanced functions</td>
</tr>
</table>
</figure>
<p class="calibre10">Although this list may look intimidating, usually you need just a few basic commands in day-to-day work.</p>
<p class="calibre10">For starters, you can display the details of a storage device using the <code class="calibre26">p</code> command:</p>
<pre class="calibre29"><code class="calibre26">Command (m for help): <code class="calibre26"><b class="calibre21">p</b></code>
Disk /dev/sdb: 5368 MB, 5368709120 bytes
255 heads, 63 sectors/track, 652 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x11747e88
   Device Boot      Start         End      Blocks   Id  System
Command (m for help):</code></pre>
<p class="calibre10"><span type="pagebreak" title="195" id="calibre_link-535" class="calibre11"></span>The output shows that the storage device has 5368MB of space on it (5GB). The listing under the storage device details shows whether there are any existing partitions on the device. The listing in this example doesn't show any partitions, so the device is not partitioned yet.</p>
<p class="calibre10">Next, you'll want to create a new partition on the storage device. Use the <code class="calibre26">n</code> command for that:</p>
<pre class="calibre29"><code class="calibre26">Command (m for help): <code class="calibre26"><b class="calibre21">n</b></code>
Command action
   e   extended
   p   primary partition (1-4)
<code class="calibre26"><b class="calibre21">p</b></code>
Partition number (1-4): <code class="calibre26"><b class="calibre21">1</b></code>
First cylinder (1-652, default 1): <code class="calibre26"><b class="calibre21">1</b></code>
Last cylinder, +cylinders or +size{K,M,G} (1-652, default 652): <code class="calibre26"><b class="calibre21">+2G</b></code>
Command (m for help): </code></pre>
<p class="calibre10">Partitions can be created as either a <i class="calibre12">primary partition</i> or an <i class="calibre12">extended partition</i>. Primary partitions can be formatted with a filesystem directly, whereas extended partitions can only contain other primary partitions. The reason for extended partitions is that there can only be four partitions on a single storage device. You can extend that by creating multiple extended partitions and then creating primary partitions inside the extended partitions. This example creates a primary storage device, assigns it partition number 1, and then allocates 2GB of the storage device space to it. You can see the results using the <code class="calibre26">p</code> command again:</p>
<pre class="calibre29"><code class="calibre26">Command (m for help): <code class="calibre26"><b class="calibre21">p</b></code>
Disk /dev/sdb: 5368 MB, 5368709120 bytes
255 heads, 63 sectors/track, 652 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x029aa6af
   Device Boot      Start         End      Blocks   Id  System
<code class="calibre26"><b class="calibre21">/dev/sdb1</b></code>               1         262     2104483+  <code class="calibre26"><b class="calibre21">83</b></code>  Linux
Command (m for help):</code></pre>
<p class="calibre10">Now in the output there's a partition shown on the storage device (called <code class="calibre26">/dev/sdb1</code>). The <code class="calibre26">Id</code> entry defines how Linux treats the partition. <code class="calibre26">fdisk</code> allows you to create lots of partition types. Using the <code class="calibre26">l</code> command lists the different types available. The default is type 83, which defines a Linux filesystem. If you want to create a partition for a different filesystem (such as a Windows NTFS partition), just select a different partition type.</p>
<p class="calibre10"><span type="pagebreak" title="196" id="calibre_link-536" class="calibre11"></span>You can repeat the process to allocate the remaining space on the storage device to another Linux partition. After you've created the partitions you want, use the <code class="calibre26">w</code> command to save the changes to the storage device:</p>
<pre class="calibre29"><code class="calibre26">Command (m for help): <code class="calibre26"><b class="calibre21">w</b></code>
The partition table has been altered!
Calling ioctl() to re-read partition table.
Syncing disks.
$</code></pre>
<p class="calibre10">The storage device partition information was written to the partition table, and Linux was informed of the new partition via the <code class="calibre26">ioctl()</code> call. Now that you have set up a partition on the storage device, you're ready to format it with a Linux filesystem.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Some distributions and older distribution versions do not automatically inform your Linux system of a new partition after it is made. In this case, you need to use either the <code class="calibre26">partprobe</code> or <code class="calibre26">hdparm</code> command (see their <code class="calibre26">man</code> pages), or reboot your system so it reads the updated partition table</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Creating a filesystem</h3>
<p class="calibre10">Before you can store data on the partition, you must format it with a filesystem so Linux can use it. Each filesystem type uses its own command line program to format partitions. <a id="calibre_link-1233" href="#calibre_link-1127" class="calibre4">Table 8.3</a> lists the utilities used for the different filesystems discussed in this chapter.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1127" href="#calibre_link-1233" class="calibre4"><b class="calibre21">Table 8.3</b></a></span> Command Line Programs to Create Filesystems</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Utility</td>
<td class="left">Purpose</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkefs</code></td>
<td class="left">Creates an ext filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mke2fs</code></td>
<td class="left">Creates an ext2 filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkfs.ext3</code></td>
<td class="left">Creates an ext3 filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkfs.ext4</code></td>
<td class="left">Creates an ext4 filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkreiserfs</code></td>
<td class="left">Creates a ReiserFS filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">jfs_mkfs</code></td>
<td class="left">Creates a JFS filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkfs.xfs</code></td>
<td class="left">Creates an XFS filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkfs.zfs</code></td>
<td class="left">Creates a ZFS filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkfs.btrfs</code></td>
<td class="left">Creates a Btrfs filesystem</td>
</tr>
</table>
</figure>
<p class="calibre10">Not all filesystem utilities are installed by default. To determine whether you have a particular filesystem utility, use the <code class="calibre26">type</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">type mkfs.ext4</b></code>
mkfs.ext4 is /sbin/mkfs.ext4
$
$ <code class="calibre26"><b class="calibre21">type mkfs.btrfs</b></code>
-bash: type: mkfs.btrfs: not found
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="197" id="calibre_link-537" class="calibre11"></span>The preceding example on an Ubuntu system shows that the <code class="calibre26">mkfs.ext4</code> utility is available. However, the Btrfs utility is not. See Chapter 9 on how to install additional software and utilities on your Linux distribution.</p>
<p class="calibre10">Each filesystem utility command has lots of command line options that allow you to customize just how the filesystem is created in the partition. To see all the command line options available, use the <code class="calibre26">man</code> command to display the manual pages for the filesystem command (see Chapter 3). All the filesystem commands allow you to create a default filesystem with just the simple command with no options:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo mkfs.ext4 /dev/sdb1</b></code>
[sudo] password for Christine:
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
131648 inodes, 526120 blocks
26306 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=541065216
17 block groups
32768 blocks per group, 32768 fragments per group
7744 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912
	
Writing inode tables: done
<code class="calibre26"><b class="calibre21">Creating journal</b></code> (16384 blocks): done
Writing superblocks and filesystem accounting information: done
This filesystem will be automatically checked every 23 mounts or
180 days, whichever comes first. Use tune2fs -c or -i to override.
$</code></pre>
<p class="calibre10">The new filesystem uses the ext4 filesystem type, which is a journaling filesystem in Linux. Notice that part of the creation process was to create the new journal.</p>
<p class="calibre10">After you create the filesystem for a partition, the next step is to mount it on a virtual directory mount point so you can store data in the new filesystem. You can mount the new filesystem anywhere in your virtual directory where you need the extra space.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls /mnt</b></code>
$
$ <code class="calibre26"><b class="calibre21">sudo mkdir /mnt/my_partition</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -al /mnt/my_partition/</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -dF /mnt/my_partition</b></code>
/mnt/my_partition/
$
$ <code class="calibre26"><b class="calibre21">sudo  mount -t ext4  /dev/sdb1  /mnt/my_partition</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -al /mnt/my_partition/</b></code>
total 24
drwxr-xr-x. 3 root root  4096 Jun 11 09:53 .
drwxr-xr-x. 3 root root  4096 Jun 11 09:58 ..
drwx------. 2 root root 16384 Jun 11 09:53 lost+found
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="198" id="calibre_link-538" class="calibre11"></span>The <code class="calibre26">mkdir</code> command (Chapter 3) creates the mount point in the virtual directory, and the <code class="calibre26">mount</code> command adds the new hard drive partition to the mount point. The <code class="calibre26">-t</code> option on the <code class="calibre26">mount</code> command indicates what filesystem type, <code class="calibre26">ext4</code>, you are mounting. Now you can save new files and folders on the new partition!</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">This method of mounting a filesystem only temporarily mounts the filesystem. When you reboot your Linux system, the filesystem doesn't automatically mount. To force Linux to automatically mount the new filesystem at boot time, add the new filesystem to the <code class="calibre26">/etc/fstab</code> file.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Now that the filesystem is mounted within the virtual directory system, it can start to be used on a regular basis. Unfortunately, with regular use comes the potential for serious problems, such as filesystem corruption. The next section looks at how to deal with these issues.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Checking and repairing a filesystem</h3>
<p class="calibre10">Even with modern filesystems, things can go wrong if power is unexpectedly lost, or if a wayward application locks up the system while file access is in progress. Fortunately, some command line tools are available to help you make an attempt to restore the filesystem back to order.</p>
<p class="calibre10">Each filesystem has its own recovery command for interacting with the filesystem. That has the potential of getting ugly, because more and more filesystems are available in the Linux environment, making for lots of individual commands you have to know. Fortunately, a common front-end program available can determine the filesystem on the storage device and use the appropriate filesystem recovery command based on the filesystem being recovered.</p>
<p class="calibre10">The <code class="calibre26"><span type="pagebreak" title="199" id="calibre_link-539" class="calibre11"></span>fsck</code> command is used to check and repair most Linux filesystem types, including ones discussed earlier in this chapter &mdash; ext, ext2, ext3, ext4, Reiser4, JFS, and XFS. The format of the command is:</p>
<pre class="calibre29"><code class="calibre26">fsck <code class="calibre26"><i class="calibre12">options filesystem</i></code></code></pre>
<p class="calibre10">You can list multiple <code class="calibre26"><i class="calibre12">filesystem</i></code> entries on the command line to check. Filesystems can be referenced using either the device name, the mount point in the virtual directory, or a special Linux UUID value assigned to the filesystem.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Although journaling filesystems users do need the <code class="calibre26">fsck</code> command, it is arguable as to whether COW filesystems users do. In fact, the ZFS filesystem does not even have an interface to the <code class="calibre26">fsck</code> utility</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">fsck</code> command uses the <code class="calibre26">/etc/fstab</code> file to automatically determine the filesystem on a storage device that's normally mounted on the system. If the storage device isn't normally mounted (such as if you just created a filesystem on a new storage device), you need to use the <code class="calibre26">-t</code> command line option to specify the filesystem type. <a id="calibre_link-1234" href="#calibre_link-1128" class="calibre4">Table 8.4</a> lists the other command line options available.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1128" href="#calibre_link-1234" class="calibre4"><b class="calibre21">Table 8.4</b></a></span> The fsck Command Line Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Automatically repairs the filesystem if errors are detected</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-A</code></td>
<td class="left">Checks all the filesystems listed in the /etc/fstab file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-C</code></td>
<td class="left">Displays a progress bar for filesystems that support that feature (only ext2 and ext3)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-N</code></td>
<td class="left">Doesn't run the check, only displays what checks would be performed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">Prompts to fix if errors found</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-R</code></td>
<td class="left">Skips the root filesystem if using the -A option</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">If checking multiple filesystems, performs the checks one at a time</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-t</code></td>
<td class="left">Specifies the filesystem type to check</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-T</code></td>
<td class="left">Doesn't show the header information when starting</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-V</code></td>
<td class="left">Produces verbose output during the checks</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-y</code></td>
<td class="left">Automatically repairs the filesystem if errors detected</td>
</tr>
</table>
</figure>
<p class="calibre10">You may notice that some of the command line options are redundant. That's part of the problem of trying to implement a common front-end for multiple commands. Some of the individual filesystem repair commands have additional options that can be used. If you need to do more advanced error checking, you'll need to check the <code class="calibre26">man</code> pages for the individual filesystem repair tool to see if there are extended options specific to that filesystem.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You can run the <code class="calibre26">fsck</code> command on unmounted filesystems only. For most filesystems, you can just unmount the filesystem to check it and then remount it when you're finished. However, because the root filesystem contains all the core Linux commands and log files, you can't unmount it on a running system.</p>
<p class="calibre19">This is a time where having a Linux LiveCD comes in handy! Just boot your system with the LiveCD, and then run the <code class="calibre26">fsck</code> command on the root filesystem!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="200" id="calibre_link-540" class="calibre11"></span>This chapter has showed how to handle filesystems contained in physical storage devices. Linux also provides a couple of different ways to create logical storage devices for filesystems. The next section examines how you can use a logical storage device for your filesystems.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-175" class="calibre4"></a>Managing Logical Volumes</h2>
<p class="calibre10">If you create your filesystems using standard partitions on hard drives, trying to add additional space to an existing filesystem can be somewhat of a painful experience. You can only expand a partition to the extent of the available space on the same physical hard drive. If no more space is available on that hard drive, you're stuck having to get a larger hard drive and manually moving the existing filesystem to the new drive.</p>
<p class="calibre10">What would come in handy is a way to dynamically add more space to an existing filesystem by just adding a partition from another hard drive to the existing filesystem. The Linux <i class="calibre12">Logical Volume Manager</i> (LVM) software package allows you to do just that. It provides an easy way for you to manipulate disk space on a Linux system without having to rebuild entire filesystems.</p>
<section class="toclist">
<h3 class="calibre15">Exploring logical volume management layout</h3>
<p class="calibre10">The core of logical volume management is how it handles the physical hard drive partitions installed on the system. In the logical volume management world, hard drives are called <i class="calibre12">physical volumes</i> (PV). Each PV maps to a specific physical partition created on a hard drive.</p>
<p class="calibre10">Multiple PV elements are pooled together to create a <i class="calibre12">volume group</i> (VG). The logical volume management system treats the VG like a physical hard drive, but in reality the VG may consist of multiple physical partitions spread across multiple hard drives. The VG provides a platform to create the logical partitions, which actually contain the filesystem.</p>
<p class="calibre10">The final layer in the structure is the <i class="calibre12">logical volume</i> (LV). The LV creates the partition environment for Linux to create a filesystem, acting similar to a physical hard disk partition as far as Linux is concerned. The Linux system treats the LV just like a physical partition. You can format the LV using any one of the standard Linux filesystems and then add it to the Linux virtual directory at a mount point.</p>
<p class="calibre10"><a id="calibre_link-1235" href="#calibre_link-1077" class="calibre4">Figure 8.1</a> <span type="pagebreak" title="201" id="calibre_link-541" class="calibre11"></span>shows the basic layout of a typical Linux logical volume management environment.</p>
<figure class="calibre23">
<img class="center" src="images/000027.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1077" href="#calibre_link-1235" class="calibre4"><b class="calibre21">Figure 8.1</b></a></span> The logical volume management environment</p>
</figcaption>
</figure>
<p class="calibre10">The volume group, shown in <a href="#calibre_link-1077" class="calibre4">Figure 8.1</a>, spans across three separate physical hard drives, which contain five separate physical partitions. Inside the volume group are two separate logical volumes. The Linux system treats each logical volume just like a physical partition. Each logical volume can be formatted as an ext4 filesystem and then mounted to a specific location in the virtual directory.</p>
<p class="calibre10">Notice in <a href="#calibre_link-1077" class="calibre4">Figure 8.1</a> that the third physical hard drive has an unused partition. Using logical volume management, you can easily assign this unused partition to the existing volume group at a later time, and then either use it to create a new logical volume or add it to expand one of the existing logical volumes when you need more space.</p>
<p class="calibre10">Likewise, if you add a new hard drive to the system, the local volume management system allows you to add it to the existing volume group, and then create more space for one of the existing logical volumes, or start a new logical volume to be mounted. That's a much better way of handling expanding filesystems!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using the LVM in Linux</h3>
<p class="calibre10">The Linux LVM was developed by Heinz Mauelshagen and released to the Linux community in 1998. It allows you to manage a complete logical volume management environment in Linux using simple command line commands.</p>
<p class="calibre10">Two versions of Linux LVM are available:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">LVM1:</b> The original LVM package released in 1998 and available in only the 2.4 Linux kernels. It provides only basic logical volume management features.</li>
<li class="calibre7"><b class="calibre21">LVM2:</b> An updated version of the LVM, available in the 2.6 Linux kernels. It provides additional features over the standard LVM1 features.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="202" id="calibre_link-542" class="calibre11"></span>Most modern Linux distributions using the 2.6 kernel version or above provide support for LVM2. Besides the standard logical volume management features, LVM2 provides a few other nice things for you to use in your Linux system.</p>
<section class="toclist">
<h4 class="calibre25">Taking a Snapshot</h4>
<p class="calibre10">The original Linux LVM allows you to copy an existing logical volume to another device while the logical volume is active. This feature is called a <i class="calibre12">snapshot</i>. Snapshots are great for backing up important data that can't be locked due to high availability requirements. Traditional backup methods usually lock files as they're being copied to the backup media. The snapshot allows you to continue running mission critical web or database servers while performing the copy. Unfortunately, LVM1 allows you to create only a read-only snapshot. After you create the snapshot, you can't write to it.</p>
<p class="calibre10">LVM2 allows you to create a read-write snapshot of an active logical volume. With the read-write copy, you can remove the original logical volume and mount the snapshot as a replacement. This feature is great for fast fail-overs or for experimenting with applications that modify data that may need to be restored if something fails.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Striping</h4>
<p class="calibre10">Another interesting feature that LVM2 provides is <i class="calibre12">striping</i>. With striping, a logical volume is created across multiple physical hard drives. When the Linux LVM writes a file to the logical volume, the data blocks in the file are spread across the multiple hard drives. Each successive block of data is written to the next hard drive.</p>
<p class="calibre10">Striping helps improve disk performance, because Linux can write the multiple data blocks for a file to the multiple hard drives simultaneously, rather than having to wait for a single hard drive to move the read/write head to different locations. This improvement also applies to reading sequentially accessed files, because the LVM can read data from the multiple hard drives simultaneously.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">LVM striping is not the same as RAID striping. LVM striping doesn't provide a parity entry, which creates the fault-tolerant environment. In fact, LVM striping may increase the chance of a file being lost due to a hard drive failure. A single disk failure can result in multiple logical volumes being inaccessible.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h4 class="calibre25">Mirroring</h4>
<p class="calibre10">Just because you install a filesystem using LVM doesn't mean that things can't still go wrong in the filesystem. Just as in a physical partition, LVM logical volumes are susceptible to power outages and disk crashes. After a filesystem becomes corrupt, there's always a possibility that you won't be able to recover it.</p>
<p class="calibre10"><span type="pagebreak" title="203" id="calibre_link-543" class="calibre11"></span>The LVM snapshot process provides some comfort knowing that you can create a backup copy of a logical volume at any time, but for some environments that may not be enough. Systems that have lots of data changes, such as database servers, may store hundreds or thousands of records since the last snapshot.</p>
<p class="calibre10">A solution to this problem is the LVM <i class="calibre12">mirror</i>. A mirror is a complete copy of a logical volume that's updated in real time. When you create the mirror logical volume, LVM synchronizes the original logical volume to the mirror copy. Depending on the size of the original logical volume, this may take some time to complete.</p>
<p class="calibre10">After the original synchronization is complete, LVM performs two writes for each write process in the filesystem &mdash; one to the main logical volume and one to the mirrored copy. As you can guess, this process does slow down write performance on the system. However, if the original logical volume should become corrupt for some reason, you have a complete up-to-date copy at your fingertips!</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using the Linux LVM</h3>
<p class="calibre10">Now that you've seen what the Linux LVM can do, this section discusses how to implement it to help organize the disk space on your system. The Linux LVM package only provides command line programs for creating and managing all the components in the logical volume management system. Some Linux distributions include graphical front-ends to the command line commands, but for complete control of your LVM environment, it's best to get comfortable working directly with the commands.</p>
<section class="toclist">
<h4 class="calibre25">Defining Physical Volumes</h4>
<p class="calibre10">The first step in the process is to convert the physical partitions on the hard drive into physical volume extents used by the Linux LVM. Our friend the <code class="calibre26">fdisk</code> command helps us here. After creating the basic Linux partition, you need to change the partition type using the <code class="calibre26">t</code> command:</p>
<pre class="calibre29"><code class="calibre26">[...]
Command (m for help): <code class="calibre26"><b class="calibre21">t</b></code>
Selected partition 1
Hex code (type L to list codes): <code class="calibre26"><b class="calibre21">8e</b></code>
Changed system type of partition 1 to 8e (Linux LVM)
Command (m for help): <code class="calibre26"><b class="calibre21">p</b></code>
Disk /dev/sdb: 5368 MB, 5368709120 bytes
255 heads, 63 sectors/track, 652 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0xa8661341
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1         262     2104483+  8e  Linux LVM
Command (m for help): <code class="calibre26"><b class="calibre21">w</b></code>
The partition table has been altered!
Calling ioctl() to re-read partition table.
Syncing disks.
$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="204" id="calibre_link-544" class="calibre11"></span>The <code class="calibre26">8e</code> partition type denotes that the partition will be used as part of a Linux LVM system and not as a direct filesystem, as you saw with the <code class="calibre26">83</code> partition type earlier.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If the <code class="calibre26">pvcreate</code> command in the next step does not work for you, it's most likely due to the LVM2 package not being installed by default. To install the package, use the package name lvm2 and see Chapter 9 for how to install software packages.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The next step is to use the partition to create the actual physical volume. That's done using the <code class="calibre26">pvcreate</code> command. The <code class="calibre26">pvcreate</code> command defines the physical partition to use for the PV. It simply tags the partition as a physical volume in the Linux LVM system:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo pvcreate /dev/sdb1</b></code>
  dev_is_mpath: failed to get device for 8:17
  Physical volume "/dev/sdb1" successfully created
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Don't let the daunting message <code class="calibre26">dev_is_mpath: failed to get device for 8:17</code> or similar messages frighten you. As long as you receive the <code class="calibre26">successfully created</code> message, all is well. The <code class="calibre26">pvcreate</code> command checks to see whether the partition is a multi-path (mpath) device. If it is not, it issues the daunting message.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can use the <code class="calibre26">pvdisplay</code> command to display a list of physical volumes you've created if you'd like to see your progress along the way:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo pvdisplay /dev/sdb1</b></code>
  "/dev/sdb1" is a new physical volume of "2.01 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sdb1
  VG Name
  PV Size               2.01 GiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               0FIuq2-LBod-IOWt-8VeN-tglm-Q2ik-rGU2w7
$</code></pre>
<p class="calibre10">The <code class="calibre26">pvdisplay</code> command shows that <code class="calibre26">/dev/sdb1</code> is now tagged as a PV. Notice, however, that in the output, the <code class="calibre26">VG Name</code> is blank. The PV does not yet belong to a volume group.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating Volume Groups</h4>
<p class="calibre10"><span type="pagebreak" title="205" id="calibre_link-545" class="calibre11"></span>The next step in the process is to create one or more volume groups from the physical volumes. There are no set rules for how many volume groups you need to create for your system &mdash; you can add all the available physical volumes to a single volume group, or you can create multiple volume groups by combining different physical volumes.</p>
<p class="calibre10">To create the volume group from the command line, you need to use the <code class="calibre26">vgcreate</code> command. The <code class="calibre26">vgcreate</code> command requires a few command line parameters to define the volume group name, as well as the name of the physical volumes you're using to create the volume group:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo vgcreate Vol1 /dev/sdb1</b></code>
  Volume group "Vol1" successfully created
$</code></pre>
<p class="calibre10">That's not all too exciting for output! If you'd like to see some details about the newly created volume group, use the <code class="calibre26">vgdisplay</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo vgdisplay Vol1</b></code>
  --- Volume group ---
  VG Name               Vol1
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               2.00 GiB
  PE Size               4.00 MiB
  Total PE              513
  Alloc PE / Size       0 / 0
  Free  PE / Size       513 / 2.00 GiB
  VG UUID               oe4I7e-5RA9-G9ti-ANoI-QKLz-qkX4-58Wj6e
$</code></pre>
<p class="calibre10">This example creates a volume group named <code class="calibre26">Vol1</code>, using the physical volume created on the <code class="calibre26">/dev/sdb1</code> partition.</p>
<p class="calibre10"><span type="pagebreak" title="206" id="calibre_link-546" class="calibre11"></span>Now that you have one or more volume groups created, you're ready to create the logical volume.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating Logical Volumes</h4>
<p class="calibre10">The logical volume is what the Linux system uses to emulate a physical partition, and it holds the filesystem. The Linux system handles the logical volumes just like a physical partition, allowing you to define filesystems in the logical volume and then mount the filesystem into the virtual directory.</p>
<p class="calibre10">To create the logical volume, use the <code class="calibre26">lvcreate</code> command. Although you can usually get away without using command line options in the other Linux LVM commands, the <code class="calibre26">lvcreate</code> command requires at least some options to be entered. <a id="calibre_link-1236" href="#calibre_link-1129" class="calibre4">Table 8.5</a> shows the available command line options.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1129" href="#calibre_link-1236" class="calibre4"><b class="calibre21">Table 8.5</b></a></span> The lvcreate Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Long Option Name</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left"><code class="calibre26">--chunksize</code></td>
<td class="left">Specifies the chunksize of the snapshot logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-C</code></td>
<td class="left"><code class="calibre26">--contiguous</code></td>
<td class="left">Sets or resets the contiguous allocation policy</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left"><code class="calibre26">--stripes</code></td>
<td class="left">Specifies the number of stripes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-I</code></td>
<td class="left"><code class="calibre26">--stripsize</code></td>
<td class="left">Specifies the size of each stripe</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-l</code></td>
<td class="left"><code class="calibre26">--extents</code></td>
<td class="left">Specifies the number of logical extents to allocate to a new logical volume or the percent of the logical extents to use</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-L</code></td>
<td class="left"><code class="calibre26">--size</code></td>
<td class="left">Specifies the disk size to allocate to a new logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"></td>
<td class="left"><code class="calibre26">--minor</code></td>
<td class="left">Specifies the minor number of the device</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-m</code></td>
<td class="left"><code class="calibre26">--mirrors</code></td>
<td class="left">Creates a mirrored logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-M</code></td>
<td class="left"><code class="calibre26">--persistent</code></td>
<td class="left">Makes the minor number persistent</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left"><code class="calibre26">--name</code></td>
<td class="left">Specifies the name of the new logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code></td>
<td class="left"><code class="calibre26">--permission</code></td>
<td class="left">Sets read/write permission for the logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left"><code class="calibre26">--readahead</code></td>
<td class="left">Sets the read ahead sector count</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-R</code></td>
<td class="left"><code class="calibre26">--regionsize</code></td>
<td class="left">Specifies the size to divide the mirror regions into</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left"><code class="calibre26">--snapshot</code></td>
<td class="left">Creates a snapshot logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-Z</code></td>
<td class="left"><code class="calibre26">--zero</code></td>
<td class="left">Sets the first 1KB of data on the new logical volume to zeros</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="207" id="calibre_link-547" class="calibre11"></span>Although the command line options may look intimidating, for most situations, you can get by with a minimal amount of options:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo lvcreate -l 100%FREE -n lvtest Vol1</b></code>
  Logical volume "lvtest" created
$</code></pre>
<p class="calibre10">If you want to see the details of what you created, use the <code class="calibre26">lvdisplay</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo lvdisplay Vol1</b></code>
  --- Logical volume ---
  LV Path                /dev/Vol1/lvtest
  LV Name                lvtest
  VG Name                Vol1
  LV UUID                4W2369-pLXy-jWmb-lIFN-SMNX-xZnN-3KN208
  LV Write Access        read/write
  LV Creation host, time ... -0400
  LV Status              available
  # open                 0
  LV Size                2.00 GiB
  Current LE             513
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:2
$</code></pre>
<p class="calibre10">Now you can see just what you created! Notice that the volume group name (<code class="calibre26">Vol1</code>) is used to identify the volume group to use when creating the new logical volume.</p>
<p class="calibre10">The <code class="calibre26">-l</code> parameter defines how much of the available space on the volume group specified to use for the logical volume. Notice that you can specify the value as a percent of the free space in the volume group. This example used all (100%) of the free space for the new logical volume.</p>
<p class="calibre10">You can use the <code class="calibre26">-l</code> parameter to specify the size as a percentage of the available space or the <code class="calibre26">-L</code> parameter to specify the actual size in bytes, kilobytes (KB), megabytes (MB), or gigabytes (GB). The <code class="calibre26">-n</code> parameter allows you to provide a name for the logical volume (called <code class="calibre26">lvtest</code> in this example).</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating the Filesystem</h4>
<p class="calibre10"><span type="pagebreak" title="208" id="calibre_link-548" class="calibre11"></span>After you run the <code class="calibre26">lvcreate</code> command, the logical volume exists but doesn't have a filesystem. To do that, you need to use the appropriate command line program for the filesystem you want to create:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo mkfs.ext4 /dev/Vol1/lvtest</b></code>
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
131376 inodes, 525312 blocks
26265 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=541065216
17 block groups
32768 blocks per group, 32768 fragments per group
7728 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912
	
Writing inode tables: done
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done
This filesystem will be automatically checked every 28 mounts or
180 days, whichever comes first.Use tune2fs -c or -i to override.
$</code></pre>
<p class="calibre10">After you've created the new filesystem, you can mount the volume in the virtual directory using the standard Linux mount command, just as if it were a physical partition. The only difference is that you use a special path that identifies the logical volume:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo mount /dev/Vol1/lvtest /mnt/my_partition</b></code>
$
$ <code class="calibre26"><b class="calibre21">mount</b></code>
/dev/mapper/vg_server01-lv_root on / type ext4 (rw)
[...]
/dev/mapper/Vol1-lvtest on /mnt/my_partition type ext4 (rw)
$
$ <code class="calibre26"><b class="calibre21">cd /mnt/my_partition</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -al</b></code>
total 24
drwxr-xr-x. 3 root root  4096 Jun 12 10:22 .
drwxr-xr-x. 3 root root  4096 Jun 11 09:58 ..
drwx------. 2 root root 16384 Jun 12 10:22 lost+found
$</code></pre>
<p class="calibre10">Notice that the path used in both the <code class="calibre26">mkfs.ext4</code> and <code class="calibre26">mount</code> commands is a little odd. Instead of a physical partition path, the path uses the volume group name, along with the logical volume name. After the filesystem is mounted, you can access the new area in the virtual directory.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Modifying the LVM</h4>
<p class="calibre10"><span type="pagebreak" title="209" id="calibre_link-549" class="calibre11"></span>Because the benefit of using the Linux LVM is to dynamically modify filesystems, you'd expect that some tools would allow you to do that. Some tools are available in Linux that allow you to modify the existing logical volume management configuration.</p>
<p class="calibre10">If you don't have access to a fancy graphical interface for managing your Linux LVM environment, all is not lost. You've already seen some of the Linux LVM command line programs in action in this chapter. You can use a host of other command line programs to manage the LVM setup after you've installed it. <a id="calibre_link-1237" href="#calibre_link-1130" class="calibre4">Table 8.6</a> lists the common commands that are available in the Linux LVM package.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1130" href="#calibre_link-1237" class="calibre4"><b class="calibre21">Table 8.6</b></a></span> The Linux LVM Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vgchange</code></td>
<td class="left">Activates and deactivates a volume group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vgremove</code></td>
<td class="left">Removes a volume group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vgextend</code></td>
<td class="left">Adds physical volumes to a volume group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vgreduce</code></td>
<td class="left">Removes physical volumes from a volume group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">lvextend</code></td>
<td class="left">Increases the size of a logical volume</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">lvreduce</code></td>
<td class="left">Decreases the size of a logical volume</td>
</tr>
</table>
</figure>
<p class="calibre10">Using these command line programs, you have full control over your Linux LVM environment.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Be careful when manually increasing or decreasing the size of a logical volume. The filesystem stored in the logical volume must be manually fixed to handle the change in size. Most filesystems include command line programs for reformatting the filesystem, such as the <code class="calibre26">resize2fs</code> program for the ext2, ext3, and ext4 filesystems.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-176" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="210" id="calibre_link-550" class="calibre11"></span>Working with storage devices in Linux requires that you know a little bit about filesystems. Knowing how to create and work with filesystems from the command line can come in handy as you work on Linux systems. This chapter discussed how to handle filesystems from the Linux command line.</p>
<p class="calibre10">The Linux system is different from Windows in that it supports lots of different methods for storing files and folders. Each filesystem method has different features that make it ideal for different situations. Also, each filesystem method uses different commands for interacting with the storage device.</p>
<p class="calibre10">Before you can install a filesystem on a storage device, you must first prepare the device. The <code class="calibre26">fdisk</code> command is used to partition storage devices to get them ready for the filesystem. When you partition the storage device, you must define what type of filesystem will be used on it.</p>
<p class="calibre10">After you partition a storage device, you can use one of several different filesystems for the partition. Popular Linux filesystems include ext4 and XFS. Both of these filesystems provide journaling filesystem features, making them less prone to errors and problems if the Linux system should crash.</p>
<p class="calibre10">One limiting factor to creating filesystems directly on a storage device partition is that you can't easily change the size of the filesystem if you run out of disk space. However, Linux supports logical volume management, a method of creating virtual partitions across multiple storage devices. This method allows you to easily expand an existing filesystem without having to completely rebuild it. The Linux LVM package provides command line commands to create logical volumes across multiple storage devices on which to build filesystems.</p>
<p class="calibre10">Now that you've seen the core Linux command line commands, it's close to the time to start creating some shell script programs. However, before you start coding, we need to discuss another element: installing software. If you plan to write shell scripts, you need an environment in which to create your masterpieces. The next chapter discusses how to install and manage software packages from the command line in different Linux environments.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1241">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-177" class="calibre4"></a><span class="chaptertitle">Chapter 9</span><br class="calibre22" /><span class="chaptertitle">Installing Software</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Installing software</li>
<li class="calibre7">Using Debian packages</li>
<li class="calibre7">Working with Red Hat packages</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="211" id="calibre_link-551" class="calibre11"></span>In the old days of Linux, installing software could be a painful experience. Fortunately, the Linux developers have made life a little easier for us by bundling software into pre-built packages that are much easier to install. However, you still have a little work to do to get the software packages installed, especially if you want to do that from the command line. This chapter looks at the various Package Management Systems available in Linux and the command line tools used for software installation, management, and removal.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-178" class="calibre4"></a>Package Management Primer</h2>
<p class="calibre10">Before diving into the world of Linux software package management, this chapter goes through a few of the basics first. Each of the major Linux distributions utilizes some form of a Package Management System (PMS) to control installing software applications and libraries. A PMS utilizes a database that keeps track of these items:</p>
<ul class="calibre14">
<li class="calibre7">What software packages are installed on the Linux system</li>
<li class="calibre7">What files have been installed for each package</li>
<li class="calibre7">Versions of each of the software packages installed</li>
</ul>
<p class="calibre10">Software packages are stored on servers, called <i class="calibre12">repositories</i>, and are accessed across the Internet via PMS utilities running on your local Linux system. You can use the PMS utilities to search for new software packages or even updates to software packages already installed on the system.</p>
<p class="calibre10">A software package often has <i class="calibre12">dependencies</i> or other packages that must be installed first for the software to run properly. The PMS utilities detect these dependencies and offer to install any additionally needed software packages before installing the desired package.</p>
<p class="calibre10"><span type="pagebreak" title="212" id="calibre_link-552" class="calibre11"></span>The downside to PMS is that there isn't a single standard utility. Whereas all the <code class="calibre26">bash</code> shell commands discussed so far in this book work no matter which Linux distribution you use, this is not true with software package management.</p>
<p class="calibre10">The PMS utilities and their associated commands are vastly different between the various Linux distributions. The two primary PMS base utilities commonly used in the Linux world are <code class="calibre26">dpkg</code> and <code class="calibre26">rpm</code>.</p>
<p class="calibre10">Debian-based distributions such as Ubuntu and Linux Mint use, at the base of their PMS utilities, the <code class="calibre26">dpkg</code> command. This command interacts directly with the PMS on the Linux system and is used for installing, managing, and removing software packages.</p>
<p class="calibre10">The Red Hat&ndash;based distributions, such as Fedora, openSUSE, and Mandriva, use the <code class="calibre26">rpm</code> command at the base of their PMS. Similar to the <code class="calibre26">dpkg</code> command, the <code class="calibre26">rpm</code> command can list installed packages, install new packages, and remove existing software.</p>
<p class="calibre10">Note that these two commands are the core of their respective PMS, not the entire PMS itself. Many Linux distributions that use the <code class="calibre26">dpkg</code> or <code class="calibre26">rpm</code> methods have built additional specialty PMS utilities upon these base commands to help make your life much easier. The following sections walk through various PMS utility commands you'll run into in the popular Linux distributions.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-179" class="calibre4"></a>The Debian-Based Systems</h2>
<p class="calibre10">The <code class="calibre26">dpkg</code> command is at the core of the Debian-based family of PMS tools. These other tools are included in this PMS:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">apt-get</code></li>
<li class="calibre7"><code class="calibre26">apt-cache</code></li>
<li class="calibre7"><code class="calibre26">aptitude</code></li>
</ul>
<p class="calibre10">By far the most common command line tool is aptitude, and for good reason. The aptitude tool is essentially a front-end for both the apt tools and <code class="calibre26">dpkg</code>. Whereas <code class="calibre26">dpkg</code> is a PMS tool, aptitude is a complete Package Management System.</p>
<p class="calibre10">Using the <code class="calibre26">aptitude</code> command at the command line helps you avoid common software installation problems, such as missing software dependencies, unstable system environments, and just a whole lot of unnecessary hassle. This section looks at how to use the <code class="calibre26">aptitude</code> command tool from the Linux command line.</p>
<section class="toclist">
<h3 class="calibre15">Managing packages with aptitude</h3>
<p class="calibre10">A common task faced by Linux system administrators is to determine what packages are already installed on the system. Fortunately, aptitude has a handy interactive interface that makes this task an easy one.</p>
<p class="calibre10"><span type="pagebreak" title="213" id="calibre_link-553" class="calibre11"></span>If you have aptitude installed in your Linux distribution, at the shell prompt just type <code class="calibre26">aptitude</code> and press Enter. You are thrown into aptitude's full-screen mode, as you can see in <a id="calibre_link-1242" href="#calibre_link-1078" class="calibre4">Figure 9.1</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000033.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1078" href="#calibre_link-1242" class="calibre4"><b class="calibre21">Figure 9.1</b></a></span> The aptitude main window</p>
</figcaption>
</figure>
<p class="calibre10">Use the arrow keys to maneuver around the menu. Select the menu option Installed Packages to see what packages are installed. You will see several groups of software packages, such as editors, and so on. A number in parentheses follows each group, which indicates the number of packages the group contains.</p>
<p class="calibre10">Use the arrow keys to highlight a group, and press Enter to see each subgroup of packages. You then see the individual package names and their version numbers. Press Enter on individual packages to get very detailed information, such as the package's description, home page, size, maintainer, and so on.</p>
<p class="calibre10">When you're finished viewing the installed packages, press <code class="calibre26">q</code> to quit the display. You can then go back to the arrow keys. and use Enter to toggle open or closed the packages and their subgroups. When you are all finished, just press <code class="calibre26">q</code> multiple times until you receive the pop-up screen âReally quit Aptitude?â</p>
<p class="calibre10">If you already know the packages on your system and want to quickly display detailed information about a particular package, you don't need to go into aptitude's interactive interface. You can use aptitude as a single command at the command line:</p>
<pre class="calibre29"><code class="calibre26">aptitude show <i class="calibre12">package_name</i></code></pre>
<p class="calibre10"><span type="pagebreak" title="214" id="calibre_link-554" class="calibre11"></span>Here's an example of displaying the details of the package <code class="calibre26">mysql-client</code>:</p>
<pre class="calibre29"><code class="calibre26">$ aptitude show mysql-client
Package: mysql-client
State: not installed
Version: 5.5.38-0ubuntu0.14.04.1
Priority: optional
Section: database
Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;
Architecture: all
Uncompressed Size: 129 k
Depends: mysql-client-5.5
Provided by: mysql-client-5.5
Description: MySQL database client (metapackage depending on the latest version)
 This is an empty package that depends on the current ''best'' version of
 mysql-client (currently mysql-client-5.5), as determined by the MySQL
 maintainers.  Install this package if in doubt about which MySQL version you
 want, as this is the one considered to be in the best shape by the Maintainers.
Homepage: http://dev.mysql.com/
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">aptitude show</code> command indicates that the package is not installed on the system. It also shows detailed package information from the software repository.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">One detail you cannot get with <code class="calibre26">aptitude</code> is a listing of all the files associated with a particular software package. To get this list, you must go to the <code class="calibre26">dpkg</code> tool itself:</p>
<pre class="calibre29"><code class="calibre26">dpkg -L <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">Here's an example of using <code class="calibre26">dpkg</code> to list all the files installed as part of the <code class="calibre26">vim-common</code> package:</p>
<pre class="calibre29"><code class="calibre26">$
$ dpkg -L vim-common
/.
/usr
/usr/bin
/usr/bin/xxd
/usr/bin/helpztags
/usr/lib
/usr/lib/mime
/usr/lib/mime/packages
/usr/lib/mime/packages/vim-common
/usr/share
/usr/share/man
/usr/share/man/ru
/usr/share/man/ru/man1
/usr/share/man/ru/man1/vim.1.gz
/usr/share/man/ru/man1/vimdiff.1.gz
/usr/share/man/ru/man1/xxd.1.gz
/usr/share/man/it
/usr/share/man/it/man1
[...]
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="215" id="calibre_link-555" class="calibre11"></span>You can also do the reverse &mdash; find what package a particular file belongs to:</p>
<pre class="calibre29"><code class="calibre26">dpkg --search <i class="calibre12">absolute_file_name</i></code></pre>
<p class="calibre10">Note that you need to use an absolute file reference for this to work:</p>
<pre class="calibre29"><code class="calibre26">$
$ dpkg --search /usr/bin/xxd
vim-common: /usr/bin/xxd
$</code></pre>
<p class="calibre10">The output shows the <code class="calibre26">/usr/bin/xxd</code> file was installed as part of the vim-common package.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Installing software packages with aptitude</h3>
<p class="calibre10">Now that you know more about listing software package information on your system, this section walks through a software package install. First, you'll want to determine the package name to install. How do you find a particular software package? Use the <code class="calibre26">aptitude</code> command with the search option:</p>
<pre class="calibre29"><code class="calibre26">aptitude search <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">The beauty of the search option is that you do not need to insert wildcards around <i class="calibre12">package_name</i>. Wildcards are implied. Here's an example of using <code class="calibre26">aptitude</code> to look for the wine software package:</p>
<pre class="calibre29"><code class="calibre26">$
$ aptitude search wine
p   gnome-wine-icon-theme           - red variation of the GNOME- ...
v   libkwineffects1-api             -
p   libkwineffects1a                - library used by effects...
p   q4wine                          - Qt4 GUI for wine (W.I.N.E)
p   shiki-wine-theme                - red variation of the Shiki- ...
p   wine                            - Microsoft Windows Compatibility ...
p   wine-dev                        - Microsoft Windows Compatibility ...
p   wine-gecko                      - Microsoft Windows Compatibility ...
p   wine1.0                         - Microsoft Windows Compatibility ...
p   wine1.0-dev                     - Microsoft Windows Compatibility ...
p   wine1.0-gecko                   - Microsoft Windows Compatibility ...
p   wine1.2                         - Microsoft Windows Compatibility ...
p   wine1.2-dbg                     - Microsoft Windows Compatibility ...
p   wine1.2-dev                     - Microsoft Windows Compatibility ...
p   wine1.2-gecko                   - Microsoft Windows Compatibility ...
p   winefish                        - LaTeX Editor based on Bluefish
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="216" id="calibre_link-556" class="calibre11"></span>Notice that before each package name is either a <code class="calibre26">p</code> or <code class="calibre26">i</code>. If you see an <code class="calibre26">i u</code>, the package is currently installed on your system. If you see a <code class="calibre26">p </code>or <code class="calibre26">v</code>, it is available but not installed. As you can see from the preceding listing, this system does not have wine currently installed, but the package is available from the software repository.</p>
<p class="calibre10">Installing a software package on a system from a repository using <code class="calibre26">aptitude</code> is as easy as this:</p>
<pre class="calibre29"><code class="calibre26">aptitude install <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">After you find the software package name from the search option, just plug it into the <code class="calibre26">aptitude</code> command using the install option:</p>
<pre class="calibre29"><code class="calibre26">$
$ sudo aptitude install wine
The following NEW packages will be installed:
  cabextract{a} esound-clients{a} esound-common{a} gnome-exe-thumbnailer
{a}
  icoutils{a} imagemagick{a} libaudio2{a} libaudiofile0{a} libcdt4{a}
  libesd0{a} libgraph4{a} libgvc5{a} libilmbase6{a} libmagickcore3-extra
{a}
  libmpg123-0{a} libnetpbm10{a} libopenal1{a} libopenexr6{a}
  libpathplan4{a} libxdot4{a} netpbm{a} ttf-mscorefonts-installer{a}
  ttf-symbol-replacement{a} winbind{a} wine wine1.2{a} wine1.2-gecko{a}
0 packages upgraded, 27 newly installed, 0 to remove and 0 not upgraded.
Need to get 0B/27.6MB of archives. After unpacking 121MB will be used.
Do you want to continue? [Y/n/?] Y
Preconfiguring packages ...
[...]
All done, no errors.
All fonts downloaded and installed.
Updating fontconfig cache for /usr/share/fonts/truetype/msttcorefonts
Setting up winbind (2:3.5.4~dfsg-1ubuntu7) ...
 * Starting the Winbind daemon winbind
 [ OK ]
Setting up wine (1.2-0ubuntu5) ...
Setting up gnome-exe-thumbnailer (0.6-0ubuntu1) ...
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Before the <code class="calibre26">aptitude</code> command in the preceding listing, the <code class="calibre26">sudo</code> command is used. The <code class="calibre26">sudo</code> command allows you to run a command as the root user. You can use the <code class="calibre26">sudo</code> command to run administrative tasks, such as installing software.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="217" id="calibre_link-557" class="calibre11"></span>To check if the installation processed properly, just use the <code class="calibre26">search</code> option again. This time you should see an <code class="calibre26">i u</code> listed in front of the wine software package, indicating it is installed.</p>
<p class="calibre10">You may also notice that there are additional packages with the <code class="calibre26">i u</code> in front of them. This is because <code class="calibre26">aptitude</code> automatically resolved any necessary package dependencies for us and installs the needed additional library and software packages. This is a wonderful feature included in many Package Management Systems.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Updating software with aptitude</h3>
<p class="calibre10">While <code class="calibre26">aptitude</code> helps protect you from problems installing software, trying to coordinate a multiple-package update with dependencies can get tricky. To safely update all the software packages on a system with any new versions in the repository, use the <code class="calibre26">safe-upgrade</code> option:</p>
<pre class="calibre29"><code class="calibre26">aptitude safe-upgrade</code></pre>
<p class="calibre10">Notice that this command doesn't take a software package name as an argument. That's because the <code class="calibre26">safe-upgrade</code> option upgrades all the installed packages to the most recent version available in the repository, which is safer for system stabilization.</p>
<p class="calibre10">Here's a sample output from running the <code class="calibre26">aptitude safe-update</code> command:</p>
<pre class="calibre29"><code class="calibre26">$
$ sudo aptitude safe-upgrade
The following packages will be upgraded:
  evolution evolution-common evolution-plugins gsfonts libevolution
  xserver-xorg-video-geode
6 packages upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 9,312kB of archives. After unpacking 0B will be used.
Do you want to continue? [Y/n/?] Y
Get:1 http://us.archive.ubuntu.com/ubuntu/ maverick/main
 libevolution i386 2.30.3-1ubuntu4 [2,096kB]
[...]
Preparing to replace xserver-xorg-video-geode 2.11.9-2
(using .../xserver-xorg-video-geode_2.11.9-3_i386.deb) ...
Unpacking replacement xserver-xorg-video-geode ...
Processing triggers for man-db ...
Processing triggers for desktop-file-utils ...
Processing triggers for python-gmenu ...
[...]
Current status: 0 updates [-6].
$</code></pre>
<p class="calibre10">You can also use less-conservative options for software upgrades:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">aptitude full-upgrade</code></li>
<li class="calibre7"><code class="calibre26">aptitude dist-upgrade</code></li>
</ul>
<p class="calibre10"><span type="pagebreak" title="218" id="calibre_link-558" class="calibre11"></span>These options perform the same task, upgrading all the software packages to the latest versions. Where they differ from <code class="calibre26">safe-upgrade</code> is that they do not check dependencies between packages. The whole package dependency issue can get real ugly. If you're not exactly sure of the dependencies for the various packages, stick with the <code class="calibre26">safe-upgrade</code> option.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Obviously, running aptitude's <code class="calibre26">safe-upgrade</code> option is something you should do on a regular basis to keep your system up to date. However, it is especially important to run it after a fresh distribution installation. Usually, lots of security patches and updates have been released since the last full release of a distribution.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Uninstalling software with aptitude</h3>
<p class="calibre10">Getting rid of software packages with aptitude is as easy as installing and upgrading them. The only real choice you have to make is whether to keep the software's data and configuration files around afterward.</p>
<p class="calibre10">To remove a software package, but not the data and configuration files, use the <code class="calibre26">remove</code> option of aptitude. To remove a software package and the related data and configuration files, use the <code class="calibre26">purge</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ sudo aptitude purge wine
[sudo] password for user:
The following packages will be REMOVED:
  cabextract{u} esound-clients{u} esound-common{u} gnome-exe-thumbnailer
{u}
  icoutils{u} imagemagick{u} libaudio2{u} libaudiofile0{u} libcdt4{u}
  libesd0{u} libgraph4{u} libgvc5{u} libilmbase6{u} libmagickcore3-extra
{u}
  libmpg123-0{u} libnetpbm10{u} libopenal1{u} libopenexr6{u}
  libpathplan4{u} libxdot4{u} netpbm{u} ttf-mscorefonts-installer{u}
  ttf-symbol-replacement{u} winbind{u} wine{p} wine1.2{u} wine1.2-gecko
{u}
0 packages upgraded, 0 newly installed, 27 to remove and 6 not upgraded.
Need to get 0B of archives. After unpacking 121MB will be freed.
Do you want to continue? [Y/n/?] Y
(Reading database ... 120968 files and directories currently installed.)
Removing ttf-mscorefonts-installer ...
[...]
Processing triggers for fontconfig ...
Processing triggers for ureadahead ...
Processing triggers for python-support ...
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="219" id="calibre_link-559" class="calibre11"></span>To see if the package has been removed, you can use the <code class="calibre26">aptitude search</code> option again. If you see a <code class="calibre26">c</code> in front of the package name, it means the software has been removed, but the configuration files have not been purged from the system. A <code class="calibre26">p</code> in front indicates the configuration files have also been removed.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The aptitude repositories</h3>
<p class="calibre10">The default software repository locations for <code class="calibre26">aptitude</code> are set up for you when you install your Linux distribution. The repository locations are stored in the file <code class="calibre26">/etc/apt/sources.list</code>.</p>
<p class="calibre10">In many cases, you never need to add/remove a software repository so you don't need to touch this file. However, <code class="calibre26">aptitude</code> pulls software from only these repositories. Also, when searching for software to install or update, aptitude checks only these repositories. If you need to include some additional software repositories for your PMS, this is the place to do it.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">The Linux distribution developers work hard to make sure package versions added to the repositories don't conflict with one another. Usually it's safest to upgrade or install a software package from the repository. Even if a newer version is available elsewhere, you may want to hold off installing it until that version is available in your Linux distribution's repository</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The following is an example of a <code class="calibre26">sources.list</code> file from an Ubuntu system:</p>
<pre class="calibre29"><code class="calibre26">$ cat /etc/apt/sources.list
#deb cdrom:[Ubuntu 14.04 LTS _Trusty Tahr_ - Release i386 (20140417)]/
 trusty main restricted
 
# See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to
# newer versions of the distribution.
deb http://us.archive.ubuntu.com/ubuntu/ trusty main restricted
deb-src http://us.archive.ubuntu.com/ubuntu/ trusty main restricted
## Major bug fix updates produced after the final release of the
## distribution.
deb http://us.archive.ubuntu.com/ubuntu/ trusty-updates main restricted
deb-src http://us.archive.ubuntu.com/ubuntu/ trusty-updates main restricted
## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu
## team. Also, please note that software in universe WILL NOT receive any
## review or updates from the Ubuntu security team.
deb http://us.archive.ubuntu.com/ubuntu/ trusty universe
deb-src http://us.archive.ubuntu.com/ubuntu/ trusty universe
deb http://us.archive.ubuntu.com/ubuntu/ trusty-updates universe
deb-src http://us.archive.ubuntu.com/ubuntu/ trusty-updates universe
[...]
## Uncomment the following two lines to add software from Canonical's
## 'partner' repository.
## This software is not part of Ubuntu, but is offered by Canonical and the
## respective vendors as a service to Ubuntu users.
# deb http://archive.canonical.com/ubuntu trusty partner
# deb-src http://archive.canonical.com/ubuntu trusty partner
## This software is not part of Ubuntu, but is offered by third-party
## developers who want to ship their latest software.
deb http://extras.ubuntu.com/ubuntu trusty main
deb-src http://extras.ubuntu.com/ubuntu trusty main
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="220" id="calibre_link-560" class="calibre11"></span>First, notice that the file is full of helpful comments and warnings. The repository sources specified use the following structure:</p>
<pre class="calibre29"><code class="calibre26">deb (or deb-src) <i class="calibre12">address  distribution_name  package_type_list</i></code></pre>
<p class="calibre10">The <code class="calibre26">deb</code> or <code class="calibre26">deb-src</code> value indicates the software package type. The <code class="calibre26">deb</code> value indicates it is a source of compiled programs, whereas the <code class="calibre26">deb-src</code> value indicates it is a source of source code.</p>
<p class="calibre10">The <code class="calibre26">address</code> entry is the software repository's web address. The <code class="calibre26">distribution_name</code> entry is the name of this particular software repository's distribution's version. In the example, the distribution name is <code class="calibre26">trusty</code>. This does not necessarily mean that the distribution you are running is Ubuntu's Trusty Tahr; it just means the Linux distribution is using the Ubuntu Trusty Tahr software repositories! For example, in Linux Mint's <code class="calibre26">sources.list</code> file, you see a mix of Linux Mint and Ubuntu software repositories.</p>
<p class="calibre10">Finally, the <code class="calibre26">package_type_list</code> entry may be more than one word and indicates what type of packages the repository has in it. For example, you may see values such as main, restricted, universe, or partner.</p>
<p class="calibre10">When you need to add a software repository to your sources file, you can try to wing it yourself, but that more than likely will cause problems. Often, software repository sites or various package developer sites have an exact line of text that you can copy from their website and paste into your <code class="calibre26">sources.list</code> file. It's best to choose the safer route and just copy/paste.</p>
<p class="calibre10">The front-end interface, <code class="calibre26">aptitude</code>, provides intelligent command line options for working with the Debian-based <code class="calibre26">dpkg</code> utility. Now it's time to look at the Red Hat&ndash;based distributions' <code class="calibre26">rpm</code> utility and its various front-end interfaces.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-180" class="calibre4"></a>The Red Hat&ndash;Based Systems</h2>
<p class="calibre10"><span type="pagebreak" title="221" id="calibre_link-561" class="calibre11"></span>Like the Debian-based distributions, the Red Hat&ndash;based systems have several different front-end tools that are available. These are the common ones:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">yum</code>: Used in Red Hat and Fedora</li>
<li class="calibre7"><code class="calibre26">urpm</code>: Used in Mandriva</li>
<li class="calibre7"><code class="calibre26">zypper</code>: Used in openSUSE</li>
</ul>
<p class="calibre10">These front-ends are all based on the <code class="calibre26">rpm</code> command line tool. The following section discusses how to manage software packages using these various rpm-based tools. The focus is on <code class="calibre26">yum</code>, but information is also included for <code class="calibre26">zypper</code> and <code class="calibre26">urpm</code>.</p>
<section class="toclist">
<h3 class="calibre15">Listing installed packages</h3>
<p class="calibre10">To find out what is currently installed on your system, at the shell prompt, type the following command:</p>
<pre class="calibre29"><code class="calibre26">yum list installed</code></pre>
<p class="calibre10">The information will probably whiz by you on the display screen, so it's best to redirect the installed software listing into a file. You can then use the <code class="calibre26">more</code> or <code class="calibre26">less</code> command (or a GUI editor) to look at the list in a controlled manner.</p>
<pre class="calibre29"><code class="calibre26">yum list installed &gt; installed_software</code></pre>
<p class="calibre10">To list out the installed packages on your openSUSE or Mandriva distribution, see the commands in <a id="calibre_link-1243" href="#calibre_link-1131" class="calibre4">Table 9.1</a>. Unfortunately, the <code class="calibre26">urpm</code> tool used in Mandriva cannot produce a currently installed software listing. Thus, you need to revert to the underlying <code class="calibre26">rpm</code> tool.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1131" href="#calibre_link-1243" class="calibre4"><b class="calibre21">Table 9.1</b></a></span> How to List Installed Software with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Distribution</td>
<td class="left">Front-End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left">Mandriva</td>
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">rpm -qa &gt; installed_software</code></td>
</tr>
<tr class="calibre28">
<td class="left">openSUSE</td>
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zipper search -I &gt; installed_software</code></td>
</tr>
</table>
</figure>
<p class="calibre10">To find out detailed information for a particular software package, <code class="calibre26">yum</code> really shines. It gives you a very verbose description of the package, and with another simple command, you can see whether the package is installed:</p>
<pre class="calibre29"><code class="calibre26"># yum list xterm
Loaded plugins: langpacks, presto, refresh-packagekit
Adding en_US to language list
Available Packages
xterm.i686 253-1.el6
#
# yum list installed xterm
Loaded plugins: refresh-packagekit
Error: No matching Packages to list
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="222" id="calibre_link-562" class="calibre11"></span>The commands to list detailed software package information using <code class="calibre26">urpm</code> and <code class="calibre26">zypper</code> are in <a id="calibre_link-1244" href="#calibre_link-1132" class="calibre4">Table 9.2</a>. You can acquire an even more detailed set of package information from the repository, using the <code class="calibre26">info</code> option on the <code class="calibre26">zypper</code> command.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1132" href="#calibre_link-1244" class="calibre4"><b class="calibre21">Table 9.2</b></a></span> How to See Various Package Details with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Detail Type</td>
<td class="left">Front-End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left">Package Information</td>
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">urpmq -i</code> <code class="calibre26"><i class="calibre12">package_name</i></code></td>
</tr>
<tr class="calibre28">
<td class="left">Installed?</td>
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">rpm -q</code> <code class="calibre26"><i class="calibre12">package_name</i></code></td>
</tr>
<tr class="calibre28">
<td class="left">Package Information</td>
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zypper search -s</code> <code class="calibre26"><i class="calibre12">package_name</i></code></td>
</tr>
<tr class="calibre28">
<td class="left">Installed?</td>
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left">Same command, but look for an <code class="calibre26">i</code> in the Status column</td>
</tr>
</table>
</figure>
<p class="calibre10">Finally, if you need to find out what software package provides a particular file on your filesystem, the versatile <code class="calibre26">yum</code> can do that, too! Just enter the command:</p>
<pre class="calibre29"><code class="calibre26">yum provides <i class="calibre12">file_name</i></code></pre>
<p class="calibre10">Here's an example of trying to find what software provided the configuration file <code class="calibre26">/etc/yum.conf</code>:</p>
<pre class="calibre29"><code class="calibre26">#
# yum provides /etc/yum.conf
Loaded plugins: fastestmirror, refresh-packagekit, security
Determining fastest mirrors
 * base: mirror.web-ster.com
 * extras: centos.chi.host-engine.com
 * updates: mirror.umd.edu
yum-3.2.29-40.el6.centos.noarch : RPM package installer/updater/manager
Repo        : base
Matched from:
Filename    : /etc/yum.conf
yum-3.2.29-43.el6.centos.noarch : RPM package installer/updater/manager
Repo        : updates
Matched from:
Filename    : /etc/yum.conf
yum-3.2.29-40.el6.centos.noarch : RPM package installer/updater/manager
Repo        : installed
Matched from:
Other       : Provides-match: /etc/yum.conf
#
#</code></pre>
<p class="calibre10"><code class="calibre26">yum</code> checked three separate repositories: base, updates, and installed. From both, the answer is: the <code class="calibre26">yum</code> software package provides this file!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Installing software with yum</h3>
<p class="calibre10"><span type="pagebreak" title="223" id="calibre_link-563" class="calibre11"></span>Installation of a software package using <code class="calibre26">yum</code> is incredibly easy. The following is the basic command for installing a software package, all its needed libraries, and package dependencies from a repository:</p>
<pre class="calibre29"><code class="calibre26">yum install <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">Here's an example of installing the xterm package that we talked about in Chapter 2:</p>
<pre class="calibre29"><code class="calibre26">$ su -
Password:
# yum install xterm
Loaded plugins: fastestmirror, refresh-packagekit, security
Determining fastest mirrors
 * base: mirrors.bluehost.com
 * extras: mirror.5ninesolutions.com
 * updates: mirror.san.fastserv.com
Setting up Install Process
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package xterm.i686 0:253-1.el6 will be installed
--&gt; Finished Dependency Resolution
Dependencies Resolved
[...]
Installed:
  xterm.i686 0:253-1.el6
Complete!
#</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Before the <code class="calibre26">yum</code> command in the preceding listing, the <code class="calibre26">su</code> - command is used. This command allows you to switch to the root user. On this Linux system, the # denotes you are logged in as root. You should only switch to root user temporarily in order to run administrative tasks, such as installing and updating software. The <code class="calibre26">sudo</code> command is another option as well.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="224" id="calibre_link-564" class="calibre11"></span>You can also manually download an <code class="calibre26">rpm</code> installation file and install it using <code class="calibre26">yum</code>. This is called a <i class="calibre12">local installation</i>. This is the basic command:</p>
<pre class="calibre29"><code class="calibre26">yum localinstall <i class="calibre12">package_name.rpm</i></code></pre>
<p class="calibre10">You can begin to see that one of <code class="calibre26">yum</code>'s strengths is that it uses very logical and user-friendly commands.</p>
<p class="calibre10"><a id="calibre_link-1245" href="#calibre_link-1133" class="calibre4">Table 9.3</a> shows how to perform a package install with <code class="calibre26">urpm</code> and <code class="calibre26">zypper</code>. You should note that if you are not logged in as root, you get a âcommand not foundâ error message using <code class="calibre26">urpm</code>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1133" href="#calibre_link-1245" class="calibre4"><b class="calibre21">Table 9.3</b></a></span> How to Install Software with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Front-End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">urpmi package_name</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zypper install package_name</code></td>
</tr>
</table>
</figure>
</section>
<section class="toclist">
<h3 class="calibre15">Updating software with yum</h3>
<p class="calibre10">In most Linux distributions, when you're working away in the GUI, you get those nice little notification icons telling you that an update is needed. Here at the command line, it takes a little more work.</p>
<p class="calibre10">To see the list of all the available updates for your installed packages, type the following command:</p>
<pre class="calibre29"><code class="calibre26">yum list updates</code></pre>
<p class="calibre10">It's always nice to get no response to this command because it means you have nothing to update! However, if you do discover a particular software package needs updating, type the following command:</p>
<pre class="calibre29"><code class="calibre26">yum update <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">If you'd like to update all the packages listed in the update list, just enter the following command:</p>
<pre class="calibre29"><code class="calibre26">yum update</code></pre>
<p class="calibre10"><span type="pagebreak" title="225" id="calibre_link-565" class="calibre11"></span>Commands for updating software packages on Mandriva and openSUSE are listed in <a id="calibre_link-1246" href="#calibre_link-1134" class="calibre4">Table 9.4</a>. When urpm is used, the repository database is automatically refreshed as well as software packages updated.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1134" href="#calibre_link-1246" class="calibre4"><b class="calibre21">Table 9.4</b></a></span> How to Update Software with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Front-End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">urpmi --auto-update --update</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zypper update</code></td>
</tr>
</table>
</figure>
</section>
<section class="toclist">
<h3 class="calibre15">Uninstalling software with yum</h3>
<p class="calibre10">The <code class="calibre26">yum</code> tool also provides an easy way to uninstall software you no longer want on your system. As with <code class="calibre26">aptitude</code>, you need to choose whether to keep the software package's data and configuration files.</p>
<p class="calibre10">To just remove the software package and keep any configuration and data files, use the following command:</p>
<pre class="calibre29"><code class="calibre26">yum remove <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">To uninstall the software and all its files, use the erase option:</p>
<pre class="calibre29"><code class="calibre26">yum erase <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">It is equally easy to remove software using <code class="calibre26">urpm </code>and <code class="calibre26">zypper</code> in <a id="calibre_link-1247" href="#calibre_link-1135" class="calibre4">Table 9.5</a>. Both of these tools perform a function similar to <code class="calibre26">yum</code>'s <code class="calibre26">erase</code> option.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1135" href="#calibre_link-1247" class="calibre4"><b class="calibre21">Table 9.5</b></a></span> How to Uninstall Software with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Front-End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">urpme package_name</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zypper remove package_name</code></td>
</tr>
</table>
</figure>
<p class="calibre10">Although life is considerably easier with PMS packages, it's not always problem-free. Occasionally, things do go wrong. Fortunately, there's help.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Dealing with broken dependencies</h3>
<p class="calibre10">Sometimes, as multiple software packages get loaded, a software dependency for one package can get overwritten by the installation of another package. This is called a <i class="calibre12">broken dependency</i>.</p>
<p class="calibre10"><span type="pagebreak" title="226" id="calibre_link-566" class="calibre11"></span>If this should happen on your system, first try the following command:</p>
<pre class="calibre29"><code class="calibre26">yum clean all</code></pre>
<p class="calibre10">Then try to use the <code class="calibre26">update</code> option in the <code class="calibre26">yum</code> command. Sometimes, just cleaning up any misplaced files can help.</p>
<p class="calibre10">If that doesn't solve the problem, try the following command:</p>
<pre class="calibre29"><code class="calibre26">yum deplist <i class="calibre12">package_name</i></code></pre>
<p class="calibre10">This command displays all the package's library dependencies and what software package provides them. After you know the libraries required for a package, you can then install them. Here's an example of determining the dependencies for the xterm package:</p>
<pre class="calibre29"><code class="calibre26"># yum deplist xterm
Loaded plugins: fastestmirror, refresh-packagekit, security
Loading mirror speeds from cached hostfile
 * base: mirrors.bluehost.com
 * extras: mirror.5ninesolutions.com
 * updates: mirror.san.fastserv.com
Finding dependencies:
package: xterm.i686 253-1.el6
  dependency: libncurses.so.5
   provider: ncurses-libs.i686 5.7-3.20090208.el6
  dependency: libfontconfig.so.1
   provider: fontconfig.i686 2.8.0-3.el6
  dependency: libXft.so.2
   provider: libXft.i686 2.3.1-2.el6
  dependency: libXt.so.6
   provider: libXt.i686 1.1.3-1.el6
  dependency: libX11.so.6
   provider: libX11.i686 1.5.0-4.el6
  dependency: rtld(GNU_HASH)
   provider: glibc.i686 2.12-1.132.el6
   provider: glibc.i686 2.12-1.132.el6_5.1
   provider: glibc.i686 2.12-1.132.el6_5.2
  dependency: libICE.so.6
   provider: libICE.i686 1.0.6-1.el6
  dependency: libXaw.so.7
   provider: libXaw.i686 1.0.11-2.el6
  dependency: libtinfo.so.5
   provider: ncurses-libs.i686 5.7-3.20090208.el6
  dependency: libutempter.so.0
   provider: libutempter.i686 1.1.5-4.1.el6
  dependency: /bin/sh
   provider: bash.i686 4.1.2-15.el6_4
  dependency: libc.so.6(GLIBC_2.4)
   provider: glibc.i686 2.12-1.132.el6
   provider: glibc.i686 2.12-1.132.el6_5.1
   provider: glibc.i686 2.12-1.132.el6_5.2
  dependency: libXmu.so.6
   provider: libXmu.i686 1.1.1-2.el6
#</code></pre>
<p class="calibre10">If that doesn't solve your problem, you have one last tool:</p>
<pre class="calibre29"><code class="calibre26">yum update --skip-broken</code></pre>
<p class="calibre10"><span type="pagebreak" title="227" id="calibre_link-567" class="calibre11"></span>The <code class="calibre26">--skip-broken</code> option allows you to just ignore the package with the broken dependency and update the other software packages. This may not help the broken package, but at least you can update the remaining packages on the system!</p>
<p class="calibre10">In <a id="calibre_link-1248" href="#calibre_link-1136" class="calibre4">Table 9.6</a>, the commands to try for broken dependencies with <code class="calibre26">urpm </code>and <code class="calibre26">zypper</code> are listed. With <code class="calibre26">zypper</code>, there is only the one command to verify and fix a broken dependency. With <code class="calibre26">urpm</code>, if the clean option does not work, you can skip updates on the offensive package. To do this, you must add the name of the offending package to the file <code class="calibre26">/etc/urpmi/skip.list</code>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1136" href="#calibre_link-1248" class="calibre4"><b class="calibre21">Table 9.6</b></a></span> Broken Dependencies with zypper and urpm</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Front End Tool</td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"><code class="calibre26">urpmi --clean</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"><code class="calibre26">zypper verify</code></td>
</tr>
</table>
</figure>
</section>
<section class="toclist">
<h3 class="calibre15">yum repositories</h3>
<p class="calibre10">Just like the <code class="calibre26">aptitude</code> systems, <code class="calibre26">yum</code> has its software repositories set up at installation. For most purposes, these pre-installed repositories work just fine for your needs. But if and when the time comes that you need to install software from a different repository, here are some things you need to know.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">A wise system administrator sticks with approved repositories. An approved repository is one that is sanctioned by the distribution's official site. If you start adding unapproved repositories, you lose the guarantee of stability. And you will be heading into broken dependencies territory</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To see what repositories you are currently pulling software from, type the following command:</p>
<pre class="calibre29"><code class="calibre26">yum repolist</code></pre>
<p class="calibre10">If you don't find a repository you need software from, you need to do a little configuration file editing. The <code class="calibre26">yum</code> repository definition files are located in <code class="calibre26">/etc/yum.repos.d</code>. You need to add the proper URL and gain access to any necessary encryption keys.</p>
<p class="calibre10"><span type="pagebreak" title="228" id="calibre_link-568" class="calibre11"></span>Good repository sites such as <a href="http://rpmfusion.org" class="calibre4">rpmfusion.org</a> lay out all the steps necessary to use them. Sometimes, these repository sites offer an <code class="calibre26">rpm</code> file that you can download and install using the <code class="calibre26">yum localinstall</code> command. The installation of the <code class="calibre26">rpm</code> file does all the repository setup work for you. Now that's convenient!</p>
<p class="calibre10"><code class="calibre26">urpm</code> calls its repositories <i class="calibre12">media</i>. The commands for looking at <code class="calibre26">urpm</code> media and <code class="calibre26">zypper</code>'s repositories are in <a id="calibre_link-1249" href="#calibre_link-1137" class="calibre4">Table 9.7</a>. Notice with both of these front-end tools that you do not edit a configuration file. Instead, to add media or a repository, you just type the command.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1137" href="#calibre_link-1249" class="calibre4"><b class="calibre21">Table 9.7</b></a></span> zypper and urpm Repositories</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Action</td>
<td class="left"></td>
<td class="left">Front-End Tool</td>
<td class="left"></td>
<td class="left">Command</td>
</tr>
<tr class="calibre28">
<td class="left">Display repository</td>
<td class="left"></td>
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">urpmq --list-media</code></td>
</tr>
<tr class="calibre28">
<td class="left">Add repository</td>
<td class="left"></td>
<td class="left"><code class="calibre26">urpm</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">urpmi.addmedia path_name</code></td>
</tr>
<tr class="calibre28">
<td class="left">Display repository</td>
<td class="left"></td>
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">zypper repos</code></td>
</tr>
<tr class="calibre28">
<td class="left">Add repository</td>
<td class="left"></td>
<td class="left"><code class="calibre26">zypper</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">zypper addrepo path_name</code></td>
</tr>
</table>
</figure>
<p class="calibre10">Both Debian&ndash;based and Red Hat&ndash;based systems use Package Management Systems to ease the process of managing software. Now we are going to step out of the world of Package Management Systems and look at something a little more difficult: installing directly from source code.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-181" class="calibre4"></a>Installing from Source Code</h2>
<p class="calibre10">Chapter 4 discussed <i class="calibre12">tarball</i> packages &mdash; how to create them using the <code class="calibre26">tar</code> command line command and how to unpack them. Before the fancy <code class="calibre26">rpm</code> and <code class="calibre26">dpkg</code> tools, administrators had to know how to unpack and install software from tarballs.</p>
<p class="calibre10">If you work in the open source software environment much, there's a good chance you will still find software packed up as a tarball. This section walks you through the process of unpacking and installing a tarball software package.</p>
<p class="calibre10">For this example, the software package <code class="calibre26">sysstat</code> is used. The <code class="calibre26">sysstat</code> utility is a very nice software package that provides a variety of system monitoring tools.</p>
<p class="calibre10">First, you need to download the sysstat tarball to your Linux system. You can often find the <code class="calibre26">sysstat</code> package available on different Linux sites, but it's usually best to go straight to the source of the program. In this case, it's the website <a href="http://sebastien.godard.pagesperso-orange.fr/" class="calibre4">http://sebastien.godard.pagesperso-orange.fr/</a>.</p>
<p class="calibre10"><span type="pagebreak" title="229" id="calibre_link-569" class="calibre11"></span>If you click the Download link, you go to the page that contains the files for downloading. The current version at the time of this writing is 11.1.1, and the distribution file name is <code class="calibre26">sysstat-11.1.1.tar.gz</code>.</p>
<p class="calibre10">Click the link to download the file to your Linux system. After you have downloaded the file, you can unpack it.</p>
<p class="calibre10">To unpack a software tarball, use the standard <code class="calibre26">tar</code> command:</p>
<pre class="calibre29"><code class="calibre26">#
# tar -zxvf sysstat-11.1.1.tar.gz
sysstat-11.1.1/
sysstat-11.1.1/cifsiostat.c
sysstat-11.1.1/FAQ
sysstat-11.1.1/ioconf.h
sysstat-11.1.1/rd_stats.h
sysstat-11.1.1/COPYING
sysstat-11.1.1/common.h
sysstat-11.1.1/sysconfig.in
sysstat-11.1.1/mpstat.h
sysstat-11.1.1/rndr_stats.h
[...]
sysstat-11.1.1/activity.c
sysstat-11.1.1/sar.c
sysstat-11.1.1/iostat.c
sysstat-11.1.1/rd_sensors.c
sysstat-11.1.1/prealloc.in
sysstat-11.1.1/sa2.in
#
#</code></pre>
<p class="calibre10">Now that the tarball is unpacked and the files have neatly put themselves into a directory called <code class="calibre26">sysstat-11.1.1</code>, you can dive down into that directory and continue.</p>
<p class="calibre10">First, use the <code class="calibre26">cd</code> command to get into the new directory and list the contents of the directory:</p>
<pre class="calibre29"><code class="calibre26">$ cd sysstat-11.1.1
$ ls
activity.c    iconfig              prealloc.in   sa.h
build         INSTALL              pr_stats.c    sar.c
CHANGES       ioconf.c             pr_stats.h    sa_wrap.c
cifsiostat.c  ioconf.h             rd_sensors.c  sysconfig.in
cifsiostat.h  iostat.c             rd_sensors.h  sysstat-11.1.1.lsm
common.c      iostat.h             rd_stats.c    sysstat-11.1.1.spec
common.h      json_stats.c         rd_stats.h    sysstat.in
configure     json_stats.h         README        sysstat.ioconf
configure.in  Makefile.in          rndr_stats.c  sysstat.service.in
contrib       man                  rndr_stats.h  sysstat.sysconfig.in
COPYING       mpstat.c             sa1.in        version.in
count.c       mpstat.h             sa2.in        xml
count.h       nfsiostat-sysstat.c  sa_common.c   xml_stats.c
CREDITS       nfsiostat-sysstat.h  sadc.c        xml_stats.h
cron          nls                  sadf.c
FAQ           pidstat.c            sadf.h
format.c      pidstat.h            sadf_misc.c
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="230" id="calibre_link-570" class="calibre11"></span>In the listing of the directory, you should typically see a <code class="calibre26">README</code> or <code class="calibre26">AAAREADME</code> file. It is very important to read this file. The actual instructions you need to finish the software's installation are in this file.</p>
<p class="calibre10">Following the advice contained in the <code class="calibre26">README</code> file, the next step is to <code class="calibre26">configure sysstat</code> for your system. This checks your Linux system to ensure it has the proper library dependencies, in addition to the proper compiler to compile the source code:</p>
<pre class="calibre29"><code class="calibre26"># ./configure
Check programs:
.
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
[...]
checking for ANSI C header files... (cached) yes
checking for dirent.h that defines DIR... yes
checking for library containing opendir... none required
checking ctype.h usability... yes
checking ctype.h presence... yes
checking for ctype.h... yes
checking errno.h usability... yes
checking errno.h presence... yes
checking for errno.h... yes
[...]
Check library functions:
.
checking for strchr... yes
checking for strcspn... yes
checking for strspn... yes
checking for strstr... yes
checking for sensors support... yes
checking for sensors_get_detected_chips in -lsensors... no
checking for sensors lib... no
.
Check system services:
.
checking for special C compiler options needed for large files... no
checking for _FILE_OFFSET_BITS value needed for large files... 64
.
Check configuration:
[...]
Now create files:
[...]
config.status: creating Makefile
   Sysstat version:             11.1.1
   Installation prefix:         /usr/local
   rc directory:                /etc/rc.d
   Init directory:              /etc/rc.d/init.d
   Systemd unit dir:
   Configuration directory:      /etc/sysconfig
   Man pages directory:          ${datarootdir}/man
   Compiler:               gcc
   Compiler flags:         -g -O2
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="231" id="calibre_link-571" class="calibre11"></span>If anything does go wrong, the <code class="calibre26">configure</code> step displays an error message explaining what's missing. If you don't have the GNU C compiler installed in your Linux distribution, you get a single error message, but for all other issues you should see multiple messages indicating what's installed and what isn't.</p>
<p class="calibre10">The next stage is to build the various binary files using the <code class="calibre26">make</code> command. The <code class="calibre26">make</code> command compiles the source code and then the linker to create the final executable files for the package. As with the <code class="calibre26">configure</code> command, the <code class="calibre26">make</code> command produces lots of output as it goes through the steps of compiling and linking all the source code files:</p>
<pre class="calibre29"><code class="calibre26"># make
&ndash;gcc -o sadc.o -c -g -O2 -Wall -Wstrict-prototypes -pipe -O2
 -DSA_DIR=\"/var/log/sa\" -DSADC_PATH=\"/usr/local/lib/sa/sadc\"
 -DUSE_NLS -DPACKAGE=\"sysstat\"
 -DLOCALEDIR=\"/usr/local/share/locale\" sadc.c
gcc -o act_sadc.o -c -g -O2 -Wall -Wstrict-prototypes -pipe -O2
 -DSOURCE_SADC  -DSA_DIR=\"/var/log/sa\"
 -DSADC_PATH=\"/usr/local/lib/sa/sadc\"
 -DUSE_NLS -DPACKAGE=\"sysstat\"
 -DLOCALEDIR=\"/usr/local/share/locale\" activity.c
[...]
#</code></pre>
<p class="calibre10">When <code class="calibre26">make</code> is finished, you have the actual <code class="calibre26">sysstat</code> software program available in the directory! However, it's somewhat inconvenient to have to run it from that directory. Instead, you'll want to install it in a common location on your Linux system. To do that, you need to log in as the root user account (or use the <code class="calibre26">sudo</code> command if your Linux distribution prefers) and then use the <code class="calibre26">install</code> option of the <code class="calibre26">make</code> command:</p>
<pre class="calibre29"><code class="calibre26"># make install
mkdir -p /usr/local/share/man/man1
mkdir -p /usr/local/share/man/man5
mkdir -p /usr/local/share/man/man8
rm -f /usr/local/share/man/man8/sa1.8*
install -m 644 -g man man/sa1.8 /usr/local/share/man/man8
rm -f /usr/local/share/man/man8/sa2.8*
install -m 644 -g man man/sa2.8 /usr/local/share/man/man8
rm -f /usr/local/share/man/man8/sadc.8*
[...]
install -m 644 -g man man/sadc.8 /usr/local/share/man/man8
install -m 644 FAQ /usr/local/share/doc/sysstat-11.1.1
install -m 644 *.lsm /usr/local/share/doc/sysstat-11.1.1
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="232" id="calibre_link-572" class="calibre11"></span>Now the <code class="calibre26">sysstat</code> package is installed on the system! Although it's not quite as easy as installing a software package via a PMS, installing software using tarballs is not that difficult.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-182" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed how to work with a Package Management Systems (PMS) to install, update, or remove software from the command line. Although most of the Linux distributions use fancy GUI tools for software package management, you can also perform package management from the command line.</p>
<p class="calibre10">The Debian-based Linux distributions use the <code class="calibre26">dpkg</code> utility to interface with the PMS from the command line. A front-end to the <code class="calibre26">dpkg</code> utility is <code class="calibre26">aptitude</code>. It provides simple command line options for working with software packages in the dpkg format.</p>
<p class="calibre10">The Red Hat&ndash;based Linux distributions are based on the <code class="calibre26">rpm</code> utility but use different front-end tools at the command line. Red Hat and Fedora use <code class="calibre26">yum</code> for installing and managing software packages. The openSUSE distribution uses <code class="calibre26">zypper</code> for managing software, while the Mandriva distribution uses <code class="calibre26">urpm</code>.</p>
<p class="calibre10">The chapter closed with a discussion on how to install software packages that are only distributed in source code tarballs. The <code class="calibre26">tar</code> command allows you to unpack the source code files from the tarball, and <code class="calibre26">configure</code> and <code class="calibre26">make</code> allow you to build the final executable program from the source code.</p>
<p class="calibre10">The next chapter looks at the different editors available in Linux distributions. As you get ready to start working on shell scripts, it will come in handy to know what editors are available to use!</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1256">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-183" class="calibre4"></a><span class="chaptertitle">Chapter 10</span><br class="calibre22" /><span class="chaptertitle">Working with Editors</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Working with the vim editor</li>
<li class="calibre7">Exploring nano</li>
<li class="calibre7">Understanding emacs</li>
<li class="calibre7">Getting comfortable with kwrite</li>
<li class="calibre7">Looking at Kate</li>
<li class="calibre7">Using the GNOME editor</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="233" id="calibre_link-573" class="calibre11"></span>Before you can start your shell scripting career, you need to know how to use at least one text editor in Linux. The more you know about how to use features such as searching, cutting, and pasting, the quicker you can develop your shell scripts.</p>
<p class="calibre19">You can choose from several editors. Many individuals find a particular editor whose features they love and exclusively use that text editor. This chapter discusses just a few of the text editors you'll see in the Linux world.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-184" class="calibre4"></a>Visiting the vim Editor</h2>
<p class="calibre10">The vi editor was the original editor used on Unix systems. It used the console graphics mode to emulate a text-editing window, allowing you to see the lines of your file, move around within the file, and insert, edit, and replace text.</p>
<p class="calibre10">Although it was quite possibly the most complicated editor in the world (at least in the opinion of those who hate it), it provides many features that have made it a staple for Unix administrators for decades.</p>
<p class="calibre10">When the GNU Project ported the vi editor to the open source world, they chose to make some improvements to it. Because it no longer resembled the original vi editor found in the Unix world, the developers also renamed it, to vi improved, or <i class="calibre12">vim</i>.</p>
<p class="calibre10">This section walks you through the basics of using the vim editor to edit your text shell script files.</p>
<section class="toclist">
<h3 class="calibre15">Checking your vim package</h3>
<p class="calibre10"><span type="pagebreak" title="234" id="calibre_link-574" class="calibre11"></span>Before you begin your exploration of the vim editor, it's a good idea to understand what vim package your Linux system has installed. On some distributions, you will have the full vim package installed and an alias for the <code class="calibre26">vi</code> command, as shown on this CentOS distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">alias vi</b></code>
alias vi='vim'
$
$ <code class="calibre26"><b class="calibre21">which vim</b></code>
/usr/bin/vim
$
$ <code class="calibre26"><b class="calibre21">ls -l /usr/bin/vim</b></code>
-rwxr-xr-x. 1 root root 1967072 Apr  5  2012 /usr/bin/vim
$</code></pre>
<p class="calibre10">Notice that the program file's long listing does not show any linked files (see Chapter 3 for more information on linked files). If the vim program is linked, it may be linked to a less than full-featured editor. Thus, it's a good idea to check for linked files.</p>
<p class="calibre10">On other distributions, you will find various flavors of the vim editor. Notice on this Ubuntu distribution that not only is there no alias for the <code class="calibre26">vi</code> command, but the <code class="calibre26">/usr/bin/vi</code> program file belongs to a series of file links:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">alias vi</b></code>
-bash: alias: vi: not found
$
$ <code class="calibre26"><b class="calibre21">which vi</b></code>
/usr/bin/vi
$
$ <code class="calibre26"><b class="calibre21">ls -l /usr/bin/vi</b></code>
lrwxrwxrwx 1 root root 20 Apr 22 12:39
/usr/bin/vi -&gt; /etc/alternatives/vi
$
$ <code class="calibre26"><b class="calibre21">ls -l /etc/alternatives/vi</b></code>
lrwxrwxrwx 1 root root 17 Apr 22 12:33
/etc/alternatives/vi -&gt; /usr/bin/vim.tiny
$
$ <code class="calibre26"><b class="calibre21">ls -l /usr/bin/vim.tiny</b></code>
-rwxr-xr-x 1 root root 884360 Jan  2 14:40
/usr/bin/vim.tiny
$
$ <code class="calibre26"><b class="calibre21">readlink -f /usr/bin/vi</b></code>
/usr/bin/vim.tiny</code></pre>
<p class="calibre10"><span type="pagebreak" title="235" id="calibre_link-575" class="calibre11"></span>Thus, when the <code class="calibre26">vi</code> command is entered, the <code class="calibre26">/usr/bin/vim.tiny</code> program is executed. The <code class="calibre26">vim.tiny</code> program provides only a few vim editor features. If you are serious about using the vim editor and have Ubuntu, you should install at least the basic vim package.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Notice in the preceding example that, instead of having to use the <code class="calibre26">ls -l</code> command multiple times to find a series of linked files' final object, you can use the <code class="calibre26">readlink -f</code> command. It immediately produces the linked file series' final object.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Software installations were covered in detail in Chapter 9. Installing the basic vim package on this Ubuntu distribution is fairly straightforward:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo apt-get install vim</b></code>
[...]
The following extra packages will be installed:
  vim-runtime
Suggested packages:
  ctags vim-doc vim-scripts
The following NEW packages will be installed:
  vim vim-runtime
[...]
$
$ <code class="calibre26"><b class="calibre21">readlink -f /usr/bin/vi</b></code>
/usr/bin/vim.basic
$</code></pre>
<p class="calibre10">The basic vim editor is now installed on this Ubuntu distribution, and the <code class="calibre26">/usr/bin/vi</code> program file's link was automatically changed to point to <code class="calibre26">/usr/bin/vim.basic</code>. Thus, when the <code class="calibre26">vi</code> command is entered on this Ubuntu system, the basic vim editor is used instead of tiny vim.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Exploring vim basics</h3>
<p class="calibre10">The vim editor works with data in a memory buffer. To start the vim editor, just type the <code class="calibre26">vim</code> command (or <code class="calibre26">vi</code> if there's an alias or linked file) and the name of the file you want to edit:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">vim myprog.c</b></code></code></pre>
<p class="calibre10">If you start vim without a filename, or if the file doesn't exist, vim opens a new buffer area for editing. If you specify an existing file on the command line, vim reads the entire file's contents into a buffer area, where it is ready for editing, as shown in <a id="calibre_link-1257" href="#calibre_link-1079" class="calibre4">Figure 10.1</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000039.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1079" href="#calibre_link-1257" class="calibre4"><b class="calibre21">Figure 10.1</b></a></span> The vim main window</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="236" id="calibre_link-576" class="calibre11"></span>The vim editor detects the terminal type for the session (see Chapter 2) and uses a full-screen mode to use the entire console window for the editor area.</p>
<p class="calibre10">The initial vim edit window shows the contents of the file (if there are any) along with a message line at the bottom of the window. If the file contents don't take up the entire screen, vim places a tilde on lines that are not part of the file (as shown in <a href="#calibre_link-1079" class="calibre4">Figure 10.1</a>).</p>
<p class="calibre10">The message line at the bottom indicates information about the edited file, depending on the file's status, and the default settings in your vim installation. If the file is new, the message <code class="calibre26">[New File]</code> appears.</p>
<p class="calibre10">The vim editor has two modes of operation:</p>
<ul class="calibre14">
<li class="calibre7">Normal mode</li>
<li class="calibre7">Insert mode</li>
</ul>
<p class="calibre10">When you first open a file (or start a new file) for editing, the vim editor enters <i class="calibre12">normal</i> mode. In normal mode, the vim editor interprets keystrokes as commands (more on those later).</p>
<p class="calibre10">In <i class="calibre12">insert</i> mode, vim inserts every key you type at the current cursor location in the buffer. To enter insert mode, press the i key. To get out of insert mode and go back into normal mode, press the Escape key on the keyboard.</p>
<p class="calibre10"><span type="pagebreak" title="237" id="calibre_link-577" class="calibre11"></span>In normal mode, you can move the cursor around the text area by using the arrow keys (as long as your terminal type is detected properly by vim). If you happen to be on a flaky terminal connection that doesn't have the arrow keys defined, all hope is not lost. The vim commands include commands for moving the cursor:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">h</code> to move left one character</li>
<li class="calibre7"><code class="calibre26">j</code> to move down one line (the next line in the text)</li>
<li class="calibre7"><code class="calibre26">k</code> to move up one line (the previous line in the text)</li>
<li class="calibre7"><code class="calibre26">l</code> to move right one character</li>
</ul>
<p class="calibre10">Moving around within large text files line by line can get tedious. Fortunately, vim provides a few commands to help speed things along:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">PageDown</code> (or Ctrl+F) to move forward one screen of data</li>
<li class="calibre7"><code class="calibre26">PageUp</code> (or Ctrl+B) to move backward one screen of data</li>
<li class="calibre7"><code class="calibre26">G</code> to move to the last line in the buffer</li>
<li class="calibre7"><code class="calibre26"><i class="calibre12">num</i></code> <code class="calibre26">G</code> to move to the line number <code class="calibre26"><i class="calibre12">num</i></code> in the buffer</li>
<li class="calibre7"><code class="calibre26">gg</code> to move to the first line in the buffer</li>
</ul>
<p class="calibre10">The vim editor has a special feature within normal mode called <i class="calibre12">command line mode</i>. The command line mode provides an interactive command line where you can enter additional commands to control the actions in vim. To get to command line mode, press the colon key in normal mode. The cursor moves to the message line, and a colon (<code class="calibre26">:</code>) appears, waiting for you to enter a command.</p>
<p class="calibre10">Within the command line mode are several commands for saving the buffer to the file and exiting vim:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">q</code> to quit if no changes have been made to the buffer data</li>
<li class="calibre7"><code class="calibre26">q!</code> to quit and discard any changes made to the buffer data</li>
<li class="calibre7"><code class="calibre26">w</code> <code class="calibre26"><i class="calibre12">filename</i></code> to save the file under a different filename</li>
<li class="calibre7"><code class="calibre26">wq</code> to save the buffer data to the file and quit</li>
</ul>
<p class="calibre10">After seeing just a few basic vim commands, you might understand why some people absolutely hate the vim editor. To be able to use vim to its fullest, you must know plenty of obscure commands. However, after you get a few of the basic vim commands down, you can quickly edit files directly from the command line, no matter what type of environment you're in. Plus, after you get comfortable typing commands, it almost seems second nature to type both data and editing commands, and it becomes odd having to jump back to using a mouse!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Editing data</h3>
<p class="calibre10"><span type="pagebreak" title="238" id="calibre_link-578" class="calibre11"></span>While in insert mode, you can insert data into the buffer; however, sometimes you need to add or remove data after you've already entered it into the buffer. While in normal mode, the vim editor provides several commands for editing the data in the buffer. <a id="calibre_link-1258" href="#calibre_link-1138" class="calibre4">Table 10.1</a> lists some common editing commands for vim.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1138" href="#calibre_link-1258" class="calibre4"><b class="calibre21">Table 10.1</b></a></span> vim Editing Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">x</code></td>
<td class="left">Deletes the character at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">dd</code></td>
<td class="left">Deletes the line at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">dw</code></td>
<td class="left">Deletes the word at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">d$</code></td>
<td class="left">Deletes to the end of the line from the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">J</code></td>
<td class="left">Deletes the line break at the end of the line at the current cursor position (joins lines)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">u</code></td>
<td class="left">Undoes the previous edit command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">a</code></td>
<td class="left">Appends data after the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">A</code></td>
<td class="left">Appends data to the end of the line at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">r</code> <code class="calibre26"><i class="calibre12">char</i></code></td>
<td class="left">Replaces a single character at the current cursor position with <code class="calibre26"><i class="calibre12">char</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">R</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Overwrites the data at the current cursor position with <code class="calibre26"><i class="calibre12">text</i></code>, until you press Escape</td>
</tr>
</table>
</figure>
<p class="calibre10">Some of the editing commands also allow you to use a numeric modifier to indicate how many times to perform the command. For example, the command <code class="calibre26">2x</code> deletes two characters, starting from the current cursor position, and the command <code class="calibre26">5dd</code> deletes five lines, starting at the line from the current cursor position.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Be careful when trying to use the keyboard Backspace or Delete keys while in the vim editor's normal mode. The vim editor usually recognizes the Delete key as the functionality of the <code class="calibre26">x</code> command, deleting the character at the current cursor location. Usually, the vim editor doesn't recognize the Backspace key in normal mode</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Copying and pasting</h3>
<p class="calibre10">A standard editor feature is the ability to cut or copy data and paste it elsewhere in the document. The vim editor provides a way to do this.</p>
<p class="calibre10"><span type="pagebreak" title="239" id="calibre_link-579" class="calibre11"></span>Cutting and pasting is relatively easy. You've already seen the commands in <a href="#calibre_link-1138" class="calibre4">Table 10.1</a> that can remove data from the buffer. However, when vim removes data, it actually keeps it stored in a separate register. You can retrieve that data by using the <code class="calibre26">p</code> command.</p>
<p class="calibre10">For example, you can use the <code class="calibre26">dd</code> command to delete a line of text, move the cursor to the buffer location where you want to place it, and then use the <code class="calibre26">p</code> command. The <code class="calibre26">p</code> command inserts the text after the line at the current cursor position. You can do this with any command that removes text.</p>
<p class="calibre10">Copying text is a little bit trickier. The copy command in vim is <code class="calibre26">y</code> (for yank). You can use the same second character with <code class="calibre26">y</code> as with the <code class="calibre26">d</code> command (<code class="calibre26">yw</code> to yank a word, <code class="calibre26">y$</code> to yank to the end of a line). After you yank the text, move the cursor to the location where you want to place the text and use the <code class="calibre26">p</code> command. The yanked text now appears at that location.</p>
<p class="calibre10">Yanking is tricky in that you can't see what happened because you're not affecting the text that you yank. You never know for sure what you yanked until you paste it somewhere. But there's another feature in vim that helps you out with yanking.</p>
<p class="calibre10">The <i class="calibre12">visual mode</i> highlights text as you move the cursor. You use visual mode to select text to yank for pasting. To enter visual mode, move the cursor to the location where you want to start yanking, and press <code class="calibre26">v</code>. Notice that the text at the cursor position is now highlighted. Next, move the cursor to cover the text you want to yank (you can even move down lines to yank more than one line of text). As you move the cursor, vim highlights the text in the yank area. After you've covered the text you want to copy, press the y key to activate the yank command. Now that you have the text in the register, just move the cursor to where you want to paste and use the <code class="calibre26">p</code> command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Searching and substituting</h3>
<p class="calibre10">You can easily search for data in the buffer using the vim search command. To enter a search string, press the forward slash (/) key. The cursor goes to the message line, and vim displays a forward slash. Enter the text you want to find, and press the Enter key. The vim editor responds with one of three actions:</p>
<ul class="calibre14">
<li class="calibre7">If the word appears after the current cursor location, it jumps to the first location where the text appears.</li>
<li class="calibre7">If the word doesn't appear after the current cursor location, it wraps around the end of the file to the first location in the file where the text appears (and indicates this with a message).</li>
<li class="calibre7">It produces an error message stating that the text was not found in the file.</li>
</ul>
<p class="calibre10">To continue searching for the same word, press the forward slash character and then press the Enter key, or you can use the n key, for <i class="calibre12">next</i>.</p>
<p class="calibre10"><span type="pagebreak" title="240" id="calibre_link-580" class="calibre11"></span>The substitute command allows you to quickly replace (substitute) one word for another in the text. To get to the substitute command, you must be in command line mode. The format for the substitute command is:</p>
<pre class="calibre29"><code class="calibre26">:s/old/new/</code></pre>
<p class="calibre10">The vim editor jumps to the first occurrence of the text <code class="calibre26">old</code> and replaces it with the text <code class="calibre26">new</code>. You can make a few modifications to the substitute command to substitute more than one occurrence of the text:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">:s/old/new/g</code> to replace all occurrences of <code class="calibre26">old</code> in a line</li>
<li class="calibre7"><code class="calibre26">:</code><code class="calibre26"><i class="calibre12">n</i></code><code class="calibre26">,</code><code class="calibre26"><i class="calibre12">ms</i></code><code class="calibre26">/old/new/g</code> to replace all occurrences of <code class="calibre26">old</code> between line numbers <code class="calibre26">n</code> and <code class="calibre26">m</code></li>
<li class="calibre7"><code class="calibre26">:%s/old/new/g</code> to replace all occurrences of <code class="calibre26">old</code> in the entire file</li>
<li class="calibre7"><code class="calibre26">:%s/old/new/gc</code> to replace all occurrences of <code class="calibre26">old</code> in the entire file, but prompt for each occurrence</li>
</ul>
<p class="calibre10">As you can see, for a console mode text editor, vim contains quite a few advanced features. Because every Linux distribution includes it, it's a good idea to at least know the basics of the vim editor so you can always edit scripts, no matter where you are or what you have available.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-185" class="calibre4"></a>Navigating the nano Editor</h2>
<p class="calibre10">Although vim is a very complicated editor with many powerful features, nano is a very simple editor. For individuals who need a simple console mode text editor that is easy to navigate, nano is the tool to use. It's also a great text editor for kids who are starting on their Linux command line adventure.</p>
<p class="calibre10">The nano text editor is a clone of the Unix systems' Pico editor. Although Pico also is a light and simple text editor, it is not licensed under the GPL. Not only is the nano text editor licensed under the GPL, it is also part of the GNU project.</p>
<p class="calibre10">The nano text editor is installed on most Linux distributions by default. Everything about the nano text editor is simple. To open a file at the command line with nano:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nano myprog.c</b></code></code></pre>
<p class="calibre10">If you start nano without a filename, or if the file doesn't exist, nano simply opens a new buffer area for editing. If you specify an existing file on the command line, nano reads the entire contents of the file into a buffer area, where it is ready for editing, as shown in <a id="calibre_link-1259" href="#calibre_link-1080" class="calibre4">Figure 10.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000047.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1080" href="#calibre_link-1259" class="calibre4"><b class="calibre21">Figure 10.2</b></a></span> The nano editor window</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="241" id="calibre_link-581" class="calibre11"></span>Notice at the bottom of the nano editor window various commands with a brief description are shown. These commands are the nano control commands. The caret (<code class="calibre26">â§)</code> symbol shown represents the Ctrl key. Therefore, <code class="calibre26">â§X</code> stands for the keyboard sequence Ctrl+X.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Though the nano control commands list capital letters in the keyboard sequences, you can use either lowercase or uppercase characters for control commands.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Having all the basic commands listed right in front of you is great. No need to memorize what control command does what. <a id="calibre_link-1260" href="#calibre_link-1139" class="calibre4">Table 10.2</a> presents the various nano control commands.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1139" href="#calibre_link-1260" class="calibre4"><b class="calibre21">Table 10.2</b></a></span> nano Control Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+C</td>
<td class="left">Displays the cursor's position within the text editing buffer</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+G</td>
<td class="left">Displays nano's main help window</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+J</td>
<td class="left">Justifies the current text paragraph</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+K</td>
<td class="left">Cuts the text line and stores it in cut buffer</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+O</td>
<td class="left">Writes out the current text editing buffer to a file</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+R</td>
<td class="left">Reads a file into the current text editing buffer</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+T</td>
<td class="left">Starts the available spell checker</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+U</td>
<td class="left">Pastes text stored in cut buffer and places in current line</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+V</td>
<td class="left">Scrolls text editing buffer to next page</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+W</td>
<td class="left">Searches for word or phrases within text editing buffer</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+X</td>
<td class="left">Closes the current text editing buffer, exits nano, and returns to the shell</td>
</tr>
<tr class="calibre28">
<td class="left">CTRL+Y</td>
<td class="left">Scrolls text editing buffer to previous page</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="242" id="calibre_link-582" class="calibre11"></span>The control commands listed in <a href="#calibre_link-1139" class="calibre4">Table 10.2</a> are really all you need. However, if you desire more powerful control features than those listed, nano has them. To see more control commands, type Ctrl+G in the nano text editor to display its main help window containing additional control commands.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you try to use the nano spell checker via the Ctrl+T command and get the error message <code class="calibre26">Spell checking failed: Error invoking âSpellâ</code>, there are some potential solutions. Install the spell checker software package, <code class="calibre26">aspell</code>, on your Linux distribution using Chapter 9 as a guide.</p>
<p class="calibre19">If installing the <code class="calibre26">aspell</code> software package does not solve the problem, as superuser edit the <code class="calibre26">/etc/nanorc</code> file, using your favorite text editor. Find the line, <code class="calibre26"># set speller âaspell -x -câ</code> and delete the hash mark (<code class="calibre26">#</code>) from the line. Save and exit the file.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Additional powerful features are available at the command line. You can use command line options to control nano editor features, such as creating a backup file before editing. Type <b class="calibre21">man nano</b> to see these additional command line options for starting nano.</p>
<p class="calibre10">The vim and nano text editors offer a choice between powerful and simple console mode text editors. However, neither offers the ability to use graphical features for editing. Some text editors can operate in both worlds, as explored in the next section.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-186" class="calibre4"></a>Exploring the emacs Editor</h2>
<p class="calibre10">The emacs editor is an extremely popular editor that appeared before even Unix was around. Developers liked it so much that they ported it to the Unix environment, and now it's been ported to the Linux environment. The emacs editor started out life as a console editor, much like vi, but has migrated to the graphical world.</p>
<p class="calibre10"><span type="pagebreak" title="243" id="calibre_link-583" class="calibre11"></span>The emacs editor still provides the original console mode editor, and now it also has the ability to use a graphical window to allow editing text in a graphical environment. Typically, when you start the emacs editor from a command line, the editor determines whether you have an available graphical session and starts in graphical mode. If you don't, it starts in console mode.</p>
<p class="calibre10">This section describes both the console mode and graphical mode emacs editors so that you'll know how to use either one if you want (or need) to.</p>
<section class="toclist">
<h3 class="calibre15">Checking your emacs package</h3>
<p class="calibre10">Many distributions do not come with the emacs editor installed by default. You can check your Red Hat-based distribution, by using the <code class="calibre26">which</code> and/or <code class="calibre26">yum list</code> command as shown on this CentOS distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">which emacs</b></code>
/usr/bin/which: no emacs in (/usr/lib64/qt-3.3
/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:
/usr/sbin:/sbin:/home/Christine/bin)
$
$ <code class="calibre26"><b class="calibre21">yum list emacs</b></code>
[...]
Available Packages
emacs.x86_64               1:23.1-25.el6                base
</code></pre>
<p class="calibre10">The emacs editor package is not currently installed on this CentOS distribution. However, it is available to be installed. (For a more thorough discussion on displaying installed software, see Chapter 9).</p>
<p class="calibre10">For a Debian-based distribution, check for the emacs editor package by using the <code class="calibre26">which</code> and/or <code class="calibre26">apt-cache show</code> command as shown on this Ubuntu distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">which emacs</b></code>
$
$ <code class="calibre26"><b class="calibre21">sudo apt-cache show emacs</b></code>
Package: emacs
Priority: optional
Section: editors
Installed-Size: 25
[...]
Description-en: GNU Emacs editor (metapackage)
 GNU Emacs is the extensible self-documenting text editor.
 This is a metapackage that will always depend on the latest
 recommended Emacs release.
Description-md5: 21fb7da111336097a2378959f6d6e6a8
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Origin: Ubuntu
Supported: 5y
$</code></pre>
<p class="calibre10">The <code class="calibre26"><span type="pagebreak" title="244" id="calibre_link-584" class="calibre11"></span>which</code> command operates a little differently here. When it does not find the installed command, it simply returns the bash shell prompt. The emacs editor package is optional for this Ubuntu distribution, but is available to be installed. The following shows the emacs editor being installed on Ubuntu:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo apt-get install emacs</b></code>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
[...]
Install emacsen-common for emacs24
emacsen-common: Handling install of emacsen flavor emacs24
Wrote /etc/emacs24/site-start.d/00debian-vars.elc
Wrote /usr/share/emacs24/site-lisp/debian-startup.elc
Setting up emacs (45.0ubuntu1) ...
Processing triggers for libc-bin (2.19-0ubuntu6) ...
$
$ <code class="calibre26"><b class="calibre21">which emacs</b></code>
/usr/bin/emacs
$</code></pre>
<p class="calibre10">Now when the <code class="calibre26">which</code> command is used, it points to the emacs program file. The emacs editor is ready to be used on this Ubuntu distribution.</p>
<p class="calibre10">For the CentOS distribution, install the emacs editor using the <code class="calibre26">yum</code> install command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo yum install emacs</b></code>
[sudo] password for Christine:
[...]
Setting up Install Process
Resolving Dependencies
[...]
Installed:
  emacs.x86_64 1:23.1-25.el6
  
Dependency Installed:
  emacs-common.x86_64 1:23.1-25.el6
  libotf.x86_64 0:0.9.9-3.1.el6
  m17n-db-datafiles.noarch 0:1.5.5-1.1.el6
Complete!
$
$ <code class="calibre26"><b class="calibre21">which emacs</b></code>
/usr/bin/emacs
$
$ <code class="calibre26"><b class="calibre21">yum list emacs</b></code>
[...]
Installed Packages
emacs.x86_64               1:23.1-25.el6               @base
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="245" id="calibre_link-585" class="calibre11"></span>With the emacs editor successfully installed on your Linux distribution, you can begin to explore its different features, staring with using it on the console.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using emacs on the console</h3>
<p class="calibre10">The console mode version of emacs is another editor that uses lots of key commands to perform editing functions. The emacs editor uses key combinations involving the Control key (the Ctrl key on the keyboard) and the Meta key. In most terminal emulator packages, the Meta key is mapped to the Alt key. The official emacs documents abbreviate the Ctrl key as C- and the Meta key as M-. Thus, if you enter a Ctrl+x key combination, the document shows C-x. This chapter does the same so as not to confuse you.</p>
<section class="toclist">
<h4 class="calibre25">Exploring the basics of emacs</h4>
<p class="calibre10">To edit a file using emacs, from the command line, enter:</p>
<pre class="calibre29"><code class="calibre26">$<code class="calibre26"> <b class="calibre21">emacs myprog.c</b></code></code></pre>
<p class="calibre10">The emacs console mode window appears with a short introduction and help screen. Don't be alarmed; as soon as you press a key, emacs loads the file into the active buffer and displays the text, as shown in <a id="calibre_link-1261" href="#calibre_link-1081" class="calibre4">Figure 10.3</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000053.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1081" href="#calibre_link-1261" class="calibre4"><b class="calibre21">Figure 10.3</b></a></span> Editing a file using the emacs editor in console mode</p>
</figcaption>
</figure>
<p class="calibre10">You'll notice that the top of the console mode window shows a typical menu bar. Unfortunately, you can't use the menu bar in console mode, only in graphical mode.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Some commands in this section work differently than described, if you run emacs in a graphical desktop environment. To use emac's console mode in a graphical desktop environment, use the <code class="calibre26">emacs</code> -<code class="calibre26">nw</code> command. If you want to use emacs' graphical features, see the section âUsing emacs in a GUI.â</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="246" id="calibre_link-586" class="calibre11"></span>Unlike the vim editor, where you have to move into and out of insert mode to switch between entering commands and inserting text, the emacs editor has only one mode. If you type a printable character, emacs inserts it at the current cursor position. If you type a command, emacs executes the command.</p>
<p class="calibre10">To move the cursor around the buffer area, you can use the arrow keys and the PageUp and PageDown keys, assuming that emacs detected your terminal emulator correctly. If not, these commands move the cursor around:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">C-p</code> moves up one line (the previous line in the text).</li>
<li class="calibre7"><code class="calibre26">C-b</code> moves left (back) one character.</li>
<li class="calibre7"><code class="calibre26">C-f</code> moves right (forward) one character.</li>
<li class="calibre7"><code class="calibre26">C-n</code> moves down one line (the next line in the text).</li>
</ul>
<p class="calibre10">These commands make longer jumps with the cursor within the text:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">M-f</code> moves right (forward) to the next word.</li>
<li class="calibre7"><code class="calibre26">M-b</code> moves left (backward) to the previous word.</li>
<li class="calibre7"><code class="calibre26">C-a</code> moves to the beginning of the current line.</li>
<li class="calibre7"><code class="calibre26">C-e</code> moves to the end of the current line.</li>
<li class="calibre7"><code class="calibre26">M-a</code> moves to the beginning of the current sentence.</li>
<li class="calibre7"><code class="calibre26">M-e</code> moves to the end of the current sentence.</li>
<li class="calibre7"><code class="calibre26">M-v</code> moves back one screen of data.</li>
<li class="calibre7"><code class="calibre26">C-v</code> moves forward one screen of data.</li>
<li class="calibre7"><code class="calibre26">M-&lt;</code> moves the first line of the text.</li>
<li class="calibre7"><code class="calibre26">M-&gt;</code> moves to the last line of the text.</li>
</ul>
<p class="calibre10">You should know these commands for saving the editor buffer back into the file and exiting emacs:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">C-x C-s</code> saves the current buffer contents to the file.</li>
<li class="calibre7"><code class="calibre26">C-z</code> exits emacs but keeps it running in your session so you can come back to it.</li>
<li class="calibre7"><code class="calibre26">C-x C-c</code> exits emacs and stops the program.</li>
</ul>
<p class="calibre10">You'll notice that two of these features require two key commands. The <code class="calibre26">C-x</code> command is called the <i class="calibre12">extend command</i>. This provides yet another whole set of commands to work with.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Editing data</h4>
<p class="calibre10"><span type="pagebreak" title="247" id="calibre_link-587" class="calibre11"></span>The emacs editor is pretty robust about inserting and deleting text in the buffer. To insert text, just move the cursor to the location where you want to insert the text and start typing. To delete text, emacs uses the Backspace key to delete the character before the current cursor position and the Delete key to delete the character at the current cursor location.</p>
<p class="calibre10">The emacs editor also has commands for killing text. The difference between deleting text and killing text is that when you kill text, emacs places it in a temporary area where you can retrieve it (see the next section, âCopying and pastingâ). Deleted text is gone forever.</p>
<p class="calibre10">These commands are for killing text in the buffer:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">M-Backspace</code> kills the word before the current cursor position.</li>
<li class="calibre7"><code class="calibre26">M-d</code> kills the word after the current cursor position.</li>
<li class="calibre7"><code class="calibre26">C-k</code> kills from the current cursor position to the end of the line.</li>
<li class="calibre7"><code class="calibre26">M-k</code> kills from the current cursor position to the end of the sentence.</li>
</ul>
<p class="calibre10">The emacs editor also includes a fancy way of mass-killing text. Just move the cursor to the start of the area you want to kill, and press either the <code class="calibre26">C-@</code> or <code class="calibre26">C-Spacebar</code> keys. Then move the cursor to the end of the area you want to kill, and press the <code class="calibre26">C-w</code> command keys. All the text between the two locations is killed.</p>
<p class="calibre10">If you happen to make a mistake when killing text, the <code class="calibre26">C-/</code> command undoes the kill command and returns the data to the state it was in before you killed it.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Copying and pasting</h4>
<p class="calibre10">You've seen how to cut data from the emacs buffer area; now it's time to see how to paste it somewhere else. Unfortunately, if you use the vim editor, this process may confuse you when you use the emacs editor.</p>
<p class="calibre10">In an unfortunate coincidence, pasting data in emacs is called <i class="calibre12">yanking</i>. In the vim editor, copying is called yanking, which is what makes this a difficult thing to remember if you happen to use both editors.</p>
<p class="calibre10">After you kill data using one of the kill commands, move the cursor to the location where you want to paste the data, and use the <code class="calibre26">C-y</code> command. This yanks the text out of the temporary area and pastes it at the current cursor position. The <code class="calibre26">C-y</code> command yanks the text from the last kill command. If you've performed multiple kill commands, you can cycle through them using the <code class="calibre26">M-y</code> command.</p>
<p class="calibre10">To copy text, just yank it back into the same location you killed it from and then move to the new location and use the <code class="calibre26">C-y</code> command again. You can yank text back as many times as you desire.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Searching and Replacing</h4>
<p class="calibre10"><span type="pagebreak" title="248" id="calibre_link-588" class="calibre11"></span>Searching for text in the emacs editor is done by using the <code class="calibre26">C-s</code> and <code class="calibre26">C-r</code> commands. The <code class="calibre26">C-s</code> command performs a forward search in the buffer area from the current cursor position to the end of the buffer, whereas the <code class="calibre26">C-r</code> command performs a backward search in the buffer area from the current cursor position to the start of the buffer.</p>
<p class="calibre10">When you enter either the <code class="calibre26">C-s</code> or <code class="calibre26">C-r</code> command, a prompt appears in the bottom line, querying you for the text to search. You can perform two types of searches in emacs.</p>
<p class="calibre10">In an <i class="calibre12">incremental</i> search, the emacs editor performs the text search in real-time mode as you type the word. When you type the first letter, it highlights all the occurrences of that letter in the buffer. When you type the second letter, it highlights all the occurrences of the two-letter combination in the text and so on until you complete the text you're searching for.</p>
<p class="calibre10">In a <i class="calibre12">non-incremental</i> search, press the Enter key after the <code class="calibre26">C-s</code> or <code class="calibre26">C-r</code> commands. This locks the search query into the bottom line area and allows you to type the search text in full before searching.</p>
<p class="calibre10">To replace an existing text string with a new text string, you must use the <code class="calibre26">M-x</code> command. This command requires a text command, along with parameters.</p>
<p class="calibre10">The text command is <code class="calibre26">replace-string</code>. After typing the command, press the Enter key, and emacs queries you for the existing text string. After entering that, press the Enter key again and emacs queries you for the new replacement text string.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using buffers in emacs</h4>
<p class="calibre10">The emacs editor allows you to edit multiple files at the same time by having multiple buffer areas. You can load files into a buffer and switch between buffers while editing.</p>
<p class="calibre10">To load a new file into a buffer while you're in emacs, use the <code class="calibre26">C-x</code> <code class="calibre26">C-f</code> key combination. This is the emacs Find a File mode. It takes you to the bottom line in the window and allows you to enter the name of the file you want to start to edit. If you don't know the name or location of the file, just press the Enter key. This brings up a file browser in the edit window, as shown in <a id="calibre_link-1262" href="#calibre_link-1082" class="calibre4">Figure 10.4</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000001.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1082" href="#calibre_link-1262" class="calibre4"><b class="calibre21">Figure 10.4</b></a></span> The emacs Find a File mode browser</p>
</figcaption>
</figure>
<p class="calibre10">From here, you can browse to the file you want to edit. To traverse up a directory level, go to the double dot entry and press the Enter key. To traverse down a directory, go to the directory entry and press the Enter key. When you've found the file you want to edit, press the Enter key and emacs loads it into a new buffer area.</p>
<p class="calibre10">You can list the active buffer areas by pressing the <code class="calibre26">C-x C-b</code> extended command combination. The emacs editor splits the editor window and displays a list of buffers in the bottom window. emacs provides two buffers in addition to your main editing buffer:</p>
<ul class="calibre14">
<li class="calibre7">A scratch area called *scratch*</li>
<li class="calibre7">A message area called *Messages*</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="249" id="calibre_link-589" class="calibre11"></span>The scratch area allows you to enter LISP programming commands as well as enter notes to yourself. The message area shows messages generated by emacs while operating. If any errors occur while using emacs, they appear in the message area.</p>
<p class="calibre10">You can switch to a different buffer area in the window in two ways:</p>
<ul class="calibre14">
<li class="calibre7">Use <code class="calibre26">C-x o</code> to switch to the buffer listing window. Use the arrow keys to move to the buffer area you want and press the Enter key.</li>
<li class="calibre7">Use <code class="calibre26">C-x b</code> to type in the name of the buffer area you want to switch to.</li>
</ul>
<p class="calibre10">When you select the option to switch to the buffer listing window, emacs opens the buffer area in the new window area. The emacs editor allows you to have multiple windows open in a single session. The following section discusses how to manage multiple windows in emacs.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using windows in console mode emacs</h4>
<p class="calibre10">The console mode emacs editor was developed many years before the idea of graphical windows appeared. However, it was advanced for its time, in that it could support multiple editing windows within the main emacs window.</p>
<p class="calibre10">You can split the emacs editing window into multiple windows by using one of two commands:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">C-x 2</code> splits the window horizontally into two windows.</li>
<li class="calibre7"><code class="calibre26">C-x 3</code> splits the window vertically into two windows.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="250" id="calibre_link-590" class="calibre11"></span>To move from one window to another, use the <code class="calibre26">C-x o</code> command. Notice that when you create a new window, emacs uses the buffer area from the original window in the new window. After you move into the new window, you can use the <code class="calibre26">C-x C-f</code> command to load a new file or use one of the commands to switch to a different buffer area in the new window.</p>
<p class="calibre10">To close a window, move to it and use the <code class="calibre26">C-x 0</code> (that's a zero) command. If you want to close all the windows except the one you're in, use the <code class="calibre26">C-x 1</code> (that's a numerical one) command.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using emacs in a GUI</h3>
<p class="calibre10">If you use emacs from a GUI environment (such as the Unity or GNOME desktops), it starts in graphical mode, as shown in <a id="calibre_link-1263" href="#calibre_link-1083" class="calibre4">Figure 10.5</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000004.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1083" href="#calibre_link-1263" class="calibre4"><b class="calibre21">Figure 10.5</b></a></span> The emacs graphical window</p>
</figcaption>
</figure>
<p class="calibre10">If you've already used emacs in console mode, you should be fairly familiar with the graphical mode. All the key commands are available as menu bar items. The emacs menu bar contains the following items:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">File</b> allows you to open files in the window, create new windows, close windows, save buffers, and print buffers.</li>
<li class="calibre7"><b class="calibre21">Edit</b> allows you to cut and copy selected text to the clipboard, paste clipboard data to the current cursor position, search for text, and replace text.</li>
<li class="calibre7"><b class="calibre21">Options</b> provides settings for many more emacs features, such as highlighting, word wrap, cursor type, and setting fonts.</li>
<li class="calibre7"><b class="calibre21">Buffers</b> lists the current buffers available and allows you to easily switch between buffer areas.</li>
<li class="calibre7"><b class="calibre21">Tools</b> provides access to the advanced features in emacs, such as the command line interface access, spell checking, comparing text between files (called diff), sending an e-mail message, calendar, and the calculator.</li>
<li class="calibre7"><b class="calibre21">Help</b> provides the emacs manual online for access to help on specific emacs functions.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="251" id="calibre_link-591" class="calibre11"></span>In addition to the normal graphical emacs menu bar items, there is often a separate item specific to the file type in the editor buffer. <a href="#calibre_link-1083" class="calibre4">Figure 10.5</a> shows opening a C program, so emacs provided a C menu item, allowing advanced settings for highlighting C syntax, and compiling, running, and debugging the code from a command prompt.</p>
<p class="calibre10">The graphical emacs window is an example of an older console application making the migration to the graphical world. Now that many Linux distributions provide graphical desktops (even on servers that don't need them), graphical editors are becoming more commonplace. Popular Linux desktop environments (such as KDE and GNOME) have also provided graphical text editors specifically for their environments, which are covered in the rest of this chapter.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-187" class="calibre4"></a>Exploring the KDE Family of Editors</h2>
<p class="calibre10">If you're using a Linux distribution that uses the KDE desktop (see Chapter 1), you have a couple of options when it comes to text editors. The KDE project officially supports two popular text editors:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">KWrite:</b> A single-screen text-editing package</li>
<li class="calibre7"><b class="calibre21">Kate:</b> A full-featured, multi-window text-editing package</li>
</ul>
<p class="calibre10">Both of these editors are graphical text editors that contain many advanced features. The Kate editor provides more advanced features, plus extra niceties not often found in standard text editors. This section describes each of the editors and shows some of the features you can use to help with your shell script editing.</p>
<section class="toclist">
<h3 class="calibre15">Looking at the KWrite editor</h3>
<p class="calibre10">The basic editor for the KDE environment is KWrite. It provides simple word-processing&ndash;style text editing, along with support for code syntax highlighting and editing. The default KWrite editing window is shown in <a id="calibre_link-1264" href="#calibre_link-1084" class="calibre4">Figure 10.6</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000007.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1084" href="#calibre_link-1264" class="calibre4"><b class="calibre21">Figure 10.6</b></a></span> The default KWrite window editing a shell script program</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="252" id="calibre_link-592" class="calibre11"></span>You can't tell from <a href="#calibre_link-1084" class="calibre4">Figure 10.6</a>, but the KWrite editor recognizes several types of programming languages and uses color coding to distinguish constants, functions, and comments. Also, notice that the <code class="calibre26">for</code> loop has an icon that links the opening and closing braces. This is called a <i class="calibre12">folding marker</i>. By clicking the icon, you can collapse the function into a single line. This is a great feature when working through large applications.</p>
<p class="calibre10">The KWrite editing window provides full cut and paste capabilities, using the mouse and the arrow keys. As in a word processor, you can highlight and cut (or copy) text anywhere in the buffer area and paste it at any other place.</p>
<p class="calibre10">To edit a file using KWrite, you can either select KWrite from the KDE menu system on your desktop (some Linux distributions even create a Panel icon for it) or start it from the command line prompt:</p>
<pre class="calibre29"><code class="calibre26">$<code class="calibre26"> <b class="calibre21">kwrite factorial.sh</b></code></code></pre>
<p class="calibre10">The <code class="calibre26">kwrite</code> command has several command line parameters you can use to customize how it starts:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">--stdin</code> causes KWrite to read data from the standard input device instead of a file.</li>
<li class="calibre7"><code class="calibre26">--encoding</code> specifies a character encoding type to use for the file.</li>
<li class="calibre7"><code class="calibre26">--line</code> specifies a line number in the file to start at in the editor window.</li>
<li class="calibre7"><code class="calibre26">--column</code> specifies a column number in the file to start at in the editor window.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="253" id="calibre_link-593" class="calibre11"></span>The KWrite editor provides both a menu bar and a toolbar at the top of the edit window, allowing you to select features and change configuration settings of the KWrite editor.</p>
<p class="calibre10">The menu bar contains these items:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">File</b> loads, saves, prints, and exports text from files.</li>
<li class="calibre7"><b class="calibre21">Edit</b> manipulates text in the buffer area.</li>
<li class="calibre7"><b class="calibre21">View</b> manages how the text appears in the editor window.</li>
<li class="calibre7"><b class="calibre21">Bookmarks</b> handle pointers to return to specific locations in the text; this option may need to be enabled in the configurations.</li>
<li class="calibre7"><b class="calibre21">Tools</b> contains specialized features to manipulate the text.</li>
<li class="calibre7"><b class="calibre21">Settings</b> configures the way the editor handles text.</li>
<li class="calibre7"><b class="calibre21">Help</b> gives you information about the editor and commands.</li>
</ul>
<p class="calibre10">The Edit menu bar item provides commands for all your text-editing needs. Instead of having to remember cryptic key commands (which by the way, KWrite also supports), you can just select items in the Edit menu bar, as shown in <a id="calibre_link-1265" href="#calibre_link-1140" class="calibre4">Table 10.3</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1140" href="#calibre_link-1265" class="calibre4"><b class="calibre21">Table 10.3</b></a></span> The KWrite Edit Menu Items</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Item</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Undo</td>
<td class="left">Reverses the last action or operation</td>
</tr>
<tr class="calibre28">
<td class="left">Redo</td>
<td class="left">Reverses the last undo action</td>
</tr>
<tr class="calibre28">
<td class="left">Cut</td>
<td class="left">Deletes the selected text and places it in the clipboard</td>
</tr>
<tr class="calibre28">
<td class="left">Copy</td>
<td class="left">Copies the selected text to the clipboard</td>
</tr>
<tr class="calibre28">
<td class="left">Paste</td>
<td class="left">Inserts the current contents of the clipboard at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left">Select All</td>
<td class="left">Selects all text in the editor</td>
</tr>
<tr class="calibre28">
<td class="left">Deselect</td>
<td class="left">Deselects any text that is currently selected</td>
</tr>
<tr class="calibre28">
<td class="left">Overwrite Mode</td>
<td class="left">Toggles insert mode to overwrite mode, replacing text with new typed text instead of just inserting the new text</td>
</tr>
<tr class="calibre28">
<td class="left">Find</td>
<td class="left">Produces the Find Text dialog box, which allows you to customize a text search</td>
</tr>
<tr class="calibre28">
<td class="left">Find Next</td>
<td class="left">Repeats the last find operation forward in the buffer area</td>
</tr>
<tr class="calibre28">
<td class="left">Find Previous</td>
<td class="left">Repeats the last find operation backwards in the buffer area</td>
</tr>
<tr class="calibre28">
<td class="left">Replace</td>
<td class="left">Produces the Replace With dialog box, which allows you to customize a text search and replace</td>
</tr>
<tr class="calibre28">
<td class="left">Find Selected</td>
<td class="left">Finds the next occurrence of the selected text</td>
</tr>
<tr class="calibre28">
<td class="left">Find Selected Backwards</td>
<td class="left">Finds the previous occurrence of the selected text</td>
</tr>
<tr class="calibre28">
<td class="left">Go to Line</td>
<td class="left">Produces the Goto dialog box, which allows you to enter a line number. The cursor moves to the specified line</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="254" id="calibre_link-594" class="calibre11"></span>The Find feature has two modes. Normal mode performs simple text searches and power searches. Replace mode lets you do advanced searching and replacing if necessary. You toggle between the two modes using the green arrow in the Find section, as shown in <a id="calibre_link-1266" href="#calibre_link-1085" class="calibre4">Figure 10.7</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000011.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1085" href="#calibre_link-1266" class="calibre4"><b class="calibre21">Figure 10.7</b></a></span> The KWrite Find section</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="255" id="calibre_link-595" class="calibre11"></span>The Find power mode allows you to search not only with words, but with a regular expression (discussed in Chapter 20) for the search. You can use some other options to customize the search as well, indicating, for example, whether or not to perform a case-sensitive search or to look only for whole words instead of finding the text within words.</p>
<p class="calibre10">The Tools menu bar item provides several handy features for working with the text in the buffer area. <a id="calibre_link-1267" href="#calibre_link-1141" class="calibre4">Table 10.4</a> describes the tools available in KWrite.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1141" href="#calibre_link-1267" class="calibre4"><b class="calibre21">Table 10.4</b></a></span> The KWrite Tools</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Tool</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Read Only Mode</td>
<td class="left">Locks the text so no changes can be made while in the editor</td>
</tr>
<tr class="calibre28">
<td class="left">Encoding</td>
<td class="left">Sets the character set encoding used by the text</td>
</tr>
<tr class="calibre28">
<td class="left">Spelling</td>
<td class="left">Starts the spell-check program at the start of the text</td>
</tr>
<tr class="calibre28">
<td class="left">Spelling (from cursor)</td>
<td class="left">Starts the spell-check program from the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left">Spellcheck Selection</td>
<td class="left">Starts the spell-check program only on the selected section of text</td>
</tr>
<tr class="calibre28">
<td class="left">Indent</td>
<td class="left">Increases the paragraph indentation by one</td>
</tr>
<tr class="calibre28">
<td class="left">Unindent</td>
<td class="left">Decreases the paragraph indentation by one</td>
</tr>
<tr class="calibre28">
<td class="left">Clean Indentation</td>
<td class="left">Returns all paragraph indentation to the original settings</td>
</tr>
<tr class="calibre28">
<td class="left">Align</td>
<td class="left">Forces the current line or the selected lines to return to the default indentation settings</td>
</tr>
<tr class="calibre28">
<td class="left">Uppercase</td>
<td class="left">Sets the selected text, or the character at the current cursor position, to uppercase</td>
</tr>
<tr class="calibre28">
<td class="left">Lowercase</td>
<td class="left">Sets the selected text, or the character at the current cursor position, to lowercase</td>
</tr>
<tr class="calibre28">
<td class="left">Capitalize</td>
<td class="left">Capitalizes the first letter of the selected text or the word at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left">Join Lines</td>
<td class="left">Combines the selected lines, or the line at the current cursor position and the next line, into one line</td>
</tr>
<tr class="calibre28">
<td class="left">Word Wrap Document</td>
<td class="left">Enables word wrapping in the text. If a line extends past the editor window edge, the line continues on the next line.</td>
</tr>
</table>
</figure>
<p class="calibre10">There are lots of tools for a simple text editor!</p>
<p class="calibre10">The Settings menu includes the Configure Editor dialog box, shown in <a id="calibre_link-1268" href="#calibre_link-1086" class="calibre4">Figure 10.8</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000017.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1086" href="#calibre_link-1268" class="calibre4"><b class="calibre21">Figure 10.8</b></a></span> The KWrite Configure Editor dialog box</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="256" id="calibre_link-596" class="calibre11"></span>The Configuration dialog box uses icons on the left side for you to select the feature in KWrite to configure. When you select an icon, the right side of the dialog box shows the configuration settings for the feature.</p>
<p class="calibre10">The Appearance feature allows you to set several features that control how the text appears in the text editor window. You can enable word wrap, line numbers (great for programmers), and the folder markers from here. With the Fonts &amp; Colors feature, you can customize the complete color scheme for the editor, determining what colors to make each category of text in the program code.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Looking at the Kate editor</h3>
<p class="calibre10">The Kate editor is the flagship editor for the KDE Project. It uses the same text editor as the KWrite application (so most of those features are the same), but it incorporates lots of other features into a single package.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you find that the Kate editor has not been installed with your KDE desktop environment, you can easily install it (see Chapter 9). The package name that contains Kate is <code class="calibre26">kdesdk</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="257" id="calibre_link-597" class="calibre11"></span>When you start the Kate editor from the KDE menu system, the first thing you notice is that the editor doesn't start! Instead, you get a dialog box, as shown in <a id="calibre_link-1269" href="#calibre_link-1087" class="calibre4">Figure 10.9</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000023.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1087" href="#calibre_link-1269" class="calibre4"><b class="calibre21">Figure 10.9</b></a></span> The Kate session dialog box</p>
</figcaption>
</figure>
<p class="calibre10">The Kate editor handles files in sessions. You can have multiple files open in a session, and you can have multiple sessions saved. When you start Kate, it provides you with the choice of which session to return to. When you close your Kate session, it remembers the documents you had open and displays them the next time you start Kate. This allows you to easily manage files from multiple projects by using separate workspaces for each project.</p>
<p class="calibre10">After selecting a session, you see the main Kate editor window, shown in <a id="calibre_link-1270" href="#calibre_link-1088" class="calibre4">Figure 10.10</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000029.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1088" href="#calibre_link-1270" class="calibre4"><b class="calibre21">Figure 10.10</b></a></span> The main Kate editing window</p>
</figcaption>
</figure>
<p class="calibre10">The left side frame shows the documents currently open in the session. You can switch between documents just by clicking the document name. To edit a new file, click the Filesystem Browser tab on the left side. The left frame is now a full graphical filesystem browser, allowing you to graphically browse to locate your files.</p>
<p class="calibre10">A great feature of the Kate editor is the built-in terminal window, shown in <a id="calibre_link-1271" href="#calibre_link-1089" class="calibre4">Figure 10.11</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000035.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1089" href="#calibre_link-1271" class="calibre4"><b class="calibre21">Figure 10.11</b></a></span> The Kate built-in terminal window</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="258" id="calibre_link-598" class="calibre11"></span>The terminal tab at the bottom of the text editor window starts the built-in terminal emulator in Kate (using the KDE Konsole terminal emulator). This feature horizontally splits the current editing window, creating a new window with Konsole running in it. You can now enter command line commands, start programs, or check on system settings without having to leave the editor! To close the terminal window, just type <b class="calibre21">exit</b> at the command prompt.</p>
<p class="calibre10">As you can tell from the terminal feature, Kate also supports multiple windows. The Window menu bar item (<code class="calibre26">View</code>) provides options to perform these tasks:</p>
<ul class="calibre14">
<li class="calibre7">Create a new Kate window using the current session</li>
<li class="calibre7">Split the current window vertically to create a new window</li>
<li class="calibre7">Split the current window horizontally to create a new window</li>
<li class="calibre7">Close the current window</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="259" id="calibre_link-599" class="calibre11"></span>To set the configuration settings in Kate, select the Configure Kate item under the Settings menu bar item. The Configuration dialog box, shown in <a id="calibre_link-1272" href="#calibre_link-1090" class="calibre4">Figure 10.12</a>, appears.</p>
<figure class="calibre23">
<img class="center" src="images/000042.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1090" href="#calibre_link-1272" class="calibre4"><b class="calibre21">Figure 10.12</b></a></span> The Kate configuration settings dialog box</p>
</figcaption>
</figure>
<p class="calibre10">Notice that the Editor settings area is exactly the same as for KWrite. This is because the two editors share the same text editor engine. The Application settings area allows you to configure settings for the Kate items, such as controlling sessions (shown in <a href="#calibre_link-1090" class="calibre4">Figure 10.12</a>), the documents list, and the filesystem browser. Kate also supports external plug-in applications, which can be activated here.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-188" class="calibre4"></a>Exploring the GNOME Editor</h2>
<p class="calibre10">If you're working on a Linux system using the GNOME or Unity desktop environment, there's a graphical text editor that you can use as well. The gedit text editor is a basic text editor, with a few advanced features thrown in just for fun. This section walks you through the features of gedit and demonstrates how to use it for your shell script programming.</p>
<section class="toclist">
<h3 class="calibre15">Starting gedit</h3>
<p class="calibre10"><span type="pagebreak" title="260" id="calibre_link-600" class="calibre11"></span>Most GNOME desktop environments include gedit in the Accessories Panel menu item. For the Unity desktop environment, go to Dash â¨ Search and type <b class="calibre21">gedit</b>. If you can't find gedit via the menu system, you can start it from the command line prompt in a GUI terminal emulator:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gedit factorial.sh myprog.c</b></code></code></pre>
<p class="calibre10"><span type="pagebreak" title="261" id="calibre_link-601" class="calibre11"></span>When you start gedit with multiple files, it loads all the files into separate buffers and displays each one as a tabbed window within the main editor window, as shown in <a id="calibre_link-1273" href="#calibre_link-1091" class="calibre4">Figure 10.13</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000050.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1091" href="#calibre_link-1273" class="calibre4"><b class="calibre21">Figure 10.13</b></a></span> The gedit main editor window</p>
</figcaption>
</figure>
<p class="calibre10">The left frame in the gedit main editor window shows the documents you're currently editing. If your gedit doesn't show the left frame when started, you can press the F9 function key or enable <code class="calibre26">Side Pane</code> from the View menu.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Different desktops may have gedit options that are available in slightly different menu locations than shown in these figures. Additional options may also be available. Consult your distribution's gedit Help menu for more assistance.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The right side shows the tabbed windows that contain the buffer text. If you hover your mouse pointer over each tab, a dialog box appears, showing the full pathname of the file, the MIME type, and the character set encoding it uses.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Understanding basic gedit features</h3>
<p class="calibre10"><span type="pagebreak" title="262" id="calibre_link-602" class="calibre11"></span>In addition to the editor windows, gedit uses both a menu bar and toolbar that allow you to set features and configure settings. The toolbar provides quick access to menu bar items. These menu bar items are available:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">File</b> handles new files, saves existing files, and prints files.</li>
<li class="calibre7"><b class="calibre21">Edit</b> manipulates text in the active buffer area and sets the editor preferences.</li>
<li class="calibre7"><b class="calibre21">View</b> sets the editor features to display in the window and sets the text highlighting mode.</li>
<li class="calibre7"><b class="calibre21">Search</b> finds and replaces text in the active editor buffer area.</li>
<li class="calibre7"><b class="calibre21">Tools</b> accesses plug-in tools installed in gedit.</li>
<li class="calibre7"><b class="calibre21">Documents</b> manages files open in the buffer areas.</li>
<li class="calibre7"><b class="calibre21">Help</b> provides access to the full gedit manual.</li>
</ul>
<p class="calibre10">There shouldn't be anything too surprising here. The Edit menu contains the standard cut, copy, and paste functions, along with a neat feature that allows you to easily enter the date and time in the text in several different formats. The Search menu provides a standard find function, which produces a dialog box where you can enter the text to find, along with the capability to select how the find feature should work (matching case, matching the whole word, and the search direction). It also provides an incremental search feature, which works in real-time mode, finding text as you type the characters of the word.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Setting preferences</h3>
<p class="calibre10">The Edit menu contains a Preferences item, which produces the gedit Preferences dialog box, shown in <a id="calibre_link-1274" href="#calibre_link-1092" class="calibre4">Figure 10.14</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000056.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1092" href="#calibre_link-1274" class="calibre4"><b class="calibre21">Figure 10.14</b></a></span> The GNOME desktop gedit Preferences dialog box</p>
</figcaption>
</figure>
<p class="calibre10">This is where you can customize the operation of the gedit editor. The Preferences dialog box contains five tabbed areas for setting the features and behavior of the editor.</p>
<section class="toclist">
<h4 class="calibre25">Setting View preferences</h4>
<p class="calibre10">The View tab provides options for how gedit displays the text in the editor window:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">Text Wrapping:</b> Determines how to handle long lines of text in the editor. The Enabling text wrapping option wraps long lines to the next line of the editor. The Do Not Split Words Over Two Lines option prevents the auto-inserting of hyphens into long words, to prevent them being split between two lines.</li>
<li class="calibre7"><b class="calibre21">Line Numbers:</b> Displays line numbers in the left margin in the editor window.</li>
<li class="calibre7"><b class="calibre21">Current Line:</b> <span type="pagebreak" title="263" id="calibre_link-603" class="calibre11"></span>Highlights the line where the cursor is currently positioned, enabling you to easily find the cursor position.</li>
<li class="calibre7"><b class="calibre21">Right Margin:</b> Enables the right margin and allows you to set how many columns should be in the editor window. The default value is 80 columns.</li>
<li class="calibre7"><b class="calibre21">Bracket Matching:</b> When enabled, highlights bracket pairs in programming code, allowing you to easily match brackets in <code class="calibre26">if-then</code> statements, <code class="calibre26">for</code> and <code class="calibre26">while</code> loops, and other coding elements that use brackets.</li>
</ul>
<p class="calibre10">The line-numbering and bracket-matching features provide an environment for programmers to troubleshoot code that's not often found in text editors.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Setting Editor preferences</h4>
<p class="calibre10">The Editor tab provides options for how the gedit editor handles tabs and indentation, along with how files are saved:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">Tab Stops:</b> <span type="pagebreak" title="264" id="calibre_link-604" class="calibre11"></span>Sets the number of spaces skipped when you press the Tab key. The default value is eight. This feature also includes a check box that, when selected, inserts spaces instead of a tab skip.</li>
<li class="calibre7"><b class="calibre21">Automatic Indentation:</b> When enabled, causes gedit to automatically indent lines in the text for paragraphs and code elements (such as <code class="calibre26">if-then</code> statements and loops).</li>
<li class="calibre7"><b class="calibre21">File Saving:</b> Provides two features for saving files: whether or not to create a backup copy of the file when opened in the edit window, and whether or not to automatically save the file at a preselected interval.</li>
</ul>
<p class="calibre10">The auto-save feature is a great way to ensure that your changes are saved on a regular basis to prevent catastrophes from crashes or power outages.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Setting Font &amp; Color preferences</h4>
<p class="calibre10">The Font &amp; Colors tab allows you to configure (not surprisingly) two items:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">Font:</b> Allows you to select the default font, or to select a customized font and font size from a dialog box.</li>
<li class="calibre7"><b class="calibre21">Color Scheme:</b> Allows you to select the default color scheme used for text, background, selected text, and selection colors, or choose a custom color for each category.</li>
</ul>
<p class="calibre10">The default colors for gedit normally match the standard GNOME desktop theme selected for the desktop. These colors will change to match the scheme you select for the desktop.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Managing plug-ins</h4>
<p class="calibre10">The Plugins tab provides control over the plug-ins used in gedit. Plug-ins are separate programs that can interface with gedit to provide additional functionality.</p>
<p class="calibre10">Several plug-ins are available for gedit, but not all of them are installed by default. <a id="calibre_link-1275" href="#calibre_link-1142" class="calibre4">Table 10.5</a> describes the plug-ins that are currently available in the GNOME desktop's gedit.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1142" href="#calibre_link-1275" class="calibre4"><b class="calibre21">Table 10.5</b></a></span> The GNOME desktop gedit Plug-ins</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Plug-In</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Change Case</td>
<td class="left">Changes the case of selected text</td>
</tr>
<tr class="calibre28">
<td class="left">Document Statistics</td>
<td class="left">Reports the number of words, lines, characters, and non-space characters</td>
</tr>
<tr class="calibre28">
<td class="left">External Tools</td>
<td class="left">Provides a shell environment in the editor to execute commands and scripts</td>
</tr>
<tr class="calibre28">
<td class="left">File Browser Pane</td>
<td class="left">Provides a simple file browser to make selecting files for editing easier</td>
</tr>
<tr class="calibre28">
<td class="left">Indent Lines</td>
<td class="left">Provides selected lines to be indented or un-indented</td>
</tr>
<tr class="calibre28">
<td class="left">Insert Date/Time</td>
<td class="left">Inserts the current date and time in several formats at the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left">Modelines</td>
<td class="left">Provides emacs-style message lines at the bottom of the editor window</td>
</tr>
<tr class="calibre28">
<td class="left">Python Console</td>
<td class="left">Provides an interactive console at the bottom of the editor window for entering commands using the Python programming language</td>
</tr>
<tr class="calibre28">
<td class="left">Quick Open</td>
<td class="left">Opens files directly in the gedit edit window</td>
</tr>
<tr class="calibre28">
<td class="left">Snippets</td>
<td class="left">Allows you to store often-used pieces of text for easy retrieval anywhere in the text</td>
</tr>
<tr class="calibre28">
<td class="left">Sort</td>
<td class="left">Quickly sorts the entire file or selected text</td>
</tr>
<tr class="calibre28">
<td class="left">Spell Checker</td>
<td class="left">Provides dictionary spellchecking for the text file</td>
</tr>
<tr class="calibre28">
<td class="left">Tag List</td>
<td class="left">Provides a list of commonly used strings you can easily enter into your text</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="265" id="calibre_link-605" class="calibre11"></span>Plug-ins that are enabled show a check mark in the check box next to their name. Some plug-ins, such as the External Tools plug-in, also provide additional configuration features after you select them. It allows you to set a shortcut key to start the terminal, where gedit displays output, and the command to use to start the shell session.</p>
<p class="calibre10">Unfortunately, not all plug-ins are installed in the same place in the gedit menu bar. Some plug-ins appear in the Tools menu bar item (such as the Spell Checker and External Tools plug-ins), while others appear in the Edit menu bar item (such as the Change Case and Insert Date/Time plug-ins).</p>
<p class="calibre10">This chapter has covered just a few of the text editors available on Linux. If you find that the text editors described here don't meet your needs, you have options. Many more Linux editors are available, such as geany, Eclipse, jed, Bluefish, and leafpad to name a few. All these editors can help you as you begin your <code class="calibre26">bash </code>shell script writing journey.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-189" class="calibre4"></a>Summary</h2>
<p class="calibre10">When it comes to creating shell scripts, you need some type of text editor. Several popular text editors are available for the Linux environment. The most popular editor in the Unix world, vi, has been ported to the Linux world as the vim editor. The vim editor provides simple text editing from the console, using a rudimentary full-screen graphical mode. The vim editor provides many advanced editor features, such as text searching and replacement.</p>
<p class="calibre10">Another editor that has been ported from the Unix world to Linux is the nano text editor. The vim editor can be rather complex, but the nano editor offers simplicity. The nano editor allows quick text editing in console mode.</p>
<p class="calibre10"><span type="pagebreak" title="266" id="calibre_link-606" class="calibre11"></span>Another popular Unix editor &mdash; emacs &mdash; has also made its way to the Linux world. The Linux version of emacs has both console and a graphical mode, making it the bridge between the old world and the new. The emacs editor provides multiple buffer areas, allowing you to edit multiple files simultaneously.</p>
<p class="calibre10">The KDE Project created two editors for use in the KDE desktop. The KWrite editor is a simple editor that provides the basic text-editing features, along with a few advanced features, such as syntax highlighting for programming code, line numbering, and code folding. The Kate editor provides more advanced features for programmers. One great feature in Kate is a built-in terminal window. You can open a command line interface session directly in the Kate editor without having to open a separate terminal emulator window. The Kate editor also allows you to open multiple files, providing different windows for each opened file.</p>
<p class="calibre10">The GNOME Project also provides a simple text editor for programmers. The gedit editor is a basic text editor that provides some advanced features such as code syntax highlighting and line numbering, but it was designed to be a bare-bones editor. To spruce up the gedit editor, developers created plug-ins, which expand the features available in gedit. Current plug-ins include a spell-checker, a terminal emulator, and a file browser.</p>
<p class="calibre10">This wraps up the background chapters on working with the command line in Linux. The next part of the book dives into the shell-scripting world. The next chapter starts off by showing you how to create a shell script file and how to run it on your Linux system. It also shows you the basics of shell scripts, allowing you to create simple programs by stringing multiple commands together into a script you can run.</p>
</section>
</section>
</div>


<div class="calibre1" id="calibre_link-190">
<header class="calibre8">
<h1 class="calibre9"><span class="chaptertitle">Part II</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5">Shell Scripting Basics</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18"><span type="pagebreak" title="267" id="calibre_link-1306" class="calibre30"></span>In This Part</h1>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1281" class="calibre4"><b class="calibre21">Chapter 11</b> Basic Script Building</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-78" class="calibre4"><b class="calibre21">Chapter 12</b> Using Structured Commands</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1175" class="calibre4"><b class="calibre21">Chapter 13</b> More Structured Commands</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1176" class="calibre4"><b class="calibre21">Chapter 14</b> Handling User Input</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-1213" class="calibre4"><b class="calibre21">Chapter 15</b> Presenting Data</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-51" class="calibre4"><b class="calibre21">Chapter 16</b> Script Control</a></li>
</ol>
</section>
</aside>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1281">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-191" class="calibre4"></a><span class="chaptertitle">Chapter 11</span><br class="calibre22" /><span class="chaptertitle">Basic Script Building</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Using multiple commands</li>
<li class="calibre7">Creating a script file</li>
<li class="calibre7">Displaying messages</li>
<li class="calibre7">Using variables</li>
<li class="calibre7">Redirecting input and output</li>
<li class="calibre7">Pipes</li>
<li class="calibre7">Performing math</li>
<li class="calibre7">Exiting the script</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="269" id="calibre_link-607" class="calibre11"></span>Now that we've covered the basics of the Linux system and the command line, it's time to start coding. This chapter discusses the basics of writing shell scripts. You need to know these basic concepts before you can start writing your own shell script masterpieces.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-192" class="calibre4"></a>Using Multiple Commands</h2>
<p class="calibre10">So far you've seen how to use the command line interface (CLI) prompt of the shell to enter commands and view the command results. The key to shell scripts is the ability to enter multiple commands and process the results from each command, even possibly passing the results of one command to another. The shell allows you to chain commands together into a single step.</p>
<p class="calibre10">If you want to run two commands together, you can enter them on the same prompt line, separated with a semicolon:</p>
<pre class="calibre29"><code class="calibre26">$ date ; who
Mon Feb 21 15:36:09 EST 2014
Christine tty2         2014-02-21 15:26
Samantha tty3         2014-02-21 15:26
Timothy  tty1         2014-02-21 15:26
user     tty7         2014-02-19 14:03 (:0)
user     pts/0        2014-02-21 15:21 (:0.0)
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="270" id="calibre_link-608" class="calibre11"></span>Congratulations, you just wrote a shell script! This simple script uses just two <code class="calibre26">bash</code> shell commands. The <code class="calibre26">date</code> command runs first, displaying the current date and time, followed by the output of the <code class="calibre26">who</code> command, showing who is currently logged on to the system. Using this technique, you can string together as many commands as you wish, up to the maximum command line character count of 255 characters.</p>
<p class="calibre10">Using this technique is fine for small scripts, but it has a major drawback: You must enter the entire command at the command prompt every time you want to run it. Instead of having to manually enter the commands onto a command line, you can combine the commands into a simple text file. When you need to run the commands, just simply run the text file.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-193" class="calibre4"></a>Creating a Script File</h2>
<p class="calibre10">To place shell commands in a text file, first you need to use a text editor (see Chapter 10) to create a file and then enter the commands into the file.</p>
<p class="calibre10">When creating a shell script file, you must specify the shell you are using in the first line of the file. Here's the format for this:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash</code></pre>
<p class="calibre10">In a normal shell script line, the pound sign (#) is used as a comment line. A comment line in a shell script isn't processed by the shell. However, the first line of a shell script file is a special case, and the pound sign followed by the exclamation point tells the shell what shell to run the script under (yes, you can be using a bash shell and run your script using another shell).</p>
<p class="calibre10">After indicating the shell, commands are entered onto each line of the file, followed by a carriage return. As mentioned, comments can be added by using the pound sign. An example looks like this:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
# This script displays the date and who's logged on
date
who</code></pre>
<p class="calibre10">And that's all there is to it. You can use the semicolon and put both commands on the same line if you want to, but in a shell script, you can list commands on separate lines. The shell processes commands in the order in which they appear in the file.</p>
<p class="calibre10">Also notice that another line was included that starts with the pound symbol and adds a comment. Lines that start with the pound symbol (other than the first <code class="calibre26">#!</code> line) aren't interpreted <span type="pagebreak" title="271" id="calibre_link-609" class="calibre11"></span>by the shell. This is a great way to leave comments for yourself about what's happening in the script, so when you come back to it two years later, you can easily remember what you did.</p>
<p class="calibre10">Save this script in a file called <code class="calibre26">test1</code>, and you are almost ready. You need to do a couple of things before you can run your new shell script file.</p>
<p class="calibre10">If you try running the file now, you'll be somewhat disappointed to see this:</p>
<pre class="calibre29"><code class="calibre26">$ test1
bash: test1: command not found
$</code></pre>
<p class="calibre10">The first hurdle to jump is getting the bash shell to find your script file. If you remember from Chapter 6, the shell uses an environment variable called <code class="calibre26">PATH</code> to find commands. A quick look at the <code class="calibre26">PATH</code> environment variable demonstrates our problem:</p>
<pre class="calibre29"><code class="calibre26">$ echo $PATH
/usr/kerberos/sbin:/usr/kerberos/bin:/usr/local/bin:/usr/bin
:/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/user/bin $</code></pre>
<p class="calibre10">The <code class="calibre26">PATH</code> environment variable is set to look for commands only in a handful of directories. To get the shell to find the <code class="calibre26">test1</code> script, we need to do one of two things:</p>
<ul class="calibre14">
<li class="calibre7">Add the directory where our shell script file is located to the <code class="calibre26">PATH</code> environment variable.</li>
<li class="calibre7">Use an absolute or relative file path to reference our shell script file in the prompt.</li>
</ul>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Some Linux distributions add the <code class="calibre26">$HOME/bin</code> directory to the <code class="calibre26">PATH</code> environment variable. This creates a place in every user's <code class="calibre26">HOME</code> directory to place files where the shell can find them to execute.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">For this example, we use the second method to tell the shell exactly where the script file is located. Remember that to reference a file in the current directory, you can use the single dot operator in the shell:</p>
<pre class="calibre29"><code class="calibre26">$ ./test1
bash: ./test1: Permission denied
$</code></pre>
<p class="calibre10">The shell found the shell script file just fine, but there's another problem. The shell indicated that you don't have permission to execute the file. A quick look at the file permissions should show what's going on here:</p>
<pre class="calibre29"><code class="calibre26">$ ls -l test1
-rw-rw-r--    1 user     user           73 Sep 24 19:56 test1
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="272" id="calibre_link-610" class="calibre11"></span>When the new <code class="calibre26">test1</code> file was created, the <code class="calibre26">umask</code> value determined the default permission settings for the new file. Because the <code class="calibre26">umask</code> variable is set to 002 (see Chapter 7) in Ubuntu, the system created the file with only read/write permissions for the file's owner and group.</p>
<p class="calibre10">The next step is to give the file owner permission to execute the file, using the <code class="calibre26">chmod</code> command (see Chapter 7):</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test1
$ ./test1
Mon Feb 21 15:38:19 EST 2014
Christine tty2         2014-02-21 15:26
Samantha tty3         2014-02-21 15:26
Timothy  tty1         2014-02-21 15:26
user     tty7         2014-02-19 14:03 (:0)
user     pts/0        2014-02-21 15:21 (:0.0) $</code></pre>
<p class="calibre10">Success! Now all the pieces are in the right places to execute the new shell script file.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-194" class="calibre4"></a>Displaying Messages</h2>
<p class="calibre10">Most shell commands produce their own output, which is displayed on the console monitor where the script is running. Many times, however, you will want to add your own text messages to help the script user know what is happening within the script. You can do this with the <code class="calibre26">echo</code> command. The <code class="calibre26">echo</code> command can display a simple text string if you add the string following the command:</p>
<pre class="calibre29"><code class="calibre26">$ echo This is a test
This is a test
$</code></pre>
<p class="calibre10">Notice that by default you don't need to use quotes to delineate the string you're displaying. However, sometimes this can get tricky if you are using quotes within your string:</p>
<pre class="calibre29"><code class="calibre26">$ echo Let's see if this'll work
Lets see if thisll work
$</code></pre>
<p class="calibre10">The <code class="calibre26">echo</code> command uses either double or single quotes to delineate text strings. If you use them within your string, you need to use one type of quote within the text and the other type to delineate the string:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is a test to see if you're paying attention"
This is a test to see if you're paying attention
$ echo 'Rich says "scripting is easy".'
Rich says "scripting is easy".
$</code></pre>
<p class="calibre10">Now all the quotation marks appear properly in the output.</p>
<p class="calibre10"><span type="pagebreak" title="273" id="calibre_link-611" class="calibre11"></span>You can add <code class="calibre26">echo</code> statements anywhere in your shell scripts where you need to display additional information:</p>
<pre class="calibre29"><code class="calibre26">$ cat test1
#!/bin/bash
# This script displays the date and who's logged on
echo  The time and date are:
date
echo "Let's see who's logged into the system:"
who
$</code></pre>
<p class="calibre10">When you run this script, it produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ ./test1
The time and date are:
Mon Feb 21 15:41:13 EST 2014
Let's see who's logged into the system:
Christine tty2         2014-02-21 15:26
Samantha tty3         2014-02-21 15:26
Timothy  tty1         2014-02-21 15:26
user     tty7         2014-02-19 14:03 (:0)
user     pts/0        2014-02-21 15:21 (:0.0)
$</code></pre>
<p class="calibre10">That's nice, but what if you want to <code class="calibre26">echo</code> a text string on the same line as a command output? You can use the <code class="calibre26">-n</code> parameter for the <code class="calibre26">echo</code> statement to do that. Just change the first <code class="calibre26">echo</code> statement line to this:</p>
<pre class="calibre29"><code class="calibre26">echo -n "The time and date are: "</code></pre>
<p class="calibre10">You need to use quotes around the string to ensure that there's a space at the end of the echoed string. The command output begins exactly where the string output stops. The output now looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ ./test1
The time and date are: Mon Feb 21 15:42:23 EST 2014
Let's see who's logged into the system:
Christine tty2         2014-02-21 15:26
Samantha tty3         2014-02-21 15:26
Timothy  tty1         2014-02-21 15:26
user     tty7         2014-02-19 14:03 (:0)
user     pts/0        2014-02-21 15:21 (:0.0)
$</code></pre>
<p class="calibre10">Perfect! The <code class="calibre26">echo</code> command is a crucial piece of shell scripts that interact with users. You'll find yourself using it in many situations, especially when you want to display the values of script variables. Let's look at that next.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-195" class="calibre4"></a>Using Variables</h2>
<p class="calibre10"><span type="pagebreak" title="274" id="calibre_link-612" class="calibre11"></span>Just running individual commands from the shell script is useful, but this has its limitations. Often, you'll want to incorporate other data in your shell commands to process information. You can do this by using <i class="calibre12">variables</i>. Variables allow you to temporarily store information within the shell script for use with other commands in the script. This section shows how to use variables in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Environment variables</h3>
<p class="calibre10">You've already seen one type of Linux variable in action. Chapter 6 described the environment variables available in the Linux system. You can access these values from your shell scripts as well.</p>
<p class="calibre10">The shell maintains environment variables that track specific system information, such as the name of the system, the name of the user logged in to the system, the user's system ID (called UID), the default home directory of the user, and the search path used by the shell to find programs. You can display a complete list of active environment variables available by using the <code class="calibre26">set</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ set
BASH=/bin/bash
[...]
HOME=/home/Samantha
HOSTNAME=localhost.localdomain
HOSTTYPE=i386
IFS=$' \t\n'
IMSETTINGS_INTEGRATE_DESKTOP=yes
IMSETTINGS_MODULE=none
LANG=en_US.utf8
LESSOPEN='|/usr/bin/lesspipe.sh %s'
LINES=24
LOGNAME=Samantha
[...]</code></pre>
<p class="calibre10">You can tap into these environment variables from within your scripts by using the environment variable's name preceded by a dollar sign. This is demonstrated in the following script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test2
#!/bin/bash
# display user information from the system.
echo "User info for userid: $USER"
echo UID: $UID
echo HOME: $HOME
$</code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">$USER</i></code>, <code class="calibre26"><i class="calibre12">$UID</i></code>, and <code class="calibre26"><i class="calibre12">$HOME</i></code> environment <span type="pagebreak" title="275" id="calibre_link-613" class="calibre11"></span>variables are used to display the pertinent information about the logged-in user. The output should look something like this:</p>
<pre class="calibre29"><code class="calibre26">$chmod u+x test2
$ ./test2
User info for userid: Samantha
UID: 1001
HOME: /home/Samantha
$</code></pre>
<p class="calibre10">Notice that the environment variables in the <code class="calibre26">echo</code> commands are replaced by their current values when the script runs. Also notice that we were able to place the <code class="calibre26"><i class="calibre12">$USER</i></code> system variable within the double quotation marks in the first string, and the shell script still figured out what we meant. There is a drawback to using this method, however. Look at what happens in this example:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The cost of the item is $15"
The cost of the item is 5</code></pre>
<p class="calibre10">That is obviously not what was intended. Whenever the script sees a dollar sign within quotes, it assumes you're referencing a variable. In this example, the script attempted to display the variable <code class="calibre26"><i class="calibre12">$1</i></code> (which was not defined) and then the number <code class="calibre26">5</code>. To display an actual dollar sign, you must precede it with a backslash character:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The cost of the item is \$15"
The cost of the item is $15</code></pre>
<p class="calibre10">That's better. The backslash allowed the shell script to interpret the dollar sign as an actual dollar sign and not a variable. The next section shows how to create your own variables in your scripts.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You may also see variables referenced using the format ${variable}. The extra braces around the variable name are often used to help identify the variable name from the dollar sign.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">User variables</h3>
<p class="calibre10">In addition to the environment variables, a shell script allows you to set and use your own variables within the script. Setting variables allows you to temporarily store data and use it throughout the script, making the shell script more like a real computer program.</p>
<p class="calibre10">User variables can be any text string of up to 20 letters, digits, or an underscore character. User variables are case sensitive, so the variable <code class="calibre26"><i class="calibre12">Var1</i></code> is different from the variable <code class="calibre26"><i class="calibre12">var1</i></code>. This little rule often gets novice script programmers in trouble.</p>
<p class="calibre10"><span type="pagebreak" title="276" id="calibre_link-614" class="calibre11"></span>Values are assigned to user variables using an equal sign. No spaces can appear between the variable, the equal sign, and the value (another trouble spot for novices). Here are a few examples of assigning values to user variables:</p>
<pre class="calibre29"><code class="calibre26">var1=10
var2=-57
var3=testing
var4="still more testing"</code></pre>
<p class="calibre10">The shell script automatically determines the data type used for the variable value. Variables defined within the shell script maintain their values throughout the life of the shell script but are deleted when the shell script completes.</p>
<p class="calibre10">Just like system variables, user variables can be referenced using the dollar sign:</p>
<pre class="calibre29"><code class="calibre26">$ cat test3
#!/bin/bash
# testing variables
days=10
guest="Katie"
echo "$guest checked in $days days ago"
days=5
guest="Jessica"
echo "$guest checked in $days days ago"
$</code></pre>
<p class="calibre10">Running the script produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test3
$ ./test3
Katie checked in 10 days ago
Jessica checked in 5 days ago
$</code></pre>
<p class="calibre10">Each time the variable is referenced, it produces the value currently assigned to it. It's important to remember that when referencing a variable value you use the dollar sign, but when referencing the variable to assign a value to it, you do not use the dollar sign. Here's an example of what I mean:</p>
<pre class="calibre29"><code class="calibre26">$ cat test4
#!/bin/bash
# assigning a variable value to another variable
value1=10
value2=$value1
echo The resulting value is $value2
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="277" id="calibre_link-615" class="calibre11"></span>When you use the value of the <code class="calibre26"><i class="calibre12">value1</i></code> variable in the assignment statement, you must still use the dollar sign. This code produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test4
$ ./test4
The resulting value is 10
$</code></pre>
<p class="calibre10">If you forget the dollar sign and make the <code class="calibre26"><i class="calibre12">value2</i></code> assignment line look like this:</p>
<pre class="calibre29"><code class="calibre26">value2=value1</code></pre>
<p class="calibre10">you get the following output:</p>
<pre class="calibre29"><code class="calibre26">$ ./test4
The resulting value is value1
$</code></pre>
<p class="calibre10">Without the dollar sign, the shell interprets the variable name as a normal text string, which is most likely not what you wanted.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Command substitution</h3>
<p class="calibre10">One of the most useful features of shell scripts is the ability to extract information from the output of a command and assign it to a variable. After you assign the output to a variable, you can use that value anywhere in your script. This comes in handy when processing data in your scripts.</p>
<p class="calibre10">There are two ways to assign the output of a command to a variable:</p>
<ul class="calibre14">
<li class="calibre7">The backtick character (`)</li>
<li class="calibre7">The $() format</li>
</ul>
<p class="calibre10">Be careful with the backtick character; it is not the normal single quotation mark character you are used to using for strings. Because it is not used very often outside of shell scripts, you may not even know where to find it on your keyboard. You should become familiar with it because it's a crucial component of many shell scripts. Hint: On a U.S. keyboard, it is usually on the same key as the tilde symbol (â¼).</p>
<p class="calibre10">Command substitution allows you to assign the output of a shell command to a variable. Although this doesn't seem like much, it is a major building block in script programming.</p>
<p class="calibre10">You must either surround the entire command line command with two backtick characters:</p>
<pre class="calibre29"><code class="calibre26">testing='date'</code></pre>
<p class="calibre10">or use the $() format:</p>
<pre class="calibre29"><code class="calibre26">testing=$(date)</code></pre>
<p class="calibre10"><span type="pagebreak" title="278" id="calibre_link-616" class="calibre11"></span>The shell runs the command within the command substitution characters and assigns the output to the variable <code class="calibre26">testing</code>. Notice that there are no spaces between the assignment equal sign and the command substitution character. Here's an example of creating a variable using the output from a normal shell command:</p>
<pre class="calibre29"><code class="calibre26">$ cat test5
#!/bin/bash
testing=$(date)
echo "The date and time are: " $testing
$</code></pre>
<p class="calibre10">The variable testing receives the output from the <code class="calibre26">date</code> command, and it is used in the <code class="calibre26">echo</code> statement to display it. Running the shell script produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test5
$ ./test5
The date and time are:  Mon Jan 31 20:23:25 EDT 2014
$</code></pre>
<p class="calibre10">That's not all that exciting in this example (you could just as easily just put the command in the <code class="calibre26">echo</code> statement), but after you capture the command output in a variable, you can do anything with it.</p>
<p class="calibre10">Here's a popular example of how command substitution is used to capture the current date and use it to create a unique filename in a script:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
# copy the /usr/bin directory listing to a log file
today=$(date +%y%m%d)
ls /usr/bin -al &gt; log.$today</code></pre>
<p class="calibre10">The <code class="calibre26">today</code> variable is assigned the output of a formatted date command. This is a common technique used to extract date information for log filenames. The <code class="calibre26">+%y%m%d</code> format instructs the date command to display the date as a two-digit year, month, and day:</p>
<pre class="calibre29"><code class="calibre26">$ date +%y%m%d
140131
$</code></pre>
<p class="calibre10">The script assigns the value to a variable, which is then used as part of a filename. The file itself contains the redirected output (discussed in the âRedirecting Input and Outputâ section) of a directory listing. After running the script, you should see a new file in your directory:</p>
<pre class="calibre29"><code class="calibre26">-rw-r--r--    1 user     user          769 Jan 31 10:15 log.140131</code></pre>
<p class="calibre10">The log file appears in the directory using the value of the <code class="calibre26"><i class="calibre12">$today</i></code> variable as part of the filename. The contents of the log file are the directory listing from the <code class="calibre26">/usr/bin</code> directory. If the script runs the next day, the log filename is <code class="calibre26">log.140201</code>, thus creating a new file for the new day.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Command substitution creates what's called a <code class="calibre26">subshell</code> to run the enclosed command. A subshell is a separate child shell generated from the shell that's running the script. Because of that, any variables you create in the script aren't available to the subshell command.</p>
<p class="calibre19">Subshells are also created if you run a command from the command prompt using the ./ path, but they aren't created if you just run the command without a path. However, if you use a built-in shell command, that doesn't generate a subshell. Be careful when running scripts from the command prompt!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-196" class="calibre4"></a>Redirecting Input and Output</h2>
<p class="calibre10"><span type="pagebreak" title="279" id="calibre_link-617" class="calibre11"></span>Sometimes, you want to save the output from a command instead of just having it displayed on the monitor. The bash shell provides a few different operators that allow you to <code class="calibre26"><i class="calibre12">redirect</i></code> the output of a command to an alternative location (such as a file). Redirection can be used for input as well as output, redirecting a file to a command for input. This section describes what you need to do to use redirection in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Output redirection</h3>
<p class="calibre10">The most basic type of redirection is sending output from a command to a file. The bash shell uses the greater-than symbol (<code class="calibre26">&gt;</code>) for this:</p>
<pre class="calibre29"><code class="calibre26">command &gt; outputfile</code></pre>
<p class="calibre10">Anything that would appear on the monitor from the command instead is stored in the output file specified:</p>
<pre class="calibre29"><code class="calibre26">$ date &gt; test6
$ ls -l test6
-rw-r--r--    1 user     user           29 Feb 10 17:56 test6
$ cat test6
Thu Feb 10 17:56:58 EDT 2014
$</code></pre>
<p class="calibre10">The redirect operator created the file <code class="calibre26">test6</code> (using the default <code class="calibre26">umask</code> settings) and redirected the output from the date command to the <code class="calibre26">test6</code> file. If the output file already exists, the redirect operator overwrites the existing file with the new file data:</p>
<pre class="calibre29"><code class="calibre26">$ who &gt; test6
$ cat test6
user     pts/0    Feb 10 17:55
$</code></pre>
<p class="calibre10">Now the contents of the <code class="calibre26">test6</code> file contain the output from the <code class="calibre26">who</code> command.</p>
<p class="calibre10"><span type="pagebreak" title="280" id="calibre_link-618" class="calibre11"></span>Sometimes, instead of overwriting the file's contents, you may need to append output from a command to an existing file &mdash; for example, if you're creating a log file to document an action on the system. In this situation, you can use the double greater-than symbol (<code class="calibre26">&gt;&gt;</code>) to append data:</p>
<pre class="calibre29"><code class="calibre26">$ date &gt;&gt; test6
$ cat test6
user     pts/0    Feb 10 17:55
Thu Feb 10 18:02:14 EDT 2014
$</code></pre>
<p class="calibre10">The <code class="calibre26">test6</code> file still contains the original data from the <code class="calibre26">who</code> command processed earlier &mdash; and now it contains the new output from the <code class="calibre26">date</code> command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Input redirection</h3>
<p class="calibre10">Input redirection is the opposite of output redirection. Instead of taking the output of a command and redirecting it to a file, input redirection takes the content of a file and redirects it to a command.</p>
<p class="calibre10">The input redirection symbol is the less-than symbol (<code class="calibre26">&lt;</code>):</p>
<pre class="calibre29"><code class="calibre26">command &lt; inputfile</code></pre>
<p class="calibre10">The easy way to remember this is that the command is always listed first in the command line, and the redirection symbol âpointsâ to the way the data is flowing. The less-than symbol indicates that the data is flowing from the input file to the command.</p>
<p class="calibre10">Here's an example of using input redirection with the <code class="calibre26">wc</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ wc &lt; test6
      2      11      60
$</code></pre>
<p class="calibre10">The <code class="calibre26">wc</code> command provides a count of text in the data. By default, it produces three values:</p>
<ul class="calibre14">
<li class="calibre7">The number of lines in the text</li>
<li class="calibre7">The number of words in the text</li>
<li class="calibre7">The number of bytes in the text</li>
</ul>
<p class="calibre10">By redirecting a text file to the <code class="calibre26">wc</code> command, you can get a quick count of the lines, words, and bytes in the file. The example shows that there are 2 lines, 11 words, and 60 bytes in the <code class="calibre26">test6</code> file.</p>
<p class="calibre10">Another method of input redirection is called <i class="calibre12">inline input redirection</i>. This method allows you to specify the data for input redirection on the command line instead of in a file. This may seem somewhat odd at first, but a few applications are available for this process (such as those shown in the âPerforming Mathâ section).</p>
<p class="calibre10"><span type="pagebreak" title="281" id="calibre_link-619" class="calibre11"></span>The inline input redirection symbol is the double less-than symbol (<code class="calibre26">&lt;&lt;</code>). Besides this symbol, you must specify a text marker that delineates the beginning and end of the data used for input. You can use any string value for the text marker, but it must be the same at the beginning of the data and the end of the data:</p>
<pre class="calibre29"><code class="calibre26">command &lt;&lt; marker
data
marker</code></pre>
<p class="calibre10">When using inline input redirection on the command line, the shell prompts for data using the secondary prompt, defined in the <code class="calibre26"><i class="calibre12">PS2</i></code> environment variable (see Chapter 6). Here's how this looks when you use it:</p>
<pre class="calibre29"><code class="calibre26">$ wc &lt;&lt; EOF
&gt; test string 1
&gt; test string 2
&gt; test string 3
&gt; EOF
      3       9      42
$</code></pre>
<p class="calibre10">The secondary prompt continues to prompt for more data until you enter the string value for the text marker. The <code class="calibre26">wc</code> command performs the line, word, and byte counts of the data supplied by the inline input redirection.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-197" class="calibre4"></a>Pipes</h2>
<p class="calibre10">Sometimes, you need to send the output of one command to the input of another command. This is possible using redirection, but somewhat clunky:</p>
<pre class="calibre29"><code class="calibre26">$ rpm -qa &gt; rpm.list
$ sort &lt; rpm.list
abrt-1.1.14-1.fc14.i686
abrt-addon-ccpp-1.1.14-1.fc14.i686
abrt-addon-kerneloops-1.1.14-1.fc14.i686
abrt-addon-python-1.1.14-1.fc14.i686
abrt-desktop-1.1.14-1.fc14.i686
abrt-gui-1.1.14-1.fc14.i686
abrt-libs-1.1.14-1.fc14.i686
abrt-plugin-bugzilla-1.1.14-1.fc14.i686
abrt-plugin-logger-1.1.14-1.fc14.i686
abrt-plugin-runapp-1.1.14-1.fc14.i686
acl-2.2.49-8.fc14.i686
[...]</code></pre>
<p class="calibre10">The <code class="calibre26">rpm</code> command <span type="pagebreak" title="282" id="calibre_link-620" class="calibre11"></span>manages the software packages installed on systems using the Red Hat Package Management system (RPM), such as the Fedora system as shown. When used with the <code class="calibre26">-qa</code> parameters, it produces a list of the existing packages installed, but not necessarily in any specific order. If you're looking for a specific package or group of packages, it can be difficult to find it using the output of the <code class="calibre26">rpm</code> command.</p>
<p class="calibre10">Using the standard output redirection, the output was redirected from the <code class="calibre26">rpm</code> command to a file, called <code class="calibre26">rpm.list</code>. After the command finished, the <code class="calibre26">rpm.list</code> file contained a list of all the installed software packages on my system. Next, input redirection was used to send the contents of the <code class="calibre26">rpm.list</code> file to the <code class="calibre26">sort</code> command to sort the package names alphabetically.</p>
<p class="calibre10">That was useful, but again, a somewhat clunky way of producing the information. Instead of redirecting the output of a command to a file, you can redirect the output to another command. This process is called <i class="calibre12">piping</i>.</p>
<p class="calibre10">Like the command substitution backtick, the symbol for piping is not used often outside of shell scripting. The symbol is two vertical lines, one above the other. However, the <code class="calibre26">pipe</code> symbol often looks like a single vertical line in print (<code class="calibre26">|</code>). On a U.S. keyboard, it is usually on the same key as the backslash (<code class="calibre26">â</code>). The <code class="calibre26">pipe</code> is put between the commands to redirect the output from one to the other:</p>
<pre class="calibre29"><code class="calibre26">command1 | command2</code></pre>
<p class="calibre10">Don't think of piping as running two commands back to back. The Linux system actually runs both commands at the same time, linking them together internally in the system. As the first command produces output, it's sent immediately to the second command. No intermediate files or buffer areas are used to transfer the data.</p>
<p class="calibre10">Now, using piping you can easily <code class="calibre26">pipe</code> the output of the <code class="calibre26">rpm</code> command directly to the <code class="calibre26">sort</code> command to produce your results:</p>
<pre class="calibre29"><code class="calibre26">$ rpm -qa | sort
abrt-1.1.14-1.fc14.i686
abrt-addon-ccpp-1.1.14-1.fc14.i686
abrt-addon-kerneloops-1.1.14-1.fc14.i686
abrt-addon-python-1.1.14-1.fc14.i686
abrt-desktop-1.1.14-1.fc14.i686
abrt-gui-1.1.14-1.fc14.i686
abrt-libs-1.1.14-1.fc14.i686
abrt-plugin-bugzilla-1.1.14-1.fc14.i686
abrt-plugin-logger-1.1.14-1.fc14.i686
abrt-plugin-runapp-1.1.14-1.fc14.i686
acl-2.2.49-8.fc14.i686
[...]</code></pre>
<p class="calibre10"><span type="pagebreak" title="283" id="calibre_link-621" class="calibre11"></span>Unless you're a (very) quick reader, you probably couldn't keep up with the output generated by this command. Because the piping feature operates in real time, as soon as the <code class="calibre26">rpm</code> command produces data, the <code class="calibre26">sort</code> command gets busy sorting it. By the time the <code class="calibre26">rpm</code> command finishes outputting data, the <code class="calibre26">sort</code> command already has the data sorted and starts displaying it on the monitor.</p>
<p class="calibre10">There's no limit to the number of <code class="calibre26">pipe</code>s you can use in a command. You can continue piping the output of commands to other commands to refine your operation.</p>
<p class="calibre10">In this case, because the output of the <code class="calibre26">sort</code> command zooms by so quickly, you can use one of the text paging commands (such as <code class="calibre26">less</code> or <code class="calibre26">more</code>) to force the output to stop at every screen of data:</p>
<pre class="calibre29"><code class="calibre26">$ rpm -qa | sort | more</code></pre>
<p class="calibre10">This command sequence runs the <code class="calibre26">rpm</code> command, <code class="calibre26">pipe</code>s the output to the <code class="calibre26">sort</code> command, and then <code class="calibre26">pipe</code>s that output to the <code class="calibre26">more</code> command to display the data, stopping after every screen of information. This now lets you pause and read what's on the display before continuing, as shown in <a id="calibre_link-1282" href="#calibre_link-1093" class="calibre4">Figure 11.1</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000002.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1093" href="#calibre_link-1282" class="calibre4"><b class="calibre21">Figure 11.1</b></a></span> Using piping to send data to the more command</p>
</figcaption>
</figure>
<p class="calibre10">To get even fancier, you can use redirection along with piping to save your output to a file:</p>
<pre class="calibre29"><code class="calibre26">$ rpm -qa | sort &gt; rpm.list
$ more rpm.list
abrt-1.1.14-1.fc14.i686
abrt-addon-ccpp-1.1.14-1.fc14.i686
abrt-addon-kerneloops-1.1.14-1.fc14.i686
abrt-addon-python-1.1.14-1.fc14.i686
abrt-desktop-1.1.14-1.fc14.i686
abrt-gui-1.1.14-1.fc14.i686
abrt-libs-1.1.14-1.fc14.i686
abrt-plugin-bugzilla-1.1.14-1.fc14.i686
abrt-plugin-logger-1.1.14-1.fc14.i686
abrt-plugin-runapp-1.1.14-1.fc14.i686
acl-2.2.49-8.fc14.i686
[...]</code></pre>
<p class="calibre10">As expected, the data in the <code class="calibre26">rpm.list</code> file is now sorted!</p>
<p class="calibre10"><span type="pagebreak" title="284" id="calibre_link-622" class="calibre11"></span>By far one of the most popular uses of piping is piping the results of commands that produce long output to the <code class="calibre26">more</code> command. This is especially common with the <code class="calibre26">ls</code> command, as shown in <a id="calibre_link-1283" href="#calibre_link-1094" class="calibre4">Figure 11.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000005.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1094" href="#calibre_link-1283" class="calibre4"><b class="calibre21">Figure 11.2</b></a></span> Using the more command with the ls command</p>
</figcaption>
</figure>
<p class="calibre10">The <code class="calibre26">ls -l</code> command produces a long listing of all the files in the directory. For directories with lots of files, this can be quite a listing. By piping the output to the <code class="calibre26">more</code> command, you force the output to stop at the end of every screen of data.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-198" class="calibre4"></a>Performing Math</h2>
<p class="calibre10"><span type="pagebreak" title="285" id="calibre_link-623" class="calibre11"></span>Another feature crucial to any programming language is the ability to manipulate numbers. Unfortunately, for shell scripts this process is a bit awkward. There are two different ways to perform mathematical operations in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">The expr command</h3>
<p class="calibre10">Originally, the Bourne shell provided a special command that was used for processing mathematical equations. The <code class="calibre26">expr</code> command allowed the processing of equations from the command line, but it is extremely clunky:</p>
<pre class="calibre29"><code class="calibre26">$ expr 1 + 5
6</code></pre>
<p class="calibre10">The <code class="calibre26">expr</code> command recognizes a few different mathematical and string operators, shown in <a id="calibre_link-1284" href="#calibre_link-1143" class="calibre4">Table 11.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1143" href="#calibre_link-1284" class="calibre4"><b class="calibre21">Table 11.1</b></a></span> The expr Command Operators</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Operator</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 | ARG2</code></td>
<td class="left">Returns <code class="calibre26">ARG1</code> if neither argument is null or zero; otherwise, returns <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 &amp; ARG2</code></td>
<td class="left">Returns <code class="calibre26">ARG1</code> if neither argument is null or zero; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 &lt; ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is less than <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 &lt;= ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is less than or equal to <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 = ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is equal to <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 != ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is not equal to <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 &gt;= ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is greater than or equal to <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 &gt; ARG2</code></td>
<td class="left">Returns 1 if <code class="calibre26">ARG1</code> is greater than <code class="calibre26">ARG2</code>; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 + ARG2</code></td>
<td class="left">Returns the arithmetic sum of <code class="calibre26">ARG1</code> and <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 - ARG2</code></td>
<td class="left">Returns the arithmetic difference of <code class="calibre26">ARG1</code> and <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 * ARG2</code></td>
<td class="left">Returns the arithmetic product of <code class="calibre26">ARG1</code> and <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 / ARG2</code></td>
<td class="left">Returns the arithmetic quotient of <code class="calibre26">ARG1</code> divided by <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARG1 % ARG2</code></td>
<td class="left">Returns the arithmetic remainder of <code class="calibre26">ARG1</code> divided by <code class="calibre26">ARG2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">STRING : REGEXP</code></td>
<td class="left">Returns the pattern match if <code class="calibre26">REGEXP</code> matches a pattern in <code class="calibre26">STRING</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">match STRING REGEXP</code></td>
<td class="left">Returns the pattern match if <code class="calibre26">REGEXP</code> matches a pattern in <code class="calibre26">STRING</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">substr STRING POS LENGTH</code></td>
<td class="left">Returns the substring <code class="calibre26">LENGTH</code> characters in length, starting at position <code class="calibre26">POS</code> (starting at 1)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">index STRING CHARS</code></td>
<td class="left">Returns position in <code class="calibre26">STRING</code> where <code class="calibre26">CHARS</code> is found; otherwise, returns 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">length STRING</code></td>
<td class="left">Returns the numeric length of the string <code class="calibre26">STRING</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">+ TOKEN</code></td>
<td class="left">Interprets <code class="calibre26">TOKEN</code> as a string, even if it's a keyword</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">(EXPRESSION)</code></td>
<td class="left">Returns the value of <code class="calibre26">EXPRESSION</code></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="286" id="calibre_link-624" class="calibre11"></span>Although the standard operators work fine in the <code class="calibre26">expr</code> command, the problem occurs when using them from a script or the command line. Many of the <code class="calibre26">expr</code> command operators have other meanings in the shell (such as the asterisk). Using them in the <code class="calibre26">expr</code> command produces odd results:</p>
<pre class="calibre29"><code class="calibre26">$ expr 5 * 2
expr: syntax error
$</code></pre>
<p class="calibre10">To solve this problem, you need to use the shell escape character (the backslash) to identify any characters that may be misinterpreted by the shell before being passed to the <code class="calibre26">expr</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ expr 5 \* 2
10
$</code></pre>
<p class="calibre10">Now that's really starting to get ugly! Using the <code class="calibre26">expr</code> command in a shell script is equally cumbersome:</p>
<pre class="calibre29"><code class="calibre26">$ cat test6
#!/bin/bash
# An example of using the expr command
var1=10
var2=20
var3=$(expr $var2 / $var1)
echo The result is $var3</code></pre>
<p class="calibre10">To assign the result of a mathematical equation to a variable, you have to use command substitution to extract the output from the <code class="calibre26">expr</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test6
$ ./test6
The result is 2
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="287" id="calibre_link-625" class="calibre11"></span>Fortunately, the bash shell has an improvement for processing mathematical operators as you shall see in the next section.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using brackets</h3>
<p class="calibre10">The bash shell includes the <code class="calibre26">expr</code> command to stay compatible with the Bourne shell; however, it also provides a much easier way of performing mathematical equations. In bash, when assigning a mathematical value to a variable, you can enclose the mathematical equation using a dollar sign and square brackets (<code class="calibre26">$[ operation ]</code>):</p>
<pre class="calibre29"><code class="calibre26">$ var1=$[1 + 5]
$ echo $var1
6
$ var2=$[$var1 * 2]
$ echo $var2
12
$</code></pre>
<p class="calibre10">Using brackets makes shell math much easier than with the <code class="calibre26">expr</code> command. This same technique also works in shell scripts:</p>
<pre class="calibre29"><code class="calibre26">$ cat test7
#!/bin/bash
var1=100
var2=50
var3=45
var4=$[$var1 * ($var2 - $var3)]
echo The final result is $var4
$</code></pre>
<p class="calibre10">Running this script produces the output:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test7
$ ./test7
The final result is 500
$</code></pre>
<p class="calibre10">Also, notice that when using the square brackets method for calculating equations, you don't need to worry about the multiplication symbol, or any other characters, being misinterpreted by the shell. The shell knows that it's not a wildcard character because it is within the square brackets.</p>
<p class="calibre10">There's one major limitation to performing math in the bash shell script. Look at this example:</p>
<pre class="calibre29"><code class="calibre26">$ cat test8
#!/bin/bash
var1=100
var2=45
var3=$[$var1 / $var2]
echo The final result is $var3
$</code></pre>
<p class="calibre10">Now run it and see what happens:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test8
$ ./test8
The final result is 2
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="288" id="calibre_link-626" class="calibre11"></span>The bash shell mathematical operators support only integer arithmetic. This is a huge limitation if you're trying to do any sort of real-world mathematical calculations.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The z shell (zsh) provides full floating-point arithmetic operations. If you require floating-point calculations in your shell scripts, you might consider checking out the z shell (discussed in Chapter 23).</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">A floating-point solution</h3>
<p class="calibre10">You can use several solutions for overcoming the bash integer limitation. The most popular solution uses the built-in bash calculator, called <code class="calibre26">bc</code>.</p>
<section class="toclist">
<h4 class="calibre25">The basics of bc</h4>
<p class="calibre10">The bash calculator is actually a programming language that allows you to enter floating-point expressions at a command line and then interprets the expressions, calculates them, and returns the result. The bash calculator recognizes these:</p>
<ul class="calibre14">
<li class="calibre7">Numbers (both integer and floating point)</li>
<li class="calibre7">Variables (both simple variables and arrays)</li>
<li class="calibre7">Comments (lines starting with a pound sign or the C language /* */ pair)</li>
<li class="calibre7">Expressions</li>
<li class="calibre7">Programming statements (such as <code class="calibre26">if-then</code> statements)</li>
<li class="calibre7">Functions</li>
</ul>
<p class="calibre10">You can access the bash calculator from the shell prompt using the <code class="calibre26">bc</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ bc
bc 1.06.95
Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006 Free Software Foundation, Inc.
This is free software with ABSOLUTELY NO WARRANTY.
For details type 'warranty'.
12 * 5.4
64.8
3.156 * (3 + 5)
25.248
quit
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="289" id="calibre_link-627" class="calibre11"></span>The example starts out by entering the expression <code class="calibre26">12 * 5.4</code>. The bash calculator returns the answer. Each subsequent expression entered into the calculator is evaluated, and the result is displayed. To exit the bash calculator, you must enter <code class="calibre26">quit</code>.</p>
<p class="calibre10">The floating-point arithmetic is controlled by a built-in variable called <code class="calibre26"><i class="calibre12">scale</i></code>. You must set this value to the desired number of decimal places you want in your answers, or you won't get what you were looking for:</p>
<pre class="calibre29"><code class="calibre26">$ bc -q
3.44 / 5
0
scale=4
3.44 / 5
.6880
quit
$</code></pre>
<p class="calibre10">The default value for the <code class="calibre26"><i class="calibre12">scale</i></code> variable is zero. Before the <code class="calibre26"><i class="calibre12">scale</i></code> value is set, the bash calculator provides the answer to zero decimal places. After you set the <code class="calibre26"><i class="calibre12">scale</i></code> variable value to four, the bash calculator displays the answer to four decimal places. The <code class="calibre26">-q</code> command line parameter suppresses the lengthy welcome banner from the bash calculator.</p>
<p class="calibre10">In addition to normal numbers, the bash calculator also understands variables:</p>
<pre class="calibre29"><code class="calibre26">$ bc -q
var1=10
var1 * 4
40
var2 = var1 / 5
print var2
2
quit
$</code></pre>
<p class="calibre10">After a variable value is defined, you can use the variable throughout the bash calculator session. The <code class="calibre26">print</code> statement allows you to print variables and numbers.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using bc in scripts</h4>
<p class="calibre10">Now you may be wondering how the bash calculator is going to help you with floating-point arithmetic in your shell scripts. Do you remember command substitution? Yes, you can use the <span type="pagebreak" title="290" id="calibre_link-628" class="calibre11"></span>command substitution character to run a <code class="calibre26">bc</code> command and assign the output to a variable! The basic format to use is this:</p>
<pre class="calibre29"><code class="calibre26">variable=$(echo "options; expression" | bc)</code></pre>
<p class="calibre10">The first portion, <code class="calibre26">options</code>, allows you to set variables. If you need to set more than one variable, separate them using the semicolon. The expression parameter defines the mathematical expression to evaluate using <code class="calibre26">bc</code>. Here's a quick example of doing this in a script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test9
#!/bin/bash
var1=$(echo "scale=4; 3.44 / 5" | bc)
echo The answer is $var1
$</code></pre>
<p class="calibre10">This example sets the scale variable to four decimal places and then specifies a specific calculation for the expression. Running this script produces the following output:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test9
$ ./test9
The answer is .6880
$</code></pre>
<p class="calibre10">Now that's fancy! You aren't limited to just using numbers for the expression value. You can also use variables defined in the shell script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test10
#!/bin/bash
var1=100
var2=45
var3=$(echo "scale=4; $var1 / $var2" | bc)
echo The answer for this is $var3
$</code></pre>
<p class="calibre10">The script defines two variables, which are used within the expression sent to the <code class="calibre26">bc</code> command. Remember to use the dollar sign to signify the value for the variables and not the variables themselves. The output of this script is as follows:</p>
<pre class="calibre29"><code class="calibre26">$ ./test10
The answer for this is 2.2222
$</code></pre>
<p class="calibre10">And of course, after a value is assigned to a variable, that variable can be used in yet another calculation:</p>
<pre class="calibre29"><code class="calibre26">$ cat test11
#!/bin/bash
var1=20
var2=3.14159
var3=$(echo "scale=4; $var1 * $var1" | bc)
var4=$(echo "scale=4; $var3 * $var2" | bc)
echo The final result is $var4
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="291" id="calibre_link-629" class="calibre11"></span>This method works fine for short calculations, but sometimes you need to get more involved with your numbers. If you have more than just a couple of calculations, it gets confusing trying to list multiple expressions on the same command line.</p>
<p class="calibre10">There's a solution to this problem. The <code class="calibre26">bc</code> command recognizes input redirection, allowing you to redirect a file to the <code class="calibre26">bc</code> command for processing. However, this also can get confusing, because you'd need to store your expressions in a file.</p>
<p class="calibre10">The best method is to use inline input redirection, which allows you to redirect data directly from the command line. In the shell script, you assign the output to a variable:</p>
<pre class="calibre29"><code class="calibre26">variable=$(bc &lt;&lt; EOF
options
statements
expressions
EOF
)</code></pre>
<p class="calibre10">The <code class="calibre26">EOF</code> text string indicates the beginning and end of the inline redirection data. Remember that the command substitution characters are still needed to assign the output of the <code class="calibre26">bc</code> command to the variable.</p>
<p class="calibre10">Now you can place all the individual bash calculator elements on separate lines in the script file. Here's an example of using this technique in a script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test12
#!/bin/bash
var1=10.46
var2=43.67
var3=33.2
var4=71
var5=$(bc &lt;&lt; EOF
scale = 4
a1 = ( $var1 * $var2)
b1 = ($var3 * $var4)
a1 + b1
EOF
)
echo The final answer for this mess is $var5
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="292" id="calibre_link-630" class="calibre11"></span>Placing each option and expression on a separate line in your script makes things cleaner and easier to read and follow. The <code class="calibre26">EOF</code> string indicates the start and end of the data to redirect to the <code class="calibre26">bc</code> command. Of course, you must use the command substitution characters to indicate the command to assign to the variable.</p>
<p class="calibre10">You'll also notice in this example that you can assign variables within the bash calculator. It's important to remember that any variables created within the bash calculator are valid only within the bash calculator and can't be used in the shell script.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-199" class="calibre4"></a>Exiting the Script</h2>
<p class="calibre10">So far in our sample scripts, we terminated things pretty abruptly. When we were finished with our last command, we just ended the script. There's a more elegant way of completing things available to us.</p>
<p class="calibre10">Every command that runs in the shell uses an <code class="calibre26"><i class="calibre12">exit status</i></code> to indicate to the shell that it's finished processing. The exit status is an integer value between 0 and 255 that's passed by the command to the shell when the command finishes running. You can capture this value and use it in your scripts.</p>
<section class="toclist">
<h3 class="calibre15">Checking the exit status</h3>
<p class="calibre10">Linux provides the <code class="calibre26">$?</code> special variable that holds the exit status value from the last command that executed. You must view or use the <code class="calibre26">$?</code> variable immediately after the command you want to check. It changes values to the exit status of the last command executed by the shell:</p>
<pre class="calibre29"><code class="calibre26">$ date
Sat Jan 15 10:01:30 EDT 2014
$ echo $?
0
$</code></pre>
<p class="calibre10">By convention, the exit status of a command that successfully completes is zero. If a command completes with an error, then a positive integer value is placed in the exit status:</p>
<pre class="calibre29"><code class="calibre26">$ asdfg
-bash: asdfg: command not found
$ echo $?
127
$</code></pre>
<p class="calibre10">The invalid command returns an exit status of 127. There's not much of a standard convention to Linux error exit status codes. However, you can use the guidelines shown in <a id="calibre_link-1285" href="#calibre_link-1144" class="calibre4">Table 11.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1144" href="#calibre_link-1285" class="calibre4"><b class="calibre21">Table 11.2</b></a></span> Linux Exit Status Codes</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Code</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">0</td>
<td class="left">Successful completion of the command</td>
</tr>
<tr class="calibre28">
<td class="left">1</td>
<td class="left">General unknown error</td>
</tr>
<tr class="calibre28">
<td class="left">2</td>
<td class="left">Misuse of shell command</td>
</tr>
<tr class="calibre28">
<td class="left">126</td>
<td class="left">The command can't execute</td>
</tr>
<tr class="calibre28">
<td class="left">127</td>
<td class="left">Command not found</td>
</tr>
<tr class="calibre28">
<td class="left">128</td>
<td class="left">Invalid exit argument</td>
</tr>
<tr class="calibre28">
<td class="left">128+x</td>
<td class="left">Fatal error with Linux signal x</td>
</tr>
<tr class="calibre28">
<td class="left">130</td>
<td class="left">Command terminated with Ctrl+C</td>
</tr>
<tr class="calibre28">
<td class="left">255</td>
<td class="left">Exit status out of range</td>
</tr>
</table>
</figure>
<p class="calibre10">An exit status value of 126 indicates that the user didn't have the proper permissions set to execute the command:</p>
<pre class="calibre29"><code class="calibre26">$ ./myprog.c
-bash: ./myprog.c: Permission denied
$ echo $?
126
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="293" id="calibre_link-631" class="calibre11"></span>Another common error you'll encounter occurs if you supply an invalid parameter to a command:</p>
<pre class="calibre29"><code class="calibre26">$ date %t
date: invalid date '%t'
$ echo $?
1
$</code></pre>
<p class="calibre10">This generates the general exit status code of 1, indicating that an unknown error occurred in the command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The exit command</h3>
<p class="calibre10">By default, your shell script exits with the exit status of the last command in your script:</p>
<pre class="calibre29"><code class="calibre26">$ ./test6
The result is 2
$ echo $?
0
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="294" id="calibre_link-632" class="calibre11"></span>You can change that to return your own exit status code. The <code class="calibre26">exit</code> command allows you to specify an exit status when your script ends:</p>
<pre class="calibre29"><code class="calibre26">$ cat test13
#!/bin/bash
# testing the exit status
var1=10
var2=30
var3=$[$var1 + $var2]
echo The answer is $var3
exit 5
$</code></pre>
<p class="calibre10">When you check the exit status of the script, you get the value used as the parameter of the <code class="calibre26">exit</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test13
$ ./test13
The answer is 40
$ echo $?
5
$</code></pre>
<p class="calibre10">You can also use variables in the <code class="calibre26">exit</code> command parameter:</p>
<pre class="calibre29"><code class="calibre26">$ cat test14
#!/bin/bash
# testing the exit status
var1=10
var2=30
var3=$[$var1 + $var2]
exit $var3
$</code></pre>
<p class="calibre10">When you run this command, it produces the following exit status:</p>
<pre class="calibre29"><code class="calibre26">$ chmod u+x test14
$ ./test14
$ echo $?
40
$</code></pre>
<p class="calibre10">You should be careful with this feature, however, because the exit status codes can only go up to 255. Watch what happens in this example:</p>
<pre class="calibre29"><code class="calibre26">$ cat test14b
#!/bin/bash
# testing the exit status
var1=10
var2=30
var3=$[$var1 * $var2]
echo The value is $var3
exit $var3
$</code></pre>
<p class="calibre10">Now when you run it, you get the following:</p>
<pre class="calibre29"><code class="calibre26">$ ./test14b
The value is 300
$ echo $?
44
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="295" id="calibre_link-633" class="calibre11"></span>The exit status code is reduced to fit in the 0 to 255 range. The shell does this by using modulo arithmetic. The <code class="calibre26"><i class="calibre12">modulo</i></code> of a value is the remainder after a division. The resulting number is the remainder of the specified number divided by 256. In the case of 300 (the result value), the remainder is 44, which is what appears as the exit status code.</p>
<p class="calibre10">In Chapter 12, you'll see how you can use the <code class="calibre26">if-then</code> statement to check the error status returned by a command to see whether the command was successful.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-200" class="calibre4"></a>Summary</h2>
<p class="calibre10">The bash shell script allows you to string commands together into a script. The most basic way to create a script is to separate multiple commands on the command line using a semicolon. The shell executes each command in order, displaying the output of each command on the monitor.</p>
<p class="calibre10">You can also create a shell script file, placing multiple commands in the file for the shell to execute in order. The shell script file must define the shell used to run the script. This is done in the first line of the script file, using the <code class="calibre26">#!</code> symbol, followed by the full path of the shell.</p>
<p class="calibre10">Within the shell script you can reference environment variable values by using a dollar sign in front of the variable. You can also define your own variables for use within the script, and assign values and even the output of a command by using the backtick character or the $() format. The variable value can be used within the script by placing a dollar sign in front of the variable name.</p>
<p class="calibre10">The bash shell allows you to redirect both the input and output of a command from the standard behavior. You can redirect the output of any command from the monitor display to a file by using the greater-than symbol, followed by the name of the file to capture the output. You can append output data to an existing file by using two greater-than symbols. The <span type="pagebreak" title="296" id="calibre_link-634" class="calibre11"></span>less-than symbol is used to redirect input to a command. You can redirect input from a file to a command.</p>
<p class="calibre10">The Linux <code class="calibre26">pipe</code> command (the broken bar symbol) allows you to redirect the output of a command directly to the input of another command. The Linux system runs both commands at the same time, sending the output of the first command to the input of the second command without using any redirect files.</p>
<p class="calibre10">The bash shell provides a couple of ways for you to perform mathematical operations in your shell scripts. The <code class="calibre26">expr</code> command is a simple way to perform integer math. In the bash shell, you can also perform basic math calculations by enclosing equations in square brackets, preceded by a dollar sign. To perform floating-point arithmetic, you need to utilize the <code class="calibre26">bc</code> calculator command, redirecting input from inline data and storing the output in a user variable.</p>
<p class="calibre10">Finally, the chapter discussed how to use the exit status in your shell script. Every command that runs in the shell produces an exit status. The exit status is an integer value between 0 and 255 that indicates if the command completed successfully, and if not, what the reason may have been. An exit status of 0 indicates that the command completed successfully. You can use the <code class="calibre26">exit</code> command in your shell script to declare a specific exit status upon the completion of your script.</p>
<p class="calibre10">So far in your shell scripts, things have proceeded in an orderly fashion from one command to the next. In the next chapter, you'll see how you can use some logic flow control to alter which commands are executed within the script.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-78">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-201" class="calibre4"></a><span class="chaptertitle">Chapter 12</span><br class="calibre22" /><span class="chaptertitle">Using Structured Commands</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Working with the if-then statement</li>
<li class="calibre7">Nesting ifs</li>
<li class="calibre7">Understanding the test command</li>
<li class="calibre7">Testing compound conditions</li>
<li class="calibre7">Using double brackets and parentheses</li>
<li class="calibre7">Looking at case</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="297" id="calibre_link-635" class="calibre11"></span>In the shell scripts presented in Chapter 11, the shell processed each individual command in the shell script in the order it appeared. This works out fine for sequential operations, where you want all the commands to process in the proper order. However, this isn't how all programs operate.</p>
<p class="calibre19">Many programs require some sort of logic flow control between the commands in the script. There is a whole command class that allows the script to skip over executed commands based on tested conditions. These commands are generally referred to as <i class="calibre12">structured commands.</i>
</p>
<p class="calibre19">The structured commands allow you to alter the operation flow of a program. Quite a few structured commands are available in the bash shell, so we'll look at them individually. In this chapter, we look at <code class="calibre26">if-then</code> and <code class="calibre26">case</code> statements.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-202" class="calibre4"></a>Working with the if-then Statement</h2>
<p class="calibre10">The most basic type of structured command is the <code class="calibre26">if-then</code> statement. The <code class="calibre26">if-then</code> statement has the following format:</p>
<pre class="calibre29"><code class="calibre26">if <code class="calibre26"><i class="calibre12">command</i></code>
then
    <code class="calibre26"><i class="calibre12">commands</i></code>
fi</code></pre>
<p class="calibre10">If you're using <code class="calibre26">if-then</code> statements in other programming languages, this format may be somewhat confusing. In other programming languages, the object after the <code class="calibre26">if</code> statement is an equation that is evaluated for a <code class="calibre26">TRUE</code> or <code class="calibre26">FALSE</code> value. That's not how the bash shell <code class="calibre26">if</code> statement works.</p>
<p class="calibre10"><span type="pagebreak" title="298" id="calibre_link-636" class="calibre11"></span>The bash shell <code class="calibre26">if</code> statement runs the command defined on the <code class="calibre26">if</code> line. If the exit status of the command (see Chapter 11) is zero (the command completed successfully), the commands listed under the <code class="calibre26">then</code> section are executed. If the exit status of the command is anything else, the <code class="calibre26">then</code> commands aren't executed, and the bash shell moves on to the next command in the script. The <code class="calibre26">fi</code> statement delineates the <code class="calibre26">if-then</code> statement's end.</p>
<p class="calibre10">Here's a simple example to demonstrate this concept:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test1.sh</b></code>
#!/bin/bash
# testing the if statement
if pwd
then
    echo "It worked"
fi
$</code></pre>
<p class="calibre10">This script uses the <code class="calibre26">pwd</code> command on the <code class="calibre26">if</code> line. If the command completes successfully, the <code class="calibre26">echo</code> statement should display the text string. When you run this script from the command line, you get the following results:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test1.sh</b></code>
/home/Christine
It worked
$</code></pre>
<p class="calibre10">The shell executed the <code class="calibre26">pwd</code> command listed on the <code class="calibre26">if</code> line. Because the exit status was zero, it also executed the <code class="calibre26">echo</code> statement listed in the <code class="calibre26">then</code> section.</p>
<p class="calibre10">Here's another example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test2.sh</b></code>
#!/bin/bash
# testing a bad command
if IamNotaCommand
then
   echo "It worked"
fi
echo "We are outside the if statement"
$
$ <code class="calibre26"><b class="calibre21">./test2.sh</b></code>
./test2.sh: line 3: IamNotaCommand: command not found
We are outside the if statement
$</code></pre>
<p class="calibre10">In this example, we deliberately used a command, <code class="calibre26">IamNotaCommand</code>, that does not work in the <code class="calibre26">if</code> statement line. Because this is a bad command, it produces an exit status that's non-zero, and the bash shell skips the <code class="calibre26">echo</code> statement in the <code class="calibre26">then</code> section. Also notice that the error message generated from running the command in the <code class="calibre26">if</code> statement still <span type="pagebreak" title="299" id="calibre_link-637" class="calibre11"></span>appears in the script's output. There may be times when you don't want an error statement to appear. Chapter 15 discusses how this can be avoided.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You might see an alternative form of the <code class="calibre26">if-then</code> statement used in some scripts:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">if</code> <code class="calibre26"><i class="calibre12">command</i></code>; <code class="calibre26">then</code>
 <code class="calibre26"><i class="calibre12">commands</i></code>
<code class="calibre26">fi</code>
</code></pre>
<p class="calibre19">By putting a semicolon at the end of the command to evaluate, you can include the <code class="calibre26">then</code> statement on the same line, which looks closer to how <code class="calibre26">if-then</code> statements are handled in some other programming languages.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You are not limited to just one command in the <code class="calibre26">then</code> section. You can list commands just as in the rest of the shell script. The bash shell treats the commands as a block, executing all of them when the command in the <code class="calibre26">if</code> statement line returns a zero exit status or skipping all of them when the command returns a non-zero exit status:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test3.sh</b></code>
#!/bin/bash
# testing multiple commands in the then section
#
testuser=Christine
#
if grep $testuser /etc/passwd
then
   echo "This is my first command"
   echo "This is my second command"
   echo "I can even put in other commands besides echo:"
   ls -a /home/$testuser/.b*
fi
$</code></pre>
<p class="calibre10">The <code class="calibre26">if</code> statement line uses the <code class="calibre26">grep</code> comment to search the <code class="calibre26">/etc/passwd</code> file to see if a specific username is currently used on the system. If there's a user with that logon name, the script displays some text and then lists the bash files in the user's <code class="calibre26"><i class="calibre12">HOME</i></code> directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test3.sh</b></code>
Christine:x:501:501:Christine B:/home/Christine:/bin/bash
This is my first command
This is my second command
I can even put in other commands besides echo:
/home/Christine/.bash_history  /home/Christine/.bash_profile
/home/Christine/.bash_logout   /home/Christine/.bashrc
$</code></pre>
<p class="calibre10">However, if you set the <code class="calibre26"><i class="calibre12">testuser</i></code> variable to a user that doesn't exist on the system, nothing happens:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test3.sh</b></code>
#!/bin/bash
# testing multiple commands in the then section
#
testuser=NoSuchUser
#
if grep $testuser /etc/passwd
then
   echo "This is my first command"
   echo "This is my second command"
   echo "I can even put in other commands besides echo:"
   ls -a /home/$testuser/.b*
fi
$
$ <code class="calibre26"><b class="calibre21">./test3.sh</b></code>
$</code></pre>
<p class="calibre10">It's not all that exciting. It would be nice if we could display a little message saying that the username wasn't found on the system. Well, we can, using another feature of the <code class="calibre26">if-then</code> statement.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-203" class="calibre4"></a>Exploring the if-then-else Statement</h2>
<p class="calibre10">In the <code class="calibre26">if-then</code> statement, you <span type="pagebreak" title="300" id="calibre_link-638" class="calibre11"></span>have only one option for whether a command is successful. If the command returns a non-zero exit status code, the bash shell just moves on to the next command in the script. In this situation, it would be nice to be able to execute an alternate set of commands. That's exactly what the <code class="calibre26">if-then-else</code> statement is for.</p>
<p class="calibre10">The <code class="calibre26">if-then-else</code> statement provides another group of commands in the statement:</p>
<pre class="calibre29"><code class="calibre26">if <code class="calibre26"><i class="calibre12">command</i></code>
then
   <code class="calibre26"><i class="calibre12">commands</i></code>
else
   <code class="calibre26"><i class="calibre12">commands</i></code>
fi</code></pre>
<p class="calibre10">When the command in the <code class="calibre26">if</code> statement line returns with a zero exit status code, the commands listed in the <code class="calibre26">then</code> section are executed, just as in a normal <code class="calibre26">if-then</code> statement. When the command in the <code class="calibre26">if</code> statement line returns a non-zero exit status code, the bash shell executes the commands in the <code class="calibre26">else</code> section.</p>
<p class="calibre10">Now you can copy and modify the test script to include an <code class="calibre26">else</code> section:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cp test3.sh test4.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">nano test4.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat test4.sh</b></code>
#!/bin/bash
# testing the else section
#
testuser=NoSuchUser
#
if grep $testuser /etc/passwd
then
   echo "The bash files for user $testuser are:"
   ls -a /home/$testuser/.b*
   echo
else
   echo "The user $testuser does not exist on this system."
   echo
fi
$
$ <code class="calibre26"><b class="calibre21">./test4.sh</b></code>
The user NoSuchUser does not exist on this system.
$</code></pre>
<p class="calibre10">That's more user-friendly. Just like the <code class="calibre26">then</code> section, the <code class="calibre26">else</code> section can contain multiple commands. The <code class="calibre26">fi</code> statement delineates the end of the <code class="calibre26">else</code> section.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-204" class="calibre4"></a>Nesting ifs</h2>
<p class="calibre10"><span type="pagebreak" title="301" id="calibre_link-639" class="calibre11"></span>Sometimes, you must check for several situations in your script code. For these situations, you can nest the <code class="calibre26">if-then</code> statements:</p>
<p class="calibre10">To check if a logon name is not in the <code class="calibre26">/etc/passwd</code> file and yet a directory for that user still exists, use a nested <code class="calibre26">if-then</code> statement. In this case, the nested <code class="calibre26">if-then</code> statement is within the primary <code class="calibre26">if-then-else</code> statement's <code class="calibre26">else</code> code block:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -d /home/NoSuchUser/</b></code>
/home/NoSuchUser/
$
$ <code class="calibre26"><b class="calibre21">cat test5.sh</b></code>
#!/bin/bash
# Testing nested ifs
#
testuser=NoSuchUser
#
if grep $testuser /etc/passwd
then
   echo "The user $testuser exists on this system."
else
   echo "The user $testuser does not exist on this system."
   if ls -d /home/$testuser/
   then
      echo "However, $testuser has a directory."
   fi
fi
$
$ <code class="calibre26"><b class="calibre21">./test5.sh</b></code>
The user NoSuchUser does not exist on this system.
/home/NoSuchUser/
However, NoSuchUser has a directory.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="302" id="calibre_link-640" class="calibre11"></span>The script correctly finds that although the login name has been removed from the <code class="calibre26">/etc/passwd</code> file, the user's directory is still on the system. The problem with using this manner of nested <code class="calibre26">if-then</code> statements in a script is that the code can get hard to read, and the logic flow becomes difficult to follow.</p>
<p class="calibre10">Instead of having to write separate <code class="calibre26">if-then</code> statements, you can use an alternative version of the <code class="calibre26">else</code> section, called <code class="calibre26">elif</code>. The <code class="calibre26">elif</code> continues an else section with another <code class="calibre26">if-then</code> statement:</p>
<pre class="calibre29"><code class="calibre26">if <code class="calibre26"><i class="calibre12">command1</i></code>
then
   <code class="calibre26"><i class="calibre12">commands</i></code>
elif <code class="calibre26"><i class="calibre12">command2</i></code>
then
    more <code class="calibre26"><i class="calibre12">commands</i></code>
fi</code></pre>
<p class="calibre10">The <code class="calibre26">elif</code> statement line provides another command to evaluate, similar to the original <code class="calibre26">if </code>statement line. If the exit status code from the <code class="calibre26">elif</code> command is zero, bash executes the commands in the second <code class="calibre26">then</code> statement section. Using this method of nesting provides cleaner code with an easier-to-follow logic flow:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test5.sh</b></code>
#!/bin/bash
# Testing nested ifs - use elif
#
testuser=NoSuchUser
#
if grep $testuser /etc/passwd
then
   echo "The user $testuser exists on this system."
#
elif ls -d /home/$testuser
then
   echo "The user $testuser does not exist on this system."
   echo "However, $testuser has a directory."
#
fi
$
$ <code class="calibre26"><b class="calibre21">./test5.sh</b></code>
/home/NoSuchUser
The user NoSuchUser does not exist on this system.
However, NoSuchUser has a directory.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="303" id="calibre_link-641" class="calibre11"></span>You can even take this script a step further and have it check for both a non-existent user with a directory and a non-existent user without a directory. This is accomplished by adding an <code class="calibre26">else</code> statement within the nested <code class="calibre26">elif</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test5.sh</b></code>
#!/bin/bash
# Testing nested ifs - use elif &amp; else
#
testuser=NoSuchUser
#
if grep $testuser /etc/passwd
then
   echo "The user $testuser exists on this system."
#
elif ls -d /home/$testuser
then
   echo "The user $testuser does not exist on this system."
   echo "However, $testuser has a directory."
#
else
   echo "The user $testuser does not exist on this system."
   echo "And, $testuser does not have a directory."
fi
$
$ <code class="calibre26"><b class="calibre21">./test5.sh</b></code>
/home/NoSuchUser
The user NoSuchUser does not exist on this system.
However, NoSuchUser has a directory.
$
$ <code class="calibre26"><b class="calibre21">sudo rmdir /home/NoSuchUser</b></code>
[sudo] password for Christine:
$
$ <code class="calibre26"><b class="calibre21">./test5.sh</b></code>
ls: cannot access /home/NoSuchUser: No such file or directory
The user NoSuchUser does not exist on this system.
And, NoSuchUser does not have a directory.
$</code></pre>
<p class="calibre10">Before the <code class="calibre26">/home/NoSuchUser</code> directory was removed and the test script executed the <code class="calibre26">elif</code> statement, a zero exit status was returned. Thus, the statements within the <code class="calibre26">elif</code>'s <code class="calibre26">then</code> code block were executed. After the <code class="calibre26">/home/NoSuchUser</code> directory was removed, a non-zero exit status <span type="pagebreak" title="304" id="calibre_link-642" class="calibre11"></span>was returned for the <code class="calibre26">elif</code> statement. This caused the statements in the <code class="calibre26">else</code> block within the <code class="calibre26">elif</code> block to be executed.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Keep in mind that, with an <code class="calibre26">elif</code> statement, any <code class="calibre26">else</code> statements immediately following it are for that <code class="calibre26">elif</code> code block. They are not part of a preceding <code class="calibre26">if-then</code> statement code block.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can continue to string <code class="calibre26">elif</code> statements together, creating one huge <code class="calibre26">if-then-elif</code> conglomeration:</p>
<pre class="calibre29"><code class="calibre26">if <code class="calibre26"><i class="calibre12">command1</i></code>
then
<code class="calibre26"><i class="calibre12">    command set 1</i></code>
elif <code class="calibre26"><i class="calibre12">command2</i></code>
then
<code class="calibre26"><i class="calibre12">   command set 2</i></code>
elif <code class="calibre26"><i class="calibre12">command3</i></code>
then
<code class="calibre26"><i class="calibre12">   command set 3</i></code>
elif <code class="calibre26"><i class="calibre12">command4</i></code>
then
<code class="calibre26"><i class="calibre12">   command set 4</i></code>
fi</code></pre>
<p class="calibre10">Each block of commands is executed depending on which command returns the zero exit status code. Remember that the bash shell executes the <code class="calibre26">if</code> statements in order, and only the first one that returns a zero exit status results in the <code class="calibre26">then</code> section being executed.</p>
<p class="calibre10">Even though the code looks cleaner with <code class="calibre26">elif</code> statements, it still can be confusing to follow the script's logic. Later in the âConsidering the case Commandâ section, you'll see how to use the <code class="calibre26">case</code> command instead of having to nest lots of <code class="calibre26">if-then</code> statements.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-205" class="calibre4"></a>Trying the test Command</h2>
<p class="calibre10">So far, all you've seen in the <code class="calibre26">if</code> statement line are normal shell commands. You might be wondering if the bash <code class="calibre26">if-then</code> statement has the ability to evaluate any condition other than a command's exit status code.</p>
<p class="calibre10">The answer is no, it can't. However, there's a neat utility available in the bash shell that helps you evaluate other things, using the <code class="calibre26">if-then</code> statement.</p>
<p class="calibre10">The <code class="calibre26">test</code> command provides a way to test different conditions in an <code class="calibre26">if-then</code> statement. If the condition listed in the <code class="calibre26">test</code> command evaluates to <code class="calibre26">TRUE</code>, the <code class="calibre26">test</code> command exits with a zero exit status code. This makes the <code class="calibre26">if-then</code> statement behave in much the same way that <code class="calibre26">if-then</code> statements work in <span type="pagebreak" title="305" id="calibre_link-643" class="calibre11"></span>other programming languages. If the condition is FALSE, the <code class="calibre26">test</code> command exits with a non-zero exit status code, which causes the <code class="calibre26">if-then</code> statement to exit.</p>
<p class="calibre10">The format of the test command is pretty simple:</p>
<pre class="calibre29"><code class="calibre26">test<code class="calibre26"><i class="calibre12"> condition</i></code></code></pre>
<p class="calibre10">The <i class="calibre12">condition</i> is a series of parameters and values that the <code class="calibre26">test</code> command evaluates. When used in an <code class="calibre26">if-then</code> statement, the <code class="calibre26">test</code> command looks like this:</p>
<pre class="calibre29"><code class="calibre26">if test<code class="calibre26"><i class="calibre12"> condition</i></code>
then
   <code class="calibre26"><i class="calibre12">commands</i></code>
fi</code></pre>
<p class="calibre10">If you leave out the <code class="calibre26"><i class="calibre12">condition</i></code> portion of the <code class="calibre26">test</code> command statement, it exits with a non-zero exit status code and triggers any <code class="calibre26">else</code> block statements:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test6.sh</b></code>
#!/bin/bash
# Testing the test command
#
if test
then
   echo "No expression returns a True"
else
   echo "No expression returns a False"
fi
$
$ <code class="calibre26"><b class="calibre21">./test6.sh</b></code>
No expression returns a False
$</code></pre>
<p class="calibre10">When you add in a condition, it is tested by the <code class="calibre26">test</code> command. For example, using the <code class="calibre26">test</code> command, you can determine whether a variable has content. A simple condition expression is needed to determine whether a variable has content:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test6.sh</b></code>
#!/bin/bash
# Testing the test command
#
my_variable="Full"
#
if test $my_variable
then
   echo "The $my_variable expression returns a True"
#
else
   echo "The $my_variable expression returns a False"
fi
$
$ <code class="calibre26"><b class="calibre21">./test6.sh</b></code>
The Full expression returns a True
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="306" id="calibre_link-644" class="calibre11"></span>The variable <code class="calibre26">my_variable</code> contains content (<code class="calibre26">Full</code>), so when the <code class="calibre26">test</code> command checks the condition, the exit status returns a zero. This triggers the statement in the <code class="calibre26">then</code> code block.</p>
<p class="calibre10">As you would suspect, the opposite occurs when the variable does not contain content:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test6.sh</b></code>
#!/bin/bash
# Testing the test command
#
my_variable=""
#
if test $my_variable
then
   echo "The $my_variable expression returns a True"
#
else
   echo "The $my_variable expression returns a False"
fi
$
$ <code class="calibre26"><b class="calibre21">./test6.sh</b></code>
The  expression returns a False
$</code></pre>
<p class="calibre10">The bash shell provides an alternative way of testing a condition without declaring the <code class="calibre26">test</code> command in an <code class="calibre26">if-then</code> statement:</p>
<pre class="calibre29"><code class="calibre26">if [ <code class="calibre26"><i class="calibre12">condition</i></code> ]
then
   <code class="calibre26"><i class="calibre12">commands</i></code>
fi</code></pre>
<p class="calibre10">The square brackets define the test condition. Be careful; you <i class="calibre12">must</i> have a space after the first bracket and a space before the last bracket, or you'll get an error message.</p>
<p class="calibre10">The <code class="calibre26">test</code> command and test conditions can evaluate three classes of conditions:</p>
<ul class="calibre14">
<li class="calibre7">Numeric comparisons</li>
<li class="calibre7">String comparisons</li>
<li class="calibre7">File comparisons</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="307" id="calibre_link-645" class="calibre11"></span>The next sections describe how to use each of these test classes in your <code class="calibre26">if-then</code> statements.</p>
<section class="toclist">
<h3 class="calibre15">Using numeric comparisons</h3>
<p class="calibre10">The most common test evaluation method is to perform a comparison of two numeric values. <a id="calibre_link-80" href="#calibre_link-79" class="calibre4">Table 12.1</a> shows the list of condition parameters used for testing two values.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-79" href="#calibre_link-80" class="calibre4"><b class="calibre21">Table 12.1</b></a></span> The test Numeric Comparisons</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Comparison</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -eq n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is equal to <code class="calibre26">n2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -ge n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is greater than or equal to <code class="calibre26">n2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -gt n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is greater than <code class="calibre26">n2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -le n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is less than or equal to <code class="calibre26">n2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -lt n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is less than <code class="calibre26">n2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">n1 -ne n2</code></td>
<td class="left">Checks if <code class="calibre26">n1</code> is not equal to <code class="calibre26">n2</code></td>
</tr>
</table>
</figure>
<p class="calibre10">The numeric test conditions can be used to evaluate both numbers and variables. Here's an example of doing that:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat numeric_test.sh</b></code>
#!/bin/bash
# Using numeric test evaluations
#
value1=10
value2=11
#
if [ $value1 -gt 5 ]
then
    echo "The test value $value1 is greater than 5"
fi
#
if [ $value1 -eq $value2 ]
then
    echo "The values are equal"
else
    echo "The values are different"
fi
#
$</code></pre>
<p class="calibre10">The first test condition:</p>
<pre class="calibre29"><code class="calibre26">if [ $value1 -gt 5 ]</code></pre>
<p class="calibre10">tests if the value of the variable <i class="calibre12">value1</i> is greater than 5. The second test condition:</p>
<pre class="calibre29"><code class="calibre26">if [ $value1 -eq $value2 ]</code></pre>
<p class="calibre10">tests if the value of the variable <i class="calibre12">value1</i> is equal to the value of the variable <i class="calibre12">value2</i>. Both numeric test conditions evaluate as expected:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./numeric_test.sh</b></code>
The test value 10 is greater than 5
The values are different
$</code></pre>
<p class="calibre10">There is a limitation to the test numeric conditions concerning floating-point values:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat floating_point_test.sh</b></code>
#!/bin/bash
# Using floating point numbers in test evaluations
#
value1=5.555
#
echo "The test value is $value1"
#
if [ $value1 -gt 5 ]
then
    echo "The test value $value1 is greater than 5"
fi
#
$ <code class="calibre26"><b class="calibre21">./floating_point_test.sh</b></code>
The test value is 5.555
./floating_point_test.sh: line 8:
[: 5.555: integer expression expected
$</code></pre>
<p class="calibre10">This example uses a floating-point value, stored in the <i class="calibre12">value1</i> variable. Next, it evaluates the value. Something obviously went wrong.</p>
<p class="calibre10"><span type="pagebreak" title="308" id="calibre_link-646" class="calibre11"></span>Remember that the only numbers the bash shell can handle are integers. This works perfectly fine if all you need to do is display the result, using an <code class="calibre26">echo</code> statement. However, this doesn't work in numeric-oriented functions, such as our numeric test condition. The bottom line is that you cannot use floating-point values for test conditions.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using string comparisons</h3>
<p class="calibre10">Test conditions also allow you to perform comparisons on string values. Performing comparisons on strings can get tricky, as you'll see. <a id="calibre_link-82" href="#calibre_link-81" class="calibre4">Table 12.2</a> shows the comparison functions you can use to evaluate two string values.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-81" href="#calibre_link-82" class="calibre4"><b class="calibre21">Table 12.2</b></a></span> The test String Comparisons</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Comparison</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">str1 = str2</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> is the same as string <code class="calibre26">str2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">str1 != str2</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> is not the same as <code class="calibre26">str2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">str1 &lt; str2</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> is less than <code class="calibre26">str2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">str1 &gt; str2</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> is greater than <code class="calibre26">str2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n str1</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> has a length greater than zero</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-z str1</code></td>
<td class="left">Checks if <code class="calibre26">str1</code> has a length of zero</td>
</tr>
</table>
</figure>
<p class="calibre10">The following sections describe the different string comparisons available.</p>
<section class="toclist">
<h4 class="calibre25">Looking at string equality</h4>
<p class="calibre10">The equal and not equal conditions are fairly self-explanatory with strings. It's pretty easy to know when two string values are the same or not:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test7.sh</b></code>
#!/bin/bash
# testing string equality
testuser=rich
#
if [ $USER = $testuser ]
then
   echo "Welcome $testuser"
fi
$
$ <code class="calibre26"><b class="calibre21">./test7.sh</b></code>
Welcome rich
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="309" id="calibre_link-647" class="calibre11"></span>Also, using the not equals string comparison allows you to determine if two strings have the same value or not:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test8.sh</b></code>
#!/bin/bash
# testing string equality
testuser=baduser
#
if [ $USER != $testuser ]
then
   echo "This is not $testuser"
else
   echo "Welcome $testuser"
fi
$
$ <code class="calibre26"><b class="calibre21">./test8.sh</b></code>
This is not baduser
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="310" id="calibre_link-648" class="calibre11"></span>Keep in mind that the test comparison takes all punctuation and capitalization into account when comparing strings for equality.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at string order</h4>
<p class="calibre10">Trying to determine if one string is less than or greater than another is where things start getting tricky. Two problems often plague shell programmers when trying to use the greater-than or less-than features of test conditions:</p>
<ul class="calibre14">
<li class="calibre7">The greater-than and less-than symbols must be escaped, or the shell uses them as redirection symbols, with the string values as filenames.</li>
<li class="calibre7">The greater-than and less-than order is not the same as that used with the <code class="calibre26">sort</code> command.</li>
</ul>
<p class="calibre10">The first item can result in a huge problem that often goes undetected when programming your scripts. Here's an example of what sometimes happens to novice shell script programmers:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat badtest.sh</b></code>
#!/bin/bash
# mis-using string comparisons
#
val1=baseball
val2=hockey
#
if [ $val1 &gt; $val2 ]
then
   echo "$val1 is greater than $val2"
else
   echo "$val1 is less than $val2"
fi
$
$ <code class="calibre26"><b class="calibre21">./badtest.sh</b></code>
baseball is greater than hockey
$ ls -l hockey
-rw-r--r--    1 rich     rich            0 Sep 30 19:08 hockey
$</code></pre>
<p class="calibre10">By just using the greater-than symbol itself in the script, no errors are generated, but the results are wrong. The script interpreted the greater-than symbol as an output redirection (see Chapter 15). Thus, it created a file called hockey. Because the redirection completed successfully, the test condition returns a zero exit status code, which the <code class="calibre26">if</code> statement evaluates as though things completed successfully!</p>
<p class="calibre10">To fix this problem, you need to properly escape the greater-than symbol:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test9.sh</b></code>
#!/bin/bash
# mis-using string comparisons
#
val1=baseball
val2=hockey
#
if [ $val1 \&gt; $val2 ]
then
  echo "$val1 is greater than $val2"
else
   echo "$val1 is less than $val2"
fi
$
$ <code class="calibre26"><b class="calibre21">./test9.sh</b></code>
baseball is less than hockey
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="311" id="calibre_link-649" class="calibre11"></span>Now that answer is more along the lines of what you would expect from the string comparison.</p>
<p class="calibre10">The second issue is a little more subtle, and you may not even run across it unless you are working with uppercase and lowercase letters. The <code class="calibre26">sort</code> command handles uppercase letters opposite to the way the test conditions consider them:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test9b.sh</b></code>
#!/bin/bash
# testing string sort order
val1=Testing
val2=testing
#
if [ $val1 \&gt; $val2 ]
then
   echo "$val1 is greater than $val2"
else
   echo "$val1 is less than $val2"
fi
$
$ <code class="calibre26"><b class="calibre21">./test9b.sh</b></code>
Testing is less than testing
$
$ <code class="calibre26"><b class="calibre21">sort testfile</b></code>
testing
Testing
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="312" id="calibre_link-650" class="calibre11"></span>Capitalized letters are treated as less than lowercase letters in test comparisons. However, the <code class="calibre26">sort</code> command does the opposite. When you put the same strings in a file and use the <code class="calibre26">sort</code> command, the lowercase letters appear first. This is due to different ordering techniques.</p>
<p class="calibre10">Test comparisons use standard ASCII ordering, using each character's ASCII numeric value to determine the sort order. The <code class="calibre26">sort</code> command uses the sorting order defined for the system locale language settings. For the English language, the locale settings specify that lowercase letters appear before uppercase letters in sorted order.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">test</code> command and test expressions use the standard mathematical comparison symbols for string comparisons and text codes for numerical comparisons. This is a subtle feature that many programmers manage to get reversed. If you use the mathematical comparison symbols for numeric values, the shell interprets them as string values and may not produce the correct results.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at string size</h4>
<p class="calibre10">The <code class="calibre26">-n</code> and <code class="calibre26">-z</code> comparisons are handy when trying to evaluate whether a variable contains data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test10.sh</b></code>
#!/bin/bash
# testing string length
val1=testing
val2="
#
if [ -n $val1 ]
then
   echo "The string '$val1' is not empty"
else
   echo "The string '$val1' is empty"
fi
#
if [ -z $val2 ]
then
   echo "The string '$val2' is empty"
else
   echo "The string '$val2' is not empty"
fi
#
if [ -z $val3 ]
then
   echo "The string '$val3' is empty"
else
   echo "The string '$val3' is not empty"
fi
$
$ <code class="calibre26"><b class="calibre21">./test10.sh</b></code>
The string 'testing' is not empty
The string " is empty
The string " is empty
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="313" id="calibre_link-651" class="calibre11"></span>This example creates two string variables. The <code class="calibre26">val1</code> variable contains a string, and the <code class="calibre26">val2</code> variable is created as an empty string. The following comparisons are made as shown below:</p>
<pre class="calibre29"><code class="calibre26">if [ -n $val1 ]</code></pre>
<p class="calibre10">The preceding code determines whether the <i class="calibre12">val1</i> variable is non-zero in length, which it is, so its <code class="calibre26">then</code> section is processed.</p>
<pre class="calibre29"><code class="calibre26">if [ -z $var2 ]</code></pre>
<p class="calibre10">This preceding code determines whether the <i class="calibre12">val2</i> variable is zero in length, which it is, so its <code class="calibre26">then </code>section is processed.</p>
<pre class="calibre29"><code class="calibre26">if [ -z $val3 ]</code></pre>
<p class="calibre10">The preceding determines whether the <i class="calibre12">val3</i> variable is zero in length. This variable was never defined in the shell script, so it indicates that the string length is still zero, even though it wasn't defined.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Empty and uninitialized variables can have catastrophic effects on your shell script tests. If you're not sure of the contents of a variable, it's always best to test if the variable contains a value using <code class="calibre26">-n</code> or <code class="calibre26">-z</code> before using it in a numeric or string comparison.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using file comparisons</h3>
<p class="calibre10">The last category of test comparisons is quite possibly the most powerful and most used comparisons in shell scripting. This category allows you to test the status of files and directories on the Linux filesystem. <a id="calibre_link-84" href="#calibre_link-83" class="calibre4">Table 12.3</a> lists these comparisons.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-83" href="#calibre_link-84" class="calibre4"><b class="calibre21">Table 12.3</b></a></span> The test File Comparisons</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Comparison</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is a directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is a file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is readable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is not empty</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-w file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is writable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-x file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is executable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-O file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and is owned by the current user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-G file</code></td>
<td class="left">Checks if <code class="calibre26">file</code> exists and the default group is the same as the current user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">file1 -nt file2</code></td>
<td class="left">Checks if <code class="calibre26">file1</code> is newer than <code class="calibre26">file2</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">file1 -ot file2</code></td>
<td class="left">Checks if <code class="calibre26">file1</code> is older than <code class="calibre26">file2</code></td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="314" id="calibre_link-652" class="calibre11"></span>These conditions give you the ability to check filesystem files within shell scripts. They are often used in scripts that access files. Because they're used so often, let's look at each of these individually.</p>
<section class="toclist">
<h4 class="calibre25">Checking directories</h4>
<p class="calibre10">The <code class="calibre26">-d</code> test checks to see if a specified directory exists on the system. This is usually a good thing to do if you're trying to write a file to a directory or before you try to change to a directory location:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test11.sh</b></code>
#!/bin/bash
# Look before you leap
#
jump_directory=/home/arthur
#
if [ -d $jump_directory ]
then
   echo "The $jump_directory directory exists"
   cd $jump_directory
   ls
else
   echo "The $jump_directory directory does not exist"
fi
#
$
$ <code class="calibre26"><b class="calibre21">./test11.sh</b></code>
The /home/arthur directory does not exist
$</code></pre>
<p class="calibre10">The <code class="calibre26">-d</code> test condition checks to see if the <code class="calibre26">jump_directory</code> variable's directory exists. If it does, it proceeds to use the <code class="calibre26">cd</code> command to change to the current directory and performs a directory listing. If it does not, the script emits a warning message and exits the script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking whether an object exists</h4>
<p class="calibre10">The <code class="calibre26">-e</code> comparison allows you to check <span type="pagebreak" title="315" id="calibre_link-653" class="calibre11"></span>if either a file or directory object exists before you attempt to use it in your script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test12.sh</b></code>
#!/bin/bash
# Check if either a directory or file exists
#
location=$HOME
file_name="sentinel"
#
if [ -e $location ]
then  #Directory does exist
   echo "OK on the $location directory."
   echo "Now checking on the file, $file_name."
   #
   if [ -e $location/$file_name ]
   then #File does exist
       echo "OK on the filename"
       echo "Updating Current Date..."
       date &gt;&gt; $location/$file_name
   #
   else #File does not exist
       echo "File does not exist"
       echo "Nothing to update"
   fi
#
else   #Directory does not exist
   echo "The $location directory does not exist."
   echo "Nothing to update"
fi
#
$
$ <code class="calibre26"><b class="calibre21">./test12.sh</b></code>
OK on the /home/Christine directory.
Now checking on the file, sentinel.
File does not exist
Nothing to update
$
$ <code class="calibre26"><b class="calibre21">touch sentinel</b></code>
$
$ <code class="calibre26"><b class="calibre21">./test12.sh</b></code>
OK on the /home/Christine directory.
Now checking on the file, sentinel.
OK on the filename
Updating Current Date...
$</code></pre>
<p class="calibre10">The first <span type="pagebreak" title="316" id="calibre_link-654" class="calibre11"></span>check uses the <code class="calibre26">-e</code> comparison to determine whether the user has a <code class="calibre26"><i class="calibre12">$HOME</i></code> directory. If so, the next <code class="calibre26">-e</code> comparison checks to determine whether the <code class="calibre26">sentinel</code> file exists in the <code class="calibre26"><i class="calibre12">$HOME</i></code> directory. If the file doesn't exist, the shell script notes that the file is missing and that there is nothing to update.</p>
<p class="calibre10">To ensure that the update will work, the <code class="calibre26">sentinel</code> file was created and the shell script was run a second time. This time when the conditions are tested, both the <code class="calibre26">$HOME</code> and the <code class="calibre26">sentinel</code> file are found, and the current date and time is appended to the file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking for a file</h4>
<p class="calibre10">The <code class="calibre26">-e</code> comparison works for both files and directories. To be sure that the object specified is a file and not a directory, you must use the <code class="calibre26">-f</code> comparison:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test13.sh</b></code>
#!/bin/bash
# Check if either a directory or file exists
#
item_name=$HOME
echo
echo "The item being checked: $item_name"
echo
#
if [ -e $item_name ]
then  #Item does exist
   echo "The item, $item_name, does exist."
   echo "But is it a file?"
   echo
   #
   if [ -f $item_name ]
   then #Item is a file
       echo "Yes, $item_name is a file."
   #
   else #Item is not a file
       echo "No, $item_name is not a file."
   fi
#
else   #Item does not exist
   echo "The item, $item_name, does not exist."
   echo "Nothing to update"
fi
#
$ <code class="calibre26"><b class="calibre21">./test13.sh</b></code>
The item being checked: /home/Christine
The item, /home/Christine, does exist.
But is it a file?
No, /home/Christine is not a file.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="317" id="calibre_link-655" class="calibre11"></span>This little script does lots of checking! First, it uses the <code class="calibre26">-e</code> comparison to test whether <code class="calibre26"><i class="calibre12">$HOME</i></code> exists. If it does, it uses <code class="calibre26">-f</code> to test whether it's a file. If it isn't a file (which of course it isn't), a message is displayed stating that it is not a file.</p>
<p class="calibre10">A slight modification to the variable, <code class="calibre26">item_name</code>, replacing the directory <code class="calibre26">$HOME</code> with a file, <code class="calibre26">$HOME/sentinel</code>, causes a different outcome:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nano test13.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat test13.sh</b></code>
#!/bin/bash
# Check if either a directory or file exists
#
item_name=$HOME/sentinel
[...]
$
$ <code class="calibre26"><b class="calibre21">./test13.sh</b></code>
The item being checked: /home/Christine/sentinel
The item, /home/Christine/sentinel, does exist.
But is it a file?
Yes, /home/Christine/sentinel is a file.
$</code></pre>
<p class="calibre10">The <code class="calibre26">test13.sh</code> script listing is snipped, because the only item changed in the shell script was the <code class="calibre26">item_name</code> variable's value. Now when the script is run, the <code class="calibre26">-f</code> test on <code class="calibre26">$HOME/sentinel</code> exits with a zero status, triggering the <code class="calibre26">then</code> statement, which in turn outputs the message <code class="calibre26">Yes, /home/Christine/sentinel is a file.</code></p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking for read access</h4>
<p class="calibre10">Before trying to read data from a file, it's usually a good idea to test whether you can read from the file first. You do this with the <code class="calibre26">-r</code> comparison:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test14.sh</b></code>
#!/bin/bash
# testing if you can read a file
pwfile=/etc/shadow
#
# first, test if the file exists, and is a file
if [ -f $pwfile ]
then
   # now test if you can read it
   if [ -r $pwfile ]
   then
      tail $pwfile
   else
      echo "Sorry, I am unable to read the $pwfile file"
   fi
else
   echo "Sorry, the file $file does not exist"
fi
$
$ <code class="calibre26"><b class="calibre21">./test14.sh</b></code>
Sorry, I am unable to read the /etc/shadow file
$</code></pre>
<p class="calibre10">The <code class="calibre26">/etc/shadow</code> file <span type="pagebreak" title="318" id="calibre_link-656" class="calibre11"></span>contains the encrypted passwords for system users, so it's not readable by normal users on the system. The <code class="calibre26">-r</code> comparison determined that read access to the file wasn't allowed, so the test command failed and the bash shell executed the <code class="calibre26">else</code> section of the <code class="calibre26">if-then</code> statement.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking for empty files</h4>
<p class="calibre10">You should use <code class="calibre26">-s</code> comparison to check whether a file is empty, especially if you don't want to remove a non-empty file. Be careful because when the <code class="calibre26">-s</code> comparison succeeds, it indicates that a file has data in it:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test15.sh</b></code>
#!/bin/bash
# Testing if a file is empty
#
file_name=$HOME/sentinel
#
if [ -f $file_name ]
then
   if [ -s $file_name ]
   then
      echo ''The $file_name file exists and has data in it.''
      echo ''Will not remove this file.''
#
   else
      echo ''The $file_name file exists, but is empty.''
      echo ''Deleting empty file...''
      rm $file_name
   fi
else
   echo ''File, $file_name, does not exist.''
fi
#
$ <code class="calibre26"><b class="calibre21">ls -l $HOME/sentinel</b></code>
-rw-rw-r--. 1 Christine Christine 29 Jun 25 05:32 /home/Christine/sentinel
$
$ <code class="calibre26"><b class="calibre21">./test15.sh</b></code>
The /home/Christine/sentinel file exists and has data in it.
Will not remove this file.
$</code></pre>
<p class="calibre10">First, the <code class="calibre26">-f</code> comparison tests whether the file exists. If it does exist, the <code class="calibre26">-s</code> comparison is triggered to determine whether the file is empty. An empty file will be deleted. You can see from the <code class="calibre26">ls -l</code> that the <code class="calibre26">sentinel</code> file is not empty, and therefore the script does not delete it.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking whether you can write to a file</h4>
<p class="calibre10">The <code class="calibre26">-w</code> comparison determines whether you have permission <span type="pagebreak" title="319" id="calibre_link-657" class="calibre11"></span>to write to a file. The <code class="calibre26">test16.sh</code> script is simply an update of the <code class="calibre26">test13.sh</code> script. Now instead of just checking whether the <code class="calibre26">item_name</code> exists and is a file, the script also checks to see whether it has permission to write to the file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test16.sh</b></code>
#!/bin/bash
# Check if a file is writable.
#
item_name=$HOME/sentinel
echo
echo "The item being checked: $item_name"
echo
[...]
       echo "Yes, $item_name is a file."
       echo "But is it writable?"
       echo
       #
       if [ -w $item_name ]
       then #Item is writable
            echo "Writing current time to $item_name"
            date +%H%M &gt;&gt; $item_name
       #
       else #Item is not writable
            echo "Unable to write to $item_name"
       fi
   #
   else #Item is not a file
       echo "No, $item_name is not a file."
   fi
[...]
$
$ <code class="calibre26"><b class="calibre21">ls -l sentinel</b></code>
-rw-rw-r--. 1 Christine Christine 0 Jun 27 05:38 sentinel
$
$ <code class="calibre26"><b class="calibre21">./test16.sh</b></code>
The item being checked: /home/Christine/sentinel
The item, /home/Christine/sentinel, does exist.
But is it a file?
Yes, /home/Christine/sentinel is a file.
But is it writable?
Writing current time to /home/Christine/sentinel
$
$ <code class="calibre26"><b class="calibre21">cat sentinel</b></code>
0543
$</code></pre>
<p class="calibre10">The <code class="calibre26">item_name</code> variable is set to <code class="calibre26">$HOME/sentinel</code>, and this file allows user write access (see Chapter 7 for <span type="pagebreak" title="320" id="calibre_link-658" class="calibre11"></span>more information on file permissions). Thus, when the script is run, the <code class="calibre26">-w</code> test expressions returns a non-zero exit status and the <code class="calibre26">then</code> code block is executed, which writes a time stamp into the <code class="calibre26">sentinel</code> file.</p>
<p class="calibre10">When the sentinel file user's write access is removed via <code class="calibre26">chmod</code>, the <code class="calibre26">-w</code> test expression returns a non-zero status, and a time stamp is not written to the file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">chmod u-w sentinel</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l sentinel</b></code>
-r--rw-r--. 1 Christine Christine 5 Jun 27 05:43 sentinel
$
$ <code class="calibre26"><b class="calibre21">./test16.sh</b></code>
The item being checked: /home/Christine/sentinel
The item, /home/Christine/sentinel, does exist.
But is it a file?
Yes, /home/Christine/sentinel is a file.
But is it writable?
Unable to write to /home/Christine/sentinel
$</code></pre>
<p class="calibre10">The <code class="calibre26">chmod</code> command could be used again to grant the write permission back for the user. This would make the write test expression return a zero exit status and allow a write attempt to the file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking whether you can run a file</h4>
<p class="calibre10">The <code class="calibre26">-x</code> comparison is a handy way to <span type="pagebreak" title="321" id="calibre_link-659" class="calibre11"></span>determine whether you have execute permission for a specific file. Although this may not be needed for most commands, if you run lots of scripts from your shell scripts, it could be useful:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test17.sh</b></code>
#!/bin/bash
# testing file execution
#
if [ -x test16.sh ]
then
   echo "You can run the script: "
   ./test16.sh
else
   echo "Sorry, you are unable to execute the script"
fi
$
$ <code class="calibre26"><b class="calibre21">./test17.sh</b></code>
You can run the script:
[...]
$
$ <code class="calibre26"><b class="calibre21">chmod u-x test16.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">./test17.sh</b></code>
Sorry, you are unable to execute the script
$</code></pre>
<p class="calibre10">This example shell script uses the <code class="calibre26">-x</code> comparison to test whether you have permission to execute the <code class="calibre26">test16.sh</code> script. If so, it runs the script. After successfully running the <code class="calibre26">test16.sh</code> script the first time, the permissions were changed. This time, the <code class="calibre26">-x</code> comparison failed, because execute permission had been removed for the <code class="calibre26">test16.sh</code> script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking ownership</h4>
<p class="calibre10">The <code class="calibre26">-O</code> comparison allows you to easily test whether you're the owner of a file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test18.sh</b></code>
#!/bin/bash
# check file ownership
#
if [ -O /etc/passwd ]
then
   echo "You are the owner of the /etc/passwd file"
else
   echo "Sorry, you are not the owner of the /etc/passwd file"
fi
$
$ <code class="calibre26"><b class="calibre21">./test18.sh</b></code>
Sorry, you are not the owner of the /etc/passwd file
$ </code></pre>
<p class="calibre10">The script uses the <code class="calibre26">-O</code> comparison to test whether the user running the script is the owner of the <code class="calibre26">/etc/passwd</code> file. The script is run under a normal user account, so the test fails.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking default group membership</h4>
<p class="calibre10">The <code class="calibre26">-G</code> comparison <span type="pagebreak" title="322" id="calibre_link-660" class="calibre11"></span>checks the default group of a file, and it succeeds if it matches the group of the default group for the user. This can be somewhat confusing because the <code class="calibre26">-G</code> comparison checks the default groups only and not all the groups to which the user belongs. Here's an example of this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test19.sh</b></code>
#!/bin/bash
# check file group test
#
if [ -G $HOME/testing ]
then
   echo "You are in the same group as the file"
else
   echo "The file is not owned by your group"
fi
$
$ <code class="calibre26"><b class="calibre21">ls -l $HOME/testing</b></code>
-rw-rw-r-- 1 rich rich 58 2014-07-30 15:51 /home/rich/testing
$
$ ./test19.sh
You are in the same group as the file
$
$ <code class="calibre26"><b class="calibre21">chgrp sharing $HOME/testing</b></code>
$
$ <code class="calibre26"><b class="calibre21">./test19</b></code>
The file is not owned by your group
$</code></pre>
<p class="calibre10">The first time the script is run, the <code class="calibre26"><i class="calibre12">$</i></code><i class="calibre12">HOME</i><code class="calibre26">/</code><i class="calibre12">testing</i> file is in the <code class="calibre26">rich</code> group, and the <code class="calibre26">-G</code> comparison succeeds. Next, the group is changed to the <code class="calibre26">sharing</code> group, of which the user is also a member. However, the <code class="calibre26">-G</code> comparison failed, because it compares only the default groups, not any additional group memberships.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking file date</h4>
<p class="calibre10">The last set of comparisons deal with comparing the creation times of two files. This comes in handy when writing scripts to install software. Sometimes, you don't want to install a file that is older than a file already installed on the system.</p>
<p class="calibre10">The <code class="calibre26">-nt</code> comparison <span type="pagebreak" title="323" id="calibre_link-661" class="calibre11"></span>determines whether a file is newer than another file. If a file is newer, it has a more recent file creation time. The <code class="calibre26">-ot</code> comparison determines whether a file is older than another file. If the file is older, it has an older file creation time:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test20.sh</b></code>
#!/bin/bash
# testing file dates
#
if [ test19.sh -nt test18.sh ]
then
   echo "The test19 file is newer than test18"
else
   echo "The test18 file is newer than test19"
fi
if [ test17.sh -ot test19.sh ]
then
  echo "The test17 file is older than the test19 file"
fi
$
$ <code class="calibre26"><b class="calibre21">./test20.sh</b></code>
The test19 file is newer than test18
The test17 file is older than the test19 file
$
$ <code class="calibre26"><b class="calibre21">ls -l test17.sh test18.sh test19.sh</b></code>
-rwxrw-r-- 1 rich rich 167 2014-07-30 16:31 test17.sh
-rwxrw-r-- 1 rich rich 185 2014-07-30 17:46 test18.sh
-rwxrw-r-- 1 rich rich 167 2014-07-30 17:50 test19.sh
$</code></pre>
<p class="calibre10">The file paths used in the comparisons are relative to the directory from which you run the script. This can cause problems if the files being checked are moved around. Another problem is that neither of these comparisons checks whether the file exists first. Try this test:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test21.sh</b></code>
#!/bin/bash
# testing file dates
#
if [ badfile1 -nt badfile2 ]
then
   echo "The badfile1 file is newer than badfile2"
else
   echo "The badfile2 file is newer than badfile1"
fi
$
$ <code class="calibre26"><b class="calibre21">./test21.sh</b></code>
The badfile2 file is newer than badfile1
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="324" id="calibre_link-662" class="calibre11"></span>This little example demonstrates that if the files don't exist, the <code class="calibre26">-nt</code> comparison just returns a failed condition. It's imperative to ensure that the files exist before trying to use them in the <code class="calibre26">-nt</code> or <code class="calibre26">-ot</code> comparison.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-206" class="calibre4"></a>Considering Compound Testing</h2>
<p class="calibre10">The <code class="calibre26">if-then</code> statement allows you to use Boolean logic to combine tests. You can use these two Boolean operators:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">[ condition1 ] &amp;&amp; [ condition2 ]</code></li>
<li class="calibre7"><code class="calibre26">[ condition1 ] || [ condition2 ]</code></li>
</ul>
<p class="calibre10">The first Boolean operation uses the <code class="calibre26">AND</code> Boolean operator to combine two conditions. Both conditions must be met for the <code class="calibre26">then</code> section to execute.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Boolean logic is a method that reduces the potential returned values to be either <code class="calibre26">TRUE</code> or <code class="calibre26">FALSE</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The second Boolean operation uses the <code class="calibre26">OR</code> Boolean operator to combine two conditions. If either condition evaluates to a <code class="calibre26">TRUE</code> condition, the <code class="calibre26">then</code> section is executed.</p>
<p class="calibre10">The following shows the <code class="calibre26">AND</code> Boolean operator in use:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test22.sh</b></code>
#!/bin/bash
# testing compound comparisons
#
if [ -d $HOME ] &amp;&amp; [ -w $HOME/testing ]
then
   echo "The file exists and you can write to it"
else
   echo "I cannot write to the file"
fi
$
$ <code class="calibre26"><b class="calibre21">./test22.sh</b></code>
I cannot write to the file
$
$ <code class="calibre26"><b class="calibre21">touch $HOME/testing</b></code>
$
$ <code class="calibre26"><b class="calibre21">./test22.sh</b></code>
The file exists and you can write to it
$</code></pre>
<p class="calibre10">Using the <code class="calibre26">AND</code> Boolean operator, both of the comparisons must be met. The first comparison checks to see if the <code class="calibre26"><i class="calibre12">$</i></code><i class="calibre12">HOME</i> directory exists for the user. The second comparison checks to <span type="pagebreak" title="325" id="calibre_link-663" class="calibre11"></span>see if there's a file called <code class="calibre26">testing</code> in the user's <code class="calibre26"><i class="calibre12">$</i></code><i class="calibre12">HOME</i> directory, and if the user has write permissions for the file. If either of these comparisons fails, the <code class="calibre26">if</code> statement fails and the shell executes the <code class="calibre26">else</code> section. If both of the comparisons succeed, the <code class="calibre26">if</code> statement succeeds, and the shell executes the <code class="calibre26">then</code> section.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-207" class="calibre4"></a>Working with Advanced if-then Features</h2>
<p class="calibre10">Two additions to the bash shell provide advanced features that you can use in <code class="calibre26">if-then</code> statements:</p>
<ul class="calibre14">
<li class="calibre7">Double parentheses for mathematical expressions</li>
<li class="calibre7">Double square brackets for advanced string handling functions</li>
</ul>
<p class="calibre10">The following sections describe each of these features in more detail.</p>
<section class="toclist">
<h3 class="calibre15">Using double parentheses</h3>
<p class="calibre10">The <i class="calibre12">double parentheses</i> command allows you to incorporate advanced mathematical formulas in your comparisons. The <code class="calibre26">test</code> command allows for only simple arithmetic operations in the comparison. The double parentheses command provides more mathematical symbols, which programmers who have used other programming languages may be familiar with using. Here's the format of the double parentheses command:</p>
<pre class="calibre29"><code class="calibre26">(( <code class="calibre26"><i class="calibre12">expression</i></code> ))</code></pre>
<p class="calibre10">The <i class="calibre12">expression</i> term can be any mathematical assignment or comparison expression. Besides the standard mathematical operators that the <code class="calibre26">test</code> command uses, <a id="calibre_link-86" href="#calibre_link-85" class="calibre4">Table 12.4</a> shows the list of additional operators available for use in the double parentheses command.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-85" href="#calibre_link-86" class="calibre4"><b class="calibre21">Table 12.4</b></a></span> The Double Parentheses Command Symbols</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Symbol</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">val++</code></td>
<td class="left">Post-increment</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">val--</code></td>
<td class="left">Post-decrement</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">++val</code></td>
<td class="left">Pre-increment</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--val</code></td>
<td class="left">Pre-decrement</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">!</code></td>
<td class="left">Logical negation</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">â¼</code></td>
<td class="left">Bitwise negation</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">**</code></td>
<td class="left">Exponentiation</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">&lt;&lt;</code></td>
<td class="left">Left bitwise shift</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">&gt;&gt;</code></td>
<td class="left">Right bitwise shift</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">&amp;</code></td>
<td class="left">Bitwise Boolean <code class="calibre26">AND</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">|</code></td>
<td class="left">Bitwise Boolean <code class="calibre26">OR</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">&amp;&amp;</code></td>
<td class="left">Logical <code class="calibre26">AND</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">||</code></td>
<td class="left">Logical <code class="calibre26">OR</code></td>
</tr>
</table>
</figure>
<p class="calibre10">You can use the double parentheses command in an <code class="calibre26">if </code>statement, as well as in a normal command in the script for assigning values:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test23.sh</b></code>
#!/bin/bash
# using double parenthesis
#
val1=10
#
if (( $val1 ** 2 &gt; 90 ))
then
   (( val2 = $val1 ** 2 ))
   echo "The square of $val1 is $val2"
fi
$
$ <code class="calibre26"><b class="calibre21">./test23.sh</b></code>
The square of 10 is 100
$</code></pre>
<p class="calibre10">Notice that you don't need to escape the greater-than symbol in the expression within the double parentheses. This is yet another advanced feature besides the double parentheses command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using double brackets</h3>
<p class="calibre10">The <i class="calibre12">double bracket</i> command <span type="pagebreak" title="326" id="calibre_link-664" class="calibre11"></span>provides advanced features for string comparisons. Here's the double bracket command format:</p>
<pre class="calibre29"><code class="calibre26">[[ <code class="calibre26"><i class="calibre12">expression</i></code> ]]</code></pre>
<p class="calibre10">The double bracketed <i class="calibre12">expression</i> uses the standard string comparison used in the test evaluations. However, it provides an additional feature that the test evaluations don't &mdash; <i class="calibre12">pattern matching</i>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Double brackets work fine in the bash shell. Be aware, however, that not all shells support double brackets.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="327" id="calibre_link-665" class="calibre11"></span>In pattern matching, you can define a regular expression (discussed in detail in Chapter 20) that's matched against the string value:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test24.sh</b></code>
#!/bin/bash
# using pattern matching
#
if [[ $USER == r* ]]
then
   echo "Hello $USER"
else
   echo "Sorry, I do not know you"
fi
$
$ <code class="calibre26"><b class="calibre21">./test24.sh</b></code>
Hello rich
$</code></pre>
<p class="calibre10">Notice in the preceding script that double equal signs (<code class="calibre26">==</code>) are used. These double equal signs designate the string to the right (<code class="calibre26">r*</code>) as a pattern, and pattern matching rules are applied. The double bracket command matches the <code class="calibre26"><i class="calibre12">$</i></code><i class="calibre12">USER</i> environment variable to see whether it starts with the letter <code class="calibre26">r</code>. If so, the comparison succeeds, and the shell executes the <code class="calibre26">then</code> section commands.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-208" class="calibre4"></a>Considering the case Command</h2>
<p class="calibre10">Often, you'll find yourself trying to evaluate a variable's value, looking for a specific value within a set of possible values. In this scenario, you end up having to write a lengthy <code class="calibre26">if-then-else</code> statement, like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test25.sh</b></code>
#!/bin/bash
# looking for a possible value
#
if [ $USER = "rich" ]
then
   echo "Welcome $USER"
   echo "Please enjoy your visit"
elif [ $USER = "barbara" ]
then
   echo "Welcome $USER"
   echo "Please enjoy your visit"
elif [ $USER = "testing" ]
then
   echo "Special testing account"
elif [ $USER = "jessica" ]
then
   echo "Do not forget to logout when you're done"
else
   echo "Sorry, you are not allowed here"
fi
$
$ <code class="calibre26"><b class="calibre21">./test25.sh</b></code>
Welcome rich
Please enjoy your visit
$</code></pre>
<p class="calibre10">The <code class="calibre26">elif</code> statements continue the <code class="calibre26">if-then</code> checking, looking for a specific value for the single comparison variable.</p>
<p class="calibre10"><span type="pagebreak" title="328" id="calibre_link-666" class="calibre11"></span>Instead of having to write all the <code class="calibre26">elif</code> statements to continue checking the same variable value, you can use the <code class="calibre26">case</code> command. The <code class="calibre26">case</code> command checks multiple values of a single variable in a list-oriented format:</p>
<pre class="calibre29"><code class="calibre26">case <code class="calibre26"><i class="calibre12">variable</i></code> in
<code class="calibre26"><i class="calibre12">pattern1</i></code> | <code class="calibre26"><i class="calibre12">pattern2</i></code>) <code class="calibre26"><i class="calibre12">commands1</i></code>;;
<code class="calibre26"><i class="calibre12">pattern3</i></code>) <code class="calibre26"><i class="calibre12">commands2</i></code>;;
*) <code class="calibre26"><i class="calibre12">default commands</i></code>;;
esac</code></pre>
<p class="calibre10">The <code class="calibre26">case</code> command compares the variable specified against the different patterns. If the variable matches the pattern, the shell executes the commands specified for the pattern. You can list more than one pattern on a line, using the bar operator to separate each pattern. The asterisk symbol is the catch-all for values that don't match any of the listed patterns. Here's an example of converting the <code class="calibre26">if-then-else</code> program to using the <code class="calibre26">case</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test26.sh</b></code>
#!/bin/bash
# using the case command
#
case $USER in
rich | barbara)
   echo "Welcome, $USER"
   echo "Please enjoy your visit";;
testing)
  echo "Special testing account";;
jessica)
   echo "Do not forget to log off when you're done";;
*)
   echo "Sorry, you are not allowed here";;
esac
$
$ <code class="calibre26"><b class="calibre21">./test26.sh</b></code>
Welcome, rich
Please enjoy your visit
$</code></pre>
<p class="calibre10">The <code class="calibre26">case</code> command provides a much cleaner way of specifying the various options for each possible variable value.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-209" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="329" id="calibre_link-667" class="calibre11"></span>Structured commands allow you to alter the normal flow of shell script execution. The most basic structured command is the <code class="calibre26">if-then</code> statement. This statement provides a command evaluation and performs other commands based on the evaluated command's output.</p>
<p class="calibre10">You can expand the <code class="calibre26">if-then</code> statement to include a set of commands the bash shell executes if the specified command fails as well. The <code class="calibre26">if-then-else</code> statement executes commands only if the command being evaluated returns a non-zero exit status code.</p>
<p class="calibre10">You can also link <code class="calibre26">if-then-else</code> statements together, using the <code class="calibre26">elif</code> statement. The <code class="calibre26">elif</code> is equivalent to using an <code class="calibre26">else if</code> statement, providing for additional checking of whether the original command that was evaluated failed.</p>
<p class="calibre10">In most scripts, instead of evaluating a command, you'll want to evaluate a condition, such as a numeric value, the contents of a string, or the status of a file or directory. The <code class="calibre26">test</code> command provides an easy way for you to evaluate all these conditions. If the condition evaluates to a <code class="calibre26">TRUE</code> condition, the <code class="calibre26">test</code> command produces a zero exit status code for the <code class="calibre26">if-then</code> statement. If the condition evaluates to a <code class="calibre26">FALSE</code> condition, the <code class="calibre26">test</code> command produces a non-zero exit status code for the <code class="calibre26">if-then</code> statement.</p>
<p class="calibre10">The square bracket is a special bash command that is a synonym for the <code class="calibre26">test</code> command. You can enclose a test condition in square brackets in the <code class="calibre26">if-then</code> statement to test for numeric, string, and file conditions.</p>
<p class="calibre10">The double parentheses command provides advanced mathematical evaluations using additional operators. The double square bracket command allows you to perform advanced string pattern-matching evaluations.</p>
<p class="calibre10">Finally, the chapter discussed the <code class="calibre26">case</code> command, which is a shorthand way of performing multiple <code class="calibre26">if-then-else</code> commands, checking the value of a single variable against a list of values.</p>
<p class="calibre10">The next chapter continues the discussion of structured commands by examining the shell looping commands. The <code class="calibre26">for</code> and <code class="calibre26">while</code> commands let you create loops that iterate through commands for a given period of time.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1175">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-210" class="calibre4"></a><span class="chaptertitle">Chapter 13</span><br class="calibre22" /><span class="chaptertitle">More Structured Commands</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Looping with the for statement</li>
<li class="calibre7">Iterating with the until statement</li>
<li class="calibre7">Using the while statement</li>
<li class="calibre7">Combining loops</li>
<li class="calibre7">Redirecting loop output</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="331" id="calibre_link-668" class="calibre11"></span>In the previous chapter, you saw how to manipulate the flow of a shell script program by checking the output of commands and the values of variables. In this chapter, we continue to look at structured commands that control the flow of your shell scripts. You'll see how you can perform repeating processes, commands that can loop through a set of commands until an indicated condition has been met. This chapter discusses and demonstrates the <code class="calibre26">for</code>, <code class="calibre26">while</code>, and <code class="calibre26">until</code> bash shell looping commands.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-211" class="calibre4"></a>The for Command</h2>
<p class="calibre10">Iterating through a series of commands is a common programming practice. Often, you need to repeat a set of commands until a specific condition has been met, such as processing all the files in a directory, all the users on a system, or all the lines in a text file.</p>
<p class="calibre10">The bash shell provides the <code class="calibre26">for</code> command to allow you to create a loop that iterates through a series of values. Each iteration performs a defined set of commands using one of the values in the series. Here's the basic format of the bash shell <code class="calibre26">for</code> command:</p>
<pre class="calibre29"><code class="calibre26"> for var in <i class="calibre12">list</i>
 do
    <i class="calibre12">commands</i>
 done</code></pre>
<p class="calibre10">You supply the series of values used in the iterations in the <i class="calibre12">list</i> parameter. You can specify the values in the list in several ways.</p>
<p class="calibre10"><span type="pagebreak" title="332" id="calibre_link-669" class="calibre11"></span>In each iteration, the variable <i class="calibre12">var</i> contains the current value in the list. The first iteration uses the first item in the list, the second iteration the second item, and so on until all the items in the list have been used.</p>
<p class="calibre10">The <i class="calibre12">commands</i> entered between the <code class="calibre26">do</code> and <code class="calibre26">done</code> statements can be one or more standard bash shell commands. Within the commands, the <code class="calibre26">$var</code> variable contains the current list item value for the iteration.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you prefer, you can include the <code class="calibre26">do</code> statement on the same line as the <code class="calibre26">for</code> statement, but you must separate it from the list items using a semicolon: <code class="calibre26">for var in list; do</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">We mentioned that there are several different ways to specify the values in the list. The following sections show the various ways to do that.</p>
<section class="toclist">
<h3 class="calibre15">Reading values in a list</h3>
<p class="calibre10">The most basic use of the <code class="calibre26">for</code> command is to iterate through a list of values defined within the <code class="calibre26">for</code> command itself:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test1
 #!/bin/bash
 # basic for command
 for test in Alabama Alaska Arizona Arkansas California Colorado
 do
    echo The next state is $test
 done
 $ ./test1
 The next state is Alabama
 The next state is Alaska
 The next state is Arizona
 The next state is Arkansas
 The next state is California
 The next state is Colorado
 $</code></pre>
<p class="calibre10">Each time the <code class="calibre26">for</code> command iterates through the list of values provided, it assigns the <code class="calibre26">$test</code> variable the next value in the list. The <code class="calibre26">$test</code> variable can be used just like any other script variable within the <code class="calibre26">for</code> command statements. After the last iteration, the <code class="calibre26">$test</code> variable remains valid throughout the remainder of the shell script. It retains the last iteration value (unless you change its value):</p>
<pre class="calibre29"><code class="calibre26"> $ cat test1b
 #!/bin/bash
 # testing the for variable after the looping
 for test in Alabama Alaska Arizona Arkansas California Colorado
 do
    echo "The next state is $test"
 done
 echo "The last state we visited was $test"
 test=Connecticut
 echo "Wait, now we're visiting $test"
 $ ./test1b
 The next state is Alabama
 The next state is Alaska
 The next state is Arizona
 The next state is Arkansas
 The next state is California
 The next state is Colorado
 The last state we visited was Colorado
 Wait, now we're visiting Connecticut
 $</code></pre>
<p class="calibre10">The <code class="calibre26">$test</code> variable retained its value and allowed us to change the value and use it outside of the <code class="calibre26">for</code> command loop, as any other variable would.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading complex values in a list</h3>
<p class="calibre10"><span type="pagebreak" title="333" id="calibre_link-670" class="calibre11"></span>Things aren't always as easy as they seem with the <code class="calibre26">for</code> loop. There are times when you run into data that causes problems. Here's a classic example of what can cause problems for shell script programmers:</p>
<pre class="calibre29"><code class="calibre26"> $ cat badtest1
 #!/bin/bash
 # another example of how not to use the for command
 for test in I don't know if this'll work
 do
    echo "word:$test"
 done
 $ ./badtest1
 word:I
 word:dont know if thisll
 word:work
 $</code></pre>
<p class="calibre10">Ouch, that hurts. The shell saw the single quotation marks within the list values and attempted to use them to define a single data value, and it really messed things up in the process.</p>
<p class="calibre10"><span type="pagebreak" title="334" id="calibre_link-671" class="calibre11"></span>You have two ways to solve this problem:</p>
<ul class="calibre14">
<li class="calibre7">Use the escape character (the backslash) to escape the single quotation mark.</li>
<li class="calibre7">Use double quotation marks to define the values that use single quotation marks.</li>
</ul>
<p class="calibre10">Neither solution is all that fantastic, but each one helps solve the problem:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test2
 #!/bin/bash
 # another example of how not to use the for command
 for test in I don\'t know if "this'll" work
 do
    echo "word:$test"
 done
 $ ./test2
 word:I
 word:don't
 word:know
 word:if
 word:this'll
 word:work
 $</code></pre>
<p class="calibre10">In the first problem value, you added the backslash character to escape the single quotation mark in the <code class="calibre26">don't</code> value. In the second problem value, you enclosed the <code class="calibre26">this'll</code> value in double quotation marks. Both methods worked fine to distinguish the value.</p>
<p class="calibre10">Another problem you may run into is multi-word values. Remember that the <code class="calibre26">for</code> loop assumes that each value is separated with a space. If you have data values that contain spaces, you run into yet another problem:</p>
<pre class="calibre29"><code class="calibre26"> $ cat badtest2
 #!/bin/bash
 # another example of how not to use the for command
 for test in Nevada New Hampshire New Mexico New York North Carolina
 do
    echo "Now going to $test"
 done
 $ ./badtest1
 Now going to Nevada
 Now going to New
 Now going to Hampshire
 Now going to New
 Now going to Mexico
 Now going to New
 Now going to York
 Now going to North
 Now going to Carolina
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="335" id="calibre_link-672" class="calibre11"></span>Oops, that's not exactly what we wanted. The <code class="calibre26">for</code> command separates each value in the list with a space. If there are spaces in the individual data values, you must accommodate them using double quotation marks:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test3
 #!/bin/bash
 # an example of how to properly define values
 for test in Nevada "New Hampshire" "New Mexico" "New York"
 do
    echo "Now going to $test"
 done
 $ ./test3
 Now going to Nevada
 Now going to New Hampshire
 Now going to New Mexico
 Now going to New York
 $</code></pre>
<p class="calibre10">Now the <code class="calibre26">for</code> command can properly distinguish between the different values. Also, notice that when you use double quotation marks around a value, the shell doesn't include the quotation marks as part of the value.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading a list from a variable</h3>
<p class="calibre10">Often what happens in a shell script is that you accumulate a list of values stored in a variable and then need to iterate through the list. You can do this using the <code class="calibre26">for</code> command as well:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test4
 #!/bin/bash
 # using a variable to hold the list
 list="Alabama Alaska Arizona Arkansas Colorado"
 list=$list" Connecticut"
 for state in $list
 do
    echo "Have you ever visited $state?"
 done
 $ ./test4
 Have you ever visited Alabama?
 Have you ever visited Alaska?
 Have you ever visited Arizona?
 Have you ever visited Arkansas?
 Have you ever visited Colorado?
 Have you ever visited Connecticut?
 $</code></pre>
<p class="calibre10">The <code class="calibre26">$list</code> variable <span type="pagebreak" title="336" id="calibre_link-673" class="calibre11"></span>contains the standard text list of values to use for the iterations. Notice that the code also uses another assignment statement to add (or concatenate) an item to the existing list contained in the <code class="calibre26">$list</code> variable. This is a common method for adding text to the end of an existing text string stored in a variable.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading values from a command</h3>
<p class="calibre10">Another way to generate values for use in the list is to use the output of a command. You use command substitution to execute any command that produces output and then use the output of the command in the <code class="calibre26">for</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test5
 #!/bin/bash
 # reading values from a file
 file="states"
 for state in $(cat $file)
 do
    echo "Visit beautiful $state"
 done
 $ cat states
 Alabama
 Alaska
 Arizona
 Arkansas
 Colorado
 Connecticut
 Delaware
 Florida
 Georgia
 $ ./test5
 Visit beautiful Alabama
 Visit beautiful Alaska
 Visit beautiful Arizona
 Visit beautiful Arkansas
 Visit beautiful Colorado
 Visit beautiful Connecticut
 Visit beautiful Delaware
 Visit beautiful Florida
 Visit beautiful Georgia
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="337" id="calibre_link-674" class="calibre11"></span>This example uses the <code class="calibre26">cat</code> command in the command substitution to display the contents of the file states. Notice that the states file includes each state on a separate line, not separated by spaces. The <code class="calibre26">for</code> command still iterates through the output of the <code class="calibre26">cat</code> command one line at a time, assuming that each state is on a separate line. However, this doesn't solve the problem of having spaces in data. If you list a state with a space in it, the <code class="calibre26">for</code> command still takes each word as a separate value. There's a reason for this, which we look at in the next section.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">test5</code> code example assigned the filename to the variable using just the filename without a path. This requires that the file be in the same directory as the script. If this isn't the case, you need to use a full pathname (either absolute or relative) to reference the file location.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Changing the field separator</h3>
<p class="calibre10">The cause of this problem is the special environment variable IFS, called the <i class="calibre12">internal field separator</i>. The IFS environment variable defines a list of characters the bash shell uses as field separators. By default, the bash shell considers the following characters as field separators:</p>
<ul class="calibre14">
<li class="calibre7">A space</li>
<li class="calibre7">A tab</li>
<li class="calibre7">A newline</li>
</ul>
<p class="calibre10">If the bash shell sees any of these characters in the data, it assumes that you're starting a new data field in the list. When working with data that can contain spaces (such as filenames), this can be annoying, as you saw in the previous script example.</p>
<p class="calibre10">To solve this problem, you can temporarily change the IFS environment variable values in your shell script to restrict the characters the bash shell recognizes as field separators. For example, if you want to change the IFS value to recognize only the newline character, you need to do this:</p>
<pre class="calibre29"><code class="calibre26">IFS=$'\n'</code></pre>
<p class="calibre10">Adding this statement to your script tells the bash shell to ignore spaces and tabs in data values. Applying this technique to the previous script yields the following:</p>
<pre class="calibre29"><code class="calibre26">$ cat test5b
 #!/bin/bash
 # reading values from a file
 file="states"
 IFS=$'\n'
 for state in $(cat $file)
 do
    echo "Visit beautiful $state"
 done
 $ ./test5b
 Visit beautiful Alabama
 Visit beautiful Alaska
 Visit beautiful Arizona
 Visit beautiful Arkansas
 Visit beautiful Colorado
 Visit beautiful Connecticut
 Visit beautiful Delaware
 Visit beautiful Florida
 Visit beautiful Georgia
 Visit beautiful New York
 Visit beautiful New Hampshire
 Visit beautiful North Carolina
 $</code></pre>
<p class="calibre10">Now the shell script can use values in the list that contain spaces.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">When working on long scripts, it's possible to change the IFS value in one place, and then forget about it and assume the default value elsewhere in the script. A safe practice to get into is to save the original IFS value before changing it and then restore it when you're finished.</p>
<p class="calibre19">This technique can be coded like this:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"> IFS.OLD=$IFS</code>
<code class="calibre26"> IFS=$âânâ</code>
<code class="calibre26"> &lt;use the new IFS value in code&gt;</code>
<code class="calibre26"> IFS=$IFS.OLD</code></code></pre>
<p class="calibre19">This ensures that the IFS value is returned to the default value for future operations within the script.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="338" id="calibre_link-675" class="calibre11"></span>Other excellent applications of the IFS environment variable are possible. Suppose you want to iterate through values in a file that are separated by a colon (such as in the <code class="calibre26">/etc/passwd</code> file). You just need to set the IFS value to a colon:</p>
<pre class="calibre29"><code class="calibre26"> IFS=:</code></pre>
<p class="calibre10">If you want to specify more than one IFS character, just string them together on the assignment line:</p>
<pre class="calibre29"><code class="calibre26"> IFS=$'\n':;"</code></pre>
<p class="calibre10">This assignment uses the newline, colon, semicolon, and double quotation mark characters as field separators. There's no limit to how you can parse your data using the IFS characters.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading a directory using wildcards</h3>
<p class="calibre10">Finally, you can use the <code class="calibre26">for</code> command to <span type="pagebreak" title="339" id="calibre_link-676" class="calibre11"></span>automatically iterate through a directory of files. To do this, you must use a wildcard character in the file or pathname. This forces the shell to use <i class="calibre12">file globbing</i>. File globbing is the process of producing filenames or pathnames that match a specified wildcard character.</p>
<p class="calibre10">This feature is great for processing files in a directory when you don't know all the filenames:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test6
 #!/bin/bash
 # iterate through all the files in a directory
 for file in /home/rich/test/*
 do
    if [ -d "$file" ]
    then
       echo "$file is a directory"
    elif [ -f "$file" ]
    then
       echo "$file is a file"
    fi
 done
 $ ./test6
 /home/rich/test/dir1 is a directory
 /home/rich/test/myprog.c is a file
 /home/rich/test/myprog is a file
 /home/rich/test/myscript is a file
 /home/rich/test/newdir is a directory
 /home/rich/test/newfile is a file
 /home/rich/test/newfile2 is a file
 /home/rich/test/testdir is a directory
 /home/rich/test/testing is a file
 /home/rich/test/testprog is a file
 /home/rich/test/testprog.c is a file
 $</code></pre>
<p class="calibre10">The <code class="calibre26">for</code> command iterates through the results of the <code class="calibre26">/home/rich/test/*</code> listing. The code tests each entry using the <code class="calibre26">test</code> command (using the square bracket method) to see if it's a directory, using the <code class="calibre26">-d</code> parameter, or a file, using the <code class="calibre26">-f</code> parameter (See Chapter 12).</p>
<p class="calibre10">Notice in this example that we did something different in the <code class="calibre26">if</code> statement tests:</p>
<pre class="calibre29"><code class="calibre26"> if [ -d "$file" ]</code></pre>
<p class="calibre10"><span type="pagebreak" title="340" id="calibre_link-677" class="calibre11"></span>In Linux, it's perfectly legal to have directory and filenames that contain spaces. To accommodate that, you should enclose the <code class="calibre26">$file</code> variable in double quotation marks. If you don't, you'll get an error if you run into a directory or filename that contains spaces:</p>
<pre class="calibre29"><code class="calibre26"> ./test6: line 6: [: too many arguments
 ./test6: line 9: [: too many arguments</code></pre>
<p class="calibre10">The bash shell interprets the additional words as arguments within the <code class="calibre26">test</code> command, causing an error.</p>
<p class="calibre10">You can also combine both the directory search method and the list method in the same <code class="calibre26">for</code> statement by listing a series of directory wildcards in the <code class="calibre26">for</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test7
 #!/bin/bash
 # iterating through multiple directories
 for file in /home/rich/.b* /home/rich/badtest
 do
    if [ -d "$file" ]
    then
       echo "$file is a directory"
    elif [ -f "$file" ]
    then
       echo "$file is a file"
    else
      echo "$file doesn't exist"
    fi
 done
 $ ./test7
 /home/rich/.backup.timestamp is a file
 /home/rich/.bash_history is a file
 /home/rich/.bash_logout is a file
 /home/rich/.bash_profile is a file
 /home/rich/.bashrc is a file
 /home/rich/badtest doesn't exist
 $</code></pre>
<p class="calibre10">The <code class="calibre26">for</code> statement first uses file globbing to iterate through the list of files that result from the wildcard character; then it iterates through the next file in the list. You can combine any number of wildcard entries in the list to iterate through.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Notice that you can enter anything in the list data. Even if the file or directory doesn't exist, the <code class="calibre26">for</code> statement attempts to process whatever you place in the list. This can be a problem when working with files and directories. You have no way of knowing if you're trying to iterate through a nonexistent directory: It's always a good idea to test each file or directory before trying to process it.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-212" class="calibre4"></a>The C-Style for Command</h2>
<p class="calibre10"><span type="pagebreak" title="341" id="calibre_link-678" class="calibre11"></span>If you've done any programming using the C programming language, you're probably surprised by the way the bash shell uses the <code class="calibre26">for</code> command. In the C language, a <code class="calibre26">for</code> loop normally defines a variable, which it then alters automatically during each iteration. Typically, programmers use this variable as a counter and either increment or decrement the counter by one in each iteration. The bash <code class="calibre26">for</code> command can also provide this functionality. This section shows you how to use a C-style <code class="calibre26">for</code> command in a bash shell script.</p>
<section class="toclist">
<h3 class="calibre15">The C language for command</h3>
<p class="calibre10">The C language <code class="calibre26">for</code> command has a specific method for specifying a variable, a condition that must remain true for the iterations to continue, and a method for altering the variable for each iteration. When the specified condition becomes false, the <code class="calibre26">for</code> loop stops. The condition equation is defined using standard mathematical symbols. For example, consider the following C language code:</p>
<pre class="calibre29"><code class="calibre26"> for (i = 0; i &lt; 10; i++)
 {
    printf("The next number is %d\n", i);
 }</code></pre>
<p class="calibre10">This code produces a simple iteration loop, where the variable <code class="calibre26">i</code> is used as a counter. The first section assigns a default value to the variable. The middle section defines the condition under which the loop will iterate. When the defined condition becomes false, the <code class="calibre26">for</code> loop stops iterations. The last section defines the iteration process. After each iteration, the expression defined in the last section is executed. In this example, the <code class="calibre26">i</code> variable is incremented by one after each iteration.</p>
<p class="calibre10">The bash shell also supports a version of the <code class="calibre26">for</code> loop that looks similar to the C-style <code class="calibre26">for</code> loop, although it does have some subtle differences, including a couple of things that will confuse shell script programmers. Here's the basic format of the C-style bash <code class="calibre26">for</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> for (( <i class="calibre12">variable</i> <i class="calibre12">assignment</i> ; <i class="calibre12">condition</i> ; <i class="calibre12">iteration</i> <i class="calibre12">process</i> ))</code></pre>
<p class="calibre10">The format of the C-style <code class="calibre26">for</code> loop can be confusing for bash shell script programmers, because it uses C-style variable references instead of the shell-style variable references. Here's what a C-style <code class="calibre26">for</code> command looks like:</p>
<pre class="calibre29"><code class="calibre26"> for (( a = 1; a &lt; 10; a++ ))</code></pre>
<p class="calibre10">Notice that there are a couple of things that don't follow the standard bash shell <code class="calibre26">for</code> method:</p>
<ul class="calibre14">
<li class="calibre7">The assignment of the variable value can contain spaces.</li>
<li class="calibre7">The variable in the condition isn't preceded with a dollar sign.</li>
<li class="calibre7">The equation for the iteration process doesn't use the <code class="calibre26">expr</code> command format.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="342" id="calibre_link-679" class="calibre11"></span>The shell developers created this format to more closely resemble the C-style <code class="calibre26">for</code> command. Although this is great for C programmers, it can throw even expert shell programmers into a tizzy. Be careful when using the C-style <code class="calibre26">for</code> loop in your scripts.</p>
<p class="calibre10">Here's an example of using the C-style <code class="calibre26">for</code> command in a bash shell program:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test8
 #!/bin/bash
 # testing the C-style for loop
 for (( i=1; i &lt;= 10; i++ ))
 do
    echo "The next number is $i"
 done
 $ ./test8
 The next number is 1
 The next number is 2
 The next number is 3
 The next number is 4
 The next number is 5
 The next number is 6
 The next number is 7
 The next number is 8
 The next number is 9
 The next number is 10
 $</code></pre>
<p class="calibre10">The <code class="calibre26">for</code> loop iterates through the commands using the variable defined in the <code class="calibre26">for</code> loop (the letter <i class="calibre12">i</i> in this example). In each iteration, the <code class="calibre26">$i</code> variable contains the value assigned in the <code class="calibre26">for</code> loop. After each iteration, the loop iteration process is applied to the variable, which in this example, increments the variable by one.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using multiple variables</h3>
<p class="calibre10">The C-style <code class="calibre26">for</code> command also allows you to use multiple variables for the iteration. The loop handles each variable separately, allowing you to define a different iteration process for each variable. Although you can have multiple variables, you can define only one condition in the <code class="calibre26">for</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test9
 #!/bin/bash
 # multiple variables
 for (( a=1, b=10; a &lt;= 10; a++, b-- ))
 do
    echo "$a - $b"
 done
 $ ./test9
 1 - 10
 2 - 9
 3 - 8
 4 - 7
 5 - 6
 6 - 5
 7 - 4
 8 - 3
 9 - 2
 10 - 1
 $</code></pre>
<p class="calibre10">The <code class="calibre26">a</code> and <code class="calibre26">b</code> variables <span type="pagebreak" title="343" id="calibre_link-680" class="calibre11"></span>are each initialized with different values, and different iteration processes are defined. While the loop increases the <code class="calibre26">a</code> variable, it decreases the <code class="calibre26">b</code> variable for each iteration.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-213" class="calibre4"></a>The while Command</h2>
<p class="calibre10">The <code class="calibre26">while</code> command is somewhat of a cross between the <code class="calibre26">if-then</code> statement and the <code class="calibre26">for</code> loop. The <code class="calibre26">while</code> command allows you to define a command to test and then loop through a set of commands for as long as the defined test command returns a zero exit status. It tests the <code class="calibre26">test</code> command at the start of each iteration. When the <code class="calibre26">test</code> command returns a non-zero exit status, the <code class="calibre26">while</code> command stops executing the set of commands.</p>
<section class="toclist">
<h3 class="calibre15">Basic while format</h3>
<p class="calibre10">Here's fhe format of the <code class="calibre26">while</code> command:</p>
<pre class="calibre29"><code class="calibre26"> while <i class="calibre12">test command</i>
 do
  <i class="calibre12">other commands</i>
 done</code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">test command</i></code> defined in the <code class="calibre26">while</code> command is the exact same format as in <code class="calibre26">if-then</code> statements (see Chapter 12). As in the <code class="calibre26">if-then</code> statement, you can use any normal <code class="calibre26">bash</code> shell command, or you can use the <code class="calibre26">test</code> command to test for conditions, such as variable values.</p>
<p class="calibre10">The key to the <code class="calibre26">while</code> command is that the exit status of the <code class="calibre26"><i class="calibre12">test command</i></code> specified must change, based on the commands run during the loop. If the exit status never changes, the <code class="calibre26">while</code> loop will get stuck in an infinite loop.</p>
<p class="calibre10">The most common use of the <code class="calibre26"><i class="calibre12">test command</i></code> is to use brackets to check a value of a shell variable that's used in the loop commands:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test10
 #!/bin/bash
 # while command test
 var1=10
 while [ $var1 -gt 0 ]
 do
    echo $var1
    var1=$[ $var1 - 1 ]
 done
 $ ./test10
 10
 9
 8
 7
 6
 5
 4
 3
 2
 1
 $</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> command defines the test condition to check for each iteration:</p>
<pre class="calibre29"><code class="calibre26"> while [ $var1 -gt 0 ]
 </code></pre>
<p class="calibre10"><span type="pagebreak" title="344" id="calibre_link-681" class="calibre11"></span>As long as the test condition is true, the <code class="calibre26">while</code> command continues to loop through the commands defined. Within the commands, the variable used in the test condition must be modified, or you'll have an infinite loop. In this example, we use shell arithmetic to decrease the variable value by one:</p>
<pre class="calibre29"><code class="calibre26"> var1=$[ $var1 - 1 ]</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> loop stops when the test condition is no longer true.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using multiple test commands</h3>
<p class="calibre10">The <code class="calibre26">while</code> command allows you to define multiple test commands on the <code class="calibre26">while</code> statement line. Only the exit status of the last test command is used to determine when the loop stops. This can cause some interesting results if you're not careful. Here's an example of what we mean:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test11
 #!/bin/bash
 # testing a multicommand while loop
 var1=10
 while echo $var1
       [ $var1 -ge 0 ]
 do
    echo "This is inside the loop"
    var1=$[ $var1 - 1 ]
 done
 $ ./test11
 10
 This is inside the loop
 9
 This is inside the loop
 8
 This is inside the loop
 7
 This is inside the loop
 6
 This is inside the loop
 5
 This is inside the loop
 4
 This is inside the loop
 3
 This is inside the loop
 2
 This is inside the loop
 1
 This is inside the loop
 0
 This is inside the loop
 -1
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="345" id="calibre_link-682" class="calibre11"></span>Pay close attention to what happened in this example. Two test commands were defined in the <code class="calibre26">while</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> while echo $var1
       [ $var1 -ge 0 ]</code></pre>
<p class="calibre10">The first test simply displays the current value of the <code class="calibre26">var1</code> variable. The second test uses brackets to determine the value of the <code class="calibre26">var1</code> variable. Inside the loop, an <code class="calibre26">echo</code> statement displays a simple message, indicating that the loop was processed. Notice when you run the example how the output ends:</p>
<pre class="calibre29"><code class="calibre26"> This is inside the loop
 -1
 $
 </code></pre>
<p class="calibre10">The <code class="calibre26">while</code> loop executed the <code class="calibre26">echo</code> statement when the <code class="calibre26">var1</code> variable was equal to zero and then decreased the <code class="calibre26">var1</code> variable value. Next, the test commands were executed for <span type="pagebreak" title="346" id="calibre_link-683" class="calibre11"></span>the next iteration. The <code class="calibre26">echo</code> test command was executed, displaying the value of the <code class="calibre26">var1</code> variable, which is now less than zero. It's not until the shell executes the <code class="calibre26">test</code> test command that the <code class="calibre26">while</code> loop terminates.</p>
<p class="calibre10">This demonstrates that in a multi-command <code class="calibre26">while</code> statement, all the test commands are executed in each iteration, including the last iteration when the last test command fails. Be careful of this. Another thing to be careful of is how you specify the multiple test commands. Note that each test command is on a separate line!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-214" class="calibre4"></a>The until Command</h2>
<p class="calibre10">The <code class="calibre26">until</code> command works in exactly the opposite way from the <code class="calibre26">while</code> command. The <code class="calibre26">until</code> command requires that you specify a test command that normally produces a non-zero exit status. As long as the exit status of the test command is non-zero, the bash shell executes the commands listed in the loop. When the test command returns a zero exit status, the loop stops.</p>
<p class="calibre10">As you would expect, the format of the <code class="calibre26">until</code> command is:</p>
<pre class="calibre29"><code class="calibre26"> until test <i class="calibre12">commands</i>
 do
    <i class="calibre12">other commands</i>
 done</code></pre>
<p class="calibre10">Similar to the <code class="calibre26">while</code> command, you can have more than one <i class="calibre12">test command</i> in the <code class="calibre26">until</code> command statement. Only the exit status of the last command determines if the bash shell executes the <i class="calibre12">other commands</i> defined.</p>
<p class="calibre10">The following is an example of using the <code class="calibre26">until</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test12
 #!/bin/bash
 # using the until command
 var1=100
 until [ $var1 -eq 0 ]
 do
    echo $var1
    var1=$[ $var1 - 25 ]
 done
 $ ./test12
 100
 75
 50
 25
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="347" id="calibre_link-684" class="calibre11"></span>This example tests the <code class="calibre26">var1</code> variable to determine when the <code class="calibre26">until</code> loop should stop. As soon as the value of the variable is equal to zero, the <code class="calibre26">until</code> command stops the loop. The same caution as for the <code class="calibre26">while</code> command applies when you use multiple test commands with the <code class="calibre26">until</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test13
 #!/bin/bash
 # using the until command
 var1=100
 until echo $var1
       [ $var1 -eq 0 ]
 do
    echo Inside the loop: $var1
    var1=$[ $var1 - 25 ]
 done
 $ ./test13
 100
 Inside the loop: 100
 75
 Inside the loop: 75
 50
 Inside the loop: 50
 25
 Inside the loop: 25
 0
 $</code></pre>
<p class="calibre10">The shell executes the test commands specified and stops only when the last command is true.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-215" class="calibre4"></a>Nesting Loops</h2>
<p class="calibre10">A loop statement can use any other type of command within the loop, including other loop commands. This is called a <i class="calibre12">nested loop</i>. Care should be taken when using nested loops, because you're performing an iteration within an iteration, which multiplies the number of times commands are being run. If you don't pay close attention to this, it can cause problems in your scripts.</p>
<p class="calibre10">Here's a simple example of nesting a <code class="calibre26">for</code> loop inside another <code class="calibre26">for</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test14
 #!/bin/bash
 # nesting for loops
 for (( a = 1; a &lt;= 3; a++ ))
 do
    echo "Starting loop $a:"
    for (( b = 1; b &lt;= 3; b++ ))
    do
       echo "   Inside loop: $b"
    done
 done
 $ ./test14
 Starting loop 1:
    Inside loop: 1
    Inside loop: 2
    Inside loop: 3
 Starting loop 2:
    Inside loop: 1
    Inside loop: 2
    Inside loop: 3
 Starting loop 3:
    Inside loop: 1
    Inside loop: 2
    Inside loop: 3
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="348" id="calibre_link-685" class="calibre11"></span>The nested loop (also called the <i class="calibre12">inner loop</i>) iterates through its values for each iteration of the outer loop. Notice that there's no difference between the <code class="calibre26">do</code> and <code class="calibre26">done</code> commands for the two loops. The bash shell knows when the first <code class="calibre26">done</code> command is executed that it refers to the inner loop and not the outer loop.</p>
<p class="calibre10">The same applies when you mix loop commands, such as placing a <code class="calibre26">for</code> loop inside a <code class="calibre26">while</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test15
 #!/bin/bash
 # placing a for loop inside a while loop
 var1=5
 while [ $var1 -ge 0 ]
 do
    echo "Outer loop: $var1"
    for (( var2 = 1; $var2 &lt; 3; var2++ ))
    do
       var3=$[ $var1 * $var2 ]
       echo "  Inner loop: $var1 * $var2 = $var3"
    done
    var1=$[ $var1 - 1 ]
 done
 $ ./test15
 Outer loop: 5
   Inner loop: 5 * 1 = 5
   Inner loop: 5 * 2 = 10
 Outer loop: 4
   Inner loop: 4 * 1 = 4
   Inner loop: 4 * 2 = 8
 Outer loop: 3
   Inner loop: 3 * 1 = 3
   Inner loop: 3 * 2 = 6
 Outer loop: 2
   Inner loop: 2 * 1 = 2
   Inner loop: 2 * 2 = 4
 Outer loop: 1
   Inner loop: 1 * 1 = 1
   Inner loop: 1 * 2 = 2
 Outer loop: 0
   Inner loop: 0 * 1 = 0
   Inner loop: 0 * 2 = 0
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="349" id="calibre_link-686" class="calibre11"></span>Again, the shell distinguished between the <code class="calibre26">do</code> and <code class="calibre26">done</code> commands of the inner <code class="calibre26">for</code> loop from the same commands in the outer <code class="calibre26">while</code> loop.</p>
<p class="calibre10">If you really want to test your brain, you can even combine <code class="calibre26">until</code> and <code class="calibre26">while</code> loops:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test16
 #!/bin/bash
 # using until and while loops
 var1=3
 until [ $var1 -eq 0 ]
 do
    echo "Outer loop: $var1"
    var2=1
    while [ $var2 -lt 5 ]
    do
       var3=$(echo "scale=4; $var1 / $var2" | bc)
       echo "   Inner loop: $var1 / $var2 = $var3"
       var2=$[ $var2 + 1 ]
    done
    var1=$[ $var1 - 1 ]
 done
 $ ./test16
 Outer loop: 3
    Inner loop: 3 / 1 = 3.0000
    Inner loop: 3 / 2 = 1.5000
    Inner loop: 3 / 3 = 1.0000
    Inner loop: 3 / 4 = .7500
 Outer loop: 2
    Inner loop: 2 / 1 = 2.0000
    Inner loop: 2 / 2 = 1.0000
    Inner loop: 2 / 3 = .6666
    Inner loop: 2 / 4 = .5000
 Outer loop: 1
    Inner loop: 1 / 1 = 1.0000
    Inner loop: 1 / 2 = .5000
    Inner loop: 1 / 3 = .3333
    Inner loop: 1 / 4 = .2500
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="350" id="calibre_link-687" class="calibre11"></span>The outer <code class="calibre26">until</code> loop starts with a value of 3 and continues until the value equals 0. The inner <code class="calibre26">while</code> loop starts with a value of 1 and continues as long as the value is less than 5. Each loop must change the value used in the test condition, or the loop will get stuck infinitely.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-216" class="calibre4"></a>Looping on File Data</h2>
<p class="calibre10">Often, you must iterate through items stored inside a file. This requires combining two of the techniques covered:</p>
<ul class="calibre14">
<li class="calibre7">Using nested loops</li>
<li class="calibre7">Changing the <code class="calibre26">IFS</code> environment variable</li>
</ul>
<p class="calibre10">By changing the <code class="calibre26">IFS</code> environment variable, you can force the <code class="calibre26">for</code> command to handle each line in the file as a separate item for processing, even if the data contains spaces. After you've extracted an individual line in the file, you may have to loop again to extract data contained within it.</p>
<p class="calibre10">The classic example of this is processing data in the <code class="calibre26">/etc/passwd</code> file. This requires that you iterate through the <code class="calibre26">/etc/passwd</code> file line by line and then change the <code class="calibre26">IFS</code> variable value to a colon so you can separate the individual components in each line.</p>
<p class="calibre10">The following is an example of doing just that:</p>
<pre class="calibre29"><code class="calibre26"> #!/bin/bash
 # changing the IFS value
 IFS.OLD=$IFS
 IFS=$'\n'
 for entry in $(cat /etc/passwd)
 do
    echo "Values in $entry &ndash;"
    IFS=:
    for value in $entry
    do
       echo "   $value"
    done
 done
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="351" id="calibre_link-688" class="calibre11"></span>This script uses two different <code class="calibre26">IFS</code> values to parse the data. The first <code class="calibre26">IFS</code> value parses the individual lines in the <code class="calibre26">/etc/passwd</code> file. The inner <code class="calibre26">for</code> loop next changes the <code class="calibre26">IFS</code> value to the colon, which allows you to parse the individual values within the <code class="calibre26">/etc/passwd</code> lines.</p>
<p class="calibre10">When you run this script, you get output something like this:</p>
<pre class="calibre29"><code class="calibre26"> Values in rich:x:501:501:Rich Blum:/home/rich:/bin/bash -
    rich
    x
    501
    501
    Rich Blum
    /home/rich
    /bin/bash
 Values in katie:x:502:502:Katie Blum:/home/katie:/bin/bash -
    katie
    x
    506
    509
    Katie Blum
    /home/katie
    /bin/bash</code></pre>
<p class="calibre10">The inner loop parses each individual value in the <code class="calibre26">/etc/passwd</code> entry. This is also a great way to process comma-separated data, a common way to import spreadsheet data.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-217" class="calibre4"></a>Controlling the Loop</h2>
<p class="calibre10">You might be tempted to think that after you start a loop, you're stuck until the loop finishes all its iterations. This is not true. A couple of commands help us control what happens inside of a loop:</p>
<ul class="calibre14">
<li class="calibre7">The <code class="calibre26">break</code> command</li>
<li class="calibre7">The <code class="calibre26">continue</code> command</li>
</ul>
<p class="calibre10">Each command has a different use in how to control the operation of a loop. The following sections describe how you can use these commands to control the operation of your loops.</p>
<section class="toclist">
<h3 class="calibre15">The break command</h3>
<p class="calibre10">The <code class="calibre26">break</code> command is a simple way to escape a loop in progress. You can use the <code class="calibre26">break</code> command to exit any type of loop, including <code class="calibre26">while</code> and <code class="calibre26">until</code> loops.</p>
<p class="calibre10">You can use the <code class="calibre26">break</code> command in several situations. This section shows each of these methods.</p>
<section class="toclist">
<h4 class="calibre25">Breaking out of a single loop</h4>
<p class="calibre10">When the shell executes a <code class="calibre26">break</code> command, it attempts to break out of the loop that's currently processing:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test17
 #!/bin/bash
 # breaking out of a for loop
 for var1 in 1 2 3 4 5 6 7 8 9 10
 do
    if [ $var1 -eq 5 ]
    then
       break
    fi
    echo "Iteration number: $var1"
 done
 echo "The for loop is completed"
 $ ./test17
 Iteration number: 1
 Iteration number: 2
 Iteration number: 3
 Iteration number: 4
 The for loop is completed
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="352" id="calibre_link-689" class="calibre11"></span>The <code class="calibre26">for</code> loop should normally have iterated through all the values specified in the list. However, when the <code class="calibre26">if-then</code> condition was satisfied, the shell executed the <code class="calibre26">break</code> command, which stopped the <code class="calibre26">for</code> loop.</p>
<p class="calibre10">This technique also works for <code class="calibre26">while</code> and <code class="calibre26">until</code> loops:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test18
 #!/bin/bash
 # breaking out of a while loop
 var1=1
 while [ $var1 -lt 10 ]
 do
    if [ $var1 -eq 5 ]
    then
       break
    fi
    echo "Iteration: $var1"
    var1=$[ $var1 + 1 ]
 done
 echo "The while loop is completed"
 $ ./test18
 Iteration: 1
 Iteration: 2
 Iteration: 3
 Iteration: 4
 The while loop is completed
 $</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> loop terminated when the <code class="calibre26">if-then</code> condition was met, executing the <code class="calibre26">break</code> command.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Breaking out of an inner loop</h4>
<p class="calibre10"><span type="pagebreak" title="353" id="calibre_link-690" class="calibre11"></span>When you're working with multiple loops, the <code class="calibre26">break</code> command automatically terminates the innermost loop you're in:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test19
 #!/bin/bash
 # breaking out of an inner loop
 for (( a = 1; a &lt; 4; a++ ))
 do
    echo "Outer loop: $a"
    for (( b = 1; b &lt; 100; b++ ))
    do
       if [ $b -eq 5 ]
       then
          break
       fi
       echo "   Inner loop: $b"
    done
 done
 $ ./test19
 Outer loop: 1
    Inner loop: 1
    Inner loop: 2
    Inner loop: 3
    Inner loop: 4
 Outer loop: 2
    Inner loop: 1
    Inner loop: 2
    Inner loop: 3
    Inner loop: 4
 Outer loop: 3
    Inner loop: 1
    Inner loop: 2
    Inner loop: 3
    Inner loop: 4
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="354" id="calibre_link-691" class="calibre11"></span>The <code class="calibre26">for</code> statement in the inner loop specifies to iterate until the <code class="calibre26">b</code> variable is equal to 100. However, the <code class="calibre26">if-then</code> statement in the inner loop specifies that when the <code class="calibre26">b</code> variable value is equal to 5, the <code class="calibre26">break</code> command is executed. Notice that even though the inner loop is terminated with the <code class="calibre26">break</code> command, the outer loop continues working as specified.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Breaking out of an outer loop</h4>
<p class="calibre10">There may be times when you're in an inner loop but need to stop the outer loop. The <code class="calibre26">break</code> command includes a single command line parameter value:</p>
<pre class="calibre29"><code class="calibre26"> break <i class="calibre12">n</i></code></pre>
<p class="calibre10">where <i class="calibre12">n</i> indicates the level of the loop to break out of. By default, <i class="calibre12">n</i> is 1, indicating to break out of the current loop. If you set <i class="calibre12">n</i> to a value of 2, the <code class="calibre26">break</code> command stops the next level of the outer loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test20
 #!/bin/bash
 # breaking out of an outer loop
 for (( a = 1; a &lt; 4; a++ ))
 do
    echo "Outer loop: $a"
    for (( b = 1; b &lt; 100; b++ ))
    do
       if [ $b -gt 4 ]
       then
          break 2
       fi
       echo "   Inner loop: $b"
    done
 done
 $ ./test20
 Outer loop: 1
    Inner loop: 1
    Inner loop: 2
    Inner loop: 3
    Inner loop: 4
 $</code></pre>
<p class="calibre10">Now when the shell executes the <code class="calibre26">break</code> command, the outer loop stops.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The continue command</h3>
<p class="calibre10"><span type="pagebreak" title="355" id="calibre_link-692" class="calibre11"></span>The <code class="calibre26">continue</code> command is a way to prematurely stop processing commands inside of a loop but not terminate the loop completely. This allows you to set conditions within a loop where the shell won't execute commands. Here's a simple example of using the <code class="calibre26">continue</code> command in a <code class="calibre26">for</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test21
 #!/bin/bash
 # using the continue command
 for (( var1 = 1; var1 &lt; 15; var1++ ))
 do
    if [ $var1 -gt 5 ] &amp;&amp; [ $var1 -lt 10 ]
    then
       continue
    fi
    echo "Iteration number: $var1"
 done
 $ ./test21
 Iteration number: 1
 Iteration number: 2
 Iteration number: 3
 Iteration number: 4
 Iteration number: 5
 Iteration number: 10
 Iteration number: 11
 Iteration number: 12
 Iteration number: 13
 Iteration number: 14
 $</code></pre>
<p class="calibre10">When the conditions of the <code class="calibre26">if-then</code> statement are met (the value is greater than 5 and less than 10), the shell executes the <code class="calibre26">continue</code> command, which skips the rest of the commands in the loop, but keeps the loop going. When the <code class="calibre26">if-then</code> condition is no longer met, things return to normal.</p>
<p class="calibre10">You can use the <code class="calibre26">continue</code> command in <code class="calibre26">while</code> and <code class="calibre26">until</code> loops, but be extremely careful with what you're doing. Remember that when the shell executes the <code class="calibre26">continue</code> command, it skips the remaining commands. If you're incrementing your test condition variable in one of those conditions, bad things happen:</p>
<pre class="calibre29"><code class="calibre26"> $ cat badtest3
 #!/bin/bash
 # improperly using the continue command in a while loop
 var1=0
 while echo "while iteration: $var1"
       [ $var1 -lt 15 ]
 do
    if [ $var1 -gt 5 ] &amp;&amp; [ $var1 -lt 10 ]
    then
       continue
    fi
    echo "   Inside iteration number: $var1"
    var1=$[ $var1 + 1 ]
 done
 $ ./badtest3 | more
 while iteration: 0
    Inside iteration number: 0
 while iteration: 1
    Inside iteration number: 1
 while iteration: 2
    Inside iteration number: 2
 while iteration: 3
    Inside iteration number: 3
 while iteration: 4
    Inside iteration number: 4
 while iteration: 5
    Inside iteration number: 5
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 while iteration: 6
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="356" id="calibre_link-693" class="calibre11"></span>You'll want to make sure you redirect the output of this script to the <code class="calibre26">more</code> command so you can stop things. Everything seems to be going just fine until the <code class="calibre26">if-then</code> condition is met, and the shell executes the <code class="calibre26">continue</code> command. When the shell executes the <code class="calibre26">continue</code> command, it skips the remaining commands in the <code class="calibre26">while</code> loop. Unfortunately, that's where the <code class="calibre26">$var1</code> counter variable that is tested in the <code class="calibre26">while</code> test command is incremented. That means that the variable isn't incremented, as you can see from the continually displaying output.</p>
<p class="calibre10">As with the <code class="calibre26">break</code> command, the <code class="calibre26">continue</code> command allows you to specify what level of loop to continue with a command line parameter:</p>
<pre class="calibre29"><code class="calibre26"> continue <i class="calibre12">n</i></code></pre>
<p class="calibre10">where <i class="calibre12">n</i> defines the loop level to continue. Here's an example of continuing an outer <code class="calibre26">for</code> loop:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test22
 #!/bin/bash
 # continuing an outer loop
 for (( a = 1; a &lt;= 5; a++ ))
 do
    echo "Iteration $a:"
    for (( b = 1; b &lt; 3; b++ ))
    do
       if [ $a -gt 2 ] &amp;&amp; [ $a -lt 4 ]
       then
          continue 2
       fi
       var3=$[ $a * $b ]
       echo "   The result of $a * $b is $var3"
    done
 done
 $ ./test22
 Iteration 1:
    The result of 1 * 1 is 1
    The result of 1 * 2 is 2
 Iteration 2:
    The result of 2 * 1 is 2
    The result of 2 * 2 is 4
 Iteration 3:
 Iteration 4:
    The result of 4 * 1 is 4
    The result of 4 * 2 is 8
 Iteration 5:
    The result of 5 * 1 is 5
    The result of 5 * 2 is 10
 $</code></pre>
<p class="calibre10">The <code class="calibre26">if-then</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> if [ $a -gt 2 ] &amp;&amp; [ $a -lt 4 ]
       then
          continue 2
       fi</code></pre>
<p class="calibre10">uses the <code class="calibre26">continue</code> command to <span type="pagebreak" title="357" id="calibre_link-694" class="calibre11"></span>stop processing the commands inside the loop but continue the outer loop. Notice in the script output that the iteration for the value 3 doesn't process any inner loop statements, because the <code class="calibre26">continue</code> command stopped the processing, but it continues with the outer loop processing.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-218" class="calibre4"></a>Processing the Output of a Loop</h2>
<p class="calibre10"><span type="pagebreak" title="358" id="calibre_link-695" class="calibre11"></span>Finally, you can either pipe or redirect the output of a loop within your shell script. You do this by adding the processing command to the end of the <code class="calibre26">done</code> command:</p>
<pre class="calibre29"><code class="calibre26"> for file in /home/rich/*
  do
    if [ -d "$file" ]
    then
       echo "$file is a directory"
    elif
       echo "$file is a file"
    fi
 done &gt; output.txt</code></pre>
<p class="calibre10">Instead of displaying the results on the monitor, the shell redirects the results of the <code class="calibre26">for</code> command to the file <code class="calibre26">output.txt</code>.</p>
<p class="calibre10">Consider the following example of redirecting the output of a <code class="calibre26">for</code> command to a file:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test23
 #!/bin/bash
 # redirecting the for output to a file
 for (( a = 1; a &lt; 10; a++ ))
 do
    echo "The number is $a"
 done &gt; test23.txt
 echo "The command is finished."
 $ ./test23
 The command is finished.
 $ cat test23.txt
 The number is 1
 The number is 2
 The number is 3
 The number is 4
 The number is 5
 The number is 6
 The number is 7
 The number is 8
 The number is 9
 $</code></pre>
<p class="calibre10">The shell creates the file <code class="calibre26">test23.txt</code> and redirects the output of the <code class="calibre26">for</code> command only to the file. The shell displays the <code class="calibre26">echo</code> statement after the <code class="calibre26">for</code> command just as normal.</p>
<p class="calibre10">This same technique also works for piping the output of a loop to another command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test24
 #!/bin/bash
 # piping a loop to another command
 for state in "North Dakota" Connecticut Illinois Alabama Tennessee
 do
    echo "$state is the next place to go"
 done | sort
 echo "This completes our travels"
 $ ./test24
 Alabama is the next place to go
 Connecticut is the next place to go
 Illinois is the next place to go
 North Dakota is the next place to go
 Tennessee is the next place to go
 This completes our travels
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="359" id="calibre_link-696" class="calibre11"></span>The state values aren't listed in any particular order in the <code class="calibre26">for</code> command list. The output of the <code class="calibre26">for</code> command is piped to the <code class="calibre26">sort</code> command, which changes the order of the <code class="calibre26">for</code> command output. Running the script indeed shows that the output was properly sorted within the script.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-219" class="calibre4"></a>Practical Examples</h2>
<p class="calibre10">Now that you've seen how to use the different ways to create loops in shell scripts, let's look at some practical examples of how to use them. Looping is a common way to iterate through data on the system, whether it's files in folders or data contained in a file. Here are a couple of examples that demonstrate using simple loops to work with data.</p>
<section class="toclist">
<h3 class="calibre15">Finding executable files</h3>
<p class="calibre10">When you run a program from the command line, the Linux system searches a series of folders looking for that file. Those folders are defined in the <code class="calibre26">PATH</code> environment variable. If you want to find out just what executable files are available on your system for you to use, just scan all the folders in the <code class="calibre26">PATH</code> environment variable. That may take some time to do manually, but it's a breeze working out a small shell script to do that.</p>
<p class="calibre10">The first step is to create a <code class="calibre26">for</code> loop to iterate through the folders stored in the <code class="calibre26">PATH</code> environment variable. When you do that, don't forget to set the <code class="calibre26">IFS</code> separator character:</p>
<pre class="calibre29"><code class="calibre26">IFS=:
for folder in $PATH
do</code></pre>
<p class="calibre10">Now that you have the individual folders in the <code class="calibre26">$folder</code> variable, you can use another <code class="calibre26">for</code> loop to iterate through all the files inside that particular folder:</p>
<pre class="calibre29"><code class="calibre26">for file in $folder/*
do</code></pre>
<p class="calibre10"><span type="pagebreak" title="360" id="calibre_link-697" class="calibre11"></span>The last step is to check whether the individual files have the executable permission set, which you can do using the <code class="calibre26">if-then</code> test feature:</p>
<pre class="calibre29"><code class="calibre26">if [ -x $file ]
then
   echo "   $file"
fi</code></pre>
<p class="calibre10">And there you have it! Putting all the pieces together into a script looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ cat test25
#!/bin/bash
# finding files in the PATH
IFS=:
for folder in $PATH
do
   echo "$folder:"
   for file in $folder/*
   do
      if [ -x $file ]
      then
         echo "   $file"
      fi
   done
done
$</code></pre>
<p class="calibre10">When you run the code, you get a listing of the executable files that you can use from the command line:</p>
<pre class="calibre29"><code class="calibre26">$ ./test25 | more
/usr/local/bin:
/usr/bin:
   /usr/bin/Mail
   /usr/bin/Thunar
   /usr/bin/X
   /usr/bin/Xorg
   /usr/bin/[
   /usr/bin/a2p
   /usr/bin/abiword
   /usr/bin/ac
   /usr/bin/activation-client
   /usr/bin/addr2line
...</code></pre>
<p class="calibre10">The output shows all the executable files found in all the folders defined in the <code class="calibre26">PATH</code> environment variable, which is quite a few!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating multiple user accounts</h3>
<p class="calibre10"><span type="pagebreak" title="361" id="calibre_link-698" class="calibre11"></span>The goal of shell scripts is to make life easier for the system administrator. If you happen to work in an environment with lots of users, one of the most boring tasks can be creating new user accounts. Fortunately, you can use the <code class="calibre26">while</code> loop to make your job a little easier!</p>
<p class="calibre10">Instead of having to manually enter <code class="calibre26">useradd</code> commands for every new user account you need to create, you can place the new user accounts in a text file and create a simple shell script to do that work for you. The format of the text file that we'll use looks like this:</p>
<pre class="calibre29"><code class="calibre26">userid,user name</code></pre>
<p class="calibre10">The first entry is the userid you want to use for the new user account. The second entry is the full name of the user. The two values are separated by a comma, making this a comma-separated file format, or .csv. This is a very common file format used in spreadsheets, so you can easily create the user account list in a spreadsheet program and save it in .csv format for your shell script to read and process.</p>
<p class="calibre10">To read the file data, we're going to use a little shell scripting trick. We'll actually set the <code class="calibre26">IFS</code> separator character to a comma as the test part of the <code class="calibre26">while</code> statement. Then to read the individual lines, we'll use the <code class="calibre26">read</code> command. That looks like this:</p>
<pre class="calibre29"><code class="calibre26">while IFS=',' read &ndash;r userid name </code></pre>
<p class="calibre10">The <code class="calibre26">read</code> command does the work of moving onto the next line of text in the .csv text file, so we don't need another loop to do that. The <code class="calibre26">while</code> command exits when the read command returns a <code class="calibre26">FALSE</code> value, which happens when it runs out of lines to read in the file. Tricky!</p>
<p class="calibre10">To feed the data from the file into the <code class="calibre26">while</code> command, you just use a redirection symbol at the end of the <code class="calibre26">while</code> command.</p>
<p class="calibre10">Putting everything together results in this script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test26
#!/bin/bash
# process new user accounts
input="users.csv"
while IFS=',' read -r userid name
do
  echo "adding $userid"
  useradd -c "$name" -m $userid
done &lt; "$input"
$</code></pre>
<p class="calibre10">The <code class="calibre26">$input</code> variable points to the data file and is used as the redirect data for the <code class="calibre26">while</code> command. The users.csv file looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ cat users.csv
rich,Richard Blum
christine,Christine Bresnahan
barbara,Barbara Blum
tim,Timothy Bresnahan
$</code></pre>
<p class="calibre10">To run the problem, you must be the root user account, because the <code class="calibre26">useradd</code> command requires root privileges:</p>
<pre class="calibre29"><code class="calibre26"># ./test26
adding rich
adding christine
adding barbara
adding tim
# </code></pre>
<p class="calibre10">Then by taking a quick look at the <code class="calibre26">/etc/passwd</code> file, you can see that the accounts have been created:</p>
<pre class="calibre29"><code class="calibre26"># tail /etc/passwd
rich:x:1001:1001:Richard Blum:/home/rich:/bin/bash
christine:x:1002:1002:Christine Bresnahan:/home/christine:/bin/bash
barbara:x:1003:1003:Barbara Blum:/home/barbara:/bin/bash
tim:x:1004:1004:Timothy Bresnahan:/home/tim:/bin/bash
#</code></pre>
<p class="calibre10">Congratulations, you've saved yourself lots of time in adding user accounts!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-220" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="362" id="calibre_link-699" class="calibre11"></span>Looping is an integral part of programming. The bash shell provides three looping commands that you can use in your scripts.</p>
<p class="calibre10">The <code class="calibre26">for</code> command allows you to iterate through a list of values, either supplied within the command line, contained in a variable, or obtained by using file globbing, to extract file and directory names from a wildcard character.</p>
<p class="calibre10">The <code class="calibre26">while</code> command provides a method to loop based on the condition of a command, using either ordinary commands or the test command, which allows you to test conditions of variables. As long as the command (or condition) produces a zero exit status, the <code class="calibre26">while</code> loop continues to iterate through the specified set of commands.</p>
<p class="calibre10">The <code class="calibre26">until</code> command also provides a method to iterate through commands, but it bases its iterations on a command (or condition) producing a non-zero exit status. This feature allows you to set a condition that must be met before the iteration stops.</p>
<p class="calibre10"><span type="pagebreak" title="363" id="calibre_link-700" class="calibre11"></span>You can combine loops in shell scripts, producing multiple layers of loops. The bash shell provides the <code class="calibre26">continue</code> and <code class="calibre26">break</code> commands, which allow you to alter the flow of the normal loop process based on different values within the loop.</p>
<p class="calibre10">The bash shell also allows you to use standard command redirection and piping to alter the output of a loop. You can use redirection to redirect the output of a loop to a file or piping to redirect the output of a loop to another command. This provides a wealth of features with which you can control your shell script execution.</p>
<p class="calibre10">The next chapter discusses how to interact with your shell script user. Often, shell scripts aren't completely self-contained. They require some sort of external data that must be supplied at the time you run them. The next chapter discusses different methods with which you can provide real-time data to your shell scripts for processing.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1176">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-221" class="calibre4"></a><span class="chaptertitle">Chapter 14</span><br class="calibre22" /><span class="chaptertitle">Handling User Input</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Passing parameters</li>
<li class="calibre7">Tracking parameters</li>
<li class="calibre7">Being shifty</li>
<li class="calibre7">Working with options</li>
<li class="calibre7">Standardizing options</li>
<li class="calibre7">Getting user input</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="365" id="calibre_link-701" class="calibre11"></span>So far you've seen how to write scripts that interact with data, variables, and files on the Linux system. Sometimes, you need to write a script that has to interact with the person running the script. The bash shell provides a few different methods for retrieving data from people, including command line parameters (data values added after the command), command line options (single-letter values that modify the behavior of the command), and the capability to read input directly from the keyboard. This chapter discusses how to incorporate these different methods into your bash shell scripts to obtain data from the person running your script.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-222" class="calibre4"></a>Passing Parameters</h2>
<p class="calibre10">The most basic method of passing data to your shell script is to use <i class="calibre12">command line parameters</i>. Command line parameters allow you to add data values to the command line when you execute the script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./addem 10 30</b></code></code></pre>
<p class="calibre10">This example passes two command line parameters (<code class="calibre26">10</code> and <code class="calibre26">30</code>) to the script <code class="calibre26">addem</code>. The script handles the command line parameters using special variables. The following sections describe how to use command line parameters in your bash shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Reading parameters</h3>
<p class="calibre10"><span type="pagebreak" title="366" id="calibre_link-702" class="calibre11"></span>The bash shell assigns special variables, called <i class="calibre12">positional parameters,</i> to all of the command line parameters entered. This includes the name of the script the shell is executing. The positional parameter variables are standard numbers, with <code class="calibre26"><i class="calibre12">$0</i></code> being the script's name, <code class="calibre26"><i class="calibre12">$1</i></code> being the first parameter, <code class="calibre26"><i class="calibre12">$2</i></code> being the second parameter, and so on, up to <code class="calibre26"><i class="calibre12">$9</i></code> for the ninth parameter.</p>
<p class="calibre10">Here's a simple example of using one command line parameter in a shell script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test1.sh</b></code>
#!/bin/bash
# using one command line parameter
#
factorial=1
for (( number = 1; number &lt;= $1 ; number++ ))
do
   factorial=$[ $factorial * $number ]
done
echo The factorial of $1 is $factorial
$
$ <code class="calibre26"><b class="calibre21">./test1.sh 5</b></code>
The factorial of 5 is 120
$</code></pre>
<p class="calibre10">You can use the <code class="calibre26"><i class="calibre12">$1</i></code> variable just like any other variable in the shell script. The shell script automatically assigns the value from the command line parameter to the variable; you don't need to do anything with it.</p>
<p class="calibre10">If you need to enter more command line parameters, each parameter must be separated by a space on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test2.sh</b></code>
#!/bin/bash
# testing two command line parameters
#
total=$[ $1 * $2 ]
echo The first parameter is $1.
echo The second parameter is $2.
echo The total value is $total.
$
$ <code class="calibre26"><b class="calibre21">./test2.sh 2 5</b></code>
The first parameter is 2.
The second parameter is 5.
The total value is 10.
$</code></pre>
<p class="calibre10">The shell assigns each parameter to the appropriate variable.</p>
<p class="calibre10"><span type="pagebreak" title="367" id="calibre_link-703" class="calibre11"></span>In the preceding example, the command line parameters used were both numerical values. You can also use text strings in the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test3.sh</b></code>
#!/bin/bash
# testing string parameters
#
echo Hello $1, glad to meet you.
$
$ <code class="calibre26"><b class="calibre21">./test3.sh Rich</b></code>
Hello Rich, glad to meet you.
$</code></pre>
<p class="calibre10">The shell passes the string value entered into the command line to the script. However, you'll have a problem if you try to do this with a text string that contains spaces:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test3.sh Rich Blum</b></code>
Hello Rich, glad to meet you.
$</code></pre>
<p class="calibre10">Remember that each of the parameters is separated by a space, so the shell interpreted the space as just separating the two values. To include a space as a parameter value, you must use quotation marks (either single or double quotation marks):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test3.sh 'Rich Blum'</b></code>
Hello Rich Blum, glad to meet you.
$
$ <code class="calibre26"><b class="calibre21">./test3.sh "Rich Blum"</b></code>
Hello Rich Blum, glad to meet you.
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The quotation marks used when you pass text strings as parameters are not part of the data. They just delineate the beginning and the end of the data.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">If your script needs more than nine command line parameters, you can continue, but the variable names change slightly. After the ninth variable, you must use braces around the variable number, such as <code class="calibre26"><i class="calibre12">${10}</i></code>. Here's an example of doing that:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test4.sh</b></code>
#!/bin/bash
# handling lots of parameters
#
total=$[ ${10} * ${11} ]
echo The tenth parameter is ${10}
echo The eleventh parameter is ${11}
echo The total is $total
$
$ <code class="calibre26"><b class="calibre21">./test4.sh 1 2 3 4 5 6 7 8 9 10 11 12</b></code>
The tenth parameter is 10
The eleventh parameter is 11
The total is 110
$</code></pre>
<p class="calibre10">This technique allows you to add as many command line parameters to your scripts as you could possibly need.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading the script name</h3>
<p class="calibre10">You <span type="pagebreak" title="368" id="calibre_link-704" class="calibre11"></span>can use the <code class="calibre26"><i class="calibre12">$0</i></code> parameter to determine the script name the shell started from the command line. This can come in handy if you're writing a utility that can have multiple functions.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test5.sh</b></code>
#!/bin/bash
# Testing the $0 parameter
#
echo The zero parameter is set to: $0
#
$
$ <code class="calibre26"><b class="calibre21">bash test5.sh</b></code>
The zero parameter is set to: test5.sh
$</code></pre>
<p class="calibre10">However, there is a potential problem. When using a different command to run the shell script, the command becomes entangled with the script name in the <code class="calibre26">$0</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test5.sh</b></code>
The zero parameter is set to: ./test5.sh
$</code></pre>
<p class="calibre10">There is another potential problem. When the actual string passed is the full script path, and not just the script's name, the <code class="calibre26">$0</code> variable gets set to the full script path and name:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">bash /home/Christine/test5.sh</b></code>
The zero parameter is set to: /home/Christine/test5.sh
$</code></pre>
<p class="calibre10">If you want to write a script that performs different functions based on just the script's name, you'll have to do a little work. You need to be able to strip off whatever path is used to run the script. Also, you need to be able to remove any entangled commands from the script.</p>
<p class="calibre10">Fortunately, there's a handy little command available that does just that. The <code class="calibre26">basename</code> command returns just the script's name without the path:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test5b.sh</b></code>
#!/bin/bash
# Using basename with the $0 parameter
#
name=$(basename $0)
echo
echo The script name is: $name
#
$ <code class="calibre26"><b class="calibre21">bash /home/Christine/test5b.sh</b></code>
The script name is: test5b.sh
$
$ <code class="calibre26"><b class="calibre21">./test5b.sh</b></code>
The script name is: test5b.sh
$</code></pre>
<p class="calibre10">Now that's much better. You can use this <span type="pagebreak" title="369" id="calibre_link-705" class="calibre11"></span>technique to write scripts that perform different functions based on the script name used. Here's a simple example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test6.sh</b></code>
#!/bin/bash
# Testing a Multi-function script
#
name=$(basename $0)
#
if [ $name = "addem" ]
then
   total=$[ $1 + $2 ]
#
elif [ $name = "multem" ]
then
   total=$[ $1 * $2 ]
fi
#
echo
echo The calculated value is $total
#
$
$ <code class="calibre26"><b class="calibre21">cp test6.sh addem</b></code>
$ <code class="calibre26"><b class="calibre21">chmod u+x addem</b></code>
$
$ <code class="calibre26"><b class="calibre21">ln -s test6.sh multem</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l *em</b></code>
-rwxrw-r--. 1 Christine Christine 224 Jun 30 23:50 addem
lrwxrwxrwx. 1 Christine Christine   8 Jun 30 23:50 multem -&gt; test6.sh
$
$ <code class="calibre26"><b class="calibre21">./addem 2 5</b></code>
The calculated value is 7
$
$ <code class="calibre26"><b class="calibre21">./multem 2 5</b></code>
The calculated value is 10
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="370" id="calibre_link-706" class="calibre11"></span>The example creates two separate filenames from the <code class="calibre26">test6.sh</code> script, one by just copying the file to a new script (<code class="calibre26">addem</code>) and the other by using a symbolic link (see Chapter 3) to create the new script (<code class="calibre26">multem</code>). In both cases, the script determines the script's base name and performs the appropriate function based on that value.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Testing parameters</h3>
<p class="calibre10">Be careful when using command line parameters in your shell scripts. If the script is run without the parameters, bad things can happen:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./addem 2</b></code>
./addem: line 8: 2 +  : syntax error: operand expected (error
 token is " ")
The calculated value is
$</code></pre>
<p class="calibre10">When the script assumes there is data in a parameter variable, and no data is present, most likely you'll get an error message from your script. This is a poor way to write scripts. Always check your parameters to make sure the data is there before using it:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test7.sh</b></code>
#!/bin/bash
# testing parameters before use
#
if [ -n "$1" ]
then
   echo Hello $1, glad to meet you.
else
   echo "Sorry, you did not identify yourself. "
fi
$
$ <code class="calibre26"><b class="calibre21">./test7.sh Rich</b></code>
Hello Rich, glad to meet you.
$
$ <code class="calibre26"><b class="calibre21">./test7.sh</b></code>
Sorry, you did not identify yourself.
$</code></pre>
<p class="calibre10">In this example, the <code class="calibre26">-n</code> test evaluation was used to check for data in the <code class="calibre26">$1</code> command line parameter. In the next section, you'll learn another way to check command line parameters.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-223" class="calibre4"></a>Using Special Parameter Variables</h2>
<p class="calibre10"><span type="pagebreak" title="371" id="calibre_link-707" class="calibre11"></span>A few special bash shell variables track command line parameters. This section describes what they are and how to use them.</p>
<section class="toclist">
<h3 class="calibre15">Counting parameters</h3>
<p class="calibre10">As you saw in the last section, you should verify command line parameters before using them in your script. For scripts that use multiple command line parameters, this checking can get tedious.</p>
<p class="calibre10">Instead of testing each parameter, you can count how many parameters were entered on the command line. The bash shell provides a special variable for this purpose.</p>
<p class="calibre10">The special <code class="calibre26"><i class="calibre12">$#</i></code> variable contains the number of command line parameters included when the script was run. You can use this special variable anywhere in the script, just like a normal variable:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test8.sh</b></code>
#!/bin/bash
# getting the number of parameters
#
echo There were $# parameters supplied.
$
$ <code class="calibre26"><b class="calibre21">./test8.sh</b></code>
There were 0 parameters supplied.
$
$ <code class="calibre26"><b class="calibre21">./test8.sh 1 2 3 4 5</b></code>
There were 5 parameters supplied.
$
$ <code class="calibre26"><b class="calibre21">./test8.sh 1 2 3 4 5 6 7 8 9 10</b></code>
There were 10 parameters supplied.
$
$ <code class="calibre26"><b class="calibre21">./test8.sh "Rich Blum"</b></code>
There were 1 parameters supplied.
$</code></pre>
<p class="calibre10">Now you have the ability to test the number of parameters present before trying to use them:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test9.sh</b></code>
#!/bin/bash
# Testing parameters
#
if [ $# -ne 2 ]
then
   echo
   echo Usage: test9.sh a b
   echo
else
   total=$[ $1 + $2 ]
   echo
   echo The total is $total
   echo
fi
#
$
$ <code class="calibre26"><b class="calibre21">bash test9.sh</b></code>
Usage: test9.sh a b
$ <code class="calibre26"><b class="calibre21">bash test9.sh 10</b></code>
Usage: test9.sh a b
$ <code class="calibre26"><b class="calibre21">bash test9.sh 10 15</b></code>
The total is 25
$</code></pre>
<p class="calibre10">The <code class="calibre26">if-then</code> statement uses the <code class="calibre26">-ne</code> evaluation to perform a numeric test of <span type="pagebreak" title="372" id="calibre_link-708" class="calibre11"></span>the command line parameters supplied. If the correct number of parameters isn't present, an error message displays showing the correct usage of the script.</p>
<p class="calibre10">This variable also provides a cool way of grabbing the last parameter on the command line without having to know how many parameters were used. However, you need to use a little trick to get there.</p>
<p class="calibre10">If you think this through, you might think that because the <code class="calibre26"><i class="calibre12">$#</i></code> variable contains the value of the number of parameters, using the variable <code class="calibre26"><i class="calibre12">${$#}</i></code> would represent the last command line parameter variable. Try that and see what happens:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat badtest1.sh</b></code>
#!/bin/bash
# testing grabbing last parameter
#
echo The last parameter was ${$#}
$
$ <code class="calibre26"><b class="calibre21">./badtest1.sh 10</b></code>
The last parameter was 15354
$</code></pre>
<p class="calibre10">Wow, what happened? Obviously, something went wrong. It turns out that you can't use the dollar sign within the braces. Instead, you must replace the dollar sign with an exclamation mark. Odd, but it works:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test10.sh</b></code>
#!/bin/bash
# Grabbing the last parameter
#
params=$#
echo
echo The last parameter is $params
echo The last parameter is ${!#}
echo
#
$
$ <code class="calibre26"><b class="calibre21">bash test10.sh 1 2 3 4 5</b></code>
The last parameter is 5
The last parameter is 5
$
$ <code class="calibre26"><b class="calibre21">bash test10.sh</b></code>
The last parameter is 0
The last parameter is test10.sh
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="373" id="calibre_link-709" class="calibre11"></span>Perfect. This script also assigned the <code class="calibre26"><i class="calibre12">$#</i></code> variable value to the variable <i class="calibre12">params</i> and then used that variable within the special command line parameter variable format as well. Both versions worked. It's also important to notice that, when there weren't any parameters on the command line, the <code class="calibre26"><i class="calibre12">$#</i></code> value was zero, which is what appears in the <code class="calibre26"><i class="calibre12">params</i></code> variable, but the <code class="calibre26"><i class="calibre12">${!#}</i></code> variable returns the script name used on the command line.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Grabbing all the data</h3>
<p class="calibre10">In some situations you want to grab all the parameters provided on the command line. Instead of having to mess with using the <code class="calibre26"><i class="calibre12">$#</i></code> variable to determine how many parameters are on the command line and having to loop through all of them, you can use a couple of other special variables.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">$*</i></code> and <code class="calibre26"><i class="calibre12">$@</i></code> variables provide easy access to all your parameters. Both of these variables include all the command line parameters within a single variable.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">$*</i></code> variable takes all the parameters supplied on the command line as a single word. The word contains each of the values as they appear on the command line. Basically, instead of treating the parameters as multiple objects, the <code class="calibre26"><i class="calibre12">$*</i></code> variable treats them all as one parameter.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">$@</i></code> variable, on the other hand, takes all the parameters supplied on the command line as separate words in the same string. It allows you to iterate through the values, separating out each parameter supplied. This is most often accomplished using the <code class="calibre26">for</code> command.</p>
<p class="calibre10"><span type="pagebreak" title="374" id="calibre_link-710" class="calibre11"></span>It can easily get confusing to figure out how these two variables operate. Let's look at the difference between the two:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test11.sh</b></code>
#!/bin/bash
# testing $* and $@
#
echo
echo "Using the \$* method: $*"
echo
echo "Using the \$@ method: $@"
$
$ <code class="calibre26"><b class="calibre21">./test11.sh rich barbara katie jessica</b></code>
Using the $* method: rich barbara katie jessica
Using the $@ method: rich barbara katie jessica
$</code></pre>
<p class="calibre10">Notice that on the surface, both variables produce the same output, showing all the command line parameters provided at once.</p>
<p class="calibre10">The following example demonstrates where the differences are:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test12.sh</b></code>
#!/bin/bash
# testing $* and $@
#
echo
count=1
#
for param in "$*"
do
   echo "\$* Parameter #$count = $param"
   count=$[ $count + 1 ]
done
#
echo
count=1
#
for param in "$@"
do
   echo "\$@ Parameter #$count = $param"
   count=$[ $count + 1 ]
done
$
$ <code class="calibre26"><b class="calibre21">./test12.sh rich barbara katie jessica</b></code>
$* Parameter #1 = rich barbara katie jessica
$@ Parameter #1 = rich
$@ Parameter #2 = barbara
$@ Parameter #3 = katie
$@ Parameter #4 = jessica
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="375" id="calibre_link-711" class="calibre11"></span>Now we're getting somewhere. By using the <code class="calibre26">for</code> command to iterate through the special variables, you can see how they each treat the command line parameters differently. The <code class="calibre26"><i class="calibre12">$*</i></code> variable treated all the parameters as a single parameter, while the <code class="calibre26"><i class="calibre12">$@</i></code> variable treated each parameter separately. This is a great way to iterate through command line parameters.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-224" class="calibre4"></a>Being Shifty</h2>
<p class="calibre10">Another tool you have in your bash shell tool belt is the <code class="calibre26">shift</code> command. The bash shell provides the <code class="calibre26">shift</code> command to help you manipulate command line parameters. The <code class="calibre26">shift</code> command literally shifts the command line parameters in their relative positions.</p>
<p class="calibre10">When you use the <code class="calibre26">shift</code> command, it moves each parameter variable one position to the left by default. Thus, the value for variable <code class="calibre26"><i class="calibre12">$3</i></code> is moved to <code class="calibre26"><i class="calibre12">$2</i></code>, the value for variable <code class="calibre26"><i class="calibre12">$2</i></code> is moved to <code class="calibre26"><i class="calibre12">$1</i></code>, and the value for variable <code class="calibre26"><i class="calibre12">$1</i></code> is discarded (note that the value for variable <code class="calibre26"><i class="calibre12">$0</i></code>, the program name, remains unchanged).</p>
<p class="calibre10">This is another great way to iterate through command line parameters, especially if you don't know how many parameters are available. You can just operate on the first parameter, shift the parameters over, and then operate on the first parameter again.</p>
<p class="calibre10">Here's a short demonstration of how this works:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test13.sh</b></code>
#!/bin/bash
# demonstrating the shift command
echo
count=1
while [ -n "$1" ]
do
   echo "Parameter #$count = $1"
   count=$[ $count + 1 ]
   shift
done
$
$ <code class="calibre26"><b class="calibre21">./test13.sh rich barbara katie jessica</b></code>
Parameter #1 = rich
Parameter #2 = barbara
Parameter #3 = katie
Parameter #4 = jessica
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="376" id="calibre_link-712" class="calibre11"></span>The script performs a <code class="calibre26">while</code> loop, testing the length of the first parameter's value. When the first parameter's length is zero, the loop ends. After testing the first parameter, the <code class="calibre26">shift</code> command is used to shift all the parameters one position.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Be careful when working with the <code class="calibre26">shift</code> command. When a parameter is shifted out, its value is lost and can't be recovered.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Alternatively, you can perform a multiple location shift by providing a parameter to the <code class="calibre26">shift</code> command. Just provide the number of places you want to shift:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test14.sh</b></code>
#!/bin/bash
# demonstrating a multi-position shift
#
echo
echo "The original parameters: $*"
shift 2
echo "Here's the new first parameter: $1"
$
$ <code class="calibre26"><b class="calibre21">./test14.sh 1 2 3 4 5</b></code>
The original parameters: 1 2 3 4 5
Here's the new first parameter: 3
$</code></pre>
<p class="calibre10">By using values in the <code class="calibre26">shift</code> command, you can easily skip over parameters you don't need.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-225" class="calibre4"></a>Working with Options</h2>
<p class="calibre10">If you've been following along in the book, you've seen several bash commands that provide both parameters and options. <i class="calibre12">Options</i> are single letters preceded by a dash that alter the behavior of a command. This section shows three methods for working with options in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Finding your options</h3>
<p class="calibre10">On the surface, there's nothing all that special about command line options. They appear on the command line immediately after the script name, just the same as command line parameters. In fact, if you want, you can process command line options the same way you process command line parameters.</p>
<section class="toclist">
<h4 class="calibre25">Processing simple options</h4>
<p class="calibre10">In <span type="pagebreak" title="377" id="calibre_link-713" class="calibre11"></span>the <code class="calibre26">test13.sh</code> script earlier, you saw how to use the <code class="calibre26">shift </code>command to work your way down the command line parameters provided with the script program. You can use this same technique to process command line options.</p>
<p class="calibre10">As you extract each individual parameter, use the <code class="calibre26">case</code> statement (see Chapter 12) to determine when a parameter is formatted as an option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test15.sh</b></code>
#!/bin/bash
# extracting command line options as parameters
#
echo
while [ -n "$1" ]
do
   case "$1" in
     -a) echo "Found the -a option" ;;
     -b) echo "Found the -b option" ;;
     -c) echo "Found the -c option" ;;
      *) echo "$1 is not an option" ;;
   esac
   shift
done
$
$ <code class="calibre26"><b class="calibre21">./test15.sh -a -b -c -d</b></code>
Found the -a option
Found the -b option
Found the -c option
-d is not an option
$</code></pre>
<p class="calibre10">The <code class="calibre26">case</code> statement checks each parameter for valid options. When one is found, the appropriate commands are run in the <code class="calibre26">case</code> statement.</p>
<p class="calibre10">This method works, no matter in what order the options are presented on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test15.sh -d -c -a</b></code>
-d is not an option
Found the -c option
Found the -a option
$</code></pre>
<p class="calibre10">The <code class="calibre26">case</code> statement processes each option as it finds it in the command line parameters. If any other parameters are included on the command line, you can include commands in the catch-all part of the <code class="calibre26">case</code> statement to process them.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Separating options from parameters</h4>
<p class="calibre10">Often you'll run <span type="pagebreak" title="378" id="calibre_link-714" class="calibre11"></span>into situations where you'll want to use both options and parameters for a shell script. The standard way to do this in Linux is to separate the two with a special character code that tells the script when the options are finished and when the normal parameters start.</p>
<p class="calibre10">For Linux, this special character is the double dash (<code class="calibre26">--</code>). The shell uses the double dash to indicate the end of the option list. After seeing the double dash, your script can safely process the remaining command line parameters as parameters and not options.</p>
<p class="calibre10">To check for the double dash, simply add another entry in the <code class="calibre26">case</code> statement:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test16.sh</b></code>
#!/bin/bash
# extracting options and parameters
echo
while [ -n "$1" ]
do
   case "$1" in
      -a) echo "Found the -a option" ;;
      -b) echo "Found the -b option";;
      -c) echo "Found the -c option" ;;
      --) shift
          break ;;
       *) echo "$1 is not an option";;
   esac
   shift
done
#
count=1
for param in $@
do
   echo "Parameter #$count: $param"
   count=$[ $count + 1 ]
done
$</code></pre>
<p class="calibre10">This script uses the <code class="calibre26">break</code> command to break out of the <code class="calibre26">while</code> loop when it encounters the double dash. Because we're breaking out prematurely, we need to ensure that we stick in another <code class="calibre26">shift</code> command to get the double dash out of the parameter variables.</p>
<p class="calibre10">For the first test, try running the script using a normal set of options and parameters:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test16.sh -c -a -b test1 test2 test3</b></code>
Found the -c option
Found the -a option
Found the -b option
test1 is not an option
test2 is not an option
test3 is not an option
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="379" id="calibre_link-715" class="calibre11"></span>The results show that the script assumed that all the command line parameters were options when it processed them. Next, try the same thing, only this time using the double dash to separate the options from the parameters on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test16.sh -c -a -b -- test1 test2 test3</b></code>
Found the -c option
Found the -a option
Found the -b option
Parameter #1: test1
Parameter #2: test2
Parameter #3: test3
$</code></pre>
<p class="calibre10">When the script reaches the double dash, it stops processing options and assumes that any remaining parameters are command line parameters.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Processing options with values</h4>
<p class="calibre10">Some options require an additional parameter value. In these situations, the command line looks something like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./testing.sh -a test1 -b -c -d test2</b></code></code></pre>
<p class="calibre10">Your script must be able to detect when your command line option requires an additional parameter and be able to process it appropriately. Here's an example of how to do that:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test17.sh</b></code>
#!/bin/bash
# extracting command line options and values
echo
while [ -n "$1" ]
do
   case "$1" in
      -a) echo "Found the -a option";;
      -b) param="$2"
          echo "Found the -b option, with parameter value $param"
          shift ;;
      -c) echo "Found the -c option";;
      --) shift
          break ;;
       *) echo "$1 is not an option";;
   esac
   shift
done
#
count=1
for param in "$@"
do
   echo "Parameter #$count: $param"
   count=$[ $count + 1 ]
done
$
$ <code class="calibre26"><b class="calibre21">./test17.sh -a -b test1 -d</b></code>
Found the -a option
Found the -b option, with parameter value test1
-d is not an option
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="380" id="calibre_link-716" class="calibre11"></span>In this example, the <code class="calibre26">case</code> statement defines three options that it processes. The <code class="calibre26">-b</code> option also requires an additional parameter value. Because the parameter being processed is <code class="calibre26"><i class="calibre12">$1</i></code>, you know that the additional parameter value is located in <code class="calibre26"><i class="calibre12">$2</i></code> (because all the parameters are shifted after they are processed). Just extract the parameter value from the <code class="calibre26"><i class="calibre12">$2</i></code> variable. Of course, because we used two parameter spots for this option, you also need to set the <code class="calibre26">shift</code> command to shift one additional position.</p>
<p class="calibre10">Just as with the basic feature, this process works no matter what order you place the options in (just remember to include the appropriate option parameter with the each option):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test17.sh -b test1 -a -d</b></code>
Found the -b option, with parameter value test1
Found the -a option
-d is not an option
$</code></pre>
<p class="calibre10">Now you have the basic ability to process command line options in your shell scripts, but there are limitations. For example, this doesn't work if you try to combine multiple options in one parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test17.sh -ac</b></code>
-ac is not an option
$</code></pre>
<p class="calibre10">It is a common practice in Linux to combine options, and if your script is going to be user-friendly, you'll want to offer this feature for your users as well. Fortunately, there's another method for processing options that can help you.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using the getopt command</h3>
<p class="calibre10">The <code class="calibre26">getopt</code> command is a great tool to have handy when processing command line options and parameters. It reorganizes the command line parameters to make parsing them in your script easier.</p>
<section class="toclist">
<h4 class="calibre25">Looking at the command format</h4>
<p class="calibre10">The <code class="calibre26">getopt</code> command can <span type="pagebreak" title="381" id="calibre_link-717" class="calibre11"></span>take a list of command line options and parameters, in any form, and automatically turn them into the proper format. It uses the following command format:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">getopt</b></code> optstring <code class="calibre26"><i class="calibre12">parameters</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">optstring</i></code> is the key to the process. It defines the valid option letters that can be used in the command line. It also defines which option letters require a parameter value.</p>
<p class="calibre10">First, list each command line option letter you're going to use in your script in the <code class="calibre26"><i class="calibre12">optstring</i></code>. Then place a colon after each option letter that requires a parameter value. The <code class="calibre26">getopt</code> command parses the supplied parameters based on the <code class="calibre26"><i class="calibre12">optstring</i></code> you define.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">A more advanced version of the <code class="calibre26">getopt</code> command, called <code class="calibre26">getopts</code> (notice it is plural), is available. The <code class="calibre26">getopts</code> command is covered later in this chapter. Because of their nearly identical spelling, it's easy to get these two commands confused. Be careful!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Here's a simple example of how <code class="calibre26">getopt</code> works:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">getopt ab:cd -a -b test1 -cd test2 test3</b></code>
 -a -b test1 -c -d -- test2 test3
$</code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">optstring</i></code> defines four valid option letters, <code class="calibre26">a</code>, <code class="calibre26">b</code>, <code class="calibre26">c</code>, and <code class="calibre26">d</code>. A colon (:) is placed behind the letter <code class="calibre26">b</code> in order to require option <code class="calibre26">b</code> to have a parameter value. When the <code class="calibre26">getopt</code> command runs, it examines the provided parameter list (<code class="calibre26">-a -b test1 -cd test2 test3</code>) and parses it based on the supplied <code class="calibre26"><i class="calibre12">optstring</i></code>. Notice that it automatically separated the <code class="calibre26">-cd</code> options into two separate options and inserted the double dash to separate the additional parameters on the line.</p>
<p class="calibre10">If you specify a parameter option not in the <code class="calibre26"><i class="calibre12">optstring</i></code>, by default the <code class="calibre26">getopt</code> command produces an error message:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">getopt ab:cd -a -b test1 -cde test2 test3</b></code>
getopt: invalid option -- e
 -a -b test1 -c -d -- test2 test3
$</code></pre>
<p class="calibre10">If you prefer to just ignore the error messages, use <code class="calibre26">getopt</code> with the <code class="calibre26">-q</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">getopt -q ab:cd -a -b test1 -cde test2 test3</b></code>
 -a -b 'test1' -c -d -- 'test2' 'test3'
$</code></pre>
<p class="calibre10">Note that the <code class="calibre26">getopt</code> command options must be listed before the <code class="calibre26"><i class="calibre12">optstring</i></code>. Now you should be ready to use this command in your scripts to process command line options.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using getopt in your scripts</h4>
<p class="calibre10"><span type="pagebreak" title="382" id="calibre_link-718" class="calibre11"></span>You can use the <code class="calibre26">getopt</code> command in your scripts to format any command line options or parameters entered for your script. It's a little tricky, however, to use.</p>
<p class="calibre10">The trick is to replace the existing command line options and parameters with the formatted version produced by the <code class="calibre26">getopt</code> command. The way to do that is to use the <code class="calibre26">set</code> command.</p>
<p class="calibre10">You saw the <code class="calibre26">set</code> command back in Chapter 6. The <code class="calibre26">set</code> command works with the different variables in the shell.</p>
<p class="calibre10">One of the <code class="calibre26">set</code> command options is the double dash (<code class="calibre26">--</code>). The double dash instructs <code class="calibre26">set</code> to replace the command line parameter variables with the values on the <code class="calibre26">set</code> command's command line.</p>
<p class="calibre10">The trick then is to feed the original script command line parameters to the <code class="calibre26">getopt</code> command and then feed the output of the <code class="calibre26">getopt</code> command to the <code class="calibre26">set</code> command to replace the original command line parameters with the nicely formatted ones from <code class="calibre26">getopt</code>. This looks something like this:</p>
<pre class="calibre29"><code class="calibre26">set -- $(getopt -q ab:cd "$@")</code></pre>
<p class="calibre10">Now the values of the original command line parameter variables are replaced with the output from the <code class="calibre26">getopt</code> command, which formats the command line parameters for us.</p>
<p class="calibre10">Using this technique, we can now write scripts that handle our command line parameters for us:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test18.sh</b></code>
#!/bin/bash
# Extract command line options &amp; values with getopt
#
set -- $(getopt -q ab:cd "$@")
#
echo
while [ -n "$1" ]
do
   case "$1" in
   -a) echo "Found the -a option" ;;
   -b) param="$2"
       echo "Found the -b option, with parameter value $param"
       shift ;;
   -c) echo "Found the -c option" ;;
   --) shift
       break ;;
    *) echo "$1 is not an option";;
   esac
   shift
done
#
count=1
for param in "$@"
do
   echo "Parameter #$count: $param"
   count=$[ $count + 1 ]
done
#
$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="383" id="calibre_link-719" class="calibre11"></span>You'll notice this is basically the same script as in <code class="calibre26">test17.sh</code>. The only thing that changed is the addition of the <code class="calibre26">getopt</code> command to help format our command line parameters.</p>
<p class="calibre10">Now when you run the script with complex options, things work much better:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test18.sh -ac</b></code>
Found the -a option
Found the -c option
$</code></pre>
<p class="calibre10">And of course, all the original features work just fine as well:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test18.sh -a -b test1 -cd test2 test3 test4</b></code>
Found the -a option
Found the -b option, with parameter value 'test1'
Found the -c option
Parameter #1: 'test2'
Parameter #2: 'test3'
Parameter #3: 'test4'
$</code></pre>
<p class="calibre10">Now things are looking pretty fancy. However, there's still one small bug that lurks in the <code class="calibre26">getopt</code> command. Check out this example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test18.sh -a -b test1 -cd "test2 test3" test4</b></code>
Found the -a option
Found the -b option, with parameter value 'test1'
Found the -c option
Parameter #1: 'test2
Parameter #2: test3'
Parameter #3: 'test4'
$</code></pre>
<p class="calibre10">The <code class="calibre26">getopt</code> command isn't good at dealing with parameter values with spaces and quotation marks. It interpreted the space as the parameter separator, instead of following the <span type="pagebreak" title="384" id="calibre_link-720" class="calibre11"></span>double quotation marks and combining the two values into one parameter. Fortunately, this problem has another solution.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Advancing to getopts</h3>
<p class="calibre10">The <code class="calibre26">getopts</code> command (notice that it is plural) is built into the bash shell. It looks much like its <code class="calibre26">getopt</code> cousin, but has some expanded features.</p>
<p class="calibre10">Unlike <code class="calibre26">getopt</code>, which produces one output for all the processed options and parameters found in the command line, the <code class="calibre26">getopts</code> command works on the existing shell parameter variables sequentially.</p>
<p class="calibre10">It processes the parameters it detects in the command line one at a time each time it's called. When it runs out of parameters, it exits with an exit status greater than zero. This makes it great for using in loops to parse all the parameters on the command line.</p>
<p class="calibre10">Here's the format of the <code class="calibre26">getopts</code> command:</p>
<pre class="calibre29"><code class="calibre26">getopts optstring <code class="calibre26"><i class="calibre12">variable</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">optstring</i></code> value is similar to the one used in the <code class="calibre26">getopt</code> command. Valid option letters are listed in the <code class="calibre26"><i class="calibre12">optstring</i></code>, along with a colon if the option letter requires a parameter value. To suppress error messages, start the <code class="calibre26"><i class="calibre12">optstring</i></code> with a colon. The <code class="calibre26">getopts</code> command places the current parameter in the <code class="calibre26"><i class="calibre12">variable</i></code> defined in the command line.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">getopts</i></code> command uses two environment variables. The <code class="calibre26"><i class="calibre12">OPTARG</i></code> environment variable contains the value to be used if an option requires a parameter value. The <code class="calibre26"><i class="calibre12">OPTIND</i></code> environment variable contains the value of the current location within the parameter list where <code class="calibre26">getopts</code> left off. This allows you to continue processing other command line parameters after finishing the options.</p>
<p class="calibre10">Let's look at a simple example that uses the <code class="calibre26">getopts</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test19.sh</b></code>
#!/bin/bash
# simple demonstration of the getopts command
#
echo
while getopts :ab:c opt
do
   case "$opt" in
      a) echo "Found the -a option" ;;
      b) echo "Found the -b option, with value $OPTARG";;
      c) echo "Found the -c option" ;;
      *) echo "Unknown option: $opt";;
   esac
done
$
$ <code class="calibre26"><b class="calibre21">./test19.sh -ab test1 -c</b></code>
Found the -a option
Found the -b option, with value test1
Found the -c option
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="385" id="calibre_link-721" class="calibre11"></span>The <code class="calibre26">while</code> statement defines the <code class="calibre26">getopts</code> command, specifying what command line options to look for, along with the variable name (<code class="calibre26"><i class="calibre12">opt</i></code>) to store them in for each iteration.</p>
<p class="calibre10">You'll notice something different about the <code class="calibre26">case</code> statement in this example. When the <code class="calibre26">getopts</code> command parses the command line options, it strips off the leading dash, so you don't need leading dashes in the <code class="calibre26">case</code> definitions.</p>
<p class="calibre10">The <code class="calibre26">getopts</code> command offers several nice features. For starters, you can include spaces in your parameter values:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test19.sh -b "test1 test2" -a</b></code>
Found the -b option, with value test1 test2
Found the -a option
$</code></pre>
<p class="calibre10">Another nice feature is that you can run the option letter and the parameter value together without a space:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test19.sh -abtest1</b></code>
Found the -a option
Found the -b option, with value test1
$</code></pre>
<p class="calibre10">The <code class="calibre26">getopts</code> command correctly parsed the <code class="calibre26">test1</code> value from the <code class="calibre26">-b</code> option. In addition, the <code class="calibre26">getopts</code> command bundles any undefined option it finds in the command line into a single output, the question mark:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test19.sh -d</b></code>
Unknown option: ?
$
$ <code class="calibre26"><b class="calibre21">./test19.sh -acde</b></code>
Found the -a option
Found the -c option
Unknown option: ?
Unknown option: ?
$</code></pre>
<p class="calibre10">Any option letter not defined in the <code class="calibre26"><i class="calibre12">optstring</i></code> value is sent to your code as a question mark.</p>
<p class="calibre10"><span type="pagebreak" title="386" id="calibre_link-722" class="calibre11"></span>The <code class="calibre26">getopts</code> command knows when to stop processing options and leave the parameters for you to process. As <code class="calibre26">getopts</code> processes each option, it increments the <code class="calibre26"><i class="calibre12">OPTIND</i></code> environment variable by one. When you've reached the end of the <code class="calibre26">getopts</code> processing, you can use the <code class="calibre26"><i class="calibre12">OPTIND</i></code> value with the <code class="calibre26">shift</code> command to move to the parameters:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test20.sh</b></code>
#!/bin/bash
# Processing options &amp; parameters with getopts
#
echo
while getopts :ab:cd opt
do
   case "$opt" in
   a) echo "Found the -a option"  ;;
   b) echo "Found the -b option, with value $OPTARG" ;;
   c) echo "Found the -c option"  ;;
   d) echo "Found the -d option"  ;;
   *) echo "Unknown option: $opt" ;;
   esac
done
#
shift $[ $OPTIND - 1 ]
#
echo
count=1
for param in "$@"
do
   echo "Parameter $count: $param"
   count=$[ $count + 1 ]
done
#
$
$ <code class="calibre26"><b class="calibre21">./test20.sh -a -b test1 -d test2 test3 test4</b></code>
Found the -a option
Found the -b option, with value test1
Found the -d option
Parameter 1: test2
Parameter 2: test3
Parameter 3: test4
$</code></pre>
<p class="calibre10">Now you have a full-featured command line option and parameter processing utility you can use in all your shell scripts!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-226" class="calibre4"></a>Standardizing Options</h2>
<p class="calibre10"><span type="pagebreak" title="387" id="calibre_link-723" class="calibre11"></span>When you create your shell script, obviously you're in control of what happens. It's completely up to you as to which letter options you select to use and how you select to use them.</p>
<p class="calibre10">However, a few letter options have achieved a somewhat standard meaning in the Linux world. If you leverage these options in your shell script, your scripts will be more user-friendly.</p>
<p class="calibre10"><a id="calibre_link-1177" href="#calibre_link-1145" class="calibre4">Table 14.1</a> shows some of the common meanings for command line options used in Linux.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1145" href="#calibre_link-1177" class="calibre4"><b class="calibre21">Table 14.1</b></a></span> Common Linux Command Line Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Shows all objects</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">Produces a count</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-d</code></td>
<td class="left">Specifies a directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code></td>
<td class="left">Expands an object</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code></td>
<td class="left">Specifies a file to read data from</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-h</code></td>
<td class="left">Displays a help message for the command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left">Ignores text case</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-l</code></td>
<td class="left">Produces a long format version of the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Uses a non-interactive (batch) mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-o</code></td>
<td class="left">Specifies an output file to redirect all output to</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-q</code></td>
<td class="left">Runs in quiet mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">Processes directories and files recursively</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Runs in silent mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v</code></td>
<td class="left">Produces verbose output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-x</code></td>
<td class="left">Excludes an object</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-y</code></td>
<td class="left">Answers yes to all questions</td>
</tr>
</table>
</figure>
<p class="calibre10">You'll probably recognize most of these option meanings just from working with the various <code class="calibre26">bash</code> commands throughout the book. Using the same meaning for your options helps users interact with your script without having to worry about manuals.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-227" class="calibre4"></a>Getting User Input</h2>
<p class="calibre10"><span type="pagebreak" title="388" id="calibre_link-724" class="calibre11"></span>Although providing command line options and parameters is a great way to get data from your script users, sometimes your script needs to be more interactive. Sometimes you need to ask a question while the script is running and wait for a response from the person running your script. The bash shell provides the <code class="calibre26">read</code> command just for this purpose.</p>
<section class="toclist">
<h3 class="calibre15">Reading basics</h3>
<p class="calibre10">The <code class="calibre26">read</code> command accepts input either from standard input (such as from the keyboard) or from another file descriptor. After receiving the input, the <code class="calibre26">read</code> command places the data into a variable. Here's the <code class="calibre26">read</code> command at its simplest:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test21.sh</b></code>
#!/bin/bash
# testing the read command
#
echo -n "Enter your name: "
read name
echo "Hello $name, welcome to my program. "
#
$
$ <code class="calibre26"><b class="calibre21">./test21.sh</b></code>
Enter your name: <code class="calibre26"><b class="calibre21">Rich Blum</b></code>
Hello Rich Blum, welcome to my program.
$</code></pre>
<p class="calibre10">That's pretty simple. Notice that the <code class="calibre26">echo</code> command that produced the prompt uses the <code class="calibre26">-n</code> option. This suppresses the newline character at the end of the string, allowing the script user to enter data immediately after the string, instead of on the next line. This gives your scripts a more form-like appearance.</p>
<p class="calibre10">In fact, the <code class="calibre26">read</code> command includes the <code class="calibre26">-p</code> option, which allows you to specify a prompt directly in the <code class="calibre26">read</code> command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test22.sh</b></code>
#!/bin/bash
# testing the read -p option
#
read -p "Please enter your age: " age
days=$[ $age * 365 ]
echo "That makes you over $days days old! "
#
$
$ <code class="calibre26"><b class="calibre21">./test22.sh</b></code>
Please enter your age: <code class="calibre26"><b class="calibre21">10</b></code>
That makes you over 3650 days old!
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="389" id="calibre_link-725" class="calibre11"></span>You'll notice in the first example that when a name was entered, the <code class="calibre26">read</code> command assigned both the first name and last name to the same variable. The <code class="calibre26">read</code> command assigns all data entered at the prompt to a single variable, or you can specify multiple variables. Each data value entered is assigned to the next variable in the list. If the list of variables runs out before the data does, the remaining data is assigned to the last variable:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test23.sh</b></code>
#!/bin/bash
# entering multiple variables
#
read -p "Enter your name: " first last
echo "Checking data for $last, $first..."
$
$ <code class="calibre26"><b class="calibre21">./test23.sh</b></code>
Enter your name: <code class="calibre26"><b class="calibre21">Rich Blum</b></code>
Checking data for Blum, Rich...
$</code></pre>
<p class="calibre10">You can also specify no variables on the <code class="calibre26">read</code> command line. If you do that, the <code class="calibre26">read</code> command places any data it receives in the special environment variable <code class="calibre26"><i class="calibre12">REPLY</i></code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test24.sh</b></code>
#!/bin/bash
# Testing the REPLY Environment variable
#
read -p "Enter your name: "
echo
echo Hello $REPLY, welcome to my program.
#
$
$ <code class="calibre26"><b class="calibre21">./test24.sh</b></code>
Enter your name: <code class="calibre26"><b class="calibre21">Christine</b></code>
Hello Christine, welcome to my program.
$</code></pre>
<p class="calibre10">The <code class="calibre26">REPLY</code> environment variable contains all the data entered in the input, and it can be used in the shell script as any other variable.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Timing out</h3>
<p class="calibre10">Be careful when using the <code class="calibre26">read</code> command. Your script may get stuck waiting for the script user to enter data. If the script must go on regardless of whether any data was entered, you can use the <code class="calibre26">-t</code> option to specify a timer. The <code class="calibre26">-t</code> option specifies the number of seconds for the <code class="calibre26">read</code> command to wait for input. When the timer expires, the <code class="calibre26">read</code> command returns a non-zero exit status:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test25.sh</b></code>
#!/bin/bash
# timing the data entry
#
if read -t 5 -p "Please enter your name: " name
then
   echo "Hello $name, welcome to my script"
else
   echo
   echo "Sorry, too slow! "
fi
$
$ <code class="calibre26"><b class="calibre21">./test25.sh</b></code>
Please enter your name: <code class="calibre26"><b class="calibre21">Rich</b></code>
Hello Rich, welcome to my script
$
$ <code class="calibre26"><b class="calibre21">./test25.sh</b></code>
Please enter your name:
Sorry, too slow!
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="390" id="calibre_link-726" class="calibre11"></span>Because the <code class="calibre26">read</code> command exits with a non-zero exit status if the timer expires, it's easy to use the standard structured statements, such as an <code class="calibre26">if-then</code> statement or a <code class="calibre26">while</code> loop to track what happened. In this example, when the timer expires, the <code class="calibre26">if</code> statement fails, and the shell executes the commands in the <code class="calibre26">else</code> section.</p>
<p class="calibre10">Instead of timing the input, you can also set the <code class="calibre26">read</code> command to count the input characters. When a preset number of characters has been entered, it automatically exits, assigning the entered data to the variable:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test26.sh</b></code>
#!/bin/bash
# getting just one character of input
#
read -n1 -p "Do you want to continue [Y/N]? " answer
case $answer in
Y | y) echo
       echo "fine, continue on...";;
N | n) echo
       echo OK, goodbye
       exit;;
esac
echo "This is the end of the script"
$
$ <code class="calibre26"><b class="calibre21">./test26.sh</b></code>
Do you want to continue [Y/N]? <code class="calibre26"><b class="calibre21">Y</b></code>
fine, continue on...
This is the end of the script
$
$ <code class="calibre26"><b class="calibre21">./test26.sh</b></code>
Do you want to continue [Y/N]? <code class="calibre26"><b class="calibre21">n</b></code>
OK, goodbye
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="391" id="calibre_link-727" class="calibre11"></span>This example uses the <code class="calibre26">-n</code> option with the value of <code class="calibre26">1</code>, instructing the <code class="calibre26">read</code> command to accept only a single character before exiting. As soon as you press the single character to answer, the <code class="calibre26">read</code> command accepts the input and passes it to the variable. You don't need to press the Enter key.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading with no display</h3>
<p class="calibre10">Sometimes you need input from the script user, but you don't want that input to display on the monitor. The classic example is when entering passwords, but there are plenty of other types of data that you need to hide.</p>
<p class="calibre10">The <code class="calibre26">-s</code> option prevents the data entered in the <code class="calibre26">read</code> command from being displayed on the monitor; actually, the data is displayed, but the <code class="calibre26">read</code> command sets the text color to the same as the background color. Here's an example of using the <code class="calibre26">-s</code> option in a script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test27.sh</b></code>
#!/bin/bash
# hiding input data from the monitor
#
read -s -p "Enter your password: " pass
echo
echo "Is your password really $pass? "
$
$ <code class="calibre26"><b class="calibre21">./test27.sh</b></code>
Enter your password:
Is your password really T3st1ng?
$</code></pre>
<p class="calibre10">The data typed at the input prompt doesn't appear on the monitor but is assigned to the variable for use in the script.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Reading from a file</h3>
<p class="calibre10">Finally, you can also use the <code class="calibre26">read</code> command to read data stored in a file on the Linux system. Each call to the <code class="calibre26">read</code> command reads a single line of text from the file. When no more lines are left in the file, the <code class="calibre26">read</code> command exits with a non-zero exit status.</p>
<p class="calibre10">The tricky part is getting the data from the file to the <code class="calibre26">read</code> command. The most common method is to <code class="calibre26">pipe</code> the result of the <code class="calibre26">cat</code> command of the file directly to a <code class="calibre26">while</code> command that contains the <code class="calibre26">read</code> command. Here's an example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test28.sh</b></code>
#!/bin/bash
# reading data from a file
#
count=1
cat test | while read line
do
   echo "Line $count: $line"
   count=$[ $count + 1]
done
echo "Finished processing the file"
$
$ <code class="calibre26"><b class="calibre21">cat test</b></code>
The quick brown dog jumps over the lazy fox.
This is a test, this is only a test.
O Romeo, Romeo! Wherefore art thou Romeo?
$
$ <code class="calibre26"><b class="calibre21">./test28.sh</b></code>
Line 1: The quick brown dog jumps over the lazy fox.
Line 2: This is a test, this is only a test.
Line 3: O Romeo, Romeo! Wherefore art thou Romeo?
Finished processing the file
$</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> command loop continues processing lines of the file with the <code class="calibre26">read</code> command, until the <code class="calibre26">read</code> command exits with a non-zero exit status.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-228" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="392" id="calibre_link-728" class="calibre11"></span>This chapter showed three methods for retrieving data from the script user. Command line parameters allow users to enter data directly on the command line when they run the script. The script uses positional parameters to retrieve the command line parameters and assign them to variables.</p>
<p class="calibre10">The <code class="calibre26">shift</code> command allows you to manipulate the command line parameters by rotating them within the positional parameters. This command allows you to easily iterate through the parameters without knowing how many parameters are available.</p>
<p class="calibre10">You can use three special variables when working with command line parameters. The shell sets the <code class="calibre26"><i class="calibre12">$#</i></code> variable to the number of parameters entered on the command line. The <code class="calibre26"><i class="calibre12">$*</i></code> variable contains all the parameters as a single string, and the <code class="calibre26"><i class="calibre12">$@</i></code> variable contains all the parameters as separate words. These variables come in handy when you're trying to process long parameter lists.</p>
<p class="calibre10">Besides parameters, your script users can use command line options to pass information to your script. Command line options are single letters preceded by a dash. Different options can be assigned to alter the behavior of your script.</p>
<p class="calibre10">The bash shell provides three ways to handle command line options.</p>
<p class="calibre10"><span type="pagebreak" title="393" id="calibre_link-729" class="calibre11"></span>The first way is to handle them just like command line parameters. You can iterate through the options using the positional parameter variables, processing each option as it appears on the command line.</p>
<p class="calibre10">Another way to handle command line options is with the <code class="calibre26">getopt</code> command. This command converts command line options and parameters into a standard format that you can process in your script. The <code class="calibre26">getopt</code> command allows you to specify which letters it recognizes as options and which options require an additional parameter value. The <code class="calibre26">getopt</code> command processes the standard command line parameters and outputs the options and parameters in the proper order.</p>
<p class="calibre10">The final method for handling command line options is via the <code class="calibre26">getopts</code> command (note that it's plural). The <code class="calibre26">getopts</code> command provides more advanced processing of the command line parameters. It allows for multi-value parameters, along with identifying options not defined by the script.</p>
<p class="calibre10">An interactive method to obtain data from your script users is the <code class="calibre26">read</code> command. The <code class="calibre26">read</code> command allows your scripts to query users for information and wait. The <code class="calibre26">read</code> command places any data entered by the script user into one or more variables, which you can use within the script.</p>
<p class="calibre10">Several options are available for the <code class="calibre26">read</code> command that allow you to customize the data input into your script, such as using hidden data entry, applying timed data entry, and requesting a specific number of input characters.</p>
<p class="calibre10">In the next chapter, we look further into how bash shell scripts output data. So far, you've seen how to display data on the monitor and redirect it to a file. Next, we explore a few other options that you have available not only to direct data to specific locations but also to direct specific types of data to specific locations. This will help make your shell scripts look professional!</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-1213">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-229" class="calibre4"></a><span class="chaptertitle">Chapter 15</span><br class="calibre22" /><span class="chaptertitle">Presenting Data</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Revisiting redirection</li>
<li class="calibre7">Standard input and output</li>
<li class="calibre7">Reporting errors</li>
<li class="calibre7">Throwing away data</li>
<li class="calibre7">Creating log files</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="395" id="calibre_link-730" class="calibre11"></span>So far the scripts shown in this book display information either by echoing data to the monitor or by redirecting data to a file. Chapter 11 demonstrated how to redirect the output of a command to a file. This chapter expands on that topic by showing you how you can redirect the output of your script to different locations on your Linux system.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-230" class="calibre4"></a>Understanding Input and Output</h2>
<p class="calibre10">So far, you've seen two methods for displaying the output from your scripts:</p>
<ul class="calibre14">
<li class="calibre7">Displaying output on the monitor screen</li>
<li class="calibre7">Redirecting output to a file</li>
</ul>
<p class="calibre10">Both methods produced an all-or-nothing approach to data output. There are times, however, when it would be nice to display some data on the monitor and other data in a file. For these instances, it comes in handy to know how Linux handles input and output so you can get your script output to the right place.</p>
<p class="calibre10">The following sections describe how to use the standard Linux input and output system to your advantage, to help direct script output to specific locations.</p>
<section class="toclist">
<h3 class="calibre15">Standard file descriptors</h3>
<p class="calibre10">The Linux system handles every object as a file. This includes the input and output process. Linux identifies each file object using a <i class="calibre12">file descriptor.</i> The file descriptor is a non-negative integer that <span type="pagebreak" title="396" id="calibre_link-731" class="calibre11"></span>uniquely identifies open files in a session. Each process is allowed to have up to nine open file descriptors at a time. The bash shell reserves the first three file descriptors (0, 1, and 2) for special purposes. These are shown in <a id="calibre_link-1214" href="#calibre_link-1146" class="calibre4">Table 15.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1146" href="#calibre_link-1214" class="calibre4"><b class="calibre21">Table 15.1</b></a></span> Linux Standard File Descriptors</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">File Descriptor</td>
<td class="left"></td>
<td class="left">Abbreviation</td>
<td class="left"></td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">0</td>
<td class="left"></td>
<td class="left"><code class="calibre26">STDIN</code></td>
<td class="left"></td>
<td class="left">Standard input</td>
</tr>
<tr class="calibre28">
<td class="left">1</td>
<td class="left"></td>
<td class="left"><code class="calibre26">STDOUT</code></td>
<td class="left"></td>
<td class="left">Standard output</td>
</tr>
<tr class="calibre28">
<td class="left">2</td>
<td class="left"></td>
<td class="left"><code class="calibre26">STDERR</code></td>
<td class="left"></td>
<td class="left">Standard error</td>
</tr>
</table>
</figure>
<p class="calibre10">These three special file descriptors handle the input and output from your script. The shell uses them to direct the default input and output in the shell to the appropriate location, which by default is usually your monitor. The following sections describe each of these standard file descriptors in greater detail.</p>
<section class="toclist">
<h4 class="calibre25">STDIN</h4>
<p class="calibre10">The <code class="calibre26">STDIN</code> file descriptor references the standard input to the shell. For a terminal interface, the standard input is the keyboard. The shell receives input from the keyboard on the <code class="calibre26">STDIN</code> file descriptor and processes each character as you type it.</p>
<p class="calibre10">When you use the input redirect symbol (&lt;), Linux replaces the standard input file descriptor with the file referenced by the redirection. It reads the file and retrieves data just as if it were typed on the keyboard.</p>
<p class="calibre10">Many bash commands accept input from <code class="calibre26">STDIN</code>, especially if no files are specified on the command line. Here's an example of using the <code class="calibre26">cat</code> command with data entered from <code class="calibre26">STDIN</code>:</p>
<pre class="calibre29"><code class="calibre26"> $ cat
 this is a test
 this is a test
 this is a second test.
 this is a second test.</code></pre>
<p class="calibre10">When you enter the <code class="calibre26">cat</code> command on the command line by itself, it accepts input from <code class="calibre26">STDIN</code>. As you enter each line, the <code class="calibre26">cat</code> command echoes the line to the display.</p>
<p class="calibre10">However, you can also use the <code class="calibre26">STDIN</code> redirect symbol to force the <code class="calibre26">cat</code> command to accept input from another file other than <code class="calibre26">STDIN</code>:</p>
<pre class="calibre29"><code class="calibre26"> $ cat &lt; testfile
 This is the first line.
 This is the second line.
 This is the third line.
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="397" id="calibre_link-732" class="calibre11"></span>Now the <code class="calibre26">cat</code> command uses the lines that are contained in the <code class="calibre26">testfile</code> file as the input. You can use this technique to input data to any shell command that accepts data from <code class="calibre26">STDIN</code>.</p>
</section>
<section class="toclist">
<h4 class="calibre25">STDOUT</h4>
<p class="calibre10">The <code class="calibre26">STDOUT</code> file descriptor references the standard output for the shell. On a terminal interface, the standard output is the terminal monitor. All output from the shell (including programs and scripts you run in the shell) is directed to the standard output, which is the monitor.</p>
<p class="calibre10">Most bash commands direct their output to the <code class="calibre26">STDOUT</code> file descriptor by default. As shown in Chapter 11, you can change that using output redirection:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -l &gt; test2
 $ cat test2
 total 20
 -rw-rw-r-- 1 rich rich 53 2014-10-16 11:30 test
 -rw-rw-r-- 1 rich rich  0 2014-10-16 11:32 test2
 -rw-rw-r-- 1 rich rich 73 2014-10-16 11:23 testfile
 $</code></pre>
<p class="calibre10">With the output redirection symbol, all the output that normally would go to the monitor is instead redirected to the designated redirection file by the shell.</p>
<p class="calibre10">You can also append data to a file. You do this using the <code class="calibre26">&gt;&gt;</code> symbol:</p>
<pre class="calibre29"><code class="calibre26"> $ who &gt;&gt; test2
 $ cat test2
 total 20
 -rw-rw-r-- 1 rich rich 53 2014-10-16 11:30 test
 -rw-rw-r-- 1 rich rich  0 2014-10-16 11:32 test2
 -rw-rw-r-- 1 rich rich 73 2014-10-16 11:23 testfile
 rich     pts/0        2014-10-17 15:34 (192.168.1.2)
 $</code></pre>
<p class="calibre10">The output generated by the <code class="calibre26">who</code> command is appended to the data already in the <code class="calibre26">test2</code> file.</p>
<p class="calibre10">However, if you use the standard output redirection for your scripts, you can run into a problem. Here's an example of what can happen in your script:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al badfile &gt; test3
 ls: cannot access badfile: No such file or directory
 $ cat test3
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="398" id="calibre_link-733" class="calibre11"></span>When a command produces an error message, the shell doesn't redirect the error message to the output redirection file. The shell created the output redirection file, but the error message appeared on the monitor screen. Notice that there isn't an error when trying to display the contents of the <code class="calibre26">test3</code> file. The <code class="calibre26">test3</code> file was created just fine, but it's empty.</p>
<p class="calibre10">The shell handles error messages separately from the normal output. If you're creating a shell script that runs in background mode, often you must rely on the output messages being sent to a log file. Using this technique, if any error messages occur, they don't appear in the log file. You need to do something different.</p>
</section>
<section class="toclist">
<h4 class="calibre25">STDERR</h4>
<p class="calibre10">The shell handles error messages using the special <code class="calibre26">STDERR</code> file descriptor. The <code class="calibre26">STDERR</code> file descriptor references the standard error output for the shell. This is the location where the shell sends error messages generated by the shell or programs and scripts running in the shell.</p>
<p class="calibre10">By default, the <code class="calibre26">STDERR</code> file descriptor points to the same place as the <code class="calibre26">STDOUT</code> file descriptor (even though they are assigned different file descriptor values). This means that, by default, all error messages go to the monitor display.</p>
<p class="calibre10">However, as you saw in the example, when you redirect <code class="calibre26">STDOUT</code>, this doesn't automatically redirect <code class="calibre26">STDERR</code>. When working with scripts, you'll often want to change that behavior, especially if you're interested in logging error messages to a log file.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Redirecting errors</h3>
<p class="calibre10">You've already seen how to redirect the <code class="calibre26">STDOUT</code> data by using the redirection symbol. Redirecting the <code class="calibre26">STDERR</code> data isn't much different; you just need to define the <code class="calibre26">STDERR</code> file descriptor when you use the redirection symbol. You can do this in a couple of ways.</p>
<section class="toclist">
<h4 class="calibre25">Redirecting errors only</h4>
<p class="calibre10">As you saw in <a href="#calibre_link-1146" class="calibre4">Table 15.1</a>, the <code class="calibre26">STDERR</code> file descriptor is set to the value <code class="calibre26">2</code>. You can select to redirect only error messages by placing this file descriptor value immediately before the redirection symbol. The value must appear immediately before the redirection symbol or it doesn't work:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al badfile 2&gt; test4
 $ cat test4
 ls: cannot access badfile: No such file or directory
 $</code></pre>
<p class="calibre10">Now when you run the command, the error message doesn't appear on the monitor. Instead, the output file contains any error messages that are generated by the command. Using this method, the shell redirects the error messages only, not the normal data. Here's another example of mixing <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> messages in the same output:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al test badtest test2 2&gt; test5
 -rw-rw-r-- 1 rich rich 158 2014-10-16 11:32 test2
 $ cat test5
 ls: cannot access test: No such file or directory
 ls: cannot access badtest: No such file or directory
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="399" id="calibre_link-734" class="calibre11"></span>The normal <code class="calibre26">STDOUT</code> output from the <code class="calibre26">ls</code> command still goes to the default <code class="calibre26">STDOUT</code> file descriptor, which is the monitor. Because the command redirects file descriptor 2 output (<code class="calibre26">STDERR</code>) to an output file, the shell sends any error messages generated directly to the specified redirection file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Redirecting errors and data</h4>
<p class="calibre10">If you want to redirect both errors and the normal output, you need to use two redirection symbols. You need to precede each with the appropriate file descriptor for the data you want to redirect and then have them point to the appropriate output file for holding the data:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al test test2 test3 badtest 2&gt; test6 1&gt; test7
 $ cat test6
 ls: cannot access test: No such file or directory
 ls: cannot access badtest: No such file or directory
 $ cat test7
 -rw-rw-r-- 1 rich rich 158 2014-10-16 11:32 test2
 -rw-rw-r-- 1 rich rich   0 2014-10-16 11:33 test3
 $</code></pre>
<p class="calibre10">The shell redirects the normal output of the <code class="calibre26">ls</code> command that would have gone to <code class="calibre26">STDOUT</code> to the <code class="calibre26">test7</code> file using the <code class="calibre26">1&gt;</code> symbol. Any error messages that would have gone to <code class="calibre26">STDERR</code> were redirected to the <code class="calibre26">test6</code> file using the <code class="calibre26">2&gt;</code> symbol.</p>
<p class="calibre10">You can use this technique to separate normal script output from any error messages that occur in the script. This allows you to easily identify errors without having to wade through thousands of lines of normal output data.</p>
<p class="calibre10">Alternatively, if you want, you can redirect both <code class="calibre26">STDERR</code> and <code class="calibre26">STDOUT</code> output to the same output file. The bash shell provides a special redirection symbol just for this purpose, the <code class="calibre26">&amp;&gt;</code> symbol:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al test test2 test3 badtest &amp;&gt; test7
 $ cat test7
 ls: cannot access test: No such file or directory
 ls: cannot access badtest: No such file or directory
 -rw-rw-r-- 1 rich rich 158 2014-10-16 11:32 test2
 -rw-rw-r-- 1 rich rich   0 2014-10-16 11:33 test3
 $</code></pre>
<p class="calibre10">When you use the <code class="calibre26">&amp;&gt;</code> symbol, all the output generated by the command is sent to the same location, both data and errors. Notice that one of the error messages is out of order from what you'd expect. The error message for the <code class="calibre26">badtest</code> file (the last file to be listed) <span type="pagebreak" title="400" id="calibre_link-735" class="calibre11"></span>appears second in the output file. The bash shell automatically gives error messages a higher priority than the standard output. This allows you to view the error messages together, rather than scattered throughout the output file.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-231" class="calibre4"></a>Redirecting Output in Scripts</h2>
<p class="calibre10">You can use the <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> file descriptors in your scripts to produce output in multiple locations simply by redirecting the appropriate file descriptors. There are two methods for redirecting output in the script:</p>
<ul class="calibre14">
<li class="calibre7">Temporarily redirecting each line</li>
<li class="calibre7">Permanently redirecting all commands in the script</li>
</ul>
<p class="calibre10">The following sections describe how each of these methods works.</p>
<section class="toclist">
<h3 class="calibre15">Temporary redirections</h3>
<p class="calibre10">If you want to purposely generate error messages in your script, you can redirect an individual output line to <code class="calibre26">STDERR</code>. You just need to use the output redirection symbol to redirect the output to the <code class="calibre26">STDERR</code> file descriptor. When you redirect to a file descriptor, you must precede the file descriptor number with an ampersand (<code class="calibre26">&amp;</code>):</p>
<pre class="calibre29"><code class="calibre26"> echo "This is an error message" &gt;&amp;2</code></pre>
<p class="calibre10">This line displays the text wherever the <code class="calibre26">STDERR</code> file descriptor for the script is pointing, instead of the normal <code class="calibre26">STDOUT</code>. The following is an example of a script that uses this feature:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test8
 #!/bin/bash
 # testing STDERR messages
 echo "This is an error" &gt;&amp;2
 echo "This is normal output"
 $</code></pre>
<p class="calibre10">If you run the script as normal, you don't notice any difference:</p>
<pre class="calibre29"><code class="calibre26"> $ ./test8
 This is an error
 This is normal output
 $</code></pre>
<p class="calibre10">Remember that, by default, Linux directs the <code class="calibre26">STDERR</code> output to <code class="calibre26">STDOUT</code>. However, if you redirect <code class="calibre26">STDERR</code> when running the script, any text directed to <code class="calibre26">STDERR</code> in the script is redirected:</p>
<pre class="calibre29"><code class="calibre26"> $ ./test8 2&gt; test9
 This is normal output
 $ cat test9
 This is an error
 $</code></pre>
<p class="calibre10">Perfect! The text displayed using <code class="calibre26">STDOUT</code> appears on the monitor, while the echo statement text sent to <code class="calibre26">STDERR</code> is redirected to the output file.</p>
<p class="calibre10"><span type="pagebreak" title="401" id="calibre_link-736" class="calibre11"></span>This method is great for generating error messages in your scripts. If someone uses your scripts, they can easily redirect the error messages using the <code class="calibre26">STDERR</code> file descriptor, as shown.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Permanent redirections</h3>
<p class="calibre10">If you have lots of data that you're redirecting in your script, it can get tedious having to redirect every <code class="calibre26">echo</code> statement. Instead, you can tell the shell to redirect a specific file descriptor for the duration of the script by using the <code class="calibre26">exec</code> command:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test10
 #!/bin/bash
 # redirecting all output to a file
 exec 1&gt;testout
 echo "This is a test of redirecting all output"
 echo "from a script to another file."
 echo "without having to redirect every individual line"
 $ ./test10
 $ cat testout
 This is a test of redirecting all output
 from a script to another file.
 without having to redirect every individual line
 $</code></pre>
<p class="calibre10">The <code class="calibre26">exec</code> command starts a new shell and redirects the <code class="calibre26">STDOUT</code> file descriptor to a file. All output in the script that goes to <code class="calibre26">STDOUT</code> is instead redirected to the file.</p>
<p class="calibre10">You can also redirect the <code class="calibre26">STDOUT</code> in the middle of a script:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test11
 #!/bin/bash
 # redirecting output to different locations
 exec 2&gt;testerror
 echo "This is the start of the script"
 echo "now redirecting all output to another location"
 exec 1&gt;testout
 echo "This output should go to the testout file"
 echo "but this should go to the testerror file" &gt;&amp;2
 $
 $ ./test11
 This is the start of the script
 now redirecting all output to another location
 $ cat testout
 This output should go to the testout file
 $ cat testerror
 but this should go to the testerror file
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="402" id="calibre_link-737" class="calibre11"></span>The script uses the <code class="calibre26">exec</code> command to redirect any output going to <code class="calibre26">STDERR</code> to the file <code class="calibre26">testerror</code>. Next, the script uses the <code class="calibre26">echo</code> statement to display a few lines to <code class="calibre26">STDOUT</code>. After that, the <code class="calibre26">exec</code> command is used again to redirect <code class="calibre26">STDOUT</code> to the <code class="calibre26">testout</code> file. Notice that even when <code class="calibre26">STDOUT</code> is redirected, you can still specify the output from an <code class="calibre26">echo</code> statement to go to <code class="calibre26">STDERR</code>, which in this case is still redirected to the <code class="calibre26">testerror</code> file.</p>
<p class="calibre10">This feature can come in handy when you want to redirect the output of just parts of a script to an alternative location, such as an error log. There's just one problem you run into when using this.</p>
<p class="calibre10">After you redirect <code class="calibre26">STDOUT</code> or <code class="calibre26">STDERR</code>, you can't easily redirect them back to their original location. If you need to switch back and forth with your redirection, you need to learn a trick. The âCreating Your Own Redirectionâ section later in this chapter discusses this trick and how to use it in your shell scripts.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-232" class="calibre4"></a>Redirecting Input in Scripts</h2>
<p class="calibre10">You can use the same technique used to redirect <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> in your scripts to redirect <code class="calibre26">STDIN</code> from the keyboard. The <code class="calibre26">exec</code> command allows you to redirect <code class="calibre26">STDIN</code> from a file on the Linux system:</p>
<pre class="calibre29"><code class="calibre26"> exec 0&lt; testfile</code></pre>
<p class="calibre10">This command informs the shell that it should retrieve input from the file <code class="calibre26">testfile</code> instead of <code class="calibre26">STDIN</code>. This redirection applies anytime the script requests input. Here's an example of this in action:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test12
 #!/bin/bash
 # redirecting file input
 exec 0&lt; testfile
 count=1
 while read line
 do
    echo "Line #$count: $line"
    count=$[ $count + 1 ]
 done
 $ ./test12
 Line #1: This is the first line.
 Line #2: This is the second line.
 Line #3: This is the third line.
 $</code></pre>
<p class="calibre10">Chapter 14 showed you how to use the <code class="calibre26">read</code> command to read data entered from the keyboard by a user. By redirecting <code class="calibre26">STDIN</code> from a file, when the <code class="calibre26">read</code> command attempts to read from <code class="calibre26">STDIN</code>, it retrieves data from the file instead of the keyboard.</p>
<p class="calibre10">This is an excellent technique to read data in files for processing in your scripts. A common task for Linux system administrators is to read data from log files for processing. This is the easiest way to accomplish that task.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-233" class="calibre4"></a>Creating Your Own Redirection</h2>
<p class="calibre10"><span type="pagebreak" title="403" id="calibre_link-738" class="calibre11"></span>When you redirect input and output in your script, you're not limited to the three default file descriptors. I mentioned that you could have up to nine open file descriptors in the shell. The other six file descriptors are numbered from 3 through 8 and are available for you to use as either input or output redirection. You can assign any of these file descriptors to a file and then use them in your scripts as well. This section shows you how to use the other file descriptors in your scripts.</p>
<section class="toclist">
<h3 class="calibre15">Creating output file descriptors</h3>
<p class="calibre10">You assign a file descriptor for output by using the exec command. As with the standard file descriptors, after you assign an alternative file descriptor to a file location, that redirection stays permanent until you reassign it. Here's a simple example of using an alternative file descriptor in a script:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test13
 #!/bin/bash
 # using an alternative file descriptor
 exec 3&gt;test13out
 echo "This should display on the monitor"
 echo "and this should be stored in the file" &gt;&amp;3
 echo "Then this should be back on the monitor"
 $ ./test13
 This should display on the monitor
 Then this should be back on the monitor
 $ cat test13out
 and this should be stored in the file
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="404" id="calibre_link-739" class="calibre11"></span>The script uses the <code class="calibre26">exec</code> command to redirect file descriptor 3 to an alternative file location. When the script executes the <code class="calibre26">echo</code> statements, they display on <code class="calibre26">STDOUT</code> as you would expect. However, the <code class="calibre26">echo</code> statements that you redirect to file descriptor 3 go to the alternative file. This allows you to keep normal output for the monitor and redirect special information to files, such as log files.</p>
<p class="calibre10">You can also use the <code class="calibre26">exec</code> command to append data to an existing file instead of creating a new file:</p>
<pre class="calibre29"><code class="calibre26">exec 3&gt;&gt;test13out</code></pre>
<p class="calibre10">Now the output is appended to the <code class="calibre26">test13out</code> file instead of creating a new file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Redirecting file descriptors</h3>
<p class="calibre10">Here's the trick to help you bring back a redirected file descriptor. You can assign an alternative file descriptor to a standard file descriptor, and vice versa. This means that you can redirect the original location of <code class="calibre26">STDOUT</code> to an alternative file descriptor and then redirect that file descriptor back to <code class="calibre26">STDOUT</code>. This might sound somewhat complicated, but in practice it's fairly straightforward. This example will clear things up for you:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test14
 #!/bin/bash
 # storing STDOUT, then coming back to it
 exec 3&gt;&amp;1
 exec 1&gt;test14out
 echo "This should store in the output file"
 echo "along with this line."
 exec 1&gt;&amp;3
 echo "Now things should be back to normal"
 $
 $ ./test14
 Now things should be back to normal
 $ cat test14out
 This should store in the output file
 along with this line.
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="405" id="calibre_link-740" class="calibre11"></span>This example is a little crazy so let's walk through it piece by piece. First, the script redirects file descriptor 3 to the current location of file descriptor 1, which is <code class="calibre26">STDOUT</code>. This means that any output sent to file descriptor 3 goes to the monitor.</p>
<p class="calibre10">The second <code class="calibre26">exec</code> command redirects <code class="calibre26">STDOUT</code> to a file. The shell now redirects any output sent to <code class="calibre26">STDOUT</code> directly to the output file. However, file descriptor 3 still points to the original location of <code class="calibre26">STDOUT</code>, which is the monitor. If you send output data to file descriptor 3 at this point, it still goes to the monitor, even though <code class="calibre26">STDOUT</code> is redirected.</p>
<p class="calibre10">After sending some output to <code class="calibre26">STDOUT</code>, which points to a file, the script then redirects <code class="calibre26">STDOUT</code> to the current location of file descriptor 3, which is still set to the monitor. This means that now <code class="calibre26">STDOUT</code> points to its original location, the monitor.</p>
<p class="calibre10">This method can get confusing, but it's a common way to temporarily redirect output in script files and then set the output back to the normal settings.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating input file descriptors</h3>
<p class="calibre10">You can redirect input file descriptors exactly the same way as output file descriptors. Save the <code class="calibre26">STDIN</code> file descriptor location to another file descriptor before redirecting it to a file; when you're finished reading the file, you can restore <code class="calibre26">STDIN</code> to its original location:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test15
 #!/bin/bash
 # redirecting input file descriptors
 exec 6&lt;&amp;0
 exec 0&lt; testfile
 count=1
 while read line
 do
    echo "Line #$count: $line"
    count=$[ $count + 1 ]
 done
 exec 0&lt;&amp;6
 read -p "Are you done now? " answer
 case $answer in
 Y|y) echo "Goodbye";;
 N|n) echo "Sorry, this is the end.";;
 esac
 $ ./test15
 Line #1: This is the first line.
 Line #2: This is the second line.
 Line #3: This is the third line.
 Are you done now? y
 Goodbye
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="406" id="calibre_link-741" class="calibre11"></span>In this example, file descriptor 6 is used to hold the location for <code class="calibre26">STDIN</code>. The script then redirects <code class="calibre26">STDIN</code> to a file. All the input for the <code class="calibre26">read</code> command comes from the redirected <code class="calibre26">STDIN</code>, which is now the input file.</p>
<p class="calibre10">When all the lines have been read, the script returns <code class="calibre26">STDIN</code> to its original location by redirecting it to file descriptor 6. The script tests to make sure that <code class="calibre26">STDIN</code> is back to normal by using another read command, which this time waits for input from the keyboard.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating a read/write file descriptor</h3>
<p class="calibre10">As odd as it may seem, you can also open a single file descriptor for both input and output. You can then use the same file descriptor to both read data from a file and write data to the same file.</p>
<p class="calibre10">You need to be especially careful with this method, however. As you read and write data to and from a file, the shell maintains an internal pointer, indicating where it is in the file. Any reading or writing occurs where the file pointer last left off. This can produce some interesting results if you're not careful. Look at this example:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test16
 #!/bin/bash
 # testing input/output file descriptor
 exec 3&lt;&gt; testfile
 read line &lt;&amp;3
 echo "Read: $line"
 echo "This is a test line" &gt;&amp;3
 $ cat testfile
 This is the first line.
 This is the second line.
 This is the third line.
 $ ./test16
 Read: This is the first line.
 $ cat testfile
 This is the first line.
 This is a test line
 ine.
 This is the third line.
 $</code></pre>
<p class="calibre10">This example uses the <code class="calibre26">exec</code> command to assign file descriptor 3 for both input and output sent to and from the file <code class="calibre26">testfile</code>. Next, it uses the <code class="calibre26">read</code> command to read the first line in the file, using the assigned file descriptor, and then it displays the read line of data in <code class="calibre26">STDOUT</code>. After that, it uses the <code class="calibre26">echo</code> statement to write a line of data to the file opened with the same file descriptor.</p>
<p class="calibre10"><span type="pagebreak" title="407" id="calibre_link-742" class="calibre11"></span>When you run the script, at first things look just fine. The output shows that the script read the first line in the <code class="calibre26">testfile</code> file. However, if you display the contents of the <code class="calibre26">testfile</code> file after running the script, you see that the data written to the file overwrote the existing data.</p>
<p class="calibre10">When the script writes data to the file, it starts where the file pointer is located. The <code class="calibre26">read</code> command reads the first line of data, so it left the file pointer pointing to the first character in the second line of data. When the <code class="calibre26">echo</code> statement outputs data to the file, it places the data at the current location of the file pointer, overwriting whatever data was there.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Closing file descriptors</h3>
<p class="calibre10">If you create new input or output file descriptors, the shell automatically closes them when the script exits. There are situations, however, when you need to manually close a file descriptor before the end of the script.</p>
<p class="calibre10">To close a file descriptor, redirect it to the special symbol <code class="calibre26">&amp;-</code>. This is how this looks in the script:</p>
<pre class="calibre29"><code class="calibre26"> exec 3&gt;&amp;-</code></pre>
<p class="calibre10">This statement closes file descriptor 3, preventing it from being used any more in the script. Here's an example of what happens when you try to use a closed file descriptor:</p>
<pre class="calibre29"><code class="calibre26"> $ cat badtest
 #!/bin/bash
 # testing closing file descriptors
 exec 3&gt; test17file
 echo "This is a test line of data" &gt;&amp;3
 exec 3&gt;&amp;-
 echo "This won't work" &gt;&amp;3
 $ ./badtest
 ./badtest: 3: Bad file descriptor
 $</code></pre>
<p class="calibre10">After you close the file descriptor, you can't write any data to it in your script or the shell produces an error message.</p>
<p class="calibre10">There's yet another thing to be careful of when closing file descriptors. If you open the same output file later on in your script, the shell replaces the existing file with a new file. This means that if you output any data, it overwrites the existing file. Consider the following example of this problem:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test17
 #!/bin/bash
 # testing closing file descriptors
 exec 3&gt; test17file
 echo "This is a test line of data" &gt;&amp;3
 exec 3&gt;&amp;-
 cat test17file
 exec 3&gt; test17file
 echo "This'll be bad" &gt;&amp;3
 $ ./test17
 This is a test line of data
 $ cat test17file
 This'll be bad
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="408" id="calibre_link-743" class="calibre11"></span>After sending a data string to the <code class="calibre26">test17file</code> file and closing the file descriptor, the script uses the <code class="calibre26">cat</code> command to display the contents of the file. So far, so good. Next, the script reopens the output file and sends another data string to it. When you display the contents of the output file, all you see is the second data string. The shell overwrote the original output file.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-234" class="calibre4"></a>Listing Open File Descriptors</h2>
<p class="calibre10">With only nine file descriptors available to you, you'd think that it wouldn't be hard to keep things straight. Sometimes, however, it's easy to get lost when trying to keep track of which file descriptor is redirected where. To help you keep your sanity, the bash shell provides the <code class="calibre26">lsof</code> command.</p>
<p class="calibre10">The <code class="calibre26">lsof</code> command lists all the open file descriptors on the entire Linux system. This is somewhat of a controversial feature, because it can provide information about the Linux system to non-system-administrators. That's why many Linux systems hide this command so users don't accidentally stumble across it.</p>
<p class="calibre10">On many Linux systems (such as Fedora) the <code class="calibre26">lsof</code> command is located in the <code class="calibre26">/usr/sbin</code> directory. To run it with a normal user account, I have to reference it by its full pathname:</p>
<pre class="calibre29"><code class="calibre26"> $ /usr/sbin/lsof</code></pre>
<p class="calibre10">This produces an amazing amount of output. It displays information about every file currently open on the Linux system. This includes all the processes running on background, as well as any user accounts logged in to the system.</p>
<p class="calibre10"><span type="pagebreak" title="409" id="calibre_link-744" class="calibre11"></span>Plenty of command line parameters and options are available to help filter out the <code class="calibre26">lsof</code> output. The most commonly used are <code class="calibre26">-p</code>, which allows you to specify a process ID (<code class="calibre26">PID</code>), and <code class="calibre26">-d</code>, which allows you to specify the file descriptor numbers to display.</p>
<p class="calibre10">To easily determine the current PID of the process, you can use the special environment variable <code class="calibre26">$$</code>, which the shell sets to the current PID. The <code class="calibre26">-a</code> option is used to perform a Boolean <code class="calibre26">AND</code> of the results of the other two options, to produce the following:</p>
<pre class="calibre29"><code class="calibre26"> $ /usr/sbin/lsof -a -p $$ -d 0,1,2
 COMMAND  PID USER   FD   TYPE DEVICE SIZE NODE NAME
 bash    3344 rich    0u   CHR  136,0         2 /dev/pts/0
 bash    3344 rich    1u   CHR  136,0         2 /dev/pts/0
 bash    3344 rich    2u   CHR  136,0         2 /dev/pts/0
 $</code></pre>
<p class="calibre10">This shows the default file descriptors (0, 1, and 2) for the current process (the bash shell). The default output of <code class="calibre26">lsof</code> contains several columns of information, described in <a id="calibre_link-1215" href="#calibre_link-1147" class="calibre4">Table 15.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1147" href="#calibre_link-1215" class="calibre4"><b class="calibre21">Table 15.2</b></a></span> Default lsof Output</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Column</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">COMMAND</td>
<td class="left">The first nine characters of the name of the command in the process</td>
</tr>
<tr class="calibre28">
<td class="left">PID</td>
<td class="left">The process ID of the process</td>
</tr>
<tr class="calibre28">
<td class="left">USER</td>
<td class="left">The login name of the user who owns the process</td>
</tr>
<tr class="calibre28">
<td class="left">FD</td>
<td class="left">The file descriptor number and access type [r&mdash;(read), w&mdash;(write), u&mdash;(read/write)]</td>
</tr>
<tr class="calibre28">
<td class="left">TYPE</td>
<td class="left">The type of file [CHR&mdash;(character), BLK&mdash; (block), DIR&mdash; (directory), REG&mdash;(regular file)]</td>
</tr>
<tr class="calibre28">
<td class="left">DEVICE</td>
<td class="left">The device numbers (major and minor) of the device</td>
</tr>
<tr class="calibre28">
<td class="left">SIZE</td>
<td class="left">If available, the size of the file</td>
</tr>
<tr class="calibre28">
<td class="left">NODE</td>
<td class="left">The node number of the local file</td>
</tr>
<tr class="calibre28">
<td class="left">NAME</td>
<td class="left">The name of the file</td>
</tr>
</table>
</figure>
<p class="calibre10">The file type associated with <code class="calibre26">STDIN</code>, <code class="calibre26">STDOUT</code>, and <code class="calibre26">STDERR</code> is character mode. Because the <code class="calibre26">STDIN</code>, <code class="calibre26">STDOUT</code>, and <code class="calibre26">STDERR</code> file descriptors all point to the terminal, the name of the output file is the device name of the terminal. All three standard files are available for both reading and writing (although it does seem odd to be able to write to <code class="calibre26">STDIN</code> and read from <code class="calibre26">STDOUT</code>).</p>
<p class="calibre10">Now, let's look at the results of the <code class="calibre26">lsof</code> command from inside a script that's opened a couple of alternative file descriptors:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test18
 #!/bin/bash
 # testing lsof with file descriptors
 exec 3&gt; test18file1
 exec 6&gt; test18file2
 exec 7&lt; testfile
 /usr/sbin/lsof -a -p $$ -d0,1,2,3,6,7
 $ ./test18
 COMMAND  PID USER   FD   TYPE DEVICE SIZE   NODE NAME
 test18  3594 rich    0u   CHR  136,0           2 /dev/pts/0
 test18  3594 rich    1u   CHR  136,0           2 /dev/pts/0
 test18  3594 rich    2u   CHR  136,0           2 /dev/pts/0
 18  3594 rich    3w   REG  253,0    0 360712 /home/rich/test18file1
 18  3594 rich    6w   REG  253,0    0 360715 /home/rich/test18file2
 18  3594 rich    7r   REG  253,0   73 360717 /home/rich/testfile
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="410" id="calibre_link-745" class="calibre11"></span>The script creates three alternative file descriptors, two for output (3 and 6) and one for input (7). When the script runs the <code class="calibre26">lsof</code> command, you can see the new file descriptors in the output. We truncated the first part of the output so you could see the results of the filename. The filename shows the complete pathname for the files used in the file descriptors. It shows each of the files as type <code class="calibre26">REG</code>, which indicates that they are regular files on the filesystem.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-235" class="calibre4"></a>Suppressing Command Output</h2>
<p class="calibre10">Sometimes, you may not want to display any output from your script. This often occurs if you're running a script as a background process (see Chapter 16). If any error messages occur from the script while it's running in the background, the shell e-mails them to the owner of the process. This can get tedious, especially if you run scripts that generate minor nuisance errors.</p>
<p class="calibre10">To solve that problem, you can redirect <code class="calibre26">STDERR</code> to a special file called the <i class="calibre12">null file</i>. The null file is pretty much what it says it is &mdash; a file that contains nothing. Any data that the shell outputs to the null file is not saved, thus the data are lost.</p>
<p class="calibre10">The standard location for the null file on Linux systems is <code class="calibre26">/dev/null</code>. Any data you redirect to that location is thrown away and doesn't appear:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al &gt; /dev/null
 $ cat /dev/null
 $</code></pre>
<p class="calibre10">This is a common way to suppress any error messages without actually saving them:</p>
<pre class="calibre29"><code class="calibre26"> $ ls -al badfile test16 2&gt; /dev/null
 -rwxr--r--    1 rich     rich          135 Oct 29 19:57 test16*
 $</code></pre>
<p class="calibre10">You can also use the <code class="calibre26">/dev/null</code> file for input redirection as an input file. Because the <code class="calibre26">/dev/null</code> file contains nothing, it is often used by programmers to quickly remove data from an existing file without having to remove the file and re-create it:</p>
<pre class="calibre29"><code class="calibre26"> $ cat testfile
 This is the first line.
 This is the second line.
 This is the third line.
 $ cat /dev/null &gt; testfile
 $ cat testfile
 $</code></pre>
<p class="calibre10">The file <code class="calibre26">testfile</code> still exists on the system, but now it is empty. This is a common method used to clear out log files that must remain in place for applications to operate.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-236" class="calibre4"></a>Using Temporary Files</h2>
<p class="calibre10"><span type="pagebreak" title="411" id="calibre_link-746" class="calibre11"></span>The Linux system contains a special directory location reserved for temporary files. Linux uses the <code class="calibre26">/tmp</code> directory for files that don't need to be kept indefinitely. Most Linux distributions configure the system to automatically remove any files in the <code class="calibre26">/tmp</code> directory at bootup.</p>
<p class="calibre10">Any user account on the system has privileges to read and write files in the <code class="calibre26">/tmp</code> directory. This feature provides an easy way for you to create temporary files that you don't necessarily have to worry about cleaning up.</p>
<p class="calibre10">There's even a specific command to use for creating a temporary file. The <code class="calibre26">mktemp</code> command allows you to easily create a unique temporary file in the <code class="calibre26">/tmp</code> folder. The shell creates the file but doesn't use your default umask value (see Chapter 7). Instead, it only assigns read and write permissions to the file's owner and makes you the owner of the file. After you create the file, you have full access to read and write to and from it from your script, but no one else can access it (other than the root user, of course).</p>
<section class="toclist">
<h3 class="calibre15">Creating a local temporary file</h3>
<p class="calibre10">By default, <code class="calibre26">mktemp</code> creates a file in the local directory. To create a temporary file in a local directory with the <code class="calibre26">mktemp</code> command, you just need to specify a filename template. The template consists of any text filename, plus six X's appended to the end of the filename:</p>
<pre class="calibre29"><code class="calibre26"> $ mktemp testing.XXXXXX
 $ ls -al testing*
 -rw-------   1 rich     rich      0 Oct 17 21:30 testing.UfIi13
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="412" id="calibre_link-747" class="calibre11"></span>The <code class="calibre26">mktemp</code> command replaces the six X's with a six-character code to ensure the filename is unique in the directory. You can create multiple temporary files and be assured that each one is unique:</p>
<pre class="calibre29"><code class="calibre26"> $ mktemp testing.XXXXXX
 testing.1DRLuV
 $ mktemp testing.XXXXXX
 testing.lVBtkW
 $ mktemp testing.XXXXXX
 testing.PgqNKG
 $ ls -l testing*
 -rw-------    1 rich     rich     0 Oct 17 21:57 testing.1DRLuV
 -rw-------    1 rich     rich     0 Oct 17 21:57 testing.PgqNKG
 -rw-------    1 rich     rich     0 Oct 17 21:30 testing.UfIi13
 -rw-------    1 rich     rich     0 Oct 17 21:57 testing.lVBtkW
 $</code></pre>
<p class="calibre10">As you can see, the output of the <code class="calibre26">mktemp</code> command is the name of the file that it creates. When you use the <code class="calibre26">mktemp</code> command in a script, you'll want to save that filename in a variable, so you can refer to it later on in the script:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test19
 #!/bin/bash
 # creating and using a temp file
 tempfile=$(mktemp test19.XXXXXX)
 exec 3&gt;$tempfile
 echo "This script writes to temp file $tempfile"
 echo "This is the first line" &gt;&amp;3
 echo "This is the second line." &gt;&amp;3
 echo "This is the last line." &gt;&amp;3
 exec 3&gt;&amp;-
 echo "Done creating temp file. The contents are:"
 cat $tempfile
 rm -f $tempfile 2&gt; /dev/null
 $ ./test19
 This script writes to temp file test19.vCHoya
 Done creating temp file. The contents are:
 This is the first line
 This is the second line.
 This is the last line.
 $ ls -al test19*
 -rwxr--r--    1 rich     rich          356 Oct 29 22:03 test19*
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="413" id="calibre_link-748" class="calibre11"></span>The script uses the <code class="calibre26">mktemp</code> command to create a temporary file and assigns the filename to the <code class="calibre26">$tempfile</code> variable. It then uses the temporary file as the output redirection file for file descriptor 3. After displaying the temporary filename on <code class="calibre26">STDOUT</code>, it writes a few lines to the temporary file, and then it closes the file descriptor. Finally, it displays the contents of the temporary file and then uses the <code class="calibre26">rm</code> command to remove it.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating a temporary file in /tmp</h3>
<p class="calibre10">The <code class="calibre26">-t</code> option forces <code class="calibre26">mktemp</code> to create the file in the temporary directory of the system. When you use this feature, the <code class="calibre26">mktemp</code> command returns the full pathname used to create the temporary file, not just the filename:</p>
<pre class="calibre29"><code class="calibre26"> $ mktemp -t test.XXXXXX
 /tmp/test.xG3374
 $ ls -al /tmp/test*
 -rw------- 1 rich rich 0 2014-10-29 18:41 /tmp/test.xG3374
 $</code></pre>
<p class="calibre10">Because the <code class="calibre26">mktemp</code> command returns the full pathname, you can then reference the temporary file from any directory on the Linux system, no matter where it places the temporary directory:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test20
 #!/bin/bash
 # creating a temp file in /tmp
 tempfile=$(mktemp -t tmp.XXXXXX)
 echo "This is a test file." &gt; $tempfile
 echo "This is the second line of the test." &gt;&gt; $tempfile
 echo "The temp file is located at: $tempfile"
 cat $tempfile
 rm -f $tempfile
 $ ./test20
 The temp file is located at: /tmp/tmp.Ma3390
 This is a test file.
 This is the second line of the test.
 $</code></pre>
<p class="calibre10">When <code class="calibre26">mktemp</code> creates the temporary file, it returns the full pathname to the environment variable. You can then use that value in any command to reference the temporary file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating a temporary directory</h3>
<p class="calibre10">The <code class="calibre26">-d</code> option tells the <code class="calibre26">mktemp</code> command to create a temporary directory instead of a file. You can then use that directory for whatever purposes you need, such as creating additional temporary files:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test21
 #!/bin/bash
 # using a temporary directory
 tempdir=$(mktemp -d dir.XXXXXX)
 cd $tempdir
 tempfile1=$(mktemp temp.XXXXXX)
 tempfile2=$(mktemp temp.XXXXXX)
 exec 7&gt; $tempfile1
 exec 8&gt; $tempfile2
 echo "Sending data to directory $tempdir"
 echo "This is a test line of data for $tempfile1" &gt;&amp;7
 echo "This is a test line of data for $tempfile2" &gt;&amp;8
 $ ./test21
 Sending data to directory dir.ouT8S8
 $ ls -al
 total 72
 drwxr-xr-x    3 rich     rich         4096 Oct 17 22:20 ./
 drwxr-xr-x    9 rich     rich         4096 Oct 17 09:44 ../
 drwx------    2 rich     rich         4096 Oct 17 22:20 dir.ouT8S8/
 -rwxr--r--    1 rich     rich          338 Oct 17 22:20 test21*
 $ cd dir.ouT8S8
 [dir.ouT8S8]$ ls -al
 total 16
 drwx------    2 rich     rich         4096 Oct 17 22:20 ./
 drwxr-xr-x    3 rich     rich         4096 Oct 17 22:20 ../
 -rw-------    1 rich     rich           44 Oct 17 22:20 temp.N5F3O6
 -rw-------    1 rich     rich           44 Oct 17 22:20 temp.SQslb7
 [dir.ouT8S8]$ cat temp.N5F3O6
 This is a test line of data for temp.N5F3O6
 [dir.ouT8S8]$ cat temp.SQslb7
 This is a test line of data for temp.SQslb7
 [dir.ouT8S8]$</code></pre>
<p class="calibre10"><span type="pagebreak" title="414" id="calibre_link-749" class="calibre11"></span>The script creates a directory in the current directory and uses the <code class="calibre26">cd</code> command to change to that directory before creating two temporary files. The two temporary files are then assigned to file descriptors and used to store output from the script.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-237" class="calibre4"></a>Logging Messages</h2>
<p class="calibre10">Sometimes, it's beneficial to send output both to the monitor and to a file for logging. Instead of having to redirect output twice, you can use the special <code class="calibre26">tee</code> command.</p>
<p class="calibre10">The <code class="calibre26">tee</code> command is like a T-connector for pipes. It sends data from <code class="calibre26">STDIN</code> to two destinations at the same time. One destination is <code class="calibre26">STDOUT</code>. The other destination is a filename specified on the <code class="calibre26">tee</code> command line:</p>
<pre class="calibre29"><code class="calibre26"> tee <i class="calibre12">filename</i></code></pre>
<p class="calibre10"><span type="pagebreak" title="415" id="calibre_link-750" class="calibre11"></span>Because <code class="calibre26">tee</code> redirects data from <code class="calibre26">STDIN</code>, you can use it with the pipe command to redirect output from any command:</p>
<pre class="calibre29"><code class="calibre26"> $ date | tee testfile
 Sun Oct 19 18:56:21 EDT 2014
 $ cat testfile
 Sun Oct 19 18:56:21 EDT 2014
 $</code></pre>
<p class="calibre10">The output appears in <code class="calibre26">STDOUT</code> and is written to the file specified. Be careful: By default, the <code class="calibre26">tee</code> command overwrites the output file on each use:</p>
<pre class="calibre29"><code class="calibre26"> $ who | tee testfile
 rich     pts/0        2014-10-17 18:41 (192.168.1.2)
 $ cat testfile
 rich     pts/0        2014-10-17 18:41 (192.168.1.2)
 $</code></pre>
<p class="calibre10">If you want to append data to the file, you must use the <code class="calibre26">-a</code> option:</p>
<pre class="calibre29"><code class="calibre26"> $ date | tee -a testfile
 Sun Oct 19 18:58:05 EDT 2014
 $ cat testfile
 rich     pts/0        2014-10-17 18:41 (192.168.1.2)
 Sun Oct 19 18:58:05 EDT 2014
 $</code></pre>
<p class="calibre10">Using this technique, you can both save data in files and display the data on the monitor for your users:</p>
<pre class="calibre29"><code class="calibre26"> $ cat test22
 #!/bin/bash
 # using the tee command for logging
 tempfile=test22file
 echo "This is the start of the test" | tee $tempfile
 echo "This is the second line of the test" | tee -a $tempfile
 echo "This is the end of the test" | tee -a $tempfile
 $ ./test22
 This is the start of the test
 This is the second line of the test
 This is the end of the test
 $ cat test22file
 This is the start of the test
 This is the second line of the test
 This is the end of the test
 $</code></pre>
<p class="calibre10">Now you can save a permanent copy of your output at the same time as you're displaying it to your users.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-238" class="calibre4"></a>Practical Example</h2>
<p class="calibre10"><span type="pagebreak" title="416" id="calibre_link-751" class="calibre11"></span>File redirection is very common both when reading files into scripts and when outputting data from a script into a file. This example script does both of those things. It reads a .csv-formatted data file and outputs <code class="calibre26">SQL INSERT</code> statements to insert the data into a database (see Chapter 25).</p>
<p class="calibre10">The shell script uses a command line parameter to define the name of the <code class="calibre26">.csv</code> file from which to read the data. The <code class="calibre26">.csv</code> format is used to export data from spreadsheets, so you can place the database data into a spreadsheet, save the spreadsheet in <code class="calibre26">.csv</code> format, read the file, and create <code class="calibre26">INSERT</code> statements to insert the data into a MySQL database.</p>
<p class="calibre10">Here's what the script looks like:</p>
<pre class="calibre29"><code class="calibre26">$cat test23
#!/bin/bash
# read file and create INSERT statements for MySQL
outfile='members.sql'
IFS=','
while read lname fname address city state zip
do
   cat &gt;&gt; $outfile &lt;&lt; EOF
   INSERT INTO members (lname,fname,address,city,state,zip) VALUES
('$lname', '$fname', '$address', '$city', '$state', '$zip');
EOF
done &lt; ${1}
$</code></pre>
<p class="calibre10">That's a pretty short script, thanks to the file redirection that goes on! There are three redirection operations happening in the script. The <code class="calibre26">while</code> loop uses the <code class="calibre26">read</code> statement (discussed in Chapter 14) to read text from the data file. Notice in the <code class="calibre26">done</code> statement the redirection symbol:</p>
<pre class="calibre29"><code class="calibre26">done &lt; ${1}</code></pre>
<p class="calibre10">The <code class="calibre26">$1</code> represents the first command line parameter when you run the <code class="calibre26">test23</code> program. That specifies the data file from which to read the data. The <code class="calibre26">read</code> statement parses the text using the <code class="calibre26">IFS</code> character, which we specify as a comma.</p>
<p class="calibre10">The other two redirection operations in the script both appear in the same statement:</p>
<pre class="calibre29"><code class="calibre26">cat &gt;&gt; $outfile &lt;&lt; EOF</code></pre>
<p class="calibre10"><span type="pagebreak" title="417" id="calibre_link-752" class="calibre11"></span>This one statement has one output append redirection (the double greater-than symbol) and one input append redirection (the double less-than symbol). The output redirection appends the <code class="calibre26">cat</code> command output to the file specified by the <code class="calibre26">$outfile</code> variable. The input to the <code class="calibre26">cat</code> command is redirected from the standard input to use the data stored inside the script. The EOF symbol marks the start and end delimiter of the data that's appended to the file:</p>
<pre class="calibre29"><code class="calibre26">INSERT INTO members (lname,fname,address,city,state,zip) VALUES
('$lname', '$fname', '$address', '$city', '$state', '$zip');</code></pre>
<p class="calibre10">The text creates a standard <code class="calibre26">SQL INSERT</code> statement. Notice that the data values are replaced with the variables for the data read from the <code class="calibre26">read</code> statement.</p>
<p class="calibre10">So basically the <code class="calibre26">while</code> loop reads on the data one line at a time, plugs those data values into the <code class="calibre26">INSERT</code> statement template, then outputs the result to the output file.</p>
<p class="calibre10">For this experiment, I used this as the input data file:</p>
<pre class="calibre29"><code class="calibre26">$ cat members.csv
Blum,Richard,123 Main St.,Chicago,IL,60601
Blum,Barbara,123 Main St.,Chicago,IL,60601
Bresnahan,Christine,456 Oak Ave.,Columbus,OH,43201
Bresnahan,Timothy,456 Oak Ave.,Columbus,OH,43201
$</code></pre>
<p class="calibre10">When you run the script, nothing appears in the output on the monitor:</p>
<pre class="calibre29"><code class="calibre26">$ ./test23 &lt; members.csv
$</code></pre>
<p class="calibre10">But when you look at the <code class="calibre26">members.sql</code> output file, you should see the output data:</p>
<pre class="calibre29"><code class="calibre26">$ cat members.sql
   INSERT INTO members (lname,fname,address,city,state,zip) VALUES ('Blum',
 'Richard', '123 Main St.', 'Chicago', 'IL', '60601');
   INSERT INTO members (lname,fname,address,city,state,zip) VALUES ('Blum',
 'Barbara', '123 Main St.', 'Chicago', 'IL', '60601');
   INSERT INTO members (lname,fname,address,city,state,zip) VALUES ('Bresnahan',
 'Christine', '456 Oak Ave.', 'Columbus', 'OH', '43201');
   INSERT INTO members (lname,fname,address,city,state,zip) VALUES ('Bresnahan',
 'Timothy', '456 Oak Ave.', 'Columbus', 'OH', '43201');</code></pre>
<pre class="calibre29"><code class="calibre26">$</code></pre>
<p class="calibre10">The script worked exactly as expected! Now you can easily import the <code class="calibre26">members.sql</code> file into a MySQL database table (see Chapter 25).</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-239" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="418" id="calibre_link-753" class="calibre11"></span>Understanding how the bash shell handles input and output can come in handy when creating your scripts. You can manipulate both how the script receives data and how it displays data, to customize your script for any environment. You can redirect the input of a script from the standard input (<code class="calibre26">STDIN</code>) to any file on the system. You can also redirect the output of the script from the standard output (<code class="calibre26">STDOUT</code>) to any file on the system.</p>
<p class="calibre10">Besides the <code class="calibre26">STDOUT</code>, you can redirect any error messages your script generates by redirecting the <code class="calibre26">STDERR</code> output. This is accomplished by redirecting the file descriptor associated with the <code class="calibre26">STDERR</code> output, which is file descriptor 2. You can redirect <code class="calibre26">STDERR</code> output to the same file as the <code class="calibre26">STDOUT</code> output or to a completely separate file. This enables you to separate normal script messages from any error messages generated by the script.</p>
<p class="calibre10">The bash shell allows you to create your own file descriptors for use in your scripts. You can create file descriptors 3 through 8 and assign them to any output file you desire. After you create a file descriptor, you can redirect the output of any command to it, using the standard redirection symbols.</p>
<p class="calibre10">The bash shell also allows you to redirect input to a file descriptor, providing an easy way to read data contained in a file into your script. You can use the <code class="calibre26">lsof</code> command to display the active file descriptors in your shell.</p>
<p class="calibre10">Linux systems provide a special file, called <code class="calibre26">/dev/null</code>, to allow you to redirect output that you don't want. The Linux system discards anything redirected to the <code class="calibre26">/dev/null</code> file. You can also use this file to produce an empty file by redirecting the contents of the <code class="calibre26">/dev/null</code> file to the file.</p>
<p class="calibre10">The <code class="calibre26">mktemp</code> command is a handy feature of the bash shell that allows you to easily create temporary files and directories. Simply specify a template for the <code class="calibre26">mktemp</code> command, and it creates a unique file each time you call it, based on the file template format. You can also create temporary files and directories in the <code class="calibre26">/tmp</code> directory on the Linux system, which is a special location that isn't preserved between system boots.</p>
<p class="calibre10">The <code class="calibre26">tee</code> command is a handy way to send output both to the standard output and to a log file. This enables you to display messages from your script on the monitor and store them in a log file at the same time.</p>
<p class="calibre10">In Chapter 16, you'll see how to control and run your scripts. Linux provides several different methods for running scripts other than directly from the command line interface prompt. You'll see how to schedule your scripts to run at a specific time, as well as learn how to pause them while they're running.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-51">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-240" class="calibre4"></a><span class="chaptertitle">Chapter 16</span><br class="calibre22" /><span class="chaptertitle">Script Control</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Handling signals</li>
<li class="calibre7">Running scripts in the background</li>
<li class="calibre7">Forbidding hang-ups</li>
<li class="calibre7">Controlling a Job</li>
<li class="calibre7">Modifying script priority</li>
<li class="calibre7">Automating script execution</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="419" id="calibre_link-754" class="calibre11"></span>As you start building advanced scripts, you'll probably wonder how to run and control them on your Linux system. So far in this book, the only way we've run scripts is directly from the command line interface in real-time mode. This isn't the only way to run scripts in Linux. Quite a few options are available for running your shell scripts. There are also options for controlling your scripts. Various control methods include sending signals to your script, modifying a script's priority, and switching the run mode while a script is running. This chapter examines the different ways you can control your shell scripts.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-241" class="calibre4"></a>Handling Signals</h2>
<p class="calibre10">Linux uses signals to communicate with processes running on the system. Chapter 4 described the different Linux signals and how the Linux system uses these signals to stop, start, and kill processes. You can control the operation of your shell script by programming the script to perform certain commands when it receives specific signals.</p>
<section class="toclist">
<h3 class="calibre15">Signaling the bash shell</h3>
<p class="calibre10">There are more than 30 Linux signals that can be generated by the system and applications. <a id="calibre_link-53" href="#calibre_link-52" class="calibre4">Table 16.1</a> lists the most common Linux system signals that you'll run across in your shell script writing.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-52" href="#calibre_link-53" class="calibre4"><b class="calibre21">Table 16.1</b></a></span> Linux Signals</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Signal</td>
<td class="left"></td>
<td class="left">Value</td>
<td class="left"></td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26"> 1</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGHUP</code></td>
<td class="left"></td>
<td class="left">Hangs up the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26"> 2</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGINT</code></td>
<td class="left"></td>
<td class="left">Interrupts the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26"> 3</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGQUIT</code></td>
<td class="left"></td>
<td class="left">Stops the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26"> 9</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGKILL</code></td>
<td class="left"></td>
<td class="left">Unconditionally terminates the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">15</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGTERM</code></td>
<td class="left"></td>
<td class="left">Terminates the process if possible</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">17</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGSTOP</code></td>
<td class="left"></td>
<td class="left">Unconditionally stops, but doesn't terminate, the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">18</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGTSTP</code></td>
<td class="left"></td>
<td class="left">Stops or pauses the process, but doesn't terminate</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">19</code></td>
<td class="left"></td>
<td class="left"><code class="calibre26">SIGCONT</code></td>
<td class="left"></td>
<td class="left">Continues a stopped process</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="420" id="calibre_link-755" class="calibre11"></span>By default, the bash shell ignores any <code class="calibre26">SIGQUIT (3)</code> and <code class="calibre26">SIGTERM (15)</code> signals it receives (so an interactive shell cannot be accidentally terminated). However, the bash shell does not ignore any <code class="calibre26">SIGHUP (1)</code> and <code class="calibre26">SIGINT (2)</code> signals it receives.</p>
<p class="calibre10">If the bash shell receives a <code class="calibre26">SIGHUP</code> signal, such as when you leave an interactive shell, it exits. Before it exits, however, it passes the <code class="calibre26">SIGHUP</code> signal to any processes started by the shell, including any running shell scripts.</p>
<p class="calibre10">With a <code class="calibre26">SIGINT</code> signal, the shell is just interrupted. The Linux kernel stops giving the shell processing time on the CPU. When this happens, the shell passes the <code class="calibre26">SIGINT</code> signal to any processes started by the shell to notify them of the situation.</p>
<p class="calibre10">As you probably have noticed, the shell passes these signals on to your shell script program for processing. However, a shell script's default behavior does not govern these signals, which may have an adverse effect on the script's operation. To avoid this situation, you can program your script to recognize signals and perform commands to prepare the script for the consequences of the signal.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Generating signals</h3>
<p class="calibre10">The bash shell allows you to generate two basic Linux signals using key combinations on the keyboard. This feature comes in handy if you need to stop or pause a runaway script.</p>
<section class="toclist">
<h4 class="calibre25">Interrupting a process</h4>
<p class="calibre10">The Ctrl+C key combination generates a <code class="calibre26">SIGINT</code> signal and sends it to any processes currently running in the shell. You can test this by running a command that normally takes a long time to finish and pressing the Ctrl+C key combination:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 100</b></code>
^C
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="421" id="calibre_link-756" class="calibre11"></span>The Ctrl+C key combination sends a <code class="calibre26">SIGINT</code> signal, which simply stops the current process running in the shell. The <code class="calibre26">sleep</code> command pauses the shell's operation for the specified number of seconds and returns the shell prompt. By pressing the Ctrl+C key combination before the time passed, the <code class="calibre26">sleep</code> command terminated prematurely.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Pausing a process</h4>
<p class="calibre10">Instead of terminating a process, you can pause it in the middle of whatever it's doing. Sometimes, this can be a dangerous thing (for example, if a script has a file lock open on a crucial system file), but often it allows you to peek inside what a script is doing without actually terminating the process.</p>
<p class="calibre10">The Ctrl+Z key combination generates a <code class="calibre26">SIGTSTP</code> signal, stopping any processes running in the shell. Stopping a process is different than terminating the process. Stopping the process leaves the program in memory and able to continue running from where it left off. In the âControlling the Jobâ section later in this chapter, you learn how to restart a process that's been stopped.</p>
<p class="calibre10">When you use the Ctrl+Z key combination, the shell informs you that the process has been stopped:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 100</b></code>
^Z
[1]+  Stopped                 sleep 100
$</code></pre>
<p class="calibre10">The number in the square brackets is the <i class="calibre12">job number</i> assigned by the shell. The shell refers to each process running in the shell as a <i class="calibre12">job</i> and assigns each job a unique job number within the current shell. It assigns the first started process job number 1, the second job number 2, and so on.</p>
<p class="calibre10">If you have a stopped job assigned to your shell session, bash warns you if you try to exit the shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 100</b></code>
^Z
[1]+  Stopped                 sleep 100
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
There are stopped jobs.
$</code></pre>
<p class="calibre10">You can view the stopped jobs using the <code class="calibre26">ps</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sleep 100</b></code>
^Z
[1]+  Stopped                 sleep 100
$
$ <code class="calibre26"><b class="calibre21">ps -l</b></code>
F S UID   PID  PPID  C PRI NI ADDR SZ WCHAN  TTY       TIME CMD
0 S 501  2431  2430  0  80  0 - 27118 wait   pts/0 00:00:00 bash
0 T 501  2456  2431  0  80  0 - 25227 signal pts/0 00:00:00 sleep
0 R 501  2458  2431  0  80  0 - 27034 -      pts/0 00:00:00 ps
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="422" id="calibre_link-757" class="calibre11"></span>In the <code class="calibre26">S</code> column (process state), the <code class="calibre26">ps</code> command shows the stopped job's state as T. This indicates the command is either being traced or is stopped.</p>
<p class="calibre10">If you really want to exit the shell with a stopped job still active, just type the <code class="calibre26">exit</code> command again. The shell exits, terminating the stopped job. Alternately, now that you know the PID of the stopped job, you can use the <code class="calibre26">kill</code> command to send a <code class="calibre26">SIGKILL</code> signal to terminate it:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">kill -9 2456</b></code>
$
[1]+  Killed                  sleep 100
$</code></pre>
<p class="calibre10">When you kill the job, initially you don't get any response. However, the next time you do something that produces a shell prompt (such as pressing the Enter key), you'll see a message indicating that the job was killed. Each time the shell produces a prompt, it also displays the status of any jobs that have changed states in the shell. After you kill a job, the next time you force the shell to produce a prompt, it displays a message showing that the job was killed while running.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Trapping signals</h3>
<p class="calibre10">Instead of allowing your script to leave signals ungoverned, you can trap them when they appear and perform other commands. The <code class="calibre26">trap</code> command allows you to specify which Linux signals your shell script can watch for and intercept from the shell. If the script receives a signal listed in the <code class="calibre26">trap</code> command, it prevents it from being processed by the shell and instead handles it locally.</p>
<p class="calibre10">The format of the <code class="calibre26">trap</code> command is:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">trap</b></code> <i class="calibre12">commands signals</i></code></pre>
<p class="calibre10">On the <code class="calibre26">trap</code> command line, you just list the commands you want the shell to execute, along with a space-separated list of signals you want to trap. You can specify the signals either by their numeric value or by their Linux signal name.</p>
<p class="calibre10">Here's a simple example of using the <code class="calibre26">trap</code> command to capture the <code class="calibre26">SIGINT</code> signal and govern the script's behavior when the signal is sent:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test1.sh</b></code>
#!/bin/bash
# Testing signal trapping
#
trap "echo ' Sorry! I have trapped Ctrl-C"' SIGINT
#
echo This is a test script
#
count=1
while [ $count -le 10 ]
do
   echo "Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
echo "This is the end of the test script"
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="423" id="calibre_link-758" class="calibre11"></span>The <code class="calibre26">trap</code> command used in this example displays a simple text message each time it detects the <code class="calibre26">SIGINT</code> signal. Trapping this signal makes this script impervious to the user attempting to stop the program by using the bash shell keyboard Ctrl+C command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test1.sh</b></code>
This is a test script
Loop #1
Loop #2
Loop #3
Loop #4
Loop #5
^C Sorry! I have trapped Ctrl-C
Loop #6
Loop #7
Loop #8
^C Sorry! I have trapped Ctrl-C
Loop #9
Loop #10
This is the end of the test script
$</code></pre>
<p class="calibre10">Each time the Ctrl+C key combination was used, the script executed the <code class="calibre26">echo</code> statement specified in the <code class="calibre26">trap</code> command instead of not managing the signal and allowing the shell to stop the script.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Trapping a script exit</h3>
<p class="calibre10">Besides trapping signals in your shell script, you can trap them when the shell script exits. This is a convenient way to perform commands just as the shell finishes its job.</p>
<p class="calibre10">To trap the shell script exiting, just add the <code class="calibre26">EXIT</code> signal to the <code class="calibre26">trap</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test2.sh</b></code>
#!/bin/bash
# Trapping the script exit
#
trap "echo Goodbye..." EXIT
#
count=1
while [ $count -le 5 ]
do
   echo "Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
$
$ <code class="calibre26"><b class="calibre21">./test2.sh</b></code>
Loop #1
Loop #2
Loop #3
Loop #4
Loop #5
Goodbye...
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="424" id="calibre_link-759" class="calibre11"></span>When the script gets to the normal exit point, the trap is triggered, and the shell executes the command you specify on the <code class="calibre26">trap</code> command line. The <code class="calibre26">EXIT</code> trap also works if you prematurely exit the script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test2.sh</b></code>
Loop #1
Loop #2
Loop #3
^CGoodbye...
$</code></pre>
<p class="calibre10">Because the <code class="calibre26">SIGINT</code> signal isn't listed in the <code class="calibre26">trap</code> command list, when the Ctrl+C key combination is used to send that signal, the script exits. However, before the script exits, because the <code class="calibre26">EXIT</code> is trapped, the shell executes the <code class="calibre26">trap</code> command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Modifying or removing a trap</h3>
<p class="calibre10">To handle traps differently in various sections of your shell script, you simply reissue the <code class="calibre26">trap</code> command with new options:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test3.sh</b></code>
#!/bin/bash
# Modifying a set trap
#
trap "echo ' Sorry... Ctrl-C is trapped."' SIGINT
#
count=1
while [ $count -le 5 ]
do
   echo "Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
trap "echo ' I modified the trap!"' SIGINT
#
count=1
while [ $count -le 5 ]
do
   echo "Second Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="425" id="calibre_link-760" class="calibre11"></span>After the signal trap is modified, the script manages the signal or signals differently. However, if a signal is received before the trap is modified, the script processes it per the original <code class="calibre26">trap</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test3.sh</b></code>
Loop #1
Loop #2
Loop #3
^C Sorry... Ctrl-C is trapped.
Loop #4
Loop #5
Second Loop #1
Second Loop #2
^C I modified the trap!
Second Loop #3
Second Loop #4
Second Loop #5
$</code></pre>
<p class="calibre10">You can also remove a set trap. Simply add two dashes after the <code class="calibre26">trap</code> command and a list of the signals you want to return to default behavior:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test3b.sh</b></code>
#!/bin/bash
# Removing a set trap
#
trap "echo ' Sorry... Ctrl-C is trapped."' SIGINT
#
count=1
while [ $count -le 5 ]
do
   echo "Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
# Remove the trap
trap -- SIGINT
echo "I just removed the trap"
#
count=1
while [ $count -le 5 ]
do
   echo "Second Loop #$count"
   sleep 1
   count=$[ $count + 1 ]
done
#
$ <code class="calibre26"><b class="calibre21">./test3b.sh</b></code>
Loop #1
Loop #2
Loop #3
Loop #4
Loop #5
I just removed the trap
Second Loop #1
Second Loop #2
Second Loop #3
^C
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You can use a single dash instead of a double dash after the <code class="calibre26">trap</code> command to return signals to their default behavior. Both the single and double dash work properly.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="426" id="calibre_link-761" class="calibre11"></span>After the signal trap is removed, the script handles the <code class="calibre26">SIGINT</code> signal in its default manner, terminating the script. However, if a signal is received before the trap is removed, the script processes it per the original <code class="calibre26">trap</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test3b.sh</b></code>
Loop #1
Loop #2
Loop #3
^C Sorry... Ctrl-C is trapped.
Loop #4
Loop #5
I just removed the trap
Second Loop #1
Second Loop #2
^C
$</code></pre>
<p class="calibre10">In this example, the first Ctrl+C key combination was used to attempt to terminate the script prematurely. Because the signal was received before the trap was removed, the script executed the command specified in the trap. After the script executed the trap removal, then Ctrl+C could prematurely terminate the script.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-242" class="calibre4"></a>Running Scripts in Background Mode</h2>
<p class="calibre10"><span type="pagebreak" title="427" id="calibre_link-762" class="calibre11"></span>Sometimes, running a shell script directly from the command line interface is inconvenient. Some scripts can take a long time to process, and you may not want to tie up the command line interface waiting. While the script is running, you can't do anything else in your terminal session. Fortunately, there's a simple solution to that problem.</p>
<p class="calibre10">When you use the <code class="calibre26">ps</code> command, you see a whole bunch of different processes running on the Linux system. Obviously, all these processes are not running on your terminal monitor. This is called running processes in the <i class="calibre12">background.</i> In background mode, a process runs without being associated with a <code class="calibre26">STDIN</code>, <code class="calibre26">STDOUT</code>, and <code class="calibre26">STDERR</code> on a terminal session (see Chapter 15).</p>
<p class="calibre10">You can exploit this feature with your shell scripts as well, allowing them to run behind the scenes and not lock up your terminal session. The following sections describe how to run your scripts in background mode on your Linux system.</p>
<section class="toclist">
<h3 class="calibre15">Running in the background</h3>
<p class="calibre10">Running a shell script in background mode is a fairly easy thing to do. To run a shell script in background mode from the command line interface, just place an ampersand symbol (&amp;) after the command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test4.sh</b></code>
#!/bin/bash
# Test running in the background
#
count=1
while [ $count -le 10 ]
do
   sleep 1
   count=$[ $count + 1 ]
done
#
$
$ <code class="calibre26"><b class="calibre21">./test4.sh &amp;</b></code>
[1] 3231
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="428" id="calibre_link-763" class="calibre11"></span>When you place the ampersand symbol after a command, it separates the command from the bash shell and runs it as a separate background process on the system. The first thing that displays is the line:</p>
<pre class="calibre29"><code class="calibre26">[1] 3231</code></pre>
<p class="calibre10">The number in the square brackets is the job number assigned by the shell to the background process. The next number is the Process ID (PID) the Linux system assigns to the process. Every process running on the Linux system must have a unique PID.</p>
<p class="calibre10">As soon as the system displays these items, a new command line interface prompt appears. You are returned to the shell, and the command you executed runs safely in background mode. At this point, you can enter new commands at the prompt.</p>
<p class="calibre10">When the background process finishes, it displays a message on the terminal:</p>
<pre class="calibre29"><code class="calibre26">[1]   Done                    ./test4.sh</code></pre>
<p class="calibre10">This shows the job number and the status of the job (<code class="calibre26">Done</code>), along with the command used to start the job.</p>
<p class="calibre10">Be aware that while the background process is running, it still uses your terminal monitor for <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> messages:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test5.sh</b></code>
#!/bin/bash
# Test running in the background with output
#
echo "Start the test script"
count=1
while [ $count -le 5 ]
do
   echo "Loop #$count"
   sleep 5
   count=$[ $count + 1 ]
done
#
echo "Test script is complete"
#
$
$ <code class="calibre26"><b class="calibre21">./test5.sh &amp;</b></code>
[1] 3275
$ Start the test script
Loop #1
Loop #2
Loop #3
Loop #4
Loop #5
Test script is complete
[1]   Done                    ./test5.sh
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="429" id="calibre_link-764" class="calibre11"></span>You'll notice from the example that the output from the <code class="calibre26">test5.sh</code> script displays. The output intermixes with the shell prompt, which is why <code class="calibre26">Start the test script</code> appears next to the <code class="calibre26">$</code> prompt.</p>
<p class="calibre10">You can still issue commands while this output is occurring:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test5.sh &amp;</b></code>
[1] 3319
$ Start the test script
Loop #1
Loop #2
Loop #3
<code class="calibre26"><b class="calibre21">ls myprog*</b></code>
myprog  myprog.c
$ Loop #4
Loop #5
Test script is complete
[1]+  Done                    ./test5.sh
$$</code></pre>
<p class="calibre10">While the <code class="calibre26">test5.sh</code> script is running in the background, the command <code class="calibre26">ls myprog*</code> was entered. The script's output, the typed command, and the command's output all intermixed with each other's output display. This can be confusing! It is a good idea to redirect <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> for scripts you will be running in the background (Chapter 15) to avoid this messy output.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Running multiple background jobs</h3>
<p class="calibre10">You can start any number of background jobs at the same time from the command line prompt:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26">./test6.sh &amp;</code>
[1] 3568
$ This is Test Script #1
$ <code class="calibre26">./test7.sh &amp;</code>
[2] 3570
$ This is Test Script #2
$ <code class="calibre26">./test8.sh &amp;</code>
[3] 3573
$ And...another Test script
$ <code class="calibre26">./test9.sh &amp;</code>
[4] 3576
$ Then...there was one more test script
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="430" id="calibre_link-765" class="calibre11"></span>Each time you start a new job, the Linux system assigns it a new job number and PID. You can see that all the scripts are running using the <code class="calibre26">ps</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26">ps</code>
  PID TTY          TIME CMD
 2431 pts/0    00:00:00 bash
 3568 pts/0    00:00:00 test6.sh
 3570 pts/0    00:00:00 test7.sh
 3573 pts/0    00:00:00 test8.sh
 3574 pts/0    00:00:00 sleep
 3575 pts/0    00:00:00 sleep
 3576 pts/0    00:00:00 test9.sh
 3577 pts/0    00:00:00 sleep
 3578 pts/0    00:00:00 sleep
 3579 pts/0    00:00:00 ps
$</code></pre>
<p class="calibre10">You must be careful when using background processes from a terminal session. Notice in the output from the <code class="calibre26">ps</code> command that each of the background processes is tied to the terminal session (pts/0) terminal. If the terminal session exits, the background process also exits.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Earlier in this chapter we mentioned that when you attempt to exit a terminal session, a warning is issued if there are stopped processes. However, with background processes, only some terminal emulators remind you that a background job is running, before you attempt to exit the terminal session.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">If you want your script to continue running in background mode after you have logged off the console, there's something else you need to do. The next section discusses that process.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-243" class="calibre4"></a>Running Scripts without a Hang-Up</h2>
<p class="calibre10">Sometimes, you may want to start a shell script from a terminal session and let the script run in background mode until it finishes, even if you exit the terminal session. You can do this by using the <code class="calibre26">nohup</code> command.</p>
<p class="calibre10">The <code class="calibre26"><span type="pagebreak" title="431" id="calibre_link-766" class="calibre11"></span>nohup</code> command runs another command blocking any <code class="calibre26">SIGHUP</code> signals that are sent to the process. This prevents the process from exiting when you exit your terminal session.</p>
<p class="calibre10">The format used for the <code class="calibre26">nohup</code> command is as follows:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26">nohup ./test1.sh &amp;</code>
[1] 3856
$ nohup: ignoring input and appending output to 'nohup.out'
$</code></pre>
<p class="calibre10">As with a normal background process, the shell assigns the command a job number, and the Linux system assigns a PID number. The difference is that when you use the <code class="calibre26">nohup</code> command, the script ignores any <code class="calibre26">SIGHUP</code> signals sent by the terminal session if you close the session.</p>
<p class="calibre10">Because the <code class="calibre26">nohup</code> command disassociates the process from the terminal, the process loses the <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> output links. To accommodate any output generated by the command, the <code class="calibre26">nohup</code> command automatically redirects <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> messages to a file, called <code class="calibre26">nohup.out</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you run another command using <code class="calibre26">nohup</code>, the output is appended to the existing <code class="calibre26">nohup.out</code> file. Be careful when running multiple commands from the same directory, because all the output is sent to the same <code class="calibre26">nohup.out</code> file, which can get confusing.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">nohup.out</code> file contains all the output that would normally be sent to the terminal monitor. After the process finishes running, you can view the <code class="calibre26">nohup.out</code> file for the output results:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26">cat nohup.out</code>
This is a test script
Loop 1
Loop 2
Loop 3
Loop 4
Loop 5
Loop 6
Loop 7
Loop 8
Loop 9
Loop 10
This is the end of the test script
$</code></pre>
<p class="calibre10">The output appears in the <code class="calibre26">nohup.out</code> file just as if the process ran on the command line.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-244" class="calibre4"></a>Controlling the Job</h2>
<p class="calibre10"><span type="pagebreak" title="432" id="calibre_link-767" class="calibre11"></span>Earlier in this chapter, you saw how to use the Ctrl+C key combination to stop a job running in the shell. After you stop a job, the Linux system lets you either kill or restart it. You can kill the process by using the <code class="calibre26">kill</code> command. Restarting a stopped process requires that you send it a <code class="calibre26">SIGCONT</code> signal.</p>
<p class="calibre10">The function of starting, stopping, killing, and resuming jobs is called <i class="calibre12">job control.</i> With job control, you have full control over how processes run in your shell environment. This section describes the commands used to view and control jobs running in your shell.</p>
<section class="toclist">
<h3 class="calibre15">Viewing jobs</h3>
<p class="calibre10">The key command for job control is the <code class="calibre26">jobs</code> command. The <code class="calibre26">jobs</code> command allows you to view the current jobs being handled by the shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26">cat test10.sh</code>
#!/bin/bash
# Test job control
#
echo "Script Process ID: $$"
#
count=1
while [ $count -le 10 ]
do
   echo "Loop #$count"
   sleep 10
   count=$[ $count + 1 ]
done
#
echo "End of script..."
#
$ </code></pre>
<p class="calibre10">The script uses the <code class="calibre26"><i class="calibre12">$$</i></code> variable to display the PID that the Linux system assigns to the script; then it goes into a loop, sleeping for 10 seconds at a time for each iteration.</p>
<p class="calibre10">You can start the script from the command line interface and then stop it using the Ctrl+Z key combination:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test10.sh</b></code>
Script Process ID: 1897
Loop #1
Loop #2
^Z
[1]+  Stopped                 ./test10.sh
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="433" id="calibre_link-768" class="calibre11"></span>Using the same script, another job is started as a background process, using the ampersand symbol. To make life a little easier, the output of that script is redirected to a file so it doesn't appear on the screen:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test10.sh &gt; test10.out &amp;</b></code>
[2] 1917
$</code></pre>
<p class="calibre10">The <code class="calibre26">jobs</code> command enables you to view the jobs assigned to the shell. The <code class="calibre26">jobs</code> command shows both the stopped and the running jobs, along with their job numbers and the commands used in the jobs:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Stopped                 ./test10.sh
[2]-  Running                 ./test10.sh &gt; test10.out &amp;
$</code></pre>
<p class="calibre10">You can view the various jobs' PIDs by adding the <code class="calibre26">-l</code> parameter (lowercase L) on the <code class="calibre26">jobs</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">jobs -l</b></code>
[1]+  1897 Stopped                 ./test10.sh
[2]-  1917 Running                 ./test10.sh &gt; test10.out &amp;
$</code></pre>
<p class="calibre10">The <code class="calibre26">jobs</code> command uses a few different command line parameters, as shown in <a id="calibre_link-55" href="#calibre_link-54" class="calibre4">Table 16.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-54" href="#calibre_link-55" class="calibre4"><b class="calibre21">Table 16.2</b></a></span> The jobs Command Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-l</code></td>
<td class="left">Lists the PID of the process along with the job number</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Lists only jobs that have changed their status since the last notification from the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-p</code></td>
<td class="left">Lists only the PIDs of the jobs</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-r</code></td>
<td class="left">Lists only the running jobs</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Lists only stopped jobs</td>
</tr>
</table>
</figure>
<p class="calibre10">You probably noticed the plus and minus signs in the <code class="calibre26">jobs</code> command output. The job with the plus sign is considered the default job. It would be the job referenced by any job control commands if a job number wasn't specified in the command line.</p>
<p class="calibre10">The job with the minus sign is the job that would become the default job when the current default job finishes processing. There will be only one job with the plus sign and one job with the minus sign at any time, no matter how many jobs are running in the shell.</p>
<p class="calibre10"><span type="pagebreak" title="434" id="calibre_link-769" class="calibre11"></span>The following is an example showing how the next job in line takes over the default status, when the default job is removed. Three separate processes are started in the background. The <code class="calibre26">jobs</code> command listing shows the three processes, their PID, and their status. Note that the default process (the one listed with the plus sign) is the last process started, job #3.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test10.sh &gt; test10a.out &amp;</b></code>
[1] 1950
$ <code class="calibre26"><b class="calibre21">./test10.sh &gt; test10b.out &amp;</b></code>
[2] 1952
$ <code class="calibre26"><b class="calibre21">./test10.sh &gt; test10c.out &amp;</b></code>
[3] 1955
$
$ <code class="calibre26"><b class="calibre21">jobs -l</b></code>
[1]   1950 Running                 ./test10.sh &gt; test10a.out &amp;
[2]-  1952 Running                 ./test10.sh &gt; test10b.out &amp;
[3]+  1955 Running                 ./test10.sh &gt; test10c.out &amp;
$</code></pre>
<p class="calibre10">Using the <code class="calibre26">kill</code> command to send a <code class="calibre26">SIGHUP</code> signal to the default process causes the job to terminate. In the next <code class="calibre26">jobs</code> listing, the job that previously had the minus sign now has the plus sign and is the default job:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">kill 1955</b></code>
$
[3]+  Terminated              ./test10.sh &gt; test10c.out
$
$ <code class="calibre26"><b class="calibre21">jobs -l</b></code>
[1]-  1950 Running                 ./test10.sh &gt; test10a.out &amp;
[2]+  1952 Running                 ./test10.sh &gt; test10b.out &amp;
$
$ <code class="calibre26"><b class="calibre21">kill 1952</b></code>
$
[2]+  Terminated              ./test10.sh &gt; test10b.out
$
$ <code class="calibre26"><b class="calibre21">jobs -l</b></code>
[1]+  1950 Running                 ./test10.sh &gt; test10a.out &amp;
$</code></pre>
<p class="calibre10">Although changing a background job to the default process is interesting, it doesn't seem very useful. In the next section, you learn how to use commands to interact with the default process using no PID or job number.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Restarting stopped jobs</h3>
<p class="calibre10">Under bash job control, you can restart any stopped job as either a background process or a foreground process. A foreground process takes over control of the terminal you're working on, so be careful about using that feature.</p>
<p class="calibre10">To restart a job in background mode, use the <code class="calibre26">bg</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test11.sh</b></code>
^Z
[1]+  Stopped                 ./test11.sh
$
$ <code class="calibre26"><b class="calibre21">bg</b></code>
[1]+ ./test11.sh &amp;
$
$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Running                 ./test11.sh &amp;
$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="435" id="calibre_link-770" class="calibre11"></span>Because the job was the default job, indicated by the plus sign, only the <code class="calibre26">bg</code> command was needed to restart it in background mode. Notice that no PID is listed when the job is moved into background mode.</p>
<p class="calibre10">If you have additional jobs, you need to use the job number along with the <code class="calibre26">bg</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test11.sh</b></code>
^Z
[1]+  Stopped                 ./test11.sh
$
$ <code class="calibre26"><b class="calibre21">./test12.sh</b></code>
^Z
[2]+  Stopped                 ./test12.sh
$
$ <code class="calibre26"><b class="calibre21">bg 2</b></code>
[2]+ ./test12.sh &amp;
$
$ <code class="calibre26"><b class="calibre21">jobs</b></code>
[1]+  Stopped                 ./test11.sh
[2]-  Running                 ./test12.sh &amp;
$</code></pre>
<p class="calibre10">The command <code class="calibre26">bg 2</code> was used to send the second job into background mode. Notice that when the <code class="calibre26">jobs</code> command was used, it listed both jobs with their status, even though the default job is not currently in background mode.</p>
<p class="calibre10">To restart a job in foreground mode, use the <code class="calibre26">fg</code> command, along with the job number:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">fg 2</b></code>
./test12.sh
This is the script's end...
$</code></pre>
<p class="calibre10">Because the job is running in foreground mode, the command line interface prompt does not appear until the job finishes.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-245" class="calibre4"></a>Being Nice</h2>
<p class="calibre10"><span type="pagebreak" title="436" id="calibre_link-771" class="calibre11"></span>In a multitasking operating system (which Linux is), the kernel is responsible for assigning CPU time for each process running on the system. The <i class="calibre12">scheduling priority</i> is the amount of CPU time the kernel assigns to the process relative to the other processes. By default, all processes started from the shell have the same scheduling priority on the Linux system.</p>
<p class="calibre10">The scheduling priority is an integer value, from -20 (the highest priority) to +19 (the lowest priority). By default, the bash shell starts all processes with a scheduling priority of 0.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">It's confusing to remember that <code class="calibre26">-20</code>, the lowest value, is the highest priority and <code class="calibre26">19</code>, the highest value, is the lowest priority. Just remember the phrase, âNice guys finish last.â The ânicerâ or higher you are in value, the lower your chance of getting the CPU.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Sometimes, you want to change the priority of a shell script, either lowering its priority so it doesn't take as much processing power away from other processes or giving it a higher priority so it gets more processing time. You can do this by using the <code class="calibre26">nice</code> command.</p>
<section class="toclist">
<h3 class="calibre15">Using the nice command</h3>
<p class="calibre10">The <code class="calibre26">nice</code> command allows you to set the scheduling priority of a command as you start it. To make a command run with less priority, just use the <code class="calibre26">-n</code> command line option for <code class="calibre26">nice</code> to specify a new priority level:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nice -n 10 ./test4.sh &gt; test4.out &amp;</b></code>
[1] 4973
$
$ <code class="calibre26"><b class="calibre21">ps -p 4973 -o pid,ppid,ni,cmd</b></code>
  PID  PPID  NI CMD
 4973  4721  10 /bin/bash ./test4.sh
$</code></pre>
<p class="calibre10">Notice that you must use the <code class="calibre26">nice</code> command on the same line as the command you are starting. The output from the <code class="calibre26">ps</code> command confirms that the nice value (column <code class="calibre26">NI</code>) has been set to <code class="calibre26">10</code>.</p>
<p class="calibre10">The <code class="calibre26">nice</code> command causes the script to run at a lower priority. However, if you try to increase the priority of one of your commands, you might be in for a surprise:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nice -n -10 ./test4.sh &gt; test4.out &amp;</b></code>
[1] 4985
$ nice: cannot set niceness: Permission denied
 [1]+  Done                    nice -n -10 ./test4.sh &gt; test4.out
$</code></pre>
<p class="calibre10">The <code class="calibre26">nice</code> command <span type="pagebreak" title="437" id="calibre_link-772" class="calibre11"></span>prevents normal system users from increasing the priority of their commands. Notice that the job does run, even though the attempt to raise its priority with the <code class="calibre26">nice</code> command failed.</p>
<p class="calibre10">You don't have to use the <code class="calibre26">-n</code> option with the <code class="calibre26">nice</code> command. You can simply type the priority preceded by a dash:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nice -10 ./test4.sh &gt; test4.out &amp;</b></code>
[1] 4993
$
$ <code class="calibre26"><b class="calibre21">ps -p 4993 -o pid,ppid,ni,cmd</b></code>
  PID  PPID  NI CMD
 4993  4721  10 /bin/bash ./test4.sh
$</code></pre>
<p class="calibre10">However, this can get confusing when the priority is a negative number, because you must have a double-dash. It's best just to use the <code class="calibre26">-n</code> option to avoid confusion.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using the renice command</h3>
<p class="calibre10">Sometimes, you'd like to change the priority of a command that's already running on the system. That's what the <code class="calibre26">renice</code> command is for. It allows you to specify the PID of a running process to change its priority:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./test11.sh &amp;</b></code>
[1] 5055
$
$ <code class="calibre26"><b class="calibre21">ps -p 5055 -o pid,ppid,ni,cmd</b></code>
  PID  PPID  NI CMD
 5055  4721   0 /bin/bash ./test11.sh
$
$ <code class="calibre26"><b class="calibre21">renice -n 10 -p 5055</b></code>
5055: old priority 0, new priority 10
$
$ <code class="calibre26"><b class="calibre21">ps -p 5055 -o pid,ppid,ni,cmd</b></code>
  PID  PPID  NI CMD
 5055  4721  10 /bin/bash ./test11.sh
$</code></pre>
<p class="calibre10">The <code class="calibre26">renice</code> command automatically updates the scheduling priority of the running process. As with the <code class="calibre26">nice</code> command, the <code class="calibre26">renice</code> command has some limitations:</p>
<ul class="calibre14">
<li class="calibre7">You can only <code class="calibre26">renice</code> processes that you own.</li>
<li class="calibre7">You can only <code class="calibre26">renice</code> your processes to a lower priority.</li>
<li class="calibre7">The root user can <code class="calibre26">renice</code> any process to any priority.</li>
</ul>
<p class="calibre10">If you want to fully control running processes, you must be logged in as the root account or use the <code class="calibre26">sudo</code> command.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-246" class="calibre4"></a>Running Like Clockwork</h2>
<p class="calibre10"><span type="pagebreak" title="438" id="calibre_link-773" class="calibre11"></span>When you start working with scripts, you may want to run a script at a preset time, usually at a time when you're not there. The Linux system provides a couple of ways to run a script at a preselected time: the <code class="calibre26">at</code> command and the <code class="calibre26">cron</code> table. Each method uses a different technique for scheduling when and how often to run scripts. The following sections describe each of these methods.</p>
<section class="toclist">
<h3 class="calibre15">Scheduling a job using the at command</h3>
<p class="calibre10">The <code class="calibre26">at</code> command allows you to specify a time when the Linux system will run a script. The <code class="calibre26">at</code> command submits a job to a queue with directions on when the shell should run the job. The <code class="calibre26">at</code> daemon, <code class="calibre26">atd</code>, runs in the background and checks the job queue for jobs to run. Most Linux distributions start this daemon automatically at boot time.</p>
<p class="calibre10">The <code class="calibre26">atd</code> daemon checks a special directory on the system (usually <code class="calibre26">/var/spool/at</code>) for jobs submitted using the <code class="calibre26">at</code> command. By default, the <code class="calibre26">atd</code> daemon checks this directory every 60 seconds. When a job is present, the <code class="calibre26">atd</code> daemon checks the time the job is set to be run. If the time matches the current time, the <code class="calibre26">atd</code> daemon runs the job.</p>
<p class="calibre10">The following sections describe how to use the <code class="calibre26">at</code> command to submit jobs to run and how to manage these jobs.</p>
<section class="toclist">
<h4 class="calibre25">Understanding the at command format</h4>
<p class="calibre10">The basic <code class="calibre26">at</code> command format is pretty simple:</p>
<pre class="calibre29"><code class="calibre26">at [-f <code class="calibre26"><i class="calibre12">filename</i></code>] <code class="calibre26"><i class="calibre12">time</i></code></code></pre>
<p class="calibre10">By default, the <code class="calibre26">at</code> command submits input from <code class="calibre26">STDIN</code> to the queue. You can specify a filename used to read commands (your script file) using the <code class="calibre26">-f</code> parameter.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">time</i></code> parameter specifies when you want the Linux system to run the job. If you specify a time that has already passed, the <code class="calibre26">at</code> command runs the job at that time on the next day.</p>
<p class="calibre10">You can get pretty creative with how you specify the time. The <code class="calibre26">at</code> command recognizes lots of different time formats:</p>
<ul class="calibre14">
<li class="calibre7">A standard hour and minute, such as 10:15</li>
<li class="calibre7">An AM/PM indicator, such as 10:15PM</li>
<li class="calibre7">A specific named time, such as now, noon, midnight, or teatime (4PM)</li>
</ul>
<p class="calibre10">In addition to specifying the time to run the job, you can also include a specific date, using a few different date formats:</p>
<ul class="calibre14">
<li class="calibre7">A standard date format, such as MMDDYY, MM/DD/YY, or DD.MM.YY</li>
<li class="calibre7">A text date, such as Jul 4 or Dec 25, with or without the year</li>
<li class="calibre7">A time increment:
<ul class="calibre31">
<li class="calibre7">Now + 25 minutes</li>
<li class="calibre7">10:15PM tomorrow</li>
<li class="calibre7">10:15 + 7 days</li>
</ul></li>
</ul>
<p class="calibre10">When you use the <code class="calibre26">at</code> command, the job is submitted into a <i class="calibre12">job queue</i>. The job queue <span type="pagebreak" title="439" id="calibre_link-774" class="calibre11"></span>holds the jobs submitted by the <code class="calibre26">at</code> command for processing. There are 26 different job queues available for different priority levels. Job queues are referenced using lowercase letters, <i class="calibre12">a</i> through <i class="calibre12">z</i>, and uppercase letters <i class="calibre12">A</i> through <i class="calibre12">Z</i>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">A few years ago, the <code class="calibre26">batch </code>command was another method that allowed a script to be run at a later time. The <code class="calibre26">batch</code> command was unique because you could schedule a script to run when the system was at a lower usage level. However, nowadays, the <code class="calibre26">batch</code> command is just simply a script, <code class="calibre26">/usr/bin/batch</code>, that calls the <code class="calibre26">at</code> command and submits your job to the <code class="calibre26">b</code> queue.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The higher alphabetically the job queue, the lower the priority (higher <code class="calibre26">nice</code> value) the job will run under. By default, <code class="calibre26">at</code> jobs are submitted to the <code class="calibre26">at</code> job <code class="calibre26">a</code> queue. If you want to run a job at a lower priority, you can specify a different queue letter using the <code class="calibre26">-q</code> parameter.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Retrieving job output</h4>
<p class="calibre10">When the job runs on the Linux system, there's no monitor associated with the job. Instead, the Linux system uses the e-mail address of the user who submitted the job as <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code>. Any output destined to <code class="calibre26">STDOUT</code> or <code class="calibre26">STDERR</code> is mailed to the user via the mail system.</p>
<p class="calibre10">Here's a simple example using the <code class="calibre26">at</code> command to schedule a job to run on a CentOS distribution:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test13.sh</b></code>
#!/bin/bash
# Test using at command
#
echo "This script ran at $(date +%B%d,%T)"
echo
sleep 5
echo "This is the script's end..."
#
$ <code class="calibre26"><b class="calibre21">at -f test13.sh now</b></code>
job 7 at 2015-07-14 12:38
$</code></pre>
<p class="calibre10">The <code class="calibre26">at</code> command <span type="pagebreak" title="440" id="calibre_link-775" class="calibre11"></span>displays the job number assigned to the job along with the time the job is scheduled to run. The <code class="calibre26">-f</code> option tells what script file to use and the <code class="calibre26">now</code> time designation directs <code class="calibre26">at</code> to run the script immediately.</p>
<p class="calibre10">Using e-mail for the <code class="calibre26">at</code> command's output is inconvenient at best. The <code class="calibre26">at</code> command sends e-mail via the sendmail application. If your system does not use sendmail, you won't get any output! Therefore, it's best to redirect <code class="calibre26">STDOUT</code> and <code class="calibre26">STDERR</code> in your scripts (see Chapter 15) when using the <code class="calibre26">at</code> command, as the following example shows:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat test13b.sh</b></code>
#!/bin/bash
# Test using at command
#
echo "This script ran at $(date +%B%d,%T)" &gt; test13b.out
echo &gt;&gt; test13b.out
sleep 5
echo "This is the script's end..." &gt;&gt; test13b.out
#
$
$ <code class="calibre26"><b class="calibre21">at -M -f test13b.sh now</b></code>
job 8 at 2015-07-14 12:48
$
$ <code class="calibre26"><b class="calibre21">cat test13b.out</b></code>
This script ran at July14,12:48:18
This is the script's end...
$</code></pre>
<p class="calibre10">If you don't want to use e-mail or redirection with <code class="calibre26">at</code>, it is best to add the <code class="calibre26">-M</code> option to suppress any output generated by jobs using the <code class="calibre26">at</code> command.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Listing pending jobs</h4>
<p class="calibre10">The <code class="calibre26">atq</code> command allows you to view what jobs are pending on the system:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">at -M -f test13b.sh teatime</b></code>
<code class="calibre26">job 17 at 2015-07-14 16:00</code>
<code class="calibre26">$</code>
<code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">at -M -f test13b.sh tomorrow</b></code>
<code class="calibre26">job 18 at 2015-07-15 13:03</code>
<code class="calibre26">$</code>
<code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">at -M -f test13b.sh 13:30</b></code>
<code class="calibre26">job 19 at 2015-07-14 13:30</code>
<code class="calibre26">$</code>
<code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">at -M -f test13b.sh now</b></code>
<code class="calibre26">job 20 at 2015-07-14 13:03</code>
<code class="calibre26">$</code>
<code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">atq</b></code>
<code class="calibre26">20      2015-07-14 13:03 = Christine</code>
<code class="calibre26">18      2015-07-15 13:03 a Christine</code>
<code class="calibre26">17      2015-07-14 16:00 a Christine</code>
<code class="calibre26">19      2015-07-14 13:30 a Christine</code>
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="441" id="calibre_link-776" class="calibre11"></span>The job listing shows the job number, the date and time the system will run the job, and the job queue the job is stored in.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Removing jobs</h4>
<p class="calibre10">After you know the information about what jobs are pending in the job queues, you can use the <code class="calibre26">atrm</code> command to remove a pending job:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">atq</b></code>
18      2015-07-15 13:03 a Christine
17      2015-07-14 16:00 a Christine
19      2015-07-14 13:30 a Christine
$
$ <code class="calibre26"><b class="calibre21">atrm 18</b></code>
$
$ <code class="calibre26"><b class="calibre21">atq</b></code>
17      2015-07-14 16:00 a Christine
19      2015-07-14 13:30 a Christine
$</code></pre>
<p class="calibre10">Just specify the job number you want to remove. You can only remove jobs that you submit for execution. You can't remove jobs submitted by others.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Scheduling regular scripts</h3>
<p class="calibre10">Using the <code class="calibre26">at</code> command to schedule a script to run at a preset time is great, but what if you need that script to run at the same time every day or once a week or once a month? Instead of having to continually submit <code class="calibre26">at</code> jobs, you can use another feature of the Linux system.</p>
<p class="calibre10">The Linux system uses the <code class="calibre26">cron</code> program to allow you to schedule jobs that need to run on a regular basis. The <code class="calibre26">cron</code> program runs in the background and checks special tables, called <i class="calibre12">cron tables,</i> for jobs that are scheduled to run.</p>
<section class="toclist">
<h4 class="calibre25">Looking at the cron table</h4>
<p class="calibre10">The <code class="calibre26">cron</code> table uses a special format for allowing you to specify when a job should be run. The format for the <code class="calibre26">cron</code> table is:</p>
<pre class="calibre29"><code class="calibre26"><i class="calibre12">min hour dayofmonth month dayofweek command</i></code></pre>
<p class="calibre10"><span type="pagebreak" title="442" id="calibre_link-777" class="calibre11"></span>The <code class="calibre26">cron</code> table allows you to specify entries as specific values, ranges of values (such as 1&ndash;5), or as a wildcard character (the asterisk). For example, if you want to run a command at 10:15 on every day, you would use this <code class="calibre26">cron</code> table entry:</p>
<pre class="calibre29"><code class="calibre26">15 10 * * * <code class="calibre26"><i class="calibre12">command</i></code></code></pre>
<p class="calibre10">The wildcard character used in the <code class="calibre26"><i class="calibre12">dayofmonth</i></code>, <code class="calibre26"><i class="calibre12">month</i></code>, and <code class="calibre26"><i class="calibre12">dayofweek</i></code> fields indicates that <code class="calibre26">cron</code> will execute the command every day of every month at 10:15. To specify a command to run at 4:15 PM every Monday, you would use the following:</p>
<pre class="calibre29"><code class="calibre26">15 16 * * 1 <code class="calibre26"><i class="calibre12">command</i></code></code></pre>
<p class="calibre10">You can specify the <code class="calibre26"><i class="calibre12">dayofweek</i></code> entry as either a three-character text value (mon, tue, wed, thu, fri, sat, sun) or as a numeric value, with 0 being Sunday and 6 being Saturday.</p>
<p class="calibre10">Here's another example: to execute a command at 12 noon on the first day of every month, you would use the following format:</p>
<pre class="calibre29"><code class="calibre26">00 12 1 * * <code class="calibre26"><i class="calibre12">command</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">dayofmonth</i></code> entry specifies a date value (1&ndash;31) for the month.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The astute reader might be wondering just how you would be able to set a command to execute on the last day of every month because you can't set the <code class="calibre26"><i class="calibre12">dayofmonth</i></code> value to cover every month. This problem has plagued Linux and Unix programmers, and has spawned quite a few different solutions. A common method is to add an <code class="calibre26">if-then</code> statement that uses the date command to check if tomorrow's date is 01:</p>
<ol class="none">
<li class="calibre7">00 12 * * * if [<code class="calibre26">"</code>date +%d -d tomorrow<code class="calibre26">"</code> = 01 ] ; then ; <code class="calibre26"><i class="calibre12">command</i></code>
</li>
</ol>
<p class="calibre19">This checks every day at 12 noon to see if it's the last day of the month, and if so, <code class="calibre26">cron</code> runs the command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The command list must specify the full command pathname or shell script to run. You can add any command line parameters or redirection symbols you like, as a regular command line:</p>
<pre class="calibre29"><code class="calibre26">15 10 * * * /home/rich/test4.sh &gt; test4out</code></pre>
<p class="calibre10">The <code class="calibre26">cron</code> program runs the script using the user account that submitted the job. Thus, you must have the proper permissions to access the command and output files specified in the command listing.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Building the cron table</h4>
<p class="calibre10">Each system user can have their own <code class="calibre26">cron</code> table (including the root user) for running scheduled jobs. Linux provides the <code class="calibre26">crontab</code> command for handling the <code class="calibre26">cron</code> table. To list an existing <code class="calibre26">cron</code> table, use the <code class="calibre26">-l</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">crontab -l</b></code>
no crontab for rich
$</code></pre>
<p class="calibre10">By default, each user's <code class="calibre26">cron</code> table file doesn't exist. To add entries to your <code class="calibre26">cron</code> table, use the <code class="calibre26">-e</code> parameter. When you do that, the <code class="calibre26">crontab</code> command starts a text editor (see Chapter 10) with the existing <code class="calibre26">cron</code> table (or an empty file if it doesn't yet exist).</p>
</section>
<section class="toclist">
<h4 class="calibre25">Viewing cron directories</h4>
<p class="calibre10"><span type="pagebreak" title="443" id="calibre_link-778" class="calibre11"></span>When you create a script that has less precise execution time needs, it is easier to use one of the pre-configured <code class="calibre26">cron</code> script directories. There are four basic directories: hourly, daily, monthly, and weekly.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls /etc/cron.*ly</b></code>
/etc/cron.daily:
cups       makewhatis.cron  prelink         tmpwatch
logrotate  mlocate.cron     readahead.cron
/etc/cron.hourly:
0anacron
/etc/cron.monthly:
readahead-monthly.cron
/etc/cron.weekly:
$</code></pre>
<p class="calibre10">Thus, if you have a script that needs to be run one time per day, just copy the script to the daily directory and <code class="calibre26">cron</code> executes it each day.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Looking at the anacron program</h4>
<p class="calibre10">The only problem with the <code class="calibre26">cron</code> program is that it assumes that your Linux system is operational 24 hours a day, 7 days a week. Unless you're running Linux in a server environment, this may not necessarily be true.</p>
<p class="calibre10">If the Linux system is turned off at the time a job is scheduled to run in the <code class="calibre26">cron</code> table, the job doesn't run. The <code class="calibre26">cron</code> program doesn't retroactively run missed jobs when the system is turned back on. To resolve this issue, many Linux distributions also include the <code class="calibre26">anacron</code> program.</p>
<p class="calibre10">If <code class="calibre26">anacron</code> determines that a job has missed a scheduled running, it runs the job as soon as possible. This means that if your Linux system is turned off for a few days, when it starts back up, any jobs scheduled to run during the time it was off are automatically run.</p>
<p class="calibre10">This feature is often used for scripts that perform routine log maintenance. If the system is always off when the script should run, the log files would never get trimmed and could grow to undesirable sizes. With <code class="calibre26">anacron</code>, you're guaranteed that the log files are trimmed at least each time the system is started.</p>
<p class="calibre10"><span type="pagebreak" title="444" id="calibre_link-779" class="calibre11"></span>The <code class="calibre26">anacron</code> program deals only with programs located in the <code class="calibre26">cron</code> directories, such as <code class="calibre26">/etc/cron.monthly</code>. It uses timestamps to determine if the jobs have been run at the proper scheduled interval. A timestamp file exists for each <code class="calibre26">cron</code> directory and is located in <code class="calibre26">/var/spool/anacron</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo cat /var/spool/anacron/cron.monthly</b></code>
20150626
$</code></pre>
<p class="calibre10">The <code class="calibre26">anacron</code> program has its own table (usually located at <code class="calibre26">/etc/anacrontab</code>) to check the job directories:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo cat /etc/anacrontab</b></code>
# /etc/anacrontab: configuration file for anacron
# See anacron(8) and anacrontab(5) for details.
SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=3-22
#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7       25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45     cron.monthly            nice run-parts /etc/cron.monthly</code></pre>
<pre class="calibre29"><code class="calibre26">$</code></pre>
<p class="calibre10">The basic format of the <code class="calibre26">anacron</code> table is slightly different from that of the <code class="calibre26">cron</code> table:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">period delay identifier command</i></code></code></pre>
<p class="calibre10">The period entry defines how often the jobs should be run, specified in days. The <code class="calibre26">anacron</code> program uses this entry to check against the jobs' timestamp file. The delay entry specifies how many minutes after the system starts the <code class="calibre26">anacron</code> program should run missed scripts. The command entry contains the <code class="calibre26">run-parts</code> program and a <code class="calibre26">cron</code> script directory name. The <code class="calibre26">run-parts</code> program is responsible for running any script in the directory passed to it.</p>
<p class="calibre10">Notice that <code class="calibre26">anacron</code> does not run the scripts located in <code class="calibre26">/etc/cron.hourly</code>. This is because the <code class="calibre26">anacron</code> program does not deal with scripts that have execution time needs of less than daily.</p>
<p class="calibre10"><span type="pagebreak" title="445" id="calibre_link-780" class="calibre11"></span>The identifier entry is a unique non-blank character string &mdash; for example, <code class="calibre26">cron-weekly</code>. It is used to uniquely identify the job in log messages and error e-mails.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Starting scripts with a new shell</h3>
<p class="calibre10">The ability to run a script every time a user starts a new bash shell (even just when a specific user starts a bash shell) can come in handy. Sometimes, you want to set shell features for a shell session or just ensure that a specific file has been set.</p>
<p class="calibre10">Recall the startup files run when a user logs into the bash shell (covered in detail in Chapter6). Also, remember that not every distribution has all the startup files. Essentially, the first file found in the following ordered list is run and the rest are ignored:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">$HOME/.bash_profile</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.bash_login</code></li>
<li class="calibre7"><code class="calibre26">$HOME/.profile</code></li>
</ul>
<p class="calibre10">Therefore, you should place any scripts you want run at login time in the first file listed.</p>
<p class="calibre10">The bash shell runs the <code class="calibre26">.bashrc</code> file any time a new shell is started. You can test this by adding a simple echo statement to the <code class="calibre26">.bashrc</code> file in your home directory and starting a new shell:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat .bashrc</b></code>
# .bashrc
# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc	
fi
# User specific aliases and functions
echo "I'm in a new shell!"
$
$ <code class="calibre26"><b class="calibre21">bash</b></code>
I'm in a new shell!
$
$ <code class="calibre26"><b class="calibre21">exit</b></code>
exit
$</code></pre>
<p class="calibre10">The <code class="calibre26">.bashrc</code> file is also typically run from one of the bash startup files. Because the <code class="calibre26">.bashrc</code> file runs both when you log into the bash shell and when you start a bash shell, if you need a script to run in both instances, place your shell script inside this file.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-247" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="446" id="calibre_link-781" class="calibre11"></span>The Linux system allows you to control your shell scripts by using signals. The bash shell accepts signals and passes them on to any process running under the shell process. Linux signals allow you to easily kill a runaway process or temporarily pause a long-running process.</p>
<p class="calibre10">You can use the <code class="calibre26">trap</code> statement in your scripts to catch signals and perform commands. This feature provides a simple way to control whether a user can interrupt your script while it's running.</p>
<p class="calibre10">By default, when you run a script in a terminal session shell, the interactive shell is suspended until the script completes. You can cause a script or command to run in background mode by adding an ampersand sign (&amp;) after the command name. When you run a script or command in background mode, the interactive shell returns, allowing you to continue entering more commands. Any background processes run using this method are still tied to the terminal session. If you exit the terminal session, the background processes also exit.</p>
<p class="calibre10">To prevent this from happening, use the <code class="calibre26">nohup</code> command. This command intercepts any signals intended for the command that would stop it &mdash; for example, when you exit the terminal session. This allows scripts to continue running in background mode even if you exit the terminal session.</p>
<p class="calibre10">When you move a process to background mode, you can still control what happens to it. The jobs command allows you to view processes started from the shell session. After you know the job ID of a background process, you can use the <code class="calibre26">kill</code> command to send Linux signals to the process or use the <code class="calibre26">fg</code> command to bring the process back to the foreground in the shell session. You can suspend a running foreground process by using the Ctrl+Z key combination and place it back in background mode, using the <code class="calibre26">bg</code> command.</p>
<p class="calibre10">The <code class="calibre26">nice</code> and <code class="calibre26">renice</code> commands allow you to change the priority level of a process. By giving a process a lower priority, you allow the CPU to allocate less time to it. This comes in handy when running long processes that can take lots of CPU time.</p>
<p class="calibre10">In addition to controlling processes while they're running, you can also determine when a process starts on the system. Instead of running a script directly from the command line interface prompt, you can schedule the process to run at an alternative time. You can accomplish this in several different ways. The <code class="calibre26">at</code> command enables you to run a script once at a preset time. The <code class="calibre26">cron</code> program provides an interface that can run scripts at a regularly scheduled interval.</p>
<p class="calibre10">Finally, the Linux system provides script files for you to use for scheduling your scripts to run whenever a user starts a new bash shell. Similarly, the startup files, such as <code class="calibre26">.bashrc</code>, are located in every user's home directory to provide a location to place scripts and commands that run with a new shell.</p>
<p class="calibre10">In the next chapter, we look at how to write script functions. Script functions allow you to write code blocks once and then use them in multiple locations throughout your script.</p>
</section>
</section>
</div>


<div class="calibre1" id="calibre_link-87">
<header class="calibre8">
<h1 class="calibre9"><span class="chaptertitle">Part III</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5">Advanced Shell Scripting</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This <span type="pagebreak" title="447" id="calibre_link-1307" class="calibre30"></span>Part</h1>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-88" class="calibre4"><b class="calibre21">Chapter 17</b> Creating Functions</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-89" class="calibre4"><b class="calibre21">Chapter 18</b> Writing Scripts for Graphical Desktops</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-90" class="calibre4"><b class="calibre21">Chapter 19</b> Introducing sed and gawk</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-91" class="calibre4"><b class="calibre21">Chapter 20</b> Regular Expressions</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-92" class="calibre4"><b class="calibre21">Chapter 21</b> Advanced sed</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-93" class="calibre4"><b class="calibre21">Chapter 22</b> Advanced gawk</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-94" class="calibre4"><b class="calibre21">Chapter 23</b> Working with Alternative Shells</a></li>
</ol>
</section>
</aside>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-88">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-248" class="calibre4"></a><span class="chaptertitle">Chapter 17</span><br class="calibre22" /><span class="chaptertitle">Creating Functions</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Basic script functions</li>
<li class="calibre7">Returning a value</li>
<li class="calibre7">Using variables in functions</li>
<li class="calibre7">Array and variable functions</li>
<li class="calibre7">Function recursion</li>
<li class="calibre7">Creating a library</li>
<li class="calibre7">Using functions on the command line</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="449" id="calibre_link-782" class="calibre11"></span>Often while writing shell scripts, you'll find yourself using the same code in multiple locations. If it's just a small code snippet, it's usually not that big of a deal. However, rewriting large chunks of code multiple times in your shell script can get tiring. The bash shell provides a way to help you out by supporting user-defined functions. You can encapsulate your shell script code into a function and use it as many times as you want anywhere in your script. This chapter walks you through the process of creating your own shell script functions and demonstrates how to use them in other shell script applications.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-249" class="calibre4"></a>Basic Script Functions</h2>
<p class="calibre10">As you start writing more complex shell scripts, you'll find yourself reusing parts of code that perform specific tasks. Sometimes, it's something simple, such as displaying a text message and retrieving an answer from the script users. Other times, it's a complicated calculation that's used multiple times in your script as part of a larger process.</p>
<p class="calibre10">In each of these situations, it can get tiresome writing the same blocks of code over and over in your script. It would be nice to just write the block of code once and be able to refer to that block of code anywhere in your script without having to rewrite it.</p>
<p class="calibre10">The bash shell provides a feature allowing you to do just that. <i class="calibre12">Functions</i> are blocks of script code that you assign a name to and reuse anywhere in your code. Anytime you need to use that block of code in your script, you <span type="pagebreak" title="450" id="calibre_link-783" class="calibre11"></span>simply use the function name you assigned it (referred to as <i class="calibre12">calling</i> the function). This section describes how to create and use functions in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Creating a function</h3>
<p class="calibre10">There are two formats you can use to create functions in bash shell scripts. The first format uses the keyword <code class="calibre26">function</code>, along with the function name you assign to the block of code:</p>
<pre class="calibre29"><code class="calibre26">function <code class="calibre26"><i class="calibre12">name</i></code> {
    <code class="calibre26"><i class="calibre12">commands</i></code>
}</code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">name</i></code> attribute defines a unique name assigned to the function. Each function you define in your script must be assigned a unique name.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">commands</i></code> are one or more bash shell commands that make up your function. When you call the function, the bash shell executes each of the commands in the order they appear in the function, just as in a normal script.</p>
<p class="calibre10">The second format for defining a function in a bash shell script more closely follows how functions are defined in other programming languages:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">name</i></code>() {
<code class="calibre26"><i class="calibre12">commands</i></code>
}</code></pre>
<p class="calibre10">The empty parentheses after the function name indicate that you're defining a function. The same naming rules apply in this format as in the original shell script function format.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using functions</h3>
<p class="calibre10">To use a function in your script, specify the function name on a line, just as you would any other shell command:</p>
<pre class="calibre29"><code class="calibre26">$ cat test1
#!/bin/bash
# using a function in a script
function func1 {
   echo "This is an example of a function"
}
count=1
while [ $count -le 5 ]
do
   func1
   count=$[ $count + 1 ]
done
echo "This is the end of the loop"
func1
echo "Now this is the end of the script"
$
$ ./test1
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is the end of the loop
This is an example of a function
Now this is the end of the script
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="451" id="calibre_link-784" class="calibre11"></span>Each time you reference the <code class="calibre26">func1</code> function name, the bash shell returns to the <code class="calibre26">func1 function</code> definition and executes any commands you defined there.</p>
<p class="calibre10">The function definition doesn't have to be the first thing in your shell script, but be careful. If you attempt to use a function before it's defined, you'll get an error message:</p>
<pre class="calibre29"><code class="calibre26">$ cat test2
#!/bin/bash
# using a function located in the middle of a script
count=1
echo "This line comes before the function definition"
function func1 {
   echo "This is an example of a function"
}
while [ $count -le 5 ]
do
   func1
   count=$[ $count + 1 ]
done
echo "This is the end of the loop"
func2
echo "Now this is the end of the script"
function func2 {
   echo "This is an example of a function"
}
$
$ ./test2
This line comes before the function definition
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is the end of the loop
./test2: func2: command not found
Now this is the end of the script
$</code></pre>
<p class="calibre10">The first function, <code class="calibre26">func1</code>, was defined after a couple of statements in the script, which is perfectly fine. When the <code class="calibre26">func1</code> function <span type="pagebreak" title="452" id="calibre_link-785" class="calibre11"></span>was used in the script, the shell knew where to find it.</p>
<p class="calibre10">However, the script attempted to use the <code class="calibre26">func2</code> function before it was defined. Because the <code class="calibre26">func2</code> function wasn't defined, when the script reached the place where we used it, it produced an error message.</p>
<p class="calibre10">You also need to be careful about your function names. Remember, each function name must be unique, or you'll have a problem. If you redefine a function, the new definition overrides the original function definition, without producing any error messages:</p>
<pre class="calibre29"><code class="calibre26">$ cat test3
#!/bin/bash
# testing using a duplicate function name
function func1 {
echo "This is the first definition of the function name"
}
func1
function func1 {
   echo "This is a repeat of the same function name"
}
func1
echo "This is the end of the script"
$
$ ./test3
This is the first definition of the function name
This is a repeat of the same function name
This is the end of the script
$</code></pre>
<p class="calibre10">The original definition of the <code class="calibre26">func1</code> function works fine, but after the second definition of the <code class="calibre26">func1</code> function, any subsequent uses of the function use the second definition.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-250" class="calibre4"></a>Returning a Value</h2>
<p class="calibre10"><span type="pagebreak" title="453" id="calibre_link-786" class="calibre11"></span>The bash shell treats functions like mini-scripts, complete with an exit status (see Chapter11). There are three different ways you can generate an exit status for your functions.</p>
<section class="toclist">
<h3 class="calibre15">The default exit status</h3>
<p class="calibre10">By default, the exit status of a function is the exit status returned by the last command in the function. After the function executes, you use the standard <code class="calibre26"><i class="calibre12">$?</i></code> variable to determine the exit status of the function:</p>
<pre class="calibre29"><code class="calibre26">$ cat test4
#!/bin/bash
# testing the exit status of a function
func1() {
   echo "trying to display a non-existent file"
   ls -l badfile
}
echo "testing the function: "
func1
echo "The exit status is: $?"
$
$ ./test4
testing the function:
trying to display a non-existent file
ls: badfile: No such file or directory
The exit status is: 1
$</code></pre>
<p class="calibre10">The exit status of the function is 1 because the last command in the function failed. However, you have no way of knowing if any of the other commands in the function completed successfully or not. Look at this example:</p>
<pre class="calibre29"><code class="calibre26">$ cat test4b
#!/bin/bash
# testing the exit status of a function
func1() {
   ls -l badfile
   echo "This was a test of a bad command"
}
echo "testing the function:"
func1
echo "The exit status is: $?"
$
$ ./test4b
testing the function:
ls: badfile: No such file or directory
This was a test of a bad command
The exit status is: 0
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="454" id="calibre_link-787" class="calibre11"></span>This time, because the function ended with an <code class="calibre26">echo</code> statement that completed successfully, the exit status of the function is 0, even though one of the commands in the function failed. Using the default exit status of a function can be a dangerous practice. Fortunately, we have a couple of other solutions.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using the return command</h3>
<p class="calibre10">The bash shell uses the <code class="calibre26">return</code> command to exit a function with a specific exit status. The <code class="calibre26">return</code> command allows you to specify a single integer value to define the function exit status, providing an easy way for you to programmatically set the exit status of your function:</p>
<pre class="calibre29"><code class="calibre26">$ cat test5
#!/bin/bash
# using the return command in a function
function dbl {
   read -p "Enter a value: " value
   echo "doubling the value"
   return $[ $value * 2 ]
}
dbl
echo "The new value is $?"
$</code></pre>
<p class="calibre10">The <code class="calibre26">dbl</code> function doubles the integer value contained in the <code class="calibre26"><i class="calibre12">$</i></code><i class="calibre12">value</i> variable provided by the user input. It then returns the result using the <code class="calibre26">return</code> command, which the script displays using the <code class="calibre26"><i class="calibre12">$?</i></code> variable.</p>
<p class="calibre10">You must be careful, however, when using this technique to return a value from a function. Keep the following two tips in mind to avoid problems:</p>
<ul class="calibre14">
<li class="calibre7">Remember to retrieve the return value as soon as the function completes.</li>
<li class="calibre7">Remember that an exit status must be in the range of 0 to 255.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="455" id="calibre_link-788" class="calibre11"></span>If you execute any other commands before retrieving the value of the function, using the <code class="calibre26"><i class="calibre12">$?</i></code> variable, the return value from the function is lost. Remember that the <code class="calibre26"><i class="calibre12">$?</i></code> variable returns the exit status of the last executed command.</p>
<p class="calibre10">The second problem defines a limitation for using this return value technique. Because an exit status must be less than 256, the result of your function must produce an integer value less than 256. Any value over that returns an error value:</p>
<pre class="calibre29"><code class="calibre26">$ ./test5
Enter a value: 200
doubling the value
The new value is 1
$</code></pre>
<p class="calibre10">You cannot use this return value technique if you need to return either larger integer values or a string value. Instead, you need to use another method, demonstrated in the next section.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using function output</h3>
<p class="calibre10">Just as you can capture the output of a command to a shell variable, you can also capture the output of a function to a shell variable. You can use this technique to retrieve any type of output from a function to assign to a variable:</p>
<pre class="calibre29"><code class="calibre26"> result='dbl'</code></pre>
<p class="calibre10">This command assigns the output of the <code class="calibre26">dbl</code> function to the <code class="calibre26"><i class="calibre12">$result</i></code> shell variable. Here's an example of using this method in a script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test5b
#!/bin/bash
# using the echo to return a value
function dbl {
   read -p "Enter a value: " value
   echo $[ $value * 2 ]
}
result=$(dbl)
echo "The new value is $result"
$
$ ./test5b
Enter a value: 200
The new value is 400
$
$ ./test5b
Enter a value: 1000
The new value is 2000
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="456" id="calibre_link-789" class="calibre11"></span>The new function now uses an <code class="calibre26">echo</code> statement to display the result of the calculation. The script just captures the output of the <code class="calibre26">dbl</code> function instead of looking at the exit status for the answer.</p>
<p class="calibre10">There's a subtle trick that this example demonstrates. You'll notice that the <code class="calibre26">db1</code> function really outputs two messages. The <code class="calibre26">read</code> command outputs a short message querying the user for the value. The bash shell script is smart enough to not consider this as part of the <code class="calibre26">STDOUT</code> output and ignores it. If you had used an <code class="calibre26">echo</code> statement to produce this query message to the user, it would have been captured by the shell variable as well as the output value.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Using this technique, you can also return floating point and string values, making this an extremely versatile method for returning values from functions.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-251" class="calibre4"></a>Using Variables in Functions</h2>
<p class="calibre10">You might have noticed in the <code class="calibre26">test5</code> example in the previous section that we used a variable called <code class="calibre26"><i class="calibre12">$value</i></code> within the function to hold the value that it processed. When you use variables in your functions, you need to be somewhat careful about how you define and handle them. This is a common cause of problems in shell scripts. This section goes over a few techniques for handling variables both inside and outside your shell script functions.</p>
<section class="toclist">
<h3 class="calibre15">Passing parameters to a function</h3>
<p class="calibre10">As mentioned earlier in the âReturning a Valueâ section, the bash shell treats functions just like mini-scripts. This means that you can pass parameters to a function just like a regular script (see Chapter 14).</p>
<p class="calibre10">Functions can use the standard parameter environment variables to represent any parameters passed to the function on the command line. For example, the name of the function is defined in the <code class="calibre26"><i class="calibre12">$0</i></code> variable, and any parameters on the function command line are defined using the variables <code class="calibre26"><i class="calibre12">$1</i></code>, <code class="calibre26"><i class="calibre12">$2</i></code>, and so on. You can also use the special variable <code class="calibre26"><i class="calibre12">$#</i></code> to determine the number of parameters passed to the function.</p>
<p class="calibre10">When specifying the function in your script, you must provide the parameters on the same command line as the function, like this:</p>
<pre class="calibre29"><code class="calibre26">func1 $value1 10</code></pre>
<p class="calibre10"><span type="pagebreak" title="457" id="calibre_link-790" class="calibre11"></span>The function can then retrieve the parameter values using the parameter environment variables. Here's an example of using this method to pass values to a function:</p>
<pre class="calibre29"><code class="calibre26">$ cat test6
#!/bin/bash
# passing parameters to a function
function addem {
   if [ $# -eq 0 ] || [ $# -gt 2 ]
   then
      echo -1
   elif [ $# -eq 1 ]
   then
      echo $[ $1 + $1 ]
   else
      echo $[ $1 + $2 ]
   fi
}
echo -n "Adding 10 and 15: "
value=$(addem 10 15)
echo $value
echo -n "Let's try adding just one number: "
value=$(addem 10)
echo $value
echo -n "Now trying adding no numbers: "
value=$(addem)
echo $value
echo -n "Finally, try adding three numbers: "
value=$(addem 10 15 20)
echo $value
$
$ ./test6
Adding 10 and 15: 25
Let's try adding just one number: 20
Now trying adding no numbers: -1
Finally, try adding three numbers: -1
$</code></pre>
<p class="calibre10">The <code class="calibre26">addem</code> function in the <code class="calibre26">text6</code> script first checks the number of parameters passed to it by the script. If there aren't any parameters, or if there are more than two parameters, <code class="calibre26">addem</code> returns a value of <code class="calibre26">-1</code>. If there's just one parameter, <code class="calibre26">addem</code> adds the parameter to itself for the result. If there are two parameters, <code class="calibre26">addem</code> adds them together for the result.</p>
<p class="calibre10">Because the function uses the special parameter environment variables for its own parameter values, it can't directly access the script parameter values from the command line of the script. The following example fails:</p>
<pre class="calibre29"><code class="calibre26">$ cat badtest1
#!/bin/bash
# trying to access script parameters inside a function
function badfunc1 {
   echo $[ $1 * $2 ]
}
if [ $# -eq 2 ]
then
   value=$(badfunc1)
   echo "The result is $value"
else
   echo "Usage: badtest1 a b"
fi
$
$ ./badtest1
Usage: badtest1 a b
$ ./badtest1 10 15
./badtest1: *  : syntax error: operand expected (error token is "*
")
The result is
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="458" id="calibre_link-791" class="calibre11"></span>Even though the function uses the <code class="calibre26"><i class="calibre12">$1</i></code> and <code class="calibre26"><i class="calibre12">$2</i></code> variables, they aren't the same <code class="calibre26"><i class="calibre12">$1</i></code> and <code class="calibre26"><i class="calibre12">$2</i></code> variables available in the main part of the script. Instead, if you want to use those values in your function, you have to manually pass them when you call the function:</p>
<pre class="calibre29"><code class="calibre26">$ cat test7
#!/bin/bash
# trying to access script parameters inside a function
function func7 {
   echo $[ $1 * $2 ]
}
if [ $# -eq 2 ]
then
   value=$(func7 $1 $2)
   echo "The result is $value"
else
   echo "Usage: badtest1 a b"
fi
$
$ ./test7
Usage: badtest1 a b
$ ./test7 10 15
The result is 150
$</code></pre>
<p class="calibre10">By passing the <code class="calibre26"><i class="calibre12">$1</i></code> and <code class="calibre26"><i class="calibre12">$2</i></code> variables to the function, they become available for the function to use, just like any other parameter.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Handling variables in a function</h3>
<p class="calibre10"><span type="pagebreak" title="459" id="calibre_link-792" class="calibre11"></span>One thing that causes problems for shell script programmers is the <i class="calibre12">scope</i> of a variable. The scope is where the variable is visible. Variables defined in functions can have a different scope than regular variables. That is, they can be hidden from the rest of the script.</p>
<p class="calibre10">Functions use two types of variables:</p>
<ul class="calibre14">
<li class="calibre7">Global</li>
<li class="calibre7">Local</li>
</ul>
<p class="calibre10">The following sections describe how to use both types of variables in your functions.</p>
<section class="toclist">
<h4 class="calibre25">Global variables</h4>
<p class="calibre10"><i class="calibre12">Global variables</i> are variables that are valid anywhere within the shell script. If you define a global variable in the main section of a script, you can retrieve its value inside a function. Likewise, if you define a global variable inside a function, you can retrieve its value in the main section of the script.</p>
<p class="calibre10">By default, any variables you define in the script are global variables. Variables defined outside of a function can be accessed within the function just fine:</p>
<pre class="calibre29"><code class="calibre26">$ cat test8
#!/bin/bash
# using a global variable to pass a value
function dbl {
   value=$[ $value * 2 ]
}
read -p "Enter a value: " value
dbl
echo "The new value is: $value"
$
$ ./test8
Enter a value: 450
The new value is: 900
$</code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">$value</i></code> variable is defined outside of the function and assigned a value outside of the function. When the <code class="calibre26">dbl</code> function is called, the variable and its value are still valid inside the function. When <span type="pagebreak" title="460" id="calibre_link-793" class="calibre11"></span>the variable is assigned a new value inside the function, that new value is still valid when the script references the variable.</p>
<p class="calibre10">This can be a dangerous practice, however, especially if you intend to use your functions in different shell scripts. It requires that you know exactly what variables are used in the function, including any variables used to calculate values not returned to the script. Here's an example of how things can go bad:</p>
<pre class="calibre29"><code class="calibre26">$ cat badtest2
#!/bin/bash
# demonstrating a bad use of variables
function func1 {
   temp=$[ $value + 5 ]
   result=$[ $temp * 2 ]
}
temp=4
value=6
func1
echo "The result is $result"
if [ $temp -gt $value ]
then
   echo "temp is larger"
else
   echo "temp is smaller"
fi
$
$ ./badtest2
The result is 22
temp is larger
$</code></pre>
<p class="calibre10">Because the <code class="calibre26"><i class="calibre12">$temp</i></code> variable was used in the function, its value is compromised in the script, producing a result that you may not have intended. There's an easy way to solve this problem in your functions, as shown in the next section.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Local variables</h4>
<p class="calibre10">Instead of using global variables in functions, any variables that the function uses internally can be declared as local variables. To do that, just use the <code class="calibre26">local</code> keyword in front of the variable declaration:</p>
<pre class="calibre29"><code class="calibre26">local temp</code></pre>
<p class="calibre10">You can also use the <code class="calibre26">local</code> keyword in an assignment statement while assigning a value to the variable:</p>
<pre class="calibre29"><code class="calibre26">local temp=$[ $value + 5 ]</code></pre>
<p class="calibre10">The <code class="calibre26">local</code> keyword ensures that the <span type="pagebreak" title="461" id="calibre_link-794" class="calibre11"></span>variable is limited to only within the function. If a variable with the same name appears outside the function in the script, the shell keeps the two variable values separate. Now you can easily keep your function variables separate from your script variables and share only the ones you want to share:</p>
<pre class="calibre29"><code class="calibre26">$ cat test9
#!/bin/bash
# demonstrating the local keyword
function func1 {
   local temp=$[ $value + 5 ]
   result=$[ $temp * 2 ]
}
temp=4
value=6
func1
echo "The result is $result"
if [ $temp -gt $value ]
then
   echo "temp is larger"
else
   echo "temp is smaller"
fi
$
$ ./test9
The result is 22
temp is smaller
$</code></pre>
<p class="calibre10">Now when you use the <code class="calibre26"><i class="calibre12">$temp</i></code> variable within the <code class="calibre26">func1</code> function, it doesn't affect the value assigned to the <code class="calibre26"><i class="calibre12">$temp</i></code> variable in the main script.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-252" class="calibre4"></a>Array Variables and Functions</h2>
<p class="calibre10">Chapter 6 discussed an advanced way of allowing a single variable to hold multiple values by using arrays. Using array variable values with functions is a little tricky, and there are some special considerations. This section describes a technique that allows you to do that.</p>
<section class="toclist">
<h3 class="calibre15">Passing arrays to functions</h3>
<p class="calibre10">The art of passing an array variable to a script function can be confusing. If you try to pass the array variable as a single parameter, it doesn't work:</p>
<pre class="calibre29"><code class="calibre26">$ cat badtest3
#!/bin/bash
# trying to pass an array variable
function testit {
   echo "The parameters are: $@"
   thisarray=$1
   echo "The received array is ${thisarray[*]}"
}
myarray=(1 2 3 4 5)
echo "The original array is: ${myarray[*]}"
testit $myarray
$
$ ./badtest3
The original array is: 1 2 3 4 5
The parameters are: 1
The received array is 1
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="462" id="calibre_link-795" class="calibre11"></span>If you try using the array variable as a function parameter, the function only picks up the first value of the array variable.</p>
<p class="calibre10">To solve this problem, you must disassemble the array variable into its individual values and use the values as function parameters. Inside the function, you can reassemble all the parameters into a new array variable. Here's an example of doing this:</p>
<pre class="calibre29"><code class="calibre26">$ cat test10
#!/bin/bash
# array variable to function test
function testit {
   local newarray
   newarray=(;'echo "$@"')
   echo "The new array value is: ${newarray[*]}"
}
myarray=(1 2 3 4 5)
echo "The original array is ${myarray[*]}"
testit ${myarray[*]}
$
$ ./test10
The original array is 1 2 3 4 5
The new array value is: 1 2 3 4 5
$</code></pre>
<p class="calibre10">The script uses the <code class="calibre26"><i class="calibre12">$myarray</i></code> variable to hold all the individual array values to place them all on the command line for the function. The function then rebuilds the array variable from the command line parameters. Once inside the function, the array can be used just like any other array:</p>
<pre class="calibre29"><code class="calibre26">$ cat test11
#!/bin/bash
# adding values in an array
function addarray {
   local sum=0
   local newarray
   newarray=($(echo "$@"))
   for value in ${newarray[*]}
   do
      sum=$[ $sum + $value ]
   done
   echo $sum
}
myarray=(1 2 3 4 5)
echo "The original array is: ${myarray[*]}"
arg1=$(echo ${myarray[*]})
result=$(addarray $arg1)
echo "The result is $result"
$
$ ./test11
The original array is: 1 2 3 4 5
The result is 15
$</code></pre>
<p class="calibre10">The <code class="calibre26">addarray</code> function <span type="pagebreak" title="463" id="calibre_link-796" class="calibre11"></span>iterates through the array values, adding them together. You can put any number of values in the <code class="calibre26"><i class="calibre12">myarray</i></code> array variable, and the <code class="calibre26">addarray</code> function adds them.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Returning arrays from functions</h3>
<p class="calibre10">Passing an array variable from a function back to the shell script uses a similar technique. The function uses an <code class="calibre26">echo</code> statement to output the individual array values in the proper order, and the script must reassemble them into a new array variable:</p>
<pre class="calibre29"><code class="calibre26">$ cat test12
#!/bin/bash
# returning an array value
function arraydblr {
   local origarray
   local newarray
   local elements
   local i
   origarray=($(echo "$@"))
   newarray=($(echo "$@"))
   elements=$[ $# - 1 ]
   for (( i = 0; i &lt;= $elements; i++ ))
   {
      newarray[$i]=$[ ${origarray[$i]} * 2 ]
   }
   echo ${newarray[*]}
}
myarray=(1 2 3 4 5)
echo "The original array is: ${myarray[*]}"
arg1=$(echo ${myarray[*]})
result=($(arraydblr $arg1))
echo "The new array is: ${result[*]}"
$
$ ./test12
The original array is: 1 2 3 4 5
The new array is: 2 4 6 8 10</code></pre>
<p class="calibre10"><span type="pagebreak" title="464" id="calibre_link-797" class="calibre11"></span>The script passes the array value, using the <code class="calibre26"><i class="calibre12">$arg1</i></code> variable to the <code class="calibre26">arraydblr</code> function. The <code class="calibre26">arraydblr</code> function reassembles the array into a new array variable, and it makes a copy for the output array variable. It then iterates through the individual array variable values, doubles each value, and places it into the copy of the array variable in the function.</p>
<p class="calibre10">The <code class="calibre26">arraydblr</code> function then uses the <code class="calibre26">echo</code> statement to output the individual values of the array variable values. The script uses the output of the <code class="calibre26">arraydblr</code> function to reassemble a new array variable with the values.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-253" class="calibre4"></a>Function Recursion</h2>
<p class="calibre10">One feature that local function variables provide is <i class="calibre12">self</i>-<i class="calibre12">containment</i>. A self-contained function doesn't use any resources outside of the function, other than whatever variables the script passes to it in the command line.</p>
<p class="calibre10">This feature enables the function to be called <i class="calibre12">recursively</i>, which means that the function calls itself to reach an answer. Usually, a recursive function has a base value that it eventually iterates down to. Many advanced mathematical algorithms use recursion to reduce a complex equation down one level repeatedly, until they get to the level defined by the base value.</p>
<p class="calibre10">The classic example of a recursive algorithm is calculating factorials. A factorial of a number is the value of the preceding numbers multiplied with the number. Thus, to find the factorial of 5, you'd perform the following equation:</p>
<pre class="calibre29"><code class="calibre26">5! = 1 * 2 * 3 * 4 * 5 = 120</code></pre>
<p class="calibre10">Using recursion, the equation is reduced down to the following format:</p>
<pre class="calibre29"><code class="calibre26">x! = x * (x-1)!</code></pre>
<p class="calibre10">or in English, the factorial of <i class="calibre12">x</i> is equal to <i class="calibre12">x</i> times the factorial of <i class="calibre12">x</i><code class="calibre26">-</code><i class="calibre12">1</i>. This can be expressed in a simple recursive script:</p>
<pre class="calibre29"><code class="calibre26">function factorial {
   if [ $1 -eq 1 ]
   then
      echo 1
   else
      local temp=$[ $1 - 1 ]
      local result='factorial $temp'
      echo $[ $result * $1 ]
   fi
}</code></pre>
<p class="calibre10">The factorial function uses itself to calculate the value for the factorial:</p>
<pre class="calibre29"><code class="calibre26">$ cat test13
#!/bin/bash
# using recursion
function factorial {
   if [ $1 -eq 1 ]
   then
      echo 1
   else
      local temp=$[ $1 - 1 ]
      local result=$(factorial $temp)
      echo $[ $result * $1 ]
   fi
}
read -p "Enter value: " value
result=$(factorial $value)
echo "The factorial of $value is: $result"
$
$ ./test13
Enter value: 5
The factorial of 5 is: 120
$</code></pre>
<p class="calibre10">Using the factorial function is easy. Having created a function like this, you may want to use it in other scripts. Next, we look at how to do that efficiently.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-254" class="calibre4"></a>Creating a Library</h2>
<p class="calibre10"><span type="pagebreak" title="465" id="calibre_link-798" class="calibre11"></span>It's easy to see how functions can help save typing in a single script, but what if you just happen to use the same single code block between scripts? It's obviously challenging if you have to define the same function in each script, only to use it one time in each script.</p>
<p class="calibre10">There's a solution for that problem! The bash shell allows you to create a <i class="calibre12">library file</i> for your functions and then reference that single library file in as many scripts as you need to.</p>
<p class="calibre10"><span type="pagebreak" title="466" id="calibre_link-799" class="calibre11"></span>The first step in the process is to create a common library file that contains the functions you need in your scripts. Here's a simple library file called <code class="calibre26">myfuncs</code> that defines three simple functions:</p>
<pre class="calibre29"><code class="calibre26">$ cat myfuncs
# my script functions
function addem {
   echo $[ $1 + $2 ]
}
function multem {
   echo $[ $1 * $2 ]
}
function divem {
   if [ $2 -ne 0 ]
   then
      echo $[ $1 / $2 ]
   else
      echo -1
   fi
}
$</code></pre>
<p class="calibre10">The next step is to include the <code class="calibre26">myfuncs</code> library file in your script files that want to use any of the functions. This is where things get tricky.</p>
<p class="calibre10">The problem is with the scope of shell functions. As with environment variables, shell functions are valid only for the shell session in which you define them. If you run the <code class="calibre26">myfuncs</code> shell script from your shell command line interface prompt, the shell creates a new shell and runs the script in that new shell. This defines the three functions for that shell, but when you try to run another script that uses those functions, they aren't available.</p>
<p class="calibre10">This applies to scripts as well. If you try to just run the library file as a regular script file, the functions don't appear in your script:</p>
<pre class="calibre29"><code class="calibre26">$ cat badtest4
#!/bin/bash
# using a library file the wrong way
./myfuncs
result=$(addem 10 15)
echo "The result is $result"
$
$ ./badtest4
./badtest4: addem: command not found
The result is
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="467" id="calibre_link-800" class="calibre11"></span>The key to using function libraries is the <code class="calibre26">source</code> command. The <code class="calibre26">source</code> command executes commands within the current shell context instead of creating a new shell to execute them. You use the <code class="calibre26">source</code> command to run the library file script inside of your shell script. This makes the functions available to the script.</p>
<p class="calibre10">The <code class="calibre26">source</code> command has a shortcut alias, called the <i class="calibre12">dot operator</i>. To source the <code class="calibre26">myfuncs</code> library file in a shell script, you just need to add the following line:</p>
<pre class="calibre29"><code class="calibre26">. ./myfuncs</code></pre>
<p class="calibre10">This example assumes that the <code class="calibre26">myfuncs</code> library file is located in the same directory as the shell script. If not, you need to use the appropriate path to access the file. Here's an example of creating a script that uses the <code class="calibre26">myfuncs</code> library file:</p>
<pre class="calibre29"><code class="calibre26">$ cat test14
#!/bin/bash
# using functions defined in a library file
. ./myfuncs
value1=10
value2=5
result1=$(addem $value1 $value2)
result2=$(multem $value1 $value2)
result3=$(divem $value1 $value2)
echo "The result of adding them is: $result1"
echo "The result of multiplying them is: $result2"
echo "The result of dividing them is: $result3"
$
$ ./test14
The result of adding them is: 15
The result of multiplying them is: 50
The result of dividing them is: 2
$</code></pre>
<p class="calibre10">The script successfully uses the functions defined in the <code class="calibre26">myfuncs</code> library file.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-255" class="calibre4"></a>Using Functions on the Command Line</h2>
<p class="calibre10">You can use script functions to create some pretty complex operations. Sometimes, it would be nice to be able to use these functions directly on the command line interface prompt.</p>
<p class="calibre10">Just as you can use a script function as a command in a shell script, you can also use a script function as a command in the command line interface. This is a nice feature because after you define the function in the shell, you can use it from any directory on the system; you don't have to worry about a script being in your <code class="calibre26"><i class="calibre12">PATH</i></code> environment variable. The trick is to get the shell to recognize the function. You can do that in a couple of ways.</p>
<section class="toclist">
<h3 class="calibre15">Creating functions on the command line</h3>
<p class="calibre10"><span type="pagebreak" title="468" id="calibre_link-801" class="calibre11"></span>Because the shell interprets commands as you type them, you can define a function directly on the command line. You can do that in two ways.</p>
<p class="calibre10">The first method defines the function all on one line:</p>
<pre class="calibre29"><code class="calibre26">$ function divem { echo $[ $1 / $2 ];  }
$ divem 100 5
20
$</code></pre>
<p class="calibre10">When you define the function on the command line, you must remember to include a semicolon at the end of each command, so the shell knows where to separate commands:</p>
<pre class="calibre29"><code class="calibre26">$ function doubleit { read -p "Enter value: " value; echo $[
 $value * 2 ]; }
$
$ doubleit
Enter value: 20
40
$</code></pre>
<p class="calibre10">The other method is to use multiple lines to define the function. When you do that, the bash shell uses the secondary prompt to prompt you for more commands. Using this method, you don't need to place a semicolon at the end of each command; just press the Enter key:</p>
<pre class="calibre29"><code class="calibre26">$ function multem {
&gt; echo $[ $1 * $2 ]
&gt; }
$ multem 2 5
10
$</code></pre>
<p class="calibre10">When you use the brace at the end of the function, the shell knows that you're finished defining the function.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Be extremely careful when creating functions on the command line. If you use a function with the same name as a built-in command or another command, the function overrides the original command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h3 class="calibre15">Defining functions in the .bashrc file</h3>
<p class="calibre10">The obvious downside to defining shell functions directly on the command line is that when you exit the shell, your function disappears. For complex functions, this can become a problem.</p>
<p class="calibre10"><span type="pagebreak" title="469" id="calibre_link-802" class="calibre11"></span>A much simpler method is to define the function in a place where it is reloaded by the shell each time you start a new shell.</p>
<p class="calibre10">The best place to do that is the <code class="calibre26">.bashrc</code> file. The bash shell looks for this file in your home directory each time it starts, whether interactively or as the result of starting a new shell from within an existing shell.</p>
<section class="toclist">
<h4 class="calibre25">Directly defining functions</h4>
<p class="calibre10">You can define the functions directly in the <code class="calibre26">.bashrc</code> file in your home directory. Most Linux distributions already define some things in the <code class="calibre26">.bashrc</code> file, so be careful not to remove those items. Just add your functions to the bottom of the existing file. Here's an example of doing that:</p>
<pre class="calibre29"><code class="calibre26">$ cat .bashrc
# .bashrc
# Source global definitions
if [ -r /etc/bashrc ]; then
        . /etc/bashrc
fi
function addem {
   echo $[ $1 + $2 ]
}
$</code></pre>
<p class="calibre10">The function doesn't take effect until the next time you start a new bash shell. After you do that, you can use the function anywhere on the system.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Sourcing function files</h4>
<p class="calibre10">Just as in a shell script, you can use the <code class="calibre26">source</code> command (or its alias the dot operator) to add functions from an existing library file to your <code class="calibre26">.bashrc</code> script:</p>
<pre class="calibre29"><code class="calibre26">$ cat .bashrc
# .bashrc
# Source global definitions
if [ -r /etc/bashrc ]; then
        . /etc/bashrc
fi
. /home/rich/libraries/myfuncs
$</code></pre>
<p class="calibre10">Make sure that you include the proper pathname to reference the library file for the bash shell to find. The next time you start a shell, all the functions in your library are available at the command line interface:</p>
<pre class="calibre29"><code class="calibre26">$ addem 10 5
15
$ multem 10 5
50
$ divem 10 5
2
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="470" id="calibre_link-803" class="calibre11"></span>Even better, the shell also passes any defined functions to child shell processes so your functions are automatically available for any shell scripts you run from your shell session. You can test this by writing a script that uses the functions without defining or sourcing them:</p>
<pre class="calibre29"><code class="calibre26">$ cat test15
#!/bin/bash
# using a function defined in the .bashrc file
value1=10
value2=5
result1=$(addem $value1 $value2)
result2=$(multem $value1 $value2)
result3=$(divem $value1 $value2)
echo "The result of adding them is: $result1"
echo "The result of multiplying them is: $result2"
echo "The result of dividing them is: $result3"
$
$ ./test15
The result of adding them is: 15
The result of multiplying them is: 50
The result of dividing them is: 2
$</code></pre>
<p class="calibre10">Even without sourcing the library file, the functions worked perfectly in the shell script.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-256" class="calibre4"></a>Following a Practical Example</h2>
<p class="calibre10">There's much more to using functions than just creating your own functions to work with. In the open source world, code sharing is key, and that also applies to shell script functions. Quite a few different shell script functions are available for you to download and use in your own applications.</p>
<p class="calibre10">This section walks through downloading, installing, and using the GNU shtool shell script function library. The shtool library provides some simple shell script functions for performing everyday shell functions, such as working with temporary files and folders or formatting output to display.</p>
<section class="toclist">
<h3 class="calibre15">Downloading and installing</h3>
<p class="calibre10"><span type="pagebreak" title="471" id="calibre_link-804" class="calibre11"></span>The first step in the process is to download and install the GNU shtool library to your system so you can use the library functions in your own shell scripts. To do that, you need to use an FTP client program or a browser in a graphical desktop. Use this URL to download the shtool package:</p>
<pre class="calibre29"><code class="calibre26">ftp://ftp.gnu.org/gnu/shtool/shtool-2.0.8.tar.gz</code></pre>
<p class="calibre10">This downloads the file <code class="calibre26">shtool-2.0.8.tar.gz</code> to the download folder. From there, you can use the <code class="calibre26">cp</code> command line tool or the graphical file manager tool in your Linux distribution (such as Nautilus in Ubuntu) to copy the file to your Home folder.</p>
<p class="calibre10">After you copy the file to your Home folder, you can extract it using the <code class="calibre26">tar</code> command:</p>
<pre class="calibre29"><code class="calibre26">tar -zxvf shtool-2.0.8.tar.gz</code></pre>
<p class="calibre10">This extracts the package files into a folder named <code class="calibre26">shtool-2.0.8</code>. Now you're ready to build the shell script library file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Building the library</h3>
<p class="calibre10">The shtool distribution file must be configured for your specific Linux environment. To do that, it uses standard <code class="calibre26">configure </code>and <code class="calibre26">make</code> commands, commonly used in the C programming environment. To build the library file, you just need to run two commands:</p>
<pre class="calibre29"><code class="calibre26">$ ./confifgure
$ make</code></pre>
<p class="calibre10">The <code class="calibre26">configure</code> command checks the software necessary to build the shtool library file. As it finds the tools it needs, it modifies the configuration file with the proper paths to the tools.</p>
<p class="calibre10">The <code class="calibre26">make</code> command runs through the steps to build the shtool library file. The resulting file (<code class="calibre26">shtool</code>) is the full library package file. You can test the library file using the make command as well:</p>
<pre class="calibre29"><code class="calibre26">$ make test
Running test suite:
echo...........ok
mdate..........ok
table..........ok
prop...........ok
move...........ok
install........ok
mkdir..........ok
mkln...........ok
mkshadow.......ok
fixperm........ok
rotate.........ok
tarball........ok
subst..........ok
platform.......ok
arx............ok
slo............ok
scpp...........ok
version........ok
path...........ok
OK: passed: 19/19
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="472" id="calibre_link-805" class="calibre11"></span>The test mode tests all the functions available in the shtool library. If all pass, then you're ready to install the library into a common location on your Linux system so all your scripts can use it. To do that, you can use the <code class="calibre26">install</code> option of the <code class="calibre26">make</code> command. However, you need to be logged in as the root user account to run it:</p>
<pre class="calibre29"><code class="calibre26">$ su
Password:
# make install
./shtool mkdir -f -p -m 755 /usr/local
./shtool mkdir -f -p -m 755 /usr/local/bin
./shtool mkdir -f -p -m 755 /usr/local/share/man/man1
./shtool mkdir -f -p -m 755 /usr/local/share/aclocal
./shtool mkdir -f -p -m 755 /usr/local/share/shtool
...
./shtool install -c -m 644 sh.version /usr/local/share/shtool/sh.version
./shtool install -c -m 644 sh.path /usr/local/share/shtool/sh.path
#</code></pre>
<p class="calibre10">Now you're ready to start using the functions in your own shell scripts!</p>
</section>
<section class="toclist">
<h3 class="calibre15">The shtool library functions</h3>
<p class="calibre10">The shtool library provides quite a few functions that can come in handy when working with shell scripts. <a id="calibre_link-1179" href="#calibre_link-1148" class="calibre4">Table 17.1</a> shows the functions available in the library.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1148" href="#calibre_link-1179" class="calibre4"><b class="calibre21">Table 17.1</b></a></span> The shtool Library Functions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Function</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">Arx</td>
<td class="left">Creates an archive with extended features</td>
</tr>
<tr class="calibre28">
<td class="left">Echo</td>
<td class="left">Displays the string value with construct expansion</td>
</tr>
<tr class="calibre28">
<td class="left">fixperm</td>
<td class="left">Changes file permissions inside a folder tree</td>
</tr>
<tr class="calibre28">
<td class="left">install</td>
<td class="left">Installs a script or file</td>
</tr>
<tr class="calibre28">
<td class="left">mdate</td>
<td class="left">Displays modification time of a file or directory</td>
</tr>
<tr class="calibre28">
<td class="left">mkdir</td>
<td class="left">Creates one or more directories</td>
</tr>
<tr class="calibre28">
<td class="left">Mkln</td>
<td class="left">Creates a link using relative paths</td>
</tr>
<tr class="calibre28">
<td class="left">mkshadow</td>
<td class="left">Creates a shadow tree</td>
</tr>
<tr class="calibre28">
<td class="left">move</td>
<td class="left">Moves files with substitution</td>
</tr>
<tr class="calibre28">
<td class="left">Path</td>
<td class="left">Works with program paths</td>
</tr>
<tr class="calibre28">
<td class="left">platform</td>
<td class="left">Displays the platform identity</td>
</tr>
<tr class="calibre28">
<td class="left">Prop</td>
<td class="left">Displays an animated progress propeller</td>
</tr>
<tr class="calibre28">
<td class="left">rotate</td>
<td class="left">Rotates logfiles</td>
</tr>
<tr class="calibre28">
<td class="left">Scpp</td>
<td class="left">The sharing C pre-processor</td>
</tr>
<tr class="calibre28">
<td class="left">Slo</td>
<td class="left">Separates linker options by library class</td>
</tr>
<tr class="calibre28">
<td class="left">Subst</td>
<td class="left">Uses sed substitution operations</td>
</tr>
<tr class="calibre28">
<td class="left">Table</td>
<td class="left">Displays field-separated data in a table format</td>
</tr>
<tr class="calibre28">
<td class="left">tarball</td>
<td class="left">Creates tar files from files and folders</td>
</tr>
<tr class="calibre28">
<td class="left">version</td>
<td class="left">Creates a version information file</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="473" id="calibre_link-806" class="calibre11"></span>Each of the shtool functions has lots of options and arguments that you can use to modify how it works. Here's the format to use a shtool function:</p>
<pre class="calibre29"><code class="calibre26">shtool [options] [function [options] [args]]</code></pre>
</section>
<section class="toclist">
<h3 class="calibre15">Using the library</h3>
<p class="calibre10">You can use the <code class="calibre26">shtool</code> functions directly from the command line or from within your shell scripts. Here's an example of using the <code class="calibre26">platform</code> function inside a shell script:</p>
<pre class="calibre29"><code class="calibre26">$ cat test16
#!/bin/bash
shtool platform
$ ./test16
Ubuntu 14.04 (iX86)
$</code></pre>
<p class="calibre10">The <code class="calibre26">platform</code> function returns the Linux distribution and the CPU hardware that the host system is using. One of my favorites is the <code class="calibre26">prop</code> function. It creates a spinning propeller from alternating the â, |, /, and &ndash; characters while something is processing. That's a great tool to help show your shell script users that something is happening in the background while the script is running.</p>
<p class="calibre10">To use the <code class="calibre26">prop</code> function, you just pipe the output of the function you want to monitor to the <code class="calibre26">shtool</code> script:</p>
<pre class="calibre29"><code class="calibre26">$ ls &ndash;al /usr/bin | shtool prop &ndash;p "waiting..."
waiting...
$</code></pre>
<p class="calibre10">The <code class="calibre26">prop</code> function alternates between the propeller characters to indicate that something is happening. In this case, it's the output from the <code class="calibre26">ls</code> command. How much of that you see depends on how fast your CPU can list out all the files in the <code class="calibre26">/usr/bin folder</code>! The <code class="calibre26">&ndash;p</code> option allows you to customize the output text that appears before the propeller characters. Now that's getting fancy!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-257" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="474" id="calibre_link-807" class="calibre11"></span>Shell script functions allow you to place script code that's repeated throughout the script in a single place. Instead of having to rewrite blocks of code, you can create a function containing the code block and then just reference the function name in your script. The bash shell jumps to the function code block whenever it sees the function name used in the script.</p>
<p class="calibre10">You can even create script functions that return values. This allows you to create functions that interact with the script, returning both numeric and character data. Script functions can return numeric data by using the exit status of the last command in the function or using the <code class="calibre26">return</code> command. The <code class="calibre26">return</code> command allows you to programmatically set the exit status of your function to a specific value based on the results of the function.</p>
<p class="calibre10">Functions can also return values using the standard <code class="calibre26">echo</code> statement. You can capture the output data using the backtick character as you would any other shell command. This enables you to return any type of data from a function, including strings and floating-point numbers.</p>
<p class="calibre10">You can use shell variables within your functions, assigning values to variables and retrieving values from existing variables. This allows you to pass any type of data both into and out of a script function from the main script program. Functions also allow you to define local variables, which are accessible only from within the function code block. Local variables allow you to create self-contained functions, which don't interfere with any variables or processes used in the main shell script.</p>
<p class="calibre10">Functions can also call other functions, including themselves. When a function calls itself, it is called recursion. A recursive function often has a base value that is the terminal value of the function. The function continues to call itself with a decreasing parameter value until the base value is reached.</p>
<p class="calibre10"><span type="pagebreak" title="475" id="calibre_link-808" class="calibre11"></span>If you use lots of functions in your shell scripts, you can create library files of script functions. The library files can be included in any shell script file by using the source command, or its alias, the dot operator. This is called sourcing the library file. The shell doesn't run the library file but makes the functions available within the shell that runs the script. You can use this same technique to create functions that you can use on the normal shell command line. You can either define functions directly on the command line or you can add them to your <code class="calibre26">.bashrc</code> file so they are available for each new shell session you start. This is a handy way to create utilities that can be used no matter what your <code class="calibre26"><i class="calibre12">PATH</i></code> environment variable is set to.</p>
<p class="calibre10">The next chapter discusses the use of text graphics in your scripts. In this day of modern graphical interfaces, sometimes a plain text interface just doesn't cut it. The bash shell provides some easy ways for you to incorporate simple graphics features in your scripts to help spice things up.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-89">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-258" class="calibre4"></a><span class="chaptertitle">Chapter 18</span><br class="calibre22" /><span class="chaptertitle">Writing Scripts for Graphical Desktops</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Creating text menus</li>
<li class="calibre7">Building text window widgets</li>
<li class="calibre7">Adding X Window graphics</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="477" id="calibre_link-809" class="calibre11"></span>Over the years, shell scripts have acquired a reputation for being dull and boring. This doesn't have to be the case, however, if you plan on running your scripts in a graphical environment. There are plenty of ways to interact with your script user that don't rely on the <code class="calibre26">read</code> and <code class="calibre26">echo</code> statements. This chapter dives into a few different methods you can use to help add life to your interactive scripts so they don't look so old-fashioned.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-259" class="calibre4"></a>Creating Text Menus</h2>
<p class="calibre10">The most common way to create an interactive shell script is to utilize a menu. Offering your customers a choice of various options helps guide them through exactly what the script can and can't do.</p>
<p class="calibre10">Menu scripts usually clear the display area and then show a list of options available. The customer can select an option by pressing an associated letter or number assigned to each option. <a id="calibre_link-1189" href="#calibre_link-1095" class="calibre4">Figure 18.1</a> shows the layout of a sample menu.</p>
<figure class="calibre23">
<img class="center" src="images/000009.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1095" href="#calibre_link-1189" class="calibre4"><b class="calibre21">Figure 18.1</b></a></span> Displaying a menu from a shell script</p>
</figcaption>
</figure>
<p class="calibre10">The core of a shell script menu is the <code class="calibre26">case</code> command (see Chapter 12). The <code class="calibre26">case</code> command performs specific commands, depending on what character your customer selects from the menu.</p>
<p class="calibre10">The following sections walk you through the steps you should follow to create a menu-based shell script.</p>
<section class="toclist">
<h3 class="calibre15">Create the menu layout</h3>
<p class="calibre10"><span type="pagebreak" title="478" id="calibre_link-810" class="calibre11"></span>The first step in creating a menu is, obviously, to determine what elements you want to appear in the menu and lay them out the way that you want them to appear.</p>
<p class="calibre10">Before creating the menu, it's usually a good idea to clear the monitor display. This enables you to display your menu in a clean environment without distracting text.</p>
<p class="calibre10">The <code class="calibre26">clear</code> command uses the terminfo data of your terminal session (see Chapter 2) to clear any text that appears on the monitor. After the <code class="calibre26">clear</code> command, you can use the <code class="calibre26">echo</code> command to display your menu elements.</p>
<p class="calibre10">By default, the <code class="calibre26">echo</code> command can only display printable text characters. When creating menu items, it's often helpful to use nonprintable items, such as the tab and newline characters. To include these characters in your <code class="calibre26">echo</code> command, you must use the <code class="calibre26">-e</code> option. Thus, the command:</p>
<pre class="calibre29"><code class="calibre26"> echo -e "1.\tDisplay disk space"</code></pre>
<p class="calibre10">results in the output line:</p>
<pre class="calibre29"><code class="calibre26"> 1.        Display disk space</code></pre>
<p class="calibre10"><span type="pagebreak" title="479" id="calibre_link-811" class="calibre11"></span>This greatly helps in formatting the layout of the menu items. With just a few <code class="calibre26">echo</code> commands, you can create a reasonable-looking menu:</p>
<pre class="calibre29"><code class="calibre26">    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit menu\n\n"
    echo &ndash;en "\t\tEnter option: "</code></pre>
<p class="calibre10">The <code class="calibre26">-en</code> option on the last line displays the line without adding the newline character at the end. This gives the menu a more professional look, because the cursor stays at the end of the line waiting for the customer's input.</p>
<p class="calibre10">The last part of creating the menu is to retrieve the input from the customer. This is done using the <code class="calibre26">read</code> command (see Chapter 14). Because we expect only single-character input, the nice thing to do is to use the <code class="calibre26">-n</code> option in the <code class="calibre26">read</code> command to retrieve only one character. This allows the customer to enter a number without having to press the Enter key:</p>
<pre class="calibre29"><code class="calibre26"> read -n 1 option</code></pre>
<p class="calibre10">Next, you need to create your menu functions.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Create the menu functions</h3>
<p class="calibre10">Shell script menu options are easier to create as a group of separate functions. This enables you to create a simple, concise <code class="calibre26">case</code> command that is easy to follow.</p>
<p class="calibre10">To do that, you need to create separate shell functions for each of your menu options. The first step in creating a menu shell script is to determine what functions you want your script to perform and lay them out as separate functions in your code.</p>
<p class="calibre10">It is common practice to create <i class="calibre12">stub functions</i> for functions that aren't implemented yet. A stub function is a function that doesn't contain any commands yet or possibly just an <code class="calibre26">echo</code> statement indicating what should be there eventually:</p>
<pre class="calibre29"><code class="calibre26"> function diskspace {
    clear
    echo "This is where the diskspace commands will go"
 }</code></pre>
<p class="calibre10">This enables your menu to operate smoothly while you work on the individual functions. You don't have to code all the functions for your menu to work. You'll notice that the <span type="pagebreak" title="480" id="calibre_link-812" class="calibre11"></span>function starts out with the <code class="calibre26">clear</code> command. This enables you to start the function on a clean monitor screen, without the menu showing.</p>
<p class="calibre10">One thing that helps out in the shell script menu is to create the menu layout itself as a function:</p>
<pre class="calibre29"><code class="calibre26"> function menu {
    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit program\n\n"
    echo -en "\t\tEnter option: "
    read -n 1 option
 }</code></pre>
<p class="calibre10">This enables you to easily redisplay the menu at any time just by calling the <code class="calibre26">menu</code> function.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Add the menu logic</h3>
<p class="calibre10">Now that you have your menu layout and your functions, you just need to create the programming logic to put the two together. As mentioned, this requires the <code class="calibre26">case</code> command.</p>
<p class="calibre10">The <code class="calibre26">case</code> command should call the appropriate function according to the character selection expected from the menu. It's always a good idea to use the default <code class="calibre26">case</code> command character (the asterisk) to catch any incorrect menu entries.</p>
<p class="calibre10">The following code illustrates the use of the <code class="calibre26">case</code> command in a typical menu:</p>
<pre class="calibre29"><code class="calibre26"> menu
 case $option in
 0)
    break ;;
 1)
    diskspace ;;
 2)
    whoseon ;;
 3)
    memusage ;;
 *)
    clear
    echo "Sorry, wrong selection";;
 esac</code></pre>
<p class="calibre10">This code first uses the <code class="calibre26">menu</code> function to clear the monitor screen and display the menu. The <code class="calibre26">read</code> command in the <code class="calibre26">menu</code> function pauses until the customer hits a character on the keyboard. After that's been done, the <code class="calibre26">case</code> command takes over. The <code class="calibre26">case</code> command calls the appropriate function <span type="pagebreak" title="481" id="calibre_link-813" class="calibre11"></span>based on the returned character. After the function completes, the <code class="calibre26">case</code> command exits.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Putting it all together</h3>
<p class="calibre10">Now that you've seen all the parts that make up a shell script menu, let's put them together and see how they all interoperate. Here's an example of a full menu script:</p>
<pre class="calibre29"><code class="calibre26"> $ cat menu1
 #!/bin/bash
 # simple script menu
 function diskspace {
    clear
    df -k
 }
 
 function whoseon {
    clear
    who
 }
 function memusage {
    clear
    cat /proc/meminfo
 }
 
 function menu {
    clear
    echo
    echo -e "\t\t\tSys Admin Menu\n"
    echo -e "\t1. Display disk space"
    echo -e "\t2. Display logged on users"
    echo -e "\t3. Display memory usage"
    echo -e "\t0. Exit program\n\n"
    echo -en "\t\tEnter option: "
    read -n 1 option
 }
 
 while [ 1 ]
 do
    menu
    case $option in
    0)
       break ;;
    1)
       diskspace ;;
    2)
       whoseon ;;
    3)
       memusage ;;
    *)
       clear
       echo "Sorry, wrong selection";;
    esac
    echo -en "\n\n\t\t\tHit any key to continue"
    read -n 1 line
 done
 clear
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="482" id="calibre_link-814" class="calibre11"></span>This menu creates three functions to retrieve administrative information about the Linux system using common commands. It uses a <code class="calibre26">while</code> loop to continually loop through the menu until the customer selects option 0, which uses the <code class="calibre26">break</code> command to break out of the <code class="calibre26">while</code> loop.</p>
<p class="calibre10">You can use this same template to create any shell script menu interface. It provides a simple way to interact with your customers.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using the select command</h3>
<p class="calibre10">You may have noticed that half the challenge of creating a text menu is just creating the menu layout and retrieving the answer that you enter. The bash shell provides a handy little utility for you that does all this work automatically.</p>
<p class="calibre10">The <code class="calibre26">select</code> command allows you to create a menu from a single command line and then retrieve the entered answer and automatically process it. The format of the <code class="calibre26">select</code> command is as follows:</p>
<pre class="calibre29"><code class="calibre26"> select variable in list
 do
     commands
 done</code></pre>
<p class="calibre10">The <code class="calibre26">list</code> parameter is a space-separated list of text items that build the menu. The <code class="calibre26">select</code> command displays each item in the list as a numbered option and then displays a special prompt, defined by the <code class="calibre26">PS3</code> environment variable, for the selection.</p>
<p class="calibre10">Here's a simple example of the <code class="calibre26">select</code> command in action:</p>
<pre class="calibre29"><code class="calibre26"> $ cat smenu1
 #!/bin/bash
 # using select in the menu
 function diskspace {
    clear
    df -k
 }
 
 function whoseon {
    clear
    who
 }
 
 function memusage {
    clear
    cat /proc/meminfo
 }
 
 PS3="Enter option: "
 select option in "Display disk space" "Display logged on users"â
 "Display memory usage" "Exit program"
 do
    case $option in
    "Exit program")
          break ;;
    "Display disk space")
          diskspace ;;
    "Display logged on users")
          whoseon ;;
    "Display memory usage")
          memusage ;;
    *)
          clear
          echo "Sorry, wrong selection";;
    esac
 done
 clear
 $</code></pre>
<p class="calibre10">The <code class="calibre26">select</code> statement <span type="pagebreak" title="483" id="calibre_link-815" class="calibre11"></span>must all be on one line in the code file. That's indicated by the continuation character in the listing. When you run the program, it automatically produces the following menu:</p>
<pre class="calibre29"><code class="calibre26"> $ ./smenu1
 1) Display disk space       3) Display memory usage
 2) Display logged on users  4) Exit program
 Enter option:</code></pre>
<p class="calibre10">When you use the <code class="calibre26">select</code> command, remember that the result value stored in the variable is the entire text string and not the number associated with the menu item. The text string values are what you need to compare in your <code class="calibre26">case</code> statements.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-260" class="calibre4"></a>Doing Windows</h2>
<p class="calibre10"><span type="pagebreak" title="484" id="calibre_link-816" class="calibre11"></span>Using text menus is a step in the right direction, but there's still so much missing in our interactive scripts, especially if we try to compare them to the graphical Windows world. Fortunately for us, some very resourceful people out in the open source world have helped us out.</p>
<p class="calibre10">The <i class="calibre12">dialog</i> package is a nifty little tool originally created by Savio Lam and currently maintained by Thomas E. Dickey. This package recreates standard Windows dialog boxes in a text environment using ANSI escape control codes. You can easily incorporate these dialog boxes in your shell scripts to interact with your script users. This section describes the dialog package and demonstrates how to use it in shell scripts.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The dialog package isn't installed in all Linux distributions by default. If it's not installed by default, because of its popularity it's almost always included in the software repository. Check your specific Linux distribution documentation for how to load the dialog package. For the Ubuntu Linux distribution, the following is the command line command to install it:</p>
<ol class="none">
<li class="calibre7"><code class="calibre26">sudo apt-get install dialog</code></li>
</ol>
<p class="calibre19">That package installs the dialog package plus the required libraries for your system.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h3 class="calibre15">The dialog package</h3>
<p class="calibre10">The <code class="calibre26">dialog</code> command uses command line parameters to determine what type of Windows <i class="calibre12">widget</i> to produce. A widget is the dialog package term for a type of Windows element. The dialog package currently supports the types of widgets shown in <a id="calibre_link-1190" href="#calibre_link-1149" class="calibre4">Table 18.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1149" href="#calibre_link-1190" class="calibre4"><b class="calibre21">Table 18.1</b></a></span> The dialog Widgets</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Widget</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">calendar</code></td>
<td class="left">Provides a calendar from which to select a date</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">checklist</code></td>
<td class="left">Displays multiple entries where each entry can be turned on or off</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">form</code></td>
<td class="left">Allows you to build a form with labels and text fields to be filled out</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fselect</code></td>
<td class="left">Provides a file selection window to browse for a file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gauge</code></td>
<td class="left">Displays a meter showing a percentage of completion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">infobox</code></td>
<td class="left">Displays a message without waiting for a response</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">inputbox</code></td>
<td class="left">Displays a single text form box for text entry</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">inputmenu</code></td>
<td class="left">Provides an editable menu</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">menu</code></td>
<td class="left">Displays a list of selections from which to choose</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">msgbox</code></td>
<td class="left">Displays a message and requires the user to select an OK button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pause</code></td>
<td class="left">Displays a meter showing the status of a specified pause period</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">passwordbox</code></td>
<td class="left">Displays a single textbox that hides entered text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">passwordform</code></td>
<td class="left">Displays a form with labels and hidden text fields</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">radiolist</code></td>
<td class="left">Provides a group of menu items where only one item can be selected</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">tailbox</code></td>
<td class="left">Displays text from a file in a scroll window using the <code class="calibre26">tail</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">tailboxbg</code></td>
<td class="left">Same as <code class="calibre26">tailbox</code>, but operates in background mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">textbox</code></td>
<td class="left">Displays the contents of a file in a scroll window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">timebox</code></td>
<td class="left">Provides a window to select an hour, minute, and second</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">yesno</code></td>
<td class="left">Provides a simple message with Yes and No buttons</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="485" id="calibre_link-817" class="calibre11"></span>As you can see from <a href="#calibre_link-1149" class="calibre4">Table 18.1</a>, you can choose from lots of different widgets. This can give your scripts a more professional look with very little effort.</p>
<p class="calibre10">To specify a specific widget on the command line, you need to use the double dash format:</p>
<pre class="calibre29"><code class="calibre26"> dialog <code class="calibre26"><i class="calibre12">--widget parameters</i></code></code></pre>
<p class="calibre10">where <code class="calibre26"><i class="calibre12">widget</i></code> is the widget name as seen in <a href="#calibre_link-1149" class="calibre4">Table 18.1</a>, and <code class="calibre26"><i class="calibre12">parameters</i></code> defines the size of the widget window and any text required for the widget.</p>
<p class="calibre10">Each dialog widget provides output in two forms:</p>
<ul class="calibre14">
<li class="calibre7">Using <code class="calibre26">STDERR</code></li>
<li class="calibre7">Using the exit code status</li>
</ul>
<p class="calibre10">The exit code status of the <code class="calibre26">dialog</code> command determines the button selected by the user. If an OK or Yes button is selected, the <code class="calibre26">dialog</code> command returns a 0 exit status. If a Cancel or No button is selected, the <code class="calibre26">dialog</code> command returns a 1 exit status. You can use the standard <code class="calibre26">$?</code> variable to determine which button was selected in the dialog widget.</p>
<p class="calibre10">If a widget returns any data, such as a menu selection, the <code class="calibre26">dialog</code> command sends the data to <code class="calibre26">STDERR</code>. You can use the standard bash shell technique of redirecting the <code class="calibre26">STDERR</code> output to another file or file descriptor:</p>
<pre class="calibre29"><code class="calibre26"> dialog --inputbox "Enter your age:" 10 20 2&gt;age.txt</code></pre>
<p class="calibre10">This command redirects the text entered in the textbox to the <code class="calibre26">age.txt</code> file.</p>
<p class="calibre10">The following sections look at some examples of the more common dialog widgets you'll use in your shell scripts.</p>
<section class="toclist">
<h4 class="calibre25">The msgbox widget</h4>
<p class="calibre10">The <code class="calibre26">msgbox</code> widget is <span type="pagebreak" title="486" id="calibre_link-818" class="calibre11"></span>the most common type of dialog box. It displays a simple message in a window and waits for the user to click an OK button before disappearing. The following format is required to use a <code class="calibre26">msgbox</code> widget:</p>
<pre class="calibre29"><code class="calibre26"> dialog --msgbox <code class="calibre26"><i class="calibre12">text</i></code> <i class="calibre12">height</i> <i class="calibre12">width</i></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">text</i></code> parameter is any string you want to place in the window. The <code class="calibre26">dialog</code> command automatically wraps the text to fit the size of the window you create, using the <code class="calibre26"><i class="calibre12">height</i></code> and <code class="calibre26"><i class="calibre12">width</i></code> parameters. If you want to place a title at the top of the window, you can also use the <code class="calibre26">--title</code> parameter, along with the text of the title. Here's an example of using the msgbox widget:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --title Testing --msgbox "This is a test" 10 20</code></pre>
<p class="calibre10">After entering this command, the message box appears on the screen of the terminal emulator session you're using. <a id="calibre_link-1191" href="#calibre_link-1096" class="calibre4">Figure 18.2</a> shows what this looks like.</p>
<figure class="calibre23">
<img class="center" src="images/000014.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1096" href="#calibre_link-1191" class="calibre4"><b class="calibre21">Figure 18.2</b></a></span> Using the msgbox widget in the dialog command</p>
</figcaption>
</figure>
<p class="calibre10">If your terminal emulator supports the mouse, you can click the OK button to close the dialog box. You can also use keyboard commands to simulate a click &mdash; just press the Enter key.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The yesno widget</h4>
<p class="calibre10">The <code class="calibre26">yesno</code> widget takes the <code class="calibre26">msgbox</code> widget <span type="pagebreak" title="487" id="calibre_link-819" class="calibre11"></span>one step further, allowing the user to answer a yes/no question displayed in the window. It produces two buttons at the bottom of the window &mdash; one for Yes and another for No. The user can switch between buttons by using the mouse, the tab key, or the keyboard arrow keys. To select the button, the user can either press the spacebar or the Enter key.</p>
<p class="calibre10">Here's an example of using the <code class="calibre26">yesno</code> widget:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --title "Please answer" --yesno "Is this thing on?" 10 20
 $ echo $?
 1
 $</code></pre>
<p class="calibre10">This produces the widget shown in <a id="calibre_link-1192" href="#calibre_link-1097" class="calibre4">Figure 18.3</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000018.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1097" href="#calibre_link-1192" class="calibre4"><b class="calibre21">Figure 18.3</b></a></span> Using the yesno widget in the dialog command</p>
</figcaption>
</figure>
<p class="calibre10">The exit status of the <code class="calibre26">dialog</code> command is set depending on which button the user selects. If the No button is selected, the exit status is 1, and if the Yes button is selected, the exit status is 0.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The inputbox widget</h4>
<p class="calibre10">The <code class="calibre26">inputbox</code> widget provides a simple textbox area for the user to enter a text string. The dialog command sends the value of the text string to <code class="calibre26">STDERR</code>. You must redirect that to retrieve the answer. <a id="calibre_link-1193" href="#calibre_link-1098" class="calibre4">Figure 18.4</a> demonstrates what the <code class="calibre26">inputbox</code> widget looks like.</p>
<figure class="calibre23">
<img class="center" src="images/000026.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1098" href="#calibre_link-1193" class="calibre4"><b class="calibre21">Figure 18.4</b></a></span> The inputbox widget</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="488" id="calibre_link-820" class="calibre11"></span>As you can see in <a href="#calibre_link-1098" class="calibre4">Figure 18.4</a>, the <code class="calibre26">inputbox</code> provides two buttons &mdash; OK and Cancel. If the Cancel button is selected, the exit status of the command is 1; otherwise, the exit status is 0:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --inputbox "Enter your age:" 10 20 2&gt;age.txt
 $ echo $?
 0
 $ cat age.txt
 12$</code></pre>
<p class="calibre10">You'll notice when you use the <code class="calibre26">cat</code> command to display the contents of the text file that there's no newline character after the value. This enables you to easily redirect the file contents to a variable in a shell script to extract the string entered by the user.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The textbox widget</h4>
<p class="calibre10">The <code class="calibre26">textbox</code> widget is a great way to display lots of information in a window. It produces a scrollable window containing the text from a file specified in the parameters:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --textbox /etc/passwd 15 45</code></pre>
<p class="calibre10">The contents of the <code class="calibre26">/etc/passwd</code> file are shown within the scrollable text window, as illustrated in <a id="calibre_link-1194" href="#calibre_link-1099" class="calibre4">Figure 18.5</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000031.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1099" href="#calibre_link-1194" class="calibre4"><b class="calibre21">Figure 18.5</b></a></span> The textbox widget</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="489" id="calibre_link-821" class="calibre11"></span>You can use the arrow keys to scroll left and right, as well as up and down in the text file. The bottom line in the window shows the percent location within the file that you're viewing. The textbox contains only a single Exit button, which should be selected to exit the widget.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The menu widget</h4>
<p class="calibre10">The <code class="calibre26">menu</code> widget allows you to create a window version of the text menu we created earlier in this chapter. You simply provide a selection tag and the text for each item:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --menu "Sys Admin Menu" 20 30 10 1 "Display disk space"
 2 "Display users" 3 "Display memory usage" 4 "Exit" 2&gt; test.txt</code></pre>
<p class="calibre10">The first parameter defines a title for the menu. The next two parameters define the height and width of the menu window, while the third parameter defines the number of menu items that appear in the window at one time. If there are more menu items, you can scroll through them using the arrow keys.</p>
<p class="calibre10">Following those parameters, you must add menu item pairs. The first element is the tag used to select the menu item. Each tag should be unique for each menu item and can be selected by pressing the appropriate key on the keyboard. The second element is the text used in the menu. <a id="calibre_link-1195" href="#calibre_link-1100" class="calibre4">Figure 18.6</a> demonstrates the menu produced by the example command.</p>
<figure class="calibre23">
<img class="center" src="images/000037.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1100" href="#calibre_link-1195" class="calibre4"><b class="calibre21">Figure 18.6</b></a></span> The menu widget with menu items</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="490" id="calibre_link-822" class="calibre11"></span>If the user selects a menu item by pressing the appropriate key for the tag, that menu item is highlighted but not selected. A selection isn't made until the OK button is selected by using either the mouse or the Enter key. The <code class="calibre26">dialog</code> command sends the selected menu item text to <code class="calibre26">STDERR</code>, which you can redirect as needed.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The fselect widget</h4>
<p class="calibre10">There are several fancy built-in widgets provided by the dialog command. The <code class="calibre26">fselect</code> widget is extremely handy when working with filenames. Instead of forcing the user to type a filename, you can use the <code class="calibre26">fselect</code> widget to browse to the file location and select the file, as shown in <a id="calibre_link-1196" href="#calibre_link-1101" class="calibre4">Figure 18.7</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000044.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1101" href="#calibre_link-1196" class="calibre4"><b class="calibre21">Figure 18.7</b></a></span> The fselect widget</p>
</figcaption>
</figure>
<p class="calibre10">The <code class="calibre26">fselect</code> widget format looks like:</p>
<pre class="calibre29"><code class="calibre26"> $ dialog --title "Select a file" --fselect $HOME/ 10 50 2&gt;file.txt</code></pre>
<p class="calibre10">The first parameter after the <code class="calibre26">fselect</code> option is the starting folder location used in the window. The <code class="calibre26">fselect</code> widget window consists of a directory listing on the left side, a file listing on the right side that shows all the files in the selected directory, and a simple textbox that contains the currently selected file or directory. You can manually type a filename in the textbox, or you can use the directory and file listings to select one (use the spacebar to select a file to add to the textbox).</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The dialog options</h3>
<p class="calibre10"><span type="pagebreak" title="491" id="calibre_link-823" class="calibre11"></span>In addition to the standard widgets, you can customize lots of different options in the dialog command. You've already seen the <code class="calibre26">--title</code> parameter in action. This allows you to set a title for the widget that appears at the top of the window.</p>
<p class="calibre10">Lots of other options allow you to completely customize both the appearance and the behavior of your windows. <a id="calibre_link-1197" href="#calibre_link-1150" class="calibre4">Table 18.2</a> shows the options available for the <code class="calibre26">dialog</code> command.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1150" href="#calibre_link-1197" class="calibre4"><b class="calibre21">Table 18.2</b></a></span> The dialog Command Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--add-widget</code></td>
<td class="left">Proceeds to the next dialog unless Esc or the Cancel button has been pressed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--aspect</code> <code class="calibre26"><i class="calibre12">ratio</i></code></td>
<td class="left">Specifies the width/height aspect ratio of the window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--backtitle</code> <code class="calibre26"><i class="calibre12">title</i></code></td>
<td class="left">Specifies a title to display on the background, at the top of the screen</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--begin</code> <code class="calibre26"><i class="calibre12">x y</i></code></td>
<td class="left">Specifies the starting location of the top-left corner of the window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--cancel-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the Cancel button</td>
</tr>
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--clear</code></td>
<td class="left">Clears the display using the default dialog background color</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--colors</code></td>
<td class="left">Embeds ANSI color codes in dialog text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--cr-wrap</code></td>
<td class="left">Allows <span type="pagebreak" title="492" id="calibre_link-824" class="calibre11"></span>newline characters in dialog text and forces a line wrap</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--create-rc</code> <code class="calibre26"><i class="calibre12">file</i></code></td>
<td class="left">Dumps a sample configuration file to the specified file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--defaultno</code></td>
<td class="left">Makes the default of a yes/no dialog No</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--default-item</code> <code class="calibre26"><i class="calibre12">string</i></code></td>
<td class="left">Sets the default item in a checklist, form, or menu dialog</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--exit-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the Exit button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--extra-button</code></td>
<td class="left">Displays an extra button between the OK and Cancel buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--extra-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the Extra button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--help</code></td>
<td class="left">Displays the dialog command help message</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--help-button</code></td>
<td class="left">Displays a Help button after the OK and Cancel buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--help-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the Help button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--help-status</code></td>
<td class="left">Writes the checklist, radiolist, or form information after the help information in the Help button was selected</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--ignore</code></td>
<td class="left">Ignores options that dialog does not recognize</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--input-fd</code> <code class="calibre26"><i class="calibre12">fd</i></code></td>
<td class="left">Specifies an alternative file descriptor, other than <code class="calibre26">STDIN</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--insecure</code></td>
<td class="left">Changes the password widget to display asterisks when typing</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--item-help</code></td>
<td class="left">Adds a help column at the bottom of the screen for each tag in a checklist, radiolist, or menu for the tag item</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--keep-window</code></td>
<td class="left">Doesn't clear old widgets from the screen</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--max-input</code> <code class="calibre26"><i class="calibre12">size</i></code></td>
<td class="left">Specifies a maximum string size for the input; default is 2048</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--nocancel</code></td>
<td class="left">Suppresses the Cancel button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--no-collapse</code></td>
<td class="left">Doesn't convert tabs to spaces in dialog text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--no-kill</code></td>
<td class="left">Places the tailboxbg dialog in background and disables SIGHUP for the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--no-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the No button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--no-shadow</code></td>
<td class="left">Doesn't display shadows for dialog windows</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--ok-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the OK button</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--output-fd</code> <code class="calibre26"><i class="calibre12">fd</i></code></td>
<td class="left">Specifies an alternative output file descriptor other than <code class="calibre26">STDERR</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--print-maxsize</code></td>
<td class="left">Prints the maximum size of dialog windows allowed to the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--print-size</code></td>
<td class="left">Prints the size of each dialog window to the output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--print-version</code></td>
<td class="left">Prints the dialog version to output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--separate-output</code></td>
<td class="left">Outputs <span type="pagebreak" title="493" id="calibre_link-825" class="calibre11"></span>the result of a checklist widget one line at a time with no quoting</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--separator</code> <code class="calibre26"><i class="calibre12">string</i></code></td>
<td class="left">Specifies a string that separates the output for each widget</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--separate-widget</code> <code class="calibre26"><i class="calibre12">string</i></code></td>
<td class="left">Specifies a string that separates the output for each widget</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--shadow</code></td>
<td class="left">Draws a shadow to the right and bottom of each window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--single-quoted</code></td>
<td class="left">Uses single quoting if needed for the checklist output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--sleep</code> <code class="calibre26"><i class="calibre12">sec</i></code></td>
<td class="left">Delays for the specified number of seconds after processing the dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--stderr</code></td>
<td class="left">Sends output to <code class="calibre26">STDERR</code> &mdash; the default behavior</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--stdout</code></td>
<td class="left">Sends output to <code class="calibre26">STDOUT</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--tab-correct</code></td>
<td class="left">Converts tabs to spaces</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--tab-len</code> <code class="calibre26"><i class="calibre12">n</i></code></td>
<td class="left">Specifies the number of spaces a tab character uses; default is 8</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--timeout</code> <code class="calibre26"><i class="calibre12">sec</i></code></td>
<td class="left">Specifies the number of seconds before exiting with an error code if no user input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--title</code> <code class="calibre26"><i class="calibre12">title</i></code></td>
<td class="left">Specifies the title of the dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--trim</code></td>
<td class="left">Removes leading spaces and newline characters from dialog text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--visit-items</code></td>
<td class="left">Modifies the tab stops in the dialog window to include the list of items</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--yes-label</code> <code class="calibre26"><i class="calibre12">label</i></code></td>
<td class="left">Specifies an alternative label for the Yes button</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">--backtitle</code> option is a handy way to create a common title for your menu through the script. If you specify it for each dialog window, it persists throughout your application, creating a professional look to your script.</p>
<p class="calibre10">As you can tell from <a href="#calibre_link-1150" class="calibre4">Table 18.2</a>, you can overwrite any of the button labels in your dialog window. This feature allows you to create just about any window situation you need.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using the dialog command in a script</h3>
<p class="calibre10">Using the <code class="calibre26">dialog</code> command in your scripts is a snap. There are just two things you must remember:</p>
<ul class="calibre14">
<li class="calibre7">Check the exit status of the <code class="calibre26">dialog</code> command if there's a Cancel or No button available.</li>
<li class="calibre7">Redirect <code class="calibre26">STDERR</code> to retrieve the output value.</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="494" id="calibre_link-826" class="calibre11"></span>If you follow these two rules, you'll have a professional-looking interactive script in no time. Here's an example using dialog widgets to reproduce the system admin menu created earlier in the chapter:</p>
<pre class="calibre29"><code class="calibre26"> $ cat menu3
 #!/bin/bash
 # using dialog to create a menu
 
 temp=$(mktemp -t test.XXXXXX)
 temp2=$(mktemp -t test2.XXXXXX)
 
 function diskspace {
    df -k &gt; $temp
    dialog --textbox $temp 20 60
 }
 
 function whoseon {
    who &gt; $temp
    dialog --textbox $temp 20 50
 }
 
 function memusage {
    cat /proc/meminfo &gt; $temp
    dialog --textbox $temp 20 50
 }
 
 while [ 1 ]
 do
 dialog --menu "Sys Admin Menu" 20 30 10 1 "Display disk space" 2
 "Display users" 3 "Display memory usage" 0 "Exit" 2&gt; $temp2 
 if [ $? -eq 1 ] 
 then
    break
    
 fi
 
 selection=$(cat $temp2)
 
 case $selection in
 1)
    diskspace ;;
 2)
    whoseon ;;
 3)
    memusage ;;
 0)
    break ;;
 *)
    dialog --msgbox "Sorry, invalid selection" 10 30
 esac
 done
 rm -f $temp 2&gt; /dev/null
 rm -f $temp2 2&gt; /dev/null
 $</code></pre>
<p class="calibre10">The script uses the <code class="calibre26">while</code> loop with a <span type="pagebreak" title="495" id="calibre_link-827" class="calibre11"></span>constant true value to create an endless loop displaying the menu dialog. This means that, after every function, the script returns to displaying the menu.</p>
<p class="calibre10">The <code class="calibre26">menu</code> dialog includes a Cancel button, so the script checks the exit status of the dialog command in case the user presses the Cancel button to exit. Because it's in a <code class="calibre26">while</code> loop, exiting is as easy as using the <code class="calibre26">break</code> command to jump out of the <code class="calibre26">while</code> loop.</p>
<p class="calibre10">The script uses the <code class="calibre26">mktemp</code> command to create two temporary files for holding data for the <code class="calibre26">dialog</code> commands. The first one, <code class="calibre26">$temp</code>, is used to hold the output of the <code class="calibre26">df</code>, <code class="calibre26">whoeson</code>, and <code class="calibre26">meminfo</code> commands so they can be displayed in the <code class="calibre26">textbox</code> dialog (see <a id="calibre_link-1198" href="#calibre_link-1102" class="calibre4">Figure 18.8</a>). The second temporary file, <code class="calibre26">$temp2</code>, is used to hold the selection value from the main menu dialog.</p>
<figure class="calibre23">
<img class="center" src="images/000051.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1102" href="#calibre_link-1198" class="calibre4"><b class="calibre21">Figure 18.8</b></a></span> The <code class="calibre26">meminfo</code> command output displayed using the textbox dialog option</p>
</figcaption>
</figure>
<p class="calibre10">Now this is starting to look like a real application that you can show off to people!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-261" class="calibre4"></a>Getting Graphic</h2>
<p class="calibre10">If you're looking for <span type="pagebreak" title="496" id="calibre_link-828" class="calibre11"></span>even more graphics for your interactive scripts, you can go one step further. Both the KDE and GNOME desktop environments (see Chapter 1) have expanded on the <code class="calibre26">dialog</code> command idea and include commands that produce X Window graphical widgets for their respective environments.</p>
<p class="calibre10">This section describes the kdialog and zenity packages, which provide graphical window widgets for the KDE and GNOME desktops, respectively.</p>
<section class="toclist">
<h3 class="calibre15">The KDE environment</h3>
<p class="calibre10">The KDE graphical environment includes the kdialog package by default. The kdialog package uses the <code class="calibre26">kdialog</code> command to generate standard windows, similar to the dialog-style widgets, within your KDE desktop. However, instead of having the clunky feel to them, these windows blend right in with the rest of your KDE application windows! This allows you to produce Windows-quality user interfaces directly from your shell scripts!</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Just because your Linux distribution uses the KDE desktop doesn't necessarily mean it has the kdialog package installed by default. You may need to manually install it from the distribution repository.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h4 class="calibre25">kdialog widgets</h4>
<p class="calibre10">Just like the <code class="calibre26">dialog</code> command, the <code class="calibre26">kdialog</code> command uses command line options to specify what type of window widget to use. The following is the format of the <code class="calibre26">kdialog</code> command:</p>
<pre class="calibre29"><code class="calibre26"> kdialog display-options window-options arguments</code></pre>
<p class="calibre10">The <code class="calibre26">window-options</code> options allow you to specify what type of window widget to use. The available options are shown in <a id="calibre_link-1199" href="#calibre_link-1151" class="calibre4">Table 18.3</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1151" href="#calibre_link-1199" class="calibre4"><b class="calibre21">Table 18.3</b></a></span> kdialog Window Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--checklist</code> <code class="calibre26"><i class="calibre12">title [tag item status]</i></code></td>
<td class="left">A checklist menu, with status specifying if the item is checked or not</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--error</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Error message box</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--inputbox</code> <code class="calibre26"><b class="calibre21"><i class="calibre12">text</i></b></code> <code class="calibre26"><i class="calibre12">[init]</i></code></td>
<td class="left">Input textbox where you can specify the default value using the <code class="calibre26"><i class="calibre12">init</i></code> value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--menu</code> <code class="calibre26"><b class="calibre21"><i class="calibre12">title</i></b></code> <code class="calibre26"><i class="calibre12">[tag item]</i></code></td>
<td class="left">Menu selection box title and a list of items identified by a tag</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--msgbox</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Simple message box with specified text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--password</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Password input textbox that hides user input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--radiolist</code> <code class="calibre26"><i class="calibre12">title [tag item status]</i></code></td>
<td class="left">A radiolist menu, with status specifying if the item is selected or not</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--separate-output</code></td>
<td class="left">Returns items on separate lines for checklist and radiolist menus</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--sorry</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Sorry message box</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--textbox</code> <code class="calibre26"><i class="calibre12">file [width] [height]</i></code></td>
<td class="left">Textbox displaying the contents of <code class="calibre26">file</code>, alternatively specified by <code class="calibre26"><i class="calibre12">width</i></code> and <code class="calibre26"><i class="calibre12">height</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--title</code> <code class="calibre26"><i class="calibre12">title</i></code></td>
<td class="left">Specifies a title for the TitleBar area of the dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--warningyesno</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Warning message box with Yes and No buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--warningcontinuecancel</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Warning message box with Continue and Cancel buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--warningyesnocancel</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Warning message box with Yes, No, and Cancel buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--yesno</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Question box with Yes and No buttons</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--yesnocancel</code> <code class="calibre26"><i class="calibre12">text</i></code></td>
<td class="left">Question box with Yes, No, and Cancel buttons</td>
</tr>
</table>
</figure>
<p class="calibre10">As you can see from <a href="#calibre_link-1151" class="calibre4">Table 18.3</a>, all the <span type="pagebreak" title="497" id="calibre_link-829" class="calibre11"></span>standard window dialog box types are represented. However, when you use a kdialog window widget, it appears as a separate window in the KDE desktop, not inside the terminal emulator session!</p>
<p class="calibre10">The <code class="calibre26">checklist</code> and <code class="calibre26">radiolist</code> widgets allow you to define individual items in the lists and whether they are selected by default:</p>
<pre class="calibre29"><code class="calibre26">$kdialog --checklist "Items I need" 1 "Toothbrush" on 2 "Toothpaste"
  off 3 "Hair brush" on 4 "Deodorant" off 5 "Slippers" off</code></pre>
<p class="calibre10">The resulting checklist window is shown in <a id="calibre_link-1200" href="#calibre_link-1103" class="calibre4">Figure 18.9</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000000.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1103" href="#calibre_link-1200" class="calibre4"><b class="calibre21">Figure 18.9</b></a></span> A kdialog checklist dialog window</p>
</figcaption>
</figure>
<p class="calibre10">The items specified as âonâ are highlighted in the checklist. To select or deselect an item in the checklist, just click it. If you select the OK button, the <code class="calibre26">kdialog</code> sends the tag values to <code class="calibre26">STDOUT</code>:</p>
<pre class="calibre29"><code class="calibre26">"1" "3"
$</code></pre>
<p class="calibre10">When you press the Enter key, the kdialog box appears with the selections. When you click the OK or Cancel buttons, the <code class="calibre26">kdialog</code> command returns each tag as a string value to <code class="calibre26">STDOUT</code> (these are the <code class="calibre26">â1â</code>, and <code class="calibre26">â3â</code> values you see in the output). Your script must be able to parse the resulting values and match them with the original values.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using kdialog</h4>
<p class="calibre10">You can use the <code class="calibre26">kdialog</code> window <span type="pagebreak" title="498" id="calibre_link-830" class="calibre11"></span>widgets in your shell scripts similarly to how you use the <code class="calibre26">dialog</code> widgets. The big difference is that the <code class="calibre26">kdialog</code> window widgets output values using <code class="calibre26">STDOUT</code> instead of <code class="calibre26">STDERR</code>.</p>
<p class="calibre10">Here's a script that converts the sys admin menu created earlier into a KDE application:</p>
<pre class="calibre29"><code class="calibre26"> $ cat menu4
 #!/bin/bash
 # using kdialog to create a menu
 
 temp=$(mktemp -t temp.XXXXXX)
 temp2=$(mktemp -t temp2.XXXXXX)
 
 function diskspace {
    df -k &gt; $temp
    kdialog --textbox $temp 1000 10
 }
 
 function whoseon {
    who &gt; $temp
    kdialog --textbox $temp 500 10
 }
 
 function memusage {
    cat /proc/meminfo &gt; $temp
    kdialog --textbox $temp 300 500
 }
 
 while [ 1 ]
 do
kdialog --menu "Sys Admin Menu" "1" "Display diskspace" "2" "Display
 users" "3" "Display memory usage" "0" "Exit" &gt; $temp2
 if [ $? -eq 1 ]
 then
    break
 fi
 
 selection=$(cat $temp2)
 
 case $selection in
 1)
    diskspace ;;
 2)
    whoseon ;;
 3)
    memusage ;;
 0)
    break ;;
 *)
    kdialog --msgbox "Sorry, invalid selection"
 esac
 done
 $</code></pre>
<p class="calibre10">There isn't much <span type="pagebreak" title="499" id="calibre_link-831" class="calibre11"></span>difference in the script from using the <code class="calibre26">kdialog</code> command and the <code class="calibre26">dialog</code> command. The resulting main menu generated is shown in <a id="calibre_link-1201" href="#calibre_link-1104" class="calibre4">Figure 18.10</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000003.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1104" href="#calibre_link-1201" class="calibre4"><b class="calibre21">Figure 18.10</b></a></span> The sys admin menu script using kdialog</p>
</figcaption>
</figure>
<p class="calibre10">Now your simple shell script looks just like a real KDE application! There's no limit to what you can do with your interactive scripts now.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The GNOME environment</h3>
<p class="calibre10">The GNOME graphical environment <span type="pagebreak" title="500" id="calibre_link-832" class="calibre11"></span>supports two popular packages that can generate standard windows:</p>
<ul class="calibre14">
<li class="calibre7">gdialog</li>
<li class="calibre7">zenity</li>
</ul>
<p class="calibre10">By far, zenity is the most commonly available package found in most GNOME desktop Linux distributions (it's installed by default in both Ubuntu and Fedora). This section describes the features of zenity and demonstrates how to use it in your shell scripts.</p>
<section class="toclist">
<h4 class="calibre25">zenity Widgets</h4>
<p class="calibre10">As you would expect, zenity allows you to create different windows widgets by using command line options. <a id="calibre_link-1202" href="#calibre_link-1152" class="calibre4">Table 18.4</a> shows the different widgets that zenity can produce.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1152" href="#calibre_link-1202" class="calibre4"><b class="calibre21">Table 18.4</b></a></span> The zenity Windows Widgets</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--calendar</code></td>
<td class="left">Displays a full month calendar</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--entry</code></td>
<td class="left">Displays a text entry dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--error</code></td>
<td class="left">Displays an error message dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--file-selection</code></td>
<td class="left">Displays a full pathname and filename dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--info</code></td>
<td class="left">Displays an informational dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--list</code></td>
<td class="left">Displays a checklist or radiolist dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--notification</code></td>
<td class="left">Displays a notification icon</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--progress</code></td>
<td class="left">Displays a progress bar dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--question</code></td>
<td class="left">Displays a yes/no question dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--scale</code></td>
<td class="left">Displays a scale dialog window</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--text-info</code></td>
<td class="left">Displays a textbox containing text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">--warning</code></td>
<td class="left">Displays a warning dialog window</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">zenity</code> command line program works somewhat differently than the <code class="calibre26">kdialog</code> and <code class="calibre26">dialog</code> programs. Many of the widget types are defined using additional options on the command line, instead of including them as arguments to an option.</p>
<p class="calibre10">The <code class="calibre26">zenity</code> command does offer some pretty cool advanced dialog windows. The <code class="calibre26">calendar</code> option produces a full month calendar, as shown in <a id="calibre_link-1203" href="#calibre_link-1105" class="calibre4">Figure 18.11</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000006.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1105" href="#calibre_link-1203" class="calibre4"><b class="calibre21">Figure 18.11</b></a></span> The zenity calendar dialog window</p>
</figcaption>
</figure>
<p class="calibre10">When you select a date from the calendar, the <code class="calibre26">zenity</code> command returns the value to <code class="calibre26">STDOUT</code>, just like <code class="calibre26">kdialog</code>:</p>
<pre class="calibre29"><code class="calibre26"> $ zenity --calendar
 12/25/2011
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="501" id="calibre_link-833" class="calibre11"></span>Another pretty cool window in zenity is the file selection option, shown in <a id="calibre_link-1204" href="#calibre_link-1106" class="calibre4">Figure 18.12</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000010.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1106" href="#calibre_link-1204" class="calibre4"><b class="calibre21">Figure 18.12</b></a></span> The zenity file selection dialog window</p>
</figcaption>
</figure>
<p class="calibre10">You can use the dialog window to browse to any directory location on the system (as long as you have the privileges to view the directory) and select a file. When you select a file, the <code class="calibre26">zenity</code> command returns the full file and pathname:</p>
<pre class="calibre29"><code class="calibre26"> $ zenity --file-selection
 /home/ubuntu/menu5
 $</code></pre>
<p class="calibre10">With tools like that at your disposal, the sky's the limit with your shell script creations!</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using zenity in scripts</h4>
<p class="calibre10">As you would expect, zenity performs well in shell scripts. Unfortunately, zenity chose not to follow the option convention used in <code class="calibre26">dialog</code> and <code class="calibre26">kdialog</code>, so converting any existing interactive scripts to zenity may prove challenging.</p>
<p class="calibre10"><span type="pagebreak" title="502" id="calibre_link-834" class="calibre11"></span>In converting the sys admin menu from <code class="calibre26">kdialog</code> to <code class="calibre26">zenity</code>, we had to do quite a bit of manipulation of the widget definitions:</p>
<pre class="calibre29"><code class="calibre26"> $cat menu5
 #!/bin/bash
 # using zenity to create a menu
 
 temp=$(mktemp -t temp.XXXXXX)
 temp2=$(mktemp -t temp2.XXXXXX)
 
 function diskspace {
    df -k &gt; $temp
    zenity --text-info --title "Disk space" --filename=$temp
 --width 750 --height 10
 }
 
 function whoseon {
    who &gt; $temp
    zenity --text-info --title "Logged in users" --filename=$temp
 --width 500 --height 10
 }
 
 function memusage {
    cat /proc/meminfo &gt; $temp
    zenity --text-info --title "Memory usage" --filename=$temp
 --width 300 --height 500
 }
 
 while [ 1 ]
 do
 zenity --list --radiolist --title "Sys Admin Menu" --column "Select"
--column "Menu Item" FALSE "Display diskspace" FALSE "Display users"
 FALSE "Display memory usage" FALSE "Exit" &gt; $temp2
 if [ $? -eq 1 ]
 then
    break
 fi
 
 selection=$(cat $temp2)
 case $selection in
 "Display disk space")
    diskspace ;;
 "Display users")
    whoseon ;;
 "Display memory usage")
    memusage ;;
 Exit)
    break ;;
 *)
    zenity --info "Sorry, invalid selection"
 esac
 done
 $</code></pre>
<p class="calibre10"><span type="pagebreak" title="503" id="calibre_link-835" class="calibre11"></span>Because zenity doesn't support the menu dialog window, we used a radiolist type window for the main menu, as shown in <a id="calibre_link-1205" href="#calibre_link-1107" class="calibre4">Figure 18.13</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000016.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1107" href="#calibre_link-1205" class="calibre4"><b class="calibre21">Figure 18.13</b></a></span> The sys admin menu using zenity</p>
</figcaption>
</figure>
<p class="calibre10">The radiolist uses two columns, each with a column heading. The first column includes the radio buttons to select. The second column is the item text. The radiolist also doesn't use tags for the items. When you select an item, the full text of the item is returned to <code class="calibre26">STDOUT</code>. This makes life a little more interesting for the <code class="calibre26">case</code> command. You must use the full text from the items in the case options. If there are any spaces in the text, you need to use quotation marks around the text.</p>
<p class="calibre10">Using the zenity package, you can add a Windows feel to your interactive shell scripts in the GNOME desktop.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-262" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="504" id="calibre_link-836" class="calibre11"></span>Interactive shell scripts have a reputation for being dull and boring. You can change that by using a few different techniques and tools available on most Linux systems. First, you can create menu systems for your interactive scripts by using the <code class="calibre26">case</code> command and shell script functions.</p>
<p class="calibre10">The <code class="calibre26">menu</code> command allows you to paint a menu, using the standard <code class="calibre26">echo</code> command, and read a response from the user, using the <code class="calibre26">read</code> command. The <code class="calibre26">case</code> command then selects the appropriate shell script function based on the value entered.</p>
<p class="calibre10">The <code class="calibre26">dialog</code> program provides several prebuilt text widgets for creating Windows-like objects on a text-based terminal emulator. You can create dialog boxes for displaying text, entering text, and choosing files and dates by using the dialog program. This helps bring even more life to your shell script.</p>
<p class="calibre10">If you're running your shell scripts in a graphical X Window environment, you can utilize even more tools in your interactive scripts. For the KDE desktop, there's the <code class="calibre26">kdialog</code> program. This program provides simple commands to create windows widgets for all the basic windows functions. For the GNOME desktop, there are the <code class="calibre26">gdialog</code> and <code class="calibre26">zenity</code> programs. Each of these programs provides window widgets that blend into the GNOME desktop just like a real Windows application.</p>
<p class="calibre10">The next chapter dives into the subject of editing and manipulating text data files. Often the biggest use of shell scripts revolves around parsing and displaying data in text files such as log and error files. The Linux environment includes two very useful tools, <code class="calibre26">sed</code> and <code class="calibre26">gawk</code>, for working with text data in your shell scripts. The next chapter introduces you to these tools, and shows the basics of how to use them.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-90">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-263" class="calibre4"></a><span class="chaptertitle">Chapter 19</span><br class="calibre22" /><span class="chaptertitle">Introducing sed and gawk</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Learning about the sed Editor</li>
<li class="calibre7">Getting introduced to the gawk Editor</li>
<li class="calibre7">Exploring sed Editor basics</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="505" id="calibre_link-837" class="calibre11"></span>By far, one of the most common functions that people use shell scripts for is to work with text files. Between examining log files, reading configuration files, and handling data elements, shell scripts can help automate the mundane tasks of manipulating any type of data contained in text files. However, trying to manipulate the contents of text files using just shell script commands can be somewhat awkward. If you perform any type of data manipulation in your shell scripts, you want to become familiar with the <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> tools available in Linux. These tools can greatly simplify any data-handling tasks you need to perform.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-264" class="calibre4"></a>Manipulating Text</h2>
<p class="calibre10">Chapter 10 showed you how to edit text files using different editor programs available in the Linux environment. These editors enable you to easily manipulate text contained in a text file by using simple commands or mouse clicks.</p>
<p class="calibre10">There are times, however, when you'll find yourself wanting to manipulate text in a text file on the fly, without having to pull out a full-fledged interactive text editor. In these situations, it would be useful to have a simple command line editor that could easily format, insert, modify, or delete text elements automatically.</p>
<p class="calibre10">The Linux system provides two common tools for doing just that. This section describes the two most popular command line editors used in the Linux world, <code class="calibre26">sed</code> and <code class="calibre26">gawk</code>.</p>
<section class="toclist">
<h3 class="calibre15">Getting to know the sed editor</h3>
<p class="calibre10">The <code class="calibre26">sed</code> editor is called a <span class="chaptertitle"><i class="calibre12">stream editor</i></span>, as opposed to a normal interactive text editor. In an interactive text editor, such as <code class="calibre26">vim</code>, you interactively use keyboard commands to insert, delete, or replace text in the data. A stream editor edits a stream of data based on a set of rules you supply ahead of time, before the editor processes the data.</p>
<p class="calibre10">The <code class="calibre26">sed</code> editor can <span type="pagebreak" title="506" id="calibre_link-838" class="calibre11"></span>manipulate data in a data stream based on commands you either enter into the command line or store in a command text file. The <code class="calibre26">sed</code> editor does these things:</p>
<ol class="calibre6">
<li class="calibre7">Reads one data line at a time from the input</li>
<li class="calibre7">Matches that data with the supplied editor commands</li>
<li class="calibre7">Changes data in the stream as specified in the commands</li>
<li class="calibre7">Outputs the new data to <code class="calibre26">STDOUT</code></li>
</ol>
<p class="calibre10">After the stream editor matches all the commands against a line of data, it reads the next line of data and repeats the process. After the stream editor processes all the lines of data in the stream, it terminates.</p>
<p class="calibre10">Because the commands are applied sequentially line by line, the <code class="calibre26">sed</code> editor makes only one pass through the data stream to make the edits. This makes the <code class="calibre26">sed</code> editor much faster than an interactive editor and allows you to quickly make changes to data in a file on the fly.</p>
<p class="calibre10">Here's the format for using the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">sed</b></code> <code class="calibre26"><i class="calibre12">options script file</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">options</i></code> parameters allow you to customize the behavior of the <code class="calibre26">sed</code> command and include the options shown in <a id="calibre_link-1217" href="#calibre_link-1153" class="calibre4">Table 19.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1153" href="#calibre_link-1217" class="calibre4"><b class="calibre21">Table 19.1</b></a></span> The sed Command Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e script</code></td>
<td class="left">Adds commands specified in the script to the commands run while processing the input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f file</code></td>
<td class="left">Adds the commands specified in the file to the commands run while processing the input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Doesn't produce output for each command, but waits for the <code class="calibre26">print</code> command</td>
</tr>
</table>
</figure>
<p class="calibre10">The script parameter specifies a single command to apply against the stream data. If more than one command is required, you must use either the <code class="calibre26">-e</code> option to specify them in the command line or the <code class="calibre26">-f</code> option to specify them in a separate file. Numerous commands are available for manipulating data. We examine some of the basic commands used by the <code class="calibre26">sed</code> editor in this chapter and then look at some of the more advanced commands in Chapter 21.</p>
<section class="toclist">
<h4 class="calibre25">Defining an editor command in the command line</h4>
<p class="calibre10">By default, the <code class="calibre26">sed</code> editor applies the specified commands to the <code class="calibre26">STDIN</code> input stream. This allows you to pipe data directly to the <code class="calibre26">sed</code> editor for processing. Here's a quick example demonstrating how to do this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This is a test" | sed 's/test/big test/'</b></code>
This is a big test
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="507" id="calibre_link-839" class="calibre11"></span>This example uses the <code class="calibre26">s</code> command in the <code class="calibre26">sed</code> editor. The <code class="calibre26">s</code> command substitutes a second text string for the first text string pattern specified between the forward slashes. In this example, the words <code class="calibre26">big test</code> were substituted for the word <code class="calibre26">test</code>.</p>
<p class="calibre10">When you run this example, it should display the results almost instantaneously. That's the power of using the <code class="calibre26">sed</code> editor. You can make multiple edits to data in about the same time it takes for some of the interactive editors just to start up.</p>
<p class="calibre10">Of course, this simple test just edited one line of data. You should get the same speedy results when editing complete files of data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data1.txt</b></code>
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
$
$ <code class="calibre26"><b class="calibre21">sed 's/dog/cat/' data1.txt</b></code>
The quick brown fox jumps over the lazy cat.
The quick brown fox jumps over the lazy cat.
The quick brown fox jumps over the lazy cat.
The quick brown fox jumps over the lazy cat.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> command executes and returns the data almost instantaneously. As it processes each line of data, the results are displayed. You'll start seeing results before the <code class="calibre26">sed</code> editor completes processing the entire file.</p>
<p class="calibre10">It's important to note that the <code class="calibre26">sed</code> editor doesn't modify the data in the text file itself. It only sends the modified text to <code class="calibre26">STDOUT</code>. If you look at the text file, it still contains the original data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data1.txt</b></code>
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
$</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">Using multiple editor commands in the command line</h4>
<p class="calibre10">To execute more than one command from the <code class="calibre26">sed</code> command line, just use the <code class="calibre26">-e</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -e 's/brown/green/; s/dog/cat/' data1.txt</b></code>
The quick green fox jumps over the lazy cat.
The quick green fox jumps over the lazy cat.
The quick green fox jumps over the lazy cat.
The quick green fox jumps over the lazy cat.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="508" id="calibre_link-840" class="calibre11"></span>Both commands are applied to each line of data in the file. The commands must be separated with a semicolon, and there shouldn't be any spaces between the end of the command and the semicolon.</p>
<p class="calibre10">Instead of using a semicolon to separate the commands, you can use the secondary prompt in the bash shell. Just enter the first single quotation mark to open the <code class="calibre26">sed</code> program script (<code class="calibre26">sed</code> editor command list), and bash continues to prompt you for more commands until you enter the closing quotation mark:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -e '</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/brown/green/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/fox/elephant/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/dog/cat/' data1.txt</b></code>
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
$</code></pre>
<p class="calibre10">You must remember to finish the command on the same line where the closing single quotation mark appears. After the bash shell detects the closing quotation mark, it processes the command. After it starts, the <code class="calibre26">sed</code> command applies each command you specified to each line of data in the text file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading editor commands from a file</h4>
<p class="calibre10">Finally, if you have lots of <code class="calibre26">sed</code> commands you want to process, it is often easier to just store them in a separate file. Use the <code class="calibre26">-f</code> option to specify the file in the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat script1.sed</b></code>
s/brown/green/
s/fox/elephant/
s/dog/cat/
$
$ <code class="calibre26"><b class="calibre21">sed -f script1.sed data1.txt</b></code>
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
The quick green elephant jumps over the lazy cat.
$</code></pre>
<p class="calibre10">In this case, you don't put a semicolon after each command. The <code class="calibre26">sed</code> editor knows that each line contains a separate command. As with entering commands on the command line, the <code class="calibre26">sed</code> editor reads the <span type="pagebreak" title="509" id="calibre_link-841" class="calibre11"></span>commands from the specified file and applies them to each line in the data file.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">It can be easy to confuse your <code class="calibre26">sed</code> editor script files with your bash shell script files. To eliminate confusion, use a <code class="calibre26">.sed</code> file extension on your <code class="calibre26">sed</code> script files.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">We'll look at some other <code class="calibre26">sed</code> editor commands that come in handy for manipulating data in the âCommanding at the <code class="calibre26">sed</code> Editor Basicsâ section. Before that, let's quickly look at the other Linux data editor.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Getting to know the gawk program</h3>
<p class="calibre10">Although the <code class="calibre26">sed</code> editor is a handy tool for modifying text files on the fly, it has its limitations. Often, you need a more advanced tool for manipulating data in a file, one that provides a more programming-like environment allowing you to modify and reorganize data in a file. This is where <code class="calibre26">gawk</code> comes in.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">gawk</code> program is not installed by default on all distributions. If your Linux distribution does not have the <code class="calibre26">gawk</code> program, install the <code class="calibre26">gawk</code> package using Chapter 9 as a guide.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">gawk</code> program is the GNU version of the original <code class="calibre26">awk</code> program in Unix. The <code class="calibre26">gawk</code> program takes stream editing one step further than the <code class="calibre26">sed</code> editor by providing a programming language instead of just editor commands. Within the <code class="calibre26">gawk</code> programming language, you can do the following:</p>
<ul class="calibre14">
<li class="calibre7">Define variables to store data.</li>
<li class="calibre7">Use arithmetic and string operators to operate on data.</li>
<li class="calibre7">Use structured programming concepts, such as <code class="calibre26">if-then</code> statements and loops, to add logic to your data processing.</li>
<li class="calibre7">Generate formatted reports by extracting data elements within the data file and repositioning them in another order or format.</li>
</ul>
<p class="calibre10">The <code class="calibre26">gawk</code> program's report-generating capabilities are often used for extracting data elements from large bulky text files and formatting them into a readable report. The perfect example of this is formatting log files. Trying to pore through lines of errors in a log file can be difficult. The <code class="calibre26">gawk</code> program allows you to filter just the data elements you want to view from the log file, and then you can format them in a manner that makes reading the important data easier.</p>
<section class="toclist">
<h4 class="calibre25">Visiting the gawk command format</h4>
<p class="calibre10">Here's the basic format of the <code class="calibre26">gawk</code> program:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">gawk</b></code> <code class="calibre26"><i class="calibre12">options program file</i></code></code></pre>
<p class="calibre10"><a id="calibre_link-1218" href="#calibre_link-1154" class="calibre4">Table 19.2</a> shows the options available with the <code class="calibre26">gawk</code> program.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1154" href="#calibre_link-1218" class="calibre4"><b class="calibre21">Table 19.2</b></a></span> The gawk Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-F fs</code></td>
<td class="left">Specifies a file separator for delineating data fields in a line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f file</code></td>
<td class="left">Specifies a file name to read the program from</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v var=value</code></td>
<td class="left">Defines a variable and default value used in the <code class="calibre26">gawk</code> program</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-mf N</code></td>
<td class="left">Specifies the maximum number of fields to process in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-mr N</code></td>
<td class="left">Specifies the maximum record size in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-W keyword</code></td>
<td class="left">Specifies the compatibility mode or warning level for <code class="calibre26">gawk</code></td>
</tr>
</table>
</figure>
<p class="calibre10">The command line options provide an easy way to customize features in the <code class="calibre26">gawk</code> program. We'll look more closely at these as we explore <code class="calibre26">gawk</code>.</p>
<p class="calibre10">The power of <code class="calibre26">gawk</code> is in <span type="pagebreak" title="510" id="calibre_link-842" class="calibre11"></span>the program script. You can write scripts to read the data within a text line and then manipulate and display the data to create any type of output report.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading the program script from the command line</h4>
<p class="calibre10">A <code class="calibre26">gawk</code> program script is defined by opening and closing braces. You must place script commands between the two braces (<code class="calibre26">{}</code>). If you incorrectly use a parenthesis instead of a brace to enclose your gawk script, you get error messages, similar to the following:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26">$ </code><code class="calibre26"><b class="calibre21">gawk '(print "Hello World!"}'</b></code>
<code class="calibre26">gawk: (print "Hello World!"}</code>
<code class="calibre26">gawk:  â§ syntax error</code></code></pre>
<p class="calibre10">Because the <code class="calibre26">gawk</code> command line assumes that the script is a single text string, you must also enclose your script in single quotation marks. Here's an example of a simple <code class="calibre26">gawk</code> program script specified on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk '{print "Hello World!"}'</b></code></code></pre>
<p class="calibre10">The program script defines a single command, the <code class="calibre26">print</code> command. The <code class="calibre26">print</code> command does what it says: It prints text to <code class="calibre26">STDOUT</code>. If you try running this command, you'll be somewhat disappointed, because nothing happens right away. Because no filename was defined in the command line, the <code class="calibre26">gawk</code> program retrieves data from <code class="calibre26">STDIN</code>. When you run the program, it just waits for text to come in via <code class="calibre26">STDIN</code>.</p>
<p class="calibre10">If you type a line of text and press the Enter key, <code class="calibre26">gawk</code> runs the text <span type="pagebreak" title="511" id="calibre_link-843" class="calibre11"></span>through the program script. Just like the <code class="calibre26">sed</code> editor, the <code class="calibre26">gawk</code> program executes the program script on each line of text available in the data stream. Because the program script is set to display a fixed text string, no matter what text you enter in the data stream, you get the same text output:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk '{print "Hello World!"}'</b></code>
<code class="calibre26"><b class="calibre21">This is a test</b></code>
Hello World!
<code class="calibre26"><b class="calibre21">hello</b></code>
Hello World!
<code class="calibre26"><b class="calibre21">This is another test</b></code>
Hello World!</code></pre>
<p class="calibre10">To terminate the <code class="calibre26">gawk</code> program, you must signal that the data stream has ended. The bash shell provides a key combination to generate an End-of-File (EOF) character. The Ctrl+D key combination generates an EOF character in bash. Using that key combination terminates the <code class="calibre26">gawk</code> program and returns you to a command line interface prompt.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using data field variables</h4>
<p class="calibre10">One of the primary features of <code class="calibre26">gawk</code> is its ability to manipulate data in the text file. It does this by automatically assigning a variable to each data element in a line. By default, <code class="calibre26">gawk</code> assigns the following variables to each data field it detects in the line of text:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">$0</code> represents the entire line of text.</li>
<li class="calibre7"><code class="calibre26">$1</code> represents the first data field in the line of text.</li>
<li class="calibre7"><code class="calibre26">$2</code> represents the second data field in the line of text.</li>
<li class="calibre7"><code class="calibre26">$n</code> represents the <i class="calibre12">n</i>th data field in the line of text.</li>
</ul>
<p class="calibre10">Each data field is determined in a text line by a <span class="chaptertitle"><i class="calibre12">field separation character</i></span>. When <code class="calibre26">gawk</code> reads a line of text, it delineates each data field using the defined field separation character. The default field separation character in <code class="calibre26">gawk</code> is any whitespace character (such as the tab or space characters).</p>
<p class="calibre10">Here's an example <code class="calibre26">gawk</code> program that reads a text file and displays only the first data field value:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data2.txt</b></code>
One line of test text.
Two lines of test text.
Three lines of test text.
$
$ <code class="calibre26"><b class="calibre21">gawk '{print $1}' data2.txt</b></code>
One
Two
Three
$</code></pre>
<p class="calibre10">This program uses the <code class="calibre26">$1</code> field variable <span type="pagebreak" title="512" id="calibre_link-844" class="calibre11"></span>to display only the first data field for each line of text.</p>
<p class="calibre10">If you're reading a file that uses a different field separation character, you can specify it by using the <code class="calibre26">-F</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk -F: '{print $1}' /etc/passwd</b></code>
root
bin
daemon
adm
lp
sync
shutdown
halt
mail
[...]</code></pre>
<p class="calibre10">This short program displays the first data field in the password file on the system. Because the <code class="calibre26">/etc/passwd</code> file uses a colon to separate the data fields, if you want to separate each data element, you must specify it as the field separation character in the <code class="calibre26">gawk</code> options.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using multiple commands in the program script</h4>
<p class="calibre10">A programming language wouldn't be very useful if you could only execute one command. The <code class="calibre26">gawk</code> programming language allows you to combine commands into a normal program. To use multiple commands in the program script specified on the command line, just place a semicolon between each command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "My name is Rich" | gawk '{$4="Christine"; print $0}'</b></code>
My name is Christine
$</code></pre>
<p class="calibre10">The first command assigns a value to the <code class="calibre26">$4</code> field variable. The second command then prints the entire data field. Notice from the output that the <code class="calibre26">gawk</code> program replaced the fourth data field in the original text with the new value.</p>
<p class="calibre10">You can also use the secondary prompt to enter your program script commands one line at a time:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">$4="Christine"</b></code>
&gt; <code class="calibre26"><b class="calibre21">print $0}'</b></code>
<code class="calibre26"><b class="calibre21">My name is Rich</b></code>
My name is Christine
$</code></pre>
<p class="calibre10">After you open the single quotation mark, the bash shell provides the secondary prompt to prompt you for more data. You can add your commands one at a time on each line until you enter the <span type="pagebreak" title="513" id="calibre_link-845" class="calibre11"></span>closing single quotation mark. Because no filename was defined in the command line, the <code class="calibre26">gawk</code> program retrieves data from <code class="calibre26">STDIN</code>. When you run the program, it waits for text to come in via <code class="calibre26">STDIN</code>. To exit the program, just press the Ctrl+D key combination to signal the end of the data.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading the program from a file</h4>
<p class="calibre10">As with the <code class="calibre26">sed</code> editor, the <code class="calibre26">gawk</code> editor allows you to store your programs in a file and refer to them in the command line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat script2.gawk</b></code>
{print $1 "'s home directory is " $6}
$
$ <code class="calibre26"><b class="calibre21">gawk -F: -f script2.gawk /etc/passwd</b></code>
root's home directory is /root
bin's home directory is /bin
daemon's home directory is /sbin
adm's home directory is /var/adm
lp's home directory is /var/spool/lpd
[...]
Christine's home directory is /home/Christine
Samantha's home directory is /home/Samantha
Timothy's home directory is /home/Timothy
$</code></pre>
<p class="calibre10">The <code class="calibre26">script2.gawk</code> program script uses the <code class="calibre26">print</code> command again to print the <code class="calibre26">/etc/passwd</code> file's home directory data field (field variable <code class="calibre26">$6</code>) and the userid data field (field variable <code class="calibre26">$1</code>).</p>
<p class="calibre10">You can specify multiple commands in the program file. To do so, just place each command on a separate line. You don't need to use semicolons:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat script3.gawk</b></code>
{
text = "'s home directory is "
print $1 text $6
}
$
$ <code class="calibre26"><b class="calibre21">gawk -F: -f script3.gawk /etc/passwd</b></code>
root's home directory is /root
bin's home directory is /bin
daemon's home directory is /sbin
adm's home directory is /var/adm
lp's home directory is /var/spool/lpd
[...]
Christine's home directory is /home/Christine
Samantha's home directory is /home/Samantha
Timothy's home directory is /home/Timothy
$</code></pre>
<p class="calibre10">The <code class="calibre26">script3.gawk</code> program <span type="pagebreak" title="514" id="calibre_link-846" class="calibre11"></span>script defines a variable to hold a text string used in the <code class="calibre26">print</code> command. Notice that <code class="calibre26">gawk</code> programs don't use a dollar sign when referencing a variable's value, as a shell script does.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Running scripts before processing data</h4>
<p class="calibre10">The <code class="calibre26">gawk</code> program also allows you to specify when the program script is run. By default, <code class="calibre26">gawk</code> reads a line of text from the input and then executes the program script on the data in the line of text. Sometimes, you may need to run a script before processing data, such as to create a header section for a report. The <code class="calibre26">BEGIN</code> keyword is used to accomplish this. It forces <code class="calibre26">gawk</code> to execute the program script specified after the <code class="calibre26">BEGIN</code> keyword, before <code class="calibre26">gawk</code> reads the data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk 'BEGIN {print "Hello World!"}'</b></code>
Hello World!
$</code></pre>
<p class="calibre10">This time the <code class="calibre26">print</code> command displays the text before reading any data. However, after it displays the text, it quickly exits, without waiting for any data.</p>
<p class="calibre10">The reason for this is that the <code class="calibre26">BEGIN</code> keyword only applies the specified script before it processes any data. If you want to process data with a normal program script, you must define the program using another script section:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data3.txt</b></code>
Line 1
Line 2
Line 3
$
$ <code class="calibre26"><b class="calibre21">gawk 'BEGIN {print ''The data3 File Contents:''}</b></code>
&gt; <code class="calibre26"><b class="calibre21">{print $0}' data3.txt</b></code>
The data3 File Contents:
Line 1
Line 2
Line 3
$</code></pre>
<p class="calibre10">Now after <code class="calibre26">gawk</code> executes the <code class="calibre26">BEGIN</code> script, it uses the second script to process any file data. Be careful when doing this; both of the scripts are still considered one text string on the <code class="calibre26">gawk</code> command line. You need to place your single quotation marks accordingly.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Running scripts after processing data</h4>
<p class="calibre10">Like the <code class="calibre26">BEGIN</code> keyword, the <code class="calibre26">END</code> keyword allows you to specify a program script that <code class="calibre26">gawk</code> executes after reading the data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk 'BEGIN {print "The data3 File Contents:"}</b></code>
&gt; <code class="calibre26"><b class="calibre21">{print $0}</b></code>
&gt; <code class="calibre26"><b class="calibre21">END {print "End of File"}' data3.txt</b></code>
The data3 File Contents:
Line 1
Line 2
Line 3
End of File
$</code></pre>
<p class="calibre10">When the <code class="calibre26">gawk</code> program is <span type="pagebreak" title="515" id="calibre_link-847" class="calibre11"></span>finished printing the file contents, it executes the commands in the <code class="calibre26">END</code> script. This is a great technique to use to add footer data to reports after all the normal data has been processed.</p>
<p class="calibre10">You can put all these elements together into a nice little program script file to create a full report from a simple data file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat script4.gawk</b></code>
BEGIN {
print "The latest list of users and shells"
print " UserID \t Shell"
print "-------- \t -------"
FS=":"
}
{
print $1 "     \t "  $7
}
END {
print "This concludes the listing"
}
$</code></pre>
<p class="calibre10">This script uses the <code class="calibre26">BEGIN</code> script to create a header section for the report. It also defines a special variable called <code class="calibre26">FS</code>. This is yet another way to define the field separation character. This way, you don't have to depend on the script's user to define the field separation character in the command line options.</p>
<p class="calibre10">Here's a somewhat truncated output from running this <code class="calibre26">gawk</code> program script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">gawk -f script4.gawk /etc/passwd</b></code>
The latest list of users and shells
 UserID          Shell
--------         -------
root             /bin/bash
bin              /sbin/nologin
daemon           /sbin/nologin
[...]
Christine        /bin/bash
mysql            /bin/bash
Samantha         /bin/bash
Timothy          /bin/bash
This concludes the listing
$</code></pre>
<p class="calibre10">As expected, the <code class="calibre26">BEGIN</code> script <span type="pagebreak" title="516" id="calibre_link-848" class="calibre11"></span>created the header text, the program script processed the information from the specified data file (the <code class="calibre26">/etc/passwd</code> file), and the <code class="calibre26">END</code> script produced the footer text. The <code class="calibre26">ât</code> within the <code class="calibre26">print</code> command produces some nicely formatted tabbed output.</p>
<p class="calibre10">This gives you a small taste of the power available when you use simple <code class="calibre26">gawk</code> scripts. Chapter 22 describes some more basic programming principles available for your <code class="calibre26">gawk</code> scripts, along with some even more advanced programming concepts you can use in your <code class="calibre26">gawk</code> program scripts to create professional looking reports from even the most cryptic data files.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-265" class="calibre4"></a>Commanding at the sed Editor Basics</h2>
<p class="calibre10">The key to successfully using the <code class="calibre26">sed</code> editor is to know its myriad of commands and formats, which help you to customize your text editing. This section describes some of the basic commands and features you can incorporate into your script to start using the <code class="calibre26">sed</code> editor.</p>
<section class="toclist">
<h3 class="calibre15">Introducing more substitution options</h3>
<p class="calibre10">You've already seen how to use the <code class="calibre26">s</code> command to substitute new text for the text in a line. However, a few additional options are available for the <code class="calibre26">substitute</code> command that can help make your life easier.</p>
<section class="toclist">
<h4 class="calibre25">Substituting flags</h4>
<p class="calibre10">There's a caveat to how the <code class="calibre26">substitute</code> command replaces matching patterns in the text string. Watch what happens in this example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data4.txt</b></code>
This is a test of the test script.
This is the second test of the test script.
$
$ <code class="calibre26"><b class="calibre21">sed 's/test/trial/' data4.txt</b></code>
This is a trial of the test script.
This is the second trial of the test script.
$</code></pre>
<p class="calibre10">The <code class="calibre26">substitute</code> command <span type="pagebreak" title="517" id="calibre_link-849" class="calibre11"></span>works fine in replacing text in multiple lines, but by default, it replaces only the first occurrence in each line. To get the <code class="calibre26">substitute</code> command to work on different occurrences of the text, you must use a <span class="chaptertitle"><i class="calibre12">substitution flag</i></span>. The substitution flag is set after the substitution command strings:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">s/pattern/replacement/flags</i></code></code></pre>
<p class="calibre10">Four types of substitution flags are available:</p>
<ul class="calibre14">
<li class="calibre7">A number, indicating the pattern occurrence for which new text should be substituted</li>
<li class="calibre7"><code class="calibre26">g</code>, indicating that new text should be substituted for all occurrences of the existing text</li>
<li class="calibre7"><code class="calibre26">p</code>, indicating that the contents of the original line should be printed</li>
<li class="calibre7"><code class="calibre26">w</code> <i class="calibre12">file</i>, which means to write the results of the substitution to a file</li>
</ul>
<p class="calibre10">In the first type of substitution, you can specify which occurrence of the matching pattern the <code class="calibre26">sed</code> editor should substitute new text for:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/test/trial/2' data4.txt</b></code>
This is a test of the trial script.
This is the second test of the trial script.
$</code></pre>
<p class="calibre10">As a result of specifying a <code class="calibre26">2</code> as the substitution flag, the <code class="calibre26">sed</code> editor replaces the pattern only in the second occurrence in each line. The <code class="calibre26">g</code> substitution flag enables you to replace every occurrence of the pattern in the text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/test/trial/g' data4.txt</b></code>
This is a trial of the trial script.
This is the second trial of the trial script.
$</code></pre>
<p class="calibre10">The <code class="calibre26">p</code> substitution flag prints a line that contains a matching pattern in the substitute command. This is most often used in conjunction with the <code class="calibre26">-n sed</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data5.txt</b></code>
This is a test line.
This is a different line.
$
$ <code class="calibre26"><b class="calibre21">sed -n 's/test/trial/p' data5.txt</b></code>
This is a trial line.
$</code></pre>
<p class="calibre10">The <code class="calibre26">-n</code> option suppresses output from the <code class="calibre26">sed</code> editor. However, the <code class="calibre26">p</code> substitution flag outputs any line that has been modified. Using the two in combination produces output only for lines that have been modified by the substitute command.</p>
<p class="calibre10">The <code class="calibre26">w</code> substitution flag produces the same output but stores the output in the specified file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/test/trial/w test.txt' data5.txt</b></code>
This is a trial line.
This is a different line.
$
$ <code class="calibre26"><b class="calibre21">cat test.txt</b></code>
This is a trial line.
$</code></pre>
<p class="calibre10">The normal output of the <code class="calibre26">sed</code> editor appears in <code class="calibre26">STDOUT</code>, but only the lines that include the matching <span type="pagebreak" title="518" id="calibre_link-850" class="calibre11"></span>pattern are stored in the specified output file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Replacing characters</h4>
<p class="calibre10">Sometimes, you run across characters in text strings that aren't easy to use in the substitution pattern. One popular example in the Linux world is the forward slash (/).</p>
<p class="calibre10">Substituting pathnames in a file can get awkward. For example, if you wanted to substitute the C shell for the bash shell in the <code class="calibre26">/etc/passwd</code> file, you'd have to do this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/\/bin\/bash/\/bin\/csh/' /etc/passwd</b></code></code></pre>
<p class="calibre10">Because the forward slash is used as the string delimiter, you must use a backslash to escape it if it appears in the pattern text. This often leads to confusion and mistakes.</p>
<p class="calibre10">To solve this problem, the <code class="calibre26">sed</code> editor allows you to select a different character for the string delimiter in the substitute command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's!/bin/bash!/bin/csh!' /etc/passwd</b></code></code></pre>
<p class="calibre10">In this example, the exclamation point is used for the string delimiter, making the pathnames much easier to read and understand.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using addresses</h3>
<p class="calibre10">By default, the commands you use in the <code class="calibre26">sed</code> editor apply to all lines of the text data. If you want to apply a command only to a specific line or a group of lines, you must use <span class="chaptertitle"><i class="calibre12">line addressing.</i></span></p>
<p class="calibre10">There are two forms of line addressing in the <code class="calibre26">sed</code> editor:</p>
<ul class="calibre14">
<li class="calibre7">A numeric range of lines</li>
<li class="calibre7">A text pattern that filters out a line</li>
</ul>
<p class="calibre10">Both forms use the same format for specifying the address:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]command</code></pre>
<p class="calibre10">You can also group more than one command together for a specific address:</p>
<pre class="calibre29"><code class="calibre26">address {
    command1
    command2
    command3
}</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor applies each of <span type="pagebreak" title="519" id="calibre_link-851" class="calibre11"></span>the commands you specify only to lines that match the address specified. This section demonstrates using both of these addressing techniques in your <code class="calibre26">sed</code> editor scripts.</p>
<section class="toclist">
<h4 class="calibre25">Addressing the numeric line</h4>
<p class="calibre10">When using numeric line addressing, you reference lines using their line position in the text stream. The <code class="calibre26">sed</code> editor assigns the first line in the text stream as line number one and continues sequentially for each new line.</p>
<p class="calibre10">The address you specify in the command can be a single line number or a range of lines specified by a starting line number, a comma, and an ending line number. Here's an example of specifying a line number to which the <code class="calibre26">sed</code> command will be applied:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2s/dog/cat/' data1.txt</b></code>
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy cat
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy dog
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor modified the text only in line two per the address specified. Here's another example, this time using a range of line addresses:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2,3s/dog/cat/' data1.txt</b></code>
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy cat
The quick brown fox jumps over the lazy cat
The quick brown fox jumps over the lazy dog
$</code></pre>
<p class="calibre10">If you want to apply a command to a group of lines starting at some point within the text, but continuing to the end of the text, you can use the special address, the dollar sign:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2,$s/dog/cat/' data1.txt</b></code>
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy cat
The quick brown fox jumps over the lazy cat
The quick brown fox jumps over the lazy cat
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="520" id="calibre_link-852" class="calibre11"></span>Because you may not know how many lines of data are in the text, the dollar sign often comes in handy.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using text pattern filters</h4>
<p class="calibre10">The other method of restricting which lines a command applies to is a bit more complicated. The <code class="calibre26">sed</code> editor allows you to specify a text pattern that it uses to filter lines for the command. This is the format:</p>
<pre class="calibre29"><code class="calibre26">/<code class="calibre26"><i class="calibre12">pattern</i></code>/command</code></pre>
<p class="calibre10">You must encapsulate the <span class="chaptertitle"><i class="calibre12">pattern</i></span> you specify in forward slashes. The <code class="calibre26">sed</code> editor applies the command only to lines that contain the text pattern you specify.</p>
<p class="calibre10">For example, if you want to change the default shell for only the user Samantha, you'd use the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">grep Samantha /etc/passwd</b></code>
Samantha:x:502:502::/home/Samantha:/bin/bash
$
$ <code class="calibre26"><b class="calibre21">sed '/Samantha/s/bash/csh/' /etc/passwd</b></code>
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
[...]
Christine:x:501:501:Christine B:/home/Christine:/bin/bash
Samantha:x:502:502::/home/Samantha:/bin/csh
Timothy:x:503:503::/home/Timothy:/bin/bash
$</code></pre>
<p class="calibre10">The command was applied only to the line with the matching text pattern. Although using a fixed text pattern may be useful for filtering specific values, as in the <code class="calibre26">userid</code> example, it's somewhat limited in what you can do with it. The <code class="calibre26">sed</code> editor uses a feature called <span class="chaptertitle"><i class="calibre12">regular expressions</i></span> in text patterns to allow you to create patterns that get pretty involved.</p>
<p class="calibre10">Regular expressions allow you to create advanced text pattern&ndash;matching formulas to match all sorts of data. These formulas combine a series of wildcard characters, special characters, and fixed text characters to produce a concise pattern that can match just about any text situation. Regular expressions are one of the scarier parts of shell script programming, and Chapter 20 covers them in great detail.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Grouping commands</h4>
<p class="calibre10">If you need to perform more than one command on an individual line, group the commands together using braces. The <code class="calibre26">sed</code> editor processes each command listed on the address line(s):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2{</b></code>
<code class="calibre26"><b class="calibre21">&gt; s/fox/elephant/</b></code>
<code class="calibre26"><b class="calibre21">&gt; s/dog/cat/</b></code>
<code class="calibre26"><b class="calibre21">&gt; }' data1.txt</b></code>
The quick brown fox jumps over the lazy dog.
The quick brown elephant jumps over the lazy cat.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="521" id="calibre_link-853" class="calibre11"></span>Both commands are processed against the address. And of course, you can specify an address range before the grouped commands:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '3,${</b></code>
<code class="calibre26"><b class="calibre21">&gt; s/brown/green/</b></code>
<code class="calibre26"><b class="calibre21">&gt; s/lazy/active/</b></code>
<code class="calibre26"><b class="calibre21">&gt; }' data1.txt</b></code>
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick green fox jumps over the active dog.
The quick green fox jumps over the active dog.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor applies all the commands to all the lines in the address range.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Deleting lines</h3>
<p class="calibre10">The text substitution command isn't the only command available in the <code class="calibre26">sed</code> editor. If you need to delete specific lines of text in a text stream, you can use the <code class="calibre26">delete</code> command.</p>
<p class="calibre10">The <code class="calibre26">delete</code> command, <code class="calibre26">d</code>, pretty much does what it says. It deletes any text lines that match the addressing scheme supplied. Be careful with the <code class="calibre26">delete</code> command, because if you forget to include an addressing scheme, all the lines are deleted from the stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data1.txt</b></code>
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy dog
The quick brown fox jumps over the lazy dog
$
$ <code class="calibre26"><b class="calibre21">sed 'd' data1.txt</b></code>
$</code></pre>
<p class="calibre10">The <code class="calibre26">delete</code> command is obviously most useful when used in conjunction with a specified address. This allows you to delete specific lines of text from the data stream, either by line number:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
$
$ <code class="calibre26"><b class="calibre21">sed '3d' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 4.
$</code></pre>
<p class="calibre10">or by a specific range of lines:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2,3d' data6.txt</b></code>
This is line number 1.
This is line number 4.
$</code></pre>
<p class="calibre10">or by using the special end-of-file character:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '3,$d' data6.txt</b></code>
This is line number 1.
This is line number 2.
$</code></pre>
<p class="calibre10">The pattern-matching feature of the <code class="calibre26">sed</code> editor also applies to the <code class="calibre26">delete</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/number 1/d' data6.txt</b></code>
This is line number 2.
This is line number 3.
This is line number 4.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor removes the line containing text that matches the pattern you specify.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Remember that the <code class="calibre26">sed</code> editor doesn't touch the original file. Any lines you delete are only gone from the output of the <code class="calibre26">sed</code> editor. The original file still contains the âdeletedâ lines.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="522" id="calibre_link-854" class="calibre11"></span>You can also delete a range of lines using two text patterns, but be careful if you do this. The first pattern you specify âturns onâ the line deletion, and the second pattern âturns offâ the line deletion. The <code class="calibre26">sed</code> editor deletes any lines between the two specified lines (including the specified lines):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/1/,/3/d' data6.txt</b></code>
This is line number 4.
$</code></pre>
<p class="calibre10">In addition, you must be careful because the delete feature âturns onâ whenever the <code class="calibre26">sed</code> editor detects the start pattern in the data stream. This may produce an unexpected result:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data7.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
This is line number 1 again.
This is text you want to keep.
This is the last line in the file.
$
$ <code class="calibre26"><b class="calibre21">sed '/1/,/3/d' data7.txt</b></code>
This is line number 4.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="523" id="calibre_link-855" class="calibre11"></span>The second occurrence of a line with the number 1 in it triggered the <code class="calibre26">delete</code> command again, deleting the rest of the lines in the data stream, because the stop pattern wasn't recognized. Of course, the other obvious problem occurs if you specify a stop pattern that never appears in the text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/1/,/5/d' data7.txt</b></code>
$</code></pre>
<p class="calibre10">Because the delete features âturned onâ at the first pattern match, but never found the end pattern match, the entire data stream was deleted.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Inserting and appending text</h3>
<p class="calibre10">As you would expect, like any other editor, the <code class="calibre26">sed</code> editor allows you to insert and append text lines to the data stream. The difference between the two actions can be confusing:</p>
<ul class="calibre14">
<li class="calibre7">The <code class="calibre26">insert</code> command (<code class="calibre26">i</code>) adds a new line before the specified line.</li>
<li class="calibre7">The <code class="calibre26">append</code> command (<code class="calibre26">a</code>) adds a new line after the specified line.</li>
</ul>
<p class="calibre10">What is confusing about these two commands is their formats. You can't use these commands on a single command line. You must specify the line to insert or append the line to insert on a separate line by itself. Here's the format for doing this:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">sed</b></code> '[<code class="calibre26"><i class="calibre12">address</i></code>]command\
<code class="calibre26"><i class="calibre12">new line</i></code>'</code></pre>
<p class="calibre10">The text in <code class="calibre26"><i class="calibre12">new line</i></code> appears in the <code class="calibre26">sed</code> editor output in the place you specify. Remember that when you use the <code class="calibre26">insert</code> command, the text appears before the data stream text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "Test Line 2" | sed 'i\Test Line 1'</b></code>
Test Line 1
Test Line 2
$</code></pre>
<p class="calibre10">And when you use the <code class="calibre26">append</code> command, the text appears after the data stream text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "Test Line 2" | sed 'a\Test Line 1'</b></code>
Test Line 2
Test Line 1
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="524" id="calibre_link-856" class="calibre11"></span>When you use the <code class="calibre26">sed</code> editor from the command line interface prompt, you get the secondary prompt to enter the new line of data. You must complete the <code class="calibre26">sed</code> editor command on this line. After you enter the ending single quotation mark, the bash shell processes the command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "Test Line 2" | sed 'i\</b></code>
&gt; <code class="calibre26"><b class="calibre21">Test Line 1'</b></code>
Test Line 1
Test Line 2
$</code></pre>
<p class="calibre10">This works well for adding text before or after the text in the data stream, but what about adding text inside the data stream?</p>
<p class="calibre10">To insert or append data inside the data stream lines, you must use addressing to tell the <code class="calibre26">sed</code> editor where you want the data to appear. You can specify only a single line address when using these commands. You can match either a numeric line number or a text pattern, but you cannot use a range of addresses. This is logical, because you can only insert or append before or after a single line, and not a range of lines.</p>
<p class="calibre10">Here's an example of inserting a new line before line 3 in the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '3i\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is an inserted line.' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is an inserted line.
This is line number 3.
This is line number 4.
$</code></pre>
<p class="calibre10">Here's an example of appending a new line after line 3 in the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '3a\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is an appended line.' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is an appended line.
This is line number 4.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="525" id="calibre_link-857" class="calibre11"></span>This uses the same process as the <code class="calibre26">insert</code> command; it just places the new text line after the specified line number. If you have a multiline data stream, and you want to append a new line of text to the end of a data stream, just use the dollar sign, which represents the last line of data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '$a\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is a new line of text.' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
This is a new line of text.
$</code></pre>
<p class="calibre10">The same idea applies if you want to add a new line at the beginning of the data stream. Just insert a new line before line number one.</p>
<p class="calibre10">To insert or append more than one line of text, you must use a backslash on each line of new text until you reach the last text line where you want to insert or append text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '1i\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is one line of new text.\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is another line of new text.' data6.txt</b></code>
This is one line of new text.
This is another line of new text.
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
$</code></pre>
<p class="calibre10">Both of the specified lines are added to the data stream.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Changing lines</h3>
<p class="calibre10">The <code class="calibre26">change</code> command allows you to change the contents of an entire line of text in the data stream. It works the same way as the <code class="calibre26">insert</code> and <code class="calibre26">append</code> commands, in that you must specify the new line separately from the rest of the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '3c\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is a changed line of text.' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is a changed line of text.
This is line number 4.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="526" id="calibre_link-858" class="calibre11"></span>In this example, the <code class="calibre26">sed</code> editor changes the text in line number 3. You can also use a text pattern for the address:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/number 3/c\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is a changed line of text.' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is a changed line of text.
This is line number 4.
$</code></pre>
<p class="calibre10">The text pattern <code class="calibre26">change</code> command changes any line of text in the data stream that it matches.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data8.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
This is line number 1 again.
This is yet another line.
This is the last line in the file.
$
$ <code class="calibre26"><b class="calibre21">sed '/number 1/c\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is a changed line of text.' data8.txt</b></code>
This is a changed line of text.
This is line number 2.
This is line number 3.
This is line number 4.
This is a changed line of text.
This is yet another line.
This is the last line in the file.
$</code></pre>
<p class="calibre10">You can use an address range in the <code class="calibre26">change</code> command, but the results may not be what you expect:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '2,3c\</b></code>
&gt; <code class="calibre26"><b class="calibre21">This is a new line of text.' data6.txt</b></code>
This is line number 1.
This is a new line of text.
This is line number 4.
$</code></pre>
<p class="calibre10">Instead of changing both lines with the text, the <code class="calibre26">sed</code> editor uses the single line of text to replace both lines.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Transforming characters</h3>
<p class="calibre10">The <code class="calibre26">transform</code> command (<code class="calibre26">y</code>) is the only <code class="calibre26">sed</code> editor <span type="pagebreak" title="527" id="calibre_link-859" class="calibre11"></span>command that operates on a single character. The <code class="calibre26">transform</code> command uses the format:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]<code class="calibre26"><i class="calibre12">y</i></code>/<code class="calibre26"><i class="calibre12">inchars</i></code>/<code class="calibre26"><i class="calibre12">outchars</i></code>/</code></pre>
<p class="calibre10">The <code class="calibre26">transform</code> command performs a one-to-one mapping of the <code class="calibre26">inchars</code> and the <code class="calibre26">outchars</code> values. The first character in <code class="calibre26">inchars</code> is converted to the first character in <code class="calibre26">outchars</code>. The second character in <code class="calibre26">inchars</code> is converted to the second character in <code class="calibre26">outchars</code>. This mapping continues throughout the length of the specified characters. If the <code class="calibre26">inchars</code> and <code class="calibre26">outchars</code> are not the same length, the <code class="calibre26">sed</code> editor produces an error message.</p>
<p class="calibre10">Here's a simple example of using the <code class="calibre26">transform</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'y/123/789/' data8.txt</b></code>
This is line number 7.
This is line number 8.
This is line number 9.
This is line number 4.
This is line number 7 again.
This is yet another line.
This is the last line in the file.
$</code></pre>
<p class="calibre10">As you can see from the output, each instance of the characters specified in the <code class="calibre26">inchars</code> pattern has been replaced by the character in the same position in the <code class="calibre26">outchars</code> pattern.</p>
<p class="calibre10">The <code class="calibre26">transform</code> command is a global command; that is, it performs the transformation on any character found in the text line automatically, without regard to the occurrence:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This 1 is a test of 1 try." | sed 'y/123/456/'</b></code>
This 4 is a test of 4 try.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor transformed both instances of the matching character 1 in the text line. You can't limit the transformation to a specific occurrence of the character.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Printing revisited</h3>
<p class="calibre10">The âIntroducing more substitution optionsâ section showed you how to use the <code class="calibre26">p</code> flag with the substitution command to display lines that the <code class="calibre26">sed</code> editor changed. In addition, three commands that can be used to print information from the data stream:</p>
<ul class="calibre14">
<li class="calibre7">The <code class="calibre26">p</code> command to print a text line</li>
<li class="calibre7">The equal sign (<code class="calibre26">=</code>) command to print line numbers</li>
<li class="calibre7">The <code class="calibre26">l</code> (lowercase L) command to list a line</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="528" id="calibre_link-860" class="calibre11"></span>The following sections look at these three printing commands in the <code class="calibre26">sed</code> editor.</p>
<section class="toclist">
<h4 class="calibre25">Printing lines</h4>
<p class="calibre10">Like the <code class="calibre26">p</code> flag in the <code class="calibre26">substitution</code> command, the <code class="calibre26">p</code> command prints a line in the <code class="calibre26">sed</code> editor output. On its own, this command doesn't offer much excitement:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "this is a test" | sed 'p'</b></code>
this is a test
this is a test
$</code></pre>
<p class="calibre10">All it does is print the data text that you already know is there. The most common use for the <code class="calibre26">print</code> command is printing lines that contain matching text from a text pattern:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
$
$ <code class="calibre26"><b class="calibre21">sed -n '/number 3/p' data6.txt</b></code>
This is line number 3.
$</code></pre>
<p class="calibre10">By using the <code class="calibre26">-n</code> option on the command line, you can suppress all the other lines and print only the line that contains the matching text pattern.</p>
<p class="calibre10">You can also use this as a quick way to print a subset of lines in a data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '2,3p' data6.txt</b></code>
This is line number 2.
This is line number 3.
$</code></pre>
<p class="calibre10">You can also use the <code class="calibre26">print</code> command when you need to see a line before it gets altered, such as with the <code class="calibre26">substitution</code> or <code class="calibre26">change</code> command. You can create a script that displays the line before it's changed:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '/3/{</b></code>
&gt; <code class="calibre26"><b class="calibre21">p</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/line/test/p</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' data6.txt</b></code>
This is line number 3.
This is test number 3.
$</code></pre>
<p class="calibre10">This <code class="calibre26">sed</code> editor command searches for lines that contain the number 3 and executes two commands. First, the script uses the <code class="calibre26">p</code> command to print the original version of the line; then it uses the <code class="calibre26">s</code> command to <span type="pagebreak" title="529" id="calibre_link-861" class="calibre11"></span>substitute text, along with the <code class="calibre26">p</code> flag to print the resulting text. The output shows both the original line text and the new line text.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Printing line numbers</h4>
<p class="calibre10">The <code class="calibre26">equal sign</code> command prints the current line number for the line within the data stream. Line numbers are determined by using the newline character in the data stream. Each time a newline character appears in the data stream, the <code class="calibre26">sed</code> editor assumes that it terminates a line of text:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data1.txt</b></code>
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
The quick brown fox jumps over the lazy dog.
$
$ <code class="calibre26"><b class="calibre21">sed '=' data1.txt</b></code>
1
The quick brown fox jumps over the lazy dog.
2
The quick brown fox jumps over the lazy dog.
3
The quick brown fox jumps over the lazy dog.
4
The quick brown fox jumps over the lazy dog.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor prints the line number before the actual line of text. The <code class="calibre26">equal sign</code> command comes in handy if you're searching for a specific text pattern in the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '/number 4/{</b></code>
&gt; <code class="calibre26"><b class="calibre21">=</b></code>
&gt; <code class="calibre26"><b class="calibre21">p</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' data6.txt</b></code>
4
This is line number 4.
$</code></pre>
<p class="calibre10">By using the <code class="calibre26">-n</code> option, you can have the <code class="calibre26">sed</code> editor display both the line number and text for the line that contains the matching text pattern.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Listing lines</h4>
<p class="calibre10">The <code class="calibre26">list</code> command (<code class="calibre26">l</code>) allows you to print both the text and nonprintable characters in a data stream. Any nonprintable characters are shown using either their octal values, preceded by a backslash or the standard C-style nomenclature for common nonprintable characters, such as <code class="calibre26">ât</code> for tab characters:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data9.txt</b></code>
This    line    contains        tabs.
$
$ <code class="calibre26"><b class="calibre21">sed -n 'l' data9.txt</b></code>
This\tline\tcontains\ttabs.$
$</code></pre>
<p class="calibre10">The tab <span type="pagebreak" title="530" id="calibre_link-862" class="calibre11"></span>character locations are shown with the <code class="calibre26">ât</code> nomenclature. The dollar sign at the end of the line indicates the newline character. If you have a data stream that contains an escape character, the <code class="calibre26">list</code> command displays it using the octal code if necessary:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data10.txt</b></code>
This line contains an escape character.
$
$ <code class="calibre26"><b class="calibre21">sed -n 'l' data10.txt</b></code>
This line contains an escape character. \a$
$</code></pre>
<p class="calibre10">The <code class="calibre26">data10.txt</code> file contains an escape control code, which generates a bell sound. When you use the <code class="calibre26">cat</code> command to display the text file, you don't see the escape control code; you just hear the sound (if your speakers are turned on). However, using the <code class="calibre26">list</code> command, you can display the escape control code used.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using files with sed</h3>
<p class="calibre10">The <code class="calibre26">substitution</code> command contains flags that allow you to work with files. There are also regular <code class="calibre26">sed</code> editor commands that let you do that without having to substitute text.</p>
<section class="toclist">
<h4 class="calibre25">Writing to a file</h4>
<p class="calibre10">The <code class="calibre26">w</code> command is used to write lines to a file. Here's the format for the <code class="calibre26">w</code> command:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]w <code class="calibre26"><i class="calibre12">filename</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">filename</i></code> can be specified as either a relative or absolute pathname, but in either case, the person running the <code class="calibre26">sed</code> editor must have write permissions for the file. The address can be any type of addressing method used in <code class="calibre26">sed</code>, such as a single line number, a text pattern, or a range of line numbers or text patterns.</p>
<p class="calibre10">Here's an example that prints only the first two lines of a data stream to a text file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '1,2w test.txt' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
$
$ <code class="calibre26"><b class="calibre21">cat test.txt</b></code>
This is line number 1.
This is line number 2.
$</code></pre>
<p class="calibre10">Of <span type="pagebreak" title="531" id="calibre_link-863" class="calibre11"></span>course, if you don't want the lines to display on <code class="calibre26">STDOUT</code>, you can use the <code class="calibre26">-n</code> option for the <code class="calibre26">sed</code> command.</p>
<p class="calibre10">This is a great tool to use if you need to create a data file from a master file on the basis of common text values, such as those in a mailing list:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data11.txt</b></code>
Blum, R       Browncoat
McGuiness, A  Alliance
Bresnahan, C  Browncoat
Harken, C     Alliance
$
$ <code class="calibre26"><b class="calibre21">sed -n '/Browncoat/w Browncoats.txt' data11.txt</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat Browncoats.txt</b></code>
Blum, R       Browncoat
Bresnahan, C  Browncoat
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor writes to a destination file only the data lines that contain the text pattern.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading data from a file</h4>
<p class="calibre10">You've already seen how to insert data into and append text to a data stream from the <code class="calibre26">sed</code> command line. The <code class="calibre26">read</code> command (<code class="calibre26">r</code>) allows you to insert data contained in a separate file.</p>
<p class="calibre10">Here's the format of the <code class="calibre26">read</code> command:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]r <code class="calibre26"><i class="calibre12">filename</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">filename</i></code> parameter specifies either an absolute or relative pathname for the file that contains the data. You can't use a range of addresses for the <code class="calibre26">read</code> command. You can only specify a single line number or text pattern address. The <code class="calibre26">sed</code> editor inserts the text from the file after the address.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data12.txt</b></code>
This is an added line.
This is the second added line.
$
$ <code class="calibre26"><b class="calibre21">sed '3r data12.txt' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is an added line.
This is the second added line.
This is line number 4.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor inserts <span type="pagebreak" title="532" id="calibre_link-864" class="calibre11"></span>into the data stream all the text lines in the data file. The same technique works when using a text pattern address:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/number 2/r data12.txt' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is an added line.
This is the second added line.
This is line number 3.
This is line number 4.
$</code></pre>
<p class="calibre10">If you want to add text to the end of a data stream, just use the dollar sign address symbol:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '$r data12.txt' data6.txt</b></code>
This is line number 1.
This is line number 2.
This is line number 3.
This is line number 4.
This is an added line.
This is the second added line.
$</code></pre>
<p class="calibre10">A cool application of the <code class="calibre26">read</code> command is to use it in conjunction with a <code class="calibre26">delete</code> command to replace a placeholder in a file with data from another file. For example, suppose that you had a form stored in a text file that looked like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat notice.std</b></code>
Would the following people:
LIST
please report to the ship's captain.
$</code></pre>
<p class="calibre10">The form letter uses the generic placeholder <code class="calibre26">LIST</code> in place of a list of people. To insert the list of people after the placeholder, you just use the <code class="calibre26">read</code> command. However, this still leaves the placeholder text in the output. To remove that, just use the <code class="calibre26">delete</code> command. The result looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/LIST/{</b></code>
&gt; <code class="calibre26"><b class="calibre21">r data11.txt</b></code>
&gt; <code class="calibre26"><b class="calibre21">d</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' notice.std</b></code>
Would the following people:
Blum, R       Browncoat
McGuiness, A  Alliance
Bresnahan, C  Browncoat
Harken, C     Alliance
please report to the ship's captain.
$</code></pre>
<p class="calibre10">Now the placeholder text is replaced with the list of names from the data file.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-266" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="533" id="calibre_link-865" class="calibre11"></span>Shell scripts can do lots of work on their own, but it's often difficult to manipulate data with just a shell script. Linux provides two handy utilities to help with handling text data. The <code class="calibre26">sed</code> editor is a stream editor that quickly processes data on the fly as it reads it. You must provide the <code class="calibre26">sed</code> editor with a list of editing commands, which it applies to the data.</p>
<p class="calibre10">The <code class="calibre26">gawk</code> program is a utility from the GNU organization that mimics and expands on the functionality of the Unix <code class="calibre26">awk</code> program. The g<code class="calibre26">awk</code> program contains a built-in programming language that you can use to write scripts to handle and process data. You can use the <code class="calibre26">gawk</code> program to extract data elements from large data files and output them in just about any format you desire. This makes processing large log files a snap, as well as creating custom reports from data files.</p>
<p class="calibre10">A crucial element of using both the <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> programs is knowing how to use regular expressions. Regular expressions are key to creating customized filters for extracting and manipulating data in text files. The next chapter dives into the often misunderstood world of regular expressions, showing you how to build regular expressions for manipulating all types of data.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-91">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-267" class="calibre4"></a><span class="chaptertitle">Chapter 20</span><br class="calibre22" /><span class="chaptertitle">Regular Expressions</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Defining regular expressions</li>
<li class="calibre7">Looking at the basics</li>
<li class="calibre7">Extending our patterns</li>
<li class="calibre7">Creating expressions</li>
</ol>
<p class="calibre19"><span type="pagebreak" title="535" id="calibre_link-866" class="calibre11"></span>The key to successfully working with the <code class="calibre26">sed</code> editor and the <code class="calibre26">gawk</code> program in your shell script is your comfort using regular expressions. This is not always an easy thing to do, because trying to filter specific data from a large batch of data can (and often does) get complicated. This chapter describes how to create regular expressions in both the <code class="calibre26">sed</code> editor and the <code class="calibre26">gawk</code> program that can filter out just the data you need.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-268" class="calibre4"></a>What Are Regular Expressions?</h2>
<p class="calibre10">The first step to understanding regular expressions is to define just exactly what they are. This section explains what a regular expression is and describes how Linux uses regular expressions.</p>
<section class="toclist">
<h3 class="calibre15">A definition</h3>
<p class="calibre10">A <span class="chaptertitle"><i class="calibre12">regular expression</i></span> is a pattern template you define that a Linux utility uses to filter text. A Linux utility (such as the <code class="calibre26">sed</code> editor or the <code class="calibre26">gawk</code> program) matches the regular expression pattern against data as that data flows into the utility. If the data matches the pattern, it's accepted for processing. If the data doesn't match the pattern, it's rejected. This is illustrated in <a id="calibre_link-1228" href="#calibre_link-1108" class="calibre4">Figure 20.1</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000020.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1108" href="#calibre_link-1228" class="calibre4"><b class="calibre21">Figure 20.1</b></a></span> Matching data against a regular expression pattern</p>
</figcaption>
</figure>
<p class="calibre10">The regular expression pattern makes use of wildcard characters to represent one or more characters in the data stream. There are plenty of instances in Linux where you can specify a wildcard character to represent data you don't know about. You've already seen an example of using wildcard characters with the Linux <code class="calibre26">ls</code> command for listing files and directories (see Chapter 3).</p>
<p class="calibre10">The asterisk wildcard character allows you to list only files that match a certain criteria. For example:</p>
<pre class="calibre29"><code class="calibre26">$ ls -al da*
-rw-r--r--    1 rich     rich           45 Nov 26 12:42 data
-rw-r--r--    1 rich     rich           25 Dec  4 12:40 data.tst
-rw-r--r--    1 rich     rich          180 Nov 26 12:42 data1
-rw-r--r--    1 rich     rich           45 Nov 26 12:44 data2
-rw-r--r--    1 rich     rich           73 Nov 27 12:31 data3
-rw-r--r--    1 rich     rich           79 Nov 28 14:01 data4
-rw-r--r--    1 rich     rich          187 Dec  4 09:45 datatest
$</code></pre>
<p class="calibre10">The <code class="calibre26">da*</code> parameter instructs the <code class="calibre26">ls</code> command to list only the files whose name starts with <i class="calibre12">da</i>. There can be <span type="pagebreak" title="536" id="calibre_link-867" class="calibre11"></span>any number of characters after the <code class="calibre26">da</code> in the filename (including none). The <code class="calibre26">ls</code> command reads the information regarding all the files in the directory but displays only the ones that match the wildcard character.</p>
<p class="calibre10">Regular expression wildcard patterns work in a similar way. The regular expression pattern contains text and/or special characters that define a template for the <code class="calibre26">sed</code> editor and the <code class="calibre26">gawk</code> program to follow when matching data. You can use different special characters in a regular expression to define a specific pattern for filtering data.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Types of regular expressions</h3>
<p class="calibre10">The biggest problem with using regular expressions is that there isn't just one set of them. Several different applications use different types of regular expressions in the Linux environment. These include such diverse applications as programming languages (Java, Perl, and Python), Linux utilities (such as the <code class="calibre26">sed</code> editor, the <code class="calibre26">gawk</code> program, and the grep utility), and mainstream applications (such as the MySQL and PostgreSQL database servers).</p>
<p class="calibre10"><span type="pagebreak" title="537" id="calibre_link-868" class="calibre11"></span>A regular expression is implemented using a <span class="chaptertitle"><i class="calibre12">regular expression engine.</i></span> A regular expression engine is the underlying software that interprets regular expression patterns and uses those patterns to match text.</p>
<p class="calibre10">The Linux world has two popular regular expression engines:</p>
<ul class="calibre14">
<li class="calibre7">The POSIX Basic Regular Expression (BRE) engine</li>
<li class="calibre7">The POSIX Extended Regular Expression (ERE) engine</li>
</ul>
<p class="calibre10">Most Linux utilities at a minimum conform to the POSIX BRE engine specifications, recognizing all the pattern symbols it defines. Unfortunately, some utilities (such as the <code class="calibre26">sed</code> editor) conform only to a subset of the BRE engine specifications. This is due to speed constraints, because the <code class="calibre26">sed</code> editor attempts to process text in the data stream as quickly as possible.</p>
<p class="calibre10">The POSIX ERE engine is often found in programming languages that rely on regular expressions for text filtering. It provides advanced pattern symbols as well as special symbols for common patterns, such as matching digits, words, and alphanumeric characters. The <code class="calibre26">gawk</code> program uses the ERE engine to process its regular expression patterns.</p>
<p class="calibre10">Because there are so many different ways to implement regular expressions, it's hard to present a single, concise description of all the possible regular expressions. The following sections discuss the most commonly found regular expressions and demonstrate how to use them in the <code class="calibre26">sed</code> editor and <code class="calibre26">gawk</code> program.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-269" class="calibre4"></a>Defining BRE Patterns</h2>
<p class="calibre10">The most basic BRE pattern is matching text characters in a data stream. This section demonstrates how you can define text in the regular expression pattern and what to expect from the results.</p>
<section class="toclist">
<h3 class="calibre15">Plain text</h3>
<p class="calibre10">Chapter 18 demonstrated how to use standard text strings in the <code class="calibre26">sed</code> editor and the <code class="calibre26">gawk</code> program to filter data. Here's an example to refresh your memory:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is a test" | sed -n '/test/p'
This is a test
$ echo "This is a test" | sed -n '/trial/p'
$
$ echo "This is a test" | gawk '/test/{print $0}'
This is a test
$ echo "This is a test" | gawk '/trial/{print $0}'
$</code></pre>
<p class="calibre10">The first pattern defines a single word, <i class="calibre12">test</i>. The <code class="calibre26">sed</code> editor and <code class="calibre26">gawk</code> program scripts each use their own version of the <code class="calibre26">print</code> command to print any lines that match the regular expression pattern. Because the <code class="calibre26">echo</code> statement contains the word âtestâ in the <span type="pagebreak" title="538" id="calibre_link-869" class="calibre11"></span>text string, the data stream text matches the defined regular expression pattern, and the <code class="calibre26">sed</code> editor displays the line.</p>
<p class="calibre10">The second pattern again defines just a single word, this time the word âtrial.â Because the <code class="calibre26">echo</code> statement text string doesn't contain that word, the regular expression pattern doesn't match, so neither the <code class="calibre26">sed</code> editor nor the <code class="calibre26">gawk</code> program prints the line.</p>
<p class="calibre10">You probably already noticed that the regular expression doesn't care where in the data stream the pattern occurs. It also doesn't matter how many times the pattern occurs. After the regular expression can match the pattern anywhere in the text string, it passes the string along to the Linux utility that's using it.</p>
<p class="calibre10">The key is matching the regular expression pattern to the data stream text. It's important to remember that regular expressions are extremely picky about matching patterns. The first rule to remember is that regular expression patterns are case sensitive. This means they'll match only those patterns with the proper case of characters:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is a test" | sed -n '/this/p'
$
$ echo "This is a test" | sed -n '/This/p'
This is a test
$</code></pre>
<p class="calibre10">The first attempt failed to match because the word âthisâ doesn't appear in all lowercase in the text string, while the second attempt, which uses the uppercase letter in the pattern, worked just fine.</p>
<p class="calibre10">You don't have to limit yourself to whole words in the regular expression. If the defined text appears anywhere in the data stream, the regular expression matches the following:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The books are expensive" | sed -n '/book/p'
The books are expensive
$</code></pre>
<p class="calibre10">Even though the text in the data stream is <code class="calibre26">books</code>, the data in the stream contains the regular expression book, so the regular expression pattern matches the data. Of course, if you try the opposite, the regular expression fails:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The book is expensive" | sed -n '/books/p'
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="539" id="calibre_link-870" class="calibre11"></span>The complete regular expression text didn't appear in the data stream, so the match failed and the <code class="calibre26">sed</code> editor didn't display the text.</p>
<p class="calibre10">You also don't have to limit yourself to single text words in the regular expression. You can include spaces and numbers in your text string as well:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is line number 1" | sed -n '/ber 1/p'
This is line number 1
$</code></pre>
<p class="calibre10">Spaces are treated just like any other character in the regular expression:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is line number1" | sed -n '/ber 1/p'
$</code></pre>
<p class="calibre10">If you define a space in the regular expression, it must appear in the data stream. You can even create a regular expression pattern that matches multiple contiguous spaces:</p>
<pre class="calibre29"><code class="calibre26">$ cat data1
This is a normal line of text.
This is  a line with too many spaces.
$ sed -n '/  /p' data1
This is  a line with too many spaces.
$ </code></pre>
<p class="calibre10">The line with two spaces between words matches the regular expression pattern. This is a great way to catch spacing problems in text files!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Special characters</h3>
<p class="calibre10">As you use text strings in your regular expression patterns, there's something you need to be aware of. There are a few exceptions when defining text characters in a regular expression. Regular expression patterns assign a special meaning to a few characters. If you try to use these characters in your text pattern, you won't get the results you were expecting.</p>
<p class="calibre10">These special characters are recognized by regular expressions:</p>
<pre class="calibre29"><code class="calibre26">.*[]^${}\+?|()</code></pre>
<p class="calibre10">As the chapter progresses, you'll find out just what these special characters do in a regular expression. For now, however, just remember that you can't use these characters by themselves in your text pattern.</p>
<p class="calibre10">If you want to use one of the special characters as a text character, you need to <i class="calibre12">escape</i> it. When you escape the special characters, you add a special character in front of it to indicate to the regular expression engine that it should interpret the next character as a normal text character. The special character that does this is the backslash character (â).</p>
<p class="calibre10">For example, if you <span type="pagebreak" title="540" id="calibre_link-871" class="calibre11"></span>want to search for a dollar sign in your text, just precede it with a backslash character:</p>
<pre class="calibre29"><code class="calibre26">$ cat data2
The cost is $4.00
$ sed -n '/\$/p' data2
The cost is $4.00
$</code></pre>
<p class="calibre10">Because the backslash is a special character, if you need to use it in a regular expression pattern, you need to escape it as well, producing a double backslash:</p>
<pre class="calibre29"><code class="calibre26">$ echo "\ is a special character" | sed -n '/[[Backslash Backslash]]/p'
\ is a special character
$ </code></pre>
<p class="calibre10">Finally, although the forward slash isn't a regular expression special character, if you use it in your regular expression pattern in the <code class="calibre26">sed</code> editor or the <code class="calibre26">gawk</code> program, you get an error:</p>
<pre class="calibre29"><code class="calibre26">$ echo "3 / 2" | sed -n '///p'
sed: -e expression #1, char 2: No previous regular expression
$ </code></pre>
<p class="calibre10">To use a forward slash, you need to escape that as well:</p>
<pre class="calibre29"><code class="calibre26">$ echo "3 / 2" | sed -n '/\//p'
3 / 2
$</code></pre>
<p class="calibre10">Now the <code class="calibre26">sed</code> editor can properly interpret the regular expression pattern, and all is well.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Anchor characters</h3>
<p class="calibre10">As shown in the âPlain Textâ section, by default, when you specify a regular expression pattern, if the pattern appears anywhere in the data stream, it matches. You can use two special characters to anchor a pattern to either the beginning or the end of lines in the data stream.</p>
<section class="toclist">
<h4 class="calibre25">Starting at the beginning</h4>
<p class="calibre10">The caret character (<code class="calibre26">â§</code>) defines a pattern that starts at the beginning of a line of text in the data stream. If the pattern is located any place other than the start of the line of text, the regular expression pattern fails.</p>
<p class="calibre10">To use the caret character, you must place it before the pattern specified in the regular expression:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The book store" | sed -n '/^book/p'
$
$ echo "Books are great" | sed -n '/^Book/p'
Books are great
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="541" id="calibre_link-872" class="calibre11"></span>The caret anchor character checks for the pattern at the beginning of each new line of data, as determined by the newline character:</p>
<pre class="calibre29"><code class="calibre26">$ cat data3
This is a test line.
this is another test line.
A line that tests this feature.
Yet more testing of this
$ sed -n '/^this/p' data3
this is another test line.
$</code></pre>
<p class="calibre10">As long as the pattern appears at the start of a new line, the caret anchor catches it.</p>
<p class="calibre10">If you position the caret character in any place other than at the beginning of the pattern, it acts like a normal character and not as a special character:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This ^ is a test" | sed -n '/s ^/p'
This ^ is a test
$ </code></pre>
<p class="calibre10">Because the caret character is listed last in the regular expression pattern, the <code class="calibre26">sed</code> editor uses it as a normal character to match text.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you need to specify a regular expression pattern using only the caret character, you don't need to escape it with a backslash. However, if you specify the caret character first, followed by additional text in the pattern, you need to use the escape character before the caret character.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h4 class="calibre25">Looking for the ending</h4>
<p class="calibre10">The opposite of looking for a pattern at the start of a line is looking for it at the end of a line. The dollar sign (<code class="calibre26">$</code>) special character defines the end anchor. Add this special character after a text pattern to indicate that the line of data must end with the text pattern:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is a good book" | sed -n '/book$/p'
This is a good book
$ echo "This book is good" | sed -n '/book$/p'
$</code></pre>
<p class="calibre10">The problem with an ending text pattern is that you must be careful what you're looking for:</p>
<pre class="calibre29"><code class="calibre26">$ echo "There are a lot of good books" | sed -n '/book$/p'
$</code></pre>
<p class="calibre10">Making the word âbookâ plural at the end <span type="pagebreak" title="542" id="calibre_link-873" class="calibre11"></span>of the line means that it no longer matches the regular expression pattern, even though book is in the data stream. The text pattern must be the last thing on the line for the pattern to match.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Combining anchors</h4>
<p class="calibre10">In some common situations, you can combine both the start and end anchor on the same line. In the first situation, suppose you want to look for a line of data containing only a specific text pattern:</p>
<pre class="calibre29"><code class="calibre26">$ cat data4
this is a test of using both anchors
I said this is a test
this is a test
I'm sure this is a test.
$ sed -n '/^this is a test$/p' data4
this is a test
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor ignores the lines that include other text besides the specified text.</p>
<p class="calibre10">The second situation may seem a little odd at first but is extremely useful. By combining both anchors in a pattern with no text, you can filter blank lines from the data stream. Consider this example:</p>
<pre class="calibre29"><code class="calibre26">$ cat data5
This is one test line.
This is another test line.
$ sed '/^$/d' data5
This is one test line.
This is another test line.
$</code></pre>
<p class="calibre10">The regular expression pattern that is defined looks for lines that have nothing between the start and end of the line. Because blank lines contain no text between the two newline characters, they match the regular expression pattern. The <code class="calibre26">sed</code> editor uses the <code class="calibre26">d</code> delete command to delete lines that match the regular expression pattern, thus removing all blank lines from the text. This is an effective way to remove blank lines from documents.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The dot character</h3>
<p class="calibre10">The dot special character is used to match any single character except a newline character. The dot character must match a character, however; if there's no character in the place of the dot, then the pattern fails.</p>
<p class="calibre10">Let's look at a few examples of using the dot character in a regular expression pattern:</p>
<pre class="calibre29"><code class="calibre26">$ cat data6
This is a test of a line.
The cat is sleeping.
That is a very nice hat.
This test is at line four.
at ten o'clock we'll go home.
$ sed -n '/.at/p' data6
The cat is sleeping.
That is a very nice hat.
This test is at line four.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="543" id="calibre_link-874" class="calibre11"></span>You should be able to figure out why the first line failed and why the second and third lines passed. The fourth line is a little tricky. Notice that we matched the <code class="calibre26">at</code>, but there's no character in front of it to match the dot character. Ah, but there is! In regular expressions, spaces count as characters, so the space in front of the <code class="calibre26">at</code> matches the pattern. The fifth line proves this, by putting the <code class="calibre26">at</code> in the front of the line, which fails to match the pattern.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Character classes</h3>
<p class="calibre10">The dot special character is great for matching a character position against any character, but what if you want to limit what characters to match? This is called a <i class="calibre12">character class</i> in regular expressions.</p>
<p class="calibre10">You can define a class of characters that would match a position in a text pattern. If one of the characters from the character class is in the data stream, it matches the pattern.</p>
<p class="calibre10">To define a character class, you use square brackets. The brackets should contain any character you want to include in the class. You then use the entire class within a pattern just like any other wildcard character. This takes a little getting used to at first, but after you catch on, it can generate some pretty amazing results.</p>
<p class="calibre10">The following is an example of creating a character class:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/[ch]at/p' data6
The cat is sleeping.
That is a very nice hat.
$</code></pre>
<p class="calibre10">Using the same data file as in the dot special character example, we came up with a different result. This time we managed to filter out the line that just contained the word <code class="calibre26">at</code>. The only words that match this pattern are <code class="calibre26">cat</code> and <code class="calibre26">hat</code>. Also notice that the line that started with <code class="calibre26">at</code> didn't match as well. There must be a character in the character class that matches the appropriate position.</p>
<p class="calibre10"><span type="pagebreak" title="544" id="calibre_link-875" class="calibre11"></span>Character classes come in handy if you're not sure which case a character is in:</p>
<pre class="calibre29"><code class="calibre26">$ echo "Yes" | sed -n '/[Yy]es/p'
Yes
$ echo "yes" | sed -n '/[Yy]es/p'
yes
$</code></pre>
<p class="calibre10">You can use more than one character class in a single expression:</p>
<pre class="calibre29"><code class="calibre26">$ echo "Yes" | sed -n '/[Yy][Ee][Ss]/p'
Yes
$ echo "yEs" | sed -n '/[Yy][Ee][Ss]/p'
yEs
$ echo "yeS" | sed -n '/[Yy][Ee][Ss]/p'
yeS
$</code></pre>
<p class="calibre10">The regular expression used three character classes to cover both lower and upper cases for all three character positions.</p>
<p class="calibre10">Character classes don't have to contain just letters; you can use numbers in them as well:</p>
<pre class="calibre29"><code class="calibre26">$ cat data7
This line doesn't contain a number.
This line has 1 number on it.
This line a number 2 on it.
This line has a number 4 on it.
$ sed -n '/[0123]/p' data7
This line has 1 number on it.
This line a number 2 on it.
$</code></pre>
<p class="calibre10">The regular expression pattern matches any lines that contain the numbers 0, 1, 2, or 3. Any other numbers are ignored, as are lines without numbers in them.</p>
<p class="calibre10">You can combine character classes to check for properly formatted numbers, such as phone numbers and ZIP codes. However, when you're trying to match a specific format, you must be careful. Here's an example of a ZIP code match gone wrong:</p>
<pre class="calibre29"><code class="calibre26">$ cat data8
60633
46201
223001
4353
22203
$ sed -n '
&gt;/[0123456789][0123456789][0123456789][0123456789][0123456789]/p
&gt;' data8
60633
46201
223001
22203
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="545" id="calibre_link-876" class="calibre11"></span>This might not have produced the result you were thinking of. It did a fine job of filtering out the number that was too short to be a ZIP code, because the last character class didn't have a character to match against. However, it still passed the six-digit number, even though we only defined five character classes.</p>
<p class="calibre10">Remember that the regular expression pattern can be found anywhere in the text of the data stream. You may always have additional characters besides the matching pattern characters. If you want to ensure that you match against only five numbers, you need to delineate them somehow, either with spaces, or as in this example, by showing that they're at the start and end of the line:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '
&gt; /^[0123456789][0123456789][0123456789][0123456789][0123456789]$/p
&gt; ' data8
60633
46201
22203
$</code></pre>
<p class="calibre10">Now that's much better! Later in this chapter, we look at how to simplify this even further.</p>
<p class="calibre10">One extremely popular use for character classes is parsing words that might be misspelled, such as data entered from a user form. You can easily create regular expressions that can accept common misspellings in data:</p>
<pre class="calibre29"><code class="calibre26">$ cat data9
I need to have some maintenence done on my car.
I'll pay that in a seperate invoice.
After I pay for the maintenance my car will be as good as new.
$ sed -n '
/maint[ea]n[ae]nce/p
/sep[ea]r[ea]te/p
' data9
I need to have some maintenence done on my car.
I'll pay that in a seperate invoice.
After I pay for the maintenance my car will be as good as new.
$</code></pre>
<p class="calibre10">The two <code class="calibre26">sed</code> print commands in this example utilize regular expression character classes to help catch the misspelled words, <i class="calibre12">maintenance</i> and <i class="calibre12">separate</i>, in the text. The same regular expression pattern also matches the properly spelled occurrence of âmaintenance.â</p>
</section>
<section class="toclist">
<h3 class="calibre15">Negating character classes</h3>
<p class="calibre10"><span type="pagebreak" title="546" id="calibre_link-877" class="calibre11"></span>In regular expression patterns, you can also reverse the effect of a character class. Instead of looking for a character contained in the class, you can look for any character that's not in the class. To do that, just place a caret character at the beginning of the character class range:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/[^ch]at/p' data6
This test is at line four.
$</code></pre>
<p class="calibre10">By negating the character class, the regular expression pattern matches any character that's neither a <i class="calibre12">c</i> nor an <i class="calibre12">h</i>, along with the text pattern. Because the space character fits this category, it passed the pattern match. However, even with the negation, the character class must still match a character, so the line with the <code class="calibre26">at</code> in the start of the line still doesn't match the pattern.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using ranges</h3>
<p class="calibre10">You may have noticed when I showed the ZIP code example earlier that it was somewhat awkward having to list all the possible digits in each character class. Fortunately, you can use a shortcut so you don't have to do that.</p>
<p class="calibre10">You can use a range of characters within a character class by using the dash symbol. Just specify the first character in the range, a dash, and then the last character in the range. The regular expression includes any character that's within the specified character range, according to the character set used by the Linux system (see Chapter 2).</p>
<p class="calibre10">Now you can simplify the ZIP code example by specifying a range of digits:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/^[0-9][0-9][0-9][0-9][0-9]$/p' data8
60633
46201
45902
$</code></pre>
<p class="calibre10">That saved lots of typing! Each character class matches any digit from 0 to 9. The pattern fails if a letter is present anywhere in the data:</p>
<pre class="calibre29"><code class="calibre26">$ echo "a8392" | sed -n '/^[0-9][0-9][0-9][0-9][0-9]$/p'
$
$ echo "1839a" | sed -n '/^[0-9][0-9][0-9][0-9][0-9]$/p'
$
$ echo "18a92" | sed -n '/^[0-9][0-9][0-9][0-9][0-9]$/p'
$</code></pre>
<p class="calibre10">The same technique works with letters:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/[c-h]at/p' data6
The cat is sleeping.
That is a very nice hat.
$</code></pre>
<p class="calibre10">The new <span type="pagebreak" title="547" id="calibre_link-878" class="calibre11"></span>pattern <code class="calibre26">[c-h]at</code> matches words where the first letter is between the letter <i class="calibre12">c</i> and the letter <i class="calibre12">h</i>. In this case, the line with only the word <code class="calibre26">at</code> failed to match the pattern.</p>
<p class="calibre10">You can also specify multiple, non-continuous ranges in a single character class:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/[a-ch-m]at/p' data6
The cat is sleeping.
That is a very nice hat.
$</code></pre>
<p class="calibre10">The character class allows the ranges <i class="calibre12">a</i> through <i class="calibre12">c</i>, and <i class="calibre12">h</i> through <i class="calibre12">m</i> to appear before the <code class="calibre26">at</code> text. This range would reject any letters between <i class="calibre12">d</i> and <i class="calibre12">g</i>:</p>
<pre class="calibre29"><code class="calibre26">$ echo "I'm getting too fat." | sed -n '/[a-ch-m]at/p'
$</code></pre>
<p class="calibre10">This pattern rejected the <code class="calibre26">fat</code> text, as it wasn't in the specified range.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Special character classes</h3>
<p class="calibre10">In addition to defining your own character classes, the BRE contains special character classes you can use to match against specific types of characters. <a id="calibre_link-1229" href="#calibre_link-1155" class="calibre4">Table 20.1</a> describes the BRE special characters you can use.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1155" href="#calibre_link-1229" class="calibre4"><b class="calibre21">Table 20.1</b></a></span> BRE Special Character Classes</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Class</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:alpha:]]</code></td>
<td class="left">Matches any alphabetical character, either upper or lower case</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:alnum:]]</code></td>
<td class="left">Matches any alphanumeric character 0&ndash;9, A&ndash;Z, or a&ndash;z</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:blank:]]</code></td>
<td class="left">Matches a space or Tab character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:digit:]]</code></td>
<td class="left">Matches a numerical digit from 0 through 9</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:lower:]]</code></td>
<td class="left">Matches any lowercase alphabetical character a&ndash;z</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:print:]]</code></td>
<td class="left">Matches any printable character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:punct:]]</code></td>
<td class="left">Matches a punctuation character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:space:]]</code></td>
<td class="left">Matches any whitespace character: space, Tab, NL, FF, VT, CR</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">[[:upper:]]</code></td>
<td class="left">Matches any uppercase alphabetical character A&ndash;Z</td>
</tr>
</table>
</figure>
<p class="calibre10">You use the special character classes just as you would a normal character class in your regular expression patterns:</p>
<pre class="calibre29"><code class="calibre26">$ echo "abc" | sed -n '/[[:digit:]]/p'
$
$ echo "abc" | sed -n '/[[:alpha:]]/p'
abc
$ echo "abc123" | sed -n '/[[:digit:]]/p'
abc123
$ echo "This is, a test" | sed -n '/[[:punct:]]/p'
This is, a test
$ echo "This is a test" | sed -n '/[[:punct:]]/p'
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="548" id="calibre_link-879" class="calibre11"></span>Using the special character classes is an easy way to define ranges. Instead of having to use a range [0&ndash;9], you can just use <code class="calibre26">[[:digit:]]</code>.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The asterisk</h3>
<p class="calibre10">Placing an asterisk after a character signifies that the character must appear zero or more times in the text to match the pattern:</p>
<pre class="calibre29"><code class="calibre26">$ echo "ik" | sed -n '/ie*k/p'
ik
$ echo "iek" | sed -n '/ie*k/p'
iek
$ echo "ieek" | sed -n '/ie*k/p'
ieek
$ echo "ieeek" | sed -n '/ie*k/p'
ieeek
$ echo "ieeeek" | sed -n '/ie*k/p'
ieeeek
$</code></pre>
<p class="calibre10">This pattern symbol is commonly used for handling words that have a common misspelling or variations in language spellings. For example, if you need to write a script that may be used in either American or British English, you could write:</p>
<pre class="calibre29"><code class="calibre26">$ echo "I'm getting a color TV" | sed -n '/colou*r/p'
I'm getting a color TV
$ echo "I'm getting a colour TV" | sed -n '/colou*r/p'
I'm getting a colour TV
$</code></pre>
<p class="calibre10">The <code class="calibre26">u*</code> in the pattern indicates that the letter <i class="calibre12">u</i> may or may not appear in the text to match the pattern. Similarly, if you know of a word that is commonly misspelled, you can accommodate it by using the asterisk:</p>
<pre class="calibre29"><code class="calibre26">$ echo "I ate a potatoe with my lunch." | sed -n '/potatoe*/p'
I ate a potatoe with my lunch.
$ echo "I ate a potato with my lunch." | sed -n '/potatoe*/p'
I ate a potato with my lunch.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="549" id="calibre_link-880" class="calibre11"></span>Placing an asterisk next to the possible extra letter allows you to accept the misspelled word.</p>
<p class="calibre10">Another handy feature is combining the dot special character with the asterisk special character. This combination provides a pattern to match any number of any characters. It's often used between two text strings that may or may not appear next to each other in the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ echo "this is a regular pattern expression" | sed -n '
&gt; /regular.*expression/p'
this is a regular pattern expression
$</code></pre>
<p class="calibre10">Using this pattern, you can easily search for multiple words that may appear anywhere in a line of text in the data stream.</p>
<p class="calibre10">The asterisk can also be applied to a character class. This allows you to specify a group or range of characters that can appear more than once in the text:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | sed -n '/b[ae]*t/p'
bt
$ echo "bat" | sed -n '/b[ae]*t/p'
bat
$ echo "bet" | sed -n '/b[ae]*t/p'
bet
$ echo "btt" | sed -n '/b[ae]*t/p'
btt
$
$ echo "baat" | sed -n '/b[ae]*t/p'
baat
$ echo "baaeeet" | sed -n '/b[ae]*t/p'
baaeeet
$ echo "baeeaeeat" | sed -n '/b[ae]*t/p'
baeeaeeat
$ echo "baakeeet" | sed -n '/b[ae]*t/p'
$</code></pre>
<p class="calibre10">As long as the <i class="calibre12">a</i> and <i class="calibre12">e</i> characters appear in any combination between the <i class="calibre12">b</i> and <i class="calibre12">t</i> characters (including not appearing at all), the pattern matches. If any other character outside of the defined character class appears, the pattern match fails.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-270" class="calibre4"></a>Extended Regular Expressions</h2>
<p class="calibre10">The POSIX ERE patterns include a few additional symbols that are used by some Linux applications and utilities. The <code class="calibre26">gawk</code> program recognizes the ERE patterns, but the <code class="calibre26">sed</code> editor doesn't.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Remember that the regular expression engines in the <code class="calibre26">sed</code> editor and the <code class="calibre26">gawk</code> program are different. The <code class="calibre26">gawk</code> program can use most of the extended regular expression pattern symbols, and it can provide some additional filtering capabilities that the <code class="calibre26">sed</code> editor doesn't have. However, because of this, it is often slower in processing data streams.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="550" id="calibre_link-881" class="calibre11"></span>This section describes the more commonly found ERE pattern symbols that you can use in your <code class="calibre26">gawk</code> program scripts.</p>
<section class="toclist">
<h3 class="calibre15">The question mark</h3>
<p class="calibre10">The question mark is similar to the asterisk, but with a slight twist. The question mark indicates that the preceding character can appear zero or one time, but that's all. It doesn't match repeating occurrences of the character:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk '/be?t/{print $0}'
bt
$ echo "bet" | gawk '/be?t/{print $0}'
bet
$ echo "beet" | gawk '/be?t/{print $0}'
$
$ echo "beeet" | gawk '/be?t/{print $0}'
$</code></pre>
<p class="calibre10">If the <i class="calibre12">e</i> character doesn't appear in the text, or as long as it appears only once in the text, the pattern matches.</p>
<p class="calibre10">As with the asterisk, you can use the question mark symbol along with a character class:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk '/b[ae]?t/{print $0}'
bt
$ echo "bat" | gawk '/b[ae]?t/{print $0}'
bat
$ echo "bot" | gawk '/b[ae]?t/{print $0}'
$
$ echo "bet" | gawk '/b[ae]?t/{print $0}'
bet
$ echo "baet" | gawk '/b[ae]?t/{print $0}'
$
$ echo "beat" | gawk '/b[ae]?t/{print $0}'
$
$ echo "beet" | gawk '/b[ae]?t/{print $0}'
$</code></pre>
<p class="calibre10">If zero or one character from the character class appears, the pattern match passes. However, if both characters appear, or if one of the characters appears twice, the pattern match fails.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The plus sign</h3>
<p class="calibre10"><span type="pagebreak" title="551" id="calibre_link-882" class="calibre11"></span>The plus sign is another pattern symbol that's similar to the asterisk, but with a different twist than the question mark. The plus sign indicates that the preceding character can appear one or more times, but must be present at least once. The pattern doesn't match if the character is not present:</p>
<pre class="calibre29"><code class="calibre26">$ echo "beeet" | gawk '/be+t/{print $0}'
beeet
$ echo "beet" | gawk '/be+t/{print $0}'
beet
$ echo "bet" | gawk '/be+t/{print $0}'
bet
$ echo "bt" | gawk '/be+t/{print $0}'
$</code></pre>
<p class="calibre10">If the <i class="calibre12">e</i> character is not present, the pattern match fails. The plus sign also works with character classes, the same way as the asterisk and question mark do:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk '/b[ae]+t/{print $0}'
$
$ echo "bat" | gawk '/b[ae]+t/{print $0}'
bat
$ echo "bet" | gawk '/b[ae]+t/{print $0}'
bet
$ echo "beat" | gawk '/b[ae]+t/{print $0}'
beat
$ echo "beet" | gawk '/b[ae]+t/{print $0}'
beet
$ echo "beeat" | gawk '/b[ae]+t/{print $0}'
beeat
$</code></pre>
<p class="calibre10">This time if either character defined in the character class appears, the text matches the specified pattern.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using braces</h3>
<p class="calibre10">Curly braces are available in ERE to allow you to specify a limit on a repeatable regular expression. This is often referred to as an <i class="calibre12">interval.</i> You can express the interval in two formats:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">m</code>: The regular expression appears exactly <i class="calibre12">m</i> times.</li>
<li class="calibre7"><code class="calibre26">m,n</code>: The regular expression appears at least <i class="calibre12">m</i> times, but no more than <i class="calibre12">n</i> times.</li>
</ul>
<p class="calibre10">This feature allows you to fine-tune exactly how many times you allow a character (or character class) to appear in a pattern.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">By default, the <code class="calibre26">gawk</code> program doesn't recognize regular expression intervals. You must specify the <code class="calibre26">--re-interval</code> command line option for the <code class="calibre26">gawk</code> program to recognize regular expression intervals.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Here's an example of using a simple interval of one value:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk --re-interval '/be{1}t/{print $0}'
$
$ echo "bet" | gawk --re-interval '/be{1}t/{print $0}'
bet
$ echo "beet" | gawk --re-interval '/be{1}t/{print $0}'
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="552" id="calibre_link-883" class="calibre11"></span>By specifying an interval of one, you restrict the number of times the character can be present for the string to match the pattern. If the character appears more times, the pattern match fails.</p>
<p class="calibre10">Often, specifying the lower and upper limit comes in handy:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk --re-interval '/be{1,2}t/{print $0}'
$
$ echo "bet" | gawk --re-interval '/be{1,2}t/{print $0}'
bet
$ echo "beet" | gawk --re-interval '/be{1,2}t/{print $0}'
beet
$ echo "beeet" | gawk --re-interval '/be{1,2}t/{print $0}'
$</code></pre>
<p class="calibre10">In this example, the <i class="calibre12">e</i> character can appear once or twice for the pattern match to pass; otherwise, the pattern match fails.</p>
<p class="calibre10">The interval pattern match also applies to character classes:</p>
<pre class="calibre29"><code class="calibre26">$ echo "bt" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
$
$ echo "bat" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
bat
$ echo "bet" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
bet
$ echo "beat" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
beat
$ echo "beet" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
beet
$ echo "beeat" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
$
$ echo "baeet" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
$
$ echo "baeaet" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="553" id="calibre_link-884" class="calibre11"></span>This regular expression pattern matches if there are exactly one or two instances of the letter <i class="calibre12">a</i> or <i class="calibre12">e</i> in the text pattern, but it fails if there are any more in any combination.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The pipe symbol</h3>
<p class="calibre10">The pipe symbol allows to you to specify two or more patterns that the regular expression engine uses in a logical <code class="calibre26">OR</code> formula when examining the data stream. If any of the patterns match the data stream text, the text passes. If none of the patterns match, the data stream text fails.</p>
<p class="calibre10">Here's the format for using the pipe symbol:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">expr1</i></code>|expr2|...</code></pre>
<p class="calibre10">Here's an example of this:</p>
<pre class="calibre29"><code class="calibre26">$ echo "The cat is asleep" | gawk '/cat|dog/{print $0}'
The cat is asleep
$ echo "The dog is asleep" | gawk '/cat|dog/{print $0}'
The dog is asleep
$ echo "The sheep is asleep" | gawk '/cat|dog/{print $0}'
$</code></pre>
<p class="calibre10">This example looks for the regular expression <code class="calibre26">cat</code> or <code class="calibre26">dog</code> in the data stream. You can't place any spaces within the regular expressions and the pipe symbol, or they're added to the regular expression pattern.</p>
<p class="calibre10">The regular expressions on either side of the pipe symbol can use any regular expression pattern, including character classes, to define the text:</p>
<pre class="calibre29"><code class="calibre26">$ echo "He has a hat." | gawk '/[ch]at|dog/{print $0}'
He has a hat.
$</code></pre>
<p class="calibre10">This example would match <code class="calibre26">cat</code>, <code class="calibre26">hat</code>, or <code class="calibre26">dog</code> in the data stream text.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Grouping expressions</h3>
<p class="calibre10">Regular expression patterns can also be grouped by using parentheses. When you group a regular expression pattern, the group is treated like a standard character. You can apply a special character to the group just as you would to a regular character. For example:</p>
<pre class="calibre29"><code class="calibre26">$ echo "Sat" | gawk '/Sat(urday)?/{print $0}'
Sat
$ echo "Saturday" | gawk '/Sat(urday)?/{print $0}'
Saturday
$</code></pre>
<p class="calibre10">The grouping of the âurdayâ ending along with the question mark allows the pattern to match either the full day name Saturday or the abbreviated name Sat.</p>
<p class="calibre10">It's common to use grouping along with the pipe symbol to create groups of possible pattern matches:</p>
<pre class="calibre29"><code class="calibre26">$ echo "cat" | gawk '/(c|b)a(b|t)/{print $0}'
cat
$ echo "cab" | gawk '/(c|b)a(b|t)/{print $0}'
cab
$ echo "bat" | gawk '/(c|b)a(b|t)/{print $0}'
bat
$ echo "bab" | gawk '/(c|b)a(b|t)/{print $0}'
bab
$ echo "tab" | gawk '/(c|b)a(b|t)/{print $0}'
$
$ echo "tac" | gawk '/(c|b)a(b|t)/{print $0}'
$</code></pre>
<p class="calibre10">The pattern <code class="calibre26">(c|b)a(b|t)</code> matches any combination of the letters in the first group along with any combination of the letters in the second group.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-271" class="calibre4"></a>Regular Expressions in Action</h2>
<p class="calibre10">Now that you've seen the rules <span type="pagebreak" title="554" id="calibre_link-885" class="calibre11"></span>and a few simple demonstrations of using regular expression patterns, it's time to put that knowledge into action. The following sections demonstrate some common regular expression examples within shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Counting directory files</h3>
<p class="calibre10">To start things out, let's look at a shell script that counts the executable files that are present in the directories defined in your <code class="calibre26">PATH</code> environment variable. To do that, you need to parse out the <code class="calibre26">PATH</code> variable into separate directory names. Chapter 6 showed you how to display the <code class="calibre26">PATH</code> environment variable:</p>
<pre class="calibre29"><code class="calibre26">$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games</code></pre>
<pre class="calibre29"><code class="calibre26">$</code></pre>
<p class="calibre10">Your <code class="calibre26">PATH</code> environment variable will differ, depending on where the applications are located on your Linux system. The key is to recognize that each directory in the <code class="calibre26">PATH</code> is separated by a colon. To get a listing of directories that you can use in a script, you must replace each colon with a space. You now recognize that the <code class="calibre26">sed</code> editor can do just that using a simple regular expression:</p>
<pre class="calibre29"><code class="calibre26">$ echo $PATH | sed 's/:/ /g'
/usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin
/usr/games /usr/local/games
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="555" id="calibre_link-886" class="calibre11"></span>After you have the directories separated out, you can use them in a standard <code class="calibre26">for</code> statement (see Chapter 13) to iterate through each directory:</p>
<pre class="calibre29"><code class="calibre26">mypath=$(echo $PATH | sed 's/:/ /g')
for directory in $mypath
do
...
done</code></pre>
<p class="calibre10">After you have each directory, you can use the <code class="calibre26">ls</code> command to list each file in each directory, and use another <code class="calibre26">for</code> statement to iterate through each file, incrementing a counter for each file.</p>
<p class="calibre10">The final version of the script looks like this:</p>
<pre class="calibre29"><code class="calibre26">$ cat countfiles
#!/bin/bash
# count number of files in your PATH
mypath=$(echo $PATH | sed 's/:/ /g')
count=0
for directory in $mypath
do
   check=$(ls $directory)
   for item in $check
   do
         count=$[ $count + 1 ]
  done
  echo "$directory - $count"
  count=0
done
$ ./countfiles /usr/local/sbin - 0
/usr/local/bin - 2
/usr/sbin - 213
/usr/bin - 1427
/sbin - 186
/bin - 152
/usr/games - 5
/usr/local/games &ndash; 0
$</code></pre>
<p class="calibre10">Now we're starting to see some of the power behind regular expressions!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Validating a phone number</h3>
<p class="calibre10"><span type="pagebreak" title="556" id="calibre_link-887" class="calibre11"></span>The previous example showed how to incorporate the simple regular expression along with <code class="calibre26">sed</code> to replace characters in a data stream to process data. Often, regular expressions are used to validate data to ensure that data is in the correct format for a script.</p>
<p class="calibre10">A common data validation application checks phone numbers. Often, data entry forms request phone numbers, and often customers fail to enter a properly formatted phone number. People in the United States use several common ways to display a phone number:</p>
<pre class="calibre29"><code class="calibre26">(123)456-7890
(123) 456-7890
123-456-7890
123.456.7890</code></pre>
<p class="calibre10">This leaves four possibilities for how customers can enter their phone number in a form. The regular expression must be robust enough to handle any of these situations.</p>
<p class="calibre10">When building a regular expression, it's best to start on the left side and build your pattern to match the possible characters you'll run into. In this example, there may or may not be a left parenthesis in the phone number. This can be matched by using the pattern:</p>
<pre class="calibre29"><code class="calibre26">^\(?</code></pre>
<p class="calibre10">The caret is used to indicate the beginning of the data. Because the left parenthesis is a special character, you must escape it to use it as a normal character. The question mark indicates that the left parenthesis may or may not appear in the data to match.</p>
<p class="calibre10">Next is the three-digit area code. In the United States, area codes start with the number 2 (no area codes start with the digits 0 or 1), and can go to 9. To match the area code, you'd use the following pattern:</p>
<pre class="calibre29"><code class="calibre26">[2-9][0-9]{2}</code></pre>
<p class="calibre10">This requires that the first character be a digit between 2 and 9, followed by any two digits. After the area code, the ending right parenthesis may or may not appear:</p>
<pre class="calibre29"><code class="calibre26">\)?</code></pre>
<p class="calibre10">After the area code, there can be a space, no space, a dash, or a dot. You can group those using a character group along with the pipe symbol:</p>
<pre class="calibre29"><code class="calibre26">(| |-|\.)</code></pre>
<p class="calibre10">The very first pipe symbol appears immediately after the left parenthesis to match the no space condition. You must use the escape character for the dot; otherwise, it is interpreted to match any character.</p>
<p class="calibre10">Next is the three-digit phone exchange number. Nothing special is required here:</p>
<pre class="calibre29"><code class="calibre26">[0-9]{3}</code></pre>
<p class="calibre10">After the phone exchange number, you must match a space, a dash, or a dot (this time you don't have to worry about matching no space because there must be at least a space between the phone exchange number and the rest of the number):</p>
<pre class="calibre29"><code class="calibre26"> ( |-|\.)</code></pre>
<p class="calibre10">Then to finish things off, you must match the four-digit local phone extension at the end of the string:</p>
<pre class="calibre29"><code class="calibre26">[0-9]{4}$</code></pre>
<p class="calibre10">Putting the entire pattern together results in this:</p>
<pre class="calibre29"><code class="calibre26">^\(?[2-9][0-9]{2}\)?(| |-|\.)[0-9]{3}( |-|\.)[0-9]{4}$</code></pre>
<p class="calibre10"><span type="pagebreak" title="557" id="calibre_link-888" class="calibre11"></span>You can use this regular expression pattern in the <code class="calibre26">gawk</code> program to filter out bad phone numbers. Now you just need to create a simple script using the regular expression in a <code class="calibre26">gawk</code> program and filter your phone list through the script. Remember that when you use regular expression intervals in the <code class="calibre26">gawk</code> program, you must use the <code class="calibre26">--re-interval</code> command line option, or you won't get the correct results.</p>
<p class="calibre10">Here's the script:</p>
<pre class="calibre29"><code class="calibre26">$ cat isphone
#!/bin/bash
# script to filter out bad phone numbers
gawk --re-interval '/^\(?[2-9][0-9]{2}\)?(| |-|\â
[0-9]{3}( |-|\.)[0-9]{4}/{print $0}'
$</code></pre>
<p class="calibre10">Although you can't tell from this listing, the <code class="calibre26">gawk</code> command is on a single line in the shell script. You can then redirect phone numbers to the script for processing:</p>
<pre class="calibre29"><code class="calibre26">$ echo "317-555-1234" | ./isphone
317-555-1234
$ echo "000-555-1234" | ./isphone
$ echo "312 555-1234" | ./isphone
312 555-1234
$</code></pre>
<p class="calibre10">Or you can redirect an entire file of phone numbers to filter out the invalid ones:</p>
<pre class="calibre29"><code class="calibre26">$ cat phonelist
000-000-0000
123-456-7890
212-555-1234
(317)555-1234
(202) 555-9876
33523
1234567890
234.123.4567
$ cat phonelist | ./isphone
212-555-1234
(317)555-1234
(202) 555-9876
234.123.4567
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="558" id="calibre_link-889" class="calibre11"></span>Only the valid phone numbers that match the regular expression pattern appear.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Parsing an e-mail address</h3>
<p class="calibre10">These days, e-mail has become a crucial form of communication. Trying to validate e-mail addresses has become quite a challenge for script builders because of the myriad ways to create an e-mail address. This is the basic form of an e-mail address:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">username@hostname</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">username</i></code> value can use any alphanumeric character, along with several special characters:</p>
<ul class="calibre14">
<li class="calibre7">Dot</li>
<li class="calibre7">Dash</li>
<li class="calibre7">Plus sign</li>
<li class="calibre7">Underscore</li>
</ul>
<p class="calibre10">These characters can appear in any combination in a valid e-mail userid. The <code class="calibre26"><i class="calibre12">hostname</i></code> portion of the e-mail address consists of one or more domain names and a server name. The server and domain names must also follow strict naming rules, allowing only alphanumeric characters, along with the special characters:</p>
<ul class="calibre14">
<li class="calibre7">Dot</li>
<li class="calibre7">Underscore</li>
</ul>
<p class="calibre10">The server and domain names are each separated by a dot, with the server name specified first, any subdomain names specified next, and finally, the top-level domain name without a trailing dot.</p>
<p class="calibre10">At one time, the top-level domains were fairly limited, and regular expression pattern builders attempted to add them all in patterns for validation. Unfortunately, as the Internet grew, so did the possible top-level domains. This technique is no longer a viable solution.</p>
<p class="calibre10">Let's start building <span type="pagebreak" title="559" id="calibre_link-890" class="calibre11"></span>the regular expression pattern from the left side. We know that there can be multiple valid characters in the username. This should be fairly easy:</p>
<pre class="calibre29"><code class="calibre26">^([a-zA-Z0-9_\-\.\+]+)@</code></pre>
<p class="calibre10">This grouping specifies the allowable characters in the username and the plus sign to indicate that at least one character must be present. The next character obviously is the @ symbol &mdash; no surprises there.</p>
<p class="calibre10">The hostname pattern uses the same technique to match the server name and the subdomain names:</p>
<pre class="calibre29"><code class="calibre26">([a-zA-Z0-9_\-\.]+)</code></pre>
<p class="calibre10">This pattern matches the text:</p>
<pre class="calibre29"><code class="calibre26">server
server.subdomain
server.subdomain.subdomain</code></pre>
<p class="calibre10">There are special rules for the top-level domain. Top-level domains are only alphabetic characters, and they must be no fewer than two characters (used in country codes) and no more than five characters in length. The following is the regular expression pattern for the top-level domain:</p>
<pre class="calibre29"><code class="calibre26">\.([a-zA-Z]{2,5})$</code></pre>
<p class="calibre10">Putting the entire pattern together results in the following:</p>
<pre class="calibre29"><code class="calibre26">^([a-zA-Z0-9_\-\.\+]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$</code></pre>
<p class="calibre10">This pattern filters out poorly formatted e-mail addresses from a data list. Now you can create your script to implement the regular expression:</p>
<pre class="calibre29"><code class="calibre26">$ echo "rich@here.now" | ./isemail
rich@here.now
$ echo "rich@here.now." | ./isemail
$
$ echo "rich@here.n" | ./isemail
$
$ echo "rich@here-now" | ./isemail
$
$ echo "rich.blum@here.now" | ./isemail
rich.blum@here.now
$ echo "rich_blum@here.now" | ./isemail
rich_blum@here.now
$ echo "rich/blum@here.now" | ./isemail
$
$ echo "rich#blum@here.now" | ./isemail
$
$ echo "rich*blum@here.now" | ./isemail
$</code></pre>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-272" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="560" id="calibre_link-891" class="calibre11"></span>If you manipulate data files in shell scripts, you need to become familiar with regular expressions. Regular expressions are implemented in Linux utilities, programming languages, and applications using regular expression engines. A host of different regular expression engines is available in the Linux world. The two most popular are the POSIX Basic Regular Expression (BRE) engine and the POSIX Extended Regular Expression (ERE) engine. The <code class="calibre26">sed</code> editor conforms mainly to the BRE engine, while the <code class="calibre26">gawk</code> program utilizes most features found in the ERE engine.</p>
<p class="calibre10">A regular expression defines a pattern template that's used to filter text in a data stream. The pattern consists of a combination of standard text characters and special characters. The special characters are used by the regular expression engine to match a series of one or more characters, similarly to how wildcard characters work in other applications.</p>
<p class="calibre10">By combining characters and special characters, you can define a pattern to match almost any type of data. You can then use the <code class="calibre26">sed</code> editor or <code class="calibre26">gawk</code> program to filter specific data from a larger data stream, or for validating data received from data entry applications.</p>
<p class="calibre10">The next chapter digs deeper into using the <code class="calibre26">sed</code> editor to perform advanced text manipulation. Lots of advanced features are available in the <code class="calibre26">sed</code> editor that make it useful for handling large data streams and filtering out just what you need.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-92">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-273" class="calibre4"></a><span class="chaptertitle">Chapter 21</span><br class="calibre22" /><span class="chaptertitle">Advanced sed</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Using multiline commands</li>
<li class="calibre7">Understanding the hold space</li>
<li class="calibre7">Negating a command</li>
<li class="calibre7">Changing the flow</li>
<li class="calibre7">Replacing via a pattern</li>
<li class="calibre7">Using sed in scripts</li>
<li class="calibre7">Creating sed utilities</li>
</ol>
<p class="calibre19">Chapter 19 showed you how to use the basics of the <code class="calibre26">sed</code> editor to manipulate text in data streams. The basic <code class="calibre26">sed</code> editor commands are capable of handling most of your everyday text-editing requirements. This chapter looks at the more advanced features that the <code class="calibre26">sed</code> editor has to offer. These are features that you might not use as often. But when you need them, it's nice to know that they're available and how to use them.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-274" class="calibre4"></a>Looking at Multiline Commands</h2>
<p class="calibre10"><span type="pagebreak" title="561" id="calibre_link-892" class="calibre11"></span>When using the basic <code class="calibre26">sed</code> editor commands, you may have noticed a limitation. All the <code class="calibre26">sed</code> editor commands perform functions on a single line of data. As the <code class="calibre26">sed</code> editor reads a data stream, it divides the data into lines based on the presence of newline characters. The <code class="calibre26">sed</code> editor handles each data line one at a time, processing the defined script commands on the data line, and then moving on to the next line and repeating the processing.</p>
<p class="calibre10">Sometimes, you need to perform actions on data that spans more than one line. This is especially true if you're trying to find or replace a phrase.</p>
<p class="calibre10">For example, if you're looking for the phrase <code class="calibre26">Linux System Administrators Group</code> in your data, it's quite possible that the phrase's words can be split onto two lines. If you processed the text using a normal <code class="calibre26">sed</code> editor command, it would be impossible to detect the split phrase.</p>
<p class="calibre10"><span type="pagebreak" title="562" id="calibre_link-893" class="calibre11"></span>Fortunately, the designers behind the <code class="calibre26">sed</code> editor thought of that situation and devised a solution. The <code class="calibre26">sed</code> editor includes three special commands that you can use to process multiline text:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">N</code> adds the next line in the data stream to create a multiline group for processing.</li>
<li class="calibre7"><code class="calibre26">D</code> deletes a single line in a multiline group.</li>
<li class="calibre7"><code class="calibre26">P</code> prints a single line in a multiline group.</li>
</ul>
<p class="calibre10">The following sections examine these multiline commands more closely and demonstrate how you can use them in your scripts.</p>
<section class="toclist">
<h3 class="calibre15">Navigating the next command</h3>
<p class="calibre10">Before you can examine the multiline <code class="calibre26">next</code> command, you first need to look at how the single-line version of the <code class="calibre26">next</code> command works. After you know what that command does, it's much easier to understand how the multiline version of the <code class="calibre26">next</code> command operates.</p>
<section class="toclist">
<h4 class="calibre25">Using the single-line next command</h4>
<p class="calibre10">The lowercase <code class="calibre26">n</code> command tells the <code class="calibre26">sed</code> editor to move to the next line of text in the data stream, without going back to the beginning of the commands. Remember that normally the <code class="calibre26">sed</code> editor processes all the defined commands on a line before moving to the next line of text in the data stream. The single-line <code class="calibre26">next</code> command alters this flow.</p>
<p class="calibre10">This may sound somewhat complicated, and sometimes it is. In this example, you have a data file that contains five lines, two of which are empty. The goal is to remove the blank line after the header line but leave the blank line before the last line intact. If you write a <code class="calibre26">sed</code> script to just remove blank lines, you remove both blank lines:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data1.txt</b></code>
This is the header line.
This is a data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed '/â§$/d' data1.txt</b></code>
This is the header line.
This is a data line.
This is the last line.
$</code></pre>
<p class="calibre10">Because the line you want to remove is blank, you don't have any text you can search for to uniquely identify the line. The solution is to use the <code class="calibre26">n</code> command. In this next example, the <span type="pagebreak" title="563" id="calibre_link-894" class="calibre11"></span>script looks for a unique line that contains the word <code class="calibre26">header</code>. After the script identifies that line, the <code class="calibre26">n</code> command moves the <code class="calibre26">sed</code> editor to the next line of text, which is the empty line.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/header/{n ; d}' data1.txt</b></code>
This is the header line.
This is a data line.
This is the last line.
$</code></pre>
<p class="calibre10">At that point, the <code class="calibre26">sed</code> editor continues processing the command list, which uses the <code class="calibre26">d</code> command to delete the empty line. When the <code class="calibre26">sed</code> editor reaches the end of the command script, it reads the next line of text from the data stream and starts processing commands from the top of the command script. The <code class="calibre26">sed</code> editor does not find another line with the word <code class="calibre26">header</code>; thus, no further lines are deleted.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Combining lines of text</h4>
<p class="calibre10">Now that you've seen the single-line <code class="calibre26">next</code> command, you can look at the multiline version. The single-line <code class="calibre26">next</code> command moves the next line of text from the data stream into the processing space (called the <code class="calibre26"><i class="calibre12">pattern space</i></code>) of the <code class="calibre26">sed</code> editor. The multiline version of the <code class="calibre26">next</code> command (which uses a capital <code class="calibre26">N</code>) adds the next line of text to the text already in the pattern space.</p>
<p class="calibre10">This has the effect of combining two lines of text from the data stream into the same pattern space. The lines of text are still separated by a newline character, but the <code class="calibre26">sed</code> editor can now treat both lines of text as one line.</p>
<p class="calibre10">Here's a demonstration of how the <code class="calibre26">N</code> command operates:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed '/first/{ N ; s/\n/ / }' data2.txt</b></code>
This is the header line.
This is the first data line. This is the second data line.
This is the last line.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor script searches for the line of text that contains the word âfirstâ in it. When it finds the line, it uses the <code class="calibre26">N</code> command to combine the next line with that line. It then uses the <code class="calibre26">substitution</code> command (<code class="calibre26">s</code>) to replace the newline character with a space. The result is that the two lines in the text file appear as one line in the <code class="calibre26">sed</code> editor output.</p>
<p class="calibre10"><span type="pagebreak" title="564" id="calibre_link-895" class="calibre11"></span>This has a practical application if you're searching for a text phrase that may be split between two lines in the data file. Here's an example:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data3.txt</b></code>
On Tuesday, the Linux System
Administrator's group meeting will be held.
All System Administrators should attend.
Thank you for your attendance.
$
$ <code class="calibre26"><b class="calibre21">sed 'N ; s/System Administrator/Desktop User/' data3.txt</b></code>
On Tuesday, the Linux System
Administrator's group meeting will be held.
All Desktop Users should attend.
Thank you for your attendance.
$</code></pre>
<p class="calibre10">The <code class="calibre26">substitution</code> command is looking for the specific two-word phrase <code class="calibre26">System Administrator</code> in the text file. In the single line where the phrase appears, everything is fine; the <code class="calibre26">substitution</code> command can replace the text. But in the situation where the phrase is split between two lines, the <code class="calibre26">substitution</code> command doesn't recognize the matching pattern.</p>
<p class="calibre10">The <code class="calibre26">N</code> command helps solve this problem:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'N ; s/System.Administrator/Desktop User/' data3.txt</b></code>
On Tuesday, the Linux Desktop User's group meeting will be held.
All Desktop Users should attend.
Thank you for your attendance.
$</code></pre>
<p class="calibre10">By using the <code class="calibre26">N</code> command to combine the next line with the line where the first word is found, you can detect when a line split occurs in the phrase.</p>
<p class="calibre10">Notice that the <code class="calibre26">substitution</code> command uses a wildcard pattern (.) between the word <code class="calibre26">System</code> and the word <code class="calibre26">Administrator</code> to match both the space and the newline situation. However, when it matched the newline character, it removed it from the string, causing the two lines to merge into one line. This may not be exactly what you want.</p>
<p class="calibre10">To solve this problem, you can use two <code class="calibre26">substitution</code> commands in the <code class="calibre26">sed</code> editor script, one to match the multiline occurrence and one to match the single-line occurrence:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'N</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System\nAdministrator/Desktop\nUser/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System Administrator/Desktop User/</b></code>
&gt; <code class="calibre26"><b class="calibre21">' data3.txt</b></code>
On Tuesday, the Linux Desktop
User's group meeting will be held.
All Desktop Users should attend.
Thank you for your attendance.
$</code></pre>
<p class="calibre10">The first <code class="calibre26">substitution</code> command specifically looks for the newline character between the two <span type="pagebreak" title="565" id="calibre_link-896" class="calibre11"></span>search words and includes it in the replacement string. This allows you to add the newline character in the same place in the new text.</p>
<p class="calibre10">There's still one subtle problem with this script, however. The script always reads the next line of text into the pattern space before executing the <code class="calibre26">sed</code> editor commands. When it reaches the last line of text, there isn't a next line of text to read, so the <code class="calibre26">N</code> command causes the <code class="calibre26">sed</code> editor to stop. If the matching text is on the last line in the data stream, the commands don't catch the matching data:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data4.txt</b></code>
On Tuesday, the Linux System
Administrator's group meeting will be held.
All System Administrators should attend.
$
$ <code class="calibre26"><b class="calibre21">sed 'N</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System\nAdministrator/Desktop\nUser/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System Administrator/Desktop User/</b></code>
&gt; <code class="calibre26"><b class="calibre21">' data4.txt</b></code>
On Tuesday, the Linux Desktop
User's group meeting will be held.
All System Administrators should attend.
$</code></pre>
<p class="calibre10">Because the <code class="calibre26">System Administrator</code> text appears in the last line in the data stream, the <code class="calibre26">N</code> command misses it, as there isn't another line to read into the pattern space to combine. You can easily resolve this problem by moving your single-line commands before the <code class="calibre26">N</code> command and having only the multiline commands appear after the <code class="calibre26">N</code> command, like this:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System Administrator/Desktop User/</b></code>
&gt; <code class="calibre26"><b class="calibre21">N</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System\nAdministrator/Desktop\nUser/</b></code>
&gt; <code class="calibre26"><b class="calibre21">' data4.txt</b></code>
On Tuesday, the Linux Desktop
User's group meeting will be held.
All Desktop Users should attend.
$</code></pre>
<p class="calibre10">Now, the <code class="calibre26">substitution</code> command that looks for the phrase in a single line works just fine on the last line in the data stream, and the multiline <code class="calibre26">substitution</code> command covers the occurrence in the middle of the data stream.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Navigating the multiline delete command</h3>
<p class="calibre10">Chapter 19 introduced the single-line <code class="calibre26">delete</code> command (<code class="calibre26">d</code>). The <code class="calibre26">sed</code> editor uses it to delete the current line in the pattern space. If you're working with the <code class="calibre26">N</code> command, however, you must be careful when using the single-line <code class="calibre26">delete</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'N ; /System\nAdministrator/d' data4.txt</b></code>
All System Administrators should attend.
$</code></pre>
<p class="calibre10">The <code class="calibre26">delete</code> command <span type="pagebreak" title="566" id="calibre_link-897" class="calibre11"></span>looked for the words <code class="calibre26">System</code> and <code class="calibre26">Administrator</code> in separate lines and deleted both of the lines in the pattern space. This may or may not have been what you intended.</p>
<p class="calibre10">The <code class="calibre26">sed</code> editor provides the multiline <code class="calibre26">delete</code> command (<code class="calibre26">D</code>), which deletes only the first line in the pattern space. It removes all characters up to and including the newline character:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'N ; /System\nAdministrator/D' data4.txt</b></code>
Administrator's group meeting will be held.
All System Administrators should attend.
$</code></pre>
<p class="calibre10">The second line of text, added to the pattern space by the <code class="calibre26">N</code> command, remains intact. This comes in handy if you need to remove a line of text that appears before a line that you find a data string in.</p>
<p class="calibre10">Here's an example of removing a blank line that appears before the first line in a data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data5.txt</b></code>
This is the header line.
This is a data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed '/â§$/{N ; /header/D}' data5.txt</b></code>
This is the header line.
This is a data line.
This is the last line.
$</code></pre>
<p class="calibre10">This <code class="calibre26">sed</code> editor script looks for blank lines and then uses the <code class="calibre26">N</code> command to add the next line of text into the pattern space. If the new pattern space contents contain the word <code class="calibre26">header</code>, the <code class="calibre26">D</code> command <span type="pagebreak" title="567" id="calibre_link-898" class="calibre11"></span>removes the first line in the pattern space. Without the combination of the <code class="calibre26">N</code> and <code class="calibre26">D</code> commands, it would be impossible to remove the first blank line without removing all other blank lines.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Navigating the multiline print command</h3>
<p class="calibre10">By now, you're probably catching on to the difference between the single-line and multiline versions of the commands. The multiline print command (<code class="calibre26">P</code>) follows along using the same technique. It prints only the first line in a multiline pattern space. This includes all characters up to the newline character in the pattern space. It is used in much the same way as the single-line <code class="calibre26">p</code> command to display text when you use the <code class="calibre26">-n</code> option to suppress output from the script.</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">$ sed -n 'N ; /System\nAdministrator/P' data3.txt</b></code>
On Tuesday, the Linux System
$</code></pre>
<p class="calibre10">When the multiline match occurs, the <code class="calibre26">P</code> command prints only the first line in the pattern space. The power of the multiline <code class="calibre26">P</code> command comes into play when you combine it with the <code class="calibre26">N</code> and <code class="calibre26">D</code> multiline commands.</p>
<p class="calibre10">The <code class="calibre26">D</code> command has a unique feature in that it forces the <code class="calibre26">sed</code> editor to return to the beginning of the script and repeat the commands on the same pattern space (it doesn't read a new line of text from the data stream). By including the <code class="calibre26">N</code> command in the command script, you can effectively single-step through the pattern space, matching multiple lines together.</p>
<p class="calibre10">Next, by using the <code class="calibre26">P</code> command, you can print the first line, and then using the <code class="calibre26">D</code> command, you can delete the first line and loop back to the beginning of the script. When you are back at the script's beginning, the <code class="calibre26">N</code> command reads in the next line of text and starts the process all over again. This loop continues until you reach the end of the data stream.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-275" class="calibre4"></a>Holding Space</h2>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">pattern space</i></code> is an active buffer area that holds the text examined by the <code class="calibre26">sed</code> editor while it processes commands. However, it isn't the only space available in the <code class="calibre26">sed</code> editor for storing text.</p>
<p class="calibre10">The <code class="calibre26">sed</code> editor utilizes another buffer area called the <code class="calibre26"><i class="calibre12">hold space</i></code>. You can use the hold space to temporarily hold lines of text while working on other lines in the pattern space. The five commands associated with operating with the hold space are shown in <a id="calibre_link-1239" href="#calibre_link-1156" class="calibre4">Table 21.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1156" href="#calibre_link-1239" class="calibre4"><b class="calibre21">Table 21.1</b></a></span> The sed Editor Hold Space Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">h</code></td>
<td class="left">Copies pattern space to hold space</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">H</code></td>
<td class="left">Appends pattern space to hold space</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">g</code></td>
<td class="left">Copies hold space to pattern space</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">G</code></td>
<td class="left">Appends hold space to pattern space</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">x</code></td>
<td class="left">Exchanges contents of pattern and hold spaces</td>
</tr>
</table>
</figure>
<p class="calibre10">These commands <span type="pagebreak" title="568" id="calibre_link-899" class="calibre11"></span>let you copy text from the pattern space to the hold space. This frees up the pattern space to load another string for processing.</p>
<p class="calibre10">Usually, after using the <code class="calibre26">h</code> or <code class="calibre26">H</code> commands to move a string to the hold space, eventually you want to use the <code class="calibre26">g</code>, <code class="calibre26">G</code>, or <code class="calibre26">x</code> commands to move the stored string back into the pattern space (otherwise, you wouldn't have cared about saving them in the first place).</p>
<p class="calibre10">With two buffer areas, trying to determine what line of text is in which buffer area can sometimes get confusing. Here's a short example that demonstrates how to use the <code class="calibre26">h</code> and <code class="calibre26">g</code> commands to move data back and forth between the <code class="calibre26">sed</code> editor buffer spaces:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed -n '/first/ {h ; p ; n ; p ; g ; p }' data2.txt</b></code>
This is the first data line.
This is the second data line.
This is the first data line.
$</code></pre>
<p class="calibre10">Look at the preceding code example step by step:</p>
<ol class="calibre6">
<li class="calibre7">The <code class="calibre26">sed</code> script uses a regular expression in the address to filter the line containing the word <code class="calibre26">first</code>.</li>
<li class="calibre7">When the line containing the word <code class="calibre26">first</code> appears, the initial command in <code class="calibre26">{}</code>, the <code class="calibre26">h</code> command, places the line in the hold space.</li>
<li class="calibre7">The next command, the <code class="calibre26">p</code> command, prints the contents of the pattern space, which is still the first data line.</li>
<li class="calibre7">The <code class="calibre26">n</code> command retrieves the next line in the data stream (<code class="calibre26">This is the second data line</code>) and places it in the pattern space.</li>
<li class="calibre7">The <code class="calibre26">p</code> command prints the contents of the pattern space, which is now the second data line.</li>
<li class="calibre7">The <code class="calibre26">g</code> command places the contents of the hold space (<code class="calibre26">This is the first data line</code>) back into the pattern space, replacing the current text.</li>
<li class="calibre7">The <code class="calibre26">p</code> command prints the current contents of the pattern space, which is now back to the first data line.</li>
</ol>
<p class="calibre10"><span type="pagebreak" title="569" id="calibre_link-900" class="calibre11"></span>By shuffling the text lines around using the hold space, you can force the first data line to appear after the second data line in the output. If you just drop the first <code class="calibre26">p</code> command, you can output the two lines in reverse order:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '/first/ {h ; n ; p ; g ; p }' data2.txt</b></code>
This is the second data line.
This is the first data line.
$</code></pre>
<p class="calibre10">This is the start of something useful. You can use this technique to create a <code class="calibre26">sed</code> script that reverses an entire file of text lines! To do that, however, you need to see the negating feature of the <code class="calibre26">sed</code> editor, which is what the next section is all about.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-276" class="calibre4"></a>Negating a Command</h2>
<p class="calibre10">Chapter 19 showed that the <code class="calibre26">sed</code> editor applies commands either to every text line in the data stream or to lines specifically indicated by either a single address or an address range. You can also configure a command to not apply to a specific address or address range in the data stream.</p>
<p class="calibre10">The exclamation mark command (<code class="calibre26">!</code>) is used to negate a command. This means in situations where the command would normally have been activated, it isn't. Here's an example demonstrating this feature:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '/header/!p' data2.txt</b></code>
This is the first data line.
This is the second data line.
This is the last line.
$</code></pre>
<p class="calibre10">The normal <code class="calibre26">p</code> command would have printed only the line in the <code class="calibre26">data2</code> file that contained the word <code class="calibre26">header</code>. By adding the exclamation mark, the opposite happens &mdash; all lines in the file are printed except the one that contained the word <code class="calibre26">header</code>.</p>
<p class="calibre10">Using the exclamation mark comes in handy in several applications. Recall that earlier in the chapter, the âNavigating the next commandâ section showed a situation where a <code class="calibre26">sed</code> editor command wouldn't operate on the last line of text in the data stream because there wasn't a line after it. You can use the exclamation point to fix that problem:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'N;</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System\nAdministrator/Desktop\nUser/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System Administrator/Desktop User/</b></code>
&gt; <code class="calibre26"><b class="calibre21">' data4.txt</b></code>
On Tuesday, the Linux Desktop
User's group meeting will be held.
All System Administrators should attend.
$
$ <code class="calibre26"><b class="calibre21">sed '$!N;</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System\nAdministrator/Desktop\nUser/</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/System Administrator/Desktop User/</b></code>
&gt; <code class="calibre26"><b class="calibre21">' data4.txt</b></code>
On Tuesday, the Linux Desktop
User's group meeting will be held.
All Desktop Users should attend.
$ </code></pre>
<p class="calibre10"><span type="pagebreak" title="570" id="calibre_link-901" class="calibre11"></span>This example shows the exclamation mark used with the <code class="calibre26">N</code> command, along with the dollar sign (<code class="calibre26">$</code>) special address. The dollar sign represents the last line of text in the data stream, so when the <code class="calibre26">sed</code> editor reaches the last line, it doesn't execute the <code class="calibre26">N</code> command. However, for all other lines, it does execute the command.</p>
<p class="calibre10">Using this technique, you can reverse the order of text lines in a data stream. To reverse the order of the lines as they appear in the text stream (display the last line first and the first line last), you need to do some fancy footwork using the hold space.</p>
<p class="calibre10">The pattern you need to work with goes like this:</p>
<ol class="calibre6">
<li class="calibre7">Place a line in the pattern space.</li>
<li class="calibre7">Place the line from the pattern space to the hold space.</li>
<li class="calibre7">Put the next line of text in the pattern space.</li>
<li class="calibre7">Append the hold space to the pattern space.</li>
<li class="calibre7">Place everything in the pattern space into the hold space.</li>
<li class="calibre7">Repeat Steps 3 through 5 until you've put all the lines in reverse order in the hold space.</li>
<li class="calibre7">Retrieve the lines, and print them.</li>
</ol>
<p class="calibre10"><a id="calibre_link-1240" href="#calibre_link-1109" class="calibre4">Figure 21.1</a> diagrams what this looks like in more detail.</p>
<figure class="calibre23">
<img class="center" src="images/000028.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1109" href="#calibre_link-1240" class="calibre4"><b class="calibre21">Figure 21.1</b></a></span> Reversing the order of a text file using the hold space</p>
</figcaption>
</figure>
<p class="calibre10">When using this technique, you do not want to print lines as they are processed. This means using the <code class="calibre26">-n</code> command line option for <code class="calibre26">sed</code>. The next thing to determine is how to append the hold space text to the pattern space text. This is done by using the <code class="calibre26">G</code> command. The only problem is that you don't want to append the hold space to the first line of text processed. This is easily solved by using the exclamation mark command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">1!G</b></code></code></pre>
<p class="calibre10">The next step is to place the new pattern space (the text line with the appended reverse lines) into the hold space. This is simple enough; just use the <code class="calibre26">h</code> command.</p>
<p class="calibre10"><span type="pagebreak" title="571" id="calibre_link-902" class="calibre11"></span>When you've got the entire data stream in the pattern space in reverse order, you just need to print the results. You know you have the entire data stream in the pattern space when you've reached the last line in the data stream. To print the results, just use the following command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">$p</b></code></code></pre>
<p class="calibre10">Those are the pieces you need to create your line-reversing <code class="calibre26">sed</code> editor script. Now try it out in a test run:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed -n '{1!G ; h ; $p }' data2.txt</b></code>
This is the last line.
This is the second data line.
This is the first data line.
This is the header line.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor <span type="pagebreak" title="572" id="calibre_link-903" class="calibre11"></span>script performed as expected. The output from the script reverses the original lines in the text file. This demonstrates the power of using the hold space in your <code class="calibre26">sed</code> scripts. It provides an easy way to manipulate the order of lines in the script output.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">In case you're wondering, a bash shell command can perform the function of reversing a text file. The <code class="calibre26">tac</code> command displays a text file in reverse order. You probably noticed the clever name of the command because it performs the reverse function of the <code class="calibre26">cat</code> command.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-277" class="calibre4"></a>Changing the Flow</h2>
<p class="calibre10">Normally, the <code class="calibre26">sed</code> editor processes commands starting at the top and proceeding toward the end of the script (the exception is the <code class="calibre26">D</code> command, which forces the <code class="calibre26">sed</code> editor to return to the top of the script without reading a new line of text). The <code class="calibre26">sed</code> editor provides a method for altering the flow of the command script, producing a result similar to that of a structured programming environment.</p>
<section class="toclist">
<h3 class="calibre15">Branching</h3>
<p class="calibre10">In the previous section, you saw how the exclamation mark command is used to negate the effect of a command on a line of text. The <code class="calibre26">sed</code> editor provides a way to negate an entire section of commands, based on an address, an address pattern, or an address range. This allows you to perform a group of commands only on a specific subset within the data stream.</p>
<p class="calibre10">Here's the format of the <code class="calibre26">branch</code> command:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]b [<code class="calibre26"><i class="calibre12">label</i></code>]</code></pre>
<p class="calibre10">The <code class="calibre26">address</code> parameter determines which line or lines of data trigger the <code class="calibre26">branch</code> command. The <code class="calibre26">label</code> parameter defines the location to branch to. If the <code class="calibre26">label</code> parameter is not present, the <code class="calibre26">branch</code> command proceeds to the end of the script.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$
$ <code class="calibre26"><b class="calibre21">sed '{2,3b ; s/This is/Is this/ ; s/line./test?/}' data2.txt</b></code>
Is this the header test?
This is the first data line.
This is the second data line.
Is this the last test?
$</code></pre>
<p class="calibre10">The <code class="calibre26">branc</code>h command skips the two <code class="calibre26">substitution</code> commands for the second and third lines in the data stream.</p>
<p class="calibre10">Instead <span type="pagebreak" title="573" id="calibre_link-904" class="calibre11"></span>of going to the end of the script, you can define a label for the <code class="calibre26">branch</code> command to jump to. Labels start with a colon and can be up to seven characters in length:</p>
<pre class="calibre29"><code class="calibre26">:label2</code></pre>
<p class="calibre10">To specify the label, just add it after the <code class="calibre26">b</code> command. Using labels allows you to skip commands that match the <code class="calibre26">branch</code> address but still process other commands in the script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '{/first/b jump1 ; s/This is the/No jump on/</b></code>
&gt; <code class="calibre26"><b class="calibre21">:jump1</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/This is the/Jump here on/}' data2.txt</b></code>
No jump on header line
Jump here on first data line
No jump on second data line
No jump on last line
$</code></pre>
<p class="calibre10">The <code class="calibre26">branch</code> command specifies that the program should jump to the script line labeled <code class="calibre26">jump1</code> if the matching text âfirstâ appears in the line. If the <code class="calibre26">branch</code> command pattern doesn't match, the <code class="calibre26">sed</code> editor continues processing commands in the script, including the command after the <code class="calibre26">branch</code> label. (Thus, all three <code class="calibre26">substitution</code> commands are processed on lines that don't match the <code class="calibre26">branch</code> pattern.)</p>
<p class="calibre10">If a line matches the <code class="calibre26">branch</code> pattern, the <code class="calibre26">sed</code> editor branches to the <code class="calibre26">branch</code> label line. Thus, only the last <code class="calibre26">substitution</code> command is executed.</p>
<p class="calibre10">The example shows branching to a label further down in the <code class="calibre26">sed</code> script. You can also <code class="calibre26">branch</code> to a label that appears earlier in the script, thus creating a looping effect:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This, is, a, test, to, remove, commas." | sed -n '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/,//1p</b></code>
&gt; <code class="calibre26"><b class="calibre21">b start</b></code>
&gt; <code class="calibre26"><b class="calibre21">}'</b></code>
This is, a, test, to, remove, commas.
This is a, test, to, remove, commas.
This is a test, to, remove, commas.
This is a test to, remove, commas.
This is a test to remove, commas.
This is a test to remove commas.
^C
$</code></pre>
<p class="calibre10">Each script iteration removes the first occurrence of a comma from the text string and prints the string. There's one catch to this script: It never ends. This situation creates an endless loop, searching for commas until you manually stop it by sending a signal with the Ctrl+C key combination.</p>
<p class="calibre10"><span type="pagebreak" title="574" id="calibre_link-905" class="calibre11"></span>To prevent this problem, you should specify an address pattern for the <code class="calibre26">branch</code> command to look for. If the pattern isn't present, the branching should stop:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This, is, a, test, to, remove, commas." | sed -n '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/,//1p</b></code>
&gt; <code class="calibre26"><b class="calibre21">/,/b start</b></code>
&gt; <code class="calibre26"><b class="calibre21">}'</b></code>
This is, a, test, to, remove, commas.
This is a, test, to, remove, commas.
This is a test, to, remove, commas.
This is a test to, remove, commas.
This is a test to remove, commas.
This is a test to remove commas.
$</code></pre>
<p class="calibre10">Now the <code class="calibre26">branch</code> command branches only if there's a comma in the line. After the last comma has been removed, the <code class="calibre26">branch</code> command doesn't execute, allowing the script to properly finish.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Testing</h3>
<p class="calibre10">Similar to the <code class="calibre26">branch</code> command, the <code class="calibre26">test</code> command (<code class="calibre26">t</code>) is also used to modify the flow of the <code class="calibre26">sed</code> editor script. Instead of jumping to a label based on an address, the <code class="calibre26">test</code> command jumps to a label based on the outcome of a <code class="calibre26">substitution</code> command.</p>
<p class="calibre10">If the <code class="calibre26">substitution</code> command successfully matches and substitutes a pattern, the <code class="calibre26">test</code> command branches to the specified label. If the <code class="calibre26">substitution</code> command doesn't match the specified pattern, the <code class="calibre26">test</code> command doesn't branch.</p>
<p class="calibre10">The <code class="calibre26">test</code> command uses the same format as the <code class="calibre26">branch</code> command:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]t [<code class="calibre26"><i class="calibre12">label</i></code>]</code></pre>
<p class="calibre10">Like the <code class="calibre26">branch</code> command, if you don't specify a label, <code class="calibre26">sed</code> branches to the end of the script if the test succeeds.</p>
<p class="calibre10">The <code class="calibre26">test</code> command provides a cheap way to perform a basic <code class="calibre26">if-then</code> statement on the text in the data stream. For example, if you don't need to make a substitution if another substitution was made, the <code class="calibre26">test</code> command can help:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/first/matched/</b></code>
&gt; <code class="calibre26"><b class="calibre21">t</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/This is the/No match on/</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' data2.txt</b></code>
No match on header line
This is the matched data line
No match on second data line
No match on last line
$</code></pre>
<p class="calibre10">The first <code class="calibre26">substitution</code> command looks for the pattern text <code class="calibre26">first</code>. If it matches the pattern <span type="pagebreak" title="575" id="calibre_link-906" class="calibre11"></span>in the line, it replaces the text, and the <code class="calibre26">test</code> command jumps over the second <code class="calibre26">substitution</code> command. If the first <code class="calibre26">substitution</code> command doesn't match the pattern, the second <code class="calibre26">substitution</code> command is processed.</p>
<p class="calibre10">Using the <code class="calibre26">test</code> command, you can clean up the loop you tried using the <code class="calibre26">branch</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This, is, a, test, to, remove, commas. " | sed -n '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/,//1p</b></code>
&gt; <code class="calibre26"><b class="calibre21">t start</b></code>
&gt; <code class="calibre26"><b class="calibre21">}'</b></code>
This is, a, test, to, remove, commas.
This is a, test, to, remove, commas.
This is a test, to, remove, commas.
This is a test to, remove, commas.
This is a test to remove, commas.
This is a test to remove commas.
$</code></pre>
<p class="calibre10">When there are no more substitutions to make, the <code class="calibre26">test</code> command doesn't branch and continues with the rest of the script.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-278" class="calibre4"></a>Replacing via a Pattern</h2>
<p class="calibre10">You've seen how to use patterns in the <code class="calibre26">sed</code> commands to replace text in the data stream. However, when using wildcard characters it's not easy to know exactly what text will match the pattern.</p>
<p class="calibre10">For example, say that you want to place double quotation marks around a word you match in a line. That's simple enough if you're just looking for one word in the pattern to match:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "The cat sleeps in his hat." | sed 's/cat/"cat"/'</b></code>
The "cat" sleeps in his hat.
$</code></pre>
<p class="calibre10">But what if you use a wildcard character (.) in the pattern to match more than one word?</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "The cat sleeps in his hat." | sed 's/.at/".at"/g'</b></code>
The ".at" sleeps in his ".at".
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="576" id="calibre_link-907" class="calibre11"></span>The substitution string used the dot wildcard character to match any occurrence of a letter followed by âatâ. Unfortunately, the replacement string doesn't match the wildcard character value of the matching word.</p>
<section class="toclist">
<h3 class="calibre15">Using the ampersand</h3>
<p class="calibre10">The <code class="calibre26">sed</code> editor has a solution for you. The ampersand symbol (<code class="calibre26">&amp;</code>) is used to represent the matching pattern in the <code class="calibre26">substitution</code> command. Whatever text matches the pattern defined, you can use the ampersand symbol to recall it in the replacement pattern. This lets you manipulate whatever word matches the pattern defined:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "The cat sleeps in his hat." | sed 's/.at/"&amp;"/g'</b></code>
The "cat" sleeps in his "hat".
$</code></pre>
<p class="calibre10">When the pattern matches the word cat, âcatâ appears in the substituted word. When it matches the word hat, âhatâ appears in the substituted word.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Replacing individual words</h3>
<p class="calibre10">The ampersand symbol retrieves the entire string that matches the pattern you specify in the <code class="calibre26">substitution</code> command. Sometimes, you'll only want to retrieve a subset of the string. You can do that, too, but it's a little tricky.</p>
<p class="calibre10">The <code class="calibre26">sed</code> editor uses parentheses to define a substring component within the substitution pattern. You can then reference each substring component using a special character in the replacement pattern. The replacement character consists of a backslash and a number. The number indicates the substring component's position. The <code class="calibre26">sed</code> editor assigns the first component the character <code class="calibre26">â1</code>, the second component the character <code class="calibre26">â2</code>, and so on.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">When you use parentheses in the <code class="calibre26">substitution</code> command, you must use the escape character to identify them as grouping characters and not normal parentheses. This is the reverse of when you escape other special characters.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Look at an example of using this feature in a <code class="calibre26">sed</code> editor script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "The System Administrator manual" | sed '</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/\(System\) Administrator/\1 User/'</b></code>
The System User manual
$</code></pre>
<p class="calibre10">This <code class="calibre26">substitution</code> command uses one set of parentheses around the word <code class="calibre26">System</code> identifying it as a substring component. It then uses the <code class="calibre26">â1</code> in the replacement pattern to recall the first identified component. This isn't too exciting, but it can really be useful when working with wildcard patterns.</p>
<p class="calibre10"><span type="pagebreak" title="577" id="calibre_link-908" class="calibre11"></span>If you need to replace a phrase with just a single word, that's a substring of the phrase, but that substring just happens to be using a wildcard character; using substring components is a lifesaver:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "That furry cat is pretty" | sed 's/furry \(.at\)/\1/'</b></code>
That cat is pretty
$
$ <code class="calibre26"><b class="calibre21">echo "That furry hat is pretty" | sed 's/furry \(.at\)/\1/'</b></code>
That hat is pretty
$</code></pre>
<p class="calibre10">In this situation, you can't use the ampersand symbol, because it would replace the entire matching pattern. The substring component provides the answer, allowing you to select just which part of the pattern to use as the replacement pattern.</p>
<p class="calibre10">This feature can be especially helpful when you need to insert text between two or more substring components. Here's a script that uses substring components to insert a comma in long numbers:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "1234567" | sed '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">s/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/</b></code>
&gt; <code class="calibre26"><b class="calibre21">t start</b></code>
&gt; <code class="calibre26"><b class="calibre21">}'</b></code>
1,234,567
$</code></pre>
<p class="calibre10">The script divides the matching pattern into two components:</p>
<pre class="calibre29"><code class="calibre26">.*[0-9]
[0-9]{3}</code></pre>
<p class="calibre10">This pattern looks for two substrings. The first substring is any number of characters, ending in a digit. The second substring is a series of three digits (see Chapter 20 for information about how to use braces in a regular expression). If this pattern is found in the text, the replacement text puts a comma between the two components, each identified by its component position. The script uses the <code class="calibre26">test</code> command to iterate through the number until all commas have been placed.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-279" class="calibre4"></a>Placing sed Commands in Scripts</h2>
<p class="calibre10">Now that you've seen the various parts of the <code class="calibre26">sed</code> editor, it's time to put them together and use them in your shell scripts. This section demonstrates some of the features that you should know about when using the <code class="calibre26">sed</code> editor in your bash shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Using wrappers</h3>
<p class="calibre10"><span type="pagebreak" title="578" id="calibre_link-909" class="calibre11"></span>You may have noticed that trying to implement a <code class="calibre26">sed</code> editor script can be cumbersome, especially if the script is long. Instead of having to retype the entire script each time you want to use it, you can place the <code class="calibre26">sed</code> editor command in a shell script <code class="calibre26"><i class="calibre12">wrapper</i></code>. The wrapper acts as a go-between for the <code class="calibre26">sed</code> editor script and the command line.</p>
<p class="calibre10">Once inside the shell script, you can use normal shell variables and parameters with your <code class="calibre26">sed</code> editor scripts. Here's an example of using the command line parameter variable as the input to a <code class="calibre26">sed</code> script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat reverse.sh</b></code>
#!/bin/bash
# Shell wrapper for sed editor script.
#               to reverse text file lines.
#
sed -n '{ 1!G ; h ; $p }' $1
#
$</code></pre>
<p class="calibre10">The shell script called <code class="calibre26">reverse</code> uses the <code class="calibre26">sed</code> editor script to reverse text lines in a data stream. It uses the <code class="calibre26">$1</code> shell parameter to retrieve the first parameter from the command line, which should be the name of the file to reverse:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./reverse.sh data2.txt</b></code>
This is the last line.
This is the second data line.
This is the first data line.
This is the header line.
$</code></pre>
<p class="calibre10">Now you can easily use the <code class="calibre26">sed</code> editor script on any file, without having to constantly retype the entire command line.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Redirecting sed output</h3>
<p class="calibre10">By default, the <code class="calibre26">sed</code> editor outputs the results of the script to <code class="calibre26">STDOUT</code>. You can employ all the standard methods of redirecting the output of the <code class="calibre26">sed</code> editor in your shell scripts.</p>
<p class="calibre10">You can use dollar sign/parenthesis, <code class="calibre26">$()</code>, to redirect the output of your <code class="calibre26">sed</code> editor command to a variable for use later in the script. The following is an example of using the <code class="calibre26">sed</code> script to add commas to the result of a numeric computation:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat fact.sh</b></code>
#!/bin/bash
# Add commas to number in factorial answer
#
factorial=1
counter=1
number=$1
#
while [ $counter -le $number ]
do
   factorial=$[ $factorial * $counter ]
   counter=$[ $counter + 1 ]
done
#
result=$(echo $factorial | sed '{
:start
s/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/
t start
}')
#
echo "The result is $result"
#
$
$ <code class="calibre26"><b class="calibre21">./fact.sh 20</b></code>
The result is 2,432,902,008,176,640,000
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="579" id="calibre_link-910" class="calibre11"></span>After you use the normal factorial calculation script, the result of that script is used as the input to the <code class="calibre26">sed</code> editor script, which adds commas. This value is then used in the <code class="calibre26">echo</code> statement to produce the result.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-280" class="calibre4"></a>Creating sed Utilities</h2>
<p class="calibre10">As you've seen in the short examples presented so far in this chapter, you can do lots of cool data-formatting things with the <code class="calibre26">sed</code> editor. This section shows a few handy well-known <code class="calibre26">sed</code> editor scripts for performing common data-handling functions.</p>
<section class="toclist">
<h3 class="calibre15">Spacing with double lines</h3>
<p class="calibre10">To start things off, look at a simple <code class="calibre26">sed</code> script to insert a blank line between lines in a text file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 'G' data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="580" id="calibre_link-911" class="calibre11"></span>That was pretty simple! The key to this trick is the default value of the hold space. Remember that the <code class="calibre26">G</code> command simply appends the contents of the hold space to the current pattern space contents. When you start the <code class="calibre26">sed</code> editor, the hold space contains an empty line. By appending that to an existing line, you create a blank line after the existing line.</p>
<p class="calibre10">You may have noticed that this script also adds a blank line to the last line in the data stream, producing a blank line at the end of the file. If you want to get rid of this, you can use the negate symbol and the last line symbol to ensure that the script doesn't add the blank line to the last line of the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '$!G' data2.txt</b></code>
This is the header line.
This is the first data line.
This is the second data line.
This is the last line.
$</code></pre>
<p class="calibre10">Now that looks a little better. As long as the line isn't the last line, the <code class="calibre26">G</code> command appends the contents of the hold space. When the <code class="calibre26">sed</code> editor gets to the last line, it skips the <code class="calibre26">G</code> command.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Spacing files that may have blanks</h3>
<p class="calibre10">To take double spacing one step further, what if the text file already has a few blank lines, but you want to double space all the lines? If you use the previous script, you'll get some areas that have too many blank lines, because each existing blank line gets doubled:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data6.txt</b></code>
This is line one.
This is line two.
This is line three.
This is line four.
$
$ <code class="calibre26"><b class="calibre21">sed '$!G' data6.txt</b></code>
This is line one.
This is line two.
This is line three.
This is line four.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="581" id="calibre_link-912" class="calibre11"></span>Now you have three blank lines where the original blank line was located. The solution to this problem is to first delete any blank lines from the data stream and then use the <code class="calibre26">G</code> command to insert new blank lines after all the lines. To delete existing blank lines, you just need to use the <code class="calibre26">d</code> command with a pattern that matches a blank line:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">/â§$/d</b></code></code></pre>
<p class="calibre10">This pattern uses the start line tag (the caret) and the end line tag (the dollar sign). Adding this pattern to the script produces the desired results:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '/â§$/d ; $!G' data6.txt</b></code>
This is line one.
This is line two.
This is line three.
This is line four.
$</code></pre>
<p class="calibre10">Perfect! It works just as expected.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Numbering lines in a file</h3>
<p class="calibre10">Chapter 19 showed you how to use the equal sign to display the line numbers of lines in the data stream:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '=' data2.txt</b></code>
1
This is the header line.
2
This is the first data line.
3
This is the second data line.
4
This is the last line.
$</code></pre>
<p class="calibre10">This can be a little awkward to read, because the line number is on a line above the actual line in the data stream. A better solution is to place the line number on the same line as the text.</p>
<p class="calibre10">Now that you've seen how to combine lines using the <code class="calibre26">N</code> command, it shouldn't be too hard to utilize that information in the <code class="calibre26">sed</code> editor script. The trick to this utility, however, is that you can't combine the two commands in the same script.</p>
<p class="calibre10"><span type="pagebreak" title="582" id="calibre_link-913" class="calibre11"></span>After you have the output for the equal sign command, you can pipe the output to another <code class="calibre26">sed</code> editor script that uses the <code class="calibre26">N</code> command to combine the two lines. You also need to use the <code class="calibre26">substitution</code> command to replace the newline character with either a space or a tab character. Here's what the final solution looks like:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed '=' data2.txt | sed 'N; s/\n/ /'</b></code>
1 This is the header line.
2 This is the first data line.
3 This is the second data line.
4 This is the last line.
$</code></pre>
<p class="calibre10">Now that looks much better. This is a great little utility to have around when working on programs where you need to see the line numbers used in error messages.</p>
<p class="calibre10">There are bash shell commands that can also add line numbers. However, they add some additional (and potentially unwanted spacing):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">nl data2.txt</b></code>
     1  This is the header line.
     2  This is the first data line.
     3  This is the second data line.
     4  This is the last line.
$
$ <code class="calibre26"><b class="calibre21">cat -n data2.txt</b></code>
     1  This is the header line.
     2  This is the first data line.
     3  This is the second data line.
     4  This is the last line.
$</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor script handles the output without any additional spacing.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Printing last lines</h3>
<p class="calibre10">So far, you've seen how to use the <code class="calibre26">p</code> command to print all the lines in a data stream or just lines that match a specific pattern. What if you just need to work with the last few lines of a long listing, such as a log file?</p>
<p class="calibre10">The dollar sign represents the last line of a data stream, so it's easy to display just the last line:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed -n '$p' data2.txt</b></code>
This is the last line.
$</code></pre>
<p class="calibre10">Now how can you use the dollar sign symbol to display a set number of lines at the end of the data stream? The answer is to create a <i class="calibre12">rolling window</i>.</p>
<p class="calibre10"><span type="pagebreak" title="583" id="calibre_link-914" class="calibre11"></span>A rolling window is a common way to examine blocks of text lines in the pattern space by combining them using the <code class="calibre26">N</code> command. The <code class="calibre26">N</code> command appends the next line of text to the text already in the pattern space. After you have a block of 10 text lines in the pattern space, you can check to see if you're at the end of the data stream using the dollar sign. If you're not at the end, continue adding more lines to the pattern space, while removing the original lines (remember the <code class="calibre26">D</code> command, which deletes the first line in the pattern space).</p>
<p class="calibre10">By looping through the <code class="calibre26">N</code> and <code class="calibre26">D</code> commands, you add new lines to the block of lines in the pattern space while removing old lines. The <code class="calibre26">branch</code> command is the perfect fit for the loop. To end the loop, just identify the last line and use the <code class="calibre26">q</code> command to quit.</p>
<p class="calibre10">Here's what the final <code class="calibre26">sed</code> editor script looks like:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data7.txt</b></code>
This is line 1.
This is line 2.
This is line 3.
This is line 4.
This is line 5.
This is line 6.
This is line 7.
This is line 8.
This is line 9.
This is line 10.
This is line 11.
This is line 12.
This is line 13.
This is line 14.
This is line 15.
$
$ <code class="calibre26"><b class="calibre21">sed '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">$q ; N ; 11,$D</b></code>
&gt; <code class="calibre26"><b class="calibre21">b start</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' data7.txt</b></code>
This is line 6.
This is line 7.
This is line 8.
This is line 9.
This is line 10.
This is line 11.
This is line 12.
This is line 13.
This is line 14.
This is line 15.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="584" id="calibre_link-915" class="calibre11"></span>The script first checks whether the line is the last line in the data stream. If it is, the <code class="calibre26">quit</code> command stops the loop. The <code class="calibre26">N</code> command appends the next line to the current line in the pattern space. The <code class="calibre26">11,$D</code> command deletes the first line in the pattern space if the current line is after line 10. This creates the sliding window effect in the pattern space. Thus, the <code class="calibre26">sed</code> program script displays only the last 10 lines of the <code class="calibre26">data7.txt</code> file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Deleting lines</h3>
<p class="calibre10">Another useful utility for the <code class="calibre26">sed</code> editor is to remove unwanted blank lines in a data stream. It's easy to remove all the blank lines from a data stream, but it takes a little ingenuity to selectively remove blank lines. This section shows you a couple of quick <code class="calibre26">sed</code> editor scripts that you can use to help remove unwanted blank lines from your data.</p>
<section class="toclist">
<h4 class="calibre25">Deleting consecutive blank lines</h4>
<p class="calibre10">It can be a nuisance when extra blank lines crop up in data files. Often you have a data file that contains blank lines, but sometimes a data line is missing and produces too many blank lines (as you saw in the double-spacing example earlier).</p>
<p class="calibre10">The easiest way to remove consecutive blank lines is to check the data stream using a range address. Chapter 19 showed you how to use ranges in addresses, including how to incorporate patterns in the address range. The <code class="calibre26">sed</code> editor executes the command for all lines that match within the specified address range.</p>
<p class="calibre10">The key to removing consecutive blank lines is to create an address range that includes a non-blank line and a blank line. If the <code class="calibre26">sed</code> editor comes across this range, it shouldn't delete the line. However, for lines that don't match that range (two or more blank lines in a row), it should delete the lines.</p>
<p class="calibre10">Here's the script to do this:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">/./,/â§$/!d</b></code></code></pre>
<p class="calibre10">The range is /./ to <code class="calibre26">/</code>â§$/. The start address in the range matches any line that contains at least one character. The end address in the range matches a blank line. Lines within this range aren't deleted.</p>
<p class="calibre10">Here's the script in action:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data8.txt</b></code>
This is line one.
This is line two.
This is line three.
This is line four.
$
$ <code class="calibre26"><b class="calibre21">sed '/./,/â§$/!d' data8.txt</b></code>
This is line one.
This is line two.
This is line three.
This is line four.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="585" id="calibre_link-916" class="calibre11"></span>No matter how many blank lines appear between lines of data in the file, the output places only one blank line between the lines.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Deleting leading blank lines</h4>
<p class="calibre10">It is also a nuisance when data files contain multiple blank lines at the start of the file. Often when you are trying to import data from a text file into a database, the blank lines create null entries, throwing off any calculations using the data.</p>
<p class="calibre10">Removing blank lines from the top of a data stream is not a difficult task. Here's the script that accomplishes that function:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">/./,$!d</b></code></code></pre>
<p class="calibre10">The script uses an address range to determine what lines are deleted. The range starts with a line that contains a character and continues to the end of the data stream. Any line within this range is not deleted from the output. This means that any lines before the first line that contain a character are deleted.</p>
<p class="calibre10">Look at this simple script in action:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data9.txt</b></code>
This is line one.
This is line two.
$
$ <code class="calibre26"><b class="calibre21">sed '/./,$!d' data9.txt</b></code>
This is line one.
This is line two.
$</code></pre>
<p class="calibre10">The test file contains two blank lines before the data lines. The script successfully removes both of the leading blank lines, while keeping the blank line within the data intact.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Deleting trailing blank lines</h4>
<p class="calibre10"><span type="pagebreak" title="586" id="calibre_link-917" class="calibre11"></span>Unfortunately, deleting trailing blank lines is not as simple as deleting leading blank lines. Just like printing the end of a data stream, deleting blank lines at the end of a data stream requires a little ingenuity and looping.</p>
<p class="calibre10">Before we start the discussion, let's see what the script looks like:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">sed '{</b></code>
<code class="calibre26"><b class="calibre21">:start</b></code>
<code class="calibre26"><b class="calibre21">/</b></code>â§\<code class="calibre26"><b class="calibre21">n*$/{$d; N; b start }</b></code>
<code class="calibre26"><b class="calibre21">}'</b></code></code></pre>
<p class="calibre10">This may look a little odd to you at first. Notice that there are braces within the normal script braces. This allows you to group commands together within the overall command script. The group of commands applies to the specified address pattern. The address pattern matches any line that contains only a newline character. When one is found, if it's the last line, the <code class="calibre26">delete</code> command deletes it. If it's not the last line, the <code class="calibre26">N</code> command appends the next line to it, and the <code class="calibre26">branch</code> command loops to the beginning to start over.</p>
<p class="calibre10">Here's the script in action:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data10.txt</b></code>
This is the first line.
This is the second line.
$ <code class="calibre26"><b class="calibre21">sed '{</b></code>
&gt; <code class="calibre26"><b class="calibre21">:start</b></code>
&gt; <code class="calibre26"><b class="calibre21">/â§\n*$/{$d ; N ; b start }</b></code>
&gt; <code class="calibre26"><b class="calibre21">}' data10.txt</b></code>
This is the first line.
This is the second line.
$</code></pre>
<p class="calibre10">The script successfully removed the blank lines from the end of the text file.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Removing HTML tags</h3>
<p class="calibre10">These days, it's not uncommon to download text from a website to save or use as data in an application. Sometimes, however, when you download text from the website, you also get the HTML tags used to format the data. This can be a problem when all you want to see is the data.</p>
<p class="calibre10">A standard HTML <span type="pagebreak" title="587" id="calibre_link-918" class="calibre11"></span>web page contains several different types of HTML tags, identifying formatting features required to properly display the page information. Here's a sample of what an HTML file looks like:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat data11.txt</b></code>
&lt;html&gt;
&lt;head&gt;
&lt;title type="main"&gt;This is the page title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;
This is the &lt;b&gt;first&lt;/b&gt; line in the Web page.
This should provide some &lt;i&gt;useful&lt;/i&gt;
information to use in our sed script.
&lt;/body&gt;
&lt;/html&gt;
$</code></pre>
<p class="calibre10">HTML tags are identified by the less-than and greater-than symbols. Most HTML tags come in pairs. One tag starts the formatting process (for example, <code class="calibre26">&lt;b&gt;</code> for bolding), and another tag stops the formatting process (for example, <code class="calibre26">&lt;/b&gt;</code> to turn off bolding).</p>
<p class="calibre10">Removing HTML tags creates a problem, however, if you're not careful. At first glance, you'd think that the way to remove HTML tags would be to just look for a text string that starts with a less-than symbol (&lt;), ends with a greater-than symbol (&gt;), and has data in between the symbols:</p>
<pre class="calibre29"><code class="calibre26"> <code class="calibre26"><b class="calibre21">s/&lt;.*&gt;//g</b></code></code></pre>
<p class="calibre10">Unfortunately, this command has some unintended consequences:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/&lt;.*&gt;//g' data11.txt</b></code>
This is the  line in the Web page.
This should provide some
information to use in our sed script.
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="588" id="calibre_link-919" class="calibre11"></span>Notice that the title text is missing, along with the text that was bolded and italicized. The <code class="calibre26">sed</code> editor literally interpreted the script to mean any text between the less-than and greater-than sign, including other less-than and greater-than signs! Each time the text was enclosed in HTML tags (such as <code class="calibre26">&lt;b&gt;first&lt;/b&gt;</code>), the <code class="calibre26">sed</code> script removed the entire text.</p>
<p class="calibre10">The solution to this problem is to have the <code class="calibre26">sed</code> editor ignore any embedded greater-than signs between the original tags. To do that, you can create a character class that negates the greater-than sign. This changes the script to:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">s/&lt;[â§&gt;]*&gt;//g</b></code></code></pre>
<p class="calibre10">This script now works properly, displaying the data you need to see from the web page HTML code:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/&lt;[â§&gt;]*&gt;//g' data11.txt</b></code>
This is the page title
This is the first line in the Web page.
This should provide some useful
information to use in our sed script.
$</code></pre>
<p class="calibre10">That's a little better. To clean things up some, you can add a <code class="calibre26">delete</code> command to get rid of those pesky blank lines:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sed 's/&lt;[â§&gt;]*&gt;//g ; /â§$/d' data11.txt</b></code>
This is the page title
This is the first line in the Web page.
This should provide some useful
information to use in our sed script.
$</code></pre>
<p class="calibre10">Now that's much more compact; there's only the data you need to see.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-281" class="calibre4"></a>Summary</h2>
<p class="calibre10">The <code class="calibre26">sed</code> editor provides some advanced features that allow you to work with text patterns across multiple lines. This chapter showed you how to use the <code class="calibre26">next</code> command to retrieve the next line in a data stream and place it in the pattern space. Once in the pattern space, you can perform complex <code class="calibre26">substitution</code> commands to replace phrases that span more than one line of text.</p>
<p class="calibre10">The multiline <code class="calibre26">delete</code> command allows you to remove the first line when the pattern space <span type="pagebreak" title="589" id="calibre_link-920" class="calibre11"></span>contains two or more lines. This is a convenient way to iterate through multiple lines in the data stream. Similarly, the multiline <code class="calibre26">print</code> command allows you to print just the first line when the pattern space contains two or more lines of text. The combination of the multiline commands allows you to iterate through the data stream and create a multiline substitution system.</p>
<p class="calibre10">Next, we covered the hold space. The hold space allows you to set aside a line of text while processing more lines of text. You can recall the contents of the hold space at any time and either replace the text in the pattern space or append the contents of the hold space to the text in the pattern space. Using the hold space allows you to sort through data streams, reversing the order of text lines as they appear in the data.</p>
<p class="calibre10">Next we reviewed the various <code class="calibre26">sed</code> editor flow control commands. The <code class="calibre26">branch</code> command provides a way for you to alter the normal flow of <code class="calibre26">sed</code> editor commands in the script, creating loops or skipping commands under certain conditions. The <code class="calibre26">test</code> command provides an <code class="calibre26">if-then</code> type of statement for your <code class="calibre26">sed</code> editor command scripts. The <code class="calibre26">test</code> command branches only if a prior <code class="calibre26">substitution</code> command succeeds in replacing text in a line.</p>
<p class="calibre10">The chapter concluded with a discussion of how to use <code class="calibre26">sed</code> scripts in your shell scripts. A common technique for large <code class="calibre26">sed</code> scripts is to place the script in a shell wrapper. You can use command line parameter variables within the <code class="calibre26">sed</code> script to pass shell command line values. This creates an easy way to utilize your <code class="calibre26">sed</code> editor scripts directly from the command line, or even from other shell scripts.</p>
<p class="calibre10">The next chapter digs deeper into the <code class="calibre26">gawk</code> world. The <code class="calibre26">gawk</code> program supports many features of higher-level programming languages. You can create some pretty involved data manipulation and reporting programs just by using <code class="calibre26">gawk</code>. The chapter describes the various programming features and demonstrates how to use them to generate your own fancy reports from simple data.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-93">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-282" class="calibre4"></a><span class="chaptertitle">Chapter 22</span><br class="calibre22" /><span class="chaptertitle">Advanced gawk</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Reexamining gawk</li>
<li class="calibre7">Using variables in gawk</li>
<li class="calibre7">Using structured commands</li>
<li class="calibre7">Formatting your printing</li>
<li class="calibre7">Working with functions</li>
</ol>
<p class="calibre19">Chapter 19 introduced the <code class="calibre26">gawk</code> program and demonstrated the basics of using it to produce formatted <span type="pagebreak" title="591" id="calibre_link-921" class="calibre11"></span>reports from raw data files. This chapter dives more deeply into customizing <code class="calibre26">gawk</code> to produce reports. The <code class="calibre26">gawk</code> program is a full-fledged programming language, providing features that allow you to write advanced programs to manipulate data. If you are jumping into the shell script world from another programming language, you should feel right at home with <code class="calibre26">gawk</code>. In this chapter, you'll see how to use the <code class="calibre26">gawk</code> programming language to write programs to handle just about any data-formatting task you'll run into.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-283" class="calibre4"></a>Using Variables</h2>
<p class="calibre10">One important feature of any programming language is the ability to store and recall values using variables. The <code class="calibre26">gawk</code> programming language supports two different types of variables:</p>
<ul class="calibre14">
<li class="calibre7">Built-in variables</li>
<li class="calibre7">User-defined variables</li>
</ul>
<p class="calibre10">Several built-in variables are available for you to use in <code class="calibre26">gawk</code>. The built-in variables contain information used in handling the data fields and records in the data file. You can also create your own variables in your <code class="calibre26">gawk</code> programs. The following sections walk you through how to use variables in your <code class="calibre26">gawk</code> programs.</p>
<section class="toclist">
<h3 class="calibre15">Built-in variables</h3>
<p class="calibre10">The <code class="calibre26">gawk</code> program uses built-in <span type="pagebreak" title="592" id="calibre_link-922" class="calibre11"></span>variables to reference specific features within the program data. This section describes the built-in variables available for you to use in your <code class="calibre26">gawk</code> programs and demonstrates how to use them.</p>
<section class="toclist">
<h4 class="calibre25">The field and record separator variables</h4>
<p class="calibre10">Chapter 19 demonstrated one type of built-in variable available in <code class="calibre26">gawk</code>: the <span class="chaptertitle"><i class="calibre12">data field variables.</i></span> The data field variables allow you to reference individual data fields within a data record using a dollar sign and the numerical position of the data field in the record. Thus, to reference the first data field in the record, you use the <code class="calibre26">$1</code> variable. To reference the second data field, you use the <code class="calibre26">$2</code> variable, and so on.</p>
<p class="calibre10">Data fields are delineated by a field separator character. By default, the field separator character is a whitespace character, such as a space or a tab. Chapter 19 showed how to change the field separator character either on the command line by using the <code class="calibre26">-F</code> command line parameter or within the <code class="calibre26">gawk</code> program using the special <code class="calibre26">FS</code> built-in variable.</p>
<p class="calibre10">The <code class="calibre26">FS</code> built-in variable belongs to a group of built-in variables that control how <code class="calibre26">gawk</code> handles fields and records in both input data and output data. <a id="calibre_link-1250" href="#calibre_link-1157" class="calibre4">Table 22.1</a> lists the built-in variables contained in this group.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1157" href="#calibre_link-1250" class="calibre4"><b class="calibre21">Table 22.1</b></a></span> The gawk Data Field and Record Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FIELDWIDTHS</code></td>
<td class="left">A space-separated list of numbers defining the exact width (in spaces) of each data field</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FS</code></td>
<td class="left">Input field separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RS</code></td>
<td class="left">Input record separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OFS</code></td>
<td class="left">Output field separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ORS</code></td>
<td class="left">Output record separator character</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">FS</code> and <code class="calibre26">OFS</code> variables define how your <code class="calibre26">gawk</code> program handles data fields in the data stream. You've already seen how to use the <code class="calibre26">FS</code> variable to define what character separates data fields in a record. The <code class="calibre26">OFS</code> variable performs the same function but for the output by using the <code class="calibre26">print</code> command.</p>
<p class="calibre10">By default, <code class="calibre26">gawk</code> sets the <code class="calibre26">OFS</code> variable to a space, so when you use the command:</p>
<pre class="calibre29"><code class="calibre26">print $1,$2,$3</code></pre>
<p class="calibre10">you see the output as:</p>
<pre class="calibre29"><code class="calibre26">field1 field2 field3</code></pre>
<p class="calibre10">You can see this in the following example:</p>
<pre class="calibre29"><code class="calibre26">$ cat data1
data11,data12,data13,data14,data15
data21,data22,data23,data24,data25
data31,data32,data33,data34,data35
$ gawk 'BEGIN{FS=","} {print $1,$2,$3}' data1
data11 data12 data13
data21 data22 data23
data31 data32 data33
$</code></pre>
<p class="calibre10">The <code class="calibre26">print</code> command <span type="pagebreak" title="593" id="calibre_link-923" class="calibre11"></span>automatically places the value of the <code class="calibre26">OFS</code> variable between each data field in the output. By setting the <code class="calibre26">OFS</code> variable, you can use any string to separate data fields in the output:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","; OFS="-"} {print $1,$2,$3}' data1
data11-data12-data13
data21-data22-data23
data31-data32-data33
$ gawk 'BEGIN{FS=","; OFS="--"} {print $1,$2,$3}' data1
data11--data12--data13
data21--data22--data23
data31--data32--data33
$ gawk 'BEGIN{FS=","; OFS="&lt;--&gt;"} {print $1,$2,$3}' data1
data11&lt;--&gt;data12&lt;--&gt;data13
data21&lt;--&gt;data22&lt;--&gt;data23
data31&lt;--&gt;data32&lt;--&gt;data33
$</code></pre>
<p class="calibre10">The <code class="calibre26">FIELDWIDTHS</code> variable allows you to read records without using a field separator character. In some applications, instead of using a field separator character, data is placed in specific columns within the record. In these instances, you must set the <code class="calibre26">FIELDWIDTHS</code> variable to match the layout of the data in the records.</p>
<p class="calibre10">After you set the <code class="calibre26">FIELDWIDTHS</code> variable, <code class="calibre26">gawk</code> ignores the <code class="calibre26">FS</code> and calculates data fields based on the provided field width sizes. Here's an example using field widths instead of field separator characters:</p>
<pre class="calibre29"><code class="calibre26">$ cat data1b
1005.3247596.37
115-2.349194.00
05810.1298100.1
$ gawk 'BEGIN{FIELDWIDTHS="3 5 2 5"}{print $1,$2,$3,$4}' data1b
100 5.324 75 96.37
115 -2.34 91 94.00
058 10.12 98 100.1
$</code></pre>
<p class="calibre10">The <code class="calibre26">FIELDWIDTHS</code> variable defines four data fields, and <code class="calibre26">gawk</code> parses the data record accordingly. The string <span type="pagebreak" title="594" id="calibre_link-924" class="calibre11"></span>of numbers in each record is split based on the defined field width values.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">It's important to remember that after you set the <code class="calibre26">FIELDWIDTHS</code> variable, those values must remain constant. This method can't accommodate variable-length data fields.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">RS</code> and <code class="calibre26">ORS</code> variables define how your <code class="calibre26">gawk</code> program handles records in the data stream. By default, <code class="calibre26">gawk</code> sets the <code class="calibre26">RS</code> and <code class="calibre26">ORS</code> variables to the newline character. The default <code class="calibre26">RS</code> variable value indicates that each new line of text in the input data stream is a new record.</p>
<p class="calibre10">Sometimes, you run into situations where data fields are spread across multiple lines in the data stream. A classic example of this is data that includes an address and phone number, each on a separate line:</p>
<pre class="calibre29"><code class="calibre26">Riley Mullen
123 Main Street
Chicago, IL 60601
(312)555-1234</code></pre>
<p class="calibre10">If you try to read this data using the default <code class="calibre26">FS</code> and <code class="calibre26">RS</code> variable values, <code class="calibre26">gawk</code> reads each line as a separate record and interprets each space in the record as a field separator. This isn't what you intended.</p>
<p class="calibre10">To solve this problem, you need to set the <code class="calibre26">FS</code> variable to the newline character. This indicates that each line in the data stream is a separate field and all the data on a line belongs to the data field. However, when you do that, you don't know where a new record starts.</p>
<p class="calibre10">To solve this problem, set the <code class="calibre26">RS</code> variable to an empty string, and leave a blank line between data records in the data stream. The <code class="calibre26">gawk</code> program interprets each blank line as a record separator.</p>
<p class="calibre10">The following is an example of using this technique:</p>
<pre class="calibre29"><code class="calibre26">$ cat data2
Riley Mullen
123 Main Street
Chicago, IL  60601
(312)555-1234
Frank Williams
456 Oak Street
Indianapolis, IN  46201
(317)555-9876
Haley Snell
4231 Elm Street
Detroit, MI 48201
(313)555-4938
$ gawk 'BEGIN{FS="\n"; RS=""} {print $1,$4}' data2
Riley Mullen (312)555-1234
Frank Williams (317)555-9876
Haley Snell (313)555-4938
$</code></pre>
<p class="calibre10">Perfect! The <code class="calibre26">gawk</code> program interpreted each line in the file as a data field and the blank lines as record separators.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Data variables</h4>
<p class="calibre10">Besides the field and record separator variables, <code class="calibre26">gawk</code> provides some other built-in variables to help you know what's going on with <span type="pagebreak" title="595" id="calibre_link-925" class="calibre11"></span>your data and extract information from the shell environment. <a id="calibre_link-1251" href="#calibre_link-1158" class="calibre4">Table 22.2</a> shows the other built-in variables in <code class="calibre26">gawk</code>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1158" href="#calibre_link-1251" class="calibre4"><b class="calibre21">Table 22.2</b></a></span> More gawk Built-In Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGC</code></td>
<td class="left">The number of command line parameters present</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGIND</code></td>
<td class="left">The index in ARGV of the current file being processed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGV</code></td>
<td class="left">An array of command line parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">CONVFMT</code></td>
<td class="left">The conversion format for numbers (see the <code class="calibre26">printf</code> statement), with a default value of <code class="calibre26">%.6 g</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ENVIRON</code></td>
<td class="left">An associative array of the current shell environment variables and their values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ERRNO</code></td>
<td class="left">The system error if an error occurs when reading or closing input files</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FILENAME</code></td>
<td class="left">The filename of the data file used for input to the <code class="calibre26">gawk</code> program</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FNR</code></td>
<td class="left">The current record number in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">IGNORECASE</code></td>
<td class="left">If set to a non-zero value, ignores the case of characters in strings used in the <code class="calibre26">gawk</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">NF</code></td>
<td class="left">The total number of data fields in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">NR</code></td>
<td class="left">The number of input records processed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OFMT</code></td>
<td class="left">The output format for displaying numbers, with a default of <code class="calibre26">%.6 g</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RLENGTH</code></td>
<td class="left">The length of the substring matched in the <code class="calibre26">match</code> function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RSTART</code></td>
<td class="left">The start index of the substring matched in the <code class="calibre26">match</code> function</td>
</tr>
</table>
</figure>
<p class="calibre10">You should recognize a few of these variables from your shell script programming. The <code class="calibre26">ARGC</code> and <code class="calibre26">ARGV</code> variables allow you to retrieve the number of command line parameters and their values <span type="pagebreak" title="596" id="calibre_link-926" class="calibre11"></span>from the shell. This can be a little tricky, however, because <code class="calibre26">gawk</code> doesn't count the program script as part of the command line parameters:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{print ARGC,ARGV[1]}' data1
2 data1
$</code></pre>
<p class="calibre10">The <code class="calibre26">ARGC</code> variable indicates that two parameters are on the command line. This includes the <code class="calibre26">gawk</code> command and the <code class="calibre26">data1</code> parameter (remember that the program script doesn't count as a parameter). The <code class="calibre26">ARGV</code> array starts with an index of 0, which represents the command. The first array value is the first command line parameter after the <code class="calibre26">gawk</code> command.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Note that unlike shell variables, when you reference a <code class="calibre26">gawk</code> variable in the script, you don't add a dollar sign before the variable name.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">ENVIRON</code> variable may seem a little odd to you. It uses an <i class="calibre12">associative array</i> to retrieve shell environment variables. An associative array uses text for the array index values instead of numeric values.</p>
<p class="calibre10">The text in the array index is the shell environment variable. The value of the array is the value of the shell environment variable. The following is an example of this:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; BEGIN{
&gt; print ENVIRON["HOME"]
&gt; print ENVIRON["PATH"]
&gt; }'
/home/rich
/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin
$</code></pre>
<p class="calibre10">The <code class="calibre26">ENVIRON[âHOMEâ]</code> variable retrieves the <code class="calibre26">HOME</code> environment variable value from the shell. Likewise, the <code class="calibre26">ENVIRON[âPATHâ]</code> variable retrieves the <code class="calibre26">PATH</code> environment variable value. You can use this technique to retrieve any environment variable value from the shell to use in your <code class="calibre26">gawk</code> programs.</p>
<p class="calibre10">The <code class="calibre26">FNR</code>, <code class="calibre26">NF</code>, and <code class="calibre26">NR</code> variables come in handy when you're trying to keep track of data fields and records in your <code class="calibre26">gawk</code> program. Sometimes, you're in a situation where you don't know exactly how many data fields are in a record. The <code class="calibre26">NF</code> variable allows you to specify the last data field in the record without having to know its position:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=":"; OFS=":"} {print $1,$NF}' /etc/passwd
rich:/bin/bash
testy:/bin/csh
mark:/bin/bash
dan:/bin/bash
mike:/bin/bash
test:/bin/bash
$</code></pre>
<p class="calibre10">The <code class="calibre26">NF</code> variable contains <span type="pagebreak" title="597" id="calibre_link-927" class="calibre11"></span>the numerical value of the last data field in the data file. You can then use it as a data field variable by placing a dollar sign in front of it.</p>
<p class="calibre10">The <code class="calibre26">FNR</code> and <code class="calibre26">NR</code> variables are similar to each other, but slightly different. The <code class="calibre26">FNR</code> variable contains the number of records processed in the current data file. The <code class="calibre26">NR</code> variable contains the total number of records processed. Let's look at a couple of examples to see this difference:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","}{print $1,"FNR="FNR}' data1 data1
data11 FNR=1
data21 FNR=2
data31 FNR=3
data11 FNR=1
data21 FNR=2
data31 FNR=3
$</code></pre>
<p class="calibre10">In this example, the <code class="calibre26">gawk</code> program command line defines two input files. (It specifies the same input file twice.) The script prints the first data field value and the current value of the <code class="calibre26">FNR</code> variable. Notice that the <code class="calibre26">FNR</code> value was reset to 1 when the <code class="calibre26">gawk</code> program processed the second data file.</p>
<p class="calibre10">Now, let's add the <code class="calibre26">NR</code> variable and see what that produces:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; BEGIN {FS=","}
&gt; {print $1,"FNR="FNR,"NR="NR}
&gt; END{print "There were",NR,"records processed"}' data1 data1
data11 FNR=1 NR=1
data21 FNR=2 NR=2
data31 FNR=3 NR=3
data11 FNR=1 NR=4
data21 FNR=2 NR=5
data31 FNR=3 NR=6
There were 6 records processed
$</code></pre>
<p class="calibre10">The <code class="calibre26">FNR</code> variable value was reset when <code class="calibre26">gawk</code> processed the second data file, but the <code class="calibre26">NR</code> variable maintained its count into the second data file. The bottom line is that if you're using only one data file for input, the <code class="calibre26">FNR</code> and <code class="calibre26">NR</code> values are the same. If you're using multiple data files for input, the <code class="calibre26">FNR</code> value is reset for each data file, and the <code class="calibre26">NR</code> value keeps count throughout all the data files.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">When using <code class="calibre26">gawk</code>, notice that the <code class="calibre26">gawk</code> script can often become larger than the rest of your shell script. In the examples in this chapter, for simplicity we just run the <code class="calibre26">gawk</code> scripts directly from the command line, using the multiline feature of the shell. When you use <code class="calibre26">gawk</code> in a shell script, you should place different <code class="calibre26">gawk</code> commands on separate lines. This makes it much easier for you to read and follow, rather than trying to cram it all onto one line in the shell script. Also, if you find yourself using the same <code class="calibre26">gawk</code> scripts in different shell scripts, you can save the <code class="calibre26">gawk</code> script in a separate file and reference it using the <code class="calibre26">&ndash;f</code> parameter (see Chapter 19).</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">User-defined variables</h3>
<p class="calibre10">Just like any other self-respecting programming language, <code class="calibre26">gawk</code> allows you to define your own <span type="pagebreak" title="598" id="calibre_link-928" class="calibre11"></span>variables for use within the program code. A <code class="calibre26">gawk</code> user-defined variable name can be any number of letters, digits, and underscores, but it can't begin with a digit. It is also important to remember that <code class="calibre26">gawk</code> variable names are case sensitive.</p>
<section class="toclist">
<h4 class="calibre25">Assigning variables in scripts</h4>
<p class="calibre10">Assigning values to variables in <code class="calibre26">gawk</code> programs is similar to doing so in a shell script, using an <span class="chaptertitle"><i class="calibre12">assignment statement:</i></span></p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; BEGIN{
&gt; testing="This is a test"
&gt; print testing
&gt; }'
This is a test
$</code></pre>
<p class="calibre10">The output of the <code class="calibre26">print</code> statement is the current value of the <code class="calibre26">testing</code> variable. Like shell script variables, <code class="calibre26">gawk</code> variables can hold either numeric or text values:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; BEGIN{
&gt; testing="This is a test"
&gt; print testing
&gt; testing=45
&gt; print testing
&gt; }'
This is a test
45
$</code></pre>
<p class="calibre10">In this example, the value of the <code class="calibre26">testing</code> variable is changed from a text value to a numeric value.</p>
<p class="calibre10">Assignment statements can also include mathematical algorithms to handle numeric values:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{x=4; x= x * 2 + 3; print x}'
11
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="599" id="calibre_link-929" class="calibre11"></span>As you can see from this example, the <code class="calibre26">gawk</code> programming language includes the standard mathematical operators for processing numerical values. These can include the remainder symbol (%) and the exponentiation symbol (using either â§ or **).</p>
</section>
<section class="toclist">
<h4 class="calibre25">Assigning variables on the command line</h4>
<p class="calibre10">You can also use the <code class="calibre26">gawk</code> command line to assign values to variables for the <code class="calibre26">gawk</code> program. This allows you to set values outside of the normal code, changing values on the fly. Here's an example of using a command line variable to display a specific data field in the file:</p>
<pre class="calibre29"><code class="calibre26">$ cat script1
BEGIN{FS=","}
{print $n}
$ gawk -f script1 n=2 data1
data12
data22
data32
$ gawk -f script1 n=3 data1
data13
data23
data33
$</code></pre>
<p class="calibre10">This feature allows you to change the behavior of the script without necessitating that you change the actual script code. The first example displays the second data field in the file, while the second example displays the third data field, just by setting the value of the <code class="calibre26">n</code> variable in the command line.</p>
<p class="calibre10">There's one problem with using command line parameters to define variable values. When you set the variable, the value isn't available in the <code class="calibre26">BEGIN</code> section of the code:</p>
<pre class="calibre29"><code class="calibre26">$ cat script2
BEGIN{print "The starting value is",n; FS=","}
{print $n}
$ gawk -f script2 n=3 data1
The starting value is
data13
data23
data33
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="600" id="calibre_link-930" class="calibre11"></span>You can solve this using the <code class="calibre26">-v</code> command line parameter. This allows you to specify variables that are set before the <code class="calibre26">BEGIN</code> section of code. The <code class="calibre26">-v</code> command line parameter must be placed before the script code in the command line:</p>
<pre class="calibre29"><code class="calibre26">$ gawk -v n=3 -f script2 data1
The starting value is 3
data13
data23
data33
$</code></pre>
<p class="calibre10">Now the <code class="calibre26">n</code> variable contains the value set in the command line during the <code class="calibre26">BEGIN</code> section of code.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-284" class="calibre4"></a>Working with Arrays</h2>
<p class="calibre10">Many programming languages provide arrays for storing multiple values in a single variable. The <code class="calibre26">gawk</code> programming language provides the array feature using <span class="chaptertitle"><i class="calibre12">associative arrays.</i></span></p>
<p class="calibre10">Associative arrays are different from numerical arrays in that the index value can be any text string. You don't have to use sequential numbers to identify data elements contained in the array. Instead, an associative array consists of a hodge-podge of strings referencing values. Each index string must be unique and uniquely identifies the data element that's assigned to it. If you're familiar with other programming languages, this is the same concept as hash maps or dictionaries.</p>
<p class="calibre10">The following sections walk you through using associative array variables in your <code class="calibre26">gawk</code> programs.</p>
<section class="toclist">
<h3 class="calibre15">Defining array variables</h3>
<p class="calibre10">You can define an array variable using a standard assignment statement. Here's the format of the array variable assignment:</p>
<pre class="calibre29"><code class="calibre26"><i class="calibre12">var</i>[<i class="calibre12">index</i>] = <i class="calibre12">element</i></code></pre>
<p class="calibre10">In this example, <code class="calibre26"><i class="calibre12">var</i></code> is the variable name, <code class="calibre26"><i class="calibre12">index</i></code> is the associative array index value, and <code class="calibre26"><i class="calibre12">element</i></code> is the data element value. Here are some examples of array variables in <code class="calibre26">gawk</code>:</p>
<pre class="calibre29"><code class="calibre26">capital["Illinois"] = "Springfield"
capital["Indiana"] = "Indianapolis"
capital["Ohio"] = "Columbus"</code></pre>
<p class="calibre10">When you reference an array variable, you must include the index value to retrieve the appropriate data element value:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; capital["Illinois"] = "Springfield"
&gt; print capital["Illinois"]
&gt; }'
Springfield
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="601" id="calibre_link-931" class="calibre11"></span>When you reference the array variable, the data element value appears. This also works with numeric data element values:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; var[1] = 34
&gt; var[2] = 3
&gt; total = var[1] + var[2]
&gt; print total
&gt; }'
37
$</code></pre>
<p class="calibre10">As you can see from this example, you can use array variables just as you would any other variable in the <code class="calibre26">gawk</code> program.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Iterating through array variables</h3>
<p class="calibre10">The problem with associative array variables is that you might not have any way of knowing what the index values are. Unlike numeric arrays, which use sequential numbers for index values, an associative array index can be anything.</p>
<p class="calibre10">If you need to iterate through an associate array in <code class="calibre26">gawk</code>, you can use a special format of the <code class="calibre26">for</code> statement:</p>
<pre class="calibre29"><code class="calibre26">for (<i class="calibre12">var</i> in <i class="calibre12">array</i>)
{
  <i class="calibre12">statements</i>
}</code></pre>
<p class="calibre10">The <code class="calibre26">for</code> statement loops through the statements, each time assigning the variable <code class="calibre26"><i class="calibre12">var</i></code> the next index value from the <i class="calibre12">array</i> associative array. It's important to remember that the variable is the value of the index and not the data element value. You can easily extract the data element value by using the variable as the array index:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; var["a"] = 1
&gt; var["g"] = 2
&gt; var["m"] = 3
&gt; var["u"] = 4
&gt; for (test in var)
&gt; {
&gt;    print "Index:",test," - Value:",var[test]
&gt; }
&gt; }'
Index: u  - Value: 4
Index: m  - Value: 3
Index: a  - Value: 1
Index: g  - Value: 2
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="602" id="calibre_link-932" class="calibre11"></span>Notice that the index values aren't returned in any particular order, but they each reference the appropriate data element value. This is somewhat important to know, because you can't count on the returned values being in the same order, just that the index and data values match.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Deleting array variables</h3>
<p class="calibre10">Removing an array index from an associative array requires a special command:</p>
<pre class="calibre29"><code class="calibre26">delete <i class="calibre12">array</i>[<i class="calibre12">index</i>]</code></pre>
<p class="calibre10">The <code class="calibre26">delete</code> command removes the associative index value and the associated data element value from the array:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; var["a"] = 1
&gt; var["g"] = 2
&gt; for (test in var)
&gt; {
&gt;    print "Index:",test," - Value:",var[test]
&gt; }
&gt; delete var["g"]
&gt; print "---"
&gt; for (test in var)
&gt;    print "Index:",test," - Value:",var[test]
&gt; }'
Index: a  - Value: 1
Index: g  - Value: 2
---
Index: a  - Value: 1
$</code></pre>
<p class="calibre10">After you delete an index value from the associative array, you can't retrieve it.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-285" class="calibre4"></a>Using Patterns</h2>
<p class="calibre10">The <code class="calibre26">gawk</code> program supports several types of matching patterns to filter data records, in much the same way as the <code class="calibre26">sed</code> editor. Chapter 19 showed two special patterns in action. The <code class="calibre26">BEGIN</code> and <code class="calibre26">END</code> keywords are special patterns that execute statements before or after the data stream data has been read. Similarly, you can create other patterns to execute statements when matching data appears in the data stream.</p>
<p class="calibre10"><span type="pagebreak" title="603" id="calibre_link-933" class="calibre11"></span>This section demonstrates how to use matching patterns in your <code class="calibre26">gawk</code> scripts to limit what records a program script applies to.</p>
<section class="toclist">
<h3 class="calibre15">Regular expressions</h3>
<p class="calibre10">Chapter 20 showed how to use regular expressions as matching patterns. You can use either a Basic Regular Expression (BRE) or an Extended Regular Expression (ERE) to filter which lines in the data stream the program script applies to.</p>
<p class="calibre10">When using a regular expression, the regular expression must appear before the left brace of the program script that it controls:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","} /11/{print $1}' data1
data11
$</code></pre>
<p class="calibre10">The regular expression <code class="calibre26">/11/</code> matches records that contain the string <code class="calibre26">11</code> anywhere in the data fields. The <code class="calibre26">gawk</code> program matches the defined regular expression against all the data fields in the record, including the field separator character:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","} /,d/{print $1}' data1
data11
data21
data31
$</code></pre>
<p class="calibre10">This example matches the comma used as the field separator in the regular expression. This is not always a good thing. It can lead to problems trying to match data specific to one data field that may also appear in another data field. If you need to match a regular expression to a specific data instance, you should use the matching operator.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The matching operator</h3>
<p class="calibre10">The <span class="chaptertitle"><i class="calibre12">matching operator</i></span> allows you to restrict a regular expression to a specific data field in the records. The matching operator is the tilde symbol (â¼). You specify the matching operator, along with the data field variable, and the regular expression to match:</p>
<pre class="calibre29"><code class="calibre26">$1 ~ /^data/</code></pre>
<p class="calibre10">The <code class="calibre26">$1</code> variable represents the first data field in the record. This expression filters records where the first data field starts with the text data. The following is an example of using the matching operator in a <code class="calibre26">gawk</code> program script:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","} $2 ~ /^data2/{print $0}' data1
data21,data22,data23,data24,data25
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="604" id="calibre_link-934" class="calibre11"></span>The matching operator compares the second data field with the regular expression <code class="calibre26">/â§data2/</code>, which indicates the string starts with the text <code class="calibre26">data2</code>.</p>
<p class="calibre10">This is a powerful tool that is commonly used in <code class="calibre26">gawk</code> program scripts to search for specific data elements in a data file:</p>
<pre class="calibre29"><code class="calibre26">$ gawk -F: '$1 ~ /rich/{print $1,$NF}' /etc/passwd
rich /bin/bash
$</code></pre>
<p class="calibre10">This example searches the first data field for the text <code class="calibre26">rich</code>. When it finds the pattern in a record, it prints the first and last data field values of the record.</p>
<p class="calibre10">You can also negate the regular expression match by using the <code class="calibre26">!</code> symbol:</p>
<pre class="calibre29"><code class="calibre26">$1 !~ /expression/</code></pre>
<p class="calibre10">If the regular expression isn't found in the record, the program script is applied to the record data:</p>
<pre class="calibre29"><code class="calibre26">$ gawk &ndash;F: '$1 !â¼ /rich/{print $1,$NF}' /etc/passwd
root /bin/bash
daemon /bin/sh
bin /bin/sh
sys /bin/sh
--- output truncated ---
$</code></pre>
<p class="calibre10">In this example, the <code class="calibre26">gawk</code> program script prints the userid and shell for all the entries in the <code class="calibre26">/etc/passwd</code> file that don't match the userid <code class="calibre26">rich</code>!</p>
</section>
<section class="toclist">
<h3 class="calibre15">Mathematical expressions</h3>
<p class="calibre10">In addition to regular expressions, you can also use mathematical expressions in the matching pattern. This feature comes in handy when matching numerical values in data fields. For example, if you want to display all the system users who belong to the root users group (group number 0), you could use this script:</p>
<pre class="calibre29"><code class="calibre26">$ gawk -F: '$4 == 0{print $1}' /etc/passwd
root
sync
shutdown
halt
operator
$</code></pre>
<p class="calibre10">The script checks for records where the fourth data field contains the value 0. On this Linux system, five user accounts belong to the root user group.</p>
<p class="calibre10"><span type="pagebreak" title="605" id="calibre_link-935" class="calibre11"></span>You can use any of the normal mathematical comparison expressions:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">x == y</code>: Value <i class="calibre12">x</i> is equal to <i class="calibre12">y</i>.</li>
<li class="calibre7"><code class="calibre26">x &lt;= y</code>: Value <i class="calibre12">x</i> is less than or equal to <i class="calibre12">y</i>.</li>
<li class="calibre7"><code class="calibre26">x &lt; y</code>: Value <i class="calibre12">x</i> is less than <i class="calibre12">y</i>.</li>
<li class="calibre7"><code class="calibre26">x &gt;= y</code>: Value <i class="calibre12">x</i> is greater than or equal to <i class="calibre12">y</i>.</li>
<li class="calibre7"><code class="calibre26">x &gt; y</code>: Value <i class="calibre12">x</i> is greater than <i class="calibre12">y</i>.</li>
</ul>
<p class="calibre10">You can also use expressions with text data, but you must be careful. Unlike regular expressions, expressions are an exact match. The data must match exactly with the pattern:</p>
<pre class="calibre29"><code class="calibre26">$ gawk -F, '$1 == "data"{print $1}' data1
$
$ gawk -F, '$1 == "data11"{print $1}' data1
data11
$</code></pre>
<p class="calibre10">The first test doesn't match any records because the first data field value isn't data in any of the records. The second test matches one record with the value <code class="calibre26">data11</code>.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-286" class="calibre4"></a>Structured Commands</h2>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language supports the usual cast of structured programming commands. This section describes each of these commands and demonstrates how to use them within a <code class="calibre26">gawk</code> programming environment.</p>
<section class="toclist">
<h3 class="calibre15">The if statement</h3>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language supports the standard <code class="calibre26">if-then-else</code> format of the <code class="calibre26">if</code> statement. You must define a condition for the <code class="calibre26">if</code> statement to evaluate, enclosed in parentheses. If the condition evaluates to a <code class="calibre26">TRUE</code> condition, the statement immediately following the <code class="calibre26">if</code> statement is executed. If the condition evaluates to a <code class="calibre26">FALSE</code> condition, the statement is skipped. You can use this format:</p>
<pre class="calibre29"><code class="calibre26">if (<i class="calibre12">condition</i>)
   <i class="calibre12">statement1</i></code></pre>
<p class="calibre10">Or you can place it on one line, like this:</p>
<pre class="calibre29"><code class="calibre26">if (<i class="calibre12">condition</i>) <i class="calibre12">statement1</i></code></pre>
<p class="calibre10">Here's a simple example demonstrating this format:</p>
<pre class="calibre29"><code class="calibre26">$ cat data4
10
5
13
50
34
$ gawk '{if ($1 &gt; 20) print $1}' data4
50
34
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="606" id="calibre_link-936" class="calibre11"></span>Not too complicated. If you need to execute multiple statements in the <code class="calibre26">if</code> statement, you must enclose them with braces:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; if ($1 &gt; 20)
&gt; {
&gt;   x = $1 * 2
&gt;   print x
&gt; }
&gt; }' data4
100
68
$</code></pre>
<p class="calibre10">Be careful that you don't confuse the <code class="calibre26">if</code> statement braces with the braces used to start and stop the program script. The <code class="calibre26">gawk</code> program can detect missing braces and produces an error message if you mess up:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; if ($1 &gt; 20)
&gt; {
&gt;    x = $1 * 2
&gt;    print x
&gt; }' data4
gawk: cmd. line:6: }
gawk: cmd. line:6:  ^ unexpected newline or end of string
$</code></pre>
<p class="calibre10">The <code class="calibre26">gawk</code> <code class="calibre26">if</code> statement also supports the <code class="calibre26">else</code> clause, allowing you to execute one or more statements if the <code class="calibre26">if</code> statement condition fails. Here's an example of using the <code class="calibre26">else</code> clause:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; if ($1 &gt; 20)
&gt; {
&gt;    x = $1 * 2
&gt;    print x
&gt; } else
&gt; {
&gt;    x = $1 / 2
&gt;    print x
&gt; }}' data4
5
2.5
6.5
100
68
$</code></pre>
<p class="calibre10">You can use the <code class="calibre26">else</code> clause on a single <span type="pagebreak" title="607" id="calibre_link-937" class="calibre11"></span>line, but you must use a semicolon after the <code class="calibre26">if</code> statement section:</p>
<pre class="calibre29"><code class="calibre26">if (<i class="calibre12">condition</i>) <i class="calibre12">statement1</i>; else <i class="calibre12">statement2</i></code></pre>
<p class="calibre10">Here's the same example using the single line format:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{if ($1 &gt; 20) print $1 * 2; else print $1 / 2}' data4
5
2.5
6.5
100
68
$</code></pre>
<p class="calibre10">This format is more compact but can be harder to follow.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The while statement</h3>
<p class="calibre10">The <code class="calibre26">while</code> statement provides a basic looping feature for <code class="calibre26">gawk</code> programs. Here's the format of the <code class="calibre26">while</code> statement:</p>
<pre class="calibre29"><code class="calibre26">while (condition)
{
  statements
}</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> loop allows you to iterate over a set of data, checking a condition that stops the iteration. This is useful if you have multiple data values in each record that you must use in calculations:</p>
<pre class="calibre29"><code class="calibre26">$ cat data5
130 120 135
160 113 140
145 170 215
$ gawk '{
&gt; total = 0
&gt; i = 1
&gt; while (i &lt; 4)
&gt; {
&gt;    total += $i
&gt;    i++
&gt; }
&gt; avg = total / 3
&gt; print "Average:",avg
&gt; }' data5
Average: 128.333
Average: 137.667
Average: 176.667
$</code></pre>
<p class="calibre10">The <code class="calibre26">while</code> statement <span type="pagebreak" title="608" id="calibre_link-938" class="calibre11"></span>iterates through the data fields in the record, adding each value to the total variable and incrementing the counter variable, <code class="calibre26">i</code>. When the counter value is equal to 4, the <code class="calibre26">while</code> condition becomes <code class="calibre26">FALSE</code>, and the loop terminates, dropping through to the next statement in the script. That statement calculates the average and prints the average. This process is repeated for each record in the data file.</p>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language supports using the <code class="calibre26">break</code> and <code class="calibre26">continue</code> statements in <code class="calibre26">while</code> loops, allowing you to jump out of the middle of the loop:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; total = 0
&gt; i = 1
&gt; while (i &lt; 4)
&gt; {
&gt;    total += $i
&gt;    if (i == 2)
&gt;       break
&gt;    i++
&gt; }
&gt; avg = total / 2
&gt; print "The average of the first two data elements is:",avg
&gt; }' data5
The average of the first two data elements is: 125
The average of the first two data elements is: 136.5
The average of the first two data elements is: 157.5
$</code></pre>
<p class="calibre10">The <code class="calibre26">break</code> statement is used to break out of the <code class="calibre26">while</code> loop if the value of the <code class="calibre26">i</code> variable is 2.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The do-while statement</h3>
<p class="calibre10">The <code class="calibre26">do-while</code> statement is similar to the <code class="calibre26">while</code> statement but performs the statements before checking the condition statement. Here's the format for the <code class="calibre26">do-while</code> statement:</p>
<pre class="calibre29"><code class="calibre26">do
{
  <i class="calibre12">statements</i>
} while (<i class="calibre12">condition</i>)</code></pre>
<p class="calibre10"><span type="pagebreak" title="609" id="calibre_link-939" class="calibre11"></span>This format guarantees that the statements are executed at least one time before the condition is evaluated. This comes in handy when you need to perform statements before evaluating the condition:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; total = 0
&gt; i = 1
&gt; do
&gt; {
&gt;    total += $i
&gt;    i++
&gt; } while (total &lt; 150)
&gt; print total }' data5
250
160
315
$</code></pre>
<p class="calibre10">The script reads the data fields from each record and totals them until the cumulative value reaches 150. If the first data field is over 150 (as seen in the second record), the script is guaranteed to read at least the first data field before evaluating the condition.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The for statement</h3>
<p class="calibre10">The <code class="calibre26">for</code> statement is a common method used in many programming languages for looping. The <code class="calibre26">gawk</code> programming language supports the C-style of <code class="calibre26">for</code> loops:</p>
<pre class="calibre29"><code class="calibre26">for( <i class="calibre12">variable assignment</i>; <i class="calibre12">condition</i>; <i class="calibre12">iteration process</i>)</code></pre>
<p class="calibre10">This helps simplify the loop by combining several functions in one statement:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; total = 0
&gt; for (i = 1; i &lt; 4; i++)
&gt; {
&gt;    total += $i
&gt; }
&gt; avg = total / 3
&gt; print "Average:",avg
&gt; }' data5
Average: 128.333
Average: 137.667
Average: 176.667
$</code></pre>
<p class="calibre10">By defining the iteration counter in the <code class="calibre26">for</code> loop, you don't have to worry about incrementing it yourself as you did when using the <code class="calibre26">while</code> statement.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-287" class="calibre4"></a>Formatted Printing</h2>
<p class="calibre10"><span type="pagebreak" title="610" id="calibre_link-940" class="calibre11"></span>You may have noticed that the print statement doesn't exactly give you much control over how <code class="calibre26">gawk</code> displays your data. About all you can do is control the output field separator character (<code class="calibre26">OFS</code>). If you're creating detailed reports, often you need to place data in a specific format and location.</p>
<p class="calibre10">The solution is to use the formatted printing command, called <code class="calibre26">printf</code>. If you're familiar with C programming, the <code class="calibre26">printf</code> command in <code class="calibre26">gawk</code> performs the same way, allowing you to specify detailed instructions on how to display data.</p>
<p class="calibre10">Here's the format of the <code class="calibre26">printf</code> command:</p>
<pre class="calibre29"><code class="calibre26">printf "<i class="calibre12">format string</i>", <i class="calibre12">var1</i>, <i class="calibre12">var2</i> . . .</code></pre>
<p class="calibre10">The <span class="chaptertitle"><i class="calibre12">format string</i></span> is the key to the formatted output. It specifies exactly how the formatted output should appear, using both text elements and <span class="chaptertitle"><i class="calibre12">format specifiers.</i></span> A format specifier is a special code that indicates what type of variable is displayed and how to display it. The <code class="calibre26">gawk</code> program uses each format specifier as a placeholder for each variable listed in the command. The first format specifier matches the first variable listed, the second matches the second variable, and so on.</p>
<p class="calibre10">The format specifiers use the following format:</p>
<pre class="calibre29"><code class="calibre26">%[<i class="calibre12">modifier</i>]<i class="calibre12">control-letter</i></code></pre>
<p class="calibre10">In this example, <code class="calibre26"><i class="calibre12">control-letter</i></code> is a one-character code that indicates what type of data value will be displayed, and <code class="calibre26"><i class="calibre12">modifier</i></code> defines an optional formatting feature.</p>
<p class="calibre10"><a id="calibre_link-1252" href="#calibre_link-1159" class="calibre4">Table 22.3</a> lists the control letters that can be used in the format specifier.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1159" href="#calibre_link-1252" class="calibre4"><b class="calibre21">Table 22.3</b></a></span> Format Specifier Control Letters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Control Letter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">c</code></td>
<td class="left">Displays a number as an ASCII character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">d</code></td>
<td class="left">Displays an integer value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">i</code></td>
<td class="left">Displays an integer value (same as <code class="calibre26">d</code>)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">e</code></td>
<td class="left">Displays a number in scientific notation</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">f</code></td>
<td class="left">Displays a floating-point value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">g</code></td>
<td class="left">Displays either scientific notation or floating point, whichever is shorter</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">o</code></td>
<td class="left">Displays an octal value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">s</code></td>
<td class="left">Displays a text string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">x</code></td>
<td class="left">Displays a hexadecimal value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">X</code></td>
<td class="left">Displays a hexadecimal value, but using capital letters for <i class="calibre12">A</i> through <i class="calibre12">F</i></td>
</tr>
</table>
</figure>
<p class="calibre10">Thus, if you need <span type="pagebreak" title="611" id="calibre_link-941" class="calibre11"></span>to display a string variable, you use the format specifier <code class="calibre26">%s</code>. If you need to display an integer variable, you use either <code class="calibre26">%d</code> or <code class="calibre26">%i</code> (<code class="calibre26">%d</code> is the C-style for decimals). If you want to display a large value using scientific notation, you use the <code class="calibre26">%e</code> format specifier:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; x = 10 * 100
&gt; printf "The answer is: %e\n", x
&gt; }'
The answer is: 1.000000e+03
$</code></pre>
<p class="calibre10">In addition to the control letters, you can use three modifiers for even more control over your output:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">width</code>: This is a numeric value that specifies the minimum width of the output field. If the output is shorter, <code class="calibre26">printf</code> pads the space with spaces, using right justification for the text. If the output is longer than the specified width, it overrides the <code class="calibre26">width</code> value.</li>
<li class="calibre7"><code class="calibre26">prec</code>: This is a numeric value that specifies the number of digits to the right of the decimal place in floating-point numbers, or the maximum number of characters displayed in a text string.</li>
<li class="calibre7"><code class="calibre26">-</code> (<b class="calibre21">minus sign</b>): The minus sign indicates that left justification should be used instead of right justification when placing data in the formatted space.</li>
</ul>
<p class="calibre10">When using the <code class="calibre26">printf</code> statement, you have complete control over how your output appears. For example, in the âBuilt-in variablesâ section, we used the <code class="calibre26">print</code> command to display data fields from our records:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS="\n"; RS=""} {print $1,$4}' data2
Riley Mullen (312)555-1234
Frank Williams (317)555-9876
Haley Snell (313)555-4938
$</code></pre>
<p class="calibre10">You can use the <code class="calibre26">printf</code> command to help format the output so it looks better. First, let's just convert the <code class="calibre26">print</code> command to a <code class="calibre26">printf</code> command and see what that does:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS="\n"; RS=""} {printf "%s %s\n", $1, $4}' data2
Riley Mullen  (312)555-1234
Frank Williams  (317)555-9876
Haley Snell  (313)555-4938
$</code></pre>
<p class="calibre10">That <span type="pagebreak" title="612" id="calibre_link-942" class="calibre11"></span>produces the same output as the <code class="calibre26">print</code> command. The <code class="calibre26">printf</code> command uses the <code class="calibre26">%s</code> format specifier as a placeholder for the two string values.</p>
<p class="calibre10">Notice that you have to manually add the newline character at the end of the <code class="calibre26">printf</code> command to force a new line. Without it, the <code class="calibre26">printf</code> command uses the same line on subsequent prints.</p>
<p class="calibre10">This is useful if you need to print multiple things on the same line, but using separate <code class="calibre26">printf</code> commands:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","} {printf "%s ", $1} END{printf "\n"}' data1
data11 data21 data31
$</code></pre>
<p class="calibre10">Both <code class="calibre26">printf</code> outputs appear on the same line. To be able to terminate the line, the <code class="calibre26">END</code> section prints a single newline character.</p>
<p class="calibre10">Next, let's use a modifier to format the first string value:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS="\n"; RS=""} {printf "%16s  %s\n", $1, $4}' data2
   Riley Mullen  (312)555-1234
 Frank Williams  (317)555-9876
    Haley Snell  (313)555-4938
$</code></pre>
<p class="calibre10">By adding the <code class="calibre26">16</code> modifier value, we force the output for the first string to use 16 spaces. By default, the <code class="calibre26">printf</code> command uses right justification to place the data in the format space. To make it left justified, just add a minus sign to the modifier:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS="\n"; RS=""} {printf "%-16s  %s\n", $1, $4}' data2
Riley Mullen      (312)555-1234
Frank Williams    (317)555-9876
Haley Snell       (313)555-4938
$</code></pre>
<p class="calibre10">Now that looks pretty professional!</p>
<p class="calibre10">The <code class="calibre26">printf</code> command also comes in handy when dealing with floating-point values. By specifying a format for the variable, you can make the output look more uniform:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{
&gt; total = 0
&gt; for (i = 1; i &lt; 4; i++)
&gt; {
&gt;    total += $i
&gt; }
&gt; avg = total / 3
&gt; printf "Average: %5.1f\n",avg
&gt; }' data5
Average: 128.3
Average: 137.7
Average: 176.7
$</code></pre>
<p class="calibre10">By using the <code class="calibre26">%5.1f</code> format specifier, you can force the <code class="calibre26">printf</code> command to round the floating-point values to a single decimal place.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-288" class="calibre4"></a>Built-In Functions</h2>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language <span type="pagebreak" title="613" id="calibre_link-943" class="calibre11"></span>provides quite a few built-in functions that perform common mathematical, string, and even time functions. You can utilize these functions in your <code class="calibre26">gawk</code> programs to help cut down on the coding requirements in your scripts. This section walks you through the different built-in functions available in <code class="calibre26">gawk</code>.</p>
<section class="toclist">
<h3 class="calibre15">Mathematical functions</h3>
<p class="calibre10">If you've done programming in any type of language, you're probably familiar with using built-in functions in your code to perform common mathematical functions. The <code class="calibre26">gawk</code> programming language doesn't disappoint those looking for advanced mathematical features.</p>
<p class="calibre10"><a id="calibre_link-1253" href="#calibre_link-1160" class="calibre4">Table 22.4</a> shows the mathematical built-in functions available in <code class="calibre26">gawk</code>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1160" href="#calibre_link-1253" class="calibre4"><b class="calibre21">Table 22.4</b></a></span> The gawk Mathematical Functions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Function</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">atan2(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">y</i></code><code class="calibre26">)</code></td>
<td class="left">The arctangent of <code class="calibre26"><i class="calibre12">x</i></code> / <code class="calibre26"><i class="calibre12">y</i></code>, with <code class="calibre26"><i class="calibre12">x</i></code> and <code class="calibre26"><i class="calibre12">y</i></code> specified in radians</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cos(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The cosine of <code class="calibre26"><i class="calibre12">x</i></code>, with <code class="calibre26"><i class="calibre12">x</i></code> specified in radians</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exp(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The exponential of <code class="calibre26"><i class="calibre12">x</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">int(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The integer part of <code class="calibre26"><i class="calibre12">x</i></code>, truncated toward 0</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">log(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The natural logarithm of <code class="calibre26"><i class="calibre12">x</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rand()</code></td>
<td class="left">A random floating point value larger than 0 and less than 1</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sin(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The sine of <code class="calibre26"><i class="calibre12">x</i></code>, with <code class="calibre26"><i class="calibre12">x</i></code> specified in radians</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sqrt(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">The square root of <code class="calibre26"><i class="calibre12">x</i></code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">srand(</code><code class="calibre26"><i class="calibre12">x</i></code><code class="calibre26">)</code></td>
<td class="left">Specifies a seed value for calculating random numbers</td>
</tr>
</table>
</figure>
<p class="calibre10">Although it does not have an extensive list of mathematical functions, <code class="calibre26">gawk</code> does provide some of the basic elements you need for standard mathematical processing. The <code class="calibre26">int()</code> function produces the integer portion of a value, but it doesn't round the value. It behaves much like a floor function found in other programming languages. It produces the nearest integer to a value between the value and 0.</p>
<p class="calibre10">This means that the <code class="calibre26">int()</code> function of the value 5.6 returns 5, while the <code class="calibre26">int()</code> function of the value -5.6 returns -5.</p>
<p class="calibre10">The <code class="calibre26">rand()</code> function is great for <span type="pagebreak" title="614" id="calibre_link-944" class="calibre11"></span>creating random numbers, but you need to use a trick to get meaningful values. The <code class="calibre26">rand()</code> function returns a random number, but only between the values 0 and 1 (not including 0 or 1). To get a larger number, you need to scale the returned value.</p>
<p class="calibre10">A common method for producing larger integer random numbers is to create an algorithm that uses the <code class="calibre26">rand()</code> function, along with the <code class="calibre26">int()</code> function:</p>
<pre class="calibre29"><code class="calibre26">x = int(10 * rand())</code></pre>
<p class="calibre10">This returns a random integer value between (and including) 0 and 9. Just substitute the 10 in the equation with the upper limit value for your application, and you're ready to go.</p>
<p class="calibre10">Be careful when using some of the mathematical functions, because the <code class="calibre26">gawk</code> programming language does have a limited range of numeric values it can work with. If you go over that range, you get an error message:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{x=exp(100); print x}'
26881171418161356094253400435962903554686976
$ gawk 'BEGIN{x=exp(1000); print x}'
gawk: warning: exp argument 1000 is out of range
inf
$</code></pre>
<p class="calibre10">The first example calculates the natural exponential function of 100, which is a very large number but within the range of the system. The second example attempts to calculate the natural exponential function of 1,000, which goes over the numerical range limit of the system and produces an error message.</p>
<p class="calibre10">Besides the standard mathematical functions, <code class="calibre26">gawk</code> also provides a few functions for bitwise manipulating of data:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">and(</code><code class="calibre26"><i class="calibre12">v1</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">v2</i></code><code class="calibre26">)</code>: Performs a bitwise <code class="calibre26">AND</code> of values <code class="calibre26"><i class="calibre12">v1</i></code> and <code class="calibre26"><i class="calibre12">v2</i></code></li>
<li class="calibre7"><code class="calibre26">compl(</code><code class="calibre26"><i class="calibre12">val</i></code><code class="calibre26">)</code>: Performs the bitwise complement of <code class="calibre26"><i class="calibre12">val</i></code></li>
<li class="calibre7"><code class="calibre26">lshift(</code><code class="calibre26"><i class="calibre12">val</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">count</i></code><code class="calibre26">)</code>: Shifts the value <code class="calibre26"><i class="calibre12">val</i></code> count number of bits left</li>
<li class="calibre7"><code class="calibre26">or(</code><code class="calibre26"><i class="calibre12">v1</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">v2</i></code><code class="calibre26">)</code>: Performs a bitwise <code class="calibre26">OR</code> of values <code class="calibre26"><i class="calibre12">v1</i></code> and <code class="calibre26"><i class="calibre12">v2</i></code></li>
<li class="calibre7"><code class="calibre26">rshift(</code><code class="calibre26"><i class="calibre12">val</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">count</i></code><code class="calibre26">)</code>: Shifts the value <code class="calibre26"><i class="calibre12">val</i></code> count number of bits right</li>
<li class="calibre7"><code class="calibre26">xor(</code><code class="calibre26"><i class="calibre12">v1</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">v2</i></code><code class="calibre26">)</code>: Performs a bitwise <code class="calibre26">XOR</code> of values <code class="calibre26"><i class="calibre12">v1</i></code> and <code class="calibre26"><i class="calibre12">v2</i></code></li>
</ul>
<p class="calibre10">The bit manipulation functions are useful when working with binary values in your data.</p>
</section>
<section class="toclist">
<h3 class="calibre15">String functions</h3>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language also provides <span type="pagebreak" title="615" id="calibre_link-945" class="calibre11"></span>several functions you can use to manipulate string values, shown in <a id="calibre_link-1254" href="#calibre_link-1161" class="calibre4">Table 22.5</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1161" href="#calibre_link-1254" class="calibre4"><b class="calibre21">Table 22.5</b></a></span> The gawk String Functions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Function</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">asort(</code><code class="calibre26"><i class="calibre12">s</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">d</i></code><code class="calibre26">])</code></td>
<td class="left">This function sorts an array <code class="calibre26"><i class="calibre12">s</i></code> based on the data element values. The index values are replaced with sequential numbers indicating the new sort order. Alternatively, the new sorted array is stored in array <code class="calibre26"><i class="calibre12">d</i></code> if specified.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">asorti(</code><code class="calibre26"><i class="calibre12">s</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">d</i></code><code class="calibre26">])</code></td>
<td class="left">This function sorts an array <code class="calibre26"><i class="calibre12">s</i></code> based on the index values. The resulting array contains the index values as the data element values, with sequential number indexes indicating the sort order. Alternatively, the new sorted array is stored in array <code class="calibre26"><i class="calibre12">d</i></code> if specified.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gensub(</code><code class="calibre26"><i class="calibre12">r</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">h</i></code> <code class="calibre26">[,</code> <code class="calibre26"><i class="calibre12">t</i></code><code class="calibre26">])</code></td>
<td class="left">This function searches either the variable <code class="calibre26">$0</code>, or the target string <code class="calibre26"><i class="calibre12">t</i></code> if supplied, for matches of the regular expression <code class="calibre26"><i class="calibre12">r</i></code>. If <code class="calibre26"><i class="calibre12">h</i></code> is a string beginning with either <code class="calibre26"><i class="calibre12">g</i></code> or <code class="calibre26"><i class="calibre12">G</i></code>, it replaces the matching text with <code class="calibre26"><i class="calibre12">s</i></code>. If <code class="calibre26"><i class="calibre12">h</i></code> is a number, it represents which occurrence of <code class="calibre26"><i class="calibre12">r</i></code> to replace.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gsub(</code><code class="calibre26"><i class="calibre12">r</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">s</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">t</i></code><code class="calibre26">])</code></td>
<td class="left">This function searches either the variable <code class="calibre26">$0</code>, or the target string <code class="calibre26"><i class="calibre12">t</i></code> if supplied, for matches of the regular expression <code class="calibre26"><i class="calibre12">r</i></code>. If found, it substitutes the string <code class="calibre26"><i class="calibre12">s</i></code> globally.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">index(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">t</i></code><code class="calibre26">)</code></td>
<td class="left">This function returns the index of the string <code class="calibre26"><i class="calibre12">t</i></code> in string <code class="calibre26"><i class="calibre12">s</i></code>, or 0 if not found.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">length([</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">])</code></td>
<td class="left">This function returns the length of string <code class="calibre26"><i class="calibre12">s</i></code>, or if not specified, the length of <code class="calibre26">$0</code>.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">match(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">r</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">a</i></code><code class="calibre26">])</code></td>
<td class="left">This function returns the index of the string <code class="calibre26"><i class="calibre12">s</i></code> where the regular expression <code class="calibre26"><i class="calibre12">r</i></code> occurs. If array <code class="calibre26"><i class="calibre12">a</i></code> is specified, it contains the portion of <code class="calibre26"><i class="calibre12">s</i></code> that matches the regular expression.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">split(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">a</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">r</i></code><code class="calibre26">])</code></td>
<td class="left">This function splits <code class="calibre26"><i class="calibre12">s</i></code> into array <code class="calibre26"><i class="calibre12">a</i></code> using either the <code class="calibre26">FS</code> character, or the regular expression <code class="calibre26"><i class="calibre12">r</i></code> if supplied. It returns the number of fields.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sprintf(</code><code class="calibre26"><i class="calibre12">format</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">variables</i></code><code class="calibre26">)</code></td>
<td class="left">This function returns a string similar to the output of <code class="calibre26">printf</code> using the <code class="calibre26"><i class="calibre12">format</i></code> and <code class="calibre26"><i class="calibre12">variables</i></code> supplied.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sub(</code><code class="calibre26"><i class="calibre12">r</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">s</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">t</i></code>]<code class="calibre26">)</code></td>
<td class="left">This function searches either the variable <code class="calibre26">$0</code>, or the target string <code class="calibre26"><i class="calibre12">t</i></code>, for matches of the regular expression <code class="calibre26"><i class="calibre12">r</i></code>. If found, it substitutes the string <code class="calibre26"><i class="calibre12">s</i></code> for the first occurrence.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">substr(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">,</code> <code class="calibre26"><i class="calibre12">i</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">n</i></code><code class="calibre26">])</code></td>
<td class="left">This function returns the <code class="calibre26"><i class="calibre12">n</i></code>th character substring of <code class="calibre26"><i class="calibre12">s</i></code>, starting at index <code class="calibre26"><i class="calibre12">i</i></code>. If <code class="calibre26"><i class="calibre12">n</i></code> is not supplied, the rest of <code class="calibre26"><i class="calibre12">s</i></code> is used.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">tolower(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">)</code></td>
<td class="left">This function converts all characters in <code class="calibre26"><i class="calibre12">s</i></code> to lowercase.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">toupper(</code><code class="calibre26"><i class="calibre12">s</i></code><code class="calibre26">)</code></td>
<td class="left">This function converts all characters in <code class="calibre26"><i class="calibre12">s</i></code> to uppercase.</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="616" id="calibre_link-946" class="calibre11"></span>Some string functions are relatively self-explanatory:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{x = "testing"; print toupper(x); print length(x) }'
TESTING
7
$</code></pre>
<p class="calibre10">However, some string functions can get pretty complicated. The <code class="calibre26">asort</code> and <code class="calibre26">asorti</code> functions are new <code class="calibre26">gawk</code> functions that allow you to sort an array variable based on either the data element values (<code class="calibre26">asort</code>) or the index values (<code class="calibre26">asorti</code>). Here's an example of using <code class="calibre26">asort</code>:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; var["a"] = 1
&gt; var["g"] = 2
&gt; var["m"] = 3
&gt; var["u"] = 4
&gt; asort(var, test)
&gt; for (i in test)
&gt;     print "Index:",i," - value:",test[i]
&gt; }'
Index: 4  - value: 4
Index: 1  - value: 1
Index: 2  - value: 2
Index: 3  - value: 3
$</code></pre>
<p class="calibre10">The new array, <code class="calibre26">test</code>, contains the newly sorted data elements of the original array, but the index values are now changed to numerical values, indicating the proper sort order.</p>
<p class="calibre10">The <code class="calibre26">split</code> function is a great way to push data fields into an array for further processing:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{ FS=","}{
&gt; split($0, var)
&gt; print var[1], var[5]
&gt; }' data1
data11 data15
data21 data25
data31 data35
$</code></pre>
<p class="calibre10">The new array uses sequential numbers for the array index, starting with index value 1 containing the first data field.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Time functions</h3>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language contains a few functions to help you deal with time values, shown in <a id="calibre_link-1255" href="#calibre_link-1162" class="calibre4">Table 22.6</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1162" href="#calibre_link-1255" class="calibre4"><b class="calibre21">Table 22.6</b></a></span> The gawk Time Functions</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Function</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mktime(</code><code class="calibre26"><i class="calibre12">datespec</i></code><code class="calibre26">)</code></td>
<td class="left">Converts a date specified in the format YYYY MM DD HH MM SS [DST] into a timestamp value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">strftime(</code><code class="calibre26"><i class="calibre12">format</i></code> <code class="calibre26">[,</code><code class="calibre26"><i class="calibre12">timestamp</i></code><code class="calibre26">])</code></td>
<td class="left">Formats either the current time of day timestamp, or timestamp if provided, into a formatted day and date, using the <code class="calibre26">date()</code> shell function format</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">systime()</code></td>
<td class="left">Returns the timestamp for the current time of day</td>
</tr>
</table>
</figure>
<p class="calibre10">The time functions are often used when working with log files that contain dates that you need to compare. By converting the text representation of a date to the epoch time (the number of seconds since midnight, January 1, 1970), you can easily compare dates.</p>
<p class="calibre10">The following is an example of using the time functions in a <code class="calibre26">gawk</code> program:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{
&gt; date = systime()
&gt; day = strftime("%A, %B %d, %Y", date)
&gt; print day
&gt; }'
Friday, December 26, 2014
$</code></pre>
<p class="calibre10">This example uses the <code class="calibre26">systime</code> function to retrieve <span type="pagebreak" title="617" id="calibre_link-947" class="calibre11"></span>the current epoch timestamp from the system and then uses the <code class="calibre26">strftime</code> function to convert it into a human-readable format using the date shell command's date format characters.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-289" class="calibre4"></a>User-Defined Functions</h2>
<p class="calibre10">You're not limited to just using the built-in functions available in <code class="calibre26">gawk</code>. You can create your own functions for use in <code class="calibre26">gawk</code> programs. This section shows you how to define and use your own functions in <code class="calibre26">gawk</code> programs.</p>
<section class="toclist">
<h3 class="calibre15">Defining a function</h3>
<p class="calibre10">To define you own function, you must use the <code class="calibre26">function</code> keyword:</p>
<pre class="calibre29"><code class="calibre26">function <i class="calibre12">name</i>([<i class="calibre12">variables</i>])
{
   <i class="calibre12">statements</i>
}</code></pre>
<p class="calibre10">The function name <span type="pagebreak" title="618" id="calibre_link-948" class="calibre11"></span>must uniquely identify your function. You can pass one or more variables into the function from the calling <code class="calibre26">gawk</code> program:</p>
<pre class="calibre29"><code class="calibre26">function printthird()
{
   print $3
}</code></pre>
<p class="calibre10">This function prints the third data field in the record.</p>
<p class="calibre10">The function can also return a value using the <code class="calibre26">return</code> statement:</p>
<pre class="calibre29"><code class="calibre26">return <i class="calibre12">value</i></code></pre>
<p class="calibre10">The value can be a variable, or an equation that evaluates to a value:</p>
<pre class="calibre29"><code class="calibre26">function myrand(limit)
{
   return int(limit * rand())
}</code></pre>
<p class="calibre10">You can assign the value returned from the function to a variable in the <code class="calibre26">gawk</code> program:</p>
<pre class="calibre29"><code class="calibre26">x = myrand(100)</code></pre>
<p class="calibre10">The variable contains the value returned from the function.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using your functions</h3>
<p class="calibre10">When you define a function, it must appear by itself before you define any programming sections (including the <code class="calibre26">BEGIN</code> section). This may look a little odd at first, but it helps keep the function code separate from the rest of the <code class="calibre26">gawk</code> program:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; function myprint()
&gt; {
&gt;     printf "%-16s - %s\n", $1, $4
&gt; }
&gt; BEGIN{FS="\n"; RS=""}
&gt; {
&gt;     myprint()
&gt; }' data2
Riley Mullen     - (312)555-1234
Frank Williams   - (317)555-9876
Haley Snell      - (313)555-4938
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="619" id="calibre_link-949" class="calibre11"></span>The function defines the <code class="calibre26">myprint()</code> function, which formats the first and fourth data fields in the record for printing. The <code class="calibre26">gawk</code> program then uses the function to display the data from the data file.</p>
<p class="calibre10">After you define a function, you can use it as often as necessary in the program section of the code. This saves lots of work when using long algorithms.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating a function library</h3>
<p class="calibre10">Obviously, having to rewrite your <code class="calibre26">gawk</code> functions every time you need them is not a pleasant experience. However, <code class="calibre26">gawk</code> provides a way for you to combine your functions into a single library file that you can use in all your <code class="calibre26">gawk</code> programming.</p>
<p class="calibre10">First, you need to create a file that contains all your <code class="calibre26">gawk</code> functions:</p>
<pre class="calibre29"><code class="calibre26">$ cat funclib
function myprint()
{
  printf "%-16s - %s\n", $1, $4
}
function myrand(limit)
{
  return int(limit * rand())
}
function printthird()
{
  print $3
}
$</code></pre>
<p class="calibre10">The <code class="calibre26">funclib</code> file contains three function definitions. To use them, you need to use the <code class="calibre26">-f</code> command line parameter. Unfortunately, you can't combine the <code class="calibre26">-f</code> command line parameter with an inline <code class="calibre26">gawk</code> script, but you can use multiple <code class="calibre26">-f</code> parameters on the same command line.</p>
<p class="calibre10">Thus, to use your library, just create a file that contains your <code class="calibre26">gawk</code> program, and specify both the library file and your program file on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ cat script4
BEGIN{ FS="\n"; RS=""}
{
    myprint()
}
$ gawk -f funclib -f script4 data2
Riley Mullen     - (312)555-1234
Frank Williams   - (317)555-9876
Haley Snell      - (313)555-4938
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="620" id="calibre_link-950" class="calibre11"></span>Now you just need to add the <code class="calibre26">funclib</code> file to your <code class="calibre26">gawk</code> command line whenever you need to use a function defined in the library.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-290" class="calibre4"></a>Working through a Practical Example</h2>
<p class="calibre10">The advanced <code class="calibre26">gawk</code> features come in handy if you have to handle data values in a data file, such as tabulating sales figures or calculating bowling scores. When you work with data files, the key is to first group related data records together and then perform any calculations required on the related data.</p>
<p class="calibre10">For example, let's work with a data file that contains the bowling scores from a game between two teams, each with two players:</p>
<pre class="calibre29"><code class="calibre26">$ cat scores.txt
Rich Blum,team1,100,115,95
Barbara Blum,team1,110,115,100
Christine Bresnahan,team2,120,115,118
Tim Bresnahan,team2,125,112,116
$</code></pre>
<p class="calibre10">Each player has scores from three separate games in the data file, and each player is identified by a team name in the second column. Here's the shell script to sort the data for each team and calculate the totals and averages:</p>
<pre class="calibre29"><code class="calibre26">$ cat bowling.sh
#!/bin/bash
for team in $(gawk &ndash;F, '{print $2}' scores.txt | uniq)
do
   gawk &ndash;v team=$team 'BEGIN{FS=","; total=0}
   {
      if ($2==team)
      {
         total += $3 + $4 + $5;
      }
   }
   END {
      avg = total / 6;
      print "Total for", team, "is", total, ",the average is",avg
   }' scores.txt
done
$</code></pre>
<p class="calibre10">The first <code class="calibre26">gawk</code> statement inside the <code class="calibre26">for</code> loop filters out the team names in the data file and then uses the <code class="calibre26">uniq</code> function to return one value for each separate team name. The <code class="calibre26">for</code> loop then iterates for each separate team name.</p>
<p class="calibre10">The <code class="calibre26">gawk</code> statement inside the <code class="calibre26">for</code> loop is what's doing <span type="pagebreak" title="621" id="calibre_link-951" class="calibre11"></span>the calculations. For each data record, it first determines if the team name matches the loop team. That's done by using the <code class="calibre26">&ndash;v</code> option in <code class="calibre26">gawk</code>, which allows us to pass a shell variable inside the <code class="calibre26">gawk</code> program. If the team name matches, the code keeps a running sum of the three scores in the data record, adding each data record's values, as long as that data record matches the team name.</p>
<p class="calibre10">At the end of each loop iteration, the <code class="calibre26">gawk</code> code displays the score totals, as well as the average of the scores. The output should look like this:</p>
<pre class="calibre29"><code class="calibre26">$ ./bowling.sh
Total for team1 is 635, the average is 105.833
Total for team2 is 706, the average is 117.667
$</code></pre>
<p class="calibre10">Now you have a handy shell script to calculate the results of all your bowling tournaments; you just need to plug the data from each player into the data text file and run the script!</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-291" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter walked you through the more advanced features of the <code class="calibre26">gawk</code> programming language. Every programming language requires using variables, and <code class="calibre26">gawk</code> is no different. The <code class="calibre26">gawk</code> programming language includes some built-in variables that you can use to reference specific data field values and retrieve information about the number of data fields and records processed in the data file. You can also create your own variables for use in your scripts.</p>
<p class="calibre10">The <code class="calibre26">gawk</code> programming language also provides many of the standard structured commands you expect from a programming language. You can easily create fancy programs using <code class="calibre26">if-then</code> logic and <code class="calibre26">while</code>, <code class="calibre26">do-while</code>, and <code class="calibre26">for</code> loops. Each of these commands allows you to alter the flow of your <code class="calibre26">gawk</code> program script to iterate through data field values to create detailed data reports.</p>
<p class="calibre10">The <code class="calibre26">printf</code> command is a great tool to have if you need to customize your report output. It allows you to specify the exact format for displaying data from the <code class="calibre26">gawk</code> program script. You can easily create formatted reports, placing data elements in exactly the correct position.</p>
<p class="calibre10">Finally, this chapter discussed the many built-in functions available in the <code class="calibre26">gawk</code> programming language and showed you how to create your own functions. The <code class="calibre26">gawk</code> program contains many useful functions for handling mathematical features, such as standard square roots and logarithms, as well as trigonometric functions. There are also several string-related functions that make extracting substrings from larger strings a breeze.</p>
<p class="calibre10"><span type="pagebreak" title="622" id="calibre_link-952" class="calibre11"></span>You aren't limited to the built-in functions in the <code class="calibre26">gawk</code> program. If you're working on an application that uses lots of specialized algorithms, you can create your own functions to process the algorithms and use those functions in your own code. You can also set up a library file containing all the functions you use in your <code class="calibre26">gawk</code> programs, saving you time and effort in all your coding.</p>
<p class="calibre10">The next chapter switches gears a little. It examines a few other shell environments you may run into in your Linux shell-scripting endeavors. Although the bash shell is the most common shell used in Linux, it's not the only shell. It helps to know a little about some of the other shells available and how they differ from the bash shell.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-94">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-292" class="calibre4"></a><span class="chaptertitle">Chapter 23</span><br class="calibre22" /><span class="chaptertitle">Working with Alternative Shells</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This <span type="pagebreak" title="623" id="calibre_link-953" class="calibre30"></span>Chapter</h1>
<ol class="none">
<li class="calibre7">Understanding the dash shell</li>
<li class="calibre7">Programming in the dash shell</li>
<li class="calibre7">Introducing the zsh shell</li>
<li class="calibre7">Writing scripts for zsh</li>
</ol>
<p class="calibre19">Although the bash shell is the most widely used shell in Linux distributions, it isn't the only one. Now that you've seen the standard Linux bash shell and what you can do with it, it's time to examine a few other shells available in the Linux world. This chapter describes two other shells that you may run into in your Linux journey and how they differ from the bash shell.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-293" class="calibre4"></a>What Is the dash Shell?</h2>
<p class="calibre10">The Debian dash shell has had an interesting past. It's a direct descendant of the ash shell, a simple copy of the original Bourne shell available on Unix systems (see Chapter 1). Kenneth Almquist created a small-scale version of the Bourne shell for Unix systems and called it the Almquist shell, which was then shortened to <i class="calibre12">ash</i>. This original version of the ash shell was extremely small and fast but without many advanced features, such as command line editing or history features, making it difficult to use as an interactive shell.</p>
<p class="calibre10">The NetBSD Unix operating system adopted the ash shell and still uses it today as the default shell. The NetBSD developers customized the ash shell by adding several new features, making it closer to the Bourne shell. The new features include command line editing using both emacs and vi editor commands, as well as a history command to recall previously entered commands. This version of the ash shell is also used by the FreeBSD operating system as the default login shell.</p>
<p class="calibre10">The Debian Linux distribution created its own version of the ash shell (called Debian ash, or <i class="calibre12">dash</i>) for inclusion in its version of Linux. For the most part, dash copies the features of the NetBSD version of the ash shell, providing the advanced command line editing capabilities.</p>
<p class="calibre10">However, to add to the shell confusion, the dash shell is actually not the default shell in many Debian-based Linux distributions. Because of the popularity of the bash shell in Linux, most Debian-based <span type="pagebreak" title="624" id="calibre_link-954" class="calibre11"></span>Linux distributions use the bash shell as the normal login shell and use the dash shell only as a quick-start shell for the installation script to install the distribution files.</p>
<p class="calibre10">The exception is the popular Ubuntu distribution. This often confuses shell script programmers and causes a great number of problems with running shell scripts in a Linux environment. The Ubuntu Linux distribution uses the bash shell as the default interactive shell, but uses the dash shell as the default <code class="calibre26">/bin/sh</code> shell. This âfeatureâ really confuses shell script programmers.</p>
<p class="calibre10">As you saw in Chapter 11, every shell script must start with a line that declares the shell used for the script. In our bash shell scripts, we've been using this:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash</code></pre>
<p class="calibre10">This tells the shell to use the shell program located at <code class="calibre26">/bin/bash</code> to execute the script. In the Unix world, the default shell was always <code class="calibre26">/bin/sh</code>. Many shell script programmers familiar with the Unix environment copy this into their Linux shell scripts:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/sh</code></pre>
<p class="calibre10">On most Linux distributions, the <code class="calibre26">/bin/sh</code> file is a symbolic link (see Chapter 3) to the <code class="calibre26">/bin/bash</code> shell program. This allows you to easily port shell scripts designed for the Unix Bourne shell to the Linux environment without having to modify them.</p>
<p class="calibre10">Unfortunately, the Ubuntu Linux distribution links the <code class="calibre26">/bin/sh</code> file to the <code class="calibre26">/bin/dash</code> shell program. Because the dash shell contains only a subset of the commands available in the original Bourne shell, this can &mdash; and often does &mdash; cause some shell scripts to not work properly.</p>
<p class="calibre10">The next section walks you through the basics of the dash shell and how it differs from the bash shell. This is especially important to know if you write bash shell scripts that may need to be run in an Ubuntu environment.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-294" class="calibre4"></a>The dash Shell Features</h2>
<p class="calibre10">Although both the bash shell and the dash shell are modeled after the Bourne shell, they have some differences. This section walks you through the features found in the Debian dash shell to acquaint you with how the dash shell works before we dive into the shell scripting features.</p>
<section class="toclist">
<h3 class="calibre15">The dash command line parameters</h3>
<p class="calibre10">The dash shell uses command line parameters to control its behavior. <a id="calibre_link-1276" href="#calibre_link-1163" class="calibre4">Table 23.1</a> lists the command line parameters and describes what each one does.<span type="pagebreak" title="625" id="calibre_link-955" class="calibre11"></span></p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1163" href="#calibre_link-1276" class="calibre4"><b class="calibre21">Table 23.1</b></a></span> The dash Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Exports all variables assigned to the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">Reads commands from a specified command string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code></td>
<td class="left">If not interactive, exits immediately if any untested command fails</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code></td>
<td class="left">Displays pathname wildcard characters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">If not interactive, reads commands but doesn't execute them</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-u</code></td>
<td class="left">Writes an error message to <code class="calibre26">STDERR</code> when attempting to expand a variable that is not set</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v</code></td>
<td class="left">Writes input to <code class="calibre26">STDERR</code> as it is read</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-x</code></td>
<td class="left">Writes each command to <code class="calibre26">STDERR</code> as it is executed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-I</code></td>
<td class="left">Ignores EOF characters from the input when in interactive mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left">Forces the shell to operate in interactive mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-m</code></td>
<td class="left">Turns on job control (enabled by default in interactive mode)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Reads commands from <code class="calibre26">STDIN</code> (the default behavior if no file arguments are present)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-E</code></td>
<td class="left">Enables the emacs command line editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-V</code></td>
<td class="left">Enables the vi command line editor</td>
</tr>
</table>
</figure>
<p class="calibre10">Debian added a few additional command line parameters to the original ash shell command line parameter list. The <code class="calibre26">-E</code> and <code class="calibre26">-V</code> command line parameters enable the special command line editing features of the dash shell.</p>
<p class="calibre10">The <code class="calibre26">-E</code> command line parameter allows you to use the emacs editor commands for editing command line text (see Chapter 10). You can use all the emacs commands for manipulating text on a single line using the Ctrl and Meta key combinations.</p>
<p class="calibre10">The <code class="calibre26">-V</code> command line parameter allows you to use the vi editor commands for editing command line text (again, see Chapter 10). This feature allows you to switch between normal mode and vi editor mode on the command line by using the <code class="calibre26">Esc</code> key. When you're in vi editor mode, you can use all the standard vi editor commands (such as <code class="calibre26">x</code> to delete a character, and <code class="calibre26">i</code> to insert text). After you finish editing the command line, you must press the Esc key again to exit vi editor mode.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The dash environment variables</h3>
<p class="calibre10">The dash shell uses quite a few default environment variables uses to track information, and you can create your own environment variables as well. This section describes the environment variables and how dash handles them.</p>
<section class="toclist">
<h4 class="calibre25">Default environment variables</h4>
<p class="calibre10">The dash environment variables are very <span type="pagebreak" title="626" id="calibre_link-956" class="calibre11"></span>similar to the environment variables used in bash (see Chapter 6). This is not by accident. Remember that both the dash and bash shells are extensions of the Bourne shell, so they both incorporate many of its features. However, because of its goal of simplicity, the dash shell contains significantly fewer environment variables than the bash shell. You need to take this into consideration when creating shell scripts in a dash shell environment.</p>
<p class="calibre10">The dash shell uses the <code class="calibre26">set</code> command to display environment variables:</p>
<pre class="calibre29"><code class="calibre26">$set
COLORTERM="
DESKTOP_SESSION='default'
DISPLAY=':0.0'
DM_CONTROL='/var/run/xdmctl'
GS_LIB='/home/atest/.fonts'
HOME='/home/atest'
IFS='
'
KDEROOTHOME='/root/.kde'
KDE_FULL_SESSION='true'
KDE_MULTIHEAD='false'
KONSOLE_DCOP='DCOPRef(konsole-5293,konsole)'
KONSOLE_DCOP_SESSION='DCOPRef(konsole-5293,session-1)'
LANG='en_US'
LANGUAGE='en'
LC_ALL='en_US'
LOGNAME='atest'
OPTIND='1'
PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'
PPID='5293'
PS1='$ '
PS2='&gt; '
PS4='+ '
PWD='/home/atest'
SESSION_MANAGER='local/testbox:/tmp/.ICE-unix/5051'
SHELL='/bin/dash'
SHLVL='1'
TERM='xterm'
USER='atest'
XCURSOR_THEME='default'
_='ash'
$</code></pre>
<p class="calibre10">Your default dash shell environment will most likely differ, because different Linux distributions assign different default environment variables at login.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Positional parameters</h4>
<p class="calibre10"><span type="pagebreak" title="627" id="calibre_link-957" class="calibre11"></span>In addition to the default environment variables, the dash shell also assigns special variables to any parameters defined in the command line. Here are the positional parameter variables available for use in the dash shell:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">$0</code>: The name of the shell</li>
<li class="calibre7"><code class="calibre26">$n</code>: The <i class="calibre12">n</i>th position parameter</li>
<li class="calibre7"><code class="calibre26">$*</code>: A single value with the contents of all the parameters, separated by the first character in the IFS environment variable, or a space if IFS isn't defined</li>
<li class="calibre7"><code class="calibre26">$@</code>: Expands to multiple arguments consisting of all the command line parameters</li>
<li class="calibre7"><code class="calibre26">$#</code>: The number of positional parameters</li>
<li class="calibre7"><code class="calibre26">$?</code>: The exit status of the most recent command</li>
<li class="calibre7"><code class="calibre26">$-</code>: The current option flags</li>
<li class="calibre7"><code class="calibre26">$$</code>: The process ID (PID) of the current shell</li>
<li class="calibre7"><code class="calibre26">$!</code>: The process ID (PID) of the most recent background command</li>
</ul>
<p class="calibre10">All the dash positional parameters mimic the same positional parameters available in the bash shell. You can use each of the positional parameters in your shell scripts just as you would in the bash shell.</p>
</section>
<section class="toclist">
<h4 class="calibre25">User-defined environment variables</h4>
<p class="calibre10">The dash shell also allows you to set your own environment variables. As with bash, you can define a new environment variable on the command line by using the assignment statement:</p>
<pre class="calibre29"><code class="calibre26">$ testing=10 ; export testing
$ echo $testing
10
$</code></pre>
<p class="calibre10">Without the <code class="calibre26">export</code> command, user-defined environment variables are visible only in the current shell or process.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">There's one huge difference between dash variables and bash variables. The dash shell doesn't support variable arrays. This small feature causes all sorts of problems for advanced shell script writers.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The dash built-in commands</h3>
<p class="calibre10"><span type="pagebreak" title="628" id="calibre_link-958" class="calibre11"></span>Just as with the bash shell, the dash shell contains a set of built-in commands that it recognizes. You can use these commands directly from the command line interface, or you can incorporate them in your shell scripts. <a id="calibre_link-1277" href="#calibre_link-1164" class="calibre4">Table 23.2</a> lists the dash shell built-in commands.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1164" href="#calibre_link-1277" class="calibre4"><b class="calibre21">Table 23.2</b></a></span> The dash Shell Built-In Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">alias</code></td>
<td class="left">Creates an alias string to represent a text string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bg</code></td>
<td class="left">Continues specified job in background mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cd</code></td>
<td class="left">Switches to the specified directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">echo</code></td>
<td class="left">Displays a text string and environment variables</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">eval</code></td>
<td class="left">Concatenates all arguments with a space</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exec</code></td>
<td class="left">Replaces the shell process with the specified command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exit</code></td>
<td class="left">Terminates the shell process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">export</code></td>
<td class="left">Exports the specified environment variable for use in all child shells</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fg</code></td>
<td class="left">Continues specified job in foreground mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">getopts</code></td>
<td class="left">Obtains options and arguments from a list of parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">hash</code></td>
<td class="left">Maintains and retrieves a hash table of recent commands and their locations</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pwd</code></td>
<td class="left">Displays the value of the current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">read</code></td>
<td class="left">Reads a line from <code class="calibre26">STDIN</code> and assign the value to a variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">readonly</code></td>
<td class="left">Reads a line from <code class="calibre26">STDIN</code> to a variable that can't be changed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">printf</code></td>
<td class="left">Displays text and variables using a formatted string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">set</code></td>
<td class="left">Lists or sets option flags and environment variables</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">shift</code></td>
<td class="left">Shifts the positional parameters a specified number of times</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">test</code></td>
<td class="left">Evaluates an expression and returns 0 if true or 1 if false</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">times</code></td>
<td class="left">Displays the accumulated user and system times for the shell and all shell processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">trap</code></td>
<td class="left">Parses and executes an action when the shell receives a specified signal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">type</code></td>
<td class="left">Interprets the specified name and displays the resolution (alias, built-in, command, keyword)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ulimit</code></td>
<td class="left">Queries or sets limits on processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">umask</code></td>
<td class="left">Sets the value of the default file and directory permissions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unalias</code></td>
<td class="left">Removes the specified alias</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unset</code></td>
<td class="left">Removes the specified variable or option flag from the exported variables</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">wait</code></td>
<td class="left">Waits for the specified job to complete and returns the exit status</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="629" id="calibre_link-959" class="calibre11"></span>You probably recognize all these built-in commands from the bash shell. The dash shell supports many of the same built-in commands as the bash shell. You'll notice that there are no commands for the command history file or for the directory stack. The dash shell doesn't support these features.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-295" class="calibre4"></a>Scripting in dash</h2>
<p class="calibre10">Unfortunately, the dash shell doesn't recognize all the scripting features of the bash shell. Shell scripts written for the bash environment often fail when run in the dash shell, causing all sorts of grief for shell script programmers. This section describes the differences you'll need to be aware of to get your shell scripts to run properly in a dash shell environment.</p>
<section class="toclist">
<h3 class="calibre15">Creating dash scripts</h3>
<p class="calibre10">You probably guessed by now that creating shell scripts for the dash shell is pretty similar to creating shell scripts for the bash shell. You should always specify which shell you want to use in your script to ensure that the script runs with the proper shell.</p>
<p class="calibre10">You do this on the first line of the shell:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/dash</code></pre>
<p class="calibre10">You can also specify a shell command line parameter on this line, as was documented earlier in âThe dash command line parametersâ section.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Things that don't work</h3>
<p class="calibre10">Unfortunately, because the dash shell is only a subset of the Bourne shell features, some things in bash shell scripts don't work in the dash shell. These are often called <i class="calibre12">bashisms.</i> This section is a quick summary of bash shell features you may be used to using in your bash shell scripts that don't work if you're in a dash shell environment.</p>
<section class="toclist">
<h4 class="calibre25">Using arithmetic</h4>
<p class="calibre10">Chapter 11 showed three ways to express a mathematical operation in the bash shell script:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">Using the</b> <code class="calibre26">expr</code> <b class="calibre21">command:</b> <code class="calibre26">expr operation</code></li>
<li class="calibre7"><b class="calibre21">Using square brackets:</b> <code class="calibre26">$[ operation ]</code></li>
<li class="calibre7"><b class="calibre21">Using double parentheses:</b> <code class="calibre26">$(( operation ))</code></li>
</ul>
<p class="calibre10">The dash shell supports the <code class="calibre26">expr</code> command and the double parentheses method but doesn't support the square bracket method. This can be a problem if you have lots of mathematical operations that use the square brackets.</p>
<p class="calibre10"><span type="pagebreak" title="630" id="calibre_link-960" class="calibre11"></span>The proper format for performing mathematical operations in dash shell scripts is to use the double parentheses method:</p>
<pre class="calibre29"><code class="calibre26">$ cat test5b
#!/bin/dash
# testing mathematical operations
value1=10
value2=15
value3=$(( $value1 * $value2 ))
echo "The answer is $value3"
$ ./test5b
The answer is 150
$</code></pre>
<p class="calibre10">Now the shell can perform the calculation properly.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The test command</h4>
<p class="calibre10">Although the dash shell supports the <code class="calibre26">test</code> command, you must be careful how you use it. The bash shell version of the <code class="calibre26">test</code> command is slightly different from the dash shell version.</p>
<p class="calibre10">The bash shell <code class="calibre26">test</code> command allows you to use the double equal sign (<code class="calibre26">==</code>) to test if two strings are equal. This is an add-on to accommodate programmers familiar with using this format in other programming languages.</p>
<p class="calibre10">However, the <code class="calibre26">test</code> command available in the dash shell doesn't recognize the <code class="calibre26">==</code> symbol for text comparisons. Instead, it only recognizes the <code class="calibre26">=</code> symbol. If you use the == symbol in your bash scripts, you need to change the text comparison symbol to just a single equal sign:</p>
<pre class="calibre29"><code class="calibre26">$ cat test7
#!/bin/dash
# testing the = comparison
test1=abcdef
test2=abcdef
if [ $test1 = $test2 ]
then
   echo "They're the same!"
else
   echo "They're different"
fi
$ ./test7
They're the same!
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="631" id="calibre_link-961" class="calibre11"></span>This little bashism is responsible for many hours of frustration for shell programmers!</p>
</section>
<section class="toclist">
<h4 class="calibre25">The function Command</h4>
<p class="calibre10">Chapter 17 showed you how to define your own functions in your shell scripts. The bash shell supports two methods for defining functions:</p>
<ul class="calibre14">
<li class="calibre7">Using the function() statement</li>
<li class="calibre7">Using the function name only</li>
</ul>
<p class="calibre10">The dash shell doesn't support the <code class="calibre26">function</code> statement. Instead, in the dash shell you must define a function using the function name with parentheses.</p>
<p class="calibre10">If you're writing shell scripts that may be used in the dash environment, always define functions using the function name and not the function() statement:</p>
<pre class="calibre29"><code class="calibre26">$ cat test10
#!/bin/dash
# testing functions
func1() {
   echo "This is an example of a function"
}
count=1
while [ $count -le 5 ]
do
   func1
   count=$(( $count + 1 ))
done
echo "This is the end of the loop"
func1
echo "This is the end of the script"
$ ./test10
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is an example of a function
This is the end of the loop
This is an example of a function
This is the end of the script
$</code></pre>
<p class="calibre10">Now the dash shell recognizes the function defined in the script just fine and uses it within the script.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-296" class="calibre4"></a>The zsh Shell</h2>
<p class="calibre10"><span type="pagebreak" title="632" id="calibre_link-962" class="calibre11"></span>Another popular shell that you may run into is the Z shell (called zsh). The zsh shell is an open source Unix shell developed by Paul Falstad. It takes ideas from all the existing shells and adds many unique features to create a full-blown advanced shell designed for programmers.</p>
<p class="calibre10">The following are some of the features that make the zsh shell unique:</p>
<ul class="calibre14">
<li class="calibre7">Improved shell option handling</li>
<li class="calibre7">Shell compatibility modes</li>
<li class="calibre7">Loadable modules</li>
</ul>
<p class="calibre10">Of all these features, a loadable module is the most advanced feature in shell design. As you've seen in the bash and dash shells, each shell contains a set of built-in commands that are available without the need for external utility programs. The benefit of built-in commands is execution speed. The shell doesn't have to load a utility program into memory before running it; the built-in commands are already in the shell memory, ready to go.</p>
<p class="calibre10">The zsh shell provides a core set of built-in commands, plus the capability to add more <i class="calibre12">command modules.</i> Each command module provides a set of additional built-in commands for specific circumstances, such as network support and advanced math functions. You can add only the modules you think you need for your specific situation.</p>
<p class="calibre10">This feature provides a great way to either limit the size of the zsh shell for situations that require a small shell size and few commands or expand the number of available built-in commands for situations that require faster execution speeds.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-297" class="calibre4"></a>Parts of the zsh Shell</h2>
<p class="calibre10">This section walks you through the basics of the zsh shell, showing the built-in commands that are available (or can be added by installing modules), as well as the command line parameters and environment variables used by the zsh shell.</p>
<section class="toclist">
<h3 class="calibre15">Shell options</h3>
<p class="calibre10">Most shells use command line parameters to define the behavior of the shell. The zsh shell uses a few command line parameters to define the operation of the shell, but mostly it uses <i class="calibre12">options</i> to customize the behavior of the shell. You can set shell options either on the command line or within the shell itself using the <code class="calibre26">set</code> command.</p>
<p class="calibre10"><a id="calibre_link-1278" href="#calibre_link-1165" class="calibre4">Table 23.3</a> lists the command line parameters available for the zsh shell.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1165" href="#calibre_link-1278" class="calibre4"><b class="calibre21">Table 23.3</b></a></span> The zsh Shell Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">Executes only the specified command and exits</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left">Starts as an interactive shell, providing a command line interface prompt</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Forces the shell to read commands from <code class="calibre26">STDIN</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-o</code></td>
<td class="left">Specifies command line options</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="633" id="calibre_link-963" class="calibre11"></span>Although this may seem like a small set of command line parameters, the <code class="calibre26">-o</code> parameter is somewhat misleading. It allows you to set shell options that define features within the shell. By far, the zsh shell is the most customizable shell available. You can alter lots of features for your shell environment. The different options fit into several general categories:</p>
<ul class="calibre14">
<li class="calibre7"><b class="calibre21">Changing directories:</b> Options that control how the <code class="calibre26">cd</code> and <code class="calibre26">dirs</code> commands handle directory changes</li>
<li class="calibre7"><b class="calibre21">Completion:</b> Options that control command completion features</li>
<li class="calibre7"><b class="calibre21">Expansion and globbing:</b> Options that control file expansion in commands</li>
<li class="calibre7"><b class="calibre21">History:</b> Options that control command history recall</li>
<li class="calibre7"><b class="calibre21">Initialization:</b> Options that control how the shell handles variables and startup files when started</li>
<li class="calibre7"><b class="calibre21">Input/output:</b> Options that control command handling</li>
<li class="calibre7"><b class="calibre21">Job control:</b> Options that dictate how the shell handles and starts jobs</li>
<li class="calibre7"><b class="calibre21">Prompting:</b> Options that define how the shell works with command line prompts</li>
<li class="calibre7"><b class="calibre21">Scripts and functions:</b> Options that control how the shell processes shell scripts and defines shell functions</li>
<li class="calibre7"><b class="calibre21">Shell emulation:</b> Options that allow you to set the behavior of the zsh shell to mimic the behavior of other shell types</li>
<li class="calibre7"><b class="calibre21">Shell state:</b> Options that define what type of shell to start</li>
<li class="calibre7"><b class="calibre21">zle:</b> Options for controlling the zsh line editor (zle) feature</li>
<li class="calibre7"><b class="calibre21">Option aliases:</b> Special options that can be used as aliases for other option names</li>
</ul>
<p class="calibre10">With this many different categories of shell options, you can imagine just how many actual options the zsh shell supports.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Built-in commands</h3>
<p class="calibre10">The zsh shell is unique in that it allows you to expand the built-in commands available in the shell. This provides for a wealth of speedy utilities at your fingertips for a host of different applications.</p>
<p class="calibre10"><span type="pagebreak" title="634" id="calibre_link-964" class="calibre11"></span>This section describes the core built-in commands, along with the various modules available at the time of this writing.</p>
<section class="toclist">
<h4 class="calibre25">Core built-in commands</h4>
<p class="calibre10">The core of the zsh shell contains the basic built-in commands you're used to seeing in other shells. <a id="calibre_link-1279" href="#calibre_link-1166" class="calibre4">Table 23.4</a> describes the built-in commands available for you.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1166" href="#calibre_link-1279" class="calibre4"><b class="calibre21">Table 23.4</b></a></span> The zsh Core Built-In Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">alias</code></td>
<td class="left">Defines an alternate name for a command and arguments</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">autoload</code></td>
<td class="left">Preloads a shell function into memory for quicker access</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bg</code></td>
<td class="left">Executes a job in background mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bindkey</code></td>
<td class="left">Binds keyboard combinations to commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">builtin</code></td>
<td class="left">Executes the specified built-in command instead of an executable file of the same name</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bye</code></td>
<td class="left">The same as <code class="calibre26">exit</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cd</code></td>
<td class="left">Changes the current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chdir</code></td>
<td class="left">Changes the current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">command</code></td>
<td class="left">Executes the specified command as an external file instead of a function or built-in command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">declare</code></td>
<td class="left">Sets the data type of a variable (same as typeset)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">dirs</code></td>
<td class="left">Displays the contents of the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">disable</code></td>
<td class="left">Temporarily disables the specified hash table elements</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">disown</code></td>
<td class="left">Removes the specified job from the job table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">echo</code></td>
<td class="left">Displays variables and text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">emulate</code></td>
<td class="left">Sets zsh to emulate another shell, such as the Bourne, Korn, or C shells</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">enable</code></td>
<td class="left">Enables the specified hash table elements</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">eval</code></td>
<td class="left">Executes the specified command and arguments in the current shell process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exec</code></td>
<td class="left">Executes the specified command and arguments replacing the current shell process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exit</code></td>
<td class="left">Exits the shell with the specified exit status. If none specified, uses the exit status of the last command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">export</code></td>
<td class="left">Allows the specified environment variable names and values to be used in child shell processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">false</code></td>
<td class="left">Returns an exit status of 1</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fc</code></td>
<td class="left"><span type="pagebreak" title="635" id="calibre_link-965" class="calibre11"></span>Selects a range of commands from the history list</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fg</code></td>
<td class="left">Executes the specified job in foreground mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">float</code></td>
<td class="left">Sets the specified variable for use as a floating point variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">functions</code></td>
<td class="left">Sets the specified name as a function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">getln</code></td>
<td class="left">Reads the next value in the buffer stack and places it in the specified variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">getopts</code></td>
<td class="left">Retrieves the next valid option in the command line arguments and places it in the specified variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">hash</code></td>
<td class="left">Directly modifies the contents of the command hash table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">history</code></td>
<td class="left">Lists the commands contained in the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">integer</code></td>
<td class="left">Sets the specified variable for use as an integer value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">jobs</code></td>
<td class="left">Lists information about the specified job or all jobs assigned to the shell process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">kill</code></td>
<td class="left">Sends a signal (Default <code class="calibre26">SIGTERM</code>) to the specified process or job</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">let</code></td>
<td class="left">Evaluates a mathematical operation and assigns the result to a variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">limit</code></td>
<td class="left">Sets or displays resource limits</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">local</code></td>
<td class="left">Sets the data features for the specified variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">log</code></td>
<td class="left">Displays all users currently logged in who are affected by the watch parameter</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">logout</code></td>
<td class="left">Same as <code class="calibre26">exit</code>, but works only when the shell is a login shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">popd</code></td>
<td class="left">Removes the next entry from the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">print</code></td>
<td class="left">Displays variables and text</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">printf</code></td>
<td class="left">Displays variables and text using C-style format strings</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pushd</code></td>
<td class="left">Changes the current working directory and puts the previous directory in the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pushln</code></td>
<td class="left">Places the specified arguments into the editing buffer stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pwd</code></td>
<td class="left">Displays the full pathname of the current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">read</code></td>
<td class="left">Reads a line and assigns data fields to the specified variables using the <code class="calibre26">IFS</code> characters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">readonly</code></td>
<td class="left">Assigns a value to a variable that can't be changed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rehash</code></td>
<td class="left">Rebuilds the command hash table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">set</code></td>
<td class="left">Sets options or positional parameters for the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">setopt</code></td>
<td class="left">Sets the options for a shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">shift</code></td>
<td class="left">Reads and deletes the first positional parameter and shifts the remaining ones down one position</td>
</tr>
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">source</code></td>
<td class="left"><span type="pagebreak" title="636" id="calibre_link-966" class="calibre11"></span>Finds the specified file and copies its contents into the current location</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">suspend</code></td>
<td class="left">Suspends the execution of the shell until it receives a <code class="calibre26">SIGCONT</code> signal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">test</code></td>
<td class="left">Returns an exit status of 0 if the specified condition is <code class="calibre26">TRUE</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">times</code></td>
<td class="left">Displays the cumulative user and system times for the shell and processes that run in the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">trap</code></td>
<td class="left">Blocks the specified signals from being processed by the shell and executes the specified commands if the signals are received</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">true</code></td>
<td class="left">Returns a zero exit status</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ttyctl</code></td>
<td class="left">Locks and unlocks the display</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">type</code></td>
<td class="left">Displays how the specified command would be interpreted by the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">typeset</code></td>
<td class="left">Sets or displays attributes of variables</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ulimit</code></td>
<td class="left">Sets or displays resource limits of the shell or processes running in the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">umask</code></td>
<td class="left">Sets or displays the default permissions for creating files and directories</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unalias</code></td>
<td class="left">Removes the specified command alias</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unfunction</code></td>
<td class="left">Removes the specified defined function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unhash</code></td>
<td class="left">Removes the specified command from the hash table</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unlimit</code></td>
<td class="left">Removes the specified resource limit</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unset</code></td>
<td class="left">Removes the specified variable attribute.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unsetopt</code></td>
<td class="left">Removes the specified shell option</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">wait</code></td>
<td class="left">Waits for the specified job or process to complete</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">whence</code></td>
<td class="left">Displays how the specified command would be interpreted by the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">where</code></td>
<td class="left">Displays the pathname of the specified command if found by the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">Which</code></td>
<td class="left">Displays the pathname of the specified command using csh-style output</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zcompile</code></td>
<td class="left">Compiles the specified function or script for faster autoloading</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zmodload</code></td>
<td class="left">Performs operations on loadable zsh modules</td>
</tr>
</table>
</figure>
<p class="calibre10">The zsh shell is no slouch when it comes to providing built-in commands! You should recognize most of these commands from their bash counterparts. The most important features of the zsh shell built-in commands are modules.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Add-in modules</h4>
<p class="calibre10">There's a long list of modules that provide additional built-in commands for the zsh shell, and the list continues to grow as resourceful programmers create new modules. <a id="calibre_link-1280" href="#calibre_link-1167" class="calibre4">Table 23.5</a> shows some of the more popular modules available.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1167" href="#calibre_link-1280" class="calibre4"><b class="calibre21">Table 23.5</b></a></span> The zsh Modules</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Module</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/datetime</code></td>
<td class="left">Additional <span type="pagebreak" title="637" id="calibre_link-967" class="calibre11"></span>date and time commands and variables</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/files</code></td>
<td class="left">Commands for basic file handling</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/mapfile</code></td>
<td class="left">Access to external files via associative arrays</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/mathfunc</code></td>
<td class="left">Additional scientific functions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/pcre</code></td>
<td class="left">The extended regular expression library</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/net/socket</code></td>
<td class="left">Unix domain socket support</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/stat</code></td>
<td class="left">Access to the stat system call to provide system statistics</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/system</code></td>
<td class="left">Interface for various low-level system features</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/net/tcp</code></td>
<td class="left">Access to TCP sockets</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/zftp</code></td>
<td class="left">A specialized FTP client command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/zselect</code></td>
<td class="left">Blocks and returns when file descriptors are ready</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zsh/zutil</code></td>
<td class="left">Various shell utilities</td>
</tr>
</table>
</figure>
<p class="calibre10">The zsh shell modules cover a wide range of topics, from providing simple command line editing features to advanced networking functions. The idea behind the zsh shell is to provide a basic minimum shell environment and let you add on the pieces you need to accomplish your programming job.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Viewing, adding, and removing modules</h4>
<p class="calibre10">The <code class="calibre26">zmodload</code> command is the interface to the zsh modules. You use this command to view, add, and remove modules from the zsh shell session.</p>
<p class="calibre10">Using the <code class="calibre26">zmodload</code> command without any command line parameters displays the currently installed modules in your zsh shell:</p>
<pre class="calibre29"><code class="calibre26">% zmodload
zsh/zutil
zsh/complete
zsh/main
zsh/terminfo
zsh/zle
zsh/parameter
%</code></pre>
<p class="calibre10">Different <span type="pagebreak" title="638" id="calibre_link-968" class="calibre11"></span>zsh shell implementations include different modules by default. To add a new module, just specify the module name on the <code class="calibre26">zmodload</code> command line:</p>
<pre class="calibre29"><code class="calibre26">% zmodload zsh/zftp
%</code></pre>
<p class="calibre10">Nothing indicates that the module loaded. You can perform another <code class="calibre26">zmodload</code> command, and the new module should appear in the list of installed modules.</p>
<p class="calibre10">After you load a module, the commands associated with the module are available as built-in commands:</p>
<pre class="calibre29"><code class="calibre26">% zftp open myhost.com rich testing1
Welcome to the myhost FTP server.
% zftp cd test
% zftp dir
01-21-11 11:21PM    120823 test1
01-21-11 11:23PM    118432 test2
% zftp get test1 &gt; test1.txt
% zftp close
%
 </code></pre>
<p class="calibre10">The <code class="calibre26">zftp</code> command allows you to conduct a complete FTP session directly from your zsh shell command line! You can incorporate these commands into your zsh shell scripts to perform file transfers directly from your scripts.</p>
<p class="calibre10">To remove an installed module, use the <code class="calibre26">-u</code> parameter, along with the module name:</p>
<pre class="calibre29"><code class="calibre26">% zmodload -u zsh/zftp
% zftp
zsh: command not found: zftp
%</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">It's a common practice to place <code class="calibre26"><b class="calibre21">zmodload</b></code> commands in the <code class="calibre26">$HOME/.zshrc</code> startup file so your favorite functions load automatically when the zsh shell starts.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-298" class="calibre4"></a>Scripting with zsh</h2>
<p class="calibre10">The main purpose of the zsh shell was to provide an advanced programming environment for shell programmers. With that in mind, it's no surprise that the zsh shell offers many features that make shell scripting easier.</p>
<section class="toclist">
<h3 class="calibre15">Mathematical operations</h3>
<p class="calibre10">As <span type="pagebreak" title="639" id="calibre_link-969" class="calibre11"></span>you would expect, the zsh shell allows you to perform mathematical functions with ease. In the past, the Korn shell has led the way in supporting mathematical operations by providing support for floating-point numbers. The zsh shell has full support for floating-point numbers in all its mathematical operations!</p>
<section class="toclist">
<h4 class="calibre25">Performing calculations</h4>
<p class="calibre10">The zsh shell supports two methods for performing mathematical operations:</p>
<ul class="calibre14">
<li class="calibre7">The <code class="calibre26">let</code> command</li>
<li class="calibre7">Double parentheses</li>
</ul>
<p class="calibre10">When you use the <code class="calibre26">let</code> command, you should enclose the operation in double quotation marks to allow for spaces:</p>
<pre class="calibre29"><code class="calibre26">% let value1=" 4 * 5.1 / 3.2 "
% echo $value1
6.3750000000
%</code></pre>
<p class="calibre10">Be careful, using floating point numbers may introduce a precision problem. To solve this, it's always a good idea to use the <code class="calibre26">printf</code> command and to specify the decimal precision needed to correctly display the answer:</p>
<pre class="calibre29"><code class="calibre26">% printf "%6.3f\n" $value1
6.375
%</code></pre>
<p class="calibre10">Now that's much better!</p>
<p class="calibre10">The second method is to use the double parentheses. This method incorporates two techniques for defining the mathematical operation:</p>
<pre class="calibre29"><code class="calibre26">% value1=$(( 4 * 5.1 ))
% (( value2 = 4 * 5.1 ))
% printf "%6.3f\n" $value1 $value2
20.400
20.400
%</code></pre>
<p class="calibre10">Notice that you can place the double parentheses either around just the operation (preceded by a dollar sign) or around the entire assignment statement. Both methods produce the same results.</p>
<p class="calibre10">If you don't use the <code class="calibre26">typeset</code> command to declare the data type of a variable beforehand, the zsh shell attempts to automatically assign the data type. This can be dangerous when working with both integer and floating-point numbers. Look at this example:</p>
<pre class="calibre29"><code class="calibre26">% value1=10
% value2=$(( $value1 / 3 ))
% echo $value2
3
%</code></pre>
<p class="calibre10">Now, <span type="pagebreak" title="640" id="calibre_link-970" class="calibre11"></span>that's probably not the answer you want to come out from the calculation. When you specify numbers without decimal places, the zsh shell interprets them as integer values and performs integer calculations. To ensure that the result is a floating-point number, you must specify the numbers with decimal places:</p>
<pre class="calibre29"><code class="calibre26">% value1=10.
% value2=$(( $value1 / 3. ))
% echo $value2
3.3333333333333335
%</code></pre>
<p class="calibre10">Now the result is in the floating-point format.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Mathematical functions</h4>
<p class="calibre10">With the zsh shell, built-in mathematical functions are either feast or famine. The default zsh shell doesn't include any special mathematical function. However, if you install the <code class="calibre26">zsh/mathfunc</code> module, you have more math functions than you'll most likely ever need:</p>
<pre class="calibre29"><code class="calibre26">% value1=$(( sqrt(9) ))
zsh: unknown function: sqrt
% zmodload zsh/mathfunc
% value1=$(( sqrt(9) ))
% echo $value1
3.
%</code></pre>
<p class="calibre10">That was simple! Now you have an entire math library of functions at your fingertips.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Lots of mathematical functions are supported in zsh. For a complete listing of all the math functions that the <code class="calibre26">zsh/mathfunc</code> module provides, look at the manual page for zsh modules.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Structured commands</h3>
<p class="calibre10">The zsh shell provides the usual set of structured commands for your shell scripts:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">if-then-else</code> statements</li>
<li class="calibre7"><code class="calibre26">for</code> loops (including the C-style)</li>
<li class="calibre7"><code class="calibre26">while</code> loops</li>
<li class="calibre7"><code class="calibre26">until</code> loops</li>
<li class="calibre7"><code class="calibre26">select</code> statements</li>
<li class="calibre7"><code class="calibre26">case</code> statements</li>
</ul>
<p class="calibre10">The <span type="pagebreak" title="641" id="calibre_link-971" class="calibre11"></span>zsh shell uses the same syntax for each of these structured commands that you're used to from the bash shell. The zsh shell also includes a different structured command called <code class="calibre26">repeat</code>. The <code class="calibre26">repeat</code> command uses this format:</p>
<pre class="calibre29"><code class="calibre26">repeat param
do
   commands
done</code></pre>
<p class="calibre10">The <code class="calibre26">param</code> parameter must be a number or a mathematical operation that evaluates to a number. The <code class="calibre26">repeat</code> command then performs the specified commands that number of times:</p>
<pre class="calibre29"><code class="calibre26">% cat test1
#!/bin/zsh
# using the repeat command
value1=$(( 10 / 2 ))
repeat $value1
do
   echo "This is a test"
done
$ ./test1
This is a test
This is a test
This is a test
This is a test
This is a test
%</code></pre>
<p class="calibre10">This command allows you to repeat sections of code for a set number of times based on a calculation.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Functions</h3>
<p class="calibre10">The zsh shell supports the creation of your own functions either using the <code class="calibre26">function</code> command or by defining the function name with parentheses:</p>
<pre class="calibre29"><code class="calibre26">% function functest1 {
&gt; echo "This is the test1 function"
}
% functest2() {
&gt; echo "This is the test2 function"
}
% functest1
This is the test1 function
% functest2
This is the test2 function
%</code></pre>
<p class="calibre10">As <span type="pagebreak" title="642" id="calibre_link-972" class="calibre11"></span>with bash shell functions (see Chapter 17), you can define functions within your shell script and then either use global variables or pass parameters to your functions.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-299" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter discussed two popular alternative Linux shells that you may run into. The dash shell was developed as part of the Debian Linux distribution and is mainly found in the Ubuntu Linux distribution. It's a smaller version of the Bourne shell, so it doesn't support as many features as the bash shell, which can cause problems for script writing.</p>
<p class="calibre10">The zsh shell is often found in programming environments, because it provides lots of cool features for shell script programmers. It uses loadable modules to load separate code libraries, which make using advanced functions as easy as running command line commands! There are loadable modules for lots of different functions, from complex mathematical algorithms to network applications such as FTP and HTTP.</p>
<p class="calibre10">The next section of this book dives into some specific scripting applications you might run into in the Linux environment. The next chapter shows how to write simple utilities to help with your day-to-day Linux administration functions. Those can greatly help simplify common tasks you perform on the system.</p>
</section>
</section>
</div>


<div class="calibre1" id="calibre_link-300">
<header class="calibre8">
<h1 class="calibre9"><span class="chaptertitle">Part IV</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5">Creating Practical Scripts</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In <span type="pagebreak" title="643" id="calibre_link-1308" class="calibre30"></span>This Part</h1>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-47" class="calibre4"><b class="calibre21">Chapter 24</b> Writing Simple Script Utilities</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-69" class="calibre4"><b class="calibre21">Chapter 25</b> Producing Scripts for Database, Web, and E-Mail</a></li>
</ol>
<ol class="none">
<li class="calibre7"><a href="#calibre_link-116" class="calibre4"><b class="calibre21">Chapter 26</b> Creating Fun Little Shell Scripts</a></li>
</ol>
</section>
</aside>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-47">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-301" class="calibre4"></a><span class="chaptertitle">Chapter 24</span><br class="calibre22" /><span class="chaptertitle">Writing Simple Script Utilities</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In <span type="pagebreak" title="645" id="calibre_link-973" class="calibre30"></span>This Chapter</h1>
<ol class="none">
<li class="calibre7">Automating backups</li>
<li class="calibre7">Managing user accounts</li>
<li class="calibre7">Watching disk space</li>
</ol>
<p class="calibre19">Nowhere is shell script programming more useful than writing script utilities for the Linux system administrator. The typical Linux system administrator has many various jobs to do daily, from monitoring disk space to backing up important files to managing user accounts. Shell script utilities can make these tasks much easier! This chapter demonstrates some of the capabilities you have writing script utilities in the bash shell.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-302" class="calibre4"></a>Performing Archives</h2>
<p class="calibre10">Whether you're responsible for a Linux system in a business environment or just using it at home, the loss of data can be catastrophic. To help prevent bad things from happening, it's always a good idea to perform regular backups (or archives).</p>
<p class="calibre10">However, what's a good idea and what's practical are often two separate things. Trying to arrange a backup schedule to store important files can be a challenge. This is another place where shell scripts often come to the rescue.</p>
<p class="calibre10">This section demonstrates two methods for using shell scripts to archive data on your Linux system.</p>
<section class="toclist">
<h3 class="calibre15">Archiving data files</h3>
<p class="calibre10">If you're using your Linux system to work on an important project, you can create a shell script that automatically takes snapshots of specific directories. Designating these directories in a configuration file allows you to change them when a particular project changes. This helps avoid a time-consuming restore process from your main archive files.</p>
<p class="calibre10">This section shows you how to create an automated shell script that can take snapshots of specified directories and keep an archive of your data's past versions.</p>
<section class="toclist">
<h4 class="calibre25">Obtaining the required functions</h4>
<p class="calibre10"><span type="pagebreak" title="646" id="calibre_link-974" class="calibre11"></span>The workhorse for archiving data in the Linux world is the <code class="calibre26">tar</code> command (see Chapter 4). The <code class="calibre26">tar</code> command is used to archive entire directories into a single file. Here's an example of creating an archive file of a working directory using the <code class="calibre26">tar</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tar -cf archive.tar /home/Christine/Project/*.*</b></code>
tar: Removing leading '/' from member names
$
$ <code class="calibre26"><b class="calibre21">ls -l archive.tar</b></code>
-rw-rw-r--. 1 Christine Christine 51200 Aug 27 10:51 archive.tar
$</code></pre>
<p class="calibre10">The <code class="calibre26">tar</code> command responds with a warning message that it's removing the leading forward slash from the pathname to convert it from an absolute pathname to a relative pathname (see Chapter 3). This allows you to extract the <code class="calibre26">tar</code> archived files anywhere you want in your filesystem. You'll probably want to get rid of that message in your script. You can accomplish this by redirecting <code class="calibre26">STDERR</code> to the <code class="calibre26">/dev/null</code> file (see Chapter 15):</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tar -cf archive.tar /home/Christine/Project/*.* 2&gt;/dev/null</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l archive.tar</b></code>
-rw-rw-r--. 1 Christine Christine 51200 Aug 27 10:53 archive.tar
$</code></pre>
<p class="calibre10">Because a <code class="calibre26">tar</code> archive file can consume lots of disk space, it's a good idea to compress the file. You can do this by simply adding the <code class="calibre26">-z</code> option. This compresses the tar archive file into a gzipped <code class="calibre26">tar</code> file, which is called a <span class="chaptertitle"><i class="calibre12">tarball</i></span>. Be sure to use the proper file extensions to denote that the file is a tarball. Either <code class="calibre26">.tar.gz</code> or <code class="calibre26">.tgz</code> is fine. Here's an example of creating a tarball of the project directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">tar -zcf archive.tar.gz /home/Christine/Project/*.* 2&gt;/dev/null</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l archive.tar.gz</b></code>
-rw-rw-r--. 1 Christine Christine 3331 Aug 27 10:53 archive.tar.gz
$</code></pre>
<p class="calibre10">Now you have the main component for your archive script completed.</p>
<p class="calibre10">Instead of modifying or creating a new archive script for each new directory or file you want to back up, you can use a configuration file. The configuration file should contain each directory or file you want to be included in the archive.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat Files_To_Backup</b></code>
/home/Christine/Project
/home/Christine/Downloads
/home/Does_not_exist
/home/Christine/Documents
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you're using a <span type="pagebreak" title="647" id="calibre_link-975" class="calibre11"></span>Linux distribution that includes a graphical desktop, be careful about archiving your entire <code class="calibre26">$HOME</code> directory. Although this may be tempting, the <code class="calibre26">$HOME</code> directory contains lots of configuration and temporary files related to the graphical desktop. It creates a much larger archive file than you probably intended. Pick a subdirectory in which to store your working files, and use that subdirectory in your archive configuration file.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">You can have the script read through the configuration file and add the names of each directory to the archive list. To do this, use the simple <code class="calibre26">read</code> command (see Chapter 14) to read each record from the file. But instead of using the <code class="calibre26">cat</code> command piped into a <code class="calibre26">while</code> loop (see Chapter 13), this script redirects standard input (<code class="calibre26">STDIN</code>) using the <code class="calibre26">exec</code> command (see Chapter 15). Here's how it looks:</p>
<pre class="calibre29"><code class="calibre26">exec &lt; $CONFIG_FILE
read FILE_NAME</code></pre>
<p class="calibre10">Notice that a variable is used for the archive configuration file, <code class="calibre26">CONFIG_FILE</code>. Each record is read in from the configuration file. As long as the <code class="calibre26">read</code> command finds a new configuration file record to read, it returns an exit value of 0 for success in the <code class="calibre26">?</code> variable (see Chapter 11). You can use this as a test in a <code class="calibre26">while</code> loop in order to read all the records from the configuration file:</p>
<pre class="calibre29"><code class="calibre26">while [ $? -eq 0 ]
do
[...]
read FILE_NAME
done</code></pre>
<p class="calibre10">When the <code class="calibre26">read</code> command hits the end of the configuration file, it returns a non-zero status. At that point, the <code class="calibre26">while</code> loop is exited.</p>
<p class="calibre10">In the <code class="calibre26">while</code> loop, two things need to happen. First, you must add the directory name to your archive list. Even more important is to check to see if that directory even exists! It would be very easy to remove a directory from the filesystem and forget to update the archive configuration file. You can check a directory's existence using a simple <code class="calibre26">if</code> statement (see Chapter 12). If the directory does exist, it is added to the list of directories to archive, <code class="calibre26">FILE_LIST</code>. Otherwise, a warning message is issued. Here is what this <code class="calibre26">if</code> statement looks like:</p>
<pre class="calibre29"><code class="calibre26">if [ -f $FILE_NAME -o -d $FILE_NAME ]
        then
                # If file exists, add its name to the list.
                FILE_LIST=''$FILE_LIST $FILE_NAME''
        else
                # If file doesn't exist, issue warning
                echo
                echo ''$FILE_NAME, does not exist.''
                echo ''Obviously, I will not include it in this archive.''
                echo ''It is listed on line $FILE_NO of the config file.''
                echo ''Continuing to build archive list...''
                echo
        fi
#
        FILE_NO=$[$FILE_NO + 1]             # Increase Line/File number by one.</code></pre>
<p class="calibre10"><span type="pagebreak" title="648" id="calibre_link-976" class="calibre11"></span>Because a record in our archive configuration file can be a filename or a directory, the <code class="calibre26">if</code> statement tests for the existence of both, using the <code class="calibre26">-f</code> and the <code class="calibre26">-d</code> options. The <code class="calibre26">or</code> option, <code class="calibre26">-o</code>, allows for either the file's or the directory's existence test to return a non-zero status for the entire <code class="calibre26">if</code> statement to be treated as true.</p>
<p class="calibre10">To provide a little extra help in tracking down non-existent directories and files, the variable <code class="calibre26">FILE_NO</code> is added. Thus, the script can tell you exactly what line number in the archive configuration file contains the incorrect or missing file or directory.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a daily archive location</h4>
<p class="calibre10">If you are just backing up a few files, it's fine to keep the archive in your personal directory. However, if several directories are being backed up, it is best to create a central repository archive directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo mkdir /archive</b></code>
[sudo] password for Christine:
$
$ <code class="calibre26"><b class="calibre21">ls -ld /archive</b></code>
drwxr-xr-x. 2 root root 4096 Aug 27 14:10 /archive
$</code></pre>
<p class="calibre10">After you have your central repository archive directory created, you need to grant access to it for certain users. If you do not do this, trying to create files in this directory fails, as shown here:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mv Files_To_Backup /archive/</b></code>
mv: cannot move 'Files_To_Backup' to
'/archive/Files_To_Backup': Permission denied
$</code></pre>
<p class="calibre10">You could grant the users needing to create files in this directory permission via <code class="calibre26">sudo</code> or create a user group. In this case, a <span type="pagebreak" title="649" id="calibre_link-977" class="calibre11"></span>special user group is created, <code class="calibre26">Archivers</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo groupadd Archivers</b></code>
$
$ <code class="calibre26"><b class="calibre21">sudo chgrp Archivers /archive</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -ld /archive</b></code>
drwxr-xr-x. 2 root Archivers 4096 Aug 27 14:10 /archive
$
$ <code class="calibre26"><b class="calibre21">sudo usermod -aG Archivers Christine</b></code>
[sudo] password for Christine:
$
$ <code class="calibre26"><b class="calibre21">sudo chmod 775 /archive</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -ld /archive</b></code>
drwxrwxr-x. 2 root Archivers 4096 Aug 27 14:10 /archive
$</code></pre>
<p class="calibre10">After a user has been added to the <code class="calibre26">Archivers</code> group, the user must log out and log back in for the group membership to take effect. Now files can be created by this group's members without the use of super-user privileges:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mv Files_To_Backup /archive/</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls /archive</b></code>
Files_To_Backup
$</code></pre>
<p class="calibre10">Keep in mind that all <code class="calibre26">Archivers</code> group members can add and delete files from this directory. It may be best to add the sticky bit (see Chapter 7) to the directory, in order to keep group members from deleting each other's archive tarballs.</p>
<p class="calibre10">You should now have enough information to start building the script. The next section walks you through creating the daily archive script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a daily archive script</h4>
<p class="calibre10">The <code class="calibre26">Daily_Archive.sh</code> script automatically creates an archive to a designated location, using the current date to uniquely identify the file. Here's the code for that portion of the script:</p>
<pre class="calibre29"><code class="calibre26">DATE=$(date +%y%m%d)
#
# Set Archive File Name
#
FILE=archive$DATE.tar.gz
#
# Set Configuration and Destination File
#
CONFIG_FILE=/archive/Files_To_Backup
DESTINATION=/archive/$FILE
#</code></pre>
<p class="calibre10">The <code class="calibre26">DESTINATION</code> variable appends the full pathname for the archived file. The <code class="calibre26">CONFIG_FILE</code> variable points to the archive configuration file containing the directories to be archived. These both can be easily changed to alternate directories and files if needed.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19"><span type="pagebreak" title="650" id="calibre_link-978" class="calibre11"></span>When you are new to script writing and are presented with an entire script (as shown nearby), make a habit of reading through the whole script. Try to follow the logic and script flow. Note any script syntax or sections you have trouble understanding, and reread the chapter that covers that topic. This reviewing habit helps you to build your script writing skills much more quickly.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The <code class="calibre26">Daily_Archive.sh</code> script, all put together, now looks like this:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
# Daily_Archive - Archive designated files &amp; directories
########################################################
#
# Gather Current Date
#
DATE=$(date +%y%m%d)
#
# Set Archive File Name
#
FILE=archive$DATE.tar.gz
#
# Set Configuration and Destination File
#
CONFIG_FILE=/archive/Files_To_Backup
DESTINATION=/archive/$FILE
#
######### Main Script #########################
#
# Check Backup Config file exists
#
if [ -f $CONFIG_FILE ]   # Make sure the config file still exists.
then                # If it exists, do nothing but continue on.
     echo
else                # If it doesn't exist, issue error &amp; exit script.
     echo
     echo "$CONFIG_FILE does not exist."
     echo "Backup not completed due to missing Configuration File"
     echo
     exit
fi
#
# Build the names of all the files to backup
#
FILE_NO=1               # Start on Line 1 of Config File.
exec &lt; $CONFIG_FILE     # Redirect Std Input to name of Config File
#
read FILE_NAME          # Read 1st record<span type="pagebreak" title="651" id="calibre_link-979" class="calibre11"></span>
#
while [ $? -eq 0 ]      # Create list of files to backup.
do
        # Make sure the file or directory exists.
     if [ -f $FILE_NAME -o -d $FILE_NAME ]
     then
          # If file exists, add its name to the list.
          FILE_LIST="$FILE_LIST $FILE_NAME"
     else
          # If file doesn't exist, issue warning
          echo
          echo "$FILE_NAME, does not exist."
          echo "Obviously, I will not include it in this archive."
          echo "It is listed on line $FILE_NO of the config file."
          echo "Continuing to build archive list..."
          echo
     fi
#
     FILE_NO=$[$FILE_NO + 1]  # Increase Line/File number by one.
     read FILE_NAME           # Read next record.
done
#
#######################################
#
# Backup the files and Compress Archive
#
echo "Starting archive..."
echo
#
tar -czf $DESTINATION $FILE_LIST 2&gt; /dev/null
#
echo "Archive completed"
echo "Resulting archive file is: $DESTINATION"
echo
#
exit</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">Running the daily archive script</h4>
<p class="calibre10">Before you attempt to test the script, remember that you need to change permissions on the script file (see Chapter 11). The file's owner must be given execute (<code class="calibre26">x</code>) privilege before the script can be run:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l Daily_Archive.sh</b></code>
-rw-rw-r--. 1 Christine Christine 1994 Aug 28 15:58 Daily_Archive.sh<span type="pagebreak" title="652" id="calibre_link-980" class="calibre11"></span>
$
$ <code class="calibre26"><b class="calibre21">chmod u+x Daily_Archive.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l Daily_Archive.sh</b></code>
-rwxrw-r--. 1 Christine Christine 1994 Aug 28 15:58 Daily_Archive.sh
$</code></pre>
<p class="calibre10">Testing the <code class="calibre26">Daily_Archive.sh</code> script is straightforward:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./Daily_Archive.sh</b></code>
/home/Does_not_exist, does not exist.
Obviously, I will not include it in this archive.
It is listed on line 3 of the config file.
Continuing to build archive list...
Starting archive...
Archive completed
Resulting archive file is: /archive/archive140828.tar.gz
$ <code class="calibre26"><b class="calibre21">ls /archive</b></code>
archive140828.tar.gz  Files_To_Backup
$</code></pre>
<p class="calibre10">You can see that the script caught one directory that does not exist, <code class="calibre26">/home/Does_not_exist</code>. It lets you know what line number in the configuration file this erroneous directory is on and continues making a list and archiving the data. Your data is now safely archived in a tarball file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating an hourly archive script</h4>
<p class="calibre10">If you are in a high-volume production environment where files are changing rapidly, a daily archive might not be good enough. If you want to increase the archiving frequency to hourly, you need to take another item into consideration.</p>
<p class="calibre10">When backing up files hourly and trying to use the <code class="calibre26">date</code> command to timestamp each tarball, things can get pretty ugly pretty quickly. Sifting through a directory of tarballs with filenames looking like this is tedious:</p>
<pre class="calibre29"><code class="calibre26">archive010211110233.tar.gz</code></pre>
<p class="calibre10">Instead of placing all the archive files in the same folder, you can create a directory hierarchy for your archived files. <a id="calibre_link-49" href="#calibre_link-48" class="calibre4">Figure 24.1</a> demonstrates this principle.</p>
<figure class="calibre23">
<img class="center" src="images/000034.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-48" href="#calibre_link-49" class="calibre4"><b class="calibre21">Figure 24.1</b></a></span> Creating an archive directory hierarchy</p>
</figcaption>
</figure>
<p class="calibre10">The archive directory contains directories <span type="pagebreak" title="653" id="calibre_link-981" class="calibre11"></span>for each month of the year, using the month number as the directory name. Each month's directory in turn contains folders for each day of the month (using the day's numerical value as the directory name). This allows you to just timestamp the individual tarballs and place them in the appropriate directory for the day and month.</p>
<p class="calibre10">First, the new directory <code class="calibre26">/archive/hourly</code> must be created, along with the appropriate permissions set upon it. Remember from early in this chapter that members of the <code class="calibre26">Archivers</code> group are granted permission to create archives in this directory area. Thus, the newly created directory must have its primary group and group permissions changed:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo mkdir /archive/hourly</b></code>
[sudo] password for Christine:
$
$ <code class="calibre26"><b class="calibre21">sudo chgrp Archivers /archive/hourly</b></code><span type="pagebreak" title="654" id="calibre_link-982" class="calibre11"></span>
$
$ <code class="calibre26"><b class="calibre21">ls -ld /archive/hourly/</b></code>
drwxr-xr-x. 2 root Archivers 4096 Sep  2 09:24 /archive/hourly/
$
$ <code class="calibre26"><b class="calibre21">sudo chmod 775 /archive/hourly</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -ld /archive/hourly</b></code>
drwxrwxr-x. 2 root Archivers 4096 Sep  2 09:24 /archive/hourly
$</code></pre>
<p class="calibre10">After the new directory is set up, the <code class="calibre26">Files_To_Backup</code> configuration file for the hourly archives can be moved to the new directory:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat Files_To_Backup</b></code>
/usr/local/Production/Machine_Errors
/home/Development/Simulation_Logs
$
$ <code class="calibre26"><b class="calibre21">mv Files_To_Backup /archive/hourly/</b></code>
$</code></pre>
<p class="calibre10">Now, there is a new challenge to solve. The script must create the individual month and day directories automatically. If these directories already exist, and the script tries to create them, an error is generated. This is not a desirable outcome!</p>
<p class="calibre10">If you peruse the command line options for the <code class="calibre26">mkdir</code> command (see Chapter 3), you'll find the <code class="calibre26">-p</code> command line option. This option allows you to create directories and subdirectories in a single command; plus, the added benefit is that it doesn't produce an error message if the directory already exists. Perfect fit for what is needed in the script!</p>
<p class="calibre10">We're now ready to create the <code class="calibre26">Hourly_Archive.sh</code> script. Here is the top half of the script:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
# Hourly_Archive - Every hour create an archive
#########################################################
#
# Set Configuration File
#
CONFIG_FILE=/archive/hourly/Files_To_Backup
#
# Set Base Archive Destination Location
#
BASEDEST=/archive/hourly
#
# Gather Current Day, Month &amp; Time
#
DAY=$(date +%d)
MONTH=$(date +%m)
TIME=$(date +%k%M)
#
# Create Archive Destination Directory<span type="pagebreak" title="655" id="calibre_link-983" class="calibre11"></span>
#
mkdir -p $BASEDEST/$MONTH/$DAY
#
# Build Archive Destination File Name
#
DESTINATION=$BASEDEST/$MONTH/$DAY/archive$TIME.tar.gz
#
########## Main Script ####################
[...]</code></pre>
<p class="calibre10">After the script reaches the âMain Scriptâ portion of <code class="calibre26">Hourly_Archive.sh</code>, the script is an exact duplicate of the <code class="calibre26">Daily_Archive.sh</code> script. Lots of the work has already been done!</p>
<p class="calibre10"><code class="calibre26">Hourly_Archive.sh</code> retrieves the day and month values from the <code class="calibre26">date</code> command, along with the timestamp used to uniquely identify the archive file. It then uses that information to create the archive directory for the day (or to silently exit if it already exists). Finally, the script uses the <code class="calibre26">tar</code> command to create the archive and compress it into a tarball.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Running the hourly archive script</h4>
<p class="calibre10">As with the <code class="calibre26">Daily_Archive.sh</code> script, it's a good idea to test the <code class="calibre26">Hourly_Archive.sh</code> script before putting it in the <code class="calibre26">cron</code> table. Before the script is run, the permissions must be modified. Also, the hour and minute is checked via the <code class="calibre26">date</code> command. Having the current hour and minute allows the final archive filename to be verified for correctness:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">chmod u+x Hourly_Archive.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">date +%k%M</b></code>
1011
$
$ <code class="calibre26"><b class="calibre21">./Hourly_Archive.sh</b></code>
Starting archive...
Archive completed
Resulting archive file is: /archive/hourly/09/02/archive1011.tar.gz
$
$ <code class="calibre26"><b class="calibre21">ls /archive/hourly/09/02/</b></code>
archive1011.tar.gz
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="656" id="calibre_link-984" class="calibre11"></span>The script worked fine the first time, creating the appropriate month and day directories, and then creating the properly named archive file. Notice that the archive file has the appropriate hour (<code class="calibre26">10</code>) and minute (<code class="calibre26">11</code>) in its name, <code class="calibre26">archive1011.tar.gz</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If you run the <code class="calibre26">Hourly_Archive.sh</code> script during the day, when the hour is in single digits, your archive file's name will only have three digits. For example, if you run the script at 1:15am, the archive file's name is <code class="calibre26">archive115.tar.gz</code>. If you prefer to always have four digits in the archive file name, modify the script line, <code class="calibre26">TIME=$(date +%k%M)</code>, to <code class="calibre26">TIME=$(date +%k0%M)</code>. By adding a zero (<code class="calibre26">0</code>) after the <code class="calibre26">%k</code>, any single digit hours are padded to two digits with a leading zero. Thus, <code class="calibre26">archive115.tar.gz</code> is instead named <code class="calibre26">archive0115 .tar.gz</code>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Just to test things out, the script was run a second time to see if it would have a problem with the existing directory, <code class="calibre26">/archive,hourly/09/02</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">date +%k%M</b></code>
1017
$
$ <code class="calibre26"><b class="calibre21">./Hourly_Archive.sh</b></code>
Starting archive...
Archive completed
Resulting archive file is: /archive/hourly/09/02/archive1017.tar.gz
$ <code class="calibre26"><b class="calibre21">ls /archive/hourly/09/02/</b></code>
archive1011.tar.gz  archive1017.tar.gz
$</code></pre>
<p class="calibre10">No problems with the existing directory! The script again ran fine and created a second archive file. It's now ready for the <code class="calibre26">cron</code> table.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-303" class="calibre4"></a>Managing User Accounts</h2>
<p class="calibre10">Managing user accounts is much more than just adding, modifying, and deleting accounts. You must also consider security issues, the need to preserve work, and the accurate management of the accounts. This can be a time-consuming task. Here is another instance when writing script utilities is a real timesaver!</p>
<section class="toclist">
<h3 class="calibre15">Obtaining the required functions</h3>
<p class="calibre10"><span type="pagebreak" title="657" id="calibre_link-985" class="calibre11"></span>Deleting an account is the more complicated accounts management task. When deleting an account, at least four separate actions are required:</p>
<ol class="calibre6">
<li class="calibre7">Obtain the correct user account name to delete.</li>
<li class="calibre7">Kill any processes currently running on the system that belongs to that account.</li>
<li class="calibre7">Determine all files on the system belonging to the account.</li>
<li class="calibre7">Remove the user account.</li>
</ol>
<p class="calibre10">It's easy to miss a step. The shell script utility in this section helps you avoid making such mistakes.</p>
<section class="toclist">
<h4 class="calibre25">Getting the correct account name</h4>
<p class="calibre10">The first step in the account deletion process is the most important: obtaining the correct user account name to delete. Because this is an interactive script, you can use the <code class="calibre26">read</code> command (see Chapter 14) to obtain the account name. If the script user walks away and leaves the question hanging, you can use the <code class="calibre26">-t</code> option on the <code class="calibre26">read</code> command and timeout after giving the script user 60 seconds to answer the question:</p>
<pre class="calibre29"><code class="calibre26">echo "Please enter the username of the user "
echo -e "account you wish to delete from system: \c"
read -t 60 ANSWER</code></pre>
<p class="calibre10">Because interruptions are part of life, it's best to give users three chances to answer the question. This is accomplished by using a <code class="calibre26">while</code> loop (Chapter 13) with the <code class="calibre26">-z</code> option, to test whether the <code class="calibre26">ANSWER</code> variable is empty. The <code class="calibre26">ANSWER</code> variable is empty when the script first enters the <code class="calibre26">while</code> loop on purpose. The question to fill the <code class="calibre26">ANSWER</code> variable is at the end of the loop:</p>
<pre class="calibre29"><code class="calibre26">while [ -z "$ANSWER" ]
do
[...]
echo "Please enter the username of the user "
echo -e "account you wish to delete from system: \c"
read -t 60 ANSWER
done</code></pre>
<p class="calibre10">A way to communicate with the script user is needed when the first question timeout occurs, when there is one more chance to answer the question, and so on. The <code class="calibre26">case</code> statement (see Chapter 12) is the structured command that works perfectly here. Using the <span type="pagebreak" title="658" id="calibre_link-986" class="calibre11"></span>incremented <code class="calibre26">ASK_COUNT</code> variable, different messages can be set up to communicate to the script user. The code for this section looks like this:</p>
<pre class="calibre29"><code class="calibre26">case $ASK_COUNT in
2)
     echo
     echo "Please answer the question."
     echo
;;
3)
     echo
     echo "One last try...please answer the question."
     echo
;;
4)
     echo
     echo "Since you refuse to answer the question..."
     echo "exiting program."
     echo
     #
     exit
;;
esac
#</code></pre>
<p class="calibre10">Now the script has all the structure it needs to ask the user what account to delete. There are several more questions in this script to ask the user and asking just that one question was lots of code! Therefore, let's turn this piece of code into a function (see Chapter 17) in order to use it in multiple locations in your <code class="calibre26">Delete_User.sh</code> script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a function to get the correct account name</h4>
<p class="calibre10">The first thing you need to do is declare the function's name, <code class="calibre26">get_answer</code>. Next, clear out any previous answers to questions your script user gave using the <code class="calibre26">unset</code> command (see Chapter 6). The code to do these two items looks like this:</p>
<pre class="calibre29"><code class="calibre26">function get_answer {
#
unset ANSWER</code></pre>
<p class="calibre10">The other original code item you need to change is the question to the script user. The script doesn't ask the same question each time, so two new variables are created, <code class="calibre26">LINE1</code> and <code class="calibre26">LINE2</code>, to handle question lines:</p>
<pre class="calibre29"><code class="calibre26">echo $LINE1
echo -e $LINE2" \c"</code></pre>
<p class="calibre10"><span type="pagebreak" title="659" id="calibre_link-987" class="calibre11"></span>However, not every question has two lines to display. Some have only one line. An <code class="calibre26">if</code> statement (see Chapter 12) assists with this problem. The function tests if <code class="calibre26">LINE2</code> is empty and only uses <code class="calibre26">LINE1</code> if it is:</p>
<pre class="calibre29"><code class="calibre26">if [ -n "$LINE2" ]
then
     echo $LINE1
     echo -e $LINE2" \c"
else
     echo -e $LINE1" \c"
fi</code></pre>
<p class="calibre10">Finally, the function needs to clean up after itself by clearing out the <code class="calibre26">LINE1</code> and <code class="calibre26">LINE2</code> variables. Thus, the function now looks like this:</p>
<pre class="calibre29"><code class="calibre26">function get_answer {
#
unset ANSWER
ASK_COUNT=0
#
while [ -z "$ANSWER" ]
do
     ASK_COUNT=$[ $ASK_COUNT + 1 ]
#
     case $ASK_COUNT in
     2)
           echo
[...]
     esac
#
     echo
     if [ -n "$LINE2" ]
     then                 #Print 2 lines
           echo $LINE1
           echo -e $LINE2" \c"
     else                    #Print 1 line
           echo -e $LINE1" \c"
     fi
#
     read -t 60 ANSWER
done
#
unset LINE1
unset LINE2
#
}  #End of get_answer function</code></pre>
<p class="calibre10"><span type="pagebreak" title="660" id="calibre_link-988" class="calibre11"></span>To ask the script user what account to delete, a few variables must be set and the <code class="calibre26">get_answer</code> function should be called. Using the new function makes the script code much simpler:</p>
<pre class="calibre29"><code class="calibre26">LINE1="Please enter the username of the user "
LINE2="account you wish to delete from system:"
get_answer
USER_ACCOUNT=$ANSWER</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">Verifying the entered account name</h4>
<p class="calibre10">Because of potential typographical errors, the user account name that was entered should be verified. This is easy because the code is already in place to handle asking a question:</p>
<pre class="calibre29"><code class="calibre26">LINE1="Is $USER_ACCOUNT the user account "
LINE2="you wish to delete from the system? [y/n]"
get_answer</code></pre>
<p class="calibre10">After the question is asked, the script must process the answer. The variable <code class="calibre26">ANSWER</code> again carries the script user's answer to the question. If the user answered âyes,â the correct user account to delete has been entered and the script can continue. A <code class="calibre26">case</code> statement (see Chapter 12) processes the answer. The <code class="calibre26">case</code> statement must be coded so it checks for the multiple ways the answer âyesâ can be entered.</p>
<pre class="calibre29"><code class="calibre26">case $ANSWER in
y|Y|YES|yes|Yes|yEs|yeS|YEs|yES )
#
;;
*)
       echo
       echo ''Because the account, $USER_ACCOUNT, is not ''
       echo ''the one you wish to delete, we are leaving the script...''
       echo
       exit
;;
esac</code></pre>
<p class="calibre10">Sometimes, this script needs to handle a yes/no answer from the user. Thus, again, it makes sense to create a function to handle this task. Only a few changes need to be made to the preceding code. The function's name must be declared and the variables <code class="calibre26">EXIT_LINE1</code> and <code class="calibre26">EXIT_LINE2</code> added to the <code class="calibre26">case</code> statement. These changes, along with some variable cleanup at the end, result in the <code class="calibre26">process_answer</code> function:</p>
<pre class="calibre29"><code class="calibre26">function process_answer {<span type="pagebreak" title="661" id="calibre_link-989" class="calibre11"></span>
#
case $ANSWER in
y|Y|YES|yes|Yes|yEs|yeS|YEs|yES )
;;
*)
        echo
        echo $EXIT_LINE1
        echo $EXIT_LINE2
        echo
        exit
;;
esac
#
unset EXIT_LINE1
unset EXIT_LINE2
#
} #End of process_answer function</code></pre>
<p class="calibre10">A simple function call now processes the answer:</p>
<pre class="calibre29"><code class="calibre26">EXIT_LINE1=''Because the account, $USER_ACCOUNT, is not ''
EXIT_LINE2=''the one you wish to delete, we are leaving the script...''
process_answer</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">Determining whether the account exists</h4>
<p class="calibre10">The user has given us the name of the account to delete and has verified it. Now is a good time to double-check that the user account really exists on the system. Also, it is a good idea to show the full account record to the script user to check one more time that this is the account to delete. To accomplish these items, a variable, <code class="calibre26">USER_ACCOUNT_RECORD</code>, is set to the outcome of a <code class="calibre26">grep</code> (see Chapter 4) search for the account through the <code class="calibre26">/etc/passwd</code> file. The <code class="calibre26">-w</code> option allows an exact word match for this particular user account:</p>
<pre class="calibre29"><code class="calibre26">USER_ACCOUNT_RECORD=$(cat /etc/passwd | grep -w $USER_ACCOUNT)</code></pre>
<p class="calibre10">If no user account record is found in <code class="calibre26">/etc/passwd</code>, the account has already been deleted or never existed in the first place. In either case, the script user must be notified of this situation and the script exited. The exit status of the <code class="calibre26">grep</code> command helps here. If the account record is not found, the <code class="calibre26">?</code> variable is set to 1:</p>
<pre class="calibre29"><code class="calibre26">if [ $? -eq 1 ]
then
     echo
     echo "Account, $USER_ACCOUNT, not found. "
     echo "Leaving the script..."
     echo
     exit
fi </code></pre>
<p class="calibre10">If the record was found, you still need to verify with the script user that this is the correct account. Here is where all the work to set up the functions really pays off! You just need to set the proper variables and call the functions:</p>
<pre class="calibre29"><code class="calibre26">echo ''I found this record:''
echo $USER_ACCOUNT_RECORD
echo
#
LINE1=''Is this the correct User Account? [y/n]''
get_answer
#
EXIT_LINE1=''Because the account, $USER_ACCOUNT, is not''
EXIT_LINE2=''the one you wish to delete, we are leaving the script...''
process_answer</code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">Removing any account processes</h4>
<p class="calibre10"><span type="pagebreak" title="662" id="calibre_link-990" class="calibre11"></span>So far, the script has obtained and verified the correct name of the user account to be deleted. In order to remove the user account from the system, the account cannot own any processes currently running. Thus, the next step is to find and kill off those processes. This is going to get a little complicated!</p>
<p class="calibre10">Finding the user processes is the easy part. Here the script can use the <code class="calibre26">ps</code> command (see Chapter 4) and the <code class="calibre26">-u</code> option to locate any running processes owned by the account. By redirecting the output to <code class="calibre26">/dev/null</code>, the user doesn't see any display. This is handy, because if there are no processes, the <code class="calibre26">ps</code> command only shows a header, which can be confusing to the script user:</p>
<pre class="calibre29"><code class="calibre26">ps -u $USER_ACCOUNT &gt;/dev/null #Are user processes running?</code></pre>
<p class="calibre10">The <code class="calibre26">ps</code> command's exit status and a <code class="calibre26">case</code> structure are used to determine the next step to take:</p>
<pre class="calibre29"><code class="calibre26">case $? in
1)   # No processes running for this User Account
     #
     echo ''There are no processes for this account currently running.''
     echo
;;
0)   # Processes running for this User Account.
     # Ask Script User if wants us to kill the processes.
     #
     echo ''$USER_ACCOUNT has the following processes running: ''
     echo
     ps -u $USER_ACCOUNT
     #
     LINE1=''Would you like me to kill the process(es)? [y/n]''
     get_answer
     #
[...]
esac</code></pre>
<p class="calibre10">If the <code class="calibre26">ps</code> command's exit status returns a <code class="calibre26">1</code>, there are no processes running on the system that belong to the user account. However, if the exit status returns a <code class="calibre26">0</code>, processes owned by <span type="pagebreak" title="663" id="calibre_link-991" class="calibre11"></span>this account are running on the system. In this case, the script needs to ask the script user if he would like to have these processes killed. This task can be accomplished by using the <code class="calibre26">get_answer</code> function.</p>
<p class="calibre10">You might think that the next action the script does is to call the <code class="calibre26">process_answer</code> function. Unfortunately, the next item is too complicated for <code class="calibre26">process_answer</code>. Another <code class="calibre26">case</code> statement must be embedded to process the script user's answer. The first part of the <code class="calibre26">case</code> statement looks very similar to the <code class="calibre26">process_answer</code> function:</p>
<pre class="calibre29"><code class="calibre26">case $ANSWER in
     y|Y|YES|yes|Yes|yEs|yeS|YEs|yES ) # If user answers ''yes'',
                                        #kill User Account processes.
[...]
;;
*)   # If user answers anything but ''yes'', do not kill.
     echo
     echo ''Will not kill the process(es)''
     echo
;;
esac</code></pre>
<p class="calibre10">As you can see, there is nothing interesting in the <code class="calibre26">case</code> statement itself. Where things get interesting is within the âyesâ section of the <code class="calibre26">case</code> statement. Here, the user account processes need to be killed. To build the command necessary to kill off one or more processes, three commands are needed. The first command is the <code class="calibre26">ps</code> command again. It is needed to gather up the process IDs (PIDs) of the currently running user account processes. The necessary <code class="calibre26">ps</code> command is assigned to the variable, <code class="calibre26">COMMAND_1</code>:</p>
<pre class="calibre29"><code class="calibre26">COMMAND_1="ps -u $USER_ACCOUNT --no-heading"</code></pre>
<p class="calibre10">The second command strips off just the PIDs. This simple <code class="calibre26">gawk</code> command (see Chapter 19) strips off the first field from the <code class="calibre26">ps</code> command's output, which happens to be the PIDs:</p>
<pre class="calibre29"><code class="calibre26">gawk '{print $1}' </code></pre>
<p class="calibre10">The third command, <code class="calibre26">xargs</code>, has not yet been introduced in this book. The <code class="calibre26">xargs</code> command builds and executes commands from standard input, <code class="calibre26">STDIN</code> (see Chapter 15). It is a great command to use at the end of a pipe, building and executing commands from each <code class="calibre26">STDIN</code> item produced. The <code class="calibre26">xargs</code> command is actually killing off each process via its PID:</p>
<pre class="calibre29"><code class="calibre26">COMMAND_3="xargs -d [[Backslash Backslash]]n /usr/bin/sudo /bin/kill -9"</code></pre>
<p class="calibre10">The <code class="calibre26">xargs</code> command is assigned to variable <code class="calibre26">COMMAND_3</code>. It uses the <code class="calibre26">-d</code> option to denote what is considered a delimiter. In other words, because the <code class="calibre26">xargs</code> command can accept multiple items as input, what separates one item from another item? In this case, <code class="calibre26">ân</code> (newline) is used to set the delimiter. Thus, when each PID is sent to <code class="calibre26">xargs</code>, it treats the PID as a separate item to be processed. Because the <code class="calibre26">xargs</code> command is being assigned to a variable, the backslash (<code class="calibre26">â</code>) in the <code class="calibre26">ân</code> must be escaped with an additional backslash (<code class="calibre26">â</code>).</p>
<p class="calibre10"><span type="pagebreak" title="664" id="calibre_link-992" class="calibre11"></span>Notice that <code class="calibre26">xargs</code> needs the full pathname of the commands it is using on each PID. Both the <code class="calibre26">sudo</code> and <code class="calibre26">kill</code> (see Chapter 4) commands are used to kill any of the user account's running processes. Notice also that the kill signal <code class="calibre26">-9</code> is used.</p>
<p class="calibre10">All three commands are hooked together via a pipe. The <code class="calibre26">ps</code> command produces a list of the user's running processes, which include the PID of each process. The <code class="calibre26">ps</code> command passes its standard output (<code class="calibre26">STDOUT</code>) as <code class="calibre26">STDIN</code> to the <code class="calibre26">gawk</code> command. The <code class="calibre26">gawk</code> command, in turn, strips off only the PIDs from the <code class="calibre26">ps</code> command's <code class="calibre26">STDOUT</code> (see Chapter 15). The <code class="calibre26">xargs</code> command takes each PID the <code class="calibre26">gawk</code> command produces as <code class="calibre26">STDIN</code>. It creates and executes a <code class="calibre26">kill</code> command for each PID to kill all the user's running processes. The command pipe looks like this:</p>
<pre class="calibre29"><code class="calibre26">$COMMAND_1 | gawk '{print $1}' | $COMMAND_3</code></pre>
<p class="calibre10">Thus, the complete <code class="calibre26">case</code> statement for killing off any of the user account's running processes is as follows:</p>
<pre class="calibre29"><code class="calibre26">case $ANSWER in
     y|Y|YES|yes|Yes|yEs|yeS|YEs|yES ) # If user answers "yes",
                                        #kill User Account processes.
       echo
       echo "Killing off process(es)..."
       #
       # List user processes running code in variable, COMMAND_1
       COMMAND_1="ps -u $USER_ACCOUNT --no-heading"
       #
       # Create command to kill proccess in variable, COMMAND_3
       COMMAND_3="xargs -d [[Backslash Backslash]]n /usr/bin/sudo /bin/kill -9"
       #
       # Kill processes via piping commands together
       $COMMAND_1 | gawk '{print $1}' | $COMMAND_3
       #
       echo
       echo "Process(es) killed."
     ;;</code></pre>
<p class="calibre10">By far, this is the most complicated piece of the script! However, now with any user account&ndash;owned processes killed, the script can move on to the next step: finding all the user account's files.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Finding account files</h4>
<p class="calibre10">When a user account is deleted from the system, it is a good practice to archive all the files that belonged to that account. Along with that practice, it is also important to remove the files or assign their ownership to another account. If the account you delete has a User ID of 1003, <span type="pagebreak" title="665" id="calibre_link-993" class="calibre11"></span>and you don't remove or reassign those files, then the next account that is created with a User ID of 1003 owns those files! You can see the security disasters that can occur in this scenario.</p>
<p class="calibre10">The <code class="calibre26">Delete_User.sh</code> script doesn't do all that for you, but it creates a report that can be used in the <code class="calibre26">Daily_Archive.sh</code> script as an archive configuration file. And you can use the report to help you remove or reassign the files.</p>
<p class="calibre10">To find the user's files, you can use the <code class="calibre26">find</code> command. In this case, the <code class="calibre26">find</code> command searches the entire filesystem with the <code class="calibre26">-u</code> option, which pinpoints any user account&ndash;owned files. The command looks like the following:</p>
<pre class="calibre29"><code class="calibre26">find / -user $USER_ACCOUNT &gt; $REPORT_FILE</code></pre>
<p class="calibre10">That was pretty simple compared to dealing with the user account processes! It gets even easier in the next step of the <code class="calibre26">Delete_User.sh</code> script: actually removing the user account.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Removing the account</h4>
<p class="calibre10">It's always a good idea to be a little paranoid about removing a user account from the system. Therefore, you should ask one more time if the script user really wants to remove the account.</p>
<pre class="calibre29"><code class="calibre26">LINE1=''Remove $User_Account's account from system? [y/n]''
get_answer
#
EXIT_LINE1=''Since you do not wish to remove the user account,''
EXIT_LINE2=''$USER_ACCOUNT at this time, exiting the script...''
process_answer</code></pre>
<p class="calibre10">Finally, we get to the main purpose of our script, actually removing the user account from the system. Here the <code class="calibre26">userdel</code> command (see Chapter 7) is used:</p>
<pre class="calibre29"><code class="calibre26">userdel $USER_ACCOUNT</code></pre>
<p class="calibre10">Now that we have all the pieces, we are ready to put them together into a whole, useful script utility.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Creating the script</h3>
<p class="calibre10">Recall that the <code class="calibre26">Delete_User.sh</code> script is highly interactive with the script's user. Therefore, it is important to include lots of verbiage to keep the script user informed about what is going on during the script's execution.</p>
<p class="calibre10">At the top of the script, the two functions <code class="calibre26">get_answer</code> and <code class="calibre26">process_answer</code> are declared. The script then goes to the four steps of removing the user: obtaining and <span type="pagebreak" title="666" id="calibre_link-994" class="calibre11"></span>confirming the user account name, finding and killing the user's processes, creating a report of all files owned by the user account, and actually removing the user account.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">When you are new to script writing and are presented with an entire script (as shown in the following code), you should make a habit of reading through the whole script to improve your script-writing skills!</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Here's the entire <code class="calibre26">Delete_User.sh</code> script:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
#Delete_User - Automates the 4 steps to remove an account
#
###############################################################
# Define Functions
#
#####################################################
function get_answer {
#
unset ANSWER
ASK_COUNT=0
#
while [ -z ''$ANSWER'' ]    #While no answer is given, keep asking.
do
     ASK_COUNT=$[ $ASK_COUNT + 1 ]
#
     case $ASK_COUNT in   #If user gives no answer in time allotted
     2)
          echo
          echo ''Please answer the question.''
          echo
     ;;
     3)
          echo
          echo ''One last try...please answer the question.''
          echo
     ;;
     4)
          echo
          echo ''Since you refuse to answer the question...''
          echo ''exiting program.''
          echo
          #
          exit
     ;;
     esac
#
     echo<span type="pagebreak" title="667" id="calibre_link-995" class="calibre11"></span>
#
     if [ -n ''$LINE2'' ]
     then               #Print 2 lines
          echo $LINE1
          echo -e $LINE2'' \c''
     else                    #Print 1 line
          echo -e $LINE1'' \c''
     fi
#
#     Allow 60 seconds to answer before time-out
     read -t 60 ANSWER
done
# Do a little variable clean-up
unset LINE1
unset LINE2
#
}  #End of get_answer function
#
#####################################################
function process_answer {
#
case $ANSWER in
y|Y|YES|yes|Yes|yEs|yeS|YEs|yES )
# If user answers ''yes'', do nothing.
;;
*)
# If user answers anything but ''yes'', exit script
        echo
        echo $EXIT_LINE1
        echo $EXIT_LINE2
        echo
        exit
;;
esac
#
# Do a little variable clean-up
#
unset EXIT_LINE1
unset EXIT_LINE2
#
} #End of process_answer function
#
##############################################
# End of Function Definitions
#
############# Main Script ####################
# Get name of User Account to check
#
echo ''Step #1 - Determine User Account name to Delete ''<span type="pagebreak" title="668" id="calibre_link-996" class="calibre11"></span>
echo
LINE1=''Please enter the username of the user ''
LINE2=''account you wish to delete from system:''
get_answer
USER_ACCOUNT=$ANSWER
#
# Double check with script user that this is the correct User Account
#
LINE1=''Is $USER_ACCOUNT the user account ''
LINE2=''you wish to delete from the system? [y/n]''
get_answer
#
# Call process_answer funtion:
#     if user answers anything but ''yes'', exit script
#
EXIT_LINE1=''Because the account, $USER_ACCOUNT, is not ''
EXIT_LINE2=''the one you wish to delete, we are leaving the script...''
process_answer
#
################################################################
# Check that USER_ACCOUNT is really an account on the system
#
USER_ACCOUNT_RECORD=$(cat /etc/passwd | grep -w $USER_ACCOUNT)
#
if [ $? -eq 1 ]  # If the account is not found, exit script
then
     echo
     echo ''Account, $USER_ACCOUNT, not found. ''
     echo ''Leaving the script...''
     echo
     exit
fi
#
echo
echo ''I found this record:''
echo $USER_ACCOUNT_RECORD
#
LINE1=''Is this the correct User Account? [y/n]''
get_answer
#
#
# Call process_answer function:
#  if user answers anything but ''yes'', exit script
#
EXIT_LINE1=''Because the account, $USER_ACCOUNT, is not ''
EXIT_LINE2=''the one you wish to delete, we are leaving the script...''
process_answer
#
##################################################################
# Search for any running processes that belong to the User Account<span type="pagebreak" title="669" id="calibre_link-997" class="calibre11"></span>
#
echo
echo ''Step #2 - Find process on system belonging to user account''
echo
#
ps -u $USER_ACCOUNT &gt;/dev/null #Are user processes running?
#
case $? in
1)   # No processes running for this User Account
     #
     echo ''There are no processes for this account currently running.''
     echo
;;
0)   # Processes running for this User Account.
     # Ask Script User if wants us to kill the processes.
     #
     echo ''$USER_ACCOUNT has the following processes running: ''
     echo
     ps -u $USER_ACCOUNT
     #
     LINE1=''Would you like me to kill the process(es)? [y/n]''
     get_answer
     #
     case $ANSWER in
     y|Y|YES|yes|Yes|yEs|yeS|YEs|yES )  # If user answers ''yes'',
                                        # kill User Account processes.
       #
       echo
       echo ''Killing off process(es)...''
       #
       # List user processes running code in variable, COMMAND_1
       COMMAND_1=''ps -u $USER_ACCOUNT --no-heading''
       #
       # Create command to kill proccess in variable, COMMAND_3
       COMMAND_3=''xargs -d [[Backslash Backslash]]n /usr/bin/sudo /bin/kill -9''
       #
       # Kill processes via piping commands together
       $COMMAND_1 | gawk '{print $1}' | $COMMAND_3
       #
       echo
       echo ''Process(es) killed.''
     ;;
     *)   # If user answers anything but ''yes'', do not kill.
          echo
          echo ''Will not kill the process(es)''
          echo
     ;;
     esac
;;
esac
#################################################################
# Create a report of all files owned by User Account<span type="pagebreak" title="670" id="calibre_link-998" class="calibre11"></span>
#
echo
echo ''Step #3 - Find files on system belonging to user account''
echo
echo ''Creating a report of all files owned by $USER_ACCOUNT.''
echo
echo ''It is recommended that you backup/archive these files,''
echo ''and then do one of two things:''
echo ''  1) Delete the files''
echo ''  2) Change the files' ownership to a current user account.''
echo
echo ''Please wait. This may take a while...''
#
REPORT_DATE=$(date +%y%m%d)
REPORT_FILE=$USER_ACCOUNT''_Files_''$REPORT_DATE''.rpt''
#
find / -user $USER_ACCOUNT &gt; $REPORT_FILE 2&gt;/dev/null
#
echo
echo ''Report is complete.''
echo ''Name of report:      $REPORT_FILE''
echo ''Location of report:  $(pwd)''
echo
####################################
#  Remove User Account
echo
echo ''Step #4 - Remove user account''
echo
#
LINE1=''Remove $USER_ACCOUNT's account from system? [y/n]''
get_answer
#
# Call process_answer function:
#       if user answers anything but ''yes'', exit script
#
EXIT_LINE1=''Since you do not wish to remove the user account,''
EXIT_LINE2=''$USER_ACCOUNT at this time, exiting the script...''
process_answer
#
userdel $USER_ACCOUNT          #delete user account
echo
echo ''User account, $USER_ACCOUNT, has been removed''
echo
#
exit</code></pre>
<p class="calibre10"><span type="pagebreak" title="671" id="calibre_link-999" class="calibre11"></span>That was lots of work! However, the <code class="calibre26">Delete_User.sh</code> script is a great timesaver and helps you avoid lots of nasty problems when deleting user accounts.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Running the script</h3>
<p class="calibre10">Because it is intended to be an interactive script, the <code class="calibre26">Delete_User.sh</code> script should not be placed in the <code class="calibre26">cron</code> table. However, it is still important to ensure that it works as expected.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">To run this type of script, you must either be logged in as the root user account or use the <code class="calibre26">sudo</code> command to run the script as the root user account.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Before the script is tested, the appropriate permissions are set on the script's file:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">chmod u+x Delete_User.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">ls -l Delete_User.sh</b></code>
-rwxr--r--. 1 Christine Christine 6413 Sep  2 14:20 Delete_User.sh
$</code></pre>
<p class="calibre10">The script is tested by removing an account, <code class="calibre26">Consultant</code>, that was set up for a temporary consultant on this system:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo ./Delete_User.sh</b></code>
[sudo] password for Christine:
Step #1 - Determine User Account name to Delete
Please enter the username of the user
account you wish to delete from system: <code class="calibre26"><b class="calibre21">Consultant</b></code>
Is Consultant the user account
you wish to delete from the system? [y/n]
Please answer the question.
Is Consultant the user account
you wish to delete from the system? [y/n] <code class="calibre26"><b class="calibre21">y</b></code>
I found this record:
Consultant:x:504:506::/home/Consultant:/bin/bash
Is this the correct User Account? [y/n] <code class="calibre26"><b class="calibre21">yes</b></code>
Step #2 - Find process on system belonging to user account
Consultant has the following processes running:
  PID TTY          TIME CMD
 5443 pts/0    00:00:00 bash
 5444 pts/0    00:00:00 sleep
 
Would you like me to kill the process(es)? [y/n] <code class="calibre26"><b class="calibre21">Yes</b></code><span type="pagebreak" title="672" id="calibre_link-1000" class="calibre11"></span>
Killing off process(es)...
Process(es) killed.
Step #3 - Find files on system belonging to user account
Creating a report of all files owned by Consultant.
It is recommended that you backup/archive these files,
and then do one of two things:
  1) Delete the files
  2) Change the files' ownership to a current user account.
  
Please wait. This may take a while...
Report is complete.
Name of report:      Consultant_Files_140902.rpt
Location of report:  /home/Christine
Step #4 - Remove user account
Remove Consultant's account from system? [y/n] <code class="calibre26"><b class="calibre21">y</b></code>
User account, Consultant, has been removed
$
$ <code class="calibre26"><b class="calibre21">ls Consultant*.rpt</b></code>
Consultant_Files_140902.rpt
$
$ <code class="calibre26"><b class="calibre21">cat Consultant_Files_140902.rpt</b></code>
/home/Consultant
/home/Consultant/Project_393
/home/Consultant/Project_393/393_revisionQ.py
/home/Consultant/Project_393/393_Final.py
[...]
/home/Consultant/.bashrc
/var/spool/mail/Consultant
$
$ <code class="calibre26"><b class="calibre21">grep Consultant /etc/passwd</b></code>
$</code></pre>
<p class="calibre10">That worked great! Notice the script <span type="pagebreak" title="673" id="calibre_link-1001" class="calibre11"></span>was run using <code class="calibre26">sudo</code>, because super-user privileges are needed for deleting accounts. Also notice that the <code class="calibre26">read</code> timeout was tested, by delaying answering the following question:</p>
<pre class="calibre29"><code class="calibre26">Is Consultant the user account
you wish to delete from the system? [y/n]
Please answer the question.</code></pre>
<p class="calibre10">Note that several different versions of âyesâ answers were used for the various questions to ensure that the <code class="calibre26">case</code> statement test was working correctly. And finally, notice that the <code class="calibre26">Consultant</code> user's files were found and put into a report file, and the account was deleted.</p>
<p class="calibre10">Now you have a script utility that assists you when you need to delete user accounts. Even better, you can modify it to meet your organization's needs!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-304" class="calibre4"></a>Monitoring Disk Space</h2>
<p class="calibre10">One of the biggest problems with multi-user Linux systems is the amount of available disk space. In some situations, such as in a file-sharing server, disk space can fill up almost immediately just because of one careless user.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you have a production Linux system, you should not depend upon disk space reports to protect your server from its disk space filling up. Instead, consider setting disk quotas. If the <code class="calibre26">quota</code> package is installed, you can find out more information about managing disk quotas by typing <code class="calibre26"><b class="calibre21">man -k quota</b></code> at the shell prompt. If the <code class="calibre26">quota</code> package is not currently installed on your system, use your favorite search engine instead to locate further information.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">This shell script utility helps you determine the top ten disk space consumers for designated directories. It produces a date-stamped report that allows disk space consumption trends to be monitored.</p>
<section class="toclist">
<h3 class="calibre15">Obtaining the required functions</h3>
<p class="calibre10">The first tool you need to use is the <code class="calibre26">du</code> command (see Chapter 4). This command displays the disk usage for individual files and directories. The <code class="calibre26">-s</code> option lets you summarize totals at the directory level. This comes in handy when calculating the total disk space used by an individual user. Here's what it looks like to use the <code class="calibre26">du</code> command to summarize each user's <code class="calibre26">$HOME</code> directory for the <code class="calibre26">/home</code> directory contents:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo du -s /home/*</b></code>
[sudo] password for Christine:
4204    /home/Christine<span type="pagebreak" title="674" id="calibre_link-1002" class="calibre11"></span>
56      /home/Consultant
52      /home/Development
4       /home/NoSuchUser
96      /home/Samantha
36      /home/Timothy
1024    /home/user1
$</code></pre>
<p class="calibre10">The <code class="calibre26">-s</code> option works well for users' <code class="calibre26">$HOME</code> directories, but what if we wanted to view disk consumption in a system directory such as <code class="calibre26">/var/log</code>?</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo du -s /var/log/*</b></code>
4       /var/log/anaconda.ifcfg.log
20      /var/log/anaconda.log
32      /var/log/anaconda.program.log
108     /var/log/anaconda.storage.log
40      /var/log/anaconda.syslog
56      /var/log/anaconda.xlog
116     /var/log/anaconda.yum.log
4392    /var/log/audit
4       /var/log/boot.log
[...]
$</code></pre>
<p class="calibre10">The listing quickly becomes too detailed. The <code class="calibre26">-S</code> (capital S) option works better for our purposes here, providing a total for each directory and subdirectory individually. This allows you to pinpoint problem areas quickly:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo du -S /var/log/</b></code>
4       /var/log/ppp
4       /var/log/sssd
3020    /var/log/sa<span type="pagebreak" title="675" id="calibre_link-1003" class="calibre11"></span>
80      /var/log/prelink
4       /var/log/samba/old
4       /var/log/samba
4       /var/log/ntpstats
4       /var/log/cups
4392    /var/log/audit
420     /var/log/gdm
4       /var/log/httpd
152     /var/log/ConsoleKit
2976    /var/log/
$</code></pre>
<p class="calibre10">Because we are interested in the directories consuming the biggest chunks of disk space, the <code class="calibre26">sort</code> command (see Chapter 4) is used on the listing produced by <code class="calibre26">du</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo du -S /var/log/ | sort -rn</b></code>
4392    /var/log/audit
3020    /var/log/sa
2976    /var/log/
420     /var/log/gdm
152     /var/log/ConsoleKit
80      /var/log/prelink
4       /var/log/sssd
4       /var/log/samba/old
4       /var/log/samba
4       /var/log/ppp
4       /var/log/ntpstats
4       /var/log/httpd
4       /var/log/cups
$</code></pre>
<p class="calibre10">The <code class="calibre26">-n</code> option allows you to sort numerically. The <code class="calibre26">-r</code> option lists the largest numbers first (reverse order). This is perfect for finding the largest disk consumers.</p>
<p class="calibre10">The <code class="calibre26">sed</code> editor brings more clarity to this listing. To focus on the top ten disk space consumers, when line 11 is reached, <code class="calibre26">sed</code> is set to delete the rest of the listing. The next step is to add a line number for each line in the listing. Chapter 19 shows you how to accomplish this by adding an equal sign (=) to the <code class="calibre26">sed</code> command. To get those line numbers on the same line as the disk space text, combine the text lines using the <code class="calibre26">N</code> command, as was shown in Chapter 21. The <code class="calibre26">sed</code> commands needed look like this:</p>
<pre class="calibre29"><code class="calibre26">sed '{11,$D; =}' |
sed 'N; s/\n/ /' |</code></pre>
<p class="calibre10">Now the output can be cleaned up using the <code class="calibre26">gawk</code> command (see Chapter 22). The output from the <code class="calibre26">sed</code> editor is piped into the <code class="calibre26">gawk</code> command and printed using the <code class="calibre26">printf</code> function.</p>
<pre class="calibre29"><code class="calibre26">gawk '{printf $1 ":" "\t" $2  "\t" $3 "\n"}'</code></pre>
<p class="calibre10">After the line number, a colon (<code class="calibre26">:</code>) is added, and tab (<code class="calibre26">ât</code>) characters are put between the individual fields for each text line's output row. This produces a nicely formatted listing of the top ten disk space consumers.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">sudo du -S /var/log/ |</b></code>
&gt; <code class="calibre26"><b class="calibre21">sort -rn |</b></code>
&gt; <code class="calibre26"><b class="calibre21">sed '{11,$D; =}' |</b></code>
&gt; <code class="calibre26"><b class="calibre21">sed 'N; s/\n/ /' |</b></code>
&gt; <code class="calibre26"><b class="calibre21">gawk '{printf $1 ":" "\t" $2 "\t" $3 "\n"}'</b></code>
[sudo] password for Christine:
1:      4396    /var/log/audit
2:      3024    /var/log/sa
3:      2976    /var/log/
4:      420     /var/log/gdm
5:      152     /var/log/ConsoleKit
6:      80      /var/log/prelink
7:      4       /var/log/sssd
8:      4       /var/log/samba/old<span type="pagebreak" title="676" id="calibre_link-1004" class="calibre11"></span>
9:      4       /var/log/samba
10:     4       /var/log/ppp
$</code></pre>
<p class="calibre10">Now you're in business! The next step is to use this information to create the script.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Creating the script</h3>
<p class="calibre10">To save time and effort, the script creates a report for multiple designated directories. A variable to accomplish this called <code class="calibre26">CHECK_DIRECTORIES</code> is used. For our purposes here, the variable is set to just two directories:</p>
<pre class="calibre29"><code class="calibre26">CHECK_DIRECTORIES=" /var/log /home"</code></pre>
<p class="calibre10">The script contains a <code class="calibre26">for</code> loop to perform the <code class="calibre26">du</code> command on each directory listed in the variable. This technique is used (see Chapter 13) to read and process values in a list. Each time the <code class="calibre26">for</code> loop iterates through the list of values in the variable <code class="calibre26">CHECK_DIRECTORIES</code>, it assigns to the <code class="calibre26">DIR_CHECK</code> variable the next value in the list:</p>
<pre class="calibre29"><code class="calibre26">for DIR_CHECK in $CHECK_DIRECTORIES
do
[...]
  du -S $DIR_CHECK
[...]
done</code></pre>
<p class="calibre10">To allow quick identification, a date stamp is added to the report's filename, using the <code class="calibre26">date</code> command. Using the <code class="calibre26">exec</code> command (see Chapter 15) the script redirects its output to the date stamped report file:</p>
<pre class="calibre29"><code class="calibre26">DATE=$(date '+%m%d%y')
exec &gt; disk_space_$DATE.rpt</code></pre>
<p class="calibre10">Now to produce a nicely formatted report, the script uses the <code class="calibre26">echo</code> command to put in a few report titles:</p>
<pre class="calibre29"><code class="calibre26">echo "Top Ten Disk Space Usage"
echo "for $CHECK_DIRECTORIES Directories"</code></pre>
<p class="calibre10">So let's see what this script looks like all put together:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
# Big_Users - Find big disk space users in various directories
###############################################################
# Parameters for Script
#
CHECK_DIRECTORIES='' /var/log /home''  #Directories to check
#
############## Main Script #################################
#
DATE=$(date '+%m%d%y')               #Date for report file<span type="pagebreak" title="677" id="calibre_link-1005" class="calibre11"></span>
#
exec &gt; disk_space_$DATE.rpt          #Make report file STDOUT
#
echo ''Top Ten Disk Space Usage''      #Report header
echo ''for $CHECK_DIRECTORIES Directories''
#
for DIR_CHECK in $CHECK_DIRECTORIES  #Loop to du directories
do
  echo ''''
  echo ''The $DIR_CHECK Directory:''   #Directory header
#
# Create a listing of top ten disk space users in this dir
  du -S $DIR_CHECK 2&gt;/dev/null |
  sort -rn |
  sed '{11,$D; =}' |
  sed 'N; s/\n/ /' |
  gawk '{printf $1 '':'' ''\t'' $2  ''\t'' $3 ''\n''}'
#
done                                 #End of loop
#
exit</code></pre>
<p class="calibre10">And there you have it. This simple shell script creates a date stamped report of the top ten disk space consumers for each directory you choose.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Running the script</h3>
<p class="calibre10">Before having the <code class="calibre26">Big_Users</code> script run automatically, you want to test it a few times manually to ensure that it does what you think it should do. And as you know by now, before you test it, you must set the proper permissions. However, in this case, the <code class="calibre26">bash</code> command was used, so the <code class="calibre26">chmod u+x</code> command was not needed prior to running the script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">ls -l Big_Users.sh</b></code>
-rw-r--r--. 1 Christine Christine 910 Sep  3 08:43 Big_Users.sh
$
$ <code class="calibre26"><b class="calibre21">sudo bash Big_Users.sh</b></code>
 [sudo] password for Christine:
$
$ <code class="calibre26"><b class="calibre21">ls disk_space*.rpt</b></code>
disk_space_090314.rpt
$
$ <code class="calibre26"><b class="calibre21">cat disk_space_090314.rpt</b></code>
Top Ten Disk Space Usage
for  /var/log /home Directories<span type="pagebreak" title="678" id="calibre_link-1006" class="calibre11"></span>
The /var/log Directory:
1:      4496    /var/log/audit
2:      3056    /var/log
3:      3032    /var/log/sa
4:      480     /var/log/gdm
5:      152     /var/log/ConsoleKit
6:      80      /var/log/prelink
7:      4       /var/log/sssd
8:      4       /var/log/samba/old
9:      4       /var/log/samba
10:     4       /var/log/ppp
The /home Directory:
1:      34084   /home/Christine/Documents/temp/reports/archive
2:      14372   /home/Christine/Documents/temp/reports
3:      4440    /home/Timothy/Project__42/log/universe
4:      4440    /home/Timothy/Project_254/Old_Data/revision.56
5:      4440    /home/Christine/Documents/temp/reports/report.txt
6:      3012    /home/Timothy/Project__42/log
7:      3012    /home/Timothy/Project_254/Old_Data/data2039432
8:      2968    /home/Timothy/Project__42/log/answer
9:      2968    /home/Timothy/Project_254/Old_Data/data2039432/answer
10:     2968    /home/Christine/Documents/temp/reports/answer
$ </code></pre>
<p class="calibre10">It worked! Now you can set up the shell script to execute automatically as needed. You do this using the <code class="calibre26">cron</code> table (see Chapter 16). It's a good idea to have it run early Monday morning. If you do this, you can have your coffee and review your weekly disk consumption report first thing Monday morning!</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-305" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter put some of the shell-scripting information presented in the book to good use for creating Linux utilities. When you're responsible for a Linux system, whether it's a large multi-user system or your own system, you need to watch lots of things. Instead of manually running commands, you can create shell script utilities to do the work for you.</p>
<p class="calibre10">The first section walked you through using shell scripts for archiving and backing up data files on the Linux system. The <code class="calibre26">tar</code> command is a popular command for archiving data. The chapter showed you how to use it in shell scripts to create archive files and how to manage the archive files in an archive directory.</p>
<p class="calibre10">The next section covered using a shell script for the four steps needed to delete user accounts. Creating functions for shell code that is repeated within a script makes the code easier to read and modify. This script combined many of the different structured commands, such as the <code class="calibre26">case</code> and <code class="calibre26">while</code> commands. The chapter demonstrated <span type="pagebreak" title="679" id="calibre_link-1007" class="calibre11"></span>the difference in script structure for a script destined for the <code class="calibre26">cron</code> tables versus an interactive script.</p>
<p class="calibre10">The chapter ended with how to use the <code class="calibre26">du</code> command to determine disk space consumption. The <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> commands were then used to retrieve specific information from the data. Passing the output from a command to <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> to parse data is a common function in shell scripts, so it's a good idea to know how to do it.</p>
<p class="calibre10">Next, more advanced shell scripts are covered. These scripts cover database, web, and e-mail topics.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-69">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-306" class="calibre4"></a><span class="chaptertitle">Chapter 25</span><br class="calibre22" /><span class="chaptertitle">Producing Scripts for Database, Web, and E-Mail</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In <span type="pagebreak" title="681" id="calibre_link-1008" class="calibre30"></span>This Chapter</h1>
<ol class="none">
<li class="calibre7">Writing database shell scripts</li>
<li class="calibre7">Using the Internet from your scripts</li>
<li class="calibre7">E-mailing reports from scripts</li>
</ol>
<p class="calibre19">So far we've covered many different features of shell scripts. However, there's still more! You can also utilize advanced applications outside your shell scripts to provide advanced features, such as accessing databases, retrieving data from the Internet, and e-mailing reports. This chapter shows how to use these three common features found in Linux systems all from within your shell scripts.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-307" class="calibre4"></a>Using a MySQL Database</h2>
<p class="calibre10">One of the problems with shell scripts is persistent data. You can store all the information you want in your shell script variables, but at the end of the script, the variables just go away. Sometimes, you'd like for your scripts to be able to store data that you can use later.</p>
<p class="calibre10">In the old days, to store and retrieve data from a shell script required creating a file, reading data from the file, parsing the data, and then saving the data back into the file. Searching for data in the file meant reading every record in the file to look for your data. Nowadays with databases being all the rage, it's a snap to interface your shell scripts with professional-quality open source databases. Currently, the most popular open source database used in the Linux world is MySQL. Its popularity has grown as a part of the Linux-Apache-MySQL-PHP (LAMP) server environment, which many Internet web servers use for hosting online stores, blogs, and applications.</p>
<p class="calibre10">This section describes how to use a MySQL database in your Linux environment to create database objects and how to use those objects in your shell scripts.</p>
<section class="toclist">
<h3 class="calibre15">Using MySQL</h3>
<p class="calibre10"><span type="pagebreak" title="682" id="calibre_link-1009" class="calibre11"></span>Most Linux distributions include the MySQL server and client packages in their software repositories, making it a snap to install a full MySQL environment on your Linux system. <a id="calibre_link-71" href="#calibre_link-70" class="calibre4">Figure 25.1</a> demonstrates the Add Software feature in the Ubuntu Linux distribution.</p>
<figure class="calibre23">
<img class="center" src="images/000040.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-70" href="#calibre_link-71" class="calibre4"><b class="calibre21">Figure 25.1</b></a></span> Installing MySQL server on an Ubuntu Linux system</p>
</figcaption>
</figure>
<p class="calibre10">After searching for the mysql-server package, just select the mysql-server entry that appears, and the Package Manager downloads and installs the complete MySQL server (and client) software. It doesn't get any easier than that!</p>
<p class="calibre10">Once installed, the portal to the MySQL database is the <code class="calibre26">mysql</code> command line interface program. This section describes how to use the <code class="calibre26">mysql</code> client program to interact with your database.</p>
<section class="toclist">
<h4 class="calibre25">Connecting to the server</h4>
<p class="calibre10">The <code class="calibre26">mysql</code> client program allows you to connect to any MySQL database server anywhere on the network, using any user account and password. By default, if you enter the <code class="calibre26">mysql</code> program on a command line without any parameters, it attempts to connect to a MySQL server running on the same Linux system, using the Linux login username.</p>
<p class="calibre10"><span type="pagebreak" title="683" id="calibre_link-1010" class="calibre11"></span>Most likely, this isn't how you want to connect to the database though. It's usually safer to create a special user account for the application to use, rather than using your standard user account in the MySQL server. That way, you can limit access to the application user, and if the application is compromised, you can easily delete and recreate it if necessary.</p>
<p class="calibre10">You use the <code class="calibre26">-u</code> command line parameter to specify the user name to log in as:</p>
<pre class="calibre29"><code class="calibre26">$ mysql -u root &ndash;p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 42
Server version: 5.5.38-0ubuntu0.14.04.1 (Ubuntu)
Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
mysql&gt;</code></pre>
<p class="calibre10">The <code class="calibre26">-p</code> parameter tells the <code class="calibre26">mysql</code> program to prompt for a password to use with the user account to log in. Enter the password that you assigned to the root user account, either during the installation process, or using the <code class="calibre26">mysqladmin</code> utility. After you're logged in to the server, you can start entering commands.</p>
</section>
<section class="toclist">
<h4 class="calibre25">The mysql commands</h4>
<p class="calibre10">The <code class="calibre26">mysql</code> program uses two different types of commands:</p>
<ul class="calibre14">
<li class="calibre7">Special <code class="calibre26">mysql</code> commands</li>
<li class="calibre7">Standard SQL statements</li>
</ul>
<p class="calibre10">The <code class="calibre26">mysql</code> program uses its own set of commands that let you easily control the environment and retrieve information about the MySQL server. The mysql commands use either a full name (such as <code class="calibre26">status</code>) or a shortcut (such as <code class="calibre26">âs</code>).</p>
<p class="calibre10">You can use either the full command or the shortcut command directly from the <code class="calibre26">mysql</code> command prompt:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; \s
--------------
mysql  Ver 14.14 Distrib 5.5.38, for debian-linux-gnu (i686) using readline 6.3
Connection id:            43<span type="pagebreak" title="684" id="calibre_link-1011" class="calibre11"></span>
Current database:
Current user:             root@localhost
SSL:                      Not in use
Current pager:            stdout
Using outfile:            ''
Using delimiter:         ;
Server version:          5.5.38-0ubuntu0.14.04.1 (Ubuntu)
Protocol version:        10
Connection:              Localhost via UNIX socket
Server characterset:     latin1
Db     characterset:     latin1
Client characterset:     utf8
Conn.  characterset:     utf8
UNIX socket:             /var/run/mysqld/mysqld.sock
Uptime:                  2 min 24 sec
Threads: 1 Questions: 575 Slow queries: 0 Opens: 421 Flush tables: 1
     Open tables: 41  Queries per second avg: 3.993
--------------
mysql&gt;</code></pre>
<p class="calibre10">The <code class="calibre26">mysql</code> program implements all the standard Structured Query Language (SQL) commands supported by the MySQL server. One uncommon SQL command that the <code class="calibre26">mysql</code> program implements is the <code class="calibre26">SHOW</code> command. Using this command, you can extract information about the MySQL server, such as the databases and tables created:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
+--------------------+
2 rows in set (0.04 sec)
mysql&gt; USE mysql;
Database changed
mysql&gt; SHOW TABLES;
+---------------------------+
| Tables_in_mysql           |
+---------------------------+
| columns_priv              |
| db                        |
| func                      |
| help_category             |
| help_keyword              |
| help_relation             |
| help_topic                |
| host                      |
| proc                      |
| procs_priv                |
| tables_priv               |
| time_zone                 |
| time_zone_leap_second     |
| time_zone_name            |
| time_zone_transition      |
| time_zone_transition_type |
| user                      |
+---------------------------+
17 rows in set (0.00 sec)<span type="pagebreak" title="685" id="calibre_link-1012" class="calibre11"></span>
mysql&gt;</code></pre>
<p class="calibre10">In this example, we used the <code class="calibre26">SHOW</code> SQL command to display the databases currently configured on the MySQL server and the <code class="calibre26">USE</code> SQL command to connect to a single database. Your <code class="calibre26">mysql</code> session can be connected to only one database at a time.</p>
<p class="calibre10">You'll notice that we added a semicolon after each command. The semicolon indicates the end of a command to the <code class="calibre26">mysql</code> program. If you don't use a semicolon, it prompts for more data:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; SHOW
  -&gt; DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
+--------------------+
2 rows in set (0.00 sec)
mysql&gt;</code></pre>
<p class="calibre10">This feature can come in handy when you're working with long commands. You can enter part of the command on a line, press the Enter key, and continue on the next line. This can continue for as many lines as you like until you use the semicolon to indicate the end of the command.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Throughout this chapter, we use uppercase letters for SQL commands. This has become a common way to write SQL commands, but the <code class="calibre26">mysql</code> program allows you to specify SQL commands using either uppercase or lowercase.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a database</h4>
<p class="calibre10">The MySQL server organizes data into <span class="chaptertitle"><i class="calibre12">databases.</i></span> A database usually holds the data for a single application, separating it from other applications that use the database server. <span type="pagebreak" title="686" id="calibre_link-1013" class="calibre11"></span>Creating a separate database for each shell script application helps eliminate confusion and data mix-ups.</p>
<p class="calibre10">Here's the SQL statement required to create a new database:</p>
<pre class="calibre29"><code class="calibre26">CREATE DATABASE <code class="calibre26"><i class="calibre12">name</i></code>;</code></pre>
<p class="calibre10">That's pretty simple. Of course, you must have the proper privileges to create new databases on the MySQL server. The easiest way to do that is to log in as the root user account:</p>
<pre class="calibre29"><code class="calibre26">$ mysql -u root &ndash;p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 42
Server version: 5.5.38-0ubuntu0.14.04.1 (Ubuntu)
Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
mysql&gt; CREATE DATABASE mytest;
Query OK, 1 row affected (0.02 sec)
mysql&gt;</code></pre>
<p class="calibre10">You can see whether the new database was created by using the <code class="calibre26">SHOW</code> command:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| mytest             |
+--------------------+
3 rows in set (0.01 sec)
mysql&gt;</code></pre>
<p class="calibre10">Yes, it was successfully created. Now you can create a user account to access the new database.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a user account</h4>
<p class="calibre10"><span type="pagebreak" title="687" id="calibre_link-1014" class="calibre11"></span>So far, you've seen how to connect to the MySQL server using the <code class="calibre26">root</code> administrator account. This account has total control over all the MySQL server objects (much like how the <code class="calibre26">root</code> Linux account has complete control over the Linux system).</p>
<p class="calibre10">It's extremely dangerous to use the <code class="calibre26">root</code> MySQL account for normal applications. If there were a breach of security and someone figured out the password for the root user account, all sorts of bad things could happen to your system (and data).</p>
<p class="calibre10">To prevent that, it's wise to create a separate user account in MySQL that has privileges only for the database used in the application. You do this with the <code class="calibre26">GRANT</code> SQL statement:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; GRANT SELECT,INSERT,DELETE,UPDATE ON test.* TO test IDENTIFIED
by 'test';
Query OK, 0 rows affected (0.35 sec)
mysql&gt;</code></pre>
<p class="calibre10">That's quite a long command. Let's walk through the pieces and see what it's doing.</p>
<p class="calibre10">The first section defines the privileges the user account has on the database(s). This statement allows the user account to query the database data (the select privilege), insert new data records, delete existing data records, and update existing data records.</p>
<p class="calibre10">The <code class="calibre26">test.*</code> entry defines the database and tables to which the privileges apply. This is specified in the following format:</p>
<pre class="calibre29"><code class="calibre26"><i class="calibre12">database.table</i></code></pre>
<p class="calibre10">As you can see from this example, you're allowed to use wildcard characters when specifying the database and tables. This format applies the specified privileges to all the tables contained in the database named test.</p>
<p class="calibre10">Finally, you specify the user account(s) to which the privileges apply. The neat thing about the <code class="calibre26">grant</code> command is that if the user account doesn't exist, it creates it. The <code class="calibre26">identified by</code> portion allows you to set a default password for the new user account.</p>
<p class="calibre10">You can test the new user account directly from the <code class="calibre26">mysql</code> program:</p>
<pre class="calibre29"><code class="calibre26">$ mysql mytest -u test &ndash;p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 42
Server version: 5.5.38-0ubuntu0.14.04.1 (Ubuntu)<span type="pagebreak" title="688" id="calibre_link-1015" class="calibre11"></span>
Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
mysql&gt;</code></pre>
<p class="calibre10">The first parameter specifies the default database to use (mytest), and as you've already seen, the <code class="calibre26">-u</code> parameter defines the user account to log in as, along with the <code class="calibre26">-p</code> to prompt for the password. After entering the password assigned to the test user account, you're connected to the server.</p>
<p class="calibre10">Now that you have a database and a user account, you're ready to create some tables for the data.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Creating a table</h4>
<p class="calibre10">The MySQL server is considered a <span class="chaptertitle"><i class="calibre12">relational</i> </span>database. In a relational database, data is organized by <span class="chaptertitle"><i class="calibre12">data fields,</i></span> <span class="chaptertitle"><i class="calibre12">records,</i></span> and <span class="chaptertitle"><i class="calibre12">tables.</i></span> A data field is a single piece of information, such as an employee's last name or a salary. A record is a collection of related data fields, such as the employee ID number, last name, first name, address, and salary. Each record indicates one set of the data fields.</p>
<p class="calibre10">The table contains all the records that hold the related data. Thus, you'll have a table called Employees that holds the records for each employee.</p>
<p class="calibre10">To create a new table in the database, you need to use the <code class="calibre26">CREATE TABLE</code> SQL command:</p>
<pre class="calibre29"><code class="calibre26">$ mysql mytest -u root -p
Enter password:
mysql&gt; CREATE TABLE employees (
  -&gt; empid int not null,
  -&gt; lastname varchar(30),
  -&gt; firstname varchar(30),
  -&gt; salary float,
  -&gt; primary key (empid));
Query OK, 0 rows affected (0.14 sec)
mysql&gt;</code></pre>
<p class="calibre10">First, notice that to create the new table, we needed to log in to MySQL using the <code class="calibre26">root</code> user account because the <code class="calibre26">test</code> user doesn't have privileges to create a new table. Next, notice that we specified the <code class="calibre26">mytest</code> database on the <code class="calibre26">mysql</code> program command line. If we hadn't done that, we would need to use the <code class="calibre26">USE</code> SQL command to connect to the test database.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">It's extremely important to make sure you're in the right database before creating the new table. Also, make sure you're logged in using the administrative user account (<code class="calibre26"><b class="calibre21">root</b></code> for MySQL) to create the tables.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="689" id="calibre_link-1016" class="calibre11"></span>Each data field in the table is defined using a data type. The MySQL database supports lots of different data types. <a id="calibre_link-73" href="#calibre_link-72" class="calibre4">Table 25.1</a> shows some of the more popular data types you may need.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-72" href="#calibre_link-73" class="calibre4"><b class="calibre21">Table 25.1</b></a></span> MySQL Data Types</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Data Type</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left">char</td>
<td class="left">A fixed-length string value</td>
</tr>
<tr class="calibre28">
<td class="left">varchar</td>
<td class="left">A variable-length string value</td>
</tr>
<tr class="calibre28">
<td class="left">int</td>
<td class="left">An integer value</td>
</tr>
<tr class="calibre28">
<td class="left">float</td>
<td class="left">A floating-point value</td>
</tr>
<tr class="calibre28">
<td class="left">boolean</td>
<td class="left">A Boolean true/false value</td>
</tr>
<tr class="calibre28">
<td class="left">date</td>
<td class="left">A date value in YYYY-MM-DD format</td>
</tr>
<tr class="calibre28">
<td class="left">time</td>
<td class="left">A time value in HH:mm:ss format</td>
</tr>
<tr class="calibre28">
<td class="left">timestamp</td>
<td class="left">A date and time value together</td>
</tr>
<tr class="calibre28">
<td class="left">text</td>
<td class="left">A long string value</td>
</tr>
<tr class="calibre28">
<td class="left">BLOB</td>
<td class="left">A large binary value, such as an image or video clip</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26">empid</code> data field also specifies a <span class="chaptertitle"><i class="calibre12">data constraint.</i></span> A data constraint restricts what type of data you can enter to create a valid record. The <code class="calibre26">not null</code> data constraint indicates that every record must have an <code class="calibre26">empid</code> value specified.</p>
<p class="calibre10">Finally, the <code class="calibre26">primary key</code> defines a data field that uniquely identifies each individual record. This means that each data record must have a unique <code class="calibre26">empid</code> value in the table.</p>
<p class="calibre10">After creating the new table, you can use the appropriate command to ensure that it's created. In <code class="calibre26">mysql</code>, it's the <code class="calibre26">show tables</code> command:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; show tables;
+----------------+
| Tables_in_test |
+----------------+
| employees      |
+----------------+
1 row in set (0.00 sec)
mysql&gt;</code></pre>
<p class="calibre10"><span type="pagebreak" title="690" id="calibre_link-1017" class="calibre11"></span>With the table created, you're now ready to start saving some data. The next section covers how to do that.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Inserting and deleting data</h4>
<p class="calibre10">Not surprisingly, you use the <code class="calibre26">INSERT</code> SQL command to insert new data records into the table. Each <code class="calibre26">INSERT</code> command must specify the data field values for the MySQL server to accept the record.</p>
<p class="calibre10">Here's the format of the <code class="calibre26">INSERT</code> SQL command:</p>
<pre class="calibre29"><code class="calibre26">INSERT INTO table <i class="calibre12">VALUES</i> (...)</code></pre>
<p class="calibre10">The values are in a comma-separated list of the data values for each data field:</p>
<pre class="calibre29"><code class="calibre26">$ mysql mytest -u test -p
Enter password:
mysql&gt; INSERT INTO employees VALUES (1, 'Blum', 'Rich', 25000.00);
Query OK, 1 row affected (0.35 sec)
</code></pre>
<p class="calibre10">The example uses the <code class="calibre26">&ndash;u</code> command line prompt to log in as the <code class="calibre26">test</code> user account that was created in MySQL.</p>
<p class="calibre10">The <code class="calibre26">INSERT</code> command pushes the data values you specify into the data fields in the table. If you attempt to add another record that duplicates the <code class="calibre26">empid</code> data field value, you get an error message:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; INSERT INTO employees VALUES (1, 'Blum', 'Barbara', 45000.00);
ERROR 1062 (23000): Duplicate entry '1' for key 1</code></pre>
<p class="calibre10">However, if you change the <code class="calibre26">empid</code> value to a unique value, everything should be okay:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; INSERT INTO employees VALUES (2, 'Blum', 'Barbara', 45000.00);
Query OK, 1 row affected (0.00 sec)</code></pre>
<p class="calibre10">You should now have two data records in your table.</p>
<p class="calibre10">If you need to remove data from your table, you use the <code class="calibre26">DELETE</code> SQL command. However, you need to be very careful with it.</p>
<p class="calibre10">Here's the basic <code class="calibre26">DELETE</code> command format:</p>
<pre class="calibre29"><code class="calibre26">DELETE FROM <i class="calibre12">table</i>;</code></pre>
<p class="calibre10">where <code class="calibre26"><i class="calibre12">table</i></code> specifies the table to delete records from. There's just one small problem with this command: It removes all the records in the table.</p>
<p class="calibre10"><span type="pagebreak" title="691" id="calibre_link-1018" class="calibre11"></span>To just specify a single record or a group of records to delete, you must use the <code class="calibre26">WHERE</code> clause. The <code class="calibre26">WHERE</code> clause allows you to create a filter that identifies which records to remove. You use the <code class="calibre26">WHERE</code> clause like this:</p>
<pre class="calibre29"><code class="calibre26">DELETE FROM employees WHERE empid = 2;</code></pre>
<p class="calibre10">This restricts the deletion process to all the records that have an <code class="calibre26">empid</code> value of 2. When you execute this command, the <code class="calibre26">mysql</code> program returns a message indicating how many records matched the filter:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; DELETE FROM employees WHERE empid = 2;
Query OK, 1 row affected (0.29 sec)</code></pre>
<p class="calibre10">As expected, only one record matched the filter and was removed.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Querying data</h4>
<p class="calibre10">After you have all your data in your database, it's time to start running reports to extract information.</p>
<p class="calibre10">The workhorse for all your querying is the SQL <code class="calibre26">SELECT</code> command. The <code class="calibre26">SELECT</code> command is extremely versatile, but with versatility comes complexity.</p>
<p class="calibre10">Here's the basic format of a <code class="calibre26">SELECT</code> statement:</p>
<pre class="calibre29"><code class="calibre26">SELECT <i class="calibre12">datafields</i> FROM <i class="calibre12">table</i></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">datafields</i></code> parameter is a comma-separated list of the data field names you want the query to return. If you want to receive all the data field values, you can use an asterisk as a wildcard character.</p>
<p class="calibre10">You must also specify the specific table you want the query to search. To get meaningful results, you must match your query data fields with the proper table.</p>
<p class="calibre10">By default, the <code class="calibre26">SELECT</code> command returns all the data records in the specified table:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; SELECT * FROM employees;
+-------+----------+------------+--------+
| empid | lastname | firstname  | salary |
+-------+----------+------------+--------+
|     1 | Blum     | Rich       |  25000 |
|     2 | Blum     | Barbara    |  45000 |
|     3 | Blum     | Katie Jane |  34500 |
|     4 | Blum     | Jessica    |  52340 |
+-------+----------+------------+--------+
4 rows in set (0.00 sec)
mysql&gt;</code></pre>
<p class="calibre10"><span type="pagebreak" title="692" id="calibre_link-1019" class="calibre11"></span>You can use one or more modifiers to define how the database server returns the data requested by the query. Here's a list of commonly used modifiers:</p>
<ul class="calibre14">
<li class="calibre7"><code class="calibre26">WHERE</code>: Displays a subset of records that meet a specific condition</li>
<li class="calibre7"><code class="calibre26">ORDER BY</code>: Displays records in a specified order</li>
<li class="calibre7"><code class="calibre26">LIMIT</code>: Displays only a subset of records</li>
</ul>
<p class="calibre10">The <code class="calibre26">WHERE</code> clause is the most common <code class="calibre26">SELECT</code> command modifier. It allows you to specify conditions to filter data from the result set. Here's an example of using the <code class="calibre26">WHERE</code> clause:</p>
<pre class="calibre29"><code class="calibre26">mysql&gt; SELECT * FROM employees WHERE salary &gt; 40000;
+-------+----------+-----------+--------+
| empid | lastname | firstname | salary |
+-------+----------+-----------+--------+
|     2 | Blum     | Barbara   |  45000 |
|     4 | Blum     | Jessica   |  52340 |
+-------+----------+-----------+--------+
2 rows in set (0.01 sec)
    mysql&gt;</code></pre>
<p class="calibre10">Now you can see the power of adding database access to your shell scripts! You can easily control your data management needs just with a few SQL commands and the <code class="calibre26">mysql</code> program. The next section describes how you can incorporate these features into your shell scripts.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Using the database in your scripts</h3>
<p class="calibre10">Now that you have a working database going, it's finally time to turn our attention back to the shell scripting world. This section describes what you need to do to interact with your databases using shell scripts.</p>
<section class="toclist">
<h4 class="calibre25">Logging into the server</h4>
<p class="calibre10">If you've created a special user account in MySQL for your shell scripts, you need to use it to log in with the <code class="calibre26">mysql</code> command. There are a couple ways to do that. One method is to include the password on the command line using the <code class="calibre26">-p</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">mysql mytest -u test &ndash;p test</code></pre>
<p class="calibre10">This, however, is not a good idea. Anyone who has access to your script will know the user account and password for your database.</p>
<p class="calibre10">To solve this problem, you can use a special configuration file used by the <code class="calibre26">mysql</code> program. The <code class="calibre26">mysql</code> program uses the <code class="calibre26">$HOME/.my.cnf</code> file to read special startup commands and settings. One of those settings is the default password for <code class="calibre26">mysql</code> sessions started by the user account.</p>
<p class="calibre10"><span type="pagebreak" title="693" id="calibre_link-1020" class="calibre11"></span>To set the default password in this file, just create the following:</p>
<pre class="calibre29"><code class="calibre26">$ cat .my.cnf
[client]
password = test
$ chmod 400 .my.cnf
$</code></pre>
<p class="calibre10">The <code class="calibre26">chmod</code> command is used to restrict the <code class="calibre26">.my.cnf</code> file so only you can view it. You can test this now from the command line:</p>
<pre class="calibre29"><code class="calibre26">$ mysql mytest -u test
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 44
Server version: 5.5.38-0ubuntu0.14.04.1 (Ubuntu)
Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
mysql&gt;
</code></pre>
<p class="calibre10">Perfect! Now you don't have to include the password on the command line in your shell scripts.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Sending commands to the server</h4>
<p class="calibre10">After establishing the connection to the server, you'll want to send commands to interact with your database. There are two methods to do this:</p>
<ul class="calibre14">
<li class="calibre7">Send a single command and exit.</li>
<li class="calibre7">Send multiple commands.</li>
</ul>
<p class="calibre10">To send a single command, you must include the command as part of the <code class="calibre26">mysql</code> command line. For the <code class="calibre26">mysql</code> command, you do this using the <code class="calibre26">-e</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">$ cat mtest1
#!/bin/bash
# send a command to the MySQL server
MYSQL=$(which mysql)
$MYSQL mytest -u test -e 'select * from employees'
$ ./mtest1
+-------+----------+------------+---------+
| empid | lastname | firstname  | salary  |
+-------+----------+------------+---------+
|     1 | Blum     | Rich       | 25000   |
|     2 | Blum     | Barbara    | 45000   |
|     3 | Blum     | Katie Jane | 34500   |
|     4 | Blum     | Jessica    | 52340   |
+-------+----------+------------+---------+
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="694" id="calibre_link-1021" class="calibre11"></span>The database servers return the results from the SQL commands to the shell scripts, which display them in <code class="calibre26">STDOUT</code>.</p>
<p class="calibre10">If you need to send more than one SQL command, you can use file redirection (see Chapter 15). To redirect lines in the shell script, you must define an <i class="calibre12">end of file</i> string. The end of file string indicates the beginning and end of the redirected data.</p>
<p class="calibre10">This is an example of defining an end of file string, with data in it:</p>
<pre class="calibre29"><code class="calibre26">$ cat mtest2
#!/bin/bash
# sending multiple commands to MySQL
MYSQL=$(which mysql)
$MYSQL mytest -u test &lt;&lt;EOF
show tables;
select * from employees where salary &gt; 40000;
EOF
$ ./mtest2
Tables_in_test
employees
empid    lastname    firstname    salary
2        Blum        Barbara      45000
4        Blum        Jessica      52340
$</code></pre>
<p class="calibre10">The shell redirects everything with the <code class="calibre26">EOF</code> delimiters to the <code class="calibre26">mysql</code> command, which executes the lines as if you typed them yourself at the prompt. Using this method, you can send as many commands to the MySQL server as you need. You'll notice, however, that there's no separation between the output from each command. In the next section, âFormatting data,â you'll see how to fix this problem.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">You should also notice that the <code class="calibre26">mysql</code> program changed the default output style when you used the redirected input method. Instead of creating the ASCII symbol boxes around the data, the <code class="calibre26">mysql</code> program detected that the input was redirected, so it returned just the raw data. This comes in handy when you need to extract the individual data elements.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Of course, you're <span type="pagebreak" title="695" id="calibre_link-1022" class="calibre11"></span>not limited to just retrieving data from the tables. You can use any type of SQL command in your script, such as an <code class="calibre26">INSERT</code> statement:</p>
<pre class="calibre29"><code class="calibre26">$ cat mtest3
#!/bin/bash
# send data to the table in the MySQL database
MYSQL=$(which mysql)
if [ $# -ne 4 ]
then
 echo "Usage: mtest3 empid lastname firstname salary"
else
 statement="INSERT INTO employees VALUES ($1, '$2', '$3', $4)"
 $MYSQL mytest -u test &lt;&lt; EOF
 $statement
EOF
 if [ $? -eq 0 ]
 then
    echo Data successfully added
 else
    echo Problem adding data
 fi
fi
$ ./mtest3
Usage: mtest3 empid lastname firstname salary
$ ./mtest3 5 Blum Jasper 100000
Data added successfully
$
$ ./mtest3 5 Blum Jasper 100000
ERROR 1062 (23000) at line 1: Duplicate entry '5' for key 1
Problem adding data
$</code></pre>
<p class="calibre10">This example demonstrates a few things about using this technique. When you specify the end of file string, it must be the only thing on the line, and the line must start with the <span type="pagebreak" title="696" id="calibre_link-1023" class="calibre11"></span>string. If we had indented the <code class="calibre26">EOF</code> text to match the rest of the <code class="calibre26">if-then</code> indentation, it wouldn't work.</p>
<p class="calibre10">Inside the <code class="calibre26">INSERT</code> statement, notice that there are single quotes around the text values and double quotes around the entire <code class="calibre26">INSERT</code> statement. It's important not to mix up the quotes used for the string values with the quotes used to define the script variable text.</p>
<p class="calibre10">Also, notice how we used the special <code class="calibre26">$?</code> variable to test the exit status of the <code class="calibre26">mysql</code> program. This helps you determine whether the command failed.</p>
<p class="calibre10">Just sending output from the commands to <code class="calibre26">STDOUT</code> is not the easiest way to manage and manipulate the data. The next section shows you some tricks you can use to help your scripts capture data retrieved from the database.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Formatting data</h4>
<p class="calibre10">The standard output from the <code class="calibre26">mysql</code> command doesn't lend itself to data retrieval. If you need to actually do something with the data you retrieve, you need to do some fancy data manipulation. This section describes some of the tricks you can use to help extract data from your database reports.</p>
<p class="calibre10">The first step in trying to capture database data is to redirect the output from the <code class="calibre26">mysql</code> and <code class="calibre26">psql</code> commands in an environment variable. This allows you to use the output information in other commands. Here's an example:</p>
<pre class="calibre29"><code class="calibre26">$ cat mtest4
#!/bin/bash
# redirecting SQL output to a variable
MYSQL=$(which mysql)
dbs=$($MYSQL mytest -u test -Bse 'show databases')
for db in $dbs
do
 echo $db
done
$ ./mtest4
information_schema
test
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="697" id="calibre_link-1024" class="calibre11"></span>This example uses two additional parameters on the <code class="calibre26">mysql</code> program command line. The <code class="calibre26">-B</code> parameter specifies for the <code class="calibre26">mysql</code> program to work in batch mode, and in combination with the <code class="calibre26">-s</code> (silent) parameter, the column headings and formatting symbols are suppressed.</p>
<p class="calibre10">By redirecting the output of the <code class="calibre26">mysql</code> command to a variable, this example is able to step through the individual values of each returned record.</p>
<p class="calibre10">The <code class="calibre26">mysql</code> program also supports an additional popular format, called Extensible Markup Language (XML). This language uses HTML-like tags to identify data names and values.</p>
<p class="calibre10">For the <code class="calibre26">mysql</code> program, you do this using the <code class="calibre26">-X</code> command line parameter:</p>
<pre class="calibre29"><code class="calibre26">$ mysql mytest -u test -X -e 'select * from employees where empid = 1'
&lt;?xml version=''1.0''?&gt;
&lt;resultset statement=''select * from employees''&gt;
&lt;row&gt;
    &lt;field name=''empid''&gt;1&lt;/field&gt;
    &lt;field name=''lastname''&gt;Blum&lt;/field&gt;
    &lt;field name=''firstname''&gt;Rich&lt;/field&gt;
    &lt;field name=''salary''&gt;25000&lt;/field&gt;
&lt;/row&gt;
&lt;/resultset&gt;
$</code></pre>
<p class="calibre10">Using XML, you can easily identify individual rows of data, along with the individual data values in each record. You can then use standard Linux string handling functions to extract the data you need!</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-308" class="calibre4"></a>Using the Web</h2>
<p class="calibre10">Often when you think of shell script programming, the last thing you think of is the Internet. The command line world often seems foreign to the fancy, graphical world of the Internet. There are, however, several different utilities you can easily use in your shell scripts to gain access to data content on the web, as well as on other network devices.</p>
<p class="calibre10">Almost as old as the Internet itself, the Lynx program was created in 1992 by students at the University of Kansas as a text-based browser. Because it's text-based, the Lynx program allows you to browse websites directly from a terminal session, replacing the fancy graphics on web pages with HTML text tags. This allows you to surf the Internet from just about any type of Linux terminal. A sample Lynx screen is shown in <a id="calibre_link-75" href="#calibre_link-74" class="calibre4">Figure 25.2</a>.</p>
<figure class="calibre23">
<img class="center" src="images/000048.jpg" alt="image" />
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-74" href="#calibre_link-75" class="calibre4"><b class="calibre21">Figure 25.2</b></a></span> Viewing a web page using Lynx</p>
</figcaption>
</figure>
<p class="calibre10"><span type="pagebreak" title="698" id="calibre_link-1025" class="calibre11"></span>Lynx uses the standard keyboard keys to navigate around the web page. Links appear as highlighted text within the web page. Using the right-arrow key allows you to follow a link to the next web page.</p>
<p class="calibre10">You may be wondering how you can use a graphical text program in your shell scripts. The Lynx program also provides a feature that allows you to dump the text contents of a web page to <code class="calibre26">STDOUT</code>. This feature is great for mining for data contained within a web page. This section describes how to use the Lynx program within your shell scripts to extract data from websites.</p>
<section class="toclist">
<h3 class="calibre15">Installing Lynx</h3>
<p class="calibre10">Even though the Lynx program is somewhat old, it's still in active development. At the time of this writing, the latest version of Lynx is version 2.8.8, released in June 2010, with a new release in development. Because of its popularity among shell script programmers, many Linux distributions install the Lynx program in their default installations.</p>
<p class="calibre10">If you're using an installation that doesn't provide the Lynx program, check your distribution's installation packages. Most likely you'll find it there for easy installation.</p>
<p class="calibre10">If your distribution doesn't include the Lynx package, or if you just want the latest version, you can download the source code from the <a href="http://lynx.isc.org" class="calibre4">lynx.isc.org</a> website and compile it yourself <span type="pagebreak" title="699" id="calibre_link-1026" class="calibre11"></span>(assuming that you've got the C development libraries installed on your Linux system). See Chapter 9 for information on how to compile and install source code distribution packages.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The Lynx program uses the curses text-graphics library in Linux. Most distributions have this installed by default. If your distribution doesn't, consult your particular distribution's instructions on installing the curses library before trying to compile Lynx.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The next section describes how to use the <code class="calibre26">lynx</code> command from the command line.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The lynx command line</h3>
<p class="calibre10">The <code class="calibre26">lynx</code> command line command is extremely versatile in what information it can retrieve from the remote website. When you view a web page in your browser, you're only seeing part of the information that's transferred to your browser. Web pages consist of three types of data elements:</p>
<ul class="calibre14">
<li class="calibre7">HTTP headers</li>
<li class="calibre7">Cookies</li>
<li class="calibre7">HTML content</li>
</ul>
<p class="calibre10"><i class="calibre12">HTTP headers</i> provide information about the type of data sent in the connection, the server sending the data, and the type of security used in the connection. If you're sending special types of data, such as video or audio clips, the server identifies that in the HTTP headers. The Lynx program allows you to view all the HTTP headers sent within a web page session.</p>
<p class="calibre10">If you've done any type of web browsing, no doubt you're familiar with web page <i class="calibre12">cookies</i>. Websites use cookies to store data about your website visit for future use. Each individual site can store information, but it can only access the information it sets. The <code class="calibre26">lynx</code> command provides options for you to view cookies sent by web servers, as well as reject or accept specific cookies sent from servers.</p>
<p class="calibre10">The Lynx program allows you to view the actual HTML content of the web page in three different formats:</p>
<ul class="calibre14">
<li class="calibre7">In a text-graphics display on the terminal session using the curses graphical library</li>
<li class="calibre7">As a text file, dumping the raw data from the web page</li>
<li class="calibre7">As a text file, dumping the raw HTML source code from the web page</li>
</ul>
<p class="calibre10">For shell scripts, viewing the raw data or HTML source code is a gold mine. After you capture the data retrieved from a website, you can easily extract individual pieces of information.</p>
<p class="calibre10"><span type="pagebreak" title="700" id="calibre_link-1027" class="calibre11"></span>As you can see, the Lynx program is extremely versatile in what it can do. However, with versatility comes complexity, especially when it comes to command line parameters. The Lynx program is one of the more complex programs you'll run into in the Linux world.</p>
<p class="calibre10">Here's the basic format of the <code class="calibre26">lynx</code> command:</p>
<pre class="calibre29"><code class="calibre26">lynx <i class="calibre12">options URL</i></code></pre>
<p class="calibre10">where <code class="calibre26"><i class="calibre12">URL</i></code> is the HTTP or HTTPS destination you want to connect to, and <code class="calibre26"><i class="calibre12">options</i></code> are one or more options that modify the behavior of Lynx as it interacts with the remote website. There are options for just about any type of web interaction required by Lynx. Use the <code class="calibre26">man</code> command to view all the options available for Lynx.</p>
<p class="calibre10">Many of the command line parameters define behaviors that control Lynx when you're using it in full-screen mode, allowing you to customize the behavior of Lynx as you're traversing web pages.</p>
<p class="calibre10">There are often groups of command line parameters that you find useful in your normal browsing environment. Instead of having to enter these parameters on the command line every time you use Lynx, Lynx provides a general configuration file that defines the base behavior when you use Lynx. This configuration file is discussed in the next section.</p>
</section>
<section class="toclist">
<h3 class="calibre15">The Lynx configuration file</h3>
<p class="calibre10">The <code class="calibre26">lynx</code> command reads a configuration file for many of its parameter settings. By default, this file is located at <code class="calibre26">/usr/local/lib/lynx.cfg</code>, although you'll find that many Linux distributions change this to the <code class="calibre26">/etc</code> directory (<code class="calibre26">/etc/lynx.cfg</code>) (the Ubuntu distribution places the <code class="calibre26">lynx.cfg file</code> in the <code class="calibre26">/etc/lynx-cur</code> folder).</p>
<p class="calibre10">The <code class="calibre26">lynx.cfg</code> configuration file groups related parameters into sections to make finding parameters easier. Here's the format of an entry in the configuration file:</p>
<pre class="calibre29"><code class="calibre26"><i class="calibre12">PARAMETER:value</i></code></pre>
<p class="calibre10">where <code class="calibre26"><i class="calibre12">PARAMETER</i></code> is the full name of the parameter (often, but not always in uppercase letters) and <code class="calibre26"><i class="calibre12">value</i></code> is the value associated with the parameter.</p>
<p class="calibre10">Perusing this file, you'll find many parameters that are similar to the command line parameters, such as the <code class="calibre26">ACCEPT_ALL_COOKIES</code> parameter, which is equivalent to setting the <code class="calibre26">-accept_all_cookies</code> command line parameter.</p>
<p class="calibre10">There are also a few configuration parameters that are similar in function but different in name. The <code class="calibre26">FORCE_SSL_COOKIES_SECURE</code> configuration file parameter setting can be overridden by the <code class="calibre26">-force_secure</code> command line parameter.</p>
<p class="calibre10">However, you'll also find quite a few configuration parameters that don't match with command line parameters. These values can be set only from the configuration file.</p>
<p class="calibre10"><span type="pagebreak" title="701" id="calibre_link-1028" class="calibre11"></span>The most common configuration parameters that you can't set on the command line are for the <span class="chaptertitle"><i class="calibre12">proxy servers.</i></span> Some networks (especially corporate networks) use a proxy server as a middleman between the client's browser and the destination website server. Instead of sending HTTP requests directly to the remote web server, client browsers must send their requests to the proxy server. The proxy server in turn sends the requests to the remote web server, retrieves the results, and forwards them back to the client browser.</p>
<p class="calibre10">This may seem like a waste of time, but it's a vital function in protecting clients from dangers on the Internet. A proxy server can filter inappropriate content and malicious coding, or even detect sites used for Internet data phishing schemes (rogue servers pretending to be someone else in order to capture customer data). Proxy servers can also help reduce Internet bandwidth usage, because they cache commonly viewed web pages and return them to clients instead of having to download the original page again.</p>
<p class="calibre10">These are the configuration parameters used to define proxy servers:</p>
<pre class="calibre29"><code class="calibre26">http_proxy:http://some.server.dom:port/
https_proxy:http://some.server.dom:port/
ftp_proxy:http://some.server.dom:port/
gopher_proxy:http://some.server.dom:port/
news_proxy:http://some.server.dom:port/
newspost_proxy:http://some.server.dom:port/
newsreply_proxy:http://some.server.dom:port/
snews_proxy:http://some.server.dom:port/
snewspost_proxy:http://some.server.dom:port/
snewsreply_proxy:http://some.server.dom:port/
nntp_proxy:http://some.server.dom:port/
wais_proxy:http://some.server.dom:port/
finger_proxy:http://some.server.dom:port/
cso_proxy:http://some.server.dom:port/
no_proxy:host.domain.dom</code></pre>
<p class="calibre10">You can define a different proxy server for any network protocol supported by Lynx. The <code class="calibre26">NO_PROXY</code> parameter is a comma-separated list of websites that you prefer to have direct access to without using the proxy server. These are often internal websites that don't require filtering.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Capturing data from Lynx</h3>
<p class="calibre10">When you use Lynx in a shell script, most likely you're trying to obtain a specific piece (or pieces) of information from a web page. The technique to accomplish this is called <span class="chaptertitle"><i class="calibre12">screen scraping.</i></span> In screen scraping, you're trying to programmatically find data in a specific location on a graphical screen so you can capture it and use it in your shell script.</p>
<p class="calibre10">The easiest way to perform screen scraping with <code class="calibre26">lynx</code> is to use the <code class="calibre26">-dump</code> option. This option doesn't bother trying to display the web page on the terminal screen. Instead, it displays the web page text data <span type="pagebreak" title="702" id="calibre_link-1029" class="calibre11"></span>directly to <code class="calibre26">STDOUT</code>:</p>
<pre class="calibre29"><code class="calibre26">$ lynx -dump http://localhost/RecipeCenter/
The Recipe Center
          "Just like mom used to make"
Welcome
   [1]Home
   [2]Login to post
   [3]Register for free login
     _____________________________________________________________
   [4]Post a new recipe</code></pre>
<p class="calibre10">Each link is identified by a tag number, and Lynx displays a listing of all the tag references after the web page data.</p>
<p class="calibre10">After you have all the text data from the web page, you probably know what tools we're going to get out of the toolbox to start work on extracting data. That's right, our old friends the <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> programs (see Chapter 19).</p>
<p class="calibre10">First, let's find some interesting data to collect. The Yahoo! weather web page is a great source for finding the current weather conditions anywhere in the world. Each location uses a separate URL to display weather information for that city (you can find the specific URL for your city by going to the site in a normal browser and entering your city's information). Here's the <code class="calibre26">lynx</code> command for finding the weather in Chicago, Illinois:</p>
<pre class="calibre29"><code class="calibre26"> lynx -dump http://weather.yahoo.com/united-states/illinois/chicago-2379574/</code></pre>
<p class="calibre10">This command dumps lots and lots of data from the web page. The first step is to find the precise information you want. To do that, redirect the output from the <code class="calibre26">lynx</code> command to a file, and then search the file for your data. After doing that with the preceding command, we found this text in the output file:</p>
<pre class="calibre29"><code class="calibre26">Current conditions as of 1:54 pm EDT
Mostly Cloudy
   Feels Like:
          32 Â°F
	  
   Barometer:
          30.13 in and rising
	  
   Humidity:
          50%
	  
   Visibility:
          10 mi
	  
   Dewpoint:
          15 Â°F
	  
   Wind:
          W 10 mph
	  </code></pre>
<p class="calibre10"><span type="pagebreak" title="703" id="calibre_link-1030" class="calibre11"></span>That's all the information about the current weather you really need. There's just one small problem with this output. You'll notice that the numbers are on a line below the heading. Trying to just extract individual numbers will be difficult. Chapter 19 discusses how to deal with a problem just like this.</p>
<p class="calibre10">The key to solving this is to write a <code class="calibre26">sed</code> script that can search for the data heading first. When you find it, you can then go to the correct line to extract the data. We're fortunate in this example in that all the data we need are on lines by themselves. We should be able to solve this with just the <code class="calibre26">sed</code> script. If there had also been other text on the same line, we'd need to get out the <code class="calibre26">gawk</code> tool to filter out just the data we needed.</p>
<p class="calibre10">First, you need to create a <code class="calibre26">sed</code> script that looks for the location text and then skips to the next line to get the text that describes the current weather condition and prints it. Here's what that looks like for the Chicago weather page:</p>
<pre class="calibre29"><code class="calibre26">$ cat sedcond
/IL, United States/{
n
p
}
$</code></pre>
<p class="calibre10">The address specifies to look for the line with the desired text. If the <code class="calibre26">sed</code> command finds it, the <code class="calibre26">n</code> command skips to the next line, and the <code class="calibre26">p</code> command prints the contents of the line, which is the text describing the current weather conditions of the city.</p>
<p class="calibre10">Next, you'll need a <code class="calibre26">sed</code> script that can search for the <code class="calibre26">Feels Like</code> text and then go to the next line to print the temperature:</p>
<pre class="calibre29"><code class="calibre26">$ cat sedtemp
/Feels Like/{
p
}
$</code></pre>
<p class="calibre10">Perfect. Now, you can use these two <code class="calibre26">sed</code> scripts in a shell script that first captures the <code class="calibre26">lynx</code> output of the web page to a temporary file, and then applies the two <code class="calibre26">sed</code> scripts to the web page data to extract only the data you're looking for. Here's an example of how to do that:</p>
<pre class="calibre29"><code class="calibre26">$ cat weather
#!/bin/bash
# extract the current weather for Chicago, IL
URL=''http://weather.yahoo.com/united-states/illinois/chicago-2379574/''
LYNX=$(which lynx)
TMPFILE=$(mktemp tmpXXXXXX)
$LYNX -dump $URL &gt; $TMPFILE<span type="pagebreak" title="704" id="calibre_link-1031" class="calibre11"></span>
conditions=$(cat $TMPFILE | sed -n -f sedcond)
temp=$(cat $TMPFILE | sed -n -f sedtemp | awk '{print $4}')
rm -f $TMPFILE
echo ''Current conditions: $conditions''
echo The current temp outside is: $temp
$ ./weather
Current conditions: Mostly Cloudy
The current temp outside is: 32 Â°F
$</code></pre>
<p class="calibre10">The weather script connects to the Yahoo! weather web page for the desired city, saves the web page to a temporary file, extracts the appropriate text, removes the temporary file, and then displays the weather information. The beauty of this is that after you've extracted the data from a website, you can do whatever you want with it, such as create a table of temperatures. You can then create a <code class="calibre26">cron</code> job (see Chapter 16) that runs every day to track daily temperatures.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">The Internet is a dynamic place. Don't be surprised if you spend hours working out the precise location of data on a web page, only to find that it's moved a couple of weeks later, breaking your scripts. In fact, it's quite possible that this example won't work by the time you read this book. The important thing is to know the process for extracting data from web pages. You can then apply that principle to any situation.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-309" class="calibre4"></a>Using E-Mail</h2>
<p class="calibre10">With the popularity of e-mail, these days just about everyone has an e-mail address. Because of that, people often expect to receive data via e-mail instead of seeing files or printouts. That's no different in the shell scripting world. If you generate any type of report from your shell script, most likely at some point you'll be asked to e-mail the results to someone.</p>
<p class="calibre10">The main tool you have available for sending e-mail messages from your shell scripts is the Mailx program. Not only can you use it interactively to read and send messages, but you can also use the command line parameters to specify how to send a message.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">Some Linux distributions require that you also install a mail server package (such as sendmail or Postfix) before you can install the mailutils package that includes the Mailx program.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Here's the format for the Mailx program's command line for sending messages:</p>
<pre class="calibre29"><code class="calibre26">mail [-eIinv] [-a header] [-b addr] [-c addr] [-s subj] to-addr</code></pre>
<p class="calibre10">The <code class="calibre26">mail</code> <span type="pagebreak" title="705" id="calibre_link-1032" class="calibre11"></span>command uses the command line parameters shown in <a id="calibre_link-77" href="#calibre_link-76" class="calibre4">Table 25.2</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-76" href="#calibre_link-77" class="calibre4"><b class="calibre21">Table 25.2</b></a></span> The Mailx Command Line Parameters</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Parameter</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-a</code></td>
<td class="left">Specifies additional SMTP header lines</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-b</code></td>
<td class="left">Adds a BCC: recipient to the message</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-c</code></td>
<td class="left">Adds a CC: recipient to the message</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code></td>
<td class="left">Doesn't send the message if it's empty</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-i</code></td>
<td class="left">Ignores TTY interrupt signals</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-I</code></td>
<td class="left">Forces Mailx to run in interactive mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Doesn't read the <code class="calibre26">/etc/mail.rc</code> startup file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-s</code></td>
<td class="left">Specifies a Subject line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v</code></td>
<td class="left">Displays details of the delivery on the terminal</td>
</tr>
</table>
</figure>
<p class="calibre10">As you can see from <a href="#calibre_link-76" class="calibre4">Table 25.2</a>, you can pretty much create an entire e-mail message just from the command line parameters. You just need to add the message body.</p>
<p class="calibre10">To do that, you need to redirect text to the <code class="calibre26">mail</code> command. Here's a simple example of how to create and send an e-mail message directly from the command line:</p>
<pre class="calibre29"><code class="calibre26">$ echo "This is a test message" | mailx -s "Test message" rich</code></pre>
<p class="calibre10">The Mailx program sends the text from the <code class="calibre26">echo</code> command as the message body. This provides an easy way for you to send messages from your shell scripts. Here's a quick example:</p>
<pre class="calibre29"><code class="calibre26">$ cat factmail
#!/bin/bash
# mailing the answer to a factorial
MAIL=$(which mailx)
factorial=1
counter=1
read -p "Enter the number: " value
while [ $counter -le $value ]
do
   factorial=$[$factorial * $counter]
   counter=$[$counter + 1]
done
echo The factorial of $value is $factorial | $MAIL -s "Factorial
answer" $USER
echo "The result has been mailed to you."</code></pre>
<p class="calibre10"><span type="pagebreak" title="706" id="calibre_link-1033" class="calibre11"></span>This script does not assume that the Mailx program is located in the standard location. It uses the <code class="calibre26">which</code> command to determine just where the <code class="calibre26">mail</code> program is.</p>
<p class="calibre10">After calculating the result of the factorial function, the shell script uses the <code class="calibre26">mail</code> command to send the message to the user-defined <code class="calibre26">$USER</code> environment variable, which should be the person executing the script.</p>
<pre class="calibre29"><code class="calibre26">$ ./factmail
Enter the number: 5
The result has been mailed to you.
$</code></pre>
<p class="calibre10">You just need to check your mail to see if the answer arrived:</p>
<pre class="calibre29"><code class="calibre26">$ mail
''/var/mail/rich'': 1 message 1 new
&gt;N   1 Rich Blum          Mon Sep  1 10:32  13/586   Factorial answer
?
Return-Path: &lt;rich@rich-Parallels-Virtual-Platform&gt;
X-Original-To: rich@rich-Parallels-Virtual-Platform
Delivered-To: rich@rich-Parallels-Virtual-Platform
Received: by rich-Parallels-Virtual-Platform (Postfix, from userid 1000)
        id B4A2A260081; Mon,  1 Sep 2014 10:32:24 -0500 (EST)
Subject: Factorial answer
To: &lt;rich@rich-Parallels-Virtual-Platform&gt;
X-Mailer: mail (GNU Mailutils 2.1)
Message-Id: &lt;20101209153224.B4A2A260081@rich-Parallels-Virtual-Platform&gt;
Date: Mon,  1 Sep 2014 10:32:24 -0500 (EST)
From: rich@rich-Parallels-Virtual-Platform (Rich Blum)
The factorial of 5 is 120
?</code></pre>
<p class="calibre10">It's not always convenient to send just one line of text in the message body. Often, you'll need to send an entire output as the e-mail message. In those situations, you can always redirect text to a temporary file and use the <code class="calibre26">cat</code> command to redirect the output to the <code class="calibre26">mail</code> program.</p>
<p class="calibre10">Here's an example of sending a larger amount of data in an e-mail message:</p>
<pre class="calibre29"><code class="calibre26">$ cat diskmail
#!/bin/bash<span type="pagebreak" title="707" id="calibre_link-1034" class="calibre11"></span>
# sending the current disk statistics in an e-mail message
date=$(date +%m/%d/%Y)
MAIL=$(which mailx)
TEMP=$(mktemp tmp.XXXXXX)
df -k &gt; $TEMP
cat $TEMP | $MAIL -s "Disk stats for $date" $1
rm -f $TEMP</code></pre>
<p class="calibre10">The <code class="calibre26">diskmail</code> program gets the current date using the <code class="calibre26">date</code> command (along with some special formatting), finds the location of the Mailx program, and creates a temporary file. After all that, it uses the <code class="calibre26">df</code> command to display the current disk space statistics (see Chapter 4), redirecting the output to the temporary file.</p>
<p class="calibre10">It then redirects the temporary file to the <code class="calibre26">mail</code> command, using the first command line parameter for the destination address and the current date in the Subject header. When you run the script, you don't see anything appear on the command line output:</p>
<pre class="calibre29"><code class="calibre26">$ ./diskmail rich</code></pre>
<p class="calibre10">But if you check your mail, you should see the sent message:</p>
<pre class="calibre29"><code class="calibre26">$ mail
''/var/mail/rich'': 1 message 1 new
&gt;N   1 Rich Blum          Mon Sep  1 10:35  19/1020  Disk stats for 09/01/2014
?
Return-Path: &lt;rich@rich-Parallels-Virtual-Platform&gt;
X-Original-To: rich@rich-Parallels-Virtual-Platform
Delivered-To: rich@rich-Parallels-Virtual-Platform
Received: by rich-Parallels-Virtual-Platform (Postfix, from userid 1000)
        id 3671B260081; Mon,  1 Sep 2014 10:35:39 -0500 (EST)
Subject: Disk stats for 09/01/2014
To: &lt;rich@rich-Parallels-Virtual-Platform&gt;
X-Mailer: mail (GNU Mailutils 2.1)
Message-Id: &lt;20101209153539.3671B260081@rich-Parallels-Virtual-Platform&gt;
Date: Mon,  1 Sep 2014 10:35:39 -0500 (EST)
From: rich@rich-Parallels-Virtual-Platform (Rich Blum)
Filesystem           1K-blocks      Used  Available Use% Mounted on
/dev/sda1             63315876   2595552   57504044   5% /
none                    507052       228     506824   1% /dev
none                    512648       192     512456   1% /dev/shm
none                    512648       100     512548   1% /var/run
none                    512648         0     512648   0% /var/lock
none                4294967296         0 4294967296   0% /media/psf
?</code></pre>
<p class="calibre10">Now you just need to schedule the script to run every day using the <code class="calibre26">cron</code> feature, and you can get disk space reports automatically e-mailed to your inbox! System administration doesn't get much easier than that!</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-310" class="calibre4"></a>Summary</h2>
<p class="calibre10"><span type="pagebreak" title="708" id="calibre_link-1035" class="calibre11"></span>This chapter walked through how to use some advanced features within your shell scripts. First, we discussed how to use the MySQL server to store persistent data for your applications. Just create a database and unique user account in MySQL for your application, and grant the user account privileges to only that database. You can then create tables to store the data that your application uses. The shell script uses the <code class="calibre26">mysql</code> command line tool to interface with the MySQL server, submit SELECT queries, and retrieve the results to display. Next we discussed how to use the <code class="calibre26">lynx</code> text-based browser to extract data from websites on the Internet. The <code class="calibre26">lynx</code> tool can dump all the text from a web page, and you can use standard shell programming skills to store that data and search it for the content you're looking for. Finally, we walked through how to use the standard Mailx program to send reports using the Linux e-mail server installed on your Linux system. The Mailx program allows you to easily send output from commands to any e-mail address.</p>
<p class="calibre10">In the next chapter we finish up by looking at some more shell script examples that show you just what you can do with your shell scripting knowledge.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-116">
<section type="chapter" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-311" class="calibre4"></a><span class="chaptertitle">Chapter 26</span><br class="calibre22" /><span class="chaptertitle">Creating Fun Little Shell Scripts</span></h1>
</header>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Chapter</h1>
<ol class="none">
<li class="calibre7">Sending <span type="pagebreak" title="709" id="calibre_link-1036" class="calibre11"></span>a message</li>
<li class="calibre7">Getting inspiration</li>
<li class="calibre7">Sending a text</li>
</ol>
<p class="calibre19">The primary reason for learning to write bash shell scripts is to be able to create your own Linux system utilities. Understanding how to write useful and practical script utilities is important. However, sometimes it helps to do something fun to learn a concept or skill. The scripts in this chapter are not necessarily practical, but they can be lots of fun! And they help solidify script-writing concepts.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-312" class="calibre4"></a>Sending a Message</h2>
<p class="calibre10">Messages can be sent in many ways in an office or a home environment &mdash; text message, e-mail, and even making a phone call. One method, not commonly used any more, is sending a message directly to a fellow system user's terminal. Because this technique is largely unknown, it can be fun to communicate with someone with this method.</p>
<p class="calibre10">This shell script utility helps you to quickly and easily send a message to someone who is logged onto your Linux system. It is a rather simple script, but it can be loads of fun!</p>
<section class="toclist">
<h3 class="calibre15">Understanding the required functions</h3>
<p class="calibre10">For this simple script, only a few functions are required. Several of the commands are common and have been covered in the book. However, a few of the commands have only been touched on, and you may not be familiar with the primary command needed. This section looks at the commands needed to put together this simple, but interesting script.</p>
<section class="toclist">
<h4 class="calibre25">Determining <span type="pagebreak" title="710" id="calibre_link-1037" class="calibre11"></span>who is on the system</h4>
<p class="calibre10">The first utility needed is the <code class="calibre26">who</code> command. The <code class="calibre26">who</code> utility allows you to see all the users currently logged into the system:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">who</b></code>
christine tty2         2015-09-10 11:43
timothy   tty3         2015-09-10 11:46
[...]
$</code></pre>
<p class="calibre10">In this partial listing, all the information needed for sending messages is shown. By default, the <code class="calibre26">who</code> command gives you the short version of information available. The same information is provided, when <code class="calibre26">who -s</code> is issued:</p>
<ul class="calibre14">
<li class="calibre7">User name</li>
<li class="calibre7">User's terminal</li>
<li class="calibre7">Time the user logged into the system</li>
</ul>
<p class="calibre10">To send a message, you only need the first two items. Both the user name and the user's current terminal are necessary.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Allowing messages</h4>
<p class="calibre10">Users can disallow anyone to send them messages via the <code class="calibre26">mesg</code> utility. Therefore, before you start attempting to send messages, it's a good idea to check whether messages are allowed. For yourself, you can simply enter the <code class="calibre26">mesg</code> command as follows:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">mesg</b></code>
is n
$</code></pre>
<p class="calibre10">The <code class="calibre26">is n</code> result shows that messaging is turned off. If the result showed <code class="calibre26">is y</code>, messages would be allowed.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">Some distributions, such as Ubuntu, come with messaging turned off by default. Other distributions, such as CentOS, come with messaging turned on by default. Thus, you need to check your status and other user's message status before attempting to send a message.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To check everyone else's message status, you can use the <code class="calibre26">who</code> command again. Keep in mind that this checks the message status only for those who are currently logged into the system. You use the <code class="calibre26">-T</code> option to check their message status:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">who -T</b></code>
christine <code class="calibre26"><b class="calibre21">-</b></code> tty2         2015-09-10 12:56
timothy   <code class="calibre26"><b class="calibre21">-</b></code> tty3         2015-09-10 11:46
[...]
$</code></pre>
<p class="calibre10">The dash <span type="pagebreak" title="711" id="calibre_link-1038" class="calibre11"></span>(<code class="calibre26">-</code>) after each user name indicates that messaging is turned off for those users. If it is turned on, you see a plus (<code class="calibre26">+</code>) sign.</p>
<p class="calibre10">To allow messages to be sent to you, if it is turned off, you need to use the message command with the <code class="calibre26">y</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">whoami</b></code>
christine
$
$ <code class="calibre26"><b class="calibre21">mesg y</b></code>
$
$ <code class="calibre26"><b class="calibre21">mesg</b></code>
is y
$</code></pre>
<p class="calibre10">Messaging is turned on by the user <code class="calibre26">christine</code>, when the command <code class="calibre26">mesg y</code> is issued. The user's individual message status is checked, by issuing the <code class="calibre26">mesg</code> command. Sure enough, the command shows <code class="calibre26">is y</code>, which indicates messages are allowed to this user.</p>
<p class="calibre10">Using the <code class="calibre26">who</code> command, other users can see how the user <code class="calibre26">christine</code> has changed her message status. The message status is now set to a plus sign, which indicates the user is allowing messages to be sent to her.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">who -T</b></code>
christine <code class="calibre26"><b class="calibre21">+</b></code> tty2         2015-09-10 12:56
timothy   - tty3         2015-09-10 11:46
[...]
$</code></pre>
<p class="calibre10">For two-way communication, you need to allow messaging and one or more users also need to allow messaging. In this example, the user <code class="calibre26">timothy</code> has also turned on his messaging:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">who -T</b></code>
christine + tty2         2015-09-10 12:56
timothy   <code class="calibre26"><b class="calibre21">+</b></code> tty3         2015-09-10 11:46
[...]
$</code></pre>
<p class="calibre10">Now that messaging is allowed between you and at least one other user, you can try out the command to send messages. However, the <code class="calibre26">who</code> command is also still needed, because it provides the necessary information in order to send a message.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Sending a message to another user</h4>
<p class="calibre10">The primary tool for this script is the <code class="calibre26">write</code> command. As long as messaging is allowed, the <code class="calibre26">write</code> command allows you to send a message to another logged-in user using his username and current terminal.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">write</code> command only allows you to successfully send messages to users logged onto a virtual console terminal (see Chapter 2). A user logged into the graphical environment will not be able to receive messages.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="712" id="calibre_link-1039" class="calibre11"></span>In this example, a message is sent from user <code class="calibre26">christine</code> to user <code class="calibre26">timothy</code> logged on the tty3 terminal. From <code class="calibre26">christine</code>'s terminal, the session looks as follows:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">who</b></code>
christine tty2         2015-09-10 13:54
<code class="calibre26"><b class="calibre21">timothy</b></code>   <code class="calibre26"><b class="calibre21">tty3</b></code>         2015-09-10 11:46
[...]
$
$ <code class="calibre26"><b class="calibre21">write timothy tty3</b></code>
<code class="calibre26"><b class="calibre21">Hello Tim!</b></code>
$</code></pre>
<p class="calibre10">After the message is initiated by the <code class="calibre26">write</code> command, a blank line is shown for you to begin inputting the message text. It may be as many lines as you desire. When the Enter key is pressed, a new line is available for more message text. After you are finished entering message text, the whole message is sent by pressing the Ctrl+D key combination.</p>
<p class="calibre10">The receiver of the message sees something like the following:</p>
<pre class="calibre29"><code class="calibre26">Message from christine@server01 on tty2 at 14:11 ...
Hello Tim!
EOF</code></pre>
<p class="calibre10">The receiver can see which user on which terminal sent the message. A time stamp is also included. Notice the <code class="calibre26">EOF</code> shown at the message's bottom. It indicates End Of File, which lets the message recipient know that the entire message is being displayed.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Often, a message recipient needs to press the Enter key in order to get a prompt to show again, after a message is received.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Now you can send messages! The next step is to use these commands to create the script.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Creating the script</h3>
<p class="calibre10">Using a script to send messages helps overcome a few potential problems. First, if you have lots of users on the system, trying to find the one user you want to send a message to can be a pain! You must also determine whether that particular user has messaging turned on. <span type="pagebreak" title="713" id="calibre_link-1040" class="calibre11"></span>In addition, a script speeds things up allowing you to quickly send a message to a particular user in one easy step.</p>
<section class="toclist">
<h4 class="calibre25">Checking if user is logged on</h4>
<p class="calibre10">The first issue is to let the script know to which user you want to send a message. This is easily done by sending a parameter (Chapter 14) along with the script's execution. For the script to determine whether that particular user is logged on the system, the <code class="calibre26">who</code> command is employed as shown in this bit of script code:</p>
<pre class="calibre29"><code class="calibre26"># Determine if user is logged on:
#
logged_on=$(who | grep -i -m 1 $1 | gawk '{print $1}')
#</code></pre>
<p class="calibre10">In the preceding code, the results of the <code class="calibre26">who</code> command are piped into the <code class="calibre26">grep</code> command (Chapter 4). The <code class="calibre26">grep</code> command uses the <code class="calibre26">-i</code> option to ignore case, which allows the username to be entered using uppercase or lowercase letters. The <code class="calibre26">-m 1</code> option is included on the <code class="calibre26">grep</code> command, in case the user is logged into the system multiple times. The <code class="calibre26">grep</code> command produces either nothing, if the user is not logged on, or the username's first login information. This output is passed to the <code class="calibre26">gawk</code> command (Chapter 19). The <code class="calibre26">gawk</code> command returns only the first item, either nothing or the username. This final output from the <code class="calibre26">gawk</code> command is stored in the variable <code class="calibre26">logged_on</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Some Linux distributions, such as Ubuntu, may not have the <code class="calibre26">gawk</code> command installed by default. To install it, type <code class="calibre26"><b class="calibre21">sudo apt-get install gawk</b></code>. Also, you can find more information about installing software packages in Chapter 9.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">When the variable, <code class="calibre26">logged_on</code>, contains either nothing (if the user is not logged on) or the username, it can be tested and acted upon:</p>
<pre class="calibre29"><code class="calibre26">#
if [ -z $logged_on ]
then
   echo "$1 is not logged on."
   echo "Exiting script..."
   exit
fi
#</code></pre>
<p class="calibre10">Employing the use of an <code class="calibre26">if</code> statement and a <code class="calibre26">test</code> command (Chapter 12), the <code class="calibre26">logged_on</code> variable is tested to determine if it is a zero-length variable. If it is a zero-length variable, the script user is informed via <code class="calibre26">echo</code> commands that the user is not currently logged onto <span type="pagebreak" title="714" id="calibre_link-1041" class="calibre11"></span>the system, and the script is exited via the <code class="calibre26">exit</code> command. If the user is logged onto the system, the <code class="calibre26">logged_on</code> variable contains the user's username, and the script continues.</p>
<p class="calibre10">In the following example, a username, <code class="calibre26">Charlie</code>, is passed as a parameter to the shell script. This user is not currently logged onto the system:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Charlie</b></code>
Charlie is not logged on.
Exiting script...
$</code></pre>
<p class="calibre10">The code worked perfectly! Now instead of you digging through the <code class="calibre26">who</code> command results to determine whether a user is logged onto the system, the message script does that for you.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking if user accepts messages</h4>
<p class="calibre10">The next important item is to determine whether a logged on user accepts messages. This script portion operates very closely to the script section for determining whether a user is logged on:</p>
<pre class="calibre29"><code class="calibre26"># Determine if user allows messaging:
#
allowed=$(who -T | grep -i -m 1 $1 | gawk '{print $2}')
#
if [ $allowed != "+" ]
then
   echo "$1 does not allowing messaging."
   echo "Exiting script..."
   exit
fi
#</code></pre>
<p class="calibre10">Notice that this time, the <code class="calibre26">who -T</code> command and option are used. This displays a <code class="calibre26">+</code> next to the username, if messaging is allowed. Otherwise, it displays a <code class="calibre26">-</code> next to the username, if messaging is not allowed. The results from the <code class="calibre26">who</code> command are then piped into <code class="calibre26">grep</code> and <code class="calibre26">gawk</code> to pull out only the messaging indicator. The messaging indicator is stored in the <code class="calibre26">allowed</code> variable. Finally, an <code class="calibre26">if</code> statement is employed to test for a messaging indicator not set to <code class="calibre26">+</code>. If the indicator is not set to <code class="calibre26">+</code>, the script user is informed and the script is exited. However, if the messaging indicator shows messaging is allowed, the script continues.</p>
<p class="calibre10">To test out this script's section, a user who is logged into the system with messaging disabled is tested. The user <code class="calibre26">Samantha</code> currently has messaging disabled:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Samantha</b></code>
Samantha does not allowing messaging.
Exiting script...
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="715" id="calibre_link-1042" class="calibre11"></span>The test worked as expected. This script portion eliminates any need to manually check for messaging being enabled or disabled.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Checking if message was included</h4>
<p class="calibre10">The message to be sent is also included as a script parameter. Therefore, another needed check is whether a message was included as a parameter to the <code class="calibre26">mu.sh</code> shell script. To test for the message parameter, an <code class="calibre26">if</code> statement, similar to those used earlier, must be included in the script's code:</p>
<pre class="calibre29"><code class="calibre26"># Determine if a message was included:
#
if [ -z $2 ]
then
    echo "No message parameter included."
    echo "Exiting script..."
    exit
fi
#</code></pre>
<p class="calibre10">To test out this script portion, a message was not included for a user who is both logged into the system and allows messaging:</p>
<pre class="calibre29"><code class="calibre26">$ ./mu.sh <code class="calibre26"><b class="calibre21">Timothy</b></code>
No message parameter included.
Exiting script...
$</code></pre>
<p class="calibre10">This is exactly what is needed! Now that the script has performed these preliminary checks, the primary task of sending a message can be undertaken.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Transmitting a simple message</h4>
<p class="calibre10">Before a message is sent, the user's current terminal must be identified and stored in a variable. The <code class="calibre26">who</code>, <code class="calibre26">grep</code>, and <code class="calibre26">gawk</code> commands are employed again:</p>
<pre class="calibre29"><code class="calibre26"># Send message to user:
#
uterminal=$(who | grep -i -m 1 $1 | gawk '{print $2}')
#</code></pre>
<p class="calibre10">To transmit the message, both the <code class="calibre26">echo</code> and the <code class="calibre26">write</code> commands are used:</p>
<pre class="calibre29"><code class="calibre26">#
echo $2 | write $logged_on $uterminal
#</code></pre>
<p class="calibre10">Because <code class="calibre26">write</code> is an interactive utility, it must have the message piped into it for the script to work properly. The <code class="calibre26">echo</code> command is used to send the message, $2, to <code class="calibre26">STDOUT</code>, <span type="pagebreak" title="716" id="calibre_link-1043" class="calibre11"></span>which in turn is piped into the <code class="calibre26">write</code> command. The <code class="calibre26">logged_on </code>variable holds the username, and the <code class="calibre26">uterminal</code> variable holds the user's current terminal.</p>
<p class="calibre10">Now, you can test sending a simple message to a designated user via the script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Timothy test</b></code>
$</code></pre>
<p class="calibre10">The user <code class="calibre26">Timothy</code> receives the following message on his terminal:</p>
<pre class="calibre29"><code class="calibre26">Message from christine@server01 on tty2 at 10:23 ...
test
EOF</code></pre>
<p class="calibre10">Success! You can now send simple one word messages to other users on your system via your script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Transmitting a long message</h4>
<p class="calibre10">Often, you want to send more than just a single word to another system user. Let's try a longer message using the current script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Timothy Boss is coming. Look busy.</b></code>
$</code></pre>
<p class="calibre10">The user <code class="calibre26">Timothy</code> receives the following message on his terminal:</p>
<pre class="calibre29"><code class="calibre26">Message from christine@server01 on tty2 at 10:24 ...
Boss
EOF</code></pre>
<p class="calibre10">It didn't work. Only the first word of the message, <code class="calibre26">Boss</code>, was sent. This is due to the script using parameters (Chapter 14). Recall that the bash shell considers a space to differentiate between parameters. Thus, because there are spaces in the message, each word is treated as a different parameter. The script must be modified to fix this problem.</p>
<p class="calibre10">The <code class="calibre26">shift</code> command (Chapter 14) and a <code class="calibre26">while</code> loop (Chapter 13) help with this long message issue:</p>
<pre class="calibre29"><code class="calibre26"># Determine if there is more to the message:
#
<code class="calibre26"><b class="calibre21">shift</b></code>
#
while [ -n "$1" ]
do
   whole_message=$whole_message' '$1
   <code class="calibre26"><b class="calibre21">shift</b></code>
done
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="717" id="calibre_link-1044" class="calibre11"></span>Recall that the <code class="calibre26">shift</code> command allows you to process the various provided script parameters without knowing the total number of parameters. The <code class="calibre26">shift</code> command simply moves the next parameter in line down to parameter <code class="calibre26">$1</code>. First, a primary <code class="calibre26">shift</code> must be issued before the <code class="calibre26">while</code> loop, because the message starts in parameter <code class="calibre26">$2</code>, instead of parameter <code class="calibre26">$1</code>.</p>
<p class="calibre10">After the <code class="calibre26">while</code> loop is initiated, it continues grabbing each message word, tacking the word onto the <code class="calibre26">whole_message</code> variable. The loop then shifts to the next parameter. After the final parameter is processed, the <code class="calibre26">while</code> loop exits and the <code class="calibre26">whole_message</code> variable contains the entire message to send.</p>
<p class="calibre10">One additional script modification is needed to fix this problem. Instead of just sending parameter <code class="calibre26">$2</code> to the <code class="calibre26">write</code> utility, the script is modified to send the variable, <code class="calibre26">whole_message</code>:</p>
<pre class="calibre29"><code class="calibre26"># Send message to user:
#
uterminal=$(who | grep -i -m 1 $1 | gawk '{print $2}')
#
echo $<code class="calibre26"><b class="calibre21">whole_message</b></code> | write $logged_on $uterminal
#</code></pre>
<p class="calibre10">Now, again try to send that warning message about the boss coming his way to <code class="calibre26">Timothy</code>:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Timothy Boss is coming</b></code>
Usage: grep [OPTION]... PATTERN [FILE]...
Try 'grep --help' for more information.
$</code></pre>
<p class="calibre10">Oops! That didn't work either. This is because when <code class="calibre26">shift</code> was used in the script, the <code class="calibre26">$1</code> parameter contents were removed. Thus, when the script attempts to use <code class="calibre26">$1</code> in the <code class="calibre26">grep</code> command, it generates an error. To fix this problem a variable, <code class="calibre26">muser</code>, is used to capture the <code class="calibre26">$1</code> parameter's value:</p>
<pre class="calibre29"><code class="calibre26"># Save the username parameter
#
muser=$1
#</code></pre>
<p class="calibre10">Now <code class="calibre26">muser</code> stores the username. The <code class="calibre26">$1</code> parameter in the script's various <code class="calibre26">grep</code> and <code class="calibre26">echo</code> commands can be replaced by the <code class="calibre26">muser</code> variable:</p>
<pre class="calibre29"><code class="calibre26"># Determine if user is logged on:
#
logged_on=$(who | grep -i -m 1 $<code class="calibre26"><b class="calibre21">muser</b></code> | gawk '{print $1}')
[...]
   echo "$<code class="calibre26"><b class="calibre21">muser</b></code> is not logged on."
[...]
# Determine if user allows messaging:<span type="pagebreak" title="718" id="calibre_link-1045" class="calibre11"></span>
#
allowed=$(who -T | grep -i -m 1 $<code class="calibre26"><b class="calibre21">muser</b></code> | gawk '{print $2}')
[...]
   echo "$<code class="calibre26"><b class="calibre21">muser</b></code> does not allowing messaging."
[...]
# Send message to user:
#
uterminal=$(who | grep -i -m 1 $<code class="calibre26"><b class="calibre21">muser</b></code> | gawk '{print $2}')
[...]</code></pre>
<p class="calibre10">To test out the script changes, a multi-word message is sent again. In addition, some emphasis is added to the message by tacking on exclamation points:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./mu.sh Timothy The boss is coming! Look busy!</b></code>
$</code></pre>
<p class="calibre10">The user <code class="calibre26">Timothy</code> receives the following message on his terminal:</p>
<pre class="calibre29"><code class="calibre26">Message from christine@server01 on tty2 at 10:30 ...
The boss is coming! Look busy!
EOF</code></pre>
<p class="calibre10">It worked! You can now employ the script to quickly send messages to other users on the system. Here's the final message script with all the needed checks and changes:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
#mu.sh - Send a Message to a particular user
#############################################
#
# Save the username parameter
#
muser=$1
#
# Determine if user is logged on:
#
logged_on=$(who | grep -i -m 1 $muser | gawk '{print $1}')
#
if [ -z $logged_on ]
then
   echo "$muser is not logged on."
   echo "Exiting script..."
   exit
fi
#
# Determine if user allows messaging:
#
allowed=$(who -T | grep -i -m 1 $muser | gawk '{print $2}')
#
if [ $allowed != "+" ]
then
   echo "$muser does not allowing messaging."<span type="pagebreak" title="719" id="calibre_link-1046" class="calibre11"></span>
   echo "Exiting script..."
   exit
fi
#
# Determine if a message was included:
#
if [ -z $2 ]
then
    echo "No message parameter included."
    echo "Exiting script..."
    exit
fi
#
# Determine if there is more to the message:
#
shift
#
while [ -n "$1" ]
do
   whole_message=$whole_message' '$1
   shift
done
#
# Send message to user:
#
uterminal=$(who | grep -i -m 1 $muser | gawk '{print $2}')
#
echo $whole_message | write $logged_on $uterminal
#
exit</code></pre>
<p class="calibre10">Because you have made it to the last chapter in this book, you should be ready for a script-writing challenge. Here are some suggested improvements for the message script that you can attempt on your own:</p>
<ul class="calibre14">
<li class="calibre7">Instead of passing the username and message as parameters, use options (see Chapter 14).</li>
<li class="calibre7">If a user is logged into multiple terminals, allow a message to be sent to those multiple terminals. (Hint: Use multiple <code class="calibre26">write</code> commands.)</li>
<li class="calibre7">If the message to be sent is for a user who is currently only logged into the GUI, produce a message for the script user and exit the script. (Remember the <code class="calibre26">write</code> command can only write to virtual console terminals.)</li>
<li class="calibre7">Allow a long message stored in a file to be sent to a terminal. (Hint: Use the <code class="calibre26">cat</code> command output piped into the <code class="calibre26">write</code> utility, instead of the <code class="calibre26">echo</code> command.)</li>
</ul>
<p class="calibre10"><span type="pagebreak" title="720" id="calibre_link-1047" class="calibre11"></span>Not only does reading through the script help solidify the script-writing concepts you are learning, but so does modifying the script. Come up with your own creative modification. Have a little fun! It helps you learn.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-313" class="calibre4"></a>Obtaining a Quote</h2>
<p class="calibre10">Inspirational quotes have long been used in the business environment. You may have a few on your office wall right now. This fun little and interesting script helps you obtain a daily inspirational quote to use as you please.</p>
<p class="calibre10">This section takes you through how to create this script. Included is a new rich utility that has not been covered in the book yet. The script also uses some utilities that have been covered, such as <code class="calibre26">sed</code> and <code class="calibre26">gawk</code>.</p>
<section class="toclist">
<h3 class="calibre15">Understanding the required functions</h3>
<p class="calibre10">Several great websites allow you to obtain daily inspiration quotes. Just open your favorite search engine, and you can find many sites. After you find a site for your daily quote, you need a utility to download that quote. For this script, the <code class="calibre26">wget</code> utility is just what's needed.</p>
<section class="toclist">
<h4 class="calibre25">Learning about the wget utility</h4>
<p class="calibre10">The <code class="calibre26">wget</code> utility is a flexible tool that allows web pages to be downloaded to your local Linux system. From these pages, you can glean your daily inspirational quote.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">The <code class="calibre26">wget</code> command is an extremely rich utility. In this chapter, only a small portion of its power is used. Find out more about <code class="calibre26">wget</code> via the man pages.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To download a web page via <code class="calibre26">wget</code>, you just need the <code class="calibre26">wget</code> command and the website's address:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">wget www.quotationspage.com/qotd.html</b></code>
--2015-09-23 09:14:28--  http://www.quotationspage.com/qotd.html
Resolving www.quotationspage.com... 67.228.101.64
Connecting to www.quotationspage.com|67.228.101.64|:80. connected
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]<span type="pagebreak" title="721" id="calibre_link-1048" class="calibre11"></span>
Saving to: "qotd.html"
    [ &lt;=&gt;                              ] 13,806 --.-K/s   in 0.1s
2015-09-23 09:14:28 (118 KB/s) - "qotd.html" saved [13806]
$</code></pre>
<p class="calibre10">The website's information is stored in a file named after the web page. In this case, it's <code class="calibre26">qotd.html</code>. And as you might have guessed by now, the file is full of HTML code:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">cat qotd.html</b></code>
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html xmlns:fb="http://ogp.me/ns/fb#"&gt;
&lt;head&gt;
        &lt;title type="main"&gt;Quotes of the Day - The Quotations Page&lt;/title&gt;
[...]</code></pre>
<p class="calibre10">Only a partial HTML code listing is shown here. For the script, the <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> utilities help strip out the desired inspirational quote. But before tackling the script, you need a little more control over the <code class="calibre26">wget</code> utility's input and output.</p>
<p class="calibre10">You can use a variable to hold the web address (URL). Simply pass the variable to <code class="calibre26">wget</code> as a parameter. Just don't forget to use the <code class="calibre26">$</code> along with the variable name:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">wget $url</b></code>
--2015-09-23 09:24:21--  http://www.quotationspage.com/qotd.html
Resolving www.quotationspage.com... 67.228.101.64
Connecting to www.quotationspage.com|67.228.101.64|:80 connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: "qotd.html.3"
    [ &lt;=&gt;                        ] 13,806      --.-K/s   in 0.1s
    
2015-09-23 09:24:21 (98.6 KB/s) - "qotd.html.3" saved [13806]
$</code></pre>
<p class="calibre10">The daily inspiration quote script is eventually to be run daily via <code class="calibre26">cron</code> (Chapter 16) or some other script automation utility. Thus, having the <code class="calibre26">wget</code> command's session output display to <code class="calibre26">STDOUT</code> is undesirable. To store the session output to a log file, use the option <code class="calibre26">-o</code>. This allows session output to be viewed at a later time:<span type="pagebreak" title="722" id="calibre_link-1049" class="calibre11"></span></p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">wget -o quote.log $url</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat quote.log</b></code>
--2015-09-23 09:41:46--  http://www.quotationspage.com/qotd.html
Resolving www.quotationspage.com... 67.228.101.64
Connecting to www.quotationspage.com|67.228.101.64|:80 connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: "qotd.html.1"
     0K .......... ...                                81.7K=0.2s
     
2015-09-23 09:41:46 (81.7 KB/s) - "qotd.html.1" saved [13806]
$</code></pre>
<p class="calibre10">The <code class="calibre26">wget</code> utility now stores its session output into the log file as it retrieves web page information. If desired, you can view the logged session output by using the <code class="calibre26">cat</code> command, as shown in the preceding code.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">For various reasons, you may decide that you do not want <code class="calibre26">wget</code> to produce a log file or display session output. In this case, just use the <code class="calibre26">-q</code> option, and the <code class="calibre26">wget</code> command quietly performs its directed duties.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To control where the web page information is stored, use the <code class="calibre26">-O</code> option on the <code class="calibre26">wget</code> command. Thus, instead of having the web address as the storage file name, you can use the filename of your choice:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">wget -o quote.log -O Daily_Quote.html $url</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat Daily_Quote.html</b></code>
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html xmlns:fb="http://ogp.me/ns/fb#"&gt;
&lt;head&gt;
[...]
$</code></pre>
<p class="calibre10">Using the <code class="calibre26">-O</code> option allows the web page data to be stored in the designated file, <code class="calibre26">Daily_Quote.html</code>. Now that the <code class="calibre26">wget </code>utility's output is controlled, the next required function, checking the web address's validity, can be explored.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Testing a web address</h4>
<p class="calibre10"><span type="pagebreak" title="723" id="calibre_link-1050" class="calibre11"></span>Web addresses change. Sometimes, it seems this happens daily. Therefore, it is important to test the address validity within the script. The <code class="calibre26">wget</code> utility gives the ability to conduct such a test with the <code class="calibre26">--spider</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">wget --spider $url</b></code>
Spider mode enabled. Check if remote file exists.
--2015-09-23 12:45:41--  http://www.quotationspage.com/qotd.html
Resolving www.quotationspage.com... 67.228.101.64
Connecting to www.quotationspage.com|67.228.101.64|:80 connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Remote file exists and could contain further links,
but recursion is disabled -- not retrieving.
$</code></pre>
<p class="calibre10">This output indicates that the URL is valid, but it's too much to read through. You can cut down on the output by adding the <code class="calibre26">-nv</code> option, which stands for non-verbose:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">wget -nv --spider $url</b></code>
2015-09-23 12:49:13
URL: http://www.quotationspage.com/qotd.html 200 OK
$</code></pre>
<p class="calibre10">The <code class="calibre26">-nv</code> option allows just the web address's status to be displayed, making the output much easier to read. Contrary to what you may think, the <code class="calibre26">OK</code> at the non-verbose line's end does not indicate that the web address is valid. The indication is that the web address came back as it was sent. This concept is a little unclear, until you see an invalid web address.</p>
<p class="calibre10">To see an invalid web address indicator, the <code class="calibre26">URL</code> variable is changed to an incorrect web address. The <code class="calibre26">wget</code> command is reissued using this bad address:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/BAD_URL.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">wget -nv --spider $url</b></code>
2015-09-23 12:54:33
URL: http://www.quotationspage.com/error404.html 200 OK
$</code></pre>
<p class="calibre10">Notice that the output still has an <code class="calibre26">OK</code> at its end. However, the web address ends in <code class="calibre26">error404.html</code>. This indicates the web address is invalid.</p>
<p class="calibre10"><span type="pagebreak" title="724" id="calibre_link-1051" class="calibre11"></span>With the necessary <code class="calibre26">wget</code> command to grab the inspirational quote's web page information, and the ability to test the web page's address, it is time to start building the script. Your daily inspirational quote awaits retrieval.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Creating the script</h3>
<p class="calibre10">To test the script as it is built, a parameter containing the website's URL is passed to the script. Within the script, the variable <code class="calibre26">quote_url</code> contains the passed parameter's value:</p>
<pre class="calibre29"><code class="calibre26">#
quote_url=$1
#</code></pre>
<section class="toclist">
<h4 class="calibre25">Checking the passed URL</h4>
<p class="calibre10">It is always a good idea to have checks in place within your script. The first check is to ensure that the daily inspirational quote script website's URL is still valid.</p>
<p class="calibre10">As you would expect, the script checks the web address validity with <code class="calibre26">wget</code> and the <code class="calibre26">--spider</code> option. However, the resulting indicator must be saved so the indicator can be checked later with an <code class="calibre26">if</code> statement test. Thus, the resulting indicator must be saved to a variable. This is a little tricky with the <code class="calibre26">wget</code> command.</p>
<p class="calibre10">To save the indicator output, the standard <code class="calibre26">$()</code> syntax is used around the command. But in addition, <code class="calibre26">STDERR</code> and <code class="calibre26">STDOUT</code> redirection is needed. This is accomplished by tacking on <code class="calibre26">2&gt;&amp;1</code> to the end of the <code class="calibre26">wget</code> command:</p>
<pre class="calibre29"><code class="calibre26">#
check_url=$(wget -nv --spider $quote_url 2&gt;&amp;1)
#</code></pre>
<p class="calibre10">Now the indicator status message is saved within the <code class="calibre26">check_url</code> variable. To carve out the error indicator, <code class="calibre26">error404</code>, from the <code class="calibre26">check_url</code> string, parameter expansion and the <code class="calibre26">echo</code> command can be used:</p>
<pre class="calibre29"><code class="calibre26">#
bad_url=$(echo ${check_url/*error404*/error404})
#</code></pre>
<p class="calibre10">In this example, <span class="chaptertitle"><i class="calibre12">string parameter expansion</i></span> allows the string stored in <code class="calibre26">check_url</code> to be searched. Think of string parameter expansion as a quick and easy <code class="calibre26">sed</code> alternative. Using wildcards around the search word, <code class="calibre26">*error404*</code> allows the entire string to be searched. If the search is successful, the <code class="calibre26">echo</code> command sends the string <code class="calibre26">error404</code> to be stored into the <code class="calibre26">bad_url</code> variable. If the search is not successful, the <code class="calibre26">bad_url</code> variable contains the <code class="calibre26">check_url</code> variable's contents.</p>
<p class="calibre10">Now an <code class="calibre26">if</code> statement <span type="pagebreak" title="725" id="calibre_link-1052" class="calibre11"></span>(Chapter 12) is employed to check the <code class="calibre26">bad_url</code> variable's string. If the string <code class="calibre26">error404</code> is found, a message is displayed and the script exits:</p>
<pre class="calibre29"><code class="calibre26">#
if [ "$bad_url" = "error404" ]
then
    echo "Bad web address"
    echo "$quote_url invalid"
    echo "Exiting script..."
    exit
fi
#</code></pre>
<p class="calibre10">An easier and shorter method can be used. This method removes the need for string parameter expansion and the <code class="calibre26">bad_url</code> variable altogether. A double bracket <code class="calibre26">if</code> statement allows a search to be conducted of the <code class="calibre26">check_url</code> variable:</p>
<pre class="calibre29"><code class="calibre26">if [[ $check_url == *error404* ]]
then
    echo "Bad web address"
    echo "$quote_url invalid"
    echo "Exiting script..."
    exit
fi</code></pre>
<p class="calibre10">The test statement within the <code class="calibre26">if</code> structure searches the <code class="calibre26">check_url</code> variable's string. If the string <code class="calibre26">error404</code> is found anywhere within the variable string, a message is displayed and the script exits. If the indicator string does not contain the error message, the script continues. This statement saves time and effort. No need for any string parameter expansion or even the <code class="calibre26">bad_url</code> variable.</p>
<p class="calibre10">Now that the check is in place, the script can be tested with an invalid web address. The <code class="calibre26">url</code> variable is set to an incorrect URL and passed to the <code class="calibre26">get_quote.sh</code> script:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/BAD_URL.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
Bad web address
www.quotationspage.com/BAD_URL.html invalid
Exiting script...
$</code></pre>
<p class="calibre10">That works great. Just to make sure that all is well, now a valid web address is tested:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="726" id="calibre_link-1053" class="calibre11"></span>No error message received. The script works perfectly so far! This is the only check needed, so the next item to be added to the script is obtaining the web page's data.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Obtaining web page information</h4>
<p class="calibre10">Grabbing the inspiration daily quote's web page data is simple. The <code class="calibre26">wget</code> command shown earlier in the chapter is used in the script. The only needed change is to store the log file and the HTML file, which contains the web page information, in the <code class="calibre26">/tmp </code>directory:</p>
<pre class="calibre29"><code class="calibre26">#
wget -o /tmp/quote.log -O /tmp/quote.html $quote_url
#</code></pre>
<p class="calibre10">Before moving on to the rest of the script, this code section should be tested using a valid web address:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ ./get_quote.sh $url
$
$ <code class="calibre26"><b class="calibre21">ls /tmp/quote.*</b></code>
/tmp/quote.log  /tmp/quote.html
$
$ <code class="calibre26"><b class="calibre21">cat /tmp/quote.html</b></code>
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;html xmlns:fb="http://ogp.me/ns/fb#"&gt;
&lt;head&gt;
[...]
&lt;/body&gt;
&lt;/html&gt;
$</code></pre>
<p class="calibre10">The script still works well! The log file, <code class="calibre26">/tmp/quote.log</code>, and the html file, <code class="calibre26">/tmp/quote.html</code>, were properly created.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If you do not want cookies to be involved when obtaining website information, you can add the <code class="calibre26">--no-cookies</code> option to the <code class="calibre26">wget</code> command. By default, storing cookies is turned off.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The next task is to dig the daily inspirational quote out of the HTML code within the downloaded web page HTML file. This task requires both the <code class="calibre26">sed</code> and the <code class="calibre26">gawk</code> utilities.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Parsing out the desired information</h4>
<p class="calibre10"><span type="pagebreak" title="727" id="calibre_link-1054" class="calibre11"></span>In order to pull out the actual inspirational quote, some processing must take place. This part of the script uses <code class="calibre26">sed </code>and <code class="calibre26">gawk</code> to parse out the desired information.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">This section is where the most variety is introduced when you modify this script for your own use. The <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> utilities are used to search for keywords that are specific for this particular quote website's data. You may need to use different keywords as well as different <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> commands to extract the data you desire.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The script first needs to remove all the HTML tags from the downloaded web page's information stored in the <code class="calibre26">/tmp/quote.html</code> file. The <code class="calibre26">sed</code> utility can provide this capability:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html
#</code></pre>
<p class="calibre10">The preceding code should look very familiar. It was covered in Chapter 21 in the âRemoving HTML tagsâ section.</p>
<p class="calibre10">After the HTML tags are removed, the output looks like the following:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">url=www.quotationspage.com/qotd.html</b></code>
$
$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
[...]
        &gt;Quotes of the Day - The Quotations Page&gt;
&gt;
[...]
&gt;&gt;Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015&gt;&gt;
&gt;&gt;&gt;Horse sense is the thing a horse has which keeps
[...]
&gt;
$</code></pre>
<p class="calibre10">This snipped listing shows that there is still too much unnecessary data in this file. Therefore, some additional parsing must be done. Fortunately, the quote text needed is situated right next to the current date. Therefore, the script can use the current date as a search term!</p>
<p class="calibre10">The <code class="calibre26">grep</code> command, the <code class="calibre26">$()</code> format, and the <code class="calibre26">date</code> command can help here. The output from the <code class="calibre26">sed</code> command is piped into the <code class="calibre26">grep</code> command. The <code class="calibre26">grep</code> command uses the <span type="pagebreak" title="728" id="calibre_link-1055" class="calibre11"></span>current date formatted to match the date used on the quotation's web page. After the date text line is found, two additional text lines are pulled with the <code class="calibre26">-A2</code> parameter:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2
#</code></pre>
<p class="calibre10">Now the script's output looks similar to the following:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
&gt;&gt;Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015&gt;&gt;
&gt;&gt;&gt;Horse sense is the thing a horse has which keeps it from
 betting on people.&gt; &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;W. C. Fields&gt; (1880 -
 1946)&gt; &nbsp; &gt;&gt;&gt;
&gt;&gt;Newspapermen learn to call a murderer 'an alleged murderer'
 and the King of England 'the alleged King of England' to
avoid libel suits.&gt; &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;Stephen Leacock&gt; (1869
 - 1944)&gt; &nbsp; &gt;&gt;&gt; - More quotations on: [&gt;Journalism&gt;] &gt;
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If your Linux system's date is set differently than the quote of the day page's date, you get a blank line instead of a quote. The preceding <code class="calibre26">grep</code> command assumes your system date is the same as the web page's date.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Although the output is greatly reduced, there is still too much clutter in the text. The extra <code class="calibre26">&gt;</code> symbols can easily be removed with the <code class="calibre26">sed</code> utility. In the script, the output from the <code class="calibre26">grep</code> command is piped into the <code class="calibre26">sed</code> utility, which strips off the <code class="calibre26">&gt;</code> symbols:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2 |
sed 's/&gt;//g'
#</code></pre>
<p class="calibre10">With the new script line, the output is now a little clearer:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015
Horse sense is the thing a horse has which keeps it from
 betting on people. W. C. Fields (1880 - 1946) &nbsp;
Newspapermen learn to call a murderer 'an alleged murderer'
 and the King of England 'the alleged King of England' to
avoid libel suits. Stephen Leacock (1869 - 1944) &nbsp;  -
More quotations on: [Journalism]
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="729" id="calibre_link-1056" class="calibre11"></span>Now we're getting somewhere! However, we can still remove a little more clutter from the quotation.</p>
<p class="calibre10">You may have noticed that two quotations are listed in the output instead of one. This happens occasionally with this particular website. Some days, it may be one quote, and other days, it may be two. Therefore, the script needs a way to pull out only the first quote.</p>
<p class="calibre10">The <code class="calibre26">sed</code> utility can help again with this problem. Using the <code class="calibre26">sed</code> utility's next and <code class="calibre26">delete</code> commands (Chapter 21), the string <code class="calibre26">&nbsp;</code> is located. After it's found, <code class="calibre26">sed</code> moves to the next line of the data and deletes it:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2 |
sed 's/&gt;//g' |
sed '/&nbsp;/{n ; d}'
#</code></pre>
<p class="calibre10">Now the script can be tested to see if the new <code class="calibre26">sed</code> addition fixes the multiple quotation problem:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015
Horse sense is the thing a horse has which keeps it from
betting on people. W. C. Fields (1880 - 1946) &nbsp;
$</code></pre>
<p class="calibre10">The extra quotation is removed! One item remains for the quotation cleanup. At the quotation's end, the string <code class="calibre26">&nbsp; </code>is still hanging around. The script could use another <code class="calibre26">sed</code> command to remove this pesky item, but just for variety, the <code class="calibre26">gawk</code> command is used:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2 |
sed 's/&gt;//g' |
sed '/&nbsp;/{n ; d}' |
gawk 'BEGIN{FS="&nbsp;"} {print $1}'
#</code></pre>
<p class="calibre10">In the preceding code, the input field separator variable, <code class="calibre26">FS</code>, is used with the <code class="calibre26">gawk</code> command (Chapter 22). The string <code class="calibre26">&nbsp;</code> is set as a field separator, which causes <code class="calibre26">gawk</code> to drop it from the output:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./get_quote.sh $url</b></code>
Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015
Horse sense is the thing a horse has which keeps it from
betting on people. W. C. Fields (1880 - 1946)
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="730" id="calibre_link-1057" class="calibre11"></span>One last needed script action is to save this quotation text to a file. Here the <code class="calibre26">tee</code> command (Chapter 15) helps. Now the entire quote extraction process looks as follows:</p>
<pre class="calibre29"><code class="calibre26">#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2 |
sed 's/&gt;//g' |
sed '/&nbsp;/{n ; d}' |
gawk 'BEGIN{FS="&nbsp;"} {print $1}' |
tee /tmp/daily_quote.txt  &gt; /dev/null
#</code></pre>
<p class="calibre10">The extracted quote is saved to <code class="calibre26">/tmp/daily_quote.txt</code>, and any output produced by the <code class="calibre26">gawk</code> command is redirected to <code class="calibre26">/dev/null</code> (see Chapter 15). To make the script a little more self-directed, the URL is hard-coded into the script:</p>
<pre class="calibre29"><code class="calibre26">#
quote_url=www.quotationspage.com/qotd.html
#</code></pre>
<p class="calibre10">Now these two new changes to the daily inspirational quote script can be tested:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">./get_quote.sh</b></code>
$
$ <code class="calibre26"><b class="calibre21">cat /tmp/daily_quote.txt</b></code>
Selected from Michael Moncur's Collection of Quotations
 - September 23, 2015
Horse sense is the thing a horse has which keeps it from
betting on people. W. C. Fields (1880 - 1946)
$</code></pre>
<p class="calibre10">That works perfectly! The daily inspiration quote was extracted from the website's data and stored in a text file. You may have noticed by now that this quotation is less a traditional inspirational quote and more a humorous quote. Just know that some people find humor inspirational!</p>
<p class="calibre10">For your review, here's the final daily inspirational quote script with all the needed checks and changes:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
# Get a Daily Inspirational Quote<span type="pagebreak" title="731" id="calibre_link-1058" class="calibre11"></span>
#####################################
#
# Script Variables ####
#
quote_url=www.quotationspage.com/qotd.html
#
# Check url validity ###
#
check_url=$(wget -nv --spider $quote_url 2&gt;&amp;1)
#
if [[ $check_url == *error404* ]]
then
    echo "Bad web address"
    echo "$quote_url invalid"
    echo "Exiting script..."
    exit
fi
#
# Download Web Site's Information
#
wget -o /tmp/quote.log -O /tmp/quote.html $quote_url
#
# Extract the Desired Data
#
sed 's/&lt;[â§&gt;]*//g' /tmp/quote.html |
grep "$(date +%B' '%-d,' '%Y)" -A2 |
sed 's/&gt;//g' |
sed '/&nbsp;/{n ; d}' |
gawk 'BEGIN{FS="&nbsp;"} {print $1}' |
tee /tmp/daily_quote.txt  &gt; /dev/null
#
exit</code></pre>
<p class="calibre10">This script is an excellent opportunity to try out some of your newly learned script writing and command line skills. The following are a few suggested changes for the daily inspirational quote script that you can attempt on your own:</p>
<ul class="calibre14">
<li class="calibre7">Change the website to your favorite quotation or sayings website, and make the necessary changes to the quote extraction commands.</li>
<li class="calibre7">Try different <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> commands for extracting the daily quotation.</li>
<li class="calibre7">Set up the script to run daily on an automated basis via <code class="calibre26">cron</code> (see Chapter 16).</li>
<li class="calibre7">Add a command to display the quote text file at certain times, such as when you first log in for the day.</li>
</ul>
<p class="calibre10">Reading your daily quotes can inspire you. They may just inspire you to get out of that next business meeting. The next chapter section helps you write a script that does just that.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-314" class="calibre4"></a>Generating an Excuse</h2>
<p class="calibre10">You've been there. That endless staff meeting that is full of unimportant information. You would really rather be working on that fascinating bash shell script project back at your desk. Here's a little fun script you can use to get out of the next staff meeting.</p>
<p class="calibre10"><span type="pagebreak" title="732" id="calibre_link-1059" class="calibre11"></span>Short Message Service (SMS) allows text messages to be sent between cell phones. However, you can also use SMS to send text messages directly from e-mail or the command line. The script in this section allows you to construct a text message to be sent at a specified time directly to your phone. Receiving a âcriticalâ message from your Linux system is the perfect excuse for leaving a staff meeting early.</p>
<section class="toclist">
<h3 class="calibre15">Understanding the required functions</h3>
<p class="calibre10">You can send an SMS message from the command line in several ways. One way is via your system's e-mail using your phone carrier's SMS service. Another way is using the <code class="calibre26">curl</code> utility.</p>
<section class="toclist">
<h4 class="calibre25">Learning about curl</h4>
<p class="calibre10">Similar to <code class="calibre26">wget</code>, the <code class="calibre26">curl</code> utility allows you to transfer data from a particular web server. Unlike <code class="calibre26">wget</code>, it also allows you to transfer data to a web server. Transferring data to a particular web server is exactly what is needed here.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">Some Linux distributions, such as Ubuntu, may not have the <code class="calibre26">curl</code> command installed by default. To install it, type <code class="calibre26"><b class="calibre21">sudo apt-get install curl</b></code>. Also, you can find more information about installing software packages in Chapter 9.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Besides the <code class="calibre26">curl</code> utility, you need a website that provides free SMS message transfer. The one used here for this script is <a href="http://textbelt.com/text" class="calibre4">http://textbelt.com/text</a>. This website allows you to send up to 75 text messages per day for free. You need it only for one text message, so it should be no problem.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If your company already uses an SMS provider, such as <a href="http://sendhub.com" class="calibre4">http://sendhub.com</a> or <a href="http://eztexting.com" class="calibre4">http://eztexting.com</a>, you can use those sites in your script instead. Be aware that the syntax needs to change depending upon those SMS provider's requirements.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To use <code class="calibre26">curl</code> and <a href="http://textbelt.com/text" class="calibre4">http://textbelt.com/text</a> to send yourself a text message, you need to use the following syntax:</p>
<pre class="calibre29"><code class="calibre26">$ curl http://textbelt.com/text \
-d number=<code class="calibre26"><i class="calibre12">YourPhoneNumber</i></code> \
-d "message=<code class="calibre26"><i class="calibre12">Your Text Message</i></code>"</code></pre>
<p class="calibre10">The <code class="calibre26">-d</code> option tells <code class="calibre26">curl</code> to send specified data to the website. In this case, the website needs particular data sent in order to send a text message. This data includes <code class="calibre26"><i class="calibre12">YourPhoneNumber</i></code>, <span type="pagebreak" title="733" id="calibre_link-1060" class="calibre11"></span>which is your cell phone number starting with the area code. And it also includes <code class="calibre26"><i class="calibre12">Your Text Message</i></code>, which is the text message you desire to send.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">The <code class="calibre26">curl</code> utility can handle much more than simply transferring data to and from a web server. It can handle many other network protocols, such as FTP, without any human intervention as well. Look at the man pages for <code class="calibre26">curl</code> to discover its rich power.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">When the message is sent, the website provides a success message, <code class="calibre26">âsuccessâ: true</code>, if no problems occurred:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">curl http://textbelt.com/text \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d number=3173334444 \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d "message=Test from curl"</b></code>
{
  "success": true
}$
$</code></pre>
<p class="calibre10">Or it provides a fail message, <code class="calibre26">âsuccessâ: false</code>, if data, such as the phone number, is incorrect:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">$ curl http://textbelt.com/text \</b></code>
<code class="calibre26"><b class="calibre21">-d number=317AAABBBB \</b></code>
<code class="calibre26"><b class="calibre21">-d "message=Test from curl"</b></code>
{
  "success": false,
  "message": "Invalid phone number."
}$
$</code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If your cell phone carrier is not in the United States of America, it is likely that <a href="http://textbelt.com/text" class="calibre4">http://textbelt.com/text</a> will not work for you. You can try <a href="http://textbelt.com/Canada" class="calibre4">http://textbelt.com/Canada</a> if your cell phone carrier is in Canada. If your cell phone carrier is located elsewhere, try <a href="http://textbell.com/intl" class="calibre4">http://textbell.com/intl</a> instead. For additional help, see <a href="http://textbelt.com" class="calibre4">http://textbelt.com</a>.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The success/fail messages are very helpful, but they are unwanted for the script. To remove these messages, simply redirect <code class="calibre26">STDOUT</code> to <code class="calibre26">/dev/null</code> (see Chapter 15). Unfortunately, now <code class="calibre26">curl</code> supplies undesired output:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">$ curl http://textbelt.com/text \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d number=3173334444 \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d "message=Test from curl" &gt; /dev/null</b></code>
  % Total    % Received % Xferd  Average Speed...
                                 Dload  Upload...
  0    21    0    21    0    45     27     58 ...
$</code></pre>
<p class="calibre10"><span type="pagebreak" title="734" id="calibre_link-1061" class="calibre11"></span>The preceding snipped listing shows various statistics, which may be helpful when debugging your <code class="calibre26">curl</code> command. However, for the script, this information must be suppressed. Fortunately, the <code class="calibre26">curl</code> command has a <code class="calibre26">-s</code> option, which makes it silent:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">$ curl -s http://textbelt.com/text \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d number=3173334444 \</b></code>
<code class="calibre26"><b class="calibre21">&gt; -d "message=Test from curl" &gt; /dev/null</b></code></code></pre>
<p class="calibre10">That is much better. The <code class="calibre26">curl</code> command is ready to be put into a script. However, before looking at the script, one more topic needs to be addressed: sending text messages via e-mail.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Choosing to use e-mail</h4>
<p class="calibre10">If you choose not to use the text message relay service provided by <a href="http://textbelt.com/text" class="calibre4">http://textbelt.com/text</a> or if for some reason it doesn't work for you, you can always substitute sending a text message via e-mail. This section briefly covers how to accomplish this substitution.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Caution</h1>
<p class="calibre19">If your cell phone carrier is not in the United States of America, it is likely that this web service will not work for you. Also, your cell phone carrier may block SMS messages from this site. In this case, you must attempt to use e-mail instead.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Whether or not e-mail works as a substitute depends upon your cell phone carrier. If your cell phone carrier has an SMS gateway, you are in luck. Contact your cell phone carrier and find out the name of the gateway. Often, it is something similar to <code class="calibre26">txt.att.net</code> or <code class="calibre26">vtext.com</code>.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">You can often find out your cell phone carrier's SMS gateway on your own via the Internet. One great site listing various SMS gateways, along with usage tips, is <a href="http://martinfitzpatrick.name/list-of-email-to-sms-gateways/" class="calibre4">http://martinfitzpatrick.name/list-of-email-to-sms-gateways/</a>. If you cannot find your carrier there, use your favorite search engine to locate it.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">The basic syntax for sending a text message via e-mail is as follows:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><b class="calibre21">mail -s "</b></code><code class="calibre26"><i class="calibre12">your text message</i></code><code class="calibre26"><b class="calibre21">" </b></code><code class="calibre26"><i class="calibre12">your_phone_number@your_sms_gateway</i></code></code></pre>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Note</h1>
<p class="calibre19">If the <code class="calibre26">mail</code> command does not work on your Linux system, you need to install the <code class="calibre26">mailutils</code> package. See Chapter 9 for a review of installing software packages.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10"><span type="pagebreak" title="735" id="calibre_link-1062" class="calibre11"></span>Unfortunately, after you enter the syntax, you must type your message and press Ctrl+D to send the text message. This is similar to sending a regular e-mail (see Chapter 24). Using this method doesn't work well in a script. Instead, you can store your e-mail message in a file and use it to send a text message. The basic idea for this method is as follows:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">echo "This is a test" &gt; message.txt</b></code>
$ <code class="calibre26"><b class="calibre21">mail -s "Test from email" \</b></code>
<code class="calibre26"><b class="calibre21">3173334444@vtext.com &lt; message.txt</b></code></code></pre>
<p class="calibre10">Now the e-mail syntax is more compatible with a script. However, be aware that many problems may exist with this approach. First, you must have a mail server running on your system (see Chapter 24). Secondly, your phone service provider may block SMS messages coming from your system via e-mail. This is often true, if you are attempting this method from your home.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">If your phone service provider blocks SMS messages coming from your system, you can use a cloud-based e-mail provider as an SMS relay. Use your favorite Internet browser and search for the words <code class="calibre26">SMS relay</code> <code class="calibre26"><i class="calibre12">your_favorite_cloud_email</i></code> and see what sites come up.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">Although sending a text message via e-mail is a potential alternative, it can be fraught with problems. If you can, it is much easier to use a free SMS relay website and the <code class="calibre26">curl</code> utility. The script in the next section uses <code class="calibre26">curl</code> to send a text message to the phone of your choice.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">Creating the script</h3>
<p class="calibre10">After you have the required functions, creating the script to send a text message is fairly simple. You just need a few variables and the <code class="calibre26">curl</code> command.</p>
<p class="calibre10">You need three variables for the script. Setting up these particular data items as variables makes it easier if any of this information changes. The variables are shown here:</p>
<pre class="calibre29"><code class="calibre26">#
phone="3173334444"
SMSrelay_url=http://textbelt.com/text
text_message="System Code Red"
#</code></pre>
<p class="calibre10"><span type="pagebreak" title="736" id="calibre_link-1063" class="calibre11"></span>The only other needed item is the <code class="calibre26">curl</code> utility. Thus, here is the entire send a text message script:</p>
<pre class="calibre29"><code class="calibre26">#!/bin/bash
#
# Send a Text Message
################################
#
# Script Variables ####
#
phone="3173334444"
SMSrelay_url=http://textbelt.com/text
text_message="System Code Red"
#
# Send text ###########
#
curl -s $SMSrelay_url -d \
number=$phone \
-d "message=$text_message" &gt; /dev/null
#
exit</code></pre>
<p class="calibre10">If you see this script as simple and easy, you are right! Even more important, that means you have learned a great deal about shell script writing. Even easy scripts need to be tested, so be sure to test this script using your cell phone number in the <code class="calibre26">phone</code> variable before continuing.</p>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">Tip</h1>
<p class="calibre19">While you are testing your script, be aware that this website, <a href="http://textbelt.com/text" class="calibre4">http://textbelt.com/text</a>, does not allow you to send more than three text messages to the same phone number in less than three minutes.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
<p class="calibre10">To have a text message sent to you at a desired time, you must employ the <code class="calibre26">at</code> command. If you need a reminder, the <code class="calibre26">at</code> command was covered in Chapter 16.</p>
<p class="calibre10">First, you can test the use of the <code class="calibre26">at</code> command with your new script. Have the <code class="calibre26">at</code> utility execute the script by using the <code class="calibre26">-f</code> option along with the script's file name, <code class="calibre26">send_text.sh</code>, in this case. Have the script run immediately using the <code class="calibre26">Now</code> option:</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">at -f send_text.sh Now</b></code>
job 22 at 2015-09-24 10:22
$</code></pre>
<p class="calibre10">The script runs instantly. However, it may be a minute or two before you receive the text message on your phone.</p>
<p class="calibre10">To have the <span type="pagebreak" title="737" id="calibre_link-1064" class="calibre11"></span>script run at another time, you simply use other <code class="calibre26">at</code> command options (see Chapter 16). In the following example, the script is run 25 minutes from the current time.</p>
<pre class="calibre29"><code class="calibre26">$ <code class="calibre26"><b class="calibre21">at -f send_text.sh Now + 25 minutes</b></code>
job 23 at 2015-09-24 10:48
$</code></pre>
<p class="calibre10">Note in the example, the <code class="calibre26">at</code> command provides an informational message when the script is submitted. The date and time listed in that message is when the script will execute.</p>
<p class="calibre10">What fun! Now you have a script utility that will be of assistance when you need an excuse to get out of that staff meeting. Better yet, you could modify the script to send yourself truly serious system messages that need to be addressed.</p>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-315" class="calibre4"></a>Summary</h2>
<p class="calibre10">This chapter showed how to put some of the shell-scripting information presented in the book to use for fun little shell scripts. Each script reinforced material covered in the chapters along with a few new commands and ideas.</p>
<p class="calibre10">The chapter demonstrated how to send a message to another user on the Linux system. The script checked to see whether the user was logged on to the system and whether the user allowed messaging. After those checks were made, the passed message was sent using the <code class="calibre26">write</code> command. Included were some suggestions for modifying this script, which improve your shell-scripting abilities.</p>
<p class="calibre10">The next section walked you through obtaining website information using the <code class="calibre26">wget</code> utility. The created script pulled a quote from the web. After retrieval, the script used several utilities to pull out the actual quote text. These now familiar commands included <code class="calibre26">sed</code>, <code class="calibre26">grep</code>, <code class="calibre26">gawk</code>, and the <code class="calibre26">tee</code> command. For this script, suggestions were made for how the script could be modified. These are well worth pursuing to solidify and improve your new skills.</p>
<p class="calibre10">The chapter ended with a very fun and simple script for sending yourself a text message. We explored the <code class="calibre26">curl</code> utility, along with SMS concepts. Although this is a fun script, it can be modified and used for more serious purposes.</p>
<p class="calibre10">Thanks for joining us on this journey through the Linux command line and shell scripting. We hope you've enjoyed the journey and have learned how to get around on the command line and how to create shell scripts to save time. But don't stop your command line education here. There's always something new being developed in the open source world, whether it's a new command line utility or a full-blown shell. Stay in touch with the Linux community and follow along with the new advances and features.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-316">
<section type="part" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1309" class="calibre4"></a><span class="chaptertitle">Appendix A</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5">Quick Guide to bash Commands</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Appendix</h1>
<ol class="none">
<li class="calibre7">Viewing <span type="pagebreak" title="739" id="calibre_link-324" class="calibre11"></span>the bash built-in commands</li>
<li class="calibre7">Reviewing GNU additional shell commands</li>
<li class="calibre7">Looking at bash environment variables</li>
</ol>
<p class="calibre19">As you've seen throughout this book, the bash shell contains lots of features and thus has lots of commands available. This appendix provides a concise guide to allow you to quickly look up a feature or command that you can use from the bash command line or from a bash shell script.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-317" class="calibre4"></a>Reviewing Built-In Commands</h2>
<p class="calibre10">The bash shell includes many popular commands built into the shell. This provides for faster processing times when using these commands. <a id="calibre_link-1185" href="#calibre_link-1168" class="calibre4">Table A.1</a> shows the built-in commands available directly from the bash shell.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1168" href="#calibre_link-1185" class="calibre4"><b class="calibre21">Table A.1</b></a></span> bash Built-In Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">:</code></td>
<td class="left">Expands listed arguments and redirects as specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">.</code></td>
<td class="left">Reads and executes commands from a designated file in the current shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">alias</code></td>
<td class="left">Defines an alias for the specified command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bg</code></td>
<td class="left">Resumes a job in background mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bind</code></td>
<td class="left">Binds a keyboard sequence to a readline function or macro</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">break</code></td>
<td class="left">Exits from a <code class="calibre26">for</code>, <code class="calibre26">while</code>, <code class="calibre26">select</code>, or <code class="calibre26">until</code> loop</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">builtin</code></td>
<td class="left">Executes the specified shell built-in command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">caller</code></td>
<td class="left">Returns the context of any active subroutine call</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cd</code></td>
<td class="left">Changes the current directory to the specified directory</td>
</tr>
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">command</code></td>
<td class="left">Executes the specified command <span type="pagebreak" title="740" id="calibre_link-325" class="calibre11"></span>without the normal shell lookup</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">compgen</code></td>
<td class="left">Generates possible completion matches for the specified word</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">complete</code></td>
<td class="left">Displays how the specified words would be completed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">compopt</code></td>
<td class="left">Changes options for how the specified words would be completed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">continue</code></td>
<td class="left">Resumes the next iteration of a <code class="calibre26">for</code>, <code class="calibre26">while</code>, <code class="calibre26">select</code>, or <code class="calibre26">until</code> loop</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">declare</code></td>
<td class="left">Declares a variable or variable type</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">dirs</code></td>
<td class="left">Displays a list of currently remembered directories</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">disown</code></td>
<td class="left">Removes the specified jobs from the jobs table for the process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">echo</code></td>
<td class="left">Displays the specified string to <code class="calibre26">STDOUT</code></td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">enable</code></td>
<td class="left">Enables or disables the specified built-in shell command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">eval</code></td>
<td class="left">Concatenates the specified arguments into a single command, and executes the command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exec</code></td>
<td class="left">Replaces the shell process with the specified command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">exit</code></td>
<td class="left">Forces the shell to exit with the specified exit status</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">export</code></td>
<td class="left">Sets the specified variables to be available for child shell processes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fc</code></td>
<td class="left">Selects a list of commands from the history list</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">fg</code></td>
<td class="left">Resumes a job in foreground mode</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">getopts</code></td>
<td class="left">Parses the specified positional parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">hash</code></td>
<td class="left">Finds and remembers the full pathname of the specified command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">help</code></td>
<td class="left">Displays a help file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">history</code></td>
<td class="left">Displays the command history</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">jobs</code></td>
<td class="left">Lists the active jobs</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">kill</code></td>
<td class="left">Sends a system signal to the specified process ID (PID)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">let</code></td>
<td class="left">Evaluates each argument in a mathematical expression</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">local</code></td>
<td class="left">Creates a limited-scope variable in a function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">logout</code></td>
<td class="left">Exits a login shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mapfile</code></td>
<td class="left">Reads <code class="calibre26">STDIN</code> lines and puts them into an indexed array</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">popd</code></td>
<td class="left">Removes entries from the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">printf</code></td>
<td class="left">Displays text using formatted strings</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pushd</code></td>
<td class="left">Adds a directory to the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pwd</code></td>
<td class="left"><span type="pagebreak" title="741" id="calibre_link-326" class="calibre11"></span>Displays the pathname of the current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">read</code></td>
<td class="left">Reads one line of data from <code class="calibre26">STDIN</code>, and assigns it to a variable</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">readarray</code></td>
<td class="left">Reads <code class="calibre26">STDIN</code> lines, and puts them into an indexed array</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">readonly</code></td>
<td class="left">Reads one line of data from <code class="calibre26">STDIN</code>, and assigns it to a variable that can't be changed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">return</code></td>
<td class="left">Forces a function to exit with a value that can be retrieved by the calling script</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">set</code></td>
<td class="left">Sets and displays environment variable values and shell attributes</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">shift</code></td>
<td class="left">Rotates positional parameters down one position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">shopt</code></td>
<td class="left">Toggles the values of variables controlling optional shell behavior</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">source</code></td>
<td class="left">Reads and executes commands from a designated file in the current shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">suspend</code></td>
<td class="left">Suspends the execution of the shell until a <code class="calibre26">SIGCONT</code> signal is received</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">test</code></td>
<td class="left">Returns an exit status of 0 or 1 based on the specified condition</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">times</code></td>
<td class="left">Displays the accumulated user and system shell times.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">trap</code></td>
<td class="left">Executes the specified command if the specified system signal is received</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">type</code></td>
<td class="left">Displays how the specified word would be interpreted if used as a command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">typeset</code></td>
<td class="left">Declares a variable or variable type</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ulimit</code></td>
<td class="left">Sets a limit on the specified resource for system users</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">umask</code></td>
<td class="left">Sets default permissions for newly created files and directories</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unalias</code></td>
<td class="left">Removes the specified alias</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">unset</code></td>
<td class="left">Removes the specified environment variable or shell attribute</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">wait</code></td>
<td class="left">Waits for the specified process to complete, and returns the exit status</td>
</tr>
</table>
</figure>
<p class="calibre10">The built-in commands provide higher performance than external commands, but the more built-in commands that are added to a shell, the more memory it consumes with commands that you may never use. The bash shell also contains external commands that provide extended functionality for the shell. These are discussed in the following section.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-318" class="calibre4"></a>Looking at Common bash Commands</h2>
<p class="calibre10">In addition to the built-in commands, the bash shell utilizes external commands to allow you to maneuver around the filesystem and manipulate files and directories. <a id="calibre_link-1186" href="#calibre_link-1169" class="calibre4">Table A.2</a> shows the common external commands you'll want to use when working in the bash shell.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1169" href="#calibre_link-1186" class="calibre4"><b class="calibre21">Table A.2</b></a></span> The bash Shell External Commands</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">bzip2</code></td>
<td class="left">Compresses <span type="pagebreak" title="742" id="calibre_link-327" class="calibre11"></span>using the Burrows-Wheeler block sorting text compression algorithm and Huffman coding</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cat</code></td>
<td class="left">Lists the contents of the specified file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chage</code></td>
<td class="left">Changes the password expiration date for the specified system user account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chfn</code></td>
<td class="left">Changes the specified user account's comment information</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chgrp</code></td>
<td class="left">Changes the default group of the specified file or directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chmod</code></td>
<td class="left">Changes system security permissions for the specified file or directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chown</code></td>
<td class="left">Changes the default owner of the specified file or directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chpasswd</code></td>
<td class="left">Reads a file of login name and password pairs and updates the passwords</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">chsh</code></td>
<td class="left">Changes the specified user account's default shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">clear</code></td>
<td class="left">Removes text from a terminal emulator or virtual console terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">compress</code></td>
<td class="left">Original Unix file compression utility</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">coproc</code></td>
<td class="left">Spawns a subshell in background mode and executes the designated command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cp</code></td>
<td class="left">Copies the specified files to an alternate location</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">crontab</code></td>
<td class="left">Initiates the editor for the user's crontable file, if allowed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">cut</code></td>
<td class="left">Removes a designated portion of each specified file's lines</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">date</code></td>
<td class="left">Displays the date in various formats</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">df</code></td>
<td class="left">Displays current disk space statistics for all mounted devices</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">du</code></td>
<td class="left">Displays disk usage statistics for the specified file path</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">emacs</code></td>
<td class="left">Invokes the emacs text editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">file</code></td>
<td class="left">Views the file type of the specified file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">find</code></td>
<td class="left">Performs a recursive search for files</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">free</code></td>
<td class="left">Checks available and used memory on the system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gawk</code></td>
<td class="left">Streams editing using programming language commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">grep</code></td>
<td class="left">Searches a file for the specified text string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gedit</code></td>
<td class="left">Invokes the GNOME Desktop editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">getopt</code></td>
<td class="left">Parses command options including long options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">groups</code></td>
<td class="left">Displays group membership of the designated user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">groupadd</code></td>
<td class="left">Creates a new system group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">groupmod</code></td>
<td class="left">Modifies an existing system group</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">gzip</code></td>
<td class="left">The GNU Project's compression using Lempel-Ziv compression</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">head</code></td>
<td class="left">Displays <span type="pagebreak" title="743" id="calibre_link-328" class="calibre11"></span>the first portion of the specified file's contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">help</code></td>
<td class="left">Displays the help pages for bash built-in commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">killall</code></td>
<td class="left">Sends a system signal to a running process based on process name</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">kwrite</code></td>
<td class="left">Invokes the KWrite text editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">less</code></td>
<td class="left">Advanced viewing of file contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">link</code></td>
<td class="left">Creates a link to a file using an alias name</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ln</code></td>
<td class="left">Creates a symbolic or hard link to a designated file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ls</code></td>
<td class="left">Lists directory contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">makewhatis</code></td>
<td class="left">Creates the whatis database allowing man page keyword searches</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">man</code></td>
<td class="left">Displays the man pages for the designated command or topic</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mkdir</code></td>
<td class="left">Creates the specified directory under the current directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">more</code></td>
<td class="left">Lists the contents of the specified file, pausing after each screen of data</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mount</code></td>
<td class="left">Displays or mounts disk devices into the virtual filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">mv</code></td>
<td class="left">Renames a file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">nano</code></td>
<td class="left">Invokes the nano text editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">nice</code></td>
<td class="left">Runs a command using a different priority level on the system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">passwd</code></td>
<td class="left">Changes the password for a system user account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ps</code></td>
<td class="left">Displays information about the running processes on the system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">pwd</code></td>
<td class="left">Displays the current directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">renice</code></td>
<td class="left">Changes the priority of a running application on the system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rm</code></td>
<td class="left">Deletes the specified file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">rmdir</code></td>
<td class="left">Deletes the specified directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sed</code></td>
<td class="left">Streams line editing using editor commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sleep</code></td>
<td class="left">Pauses bash shell operation for a specified amount of time</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sort</code></td>
<td class="left">Organizes data in a data file based on the specified order</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">stat</code></td>
<td class="left">Views the file statistics of the specified file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">sudo</code></td>
<td class="left">Runs an application as the root user account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">tail</code></td>
<td class="left">Displays the last portion of the specified file's contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">tar</code></td>
<td class="left">Archives data and directories into a single file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">top</code></td>
<td class="left">Displays the active processes, showing vital system statistics</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">touch</code></td>
<td class="left">Creates a new empty file or updates the timestamp on an existing file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">umount</code></td>
<td class="left">Removes a mounted disk device from the virtual filesystem</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">uptime</code></td>
<td class="left">Displays information on how long the system has been running</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">useradd</code></td>
<td class="left">Creates a new system user account</td>
</tr>
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">userdel</code></td>
<td class="left">Removes an <span type="pagebreak" title="744" id="calibre_link-329" class="calibre11"></span>existing system user account.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">usermod</code></td>
<td class="left">Modifies an existing system user account</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vi</code></td>
<td class="left">Invokes the vim text editor</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">vmstat</code></td>
<td class="left">Produces a detailed report on memory and CPU usage on the system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">whereis</code></td>
<td class="left">Displays a designated command's files, including binary, source code, and man pages</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">which</code></td>
<td class="left">Finds the location of an executable file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">who</code></td>
<td class="left">Displays users currently logged into system</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">whoami</code></td>
<td class="left">Displays the current user's username</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">xargs</code></td>
<td class="left">Takes items from <code class="calibre26">STDIN</code>, builds commands, and executes the commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">zip</code></td>
<td class="left">Unix version of the Windows PKZIP program</td>
</tr>
</table>
</figure>
<p class="calibre10">You can accomplish just about any task you need to on the command line using these commands.</p>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-319" class="calibre4"></a>Assessing Environment Variables</h2>
<p class="calibre10">The bash shell also utilizes many environment variables. Although environment variables aren't commands, they often affect how shell commands operate, so it's important to know the shell environment variables. <a id="calibre_link-1187" href="#calibre_link-1170" class="calibre4">Table A.3</a> shows the default environment variables available in the bash shell.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1170" href="#calibre_link-1187" class="calibre4"><b class="calibre21">Table A.3</b></a></span> bash Shell Default Environment Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">*</code></td>
<td class="left">Contains all the command line parameters as a single text value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">@</code></td>
<td class="left">Contains all the command line parameters as separate text values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">#</code></td>
<td class="left">The number of command line parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">?</code></td>
<td class="left">The exit status of the most recently used foreground process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-</code></td>
<td class="left">The current command line option flags</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">$</code></td>
<td class="left">The process ID (PID) of the current shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">!</code></td>
<td class="left">The <span type="pagebreak" title="745" id="calibre_link-330" class="calibre11"></span>PID of the most recently executed background process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">0</code></td>
<td class="left">The name of the command from the command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">_</code></td>
<td class="left">The absolute pathname of the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH</code></td>
<td class="left">The full filename used to invoke the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASHOPTS</code></td>
<td class="left">Enabled shell options in a colon-separated list</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASHPID</code></td>
<td class="left">The current bash shell's process ID</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ALIASES</code></td>
<td class="left">An array containing the currently used aliases.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ARGC</code></td>
<td class="left">The number of parameters in the current subroutine</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ARGV</code></td>
<td class="left">An array containing all the command line parameters specified</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_CMDS</code></td>
<td class="left">An array containing the internal hash table of commands</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_COMMAND</code></td>
<td class="left">The name of the command currently being executed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_ENV</code></td>
<td class="left">When set, each bash script attempts to execute a startup file defined by this variable before running.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_EXECUTION_STRING</code></td>
<td class="left">The command used in the <code class="calibre26">-c</code> command line option</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_LINENO</code></td>
<td class="left">An array containing the line numbers of each command in the script</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_REMATCH</code></td>
<td class="left">An array containing text elements that match a specified regular expression</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_SOURCE</code></td>
<td class="left">An array containing source file names for the declared functions in the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_SUBSHELL</code></td>
<td class="left">The number of subshells spawned by the current shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_VERSINFO</code></td>
<td class="left">A variable array that contains the individual major and minor version numbers of the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_VERSION</code></td>
<td class="left">The version number of the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">BASH_XTRACEFD</code></td>
<td class="left">When set to a valid file descriptor integer, trace output is generated and separated from diagnostic and error messages. The file descriptor must have <code class="calibre26">set -x</code> enabled.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COLUMNS</code></td>
<td class="left">Contains the terminal width of the terminal used for the current instance of the bash shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_CWORD</code></td>
<td class="left">An index into the variable <code class="calibre26">COMP_WORDS</code>, which contains the current cursor position</td>
</tr>
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_KEY</code></td>
<td class="left">The <span type="pagebreak" title="746" id="calibre_link-331" class="calibre11"></span>completion invocation character keyboard key</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_LINE</code></td>
<td class="left">The current command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_POINT</code></td>
<td class="left">The index of the current cursor position relative to the beginning of the current command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_TYPE</code></td>
<td class="left">The completion type integer value</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COM_WORDBREAKS</code></td>
<td class="left">A set of characters used as word separators when performing word completion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMP_WORDS</code></td>
<td class="left">A variable array that contains the individual words on the current command line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COMPREPLY</code></td>
<td class="left">A variable array that contains the possible completion codes generated by a shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">COPROC</code></td>
<td class="left">A variable array that holds file descriptors for an unnamed coprocess' I/O</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">DIRSTACK</code></td>
<td class="left">A variable array that contains the current contents of the directory stack</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">EMACS</code></td>
<td class="left">When set, the shell assumes it's running in an emacs shell buffer and disables line editing.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ENV</code></td>
<td class="left">When the shell is invoked in POSIX mode, each bash script attempts to execute a startup file defined by this variable before running.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">EUID</code></td>
<td class="left">The numeric effective user ID of the current user</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FCEDIT</code></td>
<td class="left">The default editor used by the <code class="calibre26">fc</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FIGNORE</code></td>
<td class="left">A colon-separated list of suffixes to ignore when performing file name completion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FUNCNAME</code></td>
<td class="left">The name of the currently executing shell function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FUNCNEST</code></td>
<td class="left">The maximum level for nesting functions</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">GLOBIGNORE</code></td>
<td class="left">A colon-separated list of patterns defining the set of filenames to be ignored by file name expansion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">GROUPS</code></td>
<td class="left">A variable array containing the list of groups of which the current user is a member</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">histchars</code></td>
<td class="left">Up to three characters that control history expansion</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTCMD</code></td>
<td class="left">The <span type="pagebreak" title="747" id="calibre_link-332" class="calibre11"></span>history number of the current command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTCONTROL</code></td>
<td class="left">Controls what commands are entered in the shell history list</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTFILE</code></td>
<td class="left">The name of the file to save the shell history list (<code class="calibre26">.bash_history</code> by default)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTFILESIZE</code></td>
<td class="left">The maximum number of lines to save in the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTIGNORE</code></td>
<td class="left">A colon-separated list of patterns used to decide which commands are ignored for the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTSIZE</code></td>
<td class="left">The maximum number of commands stored in the history file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HISTTIMEFORMAT</code></td>
<td class="left">When set, determines the format string for the history file entries' time stamps</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTFILE</code></td>
<td class="left">Contains the name of the file that should be read when the shell needs to complete a hostname</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTNAME</code></td>
<td class="left">The name of the current host</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">HOSTTYPE</code></td>
<td class="left">A string describing the machine the bash shell is running on</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">IGNOREEOF</code></td>
<td class="left">The number of consecutive EOF characters the shell must receive before exiting. If this value doesn't exist, the default is 1.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">INPUTRC</code></td>
<td class="left">The name of the readline initialization file (The default is <code class="calibre26">.inputrc.</code>)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LANG</code></td>
<td class="left">The locale category for the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_ALL</code></td>
<td class="left">Overrides the <code class="calibre26">LANG</code> variable, defining a locale category</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_COLLATE</code></td>
<td class="left">Sets the collation order used when sorting string values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_CTYPE</code></td>
<td class="left">Determines the interpretation of characters used in file name expansion and pattern matching</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_MESSAGES</code></td>
<td class="left">Determines the locale setting used when interpreting double-quoted strings preceded by a dollar sign</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LC_NUMERIC</code></td>
<td class="left">Determines the locale setting used when formatting numbers</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LINENO</code></td>
<td class="left">The line number in a script currently executing</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">LINES</code></td>
<td class="left">Defines the number of lines available on the terminal</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MACHTYPE</code></td>
<td class="left">A string defining the system type in <i class="calibre12">cpu-company-system</i> format</td>
</tr>
<tr class="calibre28">
<td class="left">Command</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAILCHECK</code></td>
<td class="left">How often (in seconds) the <span type="pagebreak" title="748" id="calibre_link-333" class="calibre11"></span>shell should check for new mail (default is 60)</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">MAPFILE</code></td>
<td class="left">Array variable containing the <code class="calibre26">mapfile</code> command's read text; used only when no variable name is given</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OLDPWD</code></td>
<td class="left">The previous working directory used in the shell</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OPTERR</code></td>
<td class="left">If set to 1, the bash shell displays errors generated by the <code class="calibre26">getopts</code> command.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OSTYPE</code></td>
<td class="left">A string defining the operating system the shell is running on</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PIPESTATUS</code></td>
<td class="left">A variable array containing a list of exit status values from the processes in the foreground process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">POSIXLY_CORRECT</code></td>
<td class="left">If set, bash starts in POSIX mode.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PPID</code></td>
<td class="left">The process ID (PID) of the bash shell's parent process</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PROMPT_COMMAND</code></td>
<td class="left">If set, the command to execute before displaying the primary prompt</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS1</code></td>
<td class="left">The primary command line prompt string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS2</code></td>
<td class="left">The secondary command line prompt string</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS3</code></td>
<td class="left">The prompt to use for the <code class="calibre26">select</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PS4</code></td>
<td class="left">The prompt displayed before the command line is echoed if the bash <code class="calibre26">-x</code> parameter is used.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">PWD</code></td>
<td class="left">The current working directory</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RANDOM</code></td>
<td class="left">Returns a random number between 0 and 32767. Assigning a value to this variable seeds the random number generator.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">READLINE_LINE</code></td>
<td class="left">The readline line buffer contents</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">READLINE_POINT</code></td>
<td class="left">The current readline line buffer's insertion point position</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">REPLY</code></td>
<td class="left">The default variable for the <code class="calibre26">read</code> command</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SECONDS</code></td>
<td class="left">The number of seconds since the shell was started. Assigning a value resets the timer to the value.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHELL</code></td>
<td class="left">The shell's full pathname</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHELLOPTS</code></td>
<td class="left">A colon-separated list of enabled bash shell options</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">SHLVL</code></td>
<td class="left">Indicates the shell level, incremented by 1 each time a new bash shell is started</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TIMEFORMAT</code></td>
<td class="left">A <span type="pagebreak" title="749" id="calibre_link-334" class="calibre11"></span>format specifying how the shell displays time values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TMOUT</code></td>
<td class="left">The value of how long (in seconds) the <code class="calibre26">select</code> and <code class="calibre26">read</code> commands should wait for input. The default of 0 indicates to wait indefinitely.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">TMPDIR</code></td>
<td class="left">When set to a directory name, the shell uses the directory as a location for temporary shell files.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">UID</code></td>
<td class="left">The numeric real user ID of the current user</td>
</tr>
</table>
</figure>
<p class="calibre10">You display the environment variables using the <code class="calibre26">set</code> built-in command. The default shell environment variables set at boot time can and often do vary between different Linux distributions.</p>
</section>
</section>
</div>


<div type="bodymatter" class="calibre1" id="calibre_link-320">
<section type="part" class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1310" class="calibre4"></a><span class="chaptertitle">Appendix B</span></h1>
</header>
<section class="toclist">
<h2 class="calibre5">Quick Guide to sed and gawk</h2>
<aside type="sidebar" class="calibre16">
<div class="top"><hr class="calibre17" /></div>
<section class="feature">
<h1 class="calibre18">In This Appendix</h1>
<ol class="none">
<li class="calibre7">The <span type="pagebreak" title="751" id="calibre_link-335" class="calibre11"></span>basics for using sed</li>
<li class="calibre7">What you need to know about gawk</li>
</ol>
<p class="calibre19">If you do any type of data handling in your shell scripts, most likely you'll need to use either the <code class="calibre26">sed</code> program or the <code class="calibre26">gawk</code> program (and sometimes both). This appendix provides a quick reference for <code class="calibre26">sed</code> and <code class="calibre26">gawk</code> commands that come in handy when working with data in your shell scripts.</p>
<div class="top"><hr class="calibre17" /></div>
</section>
</aside>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-321" class="calibre4"></a>The sed Editor</h2>
<p class="calibre10">The <code class="calibre26">sed</code> editor can manipulate data in a data stream based on commands you either enter into the command line or store in a command text file. It reads one line of data at a time from the input and matches that data with the supplied editor commands, changes data in the stream as specified in the commands, and then outputs the new data to <code class="calibre26">STDOUT</code>.</p>
<section class="toclist">
<h3 class="calibre15">Starting the sed editor</h3>
<p class="calibre10">Here's the format for using the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26">sed <code class="calibre26"><i class="calibre12">options script file</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">options</i></code> parameters allow you to customize the behavior of the <code class="calibre26">sed</code> command and include the options shown in <a id="calibre_link-1209" href="#calibre_link-1171" class="calibre4">Table B.1</a>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1171" href="#calibre_link-1209" class="calibre4"><b class="calibre21">Table B.1</b></a></span> The sed Command Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-e</code> <code class="calibre26"><i class="calibre12">script</i></code></td>
<td class="left">Adds commands specified in <code class="calibre26"><i class="calibre12">script</i> </code>to the commands run while processing the input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code> <code class="calibre26"><i class="calibre12">file</i></code></td>
<td class="left">Adds the commands specified in the file <code class="calibre26"><i class="calibre12">file</i> </code>to the commands run while processing the input</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-n</code></td>
<td class="left">Doesn't produce output for each command, but waits for the <code class="calibre26">print</code> command</td>
</tr>
</table>
</figure>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">script</i></code> <span type="pagebreak" title="752" id="calibre_link-336" class="calibre11"></span>parameter specifies a single command to apply against the stream data. If more than one command is required, you must use either the <code class="calibre26">-e</code> option to specify them in the command line or the <code class="calibre26">-f</code> option to specify them in a separate file.</p>
</section>
<section class="toclist">
<h3 class="calibre15">sed commands</h3>
<p class="calibre10">The <code class="calibre26">sed</code> editor script contains commands that <code class="calibre26">sed</code> processes for each line of data in the input stream. This section describes some of the more common <code class="calibre26">sed</code> commands you'll want to use.</p>
<section class="toclist">
<h4 class="calibre25">Substitution</h4>
<p class="calibre10">The <code class="calibre26">s</code> command substitutes text in the input stream. Here's the format of the <code class="calibre26">s</code> command:</p>
<pre class="calibre29"><code class="calibre26">s/<code class="calibre26"><i class="calibre12">pattern/replacement/flags</i></code></code></pre>
<p class="calibre10"><code class="calibre26"><i class="calibre12">pattern</i></code> is the text to replace, and <code class="calibre26"><i class="calibre12">replacement</i></code> is the new text that <code class="calibre26">sed</code> inserts in its place.</p>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">flags</i></code> parameter controls how the substitution takes place. Four types of substitution flags are available:</p>
<ul class="calibre14">
<li class="calibre7">A number indicates the pattern occurrence that should be replaced.</li>
<li class="calibre7"><code class="calibre26">g</code> indicates that all occurrences of the text should be replaced.</li>
<li class="calibre7"><code class="calibre26">p</code> indicates that the contents of the original line should be printed.</li>
<li class="calibre7"><code class="calibre26">w</code> <code class="calibre26"><i class="calibre12">file</i></code> indicates that the results of the substitution should be written to a file.</li>
</ul>
<p class="calibre10">In the first type of substitution, you can specify which occurrence of the matching pattern the <code class="calibre26">sed</code> editor should replace. For example, you use the number 2 to replace only the second occurrence of the pattern.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Addressing</h4>
<p class="calibre10">By default, the commands you use in the <code class="calibre26">sed</code> editor apply to all lines of the text data. If you want to apply a command to only a specific line, or a group of lines, you must use <span class="chaptertitle"><i class="calibre12">line addressing.</i></span></p>
<p class="calibre10">There are two forms of line addressing in the <code class="calibre26">sed</code> editor:</p>
<ul class="calibre14">
<li class="calibre7">A numeric range of lines</li>
<li class="calibre7">A text pattern that filters out a line</li>
</ul>
<p class="calibre10">Both forms use the same format for specifying the address:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">[address]command </i></code></code></pre>
<p class="calibre10"><span type="pagebreak" title="753" id="calibre_link-337" class="calibre11"></span>When using numeric line addressing, you reference lines by their line position in the text stream. The <code class="calibre26">sed</code> editor assigns the first line in the text stream as line number 1 and continues sequentially for each new line.</p>
<pre class="calibre29"><code class="calibre26">$ sed '2,3s/dog/cat/' data1 </code></pre>
<p class="calibre10">The other method of restricting which lines a command applies to is a bit more complicated. The <code class="calibre26">sed</code> editor allows you to specify a text pattern that it uses to filter lines for the command. Here's the format for this:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">/pattern/command </i></code></code></pre>
<p class="calibre10">You must encapsulate the <code class="calibre26"><i class="calibre12">pattern</i></code> you specify in forward slashes. The <code class="calibre26">sed</code> editor applies the command only to lines that contain the text pattern that you specify.</p>
<pre class="calibre29"><code class="calibre26">$ sed '/rich/s/bash/csh/' /etc/passwd </code></pre>
<p class="calibre10">This filter finds the line that contains the text <code class="calibre26">rich</code> and replaces the text <code class="calibre26">bash</code> with <code class="calibre26">csh</code>.</p>
<p class="calibre10">You can also group more than one command together for a specific address:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">address </i>{</code>
<code class="calibre26"><i class="calibre12">     command1</i></code>
<code class="calibre26"><i class="calibre12">     command2</i></code>
<code class="calibre26"><i class="calibre12">     command3</i></code> }</code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor applies each of the commands you specify only to lines that match the address specified. The <code class="calibre26">sed</code> editor processes each command listed on the address line(s):</p>
<pre class="calibre29"><code class="calibre26">$ sed '2{
&gt; s/fox/elephant/
&gt; s/dog/cat/
&gt; }' data1 </code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor applies each of the substitutions to the second line in the data file.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Deleting lines</h4>
<p class="calibre10">The delete command, <code class="calibre26">d</code>, pretty much does what it says. It deletes any text lines that match the addressing scheme supplied. Be careful with the delete command, because if you forget to include an addressing scheme, all the lines are deleted from the stream:</p>
<pre class="calibre29"><code class="calibre26">$ sed 'd' data1 </code></pre>
<p class="calibre10">The delete command is obviously most useful when used in conjunction with a specified address. This allows you to delete specific lines of text from the data stream, either by line number:</p>
<pre class="calibre29"><code class="calibre26">$ sed '3d' data6 </code></pre>
<p class="calibre10"><span type="pagebreak" title="754" id="calibre_link-338" class="calibre11"></span>or by a specific range of lines:</p>
<pre class="calibre29"><code class="calibre26">$ sed '2,3d' data6 </code></pre>
<p class="calibre10">The pattern-matching feature of the <code class="calibre26">sed</code> editor also applies to the delete command:</p>
<pre class="calibre29"><code class="calibre26">$ sed '/number 1/d' data6 </code></pre>
<p class="calibre10">Only lines matching the specified text are deleted from the stream.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Inserting and appending text</h4>
<p class="calibre10">As you would expect, like any other editor, the <code class="calibre26">sed</code> editor allows you to insert and append text lines to the data stream. The difference between the two actions can be confusing:</p>
<ul class="calibre14">
<li class="calibre7">The insert command (<code class="calibre26">i</code>) adds a new line before the specified line.</li>
<li class="calibre7">The append command (<code class="calibre26">a</code>) adds a new line after the specified line.</li>
</ul>
<p class="calibre10">The format of these two commands can be confusing: You can't use these commands on a single command line. You must specify the line to insert or append on a separate line by itself. Here's the format for doing this:</p>
<pre class="calibre29"><code class="calibre26">sed '<code class="calibre26"><i class="calibre12">[address]command\</i></code>
<code class="calibre26"><i class="calibre12">new line</i></code>'</code></pre>
<p class="calibre10">The text in <code class="calibre26"><i class="calibre12">new line</i></code> appears in the <code class="calibre26">sed</code> editor output in the place you specify. Remember that when you use the insert command, the text appears before the data stream text:</p>
<pre class="calibre29"><code class="calibre26">$ echo "testing" | sed 'i\
&gt; This is a test'
This is a test
testing
$ </code></pre>
<p class="calibre10">And when you use the append command, the text appears after the data stream text:</p>
<pre class="calibre29"><code class="calibre26">$ echo "testing" | sed 'a\
&gt; This is a test'
testing
This is a test
$ </code></pre>
<p class="calibre10">This allows you to insert text at the end of the normal text.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Changing lines</h4>
<p class="calibre10">The change command allows you to change the contents of an entire line of text in the data stream. It works the same as the insert and append commands, in that you must specify the new line separately from the rest of the <code class="calibre26">sed</code> command:</p>
<pre class="calibre29"><code class="calibre26">$ sed '3c\
&gt; This is a changed line of text.' data6 </code></pre>
<p class="calibre10">The <span type="pagebreak" title="755" id="calibre_link-339" class="calibre11"></span>backslash character is used to indicate the new line of data in the script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Transform command</h4>
<p class="calibre10">The transform command (<code class="calibre26">y</code>) is the only <code class="calibre26">sed</code> editor command that operates on a single character. The transform command uses this format:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">[address]y/inchars/outchars/ </i></code></code></pre>
<p class="calibre10">The transform command performs a one-to-one mapping of the <code class="calibre26"><i class="calibre12">inchars</i></code> and the <code class="calibre26"><i class="calibre12">outchars</i></code> values. The first character in <code class="calibre26"><i class="calibre12">inchars</i></code> is converted to the first character in <code class="calibre26"><i class="calibre12">outchars</i></code>. The second character in <code class="calibre26"><i class="calibre12">inchars</i></code> is converted to the second character in <code class="calibre26"><i class="calibre12">outchars</i></code>. This mapping continues throughout the length of the specified characters. If the <code class="calibre26"><i class="calibre12">inchars</i></code> and <code class="calibre26"><i class="calibre12">outchars</i></code> are not the same length, the <code class="calibre26">sed</code> editor produces an error message.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Printing lines</h4>
<p class="calibre10">Similar to the <code class="calibre26">p</code> flag in the substitution command, the <code class="calibre26">p</code> command prints a line in the <code class="calibre26">sed</code> editor output. The most common use for the print command is for printing lines that contain matching text from a text pattern:</p>
<pre class="calibre29"><code class="calibre26">$ sed -n '/number 3/p' data6
This is line number 3.
$ </code></pre>
<p class="calibre10">The <code class="calibre26">print</code> command allows you to filter only specific lines of data from the input stream.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Writing to a file</h4>
<p class="calibre10">The <code class="calibre26">w</code> command is used to write lines to a file. Here's the format for the <code class="calibre26">w</code> command:</p>
<pre class="calibre29"><code class="calibre26"><code class="calibre26"><i class="calibre12">[address]w filename </i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">filename</i></code> can be specified as either a relative or absolute pathname, but in either case, the person running the <code class="calibre26">sed</code> editor must have write permissions for the file. The <code class="calibre26"><i class="calibre12">address</i></code> can be any type of addressing method used in <code class="calibre26">sed</code>, such as a single line number, a text pattern, or a range of line numbers or text patterns.</p>
<p class="calibre10">Here's an example that prints only the first two lines of a data stream to a text file:</p>
<pre class="calibre29"><code class="calibre26">$ sed '1,2w test' data6 </code></pre>
<p class="calibre10">The output file <code class="calibre26">test</code> contains only the first two lines from the input stream.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading from a file</h4>
<p class="calibre10">You've already seen how to insert and append text into a data stream from the <code class="calibre26">sed</code> command line. The read command (<code class="calibre26">r</code>) allows you to insert data contained in a separate file.</p>
<p class="calibre10">Here's <span type="pagebreak" title="756" id="calibre_link-340" class="calibre11"></span>the format of the read command:</p>
<pre class="calibre29"><code class="calibre26">[<code class="calibre26"><i class="calibre12">address</i></code>]r <code class="calibre26"><i class="calibre12">filename</i></code></code></pre>
<p class="calibre10">The <code class="calibre26"><i class="calibre12">filename</i></code> parameter specifies either an absolute or relative pathname for the file that contains the data. You can't use a range of addresses for the read command. You can specify only a single line number or text pattern address. The <code class="calibre26">sed</code> editor inserts the text from the file after the address.</p>
<pre class="calibre29"><code class="calibre26">$ sed '3r data' data2 </code></pre>
<p class="calibre10">The <code class="calibre26">sed</code> editor inserts the complete text from the data file into the data2 file, starting at line 3 of the data2 file.</p>
</section>
</section>
</section>
<section class="toclist">
<h2 class="calibre5"><a id="calibre_link-322" class="calibre4"></a>The gawk Program</h2>
<p class="calibre10">The <code class="calibre26">gawk</code> program is the GNU version of the original <code class="calibre26">awk</code> program in Unix. The <code class="calibre26">awk</code> program takes stream editing one step further than the <code class="calibre26">sed</code> editor by providing a programming language instead of just editor commands. This section describes the basics of the <code class="calibre26">gawk</code> program as a quick reference to its abilities.</p>
<section class="toclist">
<h3 class="calibre15">The gawk command format</h3>
<p class="calibre10">The basic format of the <code class="calibre26">gawk</code> program is as follows:</p>
<pre class="calibre29"><code class="calibre26">gawk <code class="calibre26"><i class="calibre12">options program file</i></code></code></pre>
<p class="calibre10"><a id="calibre_link-1210" href="#calibre_link-1172" class="calibre4">Table B.2</a> shows the options available with the <code class="calibre26">gawk</code> program.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1172" href="#calibre_link-1210" class="calibre4"><b class="calibre21">Table B.2</b></a></span> The gawk Options</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Option</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-F</code> <code class="calibre26"><i class="calibre12">fs</i></code></td>
<td class="left">Specifies a file separator for delineating data fields in a line</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-f</code> <code class="calibre26"><i class="calibre12">file</i></code></td>
<td class="left">Specifies a file name to read the program from</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-v var=</code><code class="calibre26"><i class="calibre12">value</i></code></td>
<td class="left">Defines a variable and default value used in the <code class="calibre26">gawk</code> program</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-mf</code> <code class="calibre26"><i class="calibre12">N</i></code></td>
<td class="left">Specifies the maximum number of fields to process in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-mr</code> <code class="calibre26"><i class="calibre12">N</i></code></td>
<td class="left">Specifies the maximum record size in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">-W</code> <code class="calibre26"><i class="calibre12">keyword</i></code></td>
<td class="left">Specifies the compatibility mode or warning level for <code class="calibre26">gawk</code>. Use the <code class="calibre26">help</code> option to list all the available keywords.</td>
</tr>
</table>
</figure>
<p class="calibre10">The command line options provide an easy way to customize features in the <code class="calibre26">gawk</code> program.</p>
</section>
<section class="toclist">
<h3 class="calibre15">Using gawk</h3>
<p class="calibre10"><span type="pagebreak" title="757" id="calibre_link-341" class="calibre11"></span>You can use <code class="calibre26">gawk</code> either directly from the command line or from within your shell scripts. This section demonstrates how to use the <code class="calibre26">gawk</code> program and how to enter scripts for <code class="calibre26">gawk</code> to process.</p>
<section class="toclist">
<h4 class="calibre25">Reading the program script from the command line</h4>
<p class="calibre10">A <code class="calibre26">gawk</code> program script is defined by an opening and closing brace. You must place script commands between the two braces. Because the <code class="calibre26">gawk</code> command line assumes that the script is a single text string, you must also enclose your script in single quotation marks. Here's an example of a simple <code class="calibre26">gawk</code> program script specified on the command line:</p>
<pre class="calibre29"><code class="calibre26">$ gawk '{print $1}' </code></pre>
<p class="calibre10">This script displays the first data field in every line of the input stream.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Using multiple commands in the program script</h4>
<p class="calibre10">A programming language wouldn't be very useful if you could execute only one command. The <code class="calibre26">gawk</code> programming language allows you to combine commands into a normal program. To use multiple commands in the program script specified on the command line, just place a semicolon between commands:</p>
<pre class="calibre29"><code class="calibre26">$ echo "My name is Rich" | gawk '{$4="Dave"; print $0}'
My name is Dave
$ </code></pre>
<p class="calibre10">The script performs two commands: It replaces the fourth data field with a different value, and then it displays the entire data line in the stream.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Reading the program from a file</h4>
<p class="calibre10">As with the <code class="calibre26">sed</code> editor, the <code class="calibre26">gawk</code> editor allows you to store your programs in a file and refer to them in the command line:</p>
<pre class="calibre29"><code class="calibre26">$ cat script2
{ print $5 "'s userid is " $1 }
$ gawk -F: -f script2 /etc/passwd </code></pre>
<p class="calibre10">The <code class="calibre26">gawk</code> program processes all the commands specified in the file on the input stream data.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Running scripts before processing data</h4>
<p class="calibre10">The <code class="calibre26">gawk</code> program also allows you to specify when the program script is run. By default, <code class="calibre26">gawk</code> reads a line of text from the input and then executes the program script on the data in the line of text. Sometimes, you may need to run a script before processing data, such as to create a header section for a report. To do that, you use the <code class="calibre26">BEGIN</code> keyword. <span type="pagebreak" title="758" id="calibre_link-342" class="calibre11"></span>This forces <code class="calibre26">gawk</code> to execute the program script specified after the <code class="calibre26">BEGIN</code> keyword before reading the data:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN {print "This is a test report"}'
This is a test report
$ </code></pre>
<p class="calibre10">You can place any type of <code class="calibre26">gawk</code> command in the <code class="calibre26">BEGIN</code> section, such as commands that assign default values to variables.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Running scripts after processing data</h4>
<p class="calibre10">Similar to the <code class="calibre26">BEGIN</code> keyword, the <code class="calibre26">END</code> keyword allows you to specify a program script that <code class="calibre26">gawk</code> executes after reading the data:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN {print "Hello World!"} {print $0} END {print
     "byebye"}' data1
Hello World!
This is a test
This is a test
This is another test.
This is another test.
byebye
$ </code></pre>
<p class="calibre10">The <code class="calibre26">gawk</code> program executes the code in the <code class="calibre26">BEGIN</code> section first, then processes any data in the input stream, and then executes the code in the <code class="calibre26">END</code> section.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The gawk variables</h3>
<p class="calibre10">The <code class="calibre26">gawk</code> program is more than just an editor; it's a complete programming environment. As such, lots of commands and features are associated with <code class="calibre26">gawk</code>. This section shows the main features you need to know for programming with <code class="calibre26">gawk</code>.</p>
<section class="toclist">
<h4 class="calibre25">Built-in variables</h4>
<p class="calibre10">The <code class="calibre26">gawk</code> program uses built-in variables to reference specific features within the program data. This section describes the <code class="calibre26">gawk</code> built-in variables available for you to use in your <code class="calibre26">gawk</code> programs and demonstrates how to use them.</p>
<p class="calibre10">The <code class="calibre26">gawk</code> program defines data as records and data fields. A <span class="chaptertitle"><i class="calibre12">record</i></span> is a line of data (delineated by the newline characters by default), and a <span class="chaptertitle"><i class="calibre12">data field</i> </span>is a separate data element within the line (delineated by a white space character, such as a space or tab, by default).</p>
<p class="calibre10">The <code class="calibre26">gawk</code> program uses data field variables to reference data elements within each record. <a id="calibre_link-1211" href="#calibre_link-1173" class="calibre4">Table B.3</a> describes these variables.<span type="pagebreak" title="759" id="calibre_link-343" class="calibre11"></span></p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1173" href="#calibre_link-1211" class="calibre4"><b class="calibre21">Table B.3</b></a></span> The gawk Data Field and Record Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">$0</code></td>
<td class="left">The entire data record</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">$1</code></td>
<td class="left">The first data field in the record</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">$2</code></td>
<td class="left">The second data field in the record</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">$n</code></td>
<td class="left">The <i class="calibre12">n</i>th data field in the record</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FIELDWIDTHS</code></td>
<td class="left">A space-separated list of numbers defining the exact width (in spaces) of each data field</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FS</code></td>
<td class="left">Input field separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RS</code></td>
<td class="left">Input record separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OFS</code></td>
<td class="left">Output field separator character</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ORS</code></td>
<td class="left">Output record separator character</td>
</tr>
</table>
</figure>
<p class="calibre10">In addition to the field and record separator variables, <code class="calibre26">gawk</code> provides some other built-in variables to help you know what's going on with your data and extract information from the shell environment. <a id="calibre_link-1212" href="#calibre_link-1174" class="calibre4">Table B.4</a> shows the other built-in variables in <code class="calibre26">gawk</code>.</p>
<figure class="calibre23">
<figcaption class="calibre24">
<p class="calibre10"><span class="figurelabel"><a id="calibre_link-1174" href="#calibre_link-1212" class="calibre4"><b class="calibre21">Table B.4</b></a></span> More gawk Built-In Variables</p>
</figcaption>
<table border="1" class="calibre27">
<tr class="calibre28">
<td class="left">Variable</td>
<td class="left">Description</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGC</code></td>
<td class="left">The number of command line parameters present</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGIND</code></td>
<td class="left">The index in ARGV of the current file being processed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ARGV</code></td>
<td class="left">An array of command line parameters</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">CONVFMT</code></td>
<td class="left">The conversion format for numbers (see the <code class="calibre26">printf</code> statement), with a default value of %.6 g</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ENVIRON</code></td>
<td class="left">An associative array of the current shell environment variables and their values</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">ERRNO</code></td>
<td class="left">The system error if an error occurs reading or closing input files</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FILENAME</code></td>
<td class="left">The filename of the data file used for input to the <code class="calibre26">gawk</code> program</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">FNR</code></td>
<td class="left">The current record number in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">IGNORECASE</code></td>
<td class="left">If set to a non-zero value, <code class="calibre26">gawk</code> all string functions (including regular expressions); ignore the case of characters.</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">NF</code></td>
<td class="left">The total number of data fields in the data file</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">NR</code></td>
<td class="left">The number of input records processed</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">OFMT</code></td>
<td class="left">The output format for displaying numbers, with a default of %.6 g</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RLENGTH</code></td>
<td class="left">The length of the substring matched in the match function</td>
</tr>
<tr class="calibre28">
<td class="left"><code class="calibre26">RSTART</code></td>
<td class="left">The start index of the substring matched in the match function</td>
</tr>
</table>
</figure>
<p class="calibre10"><span type="pagebreak" title="760" id="calibre_link-344" class="calibre11"></span>You can use the built-in variables anywhere in the <code class="calibre26">gawk</code> program script, including the BEGIN and END sections.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Assigning variables in scripts</h4>
<p class="calibre10">Assigning values to variables in <code class="calibre26">gawk</code> programs is similar to how you assign values to variables in a shell script &mdash; using an <span class="chaptertitle"><i class="calibre12">assignment statement:</i></span></p>
<pre class="calibre29"><code class="calibre26">$ gawk '
&gt; BEGIN{
&gt; testing="This is a test"
&gt; print testing
&gt; }'
This is a test
$ </code></pre>
<p class="calibre10">After you assign a value to a variable, you can use that variable anywhere in your <code class="calibre26">gawk</code> script.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Assigning variables in the command line</h4>
<p class="calibre10">You can also use the <code class="calibre26">gawk</code> command line to assign values to variables for the <code class="calibre26">gawk</code> program. This allows you to set values outside of the normal code, changing values on the fly. Here's an example of using a command line variable to display a specific data field in the file:</p>
<pre class="calibre29"><code class="calibre26">$ cat script1
BEGIN{FS=","}
{print $n}
$ gawk -f script1 n=2 data1
$ gawk -f script1 n=3 data1 </code></pre>
<p class="calibre10">This feature is a great way to process data from your shell scripts in the <code class="calibre26">gawk</code> script.</p>
</section>
</section>
<section class="toclist">
<h3 class="calibre15">The gawk program features</h3>
<p class="calibre10">Some features of the <code class="calibre26">gawk</code> program make it handy for manipulating data, allowing you to create <code class="calibre26">gawk</code> scripts that can parse just about any type of text file, including log files.</p>
<section class="toclist">
<h4 class="calibre25">Regular expressions</h4>
<p class="calibre10">You <span type="pagebreak" title="761" id="calibre_link-345" class="calibre11"></span>can use either a Basic Regular Expression (BRE) or an Extended Regular Expression (ERE) to filter the lines in the data stream to which the program script applies.</p>
<p class="calibre10">When using a regular expression, the regular expression must appear before the left brace of the program script that it controls:</p>
<pre class="calibre29"><code class="calibre26">$ gawk 'BEGIN{FS=","} /test/{print $1}' data1
This is a test
$ </code></pre>
</section>
<section class="toclist">
<h4 class="calibre25">The matching operator</h4>
<p class="calibre10">The <span class="chaptertitle"><i class="calibre12">matching operator</i></span> allows you to restrict a regular expression to a specific data field in the records. The matching operator is the tilde character (â¼). You specify the matching operator, along with the data field variable, and the regular expression to match:</p>
<pre class="calibre29"><code class="calibre26">$1 ~ /^data/ </code></pre>
<p class="calibre10">This expression filters records where the first data field starts with the text data.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Mathematical expressions</h4>
<p class="calibre10">In addition to regular expressions, you can also use mathematical expressions in the matching pattern. This feature comes in handy when matching numerical values in data fields. For example, if you want to display all the system users who belong to the root users group (group number 0), you could use this script:</p>
<pre class="calibre29"><code class="calibre26">$ gawk -F: '$4 == 0{print $1}' /etc/passwd </code></pre>
<p class="calibre10">This script displays the first data field value for all lines that contain the value 0 in the fourth data field.</p>
</section>
<section class="toclist">
<h4 class="calibre25">Structured commands</h4>
<p class="calibre10">The <code class="calibre26">gawk</code> program supports the structured commands discussed in this section.</p>
<p class="calibre10">The <code class="calibre26">if-then-else</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> if (<code class="calibre26"><i class="calibre12">condition</i></code>) <code class="calibre26"><i class="calibre12">statement1</i></code>; else <code class="calibre26"><i class="calibre12">statement2</i></code></code></pre>
<p class="calibre10">The <code class="calibre26">while</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> while (<code class="calibre26"><i class="calibre12">condition</i></code>)
{
    <code class="calibre26"><i class="calibre12">statements </i></code>
} </code></pre>
<p class="calibre10">The <code class="calibre26">do-while</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> do {
    <code class="calibre26"><i class="calibre12">statements </i></code>
} while (<code class="calibre26"><i class="calibre12">condition</i></code>)</code></pre>
<p class="calibre10">The <code class="calibre26">for</code> statement:</p>
<pre class="calibre29"><code class="calibre26"> for(<code class="calibre26"><i class="calibre12">variable</i></code> <code class="calibre26"><i class="calibre12">assignment</i></code>; <code class="calibre26"><i class="calibre12">condition</i></code>; <code class="calibre26"><i class="calibre12">iteration process</i></code>)</code></pre>
<p class="calibre10"><span type="pagebreak" title="762" id="calibre_link-346" class="calibre11"></span>This provides a wealth of programming opportunities for the <code class="calibre26">gawk</code> script programmer. You can write <code class="calibre26">gawk</code> programs that rival the functions of just about any higher-level language program.</p>
</section>
</section>
</section>
</section>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-50">
<section class="toclist" type="titlepage">
<header class="calibre8">
<h1 class="booktitle"><a id="calibre_link-1311" class="calibre4"></a>Linux<sup class="calibre32">Â®</sup> Command Line and Shell Scripting BIBLE</h1>
</header>
<section class="toclist">
<div class="calibre16">
<div class="bookauthor">
<p class="bookedition"><b class="calibre21">Third Edition</b></p>
<p class="bookedition"><b class="calibre21">Richard Blum</b></p>
<p class="bookedition"><b class="calibre21">Christine Bresnahan</b></p>
</div>
</div>
<div class="publisherwordmark">
<img class="center" src="images/000021.png" alt="Title Page" />
</div>
</section>
</section>
</div>


<div class="calibre1" id="calibre_link-1178">
<p class="copyright"><b class="calibre21">Linux<sup class="calibre33">Â®</sup> Command Line and Shell Scripting Bible, Third Edition</b></p>
<p class="copyright">Published by</p>
<p class="copyright"><b class="calibre21">John Wiley &amp; Sons, Inc.</b></p>
<p class="copyright">10475 Crosspoint Boulevard</p>
<p class="copyright">Indianapolis, IN 46256</p>
<p class="copyright"><a href="http://www.wiley.com" class="calibre4">www.wiley.com</a></p>
<p class="copyright">Copyright Â© 2015 by John Wiley &amp; Sons, Inc., Indianapolis, Indiana</p>
<p class="copyright">Published simultaneously in Canada</p>
<p class="copyright">ISBN: 978-1-118-98384-3</p>
<p class="copyright">ISBN: 978-1-118-98385-0 (ebk)</p>
<p class="copyright">ISBN: 978-1-118-98419-2 (ebk)</p>
<p class="copyright">No part of this publication may be reproduced, stored in a retrieval system or transmitted in any form or by any means, electronic, mechanical, photocopying, recording, scanning or otherwise, except as permitted under Sections 107 or 108 of the 1976 United States Copyright Act, without either the prior written permission of the Publisher, or authorization through payment of the appropriate per-copy fee to the Copyright Clearance Center, 222 Rosewood Drive, Danvers, MA 01923, (978) 750-8400, fax (978) 646-8600. Requests to the Publisher for permission should be addressed to the Permissions Department, John Wiley &amp; Sons, Inc., 111 River Street, Hoboken, NJ 07030, (201) 748-6011, fax (201) 748-6008, or online at <a href="http://www.wiley.com/go/permissions" class="calibre4">http://www.wiley.com/go/permissions</a>.</p>
<p class="copyright"><b class="calibre21">Limit of Liability/Disclaimer of Warranty:</b> The publisher and the author make no representations or warranties with respect to the accuracy or completeness of the contents of this work and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. No warranty may be created or extended by sales or promotional materials. The advice and strategies contained herein may not be suitable for every situation. This work is sold with the understanding that the publisher is not engaged in rendering legal, accounting, or other professional services. If professional assistance is required, the services of rendering legal, accounting, or other professional services. If professional assistance is required, the services of damages arising herefrom. The fact that an organization or Web site is referred to in this work as a citation and/or a potential source of further information does not mean that the author or the publisher endorses the information the organization or website may provide or recommendations it may make. Further, readers should be aware that Internet websites listed in this work may have changed or disappeared between when this work was written and when it is read.</p>
<p class="copyright">For general information on our other products and services please contact our Customer Care Department within the United States at (877) 762-2974, outside the United States at (317) 572-3993 or fax (317) 572-4002. Wiley publishes in a variety of print and electronic formats and by print-on-demand. Some material included with standard print versions of this book may not be included in e-books or in print-on-demand. If this book refers to media such as a CD or DVD that is not included in the version you purchased, you may download this material at <a href="http://booksupport.wiley.com" class="calibre4">http://booksupport.wiley.com</a>. For more information about Wiley products, visit <a href="http://www.wiley.com" class="calibre4">www.wiley.com</a>.</p>
<p class="copyright"><b class="calibre21">Library of Congress Control Number:</b> 2014954688</p>
<p class="copyright"><b class="calibre21">Trademarks:</b> Wiley and the Wiley logo are trademarks or registered trademarks of John Wiley &amp; Sons, Inc. and/or its affiliates, in the United States and other countries, and may not be used without written permission. Linux is a registered trademark of Linus Torvalds. All other trademarks are the property of their respective owners. John Wiley &amp; Sons, Inc. is not associated with any product or vendor mentioned in this book.</p>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-1188">
<section class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1312" class="calibre4"></a>About the Authors</h1>
</header>
<p class="calibre10"><b class="calibre21">Richard Blum</b> has worked in the IT industry for more than 20 years as both a systems and network administrator and has published numerous Linux and open-source books. He has administered UNIX, Linux, Novell, and Microsoft servers, as well as helped design and maintain a 3,500-user network utilizing Cisco switches and routers. He has used Linux servers and shell scripts to perform automated network monitoring and has written shell scripts in most of the common Linux shell environments. Rich is an online instructor for an Introduction to Linux course that is used by colleges and universities across the United States. When he isn't being a computer nerd, Rich plays electric bass in a couple of different church worship bands, and enjoys spending time with his wife, Barbara, and two daughters, Katie Jane and Jessica.</p>
<p class="calibre10"><b class="calibre21">Christine Bresnahan</b> starting working with computers more than 25 years ago in the IT industry as a system administrator. Christine is currently an Adjunct Professor at Ivy Tech Community College in Indianapolis, Indiana. She teaches classes on Linux system administration, Linux security, and Windows security.</p>
</section>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-1216">
<section class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1313" class="calibre4"></a>About the Technical Editor</h1>
</header>
<p class="calibre10"><b class="calibre21">Kevin E. Ryan</b> holds a bachelor's degree in electrical engineering technology from Purdue University and has served as system administrator for a number of computing platforms including HP-UX, Solaris, and Red Hat Linux. He's also been involved with system planning, database management and application programming. When not pursuing his technical endeavors, Kevin enjoys reading, baseball, and camping with his wife and their fearless Papillon.</p>
</section>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-1227">
<section class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1314" class="calibre4"></a>Credits</h1>
</header>
<ol class="none">
<li class="calibre7"><b class="calibre21">Associate Publisher</b></li>
<li class="calibre7">Jim Minatel</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Project Editor</b></li>
<li class="calibre7">Martin V. Minner</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Technical Editor</b></li>
<li class="calibre7">Kevin E. Ryan</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Production Manager</b></li>
<li class="calibre7">Kathleen Wisor</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Copy Editor</b></li>
<li class="calibre7">Gwenette Gaddis</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Manager of Content Development and Assembly</b></li>
<li class="calibre7">Mary Beth Wakefield</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Marketing Director</b></li>
<li class="calibre7">David Mayhew</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Marketing Manager</b></li>
<li class="calibre7">Carrie Sherrill</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Professional Technology and Strategy Director</b></li>
<li class="calibre7">Barry Pruett</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Business Manager</b></li>
<li class="calibre7">Amy Knies</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Project Coordinator, Cover</b></li>
<li class="calibre7">Patrick Redmond</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Proofreader</b></li>
<li class="calibre7">Nancy Carrasco</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Indexer</b></li>
<li class="calibre7">Robert Swanson</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Cover Designer</b></li>
<li class="calibre7">Wiley</li>
</ol>
<ol class="none">
<li class="calibre7"><b class="calibre21">Cover Image</b></li>
<li class="calibre7">iStockphoto.com / Aleksandar Velasevic</li>
</ol>
</section>
</div>


<div type="frontmatter" class="calibre1" id="calibre_link-1238">
<section class="toclist">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1315" class="calibre4"></a>Acknowledgments</h1>
</header>
<p class="calibre10">First, all glory and praise go to God, Who through His Son, Jesus Christ, makes all things possible, and gives us the gift of eternal life.</p>
<p class="calibre10">Many thanks go to the fantastic team of people at John Wiley &amp; Sons for their outstanding work on this project. Thanks to Mary James, the former acquisitions editor, for offering us the opportunity to work on this book. Also thanks to Marty Minner, the project editor, for keeping things on track and making this book more presentable. Thanks, Marty, for all your hard work and diligence. The technical editor, Kevin E. Ryan, did a wonderful job of double-checking all the work in the book, plus making suggestions to improve the content. Thanks to Gwenette Gaddis, the copy editor, for her endless patience and diligence to make our work readable. We would also like to thank Carole McClendon at Waterside Productions, Inc., for arranging this opportunity for us, and for helping us out in our writing careers. In addition, we would like to give a special thank you to H.L. Craft, who produced several diagrams for our chapters.</p>
<p class="calibre10">Christine would like to thank her husband, Timothy, for his encouragement, patience, and willingness to listen, even when he has no idea what she is talking about.</p>
</section>
</div>


<div type="backmatter" class="calibre1" id="calibre_link-323">
<section class="toclist" type="notice">
<header class="calibre8">
<h1 class="calibre9"><a id="calibre_link-1316" class="calibre4"></a>WILEY END USER LICENSE AGREEMENT</h1>
</header>
<section class="toclist">
<p class="calibre10">Go to <a href="http://www.wiley.com/go/eula" class="calibre4">www.wiley.com/go/eula</a> to access Wiley's ebook EULA. </p>
</section>
</section>
</div>


</body></html>